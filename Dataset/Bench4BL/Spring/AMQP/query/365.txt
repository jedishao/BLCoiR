casesanalysis add flag test race listener channel countdown ack count recovery message broker redelivery result condition fix solution closed send consumer case