Mcast Service Impl McastServiceImpl executor dispatching events attachment details Fix proposal class Mcast Service Impl McastServiceImpl dispatch events executor class Receiver Base ReceiverBase has queue issue refactored code class attaching diff file bug Bugzilla procedure Trunk branch tell Regards Ariel
Jsp Runtime Context JspRuntimeContext synch problems jspReloadCount JspRuntimeContext synchronised get Jsp Reload Count getJspReloadCount instance value value Javadoc getter needs field needs Atomic Integer AtomicInteger  fields classpath code Source codeSource  made constructor
Loggers attachment details Patch loggers Loggers class name make sense allow classes logger  Note Receiver Base ReceiverBase class set Log setLog method order make log
getLogger ContainerBase logger ContainerBase core catalina apache org core catalina apache org synchronised methods access seems logger ContainerBase core catalina apache org unsynch access subclasses considerations apply log Name logName log Name logName Javadoc get Logger getLogger states method parent
run MessageDispatchInterceptor interceptors group tribes run MessageDispatchInterceptor interceptors group tribes catalina apache org threads
run BlockPoller NioBlockingSelector net util tomcat apache org run BlockPoller NioBlockingSelector net util tomcat apache org threads
runtime Jsp Factory Impl$ Page Context Pool JspFactoryImpl$PageContextPool needs Findbugs says localPool JspFactoryImpl runtime jasper apache org Bug Jsp Factory Impl$ Page Context Pool JspFactoryImpl$PageContextPool needs embrace Pattern type SIC category CORRECTNESS class class class is danger embrace class class class retains reference class reference instance class instance garbage collection
md5Helper DigestAuthenticator initialisation Findbugs says method contains initialization field compiler processor reorder instructions guaranteed object method make field problem
initialization update fields initialization update fields daemon Bootstrap startup catalina apache org contextDigester ContextConfig startup catalina apache org Findbugs says method contains initialization field field object location updated setting field futher method field object have bug object method field value
Improve Local ThreadLocal memory leak clean up way means clean up Local ThreadLocal point pool
AJP connector min Spare minSpareThreads used found messages  startup catalina apache org Oct PM Set All Properties Rule SetAllPropertiesRule begin WARNING Service Connector property min Spare minSpareThreads find property  AJP connector configs following Connector Http connector min Spare minSpareThreads net util tomcat apache org ajp coyote apache org Ajp Protocol AjpProtocol set min Spare minSpareThreads Io Endpoint JIoEndpoint made patch patch made Abstract Http11 Protocol AbstractHttp11Protocol regards
Add setter getter Abstract Protocol AbstractXXXProtocol attachment details patch Abstract Protocol AbstractXXXProtocol Add methods Abstract Http11 Protocol AbstractHttp11Protocol Abstract Ajp Protocol AbstractAjpProtocol set Min Spare setMinSpareThreads get Min Spare getMinSpareThreads regards
Bio Sender scheduling task excecutors attachment details patch  using apache tribes Tomcat version bug occurs Trunk seems refactor executors monitors Bio Receiver BioReceiver task think patch comment Regards Ariel
Jre Memory Leak Prevention Listener JreMemoryLeakPreventionListener cause memory leaks system Class Loader ClassLoader invokes methods context Class Loader ClassLoader memory order Webapp Class Loader WebappClassLoader cause behavior environments JMLPL use security context context Class Loader ClassLoader system Class Loader ClassLoader situation client care
dependency tomcat catalina ha tomcat catalina pom file tomcat catalina depends tomcat catalina class Manager Servlet HTMLManagerServlet tomcat catalina has reference class Backup Manager BackupManager tomcat catalina way dependency components way mightbe Null Pointer Exception NullPointerException issue Backup Manager BackupManager Manager Servlet HTMLManagerServlet line getManager ctxt Manager manager manager instanceof Backup Manager BackupManager show Proxy Sessions showProxySessions Integer getActiveSessionsFull BackupManager manager  getManager ctxt null getActiveSessions Integer manager  Integer 0   check
synchronization issue attachment details add CompositeELResolver Synchronize change add CompositeELResolver el javax method needs update resolvers threads size check updates size size Array Index Out Of Bounds Exception ArrayIndexOutOfBoundsException makes sense default size Resolver ELResolver array jasper EL Resolvers ELResolvers propose default
use get Class getClass lead concurrency bugs future getInitialContext Hashtable javaURLContextFactory java naming apache org method has block get Class getClass get Class getClass lock bug pattern class java Context Factory javaURLContextFactory get Initial Context getInitialContext instance subclass get Class getClass return Class object instance objects classes behavior class javaURLContextFactory suggest bug pattern get Class getClass See information bug pattern Keshmesh Eclipse plugin source code Java programs concurrency bug patterns one
Ps JSPs set Content Length encoding Access Log Valve AccessLogValve Reported users@  Steps  jsp simple Create JSP page   Send request GET Host localhost  Connection  response Tomcat OK Server Apache Set Cookie Http Only HttpOnly Content Type text html charset Content Length Date Thu Jan GMT   response Tomcat OK Server Apache Set Cookie Http Only HttpOnly Content Type text html charset Transfer Encoding chunked Date Thu Jan GMT     Investigation breakpoint Abstract Http11 Processor#prepare Response AbstractHttp11Processor#prepareResponse see line getContentLengthLong response content Length contentLength returns call stack Daemon http getContentLengthLong Response line prepareResponse Http11Processor AbstractHttp11Processor  line action ActionCode Http11Processor AbstractHttp11Processor  Object line action ActionCode Response Object line sendHeaders Response line doFlush boolean OutputBuffer line line getBytesWritten boolean Response line addElement StringBuilder AccessLogValve$ByteSentElement Date Request Response line log Request AccessLogValve Response line invoke Request AccessLogValve Response line invoke Request StandardEngineValve Response line service Request CoyoteAdapter Response line process SocketWrapper Http11Processor Socket line process SocketWrapper Http11Protocol$Http11ConnectionHandler Socket Socket Status SocketStatus line process SocketWrapper Http11Protocol$Http11ConnectionHandler Socket line run JIoEndpoint$SocketProcessor line runTask Runnable ThreadPoolExecutor$Worker line run ThreadPoolExecutor$Worker line run TaskThread  line flush OutputBuffer Note getContentLengthLong response Access Log Valve AccessLogValve configuration call returns stack Daemon http prepareResponse Http11Processor AbstractHttp11Processor  line action ActionCode Http11Processor AbstractHttp11Processor  Object line action ActionCode Response Object line sendHeaders Response line doFlush boolean OutputBuffer line close OutputBuffer line finishResponse Response line service Request CoyoteAdapter Response line process SocketWrapper Http11Processor Socket line process SocketWrapper Http11Protocol$Http11ConnectionHandler Socket Socket Status SocketStatus line process SocketWrapper Http11Protocol$Http11ConnectionHandler Socket line run JIoEndpoint$SocketProcessor line runTask Runnable ThreadPoolExecutor$Worker line run ThreadPoolExecutor$Worker line run TaskThread  line  getContentLengthLong response value set content length header close OutputBuffer stack trace includes call length value response getLength setContentLength bb coyoteResponse regression triggered Access Log Valve AccessLogValve count bytes
Make method Tomcat codes saw listener start filter start load On Startup loadOnStartup methods marked methods containers use methods initialization Thanks
Rpc Channel RpcChannel improvements attachment details svn diff enhancement proposal addresses issues Rpc Channel RpcChannel tribes component  is bug catch  Interrupted Exception catch InterruptedException clause call Thread#interrupt  Rpc Channel RpcChannel API user registers Rpc Callback RpcCallback communication events is method case sending response message proposal includes addition callback cases compatibility callback method declared sub interface Rpc Callback RpcCallback Rpc Callback2 RpcCallback2 time  tribes classes tomcat loader messages tribes instances classes webapp fail Abstract Replicated Map AbstractReplicatedMap includes mechanism API user class loaders map entries enhancement proposal includes mechanism Rpc Channel RpcChannel find modifications
max Connections maxConnections honors config max Connections maxConnections honors affects BIO NIO connector others test config begin Executor  Connector Http11Protocol http11 coyote apache protocol= org        Connector Http11NioProtocol http11 coyote apache protocol= org        test config end  ab2 grep 999x grep ESTABLISHED show range connections number KO ab2 grep 999x grep ESTABLISHED show connections OOPS  Logs show traces socket out catalina begin net util tomcat apache org May PM Abstract Endpoint AbstractEndpoint count Down Connection countDownConnection WARNING connection count socket out catalina end
Tomcat Single Model SingleThreadModel Problem tomcat Single Model SingleThreadModel variables init  Servlet Config init ServletConfig config method case values init  Servlet Config init ServletConfig config reflected service block Example code print io java import Exception IOException io java import Print Writer PrintWriter servlet javax import Servlet Config ServletConfig servlet javax import Servlet Exception ServletException servlet javax import Single Model SingleThreadModel http servlet javax import Http Servlet HttpServlet http servlet javax import Http Servlet Request HttpServletRequest http servlet javax import Http Servlet Response HttpServletResponse class test extends Http Servlet HttpServlet implements Single Model SingleThreadModel   Override @Override init  Servlet Config init ServletConfig config throws Servlet Exception ServletException  init config super   request Http Servlet Response HttpServletResponse response throws Servlet Exception ServletException Exception IOException  setContentType  text response html charset Print Writer PrintWriter try  println i out    close out   Override @Override request Http Servlet Response HttpServletResponse response throws Servlet Exception ServletException Exception IOException  response  Override @Override do Post  Http Servlet Request doPost HttpServletRequest request Http Servlet Response HttpServletResponse response throws Servlet Exception ServletException Exception IOException  response  Override @Override String get Servlet Info getServletInfo  return description
usage method start Standard Context StandardContext method Thread#run used mistake lines Thread#join completion remove join thread
Performance Issue JAR files TLD file parsing Migrating Tomcat performance hit noticed pages lots custom tags Page rendering time jumped order magnitude compiler jasper apache org webapp Netbeans narrowed problem get Jar File getJarFile method Parse Controller ParseController Screenshots Profiler Hotspots Call Tree versions Tomcat URL path used JAR file Tomcat values output debugger Tomcat target snapshot WEB INF Tomcat snapshot WEB INF comparison get Jar File getJarFile methods shows differences URL path problem Tomcat Jar Resource JarURLResource Jar File JarFile get Jar File getJarFile throws Exception IOException URL jar File Url jarFileUrl L  jar URL  jar jar Url jarUrl openConnection jarFileUrl Jar Connection JarURLConnection conn Jar Connection JarURLConnection setUseCaches false conn connect conn getJarFile conn  Tomcat Parser Controller ParserController Jar File JarFile get Jar File  getJarFile URL jar File Url jarFileUrl throws Exception IOException jar File jarFile null jar File Url jarFileUrl null openConnection jarFileUrl Jar Connection JarURLConnection conn Jar Connection JarURLConnection setUseCaches false conn connect conn getJarFile conn jar File jarFile  return
make threadname Extended Access Log Valve ExtendedAccessLogValve attachment details Threadname Extended Access Log Valve ExtendedAccessLogValve discussed tomcat users mailinglist  threadname served request Extended Access Log Valve ExtendedAccessLogValve
Regression cache control headers requests security constraints attachment details is Secure isSecure check Copied CLN  isSecure request sets default value secure Pages With Pragma securePagesWithPragma check block cache control headers results headers added requests security constraints Tomcat-7 change behavior E8 IE8 pages check added CLN  fix bug IE caching  commented CLN  patch is Secure isSecure check
Eclipse WTP Serve modules tc7 patch tomcat Eclipse WTP has option modules tc6 tc7 investigation WTP team seem way tomcat problem WTP reported findResourceInternal String WebappClassLoader loader catalina apache org Dir Context DirContext implementation Wtp Dir Context WtpDirContext returns Resource Attributes ResourceAttributes location String ignores Resource Entry ResourceEntry code Base codeBase source fields location applications get Resource getResource Context Class Loader ContextClassLoader URL call get Resource As Stream getResourceAsStream CCL
Chunked Input Filter ChunkedInputFilter recycled servlet request using async Is APIs tomcat server side code Async Context AsyncContext async Context asyncContext  processing getInputStream getRequest   asyncContext  read input stream complete asyncContext Input Stream InputStream returns bytes HTTP post chunking AbstractInputBuffer http11 coyote apache org found Chunked Input Filter ChunkedInputFilter recycled reuse request result end Chunk endChunk flag request return buffer
enabled FastQueue util bio transport tribes catalina apache org Field enabled FastQueue util bio transport tribes catalina apache org flag read synchronized flag access See information bug pattern Keshmesh Eclipse plugin analyzes source code Java programs concurrency bug patterns used Keshmesh concurrency bug pattern
coda prelude order respected Web Xml WebXml Application Jsp Config Descriptor ApplicationJspConfigDescriptor jsp Property Groups jspPropertyGroups Hash Set HashSet kind set order elements guaranteed spec Using Linked Hash Set LinkedHashSet Hash Set HashSet fixes issues
size FastQueue util bio transport tribes catalina apache org data races getSize FastQueue util bio transport tribes catalina apache org remove FastQueue util bio transport tribes catalina apache org add ChannelMessage FastQueue util bio transport tribes catalina apache org size FastQueue util bio transport tribes catalina apache org synchronized Member Interceptor Payload InterceptorPayload read access synchronized race condition getSize FastQueue util bio transport tribes catalina apache org used bug manifests getSize FastQueue util bio transport tribes catalina apache org suggest Tomcat developers field size FastQueue util bio transport tribes catalina apache org Field declared
shares Realm instance web applications INFO log message lifecycle attachment details  dev@  problem default Realm unit tests problem  getDefaultRealm Tomcat factory method Realm instance creates Realm Tomcat#default Realm Tomcat#defaultRealm  setRealm defaultRealm ctx addWebapp Tomcat method Context Realm instance shared web applications  Context starts method realm method web applications start ones message logged Lifecycle Base LifecycleBase start INFO start method called component start call ignored reproduce startup catalina apache org Apply patch Test Tomcat TestTomcat trunk Run test See start method message logs think ways getState Lifecycle call start Realm Change Tomcat class share Realm instance Contexts assign Engine create instance time way lead problems Context Realm stopped webapp cause problems start contexts xml server way
defined Dependencies extensions mechanism Tomcat  result mail opening bug Dependencies extensions mechanism have proposals  Tomcat continue implementation property extensions location value added default Tomcat classpath directories loader shared validateApplication ExtensionValidator Pros Tomcat users know property directory extensions files invocation Cons configuration  Tomcat remove property extensions Tomcat classpath directories loader shared Pros configuration needed specify libraries extensions property validateApplication ExtensionValidator Cons appear lot files patch solution favourite proposal looking comments Thanks advance Regards Violeta Georgieva
shut versions deployment deployment version application has sessions tomcat JVM resources Christopher Schultz suggested approaches Tomcat user list  Modify deployment code Bean MBean Notification Listener NotificationListener events expiring session notifications webapp  listener notification check state  session part filter step session count start stops webapp de listener   Install Session Event Listener SessionEventListener counts sessions count JMX suppose starts    Install Timer intervals minute sessions  idea seems Tomcat fire events things session count changing
fixes Tomcat Memory Leak Detection code Problem Description  Tomcat memory leak detection has issues detection code tested Sun Ms JVMs lot reflection code work IBM JDK Tests seem protection Tomcat classloader memory leaks categories memory leaks key value displayed warning messages ones references threadlocals loadedByThisOrChild Object WebappClassLoader traverses object classloader hierarchy hierarchy Problem Conclusion  testing IBM Ks JDKs cleaned reflection code executors timers IBM JDK tests leaks leaks Local ThreadLocal leak reporting loaded By This Or Child loadedByThisOrChild method addition expunge Stale Entries expungeStaleEntries method Make code leak detection scenarios
newInstance ExpressionFactory Performance issue newInstance ExpressionFactory el javax implementation Tomcat cache instance class name discovery invocation discovery process involves file el javax META INF services Expression Factory ExpressionFactory invocation method involves file issue reported dev list performance problems myfaces testing   references myfaces EL method invocation performance   evaluation  problem Tomcat newInstance ExpressionFactory method added EL Tomcat  newInstance ExpressionFactory el javax hits Bean Resolver#invoke BeanELResolver#invoke called invocation  are places factory instance field performance discovery process consequences implementation web application bug places expressionFactory JspApplicationContextImpl runtime jasper apache org compiler jasper apache org Validator$ Validate Visitor Validator$ValidateVisitor N_ EXPRESSION_FACTORY
Inconsistency documentation Connector max Connections maxConnections property According documentation max Connections maxConnections property BIO HTTP Connector defaults value max maxThreads documentation states executor property properties Connector includes max maxThreads BIO HTTP Connector executor default value max Connections maxConnections take max maxThreads value Executor fact appears max maxThreads value Connector object  confirmed test Download Tomcat Edit conf uncomment executor default HTTP connector HTTP connector executor Start Tomcat jconsole Look Catalina Protocol Handler ProtocolHandler max Connections maxConnections set max maxThreads executor xml server stop Tomcat edit max maxThreads attribute connector value tomcat Examine Catalina Protocol Handler ProtocolHandler max Connections maxConnections property Suggestions Update documentation max Connections maxConnections BIO HTTP Connector defaults max maxThreads Connector presence executor Fix max Connections maxConnections default value max maxThreads executor executor preferences
Default Instance Manager#populate Annotations Cache DefaultInstanceManager#populateAnnotationsCache check used setter method attachment Patch proposal  core catalina apache org Default Instance Manager#populate Annotations Cache DefaultInstanceManager#populateAnnotationsCache methods class cases injection target validate method setter method opinion check validation like patch checks order method injection target looking commends Regards Violeta Georgieva
Allow custom error mapping Manager max Active Sessions maxActiveSessions Tomcat Manager Base ManagerBase Illegal State Exception IllegalStateException thrown max Active Sessions maxActiveSessions attribute xml web allows error handling configuration See discussion reproduced sample application jsp index examples jsp security protected xml context set configuration error page session catalina apache org exception type type  page
Illegal State Exception IllegalStateException JSP start Async startAsync scenario involves  ServletA forwards Servlet  startAsync request Servlet ServletB calls  attempts JSP getRequestDispatcher request dispatch asyncContext tried JSP Request Dispatcher RequestDispatcher fails Servlet ServletB dispatch AsyncContext Servlet ServletA fail exception JSP lang java Illegal State Exception IllegalStateException create session response created project  war  project page contains instructions want source order couple variations getRequestDispatcher request specifics bug question async seems case Tomcat bug containers Jetty Spec discussion question
Tomcat Bind Exception BindException throw  Context#stop Lifecycle Exception LifecycleException stops start Stop startStopThreads Host Engine remain while start Stop startStopThreads demon result Acceptor stopped keep Alive Time keepAliveTime seconds set  start Stop Executor startStopExecutor Pool Executor ThreadPoolExecutor  Time Unit TimeUnit SECONDS start Stop Queue startStopQueue  order Bind Exception BindException waiting seconds required think start Stop startStopThreads demon Regards
Atomicity violation bugs collections attachment details patch atomicity violation bugs name Yu Lin  D Ph student CS department UIUC doing research Java library misusages found misusages Concurrent Hash Map ConcurrentHashMap Tomcat atomicity violation bugs harm performance code snapshot code file java ApplicationContext java org apache catalina core line line L761 L762 get name attributes L763 value remove name attributes L764 L765 L766 return L767  containsKey name parameters L1262 return  L1265 L1266 value code atomicity violation occur lines  Suppose T1 line hashmap attributes contains name T1 executes line T2 name key attributes T1 execution line value name line throw Null Pointer Exception NullPointerException method name snapshot has atomicity violation Let lines Suppose T1 line finds hashmap dose key name line T2 pair name hashmap parameters T1 resumes execution value T2 code preserves absent semantics found misusages files java ReplicatedContext org apache catalina ha context atomicity violation occur T2 key name hashmap tomcat Attributes tomcatAttributes T1 executes line java HostConfig org apache catalina startup suppose T1 executes line hashmap dose contain executes line T2 puts pair hashmap deployed T1 execution value T2 put If Absent putIfAbsent method be used method line
dispatch AsyncContext request properties scenario forward call dispatch path properties request dispatch path query params dispatch project issue  Build sources tomcat issue repro branch home page application select Dispatch Async Context AsyncContext scenario scenario involves couple forwards Servlet Servlet ServletC turn dispatches Servlet JSP setupDispatchScenario ServletContext WebAppInitializer See details setup log output shows content request Servlet  ServletC looks dispatch request Uri requestUri servlet Path servletPath path Info pathInfo  scenario home page Dispatch Async Context AsyncContext wrap request wraps request results  ServletA request Uri requestUri servlet Path servletPath path Info pathInfo parameter Map parameterMap application dispatch match state request  FWIW are couple scenarios forwarding  ServletA Forward Request Dispatcher RequestDispatcher scenario appears way Forward Request Dispatcher RequestDispatcher wrap request state request async thread
send Redirect sendRedirect work dispatch Async Context AsyncContext dispatch AsyncContext call send Redirect sendRedirect redirect status code project issue  Build source tomcat issue repro home page application select Redirect scenario scenario involves Redirect RedirectA dispatches Redirect RedirectB turn redirects JSP page  ServletC JSP page see page log output processing setupRedirectScenario ServletContext WebAppInitializer details setup see  FWIW forward dispatch async scenario works modify line Redirect RedirectA Forwarding Async Servlet ForwardingAsyncServlet Dispatching Async Servlet DispatchingAsyncServlet  issue issue tested
closeOutboundConnection WsFrame StreamInbound closes opcode status close Outbound Connection  Ws Frame closeOutboundConnection WsFrame frame throws Exception IOException try close frame getWsOutbound    do On Close  Constants doOnClose Constants   Line uses opcode status Constants STATUS context frame client frame Constants S_ STATUS_NORMAL order frame opcode inspected status shutdown Thanks Michael
return async processing isAsyncStarted request async processing container calls return dispatch asyncContext application calls begins dispatch case spec says dispatch operation container dispatch container period dispatch called dispatch Dispatcher Type DispatcherType ASYNC return value change async processing
servlet spec violation async timeout processing attachment details test war file java source Servlet Spec says processing  event operation times container steps onTimeout AsyncListener Invoke method Async Listener AsyncListener instances Servlet Request ServletRequest operation initiated complete AsyncContext none listeners dispatch AsyncContext methods perform error dispatch status code C_ L_ R_ SC_INTERNAL_SERVER_ERROR matching error page error page dispatch AsyncContext complete AsyncContext complete AsyncContext methods container call pdf servlet-3_0-mrel-spec pdf page Spec page complete AsyncContext words Async Listeners AsyncListeners dispatch AsyncContext container perform error dispatch error code tomcat send error response sends timeout AsyncContextImpl core catalina apache org listener Invoked listenerInvoked action getCoyoteRequest   request Action Code ActionCode result get result return  listeners container calls complete  calls think violation attached test war file test source Test URL Async Timeout Test Servlet AsyncTimeoutTestServlet
turn web fragments use element Servlet Container Initializer ServletContainerInitializer classpath issue seem web name words  turn web fragments none workaround web fragment
servlets url cause warning xml web found functioning application mapping portion servlet URI Tomcat deployed application warning application servlet mapping XML file made tests annotations servlets behavior servlet mapping access way order applications like warning log startup deployment application servlet URL Examples problem Example   servlet name name web simfreteV1 com br servlet class class   servlet name name web simfreteV1 com br servlet class class  servlet servlet name name url relatorios pattern  servlet servlet name name url relatorios pattern   Example annotations java servlet files Web Servlet name @WebServlet name url Patterns urlPatterns relatorios do Report doReport class Pdf Report Print PdfReportPrint extends Abstract Base Servlet AbstractBaseServlet  Web Servlet name @WebServlet name Print Boleto Servlet PrintBoletoServlet url Patterns urlPatterns relatorios do Report doReport class Print Boleto Servlet PrintBoletoServlet extends Http Servlet HttpServlet
orderedLibs context servlet javax value attribute  Rev Servlet spec end chapter following written page  addition Servlet container provide orderedLibs context servlet javax Servlet Context ServletContext attribute name value type List String contains list names JAR files WEB INF lib directory application Servlet Context ServletContext web fragment names exclusions JAR files ordering null application ordering  source code is Servlet Context ServletContext code understanding list jar names jar bar jar foo ordering
form data read encoding bug occurs form data form data Servlet API files servlet encoding setCharacterEncoding  UTF-8 request invoke getParts request invoke getParameter  sometextfield request String text characters text garbled Order method calls get Parameter getParameter get Parts getParts encoding used order methods matter
issue Tag Plugin Manager TagPluginManager attachment details Patch Tag Plugin Manager TagPluginManager Tag Plugin Manager TagPluginManager shared Servlet Context ServletContext contains Page Info PageInfo page Info pageInfo Page Info PageInfo aligned page Page Info PageInfo used page information Import pages compiled parallel encounters issue page compiled server
Facilitate weaving Class File Transformer ClassFileTransformer Webpp Class Loader WebppClassLoader application servers provide mechanism web applications instrument class bytecode form instrumentation methods Class Loader ClassLoader implementation web application class loading Spring Framework example provides way Class Loaders ClassLoaders application servers loader catalina a o Tomcat Webapp Class Loader WebappClassLoader Spring use provides class Webapp Class Loader WebappClassLoader instrumentation xml context jar spring-instrument-tomcat Users place file T_ TOMCAT_HOME lib loader declaration META INF order pain rear Spring changes Webapp Class Loader WebappClassLoader classes helper class Weaving Transformer WeavingTransformer Tomcat Instrumentable Class Loader TomcatInstrumentableClassLoader intend changes Tomcat Tomcat patch needed answers community objection addition Webapp Class Loader WebappClassLoader think improvement Tomcat steps need Spring code Tomcat requirements code licensed Apache
Race Condition Http Session#invalidate HttpSession#invalidate attachment details code flow race condition session fixation protection have user session one user login state changes rely Spring Security Session Fixation Protection Strategy SessionFixationProtectionStrategy core commands invalidate session getSession true request session Yesterday had message log command session line servlet container change session ID session session authentication web security springframework org protected session fixation attacks catalina Session Fixation Protection Strategy SessionFixationProtectionStrategy issue found fact race condition requests client session fixation protection code parallel invalidate session attached TXT file code flow race condition call returns session state getSession true request session call create session effect obtain session invalidate session documentation has indication session returns session interface provides way session error message appears production log files weeks event session fixation race condition Regards Christoph
Order Servlet Request ServletRequest parameters preserved Servlet Request ServletRequest interface provides methods request parameters Enumeration String get Parameter Names getParameterNames Map String String get Parameter Map getParameterMap implementation Tomcat Hash Map HashMap order parameters request implementation used request order Linked Hash Map LinkedHashMap example insertion order Servlet Specification speaks ordering query string data body data section HTML specification Processing form data states control names values order document see interpretation specification Tomcat implementation request list parameters implementation order
issue Tag File Processor TagFileProcessor attachment details wrapper Runtime Context RuntimeContext code has issue getRuntimeContext ctxt Jsp Runtime Context JspRuntimeContext rctxt getWrapper wrapperUri rctxt Jsp Servlet Wrapper JspServletWrapper wrapper synchronized rctxt wrapper null  creates Jsp Servlet Wrapper JspServletWrapper scenario tag C jsp A jsp B jsp B jsp A compiling lines get Jsp Runtime Context  Jsp Servlet Wrapper JspRuntimeContext JspServletWrapper null instances Jsp Servlet Wrapper JspServletWrapper created
Add Drawboard Websocket Example attachment details Patch example  like example Tomcat Websocket examples page mouse touch input colors page page room image see people sending messages client messages needs NIO APR connector Room drawing has actions Room Buffered Image BufferedImage rooms Room have Room page receive websocket message room image PNG image receive string messages drawing actions line x1y1 x2y2 Note string messages JSON dependency lib uses synchronization mechanisms image user network latency speed user time place server decide line client think
getThread WebappClassLoader want access Group ThreadGroup Tomcat have permissions getThread WebappClassLoader method try root Group ThreadGroup order manage Security Exception SecurityException parent Group ThreadGroup Tomcat
xml web-fragment parse files webConfig ContextConfig does following  Scans web fragments Map String Web Xml WebXml fragments process Jars For Web Fragments processJarsForWebFragments method returns list JAR files jars To Skip jarsToSkip options xml fragment parses META INF web files  Filters orderWebFragments webXml WebXml ordered Fragments orderedFragments fragments Context sContext  Uses set fragments SCI declarations process Servlet Container Initializers ordered Fragments processServletContainerInitializers orderedFragments  Uses set fragments scan classes xml web merge  Uses list web fragments resources process Resource Rs resource Jars processResourceJARs resourceJars xml web saying fragments step web application fragments element validation servlet compliance Note metadata parsing names ordering seems validation idea using Rs JARs resources
Tomcat SPNEGO authenticator IBM JDK Accept Security Context Privileged Action order server side authentication attachment details Contains GNU diff Spnego Authenticator SpnegoAuthenticator format  Problem useSubjectCredsOnly auth security javax bug report change made system property follows GSSAPI Accept Sec Context AcceptSecContext method Privileged Exception Action PrivilegedExceptionAction found IBM JDK Cause IBM JDK credential GSSAPI Accept Sec Context AcceptSecContext method does JAAS Subject doAs Subject call call fails IBM JDK access JAAS subject credential find  File gnu diff format Spnego Authenticator SpnegoAuthenticator version DIFF TOP BUG FIX REPORTED file contains Accept Action AcceptAction class GSSAPI Accept Sec Context AcceptSecContext Privileged Exception Action PrivilegedExceptionAction fix solves issue IBM JDK credential JAAS Subject  Arunav Sanyal
Allow Server Info ServerInfo listings Default Servlet DefaultServlet Discussion dev@   Looking Tomcat bug Error Report Valve ErrorReportValve think thing done Tomcat version number Default Servlet DefaultServlet servlet show version information Server Info ServerInfo listings enabled seems way version Server Info ServerInfo  way listings define XSLT style sheet configuration option Default Servlet DefaultServlet Places patch java DefaultServlet xml servlet webapps docs default xml howto webapps docs security
NIO async servlet limit latch leak attachment details sample webapp bug encouter bug product webapp 0_55 jdk1 tested linux x86 oracle jdk tomcat tomcat CONFIG xml server change HTTP Connector NIO  Http11NioProtocol http11 coyote apache protocol= org WEBAPP LOGIC situation  startAsync req call serlvet execute async logic user  user interrupted timeout logic code  user code call send response client PROBLEM countDown LimitLatch situation called connections latch count max default tomcat connection client hangs REPRODUCER tomcat-7 installation  change default Connector config Http11NioProtocol http11 coyote apache protocol= org change Optional add bug  war ROOT copy sample webapp attachment  start tomcat  make request html async echo curl localhost:8080 request cause limit latch leak requests reaches max Connections maxConnections client curl hangs TECHNIC DETAILS debug found  user code call Nio Channel NioChannel Closed jdk NIO code Closed By Interrupt Exception ClosedByInterruptException  channel Selection Key SelectionKey removed Poller trace Daemon owns Object owns Hash Set HashSet owns Poll Selector Impl EPollSelectorImpl owns Collections$ Unmodifiable Set Collections$UnmodifiableSet owns Util$2 removeKey SelectionKey SocketChannelImpl AbstractSelectableChannel  line deregister AbstractSelectionKey EPollSelectorImpl AbstractSelector  line implDereg SelectionKeyImpl EPollSelectorImpl line processDeregisterQueue EPollSelectorImpl SelectorImpl  line line lockAndDoSelect long EPollSelectorImpl SelectorImpl  line select long EPollSelectorImpl SelectorImpl  line run NioEndpoint$Poller line run line  processSocket NioChannel NioEndpoint net util tomcat apache org complete ctx run Socket Status SocketStatus code process Socket  Nio Channel processSocket NioChannel socket Socket Status SocketStatus status dispatch try getAttachment false KeyAttachment socket Key Attachment KeyAttachment attachment attachment null   Selection Key SelectionKey attachment returns null countDownConnection AbstractEndpoint logic break limit latch leak happens WORK AROUND work  switch BIO connector  flushBuffer resp avoid call user thread
Webssocket client access webapp resources websocket tomcat apache org method Async Channel Wrapper Secure AsyncChannelWrapperSecure sets context class loader websocket client class loader webapp resources line restores access classloader calling webapp thread
display sessions sessions count Manager application issue Re r1614165  Manager application has commands distribution sessions time commands sessions expire Test GUI Expire Sessions button HTML GUI commands display sessions time minute minutes Lets assume web application session timeout minutes r1614165 time slot statistics labeled revisions fixed labeled sessions time minutes value time max Count maxCount  sessions time slot numbers see sessions expiration configuration behaviour  xml web Configure examples application text session config session timeout config xml context META INF Context  Configure user roles manager script manager gui Start Tomcat  Visit example webapp examples Session example session  Visit manager html sessions number row examples webapp list sessions opens Use time session  Visit manager text sessions statistics  Wait minutes output sessions command session minutes output minutes sessions
Nio Connector NioConnector caches corrupted comet Configuration Tomcat Nio Connector NioConnector nginx atmosphere happens atmosphere comet connection Nio Endpoint NioEndpoint Poller  A Socket Channel SocketChannel becomes read nginx Poller unregisters channel read  B event see Nio Endpoint:1239 NioEndpoint:1239 atmosphere calls connection  C Tomcat action code Action Code ActionCode T_ COMET_CLOSE channel Poller java:462 Http11NioProcessor see Socket Channel SocketChannel case  B hasnâ€ Selection Key SelectionKey Poller  A initiates closing process  B completes closing process Nio Channel NioChannel Attachment Key AttachmentKey caches java:564 AbstractProtocol tries channel Nio Channel NioChannel Attachment Key AttachmentKey caches Caches become references object requests get Nio Channel NioChannel Attachment Key AttachmentKey stuff responses
Atomicity violation name Bai Guangdong research fellow National University Singapore find atomicity violation java ApplicationContext problem occurs file java org apache catalina core Look code snippet L791 old Value oldValue L792 old Value oldValue null L793 replaced put name attributes L794 value   L801 L802 event getServletContext ServletContextAttributeEvent context L803 L804 name old Value oldValue L805 L806 event getServletContext ServletContextAttributeEvent context L807 L808 name value   L816 fireContainerEvent context L817 L818 beforeContextAttributeReplaced listener attributeReplaced event listener fireContainerEvent  afterContextAttributeReplaced context L820 L821 listener L822 fireContainerEvent  beforeContextAttributeAdded context L823 L824 listener attributeAdded event listener L825 fireContainerEvent  afterContextAttributeAdded context L826 L827 listener Suppose T1 T2 code snippet key name attributes T1 line old Value oldValue T1 becomes T1 line T2 executes old Value oldValue T2 T1 executes line T2 T1 value line T1 T2 fire event line situation T2 fired line
concurrency problem corrupts WARDirContext Entry children children Entry WARDirContext getResourcePaths ServletContext discovered problem sort children Arrays list Entry WARDirContext method performs call request result children array entries others entries directories war Tomcat load resources resource requests result http error code compliation Jasper Exception JasperException files seen Cent CentOS versions Tomcat Java following attached zip Test case project corruption requires runs stack trace flow java WARDirContext patch file
destroy myServlet class loader my Servlet myServlet T5 shared directory  getContextClassLoader currentThread   web app needs  application unload seem case classes T5 directory getClassLoader getClass   servlet classloader Standard Calss Loader StandardCalssLoader understanding code web app getContextClassLoader currentThread   give Webapp Loader WebappLoader used Standard Context StandardContext unload StandardWrapper problem occurs destroy servlet method  Class Loader ClassLoader getContextClassLoader currentThread   getClassLoader getClass   instance Class Loader ClassLoader class Loader classLoader out System Print Stream PrintStream  startCapture SystemLogHandler  Call servlet destroy method try fireInstanceEvent instanceSupport Instance Event InstanceEvent E_ Y_ BEFORE_DESTROY_EVENT instance setContextClassLoader classLoader currentThread   getSecurityManager System null doAsPrivilege  destroy SecurityUtil instance remove instance SecurityUtil  destroy instance   code INSTANCE variable servlet classloader classloader getLoader StandardContext classloader problem occurs T5 windows occurs web App webApp T5 notice problem T5 verified code  problem Regards Gagnon
Web App Class Loader WebAppClassLoader clear References clearReferences code break Web App Class Loader WebAppClassLoader sets variables clear References clearReferences method results Es NPEs variables  problem deploys unload fails deploy
Tomcat path pound sign Class Not Found Exception ClassNotFoundException Tomcat start path pound character find informations mail tomcat user developer informations toURL File part problem usage Classloader URLClassloader appreciate problem mail hints  applies versions thanks
registrations Servlet Context Listener ServletContextListener class register class Servlet Context Listener ServletContextListener methods called servlet specifications say container call listeners order deployment descriptor case listener class mentioned specification Example listener listener class test class  listener listener class test class  listener listener class test class  test Servlet Context Listener1 ServletContextListener1 test Servlet Context Listener2 ServletContextListener2 called test Servlet Context Listener1 ServletContextListener1 called Apache Tomcat has bug
Return Accept Ranges Default Servlet DefaultServlet Default Servlet DefaultServlet Ranges request header response Accept Ranges bytes header required order Adobe Acrobat Linearized PDF download access PDF file specification reason header response Default Servlet DefaultServlet files impact PDF files filing bug RFE
process Socket Http11Processor http11 coyote condition socket process Socket Http11Processor http11 coyote socket  getSoTimeout socket int so Timeout soTimeout int old So Timeout oldSoTimeout getCurrentThreadsBusy endpoint int Ratio threadRatio getMaxThreads endpoint Ratio threadRatio   old So Timeout oldSoTimeout condition looks code timeout method class socket part problem method instance socket timeout parameter socket socket parameter renamed Note Javadoc
fix Task Factory TaskThreadFactory attachment details change scope scope
think Access Log Valve AccessLogValve race condition problem pattern used class usage Access Log Valve AccessLogValve issues race condition article article think variables class race condition current Millis currentMillis Date current Date currentDate
xml context Fails re xml context directory doc Base docBase directory deleted re Reproduction context name assumed test Webapp testWebapp  xml context test Webapp testWebapp META INF prepared put directory means started xml testWebapp created directory  updated Result test Webapp testWebapp directory deleted cause fixed order resource Host Config$ Deployed Application#redeploy Resources HostConfig$DeployedApplication#redeployResources changed fix order redploy resources fix Case Deploy war war doce Base doceBase directory Case Deploy directory xml META context doceBase directory INF fix Case Deploy war war doce Base doceBase directory Case Deploy directory xml META context INF doce Base doceBase directory Host Config#check Resources HostConfig#checkResources int i++ omits lastModified resource isDirectory resource lastModified omits Delete redeploy resources int j++ try current File resourcesj omits delete current ExpandWar  catch Exception IOException getString warn sm log name app canonicalizing hostConfig   omits  xml testWebapp updated directory deleted war directory result xml context fails deploying doc Base docBase direcotry Regards
Delta Session DeltaSession ignores notify Listeners On Replication notifyListenersOnReplication Backup Manager BackupManager Backup Manager BackupManager used Delta Session DeltaSession notifies session listener notify Listeners On Replication notifyListenersOnReplication s h c a o cause Delta Session#apply Diff DeltaSession#applyDiff codes void apply Diff byte applyDiff byte diff int offset int length throws Exception IOException Class Not Found Exception ClassNotFoundException try  execute this getDeltaRequest    setContextClassLoader contextLoader currentThread     unlock   Delta Session DeltaSession notifies session listener value notify Listeners On Replication notifyListenersOnReplication notify session listener notify Listeners On Replication notifyListenersOnReplication think notify Listeners On Replication notifyListenersOnReplication parameter s h c a o Delta Request#execute DeltaRequest#execute invoked instance follows  Index java org apache catalina ha session  java DeltaSession java org apache catalina ha session revision java DeltaSession java org apache catalina ha session working copy @@ +1757 @@ Class Loader ClassLoader loaders get Class Loaders getClassLoaders length loaders loaders null setContextClassLoader loaders0 currentThread   execute this getDeltaRequest   Cluster Manager ClusterManager  setContextClassLoader contextLoader currentThread    end regards
context class loader used Http Session Listener HttpSessionListener Http Session Listener HttpSessionListener class loader set context class Loader classLoader think problem Coyote Adapter#parse Session Cookies Id CoyoteAdapter#parseSessionCookiesId method JSESSION COOKIE parsed method session Id sessionId request session Id sessionId Request#is Requested Session Id Valid Request#isRequestedSessionIdValid method called method Session#is Valid Session#isValid called Request#is Requested Session Id Valid Request#isRequestedSessionIdValid method context class loader Standard Class Loader StandardClassLoader Webapp Class Loader WebappClassLoader instance session passed session timeout Session#expire executed time context class loader Standerd Class Loader StanderdClassLoader  context class loader Http Session Listenner HttpSessionListenner regards
No Class Def Found Error NoClassDefFoundError access jsp attachment details webapp class jar error had situation No Class Def Found Errors NoClassDefFoundErrors jsp jsp index page page class session bean class jar WEB INF lib folder  thing error page accessed tomcat restart page work page pages error remained place error success state determined page ater tomcat restart remained error success state tomcat restart seems sort class loading oder initialization bug pages order tomcat restart drove while application page showing error restart workaround order couple lines jsp directive access java URI class order changed error happens order error reproduced described managed scenario error jsp bean session class reproduced installation Kubuntu machine sun jre tomcat6 installed configuration replaced ROOT sample webapp one tomcat jsp index Remember tomcat change bug browser succeed
session catalina apache org Race condition Manager Base ManagerBase max Active maxActive running tomcat race detector race condition class session catalina apache org Manager Base ManagerBase field max Active maxActive Data Race Manager Base ManagerBase max Active maxActive Tid WRITE Lock Set session catalina apache org Manager Base ManagerBase add  Lorg add Lorg apache catalina Session   Session  V session catalina apache org Standard Session StandardSession set Id  Ljava setId Ljava lang String   String  V session catalina apache org Manager Base ManagerBase create Session  Ljava createSession Ljava lang String   Lorg String  Lorg apache catalina Session session catalina apache org Standard Manager StandardManager create Session  Ljava createSession Ljava lang String   Lorg String  Lorg apache catalina Session connector catalina apache org Request do Get Session  Z  Lorg doGetSession Z Lorg apache catalina Session connector catalina apache org Request get Session  Z  Ljavax getSession Z Ljavax servlet http Http Session HttpSession connector catalina apache org Request Facade RequestFacade get Session  Z  Ljavax getSession Z Ljavax servlet http Http Session HttpSession connector catalina apache org Request Facade RequestFacade get Session   Ljavax getSession  Ljavax servlet http Http Session HttpSession auth jspwiki ecyrd com Authentication Manager AuthenticationManager login  Ljavax login Ljavax servlet http Http Servlet Request   HttpServletRequest  Z  Tid Lock Set session catalina apache org Manager Base ManagerBase add  Lorg add Lorg apache catalina Session   Session  V session catalina apache org Standard Session StandardSession set Id  Ljava setId Ljava lang String   String  V session catalina apache org Manager Base ManagerBase create Session  Ljava createSession Ljava lang String   Lorg String  Lorg apache catalina Session session catalina apache org Standard Manager StandardManager create Session  Ljava createSession Ljava lang String   Lorg String  Lorg apache catalina Session  java ManagerBase code snip add  Session add Session session getIdInternal put session sessions session int size size max Active maxActive max Active maxActive size   Statement statement executed manner fix problem statement statement block
Memory leaks protection detect leaks JSP pages attachment details jsp foo webapps examples memory protection feature C6 TC6 C7 TC7 types memory leaks servlet code classes Webapp Class Loader WebappClassLoader cure ones JSP code classes Jasper Loader JasperLoader think concern code memory leak JSP page tag file example leaks diagnostics Manager webapp reproduce  jsp foo Place examples webapp  Open examples  Open Manager web application  Reload start examples application  Press leaks button Manager  message displayed app memory leak jsp foo leak caused Local ThreadLocal instance class JSP class loaded Jasper Loader JasperLoader Locals ThreadLocals leaks protection code  Local ThreadLocal reference servlet cleared memory leak protection code examples application see message Tomcat logs
concurrency issues clearReferencesThreadLocals WebAppClassLoader think memory leak protection Locals ThreadLocals GC instance issues concurrency enumerates structures class memory barrier state Local ThreadLocal application application date state synchronization remove ThreadLocal ThreadLocalMap lang java leak invokes instance invocation done app remove method expunge Stale Entries expungeStaleEntries method clear Local Map clearThreadLocalMap webapp applications load requests corrupt structures instance propose detection leaks optional default problems production clearing way leak tomcat worker mark background task threads pool
Race condition Standard Executor StandardThreadExecutor requests enqueued tomcat configure Executor memory leak issues redeployment development page webapp Safari Chrome Firefox resources page take seconds resources instance requests page html others resources js css images have 10s offer Runnable TaskQueue core catalina apache org analysis found Standard Executor StandardThreadExecutor statement getPoolSize getActiveCount  < parent parent  scenario Pool Executor ThreadPoolExecutor user refreshes page cache web browser page resources browser establishes TCP connection browser response decides resources parallel establishes TCP connections tests execute StandardThreadExecutor Acceptor calls connection offer Runnable TaskQueue call Standard Executor StandardThreadExecutor called sources Java Pool Executor ThreadPoolExecutor see delay time pool Size poolSize time task active Count activeCount getPoolSize getActiveCount  <parent parent offer TaskQueue case connections burst calls delay task creation Keep Alive tomcat care TCP connection time requests queue wait timeout pool tasks keep Alive Time Out keepAliveTimeOut means requests pool server facts issue test case pool occur server thing issue burst TCP connections problem keep Alive Timeout keepAliveTimeout case depends time requests issue affects tomcat pool request TCP connection impact tc6 disabled
initialization synchronization data race Ast Integer AstInteger Ast Floating Point AstFloatingPoint Ast String AstString     Use init synchronization methods get Integer getInteger get Floating Point getFloatingPoint get String getString Consider Ast Integer AstInteger Number number protected Number get Integer getInteger number this null try number this catch Arithmetic Exception ArithmeticException image BigInteger this number this   number  Data races number method get Integer getInteger read line write lines
Data race Application Context ApplicationContext   Data race Map parameters method void merge Parameters mergeParameters parameters null read return Map results Concurrent Hash Map ConcurrentHashMap  parameters write
Violation JSP EL spec version coerce Enum String name A Section JSP EL spec Coerce String says Enum return case Tomcat bug created custom code Tag JSP Tag class My Custom Tag MyCustomTag implements Tag set Value  String setValue String value   public set Page Context  Page Context setPageContext PageContext pc public Tag get Parent getParent null int do Start Tag doStartTag throws Jsp Exception JspException P_ SKIP_BODY int do End Tag doEndTag throws Jsp Exception JspException return void release  TLD version= 1 xml taglib xsi ns xsd jsptaglibrary_2_1 ns javaee xmlns Schema XMLSchema instance  org domain uri tag name tagclass mypackage  attribute name required     Enum enum My Enum MyEnum APPLE ORANGE Override @Override String to String toString return name   JSP @taglib custom Lib % customLib % custom Tag customTag custom Tag customTag value my Enum myEnum set My Enum MyEnum ORANGE outputs ORANGE bar ORANGE foo out catalina output ORANGE bar ORANGE this foo violation JSP EL spec
unbind unbindThread bindThread StandardContext effect commit think bug unbind unbindThread methods tomcat unbindThread ContextBindings unbind DirContextURLStreamHandler methods unbind unbindThread CCL bind DirContextURLStreamHandler bindThread DirContextURLStreamHandler bindThread StandardContext call unbind DirContextURLStreamHandler unbindThread DirContextURLStreamHandler unbindThread StandardContext
E_ N_ CHANGE_SESSION_ID message cluster session synchronization dropped message message timestamp messages received cluster sessions synchronization Delta Manager DeltaManager startup timestamp dropped made patch timestamp E_ N_ CHANGE_SESSION_ID message Regards
improve leak Ldap Pool Manager LdapPoolManager timeout pool connect ldap jndi sun com ldap jndi sun com class Ldap Pool Manager LdapPoolManager system property value Pool Cleaner PoolCleaner spawned context class loader initialization class web application class loader used Pool Cleaner PoolCleaner web app class loader leak improve leak
keep Alive Protection keepAliveProtection work attachment details Servlet Context Listener ServletContextListener Class Loader ClassLoader reference contextClassLoader keepAliveTimer kac HttpClient http www net sun causes memory leak webapp classloader Tomcat http www net sun claims loads Http Client HttpClient create timer leak exists AFAICT listener prevent leak
Query Stats QueryStats has synchornisation issues attachment details Patch Atomic approach  know Query Stats QueryStats fields Atomic time made Load test load results Slow Query Report SlowQueryReport get Sql queries number executions way approach synchronize failure Use Atomic did performance reasons Regards Philippe Mouawad
protect AWT creation getDefaultToolkit Toolkit awt java webapp launch AWT Windows AWT XAWT Context Class Loader ContextClassLoader webapp memory undeploy redeploy addition Jre Memory Leak Prevention Listener JreMemoryLeakPreventionListener alleviate condition
Infinite loop Apr Endpoint AprEndpoint unlockAcceptorFailed warn endpoint acceptor Apr Endpoint AprEndpoint shutdown enters infinite loop message Acceptor failed Forcing socket shutdown reported users@ mailing lists  caused firewall Tomcat HTTP port reproduce unlock Accept unlockAccept method endpoint noop return trunk bug introduced r1065945
Support L_ P_ R_ R_ SSL_OP_CIPHER_SERVER_PREFERENCE Honor Cipher Order SSLHonorCipherOrder Tomcat Native have equivalent directive SSL BEAST attack See docs directive BEAST attack incorporate option Honor Cipher Order SSLHonorCipherOrder option L_ P_ R_ R_ SSL_OP_CIPHER_SERVER_PREFERENCE  S P bug enhancement security issue filed bug S P patch Tomcat build env time change
Replicated Map ReplicatedMap Tcp Failure Detector TcpFailureDetector configuration Tribes stack Tcp Ping Interceptor TcpPingInterceptor Tcp Failure Detector TcpFailureDetector Message Dispatch Interceptor MessageDispatchInterceptor Static Membership Interceptor StaticMembershipInterceptor work cluster side heartbeat TcpFailureDetector call call check Members false checkMembers false perform Basic Check performBasicCheck synchronized membership perform Basic Check performBasicCheck node memberAlive m membership add member membership HAVE TIME member Alive m memberAlive m remove side getMembers channel call Abstract Replicated Map AbstractReplicatedMap getMembers TcpFailureDetector call call return value nodes Note membership use Tcp Failure Detector TcpFailureDetector get Member getMember get Members getMembers has Members hasMembers Membership method Tcp Failure Detector TcpFailureDetector check node issue Abstract Replicated Map AbstractReplicatedMap Tcp Failure Detector TcpFailureDetector node map Replicated Map ReplicatedMap use Channel SEND_OPTIONS_DEFAULT value Channel D_ S_ E_ SEND_OPTIONS_USE_ACK message node fail exception heartbeat TcpFailureDetector Personnaly override configuration Tcp Ping Interceptor TcpPingInterceptor call perform Forced Check performForcedCheck fix Replicated Map ReplicatedMap issue fix avoid member membership list Add method member Alive  Member Impl memberAlive MemberImpl Membership side effect member performBasicCheck TcpFailureDetector check method node fix issue acknoledge nodes code Tomcat regards Arnoud F
Lost interruption interrupted pool jdbc tomcat apache org Connection Pool#close ConnectionPool#close call interrupt code Interrupted Exception InterruptedException catch Interrupted Exception InterruptedException ex getPropagateInterruptState getPoolProperties   interrupt currentThread    interrupted
Order invocation method Server Endpoint Config ServerEndpointConfig Configurator order invocation check Origin checkOrigin get Negotiated Subprotocol getNegotiatedSubprotocol get Endpoint Instance getEndpointInstance modify Handshake modifyHandshake JSR order order refer application subclass Server Endpoint Config ServerEndpointConfig Configurator end users like order modify Handshake modifyHandshake allows applications query store information upgrade request example URI check Origin checkOrigin allows applications origin information request response call checks origin request URI HTTP headers get Negotiated Subprotocol getNegotiatedSubprotocol client Sec Web Socket WebSocket Protocol header server sub protocol application client point endpoint methods failure point method one order invoke method get Negotiated Extensions getNegotiatedExtensions extensions believe method get End Point Instance getEndPointInstance Thanks
juli apache org Concurrent Modification Exception ConcurrentModificationException Class Loader Log Manager ClassLoaderLogManager attachment Source juli apache org getLogManager LogManager logging util java Tomcat instance Class Loader Log Manager ClassLoaderLogManager getLoggerNames getLogManager   LogManager webapp result Concurrent Modification ConcurrentModification occur reproduce zip test-1 download attached package Maven war test-1 copy target tomcat webapps start Tomcat util java see lot Issue Concurrent Modification Exception ConcurrentModificationException System output getLoggerNames LogManager getLogger String Logger webapp uses case reproduced Tomcat JDK getLoggerNames ClassLoaderLogManager juli apache org suppose copy result
jar scan context config TLD config log message went process others Tomcat war application took orders magnitude Tomcat root cause Tomcat Servlet jar context config fragments process had FINE log level thousands Tomcat log messages messages waste time properties catalina Tomcat needed message jar scan jar jar filters jarsToSkip DefaultJarScanner scan util tomcat jarsToSkip ContextConfig startup catalina apache org jarsToSkip TldConfig startup catalina apache org enhancement add log message jar properties logging properties logging recommend log level FINE override message properties logging Tomcat fix messages recommendation override message hanging fruit help Tomcat performance impact Servlet jar help Tomcat veterans files jar performance Thank
Concurrency issue Mapper$ Context List Mapper$ContextList Contexts removeContextVersion Mapper noticed issue code trunk @1604217 code exists Tomcat removeContext Mapper removeContextVersion Mapper Tomcat does following  contexts contextList host Recalculate nesting nesting contextList host int i++ name slashCount newContextsi int nesting contextList host slash Count slashCount nesting contextList host    nesting contextList contexts contextList problem delay list contexts field field used mapping contexts example  are contexts ROOT foo foo#bar  Context foo#bar stopped  request foo comes html index foo behaviour context foo application behaviour request ROOT webapp foo have test case
Restart Container background issue times mailing lists  Container Background Processor ContainerBackgroundProcessor Es OOMEs  Background errors log background Process backgroundProcess JMX has effect think background delay start stack help Stack Overflow Error StackOverflowError help Out Of Memory Error OutOfMemoryError death strategy admin Out Of Memory Error OutOfMemoryError JVM flag script restarts Tomcat
Web Socket WebSocket group warning examples webapp Testing release candidate Windows JDK 7u67 bit NIO connector Steps   Start Tomcat  Visit Echo example examples websocket Select connection option like annotation API stream issue connection options Press Connect button Press Echo message button Press Disconnect button  Touch webapps\\examples\\ webapps\examples\WEB web application Tomcat Webapp reloading completes Web Socket WebSocket group warning logged logs file Expected warning  INFO Context name started destroy WsServerContainer server websocket tomcat apache org WARNING Web Socket WebSocket group web application reload StandardContext core catalina apache org INFO Context name completed  Evaluation notes  Reproduction rate warning happen Steps repeated Tomcat issue example connection option used issue depend destroy WsServerContainer server websocket tomcat apache org message printed method originates r1589043 tried information code  String Builder StringBuilder buf String Builder StringBuilder getName append threadGroup buf append buf active Count activeCount isDestroyed append threadGroup  append buf Thread100 enumerate threadGroup int Count threadCount count int Count threadCount i++  Stack Trace Element StackTraceElement stack Stack Trace Element StackTraceElement ste stack    toString warn buf log  results  active Count activeCount isDestroyed  count returned  destroy threadGroup code succeeds are Perm Gen PermGen memory leaks stack traces printed Webapp Class Loader WebappClassLoader leak detection code leaks leaks command Tomcat Manager webapp destroy ThreadGroup call group parent group list object leak case web application code warning justified Thoughts fix  setDaemon true threadGroup Use daemon flag group means destroy method count done synchronized Group synchronized threadGroup block methods change  activeCount ThreadGroup isDestroyed ThreadGroup goal java object leak  activeCount threadGroup Ask count warning message
Threads leak  Web Socket WebSocket implementation versions noticed connection WsWebSocketContainer Use method endpoint client Endpoint Configuration clientEndpointConfiguration path issue URL page newFixedThreadPool Executors result connection return error class Async Channel Wrapper Secure AsyncChannelWrapperSecure time source creation Executor Service ExecutorService executor Secure Factory SecureIOThreadFactory Count increasing attempt URL connection WsWebSocketContainer live time application connection Leakage observed jvisualvm program make kind situations threads
invoke PersistentValve class loader attachment details patch trunk invoke Request PersistentValve Response method Webapp class loader bound class loader bind restored class loader thread
Reverse Comparator ReverseComparator negates result attachment details Patch negation risk Consider code Override @Override int compare  Session compare Session Session int return Value returnValue o2 return  code negates return value compare method programming practice return value Integer N_ MIN_VALUE return value negate sign result achieve result order operands results See Recommend following Override @Override int compare  Session compare Session Session Note o2 result compare o2 comparator return
forward getRequestDispatcher   request Query string parameters values sent servlet forward getRequestDispatcher   request URL query string parameters value values received destination servlet Example response getQueryString request servlet handling have P1 request parameter list parameters query string order quantity parameters difference values seen servlet values value mergeParameters ApplicationHttpRequest believe cause containsKey key queryParameters line value null replaced things Tomcat capabilities point have pair test servlets behavior development server action safepassing2 gmail_com provide address
check Local Map For Leaks checkThreadLocalMapForLeaks has positives references keys references values appears check Local Map For Leaks checkThreadLocalMapForLeaks reports positives key subclass class value class loader Integer int List Simple Date Formatter SimpleDateFormatter Example output servlettest-0 checkThreadLocalMapForLeaks WebappClassLoaderBase SEVERE localhost web application created Local ThreadLocal key type Test Servlet$1 TestServlet$1 value value type Integer value failed web application going time memory leak web applications positives output makes tracking issues Third party libraries refuse use Local ThreadLocal code leaks read bug comment heuristic positives compromise configuration warning class name basis added configuration instance message Local ThreadLocal warnings config info warning message
suspect Timeout suspectTimeout work documentation posted mailinglist  pool  suspectTimeout= 120 set connections connections queue looks bug Docs tell value connection connection logs warning log Abandoned logAbandoned code suspect method connection called Pool Cleaner PoolCleaner method one check pool configuration isRemoveAbandoned getPoolProperties   pool checkAbandoned pool want suspect documentation property connections condition suspect Timeout suspectTimeout suspect method care one
Tomcat Javadoc exception fixes attachment details Patch subject says
thread Runnable amount do Posts doPosts generated attachment details testcase bug Runnable amount do Posts doPosts generated GET status Internal Server Error is exception tomcat code demonstrates Start async infinite amount times
Detect Feature request worker request delay log warning trace allow running ones network call deadlock
NIO locked load test stuck dump simulate users disconnect
Processing Tomcat Connector configuration leave connectors Server part Tomcat configuration seems fact exceptions connector initialization exception initialization connector example connector port connector connectors one listening port connectors leads situation connectory order connectors error definitions xml server fact default contains cases connector definition confusion configuration problem