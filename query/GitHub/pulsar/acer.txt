1117	Exception namespace bundle split exception reported automatically initiated bundle split ERROR pulsar web PulsarWebResource Failed validate namespace bundle netflix prod java lang IllegalArgumentException Invalid upper boundary bundle race condition happening initial bundles split time bundle cache updated bundle split processed result doesn issue bundle split fails invalid bundle range current bundle unaffacted split place Exception namespace bundle split bundle broker load namespace bundles data split service
2141	Race condition reconnection managed ledger fenced checking intermittent failures SequenceIdWithErrorTest test failing race condition involving producer consumer reconnecting broker topic fenced test fencing error purposely inject Race condition reconnection managed ledger fenced ledger entries cursor position read async callback size
3768	pulsar function intermittent test failure deadlock org apache pulsar functions worker PulsarWorkerAssignmentTest shutdown intermittent failure deadlock function worker Disabling enable deadlock issue fixed function worker Error Message Method org apache pulsar functions worker PulsarWorkerAssignmentTest shutdown didn finish time Stacktrace org testng internal thread ThreadTimeoutException Method org apache pulsar functions worker PulsarWorkerAssignmentTest shutdown didn finish time pulsar function intermittent test failure deadlock function sink source test missing topic skip event
4447	Broker stuck partitioned stats Describe bug Brokers cluster stuck executing internalGetPartitionedStats pulsar pulsar broker src main java org apache pulsar broker admin impl PersistentTopicsBase java Lines cfa TopicStats partitionStats pulsar getAdminClient topics getStats topicName getPartition toString thread dump https gist github nkurihar cdec pulsar web prio prio tid nid waiting condition java lang Thread WAITING parking parking wait java util concurrent CompletableFuture Signaller Reproduce haven reproduce Additional context Broker CentOS Linux release Broker version Broker spec Real server GHz CPU GBMEM SATA SSD Base port Broker stuck partitioned stats topic test partitioned subscription persistent delete messages message
4635	Bookie deadlock broker multiple bookie servers cluster hardware failure time broker server Messages broker connect output log deadlock pulsar session watcher WARN ZooKeeperSessionWatcher zoo keeper disconnected waiting reconnect time remaining seconds pulsar session watcher WARN ZooKeeperSessionWatcher zoo keeper disconnected waiting reconnect time remaining seconds pulsar session watcher WARN ZooKeeperSessionWatcher zoo keeper disconnected waiting reconnect time remaining seconds pulsar session watcher WARN ZooKeeperSessionWatcher zoo keeper disconnected waiting reconnect time remaining seconds pulsar session watcher WARN ZooKeeperSessionWatcher zoo keeper disconnected waiting reconnect time remaining seconds pulsar session watcher WARN ZooKeeperSessionWatcher zoo keeper disconnected waiting reconnect time remaining seconds pulsar session watcher WARN ZooKeeperSessionWatcher zoo keeper disconnected waiting reconnect time remaining seconds pulsar session watcher WARN ZooKeeperSessionWatcher zoo keeper disconnected waiting reconnect time remaining seconds pulsar session watcher WARN ZooKeeperSessionWatcher zoo keeper disconnected waiting reconnect time remaining seconds pulsar session watcher WARN ZooKeeperSessionWatcher zoo keeper disconnected waiting reconnect time remaining seconds pulsar session watcher WARN ZooKeeperSessionWatcher zoo keeper disconnected waiting reconnect time remaining seconds pulsar session watcher WARN ZooKeeperSessionWatcher zoo keeper disconnected waiting reconnect time remaining seconds pulsar session watcher WARN ZooKeeperSessionWatcher zoo keeper disconnected waiting reconnect time remaining seconds pulsar session watcher ERROR ZooKeeperSessionWatcher timeout expired reconnecting invoking shutdown service thread dump broker shuts broker threaddump txt phenomenon Pulsar version broker previous bug fixed Bookie deadlock broker bookie ledger broker config test async bookies service
4707	PulsarKafkaProducer thread safe feature request problem describe replaced kafka client pulsar client kafka referring document http pulsar apache org docs adaptors kafka sending messages multiple topics time caused exception NullPointerException exception occur version occur version change time send message topic cluster object regenerated https github apache pulsar blob pulsar client kafka compat pulsar client kafka src main java org apache kafka clients producer PulsarKafkaProducer java javadoc KafkaProducer thread safe https kafka apache org javadoc org apache kafka clients producer KafkaProducer html pulsar client kafka modifying code Kafka client Reproduce build gradle dependencies testCompile group junit junit version compile group org apache pulsar pulsar client kafka original version compile group org apache pulsar pulsar client athenz version main String args Exception Properties properties Properties properties setProperty ProducerConfig BOOTSTRAP SERVERS CONFIG pulsar ssl server properties setProperty ProducerConfig RETRIES CONFIG properties setProperty ProducerConfig KEY SERIALIZER CONFIG StringSerializer getName properties setProperty ProducerConfig SERIALIZER CONFIG StringSerializer getName properties setProperty PulsarClientKafkaConfig TLS properties setProperty PulsarClientKafkaConfig TLS TRUST CERTS FILE PATH filePath trust crt CERT properties setProperty PulsarClientKafkaConfig AUTHENTICATION AuthenticationAthenz getName properties setProperty PulsarClientKafkaConfig AUTHENTICATION PARAMS STRING authParams properties setProperty security protocol PLAINTEXT properties setProperty ProducerConfig REQUEST TIMEOUT CONFIG properties setProperty ProducerConfig ACKS CONFIG properties setProperty ProducerConfig METADATA MAX AGE CONFIG producer PulsarKafkaProducer properties StringSerializer StringSerializer Thread thread Thread String topic persistent topic ProducerRecord String String record ProducerRecord topic producer send record recordMetadata System println recordMetadata Thread thread Thread String topic persistent topic ProducerRecord String String record ProducerRecord topic producer send record recordMetadata System println recordMetadata thread start thread start Exception thread Thread java lang NullPointerException PulsarKafkaProducer thread safe producer thread ledger client message test capacity reject
5585	persistent topic replication deadlock NonPersistentReplicator disable batching batch message producer acquire release num message meta process ack publishing replication set correct number message batch tracking publish rate stats numMessages msg getMessageBuilder hasNumMessagesInBatch msg getMessageBuilder getNumMessagesInBatch ByteBufPair cmd sendMessage producerId sequenceId numMessages msgMetadata encryptedPayload msgMetadataBuilder recycle msgMetadata recycle OpSendMsg OpSendMsg create msg cmd sequenceId callback setNumMessagesInBatch numMessages setBatchSizeByte encryptedPayload readableBytes pendingMessages lastSendFuture callback getFuture ProducerImpl semaphore longer ProducerImpl sendAsync method blocked pendingMessages method deadlock ackReceived sendAsync deadlock pulsar pulsar jstack log broker jstack log persistent topic replication deadlock topic test stats check replicator replication client producer
8050	Replace map set PulsarClientImpl IdentityHashMap hold reference producers consumers producers producer List stored Pulsar pursues performance good thread safe set Collections newSetFromMap ConcurrentHashMap Replace map set load broker test update resource function doc report
8293	Race condition updating ManagedCursorImpl readPosition Describe bug caused race condition updating ManagedCursorImpl readPosition Reproduce concurrency issue hard reproduce isn publicly shared reproduce Expected behavior Updates ManagedCursorImpl readPosition field lead inconsistent clear understanding code concurrent updates handled Additional context refer additional context link Slack thread discussions prevents infinite loop doesn address race condition updating ManagedCursorImpl readPosition field issues race condition updating readPosition issue change adds READ POSITION UPDATER ManagedCursorImpl readPosition race condition ManagedCursorImpl readPosition sync OpReadEntry readPosition ManagedCursorImpl readPosition updated OpReadEntry created OpReadEntry readPosition initialized ManagedCursorImpl readPosition race condition happen code setAcknowledgePosition method pulsar managed ledger src main java org apache bookkeeper mledger impl ManagedCursorImpl java Lines fdd readPosition compareTo newMarkDeletePosition position mark deleted read position client skipped entries move read position PositionImpl oldReadPosition readPosition readPosition ledger getNextValidPosition newMarkDeletePosition log isDebugEnabled log debug Moved read position mark delete position ledger getName oldReadPosition readPosition markDeletePosition Clarification solution problem isn synchronization missing lock race condition resolved simply adding lock synchronization detect thread modified code conflict resolution readPosition updated setAcknowledgePosition method shouldn move readPosition code setReadPosition markDeletePosition account updating readPosition setAcknowledgePosition previous readPosition account updating readPosition doesn jump race condition Race condition updating ManagedCursorImpl readPosition test read entries cursor position ledger entry delete
9109	pulsar timer thread blocked redeliverUnacknowledgedMessages Describe bug broker crash restart consumers blocked consumer rateOut decrease auto recover restart consumer process Reproduce Steps reproduce behavior reproduce code PulsarConsumerTest Logger LOG LoggerFactory getLogger PulsarConsumerTest PulsarClient pulsarClient Consumer consumer setUp Exception pulsarClient PulsarClient builder serviceUrl pulsar broker build String topic persistent sample topic String subscriptionName test DeadLetterPolicy deadLetterPolicy DeadLetterPolicy builder deadLetterTopic String format DLQ topic subscriptionName maxRedeliverCount build consumer pulsarClient newConsumer topic topic deadLetterPolicy deadLetterPolicy ackTimeout TimeUnit SECONDS acknowledgmentGroupTime TimeUnit MILLISECONDS subscriptionName subscriptionName subscriptionType SubscriptionType Shared subscribe tearDown Exception pulsarClient close Test test PulsarClientException Message message consumer receive MessageId messageId message getMessageId LOG info received message messageId messageId consume message Exception LOG error consume message exception messageId messageId consume Message message IllegalStateException mock consume fails Send messages topic persistent sample topic Wait time redeliver kill restart broker process thread pulsar timer stack check blocked problem doesn step times Expected behavior thread pulsar timer blocked producer send method consumer receive blocked UnAckedMessageTracker add method acquire writeLock UnAckedMessageTracker pulsar timer prio prio tid efe nid waiting condition efe aec java lang Thread WAITING parking parking wait bbee java util concurrent CompletableFuture Signaller Locked ownable synchronizers dab java util concurrent locks ReentrantReadWriteLock NonfairSync Screenshots consumer thread blocked production Additional context Broker version pulsar client version pulsar timer thread blocked redeliverUnacknowledgedMessages test consumer messages executor topic producer service provider
10170	Optimize lock AuthenticationAthenz Describe bug lock AuthenticationAthenz reduce efficiency AuthenticationAthenz Hope optimized Error Medium Inconsistent synchronization org apache pulsar client impl AuthenticationAthenz roleToken locked time org apache pulsar client impl AuthenticationAthenz org apache pulsar client impl AuthenticationAthenz org apache pulsar client impl AuthenticationAthenz org apache pulsar client impl AuthenticationAthenz org apache pulsar client impl AuthenticationAthenz org apache pulsar client impl AuthenticationAthenz org apache pulsar client impl AuthenticationAthenz Unsynchronized access AuthenticationAthenz java Unsynchronized access AuthenticationAthenz java Unsynchronized access AuthenticationAthenz java access AuthenticationAthenz java access AuthenticationAthenz java access AuthenticationAthenz java access AuthenticationAthenz java INCONSISTENT SYNC Reproduce logs Expected behavior clear concise description expected happen Screenshots applicable add screenshots explain problem Desktop complete iOS Additional context Add context problem Optimize lock AuthenticationAthenz lock callback set test stat url key watch
10235	Deadlock Monitoring thread LeaderService isLeader Describe bug checking dashboards pulsar summary board brokers running kubernetes brokers running traced problems metrics queries returning wget http localhost metrics returning Gateway timeout checked logs errors logs exception occurred processing metrics query proceeded heap dumps stack traces java process continued process data queues Review stack traces prometheus stats thread hung waiting Lock held thread pulsar external listener thread waiting additional locks suspect deadlock condition find lock waiting problem scope executed becameInactive wide threaddump itomdipulsar broker log threaddump itomdipulsar broker gcs log threaddump itomdipulsar broker rglm log itomdipulsar broker log itomdipulsar broker gcs log itomdipulsar broker rglm log Deadlock Monitoring thread LeaderService isLeader stats drain check worker function schedule test backlog
10767	Java client Deadlock Pulsar Client running ConsumerBatchReceiveTest deadlock issue Pulsar Client master branch test stalled thread dump detected deadlock issue Java level deadlock pulsar timer waiting lock monitor fce object org apache pulsar client impl ConsumerImpl held pulsar client internal pulsar client internal waiting ownable synchronizer java util concurrent locks ReentrantReadWriteLock NonfairSync held pulsar timer Java stack threads listed pulsar timer waiting lock org apache pulsar client impl ConsumerImpl pulsar client internal jdk internal misc Unsafe park java base Method parking wait java util concurrent locks ReentrantReadWriteLock NonfairSync locked org apache pulsar client impl ConsumerImpl deadlock Full thread dump https gist github lhotari bbcc thread dump jstack review https jstack review https gist github lhotari bbcc tda dump test executing ConsumerBatchReceiveTest main prio prio cpu elapsed tid fce nid xca Object wait fce java lang Thread TIMED WAITING object monitor java lang Object wait java base Method waiting object reference waiting lock wait netty util concurrent FastThreadLocalThread Expected behavior Pulsar Client shouldn deadlock Java client Deadlock Pulsar Client running ConsumerBatchReceiveTest source config sink function instance keeper python code
11379	Directory facing race condition NarUnpacker Describe bug issue extension users create functions parallelism larger number functions worker directory race condition observed Exception thread main java lang reflect InvocationTargetException Caused java IOException Unable delete tmp pulsar nar pulsar java functions pojo parse SNAPSHOT jar unpacked META INF maven exception single node broker functions worker sample function parallelism exception unable delete tmp pulsar nar pulsar java functions pojo parse SNAPSHOT jar unpacked META INF maven deleted instance sample function exception raised attention lead Reproduce Steps reproduce behavior single node cluster https github streamnative charts created sample values file gist build sample function https github freeznet pulsar java functions pojo parse build mvn create function sample parallelism easier reproduce larger parallelism observe issue pulsar admin functions status instances running instances observe exception broker log race condition multiple threads delete file instances observe exception Extracted Pulsar Function jar file content tmp pulsar nar directory corrupted overridden content  race condition threads deleted extracted nar extracting thread extracting thread loading classes Directory facing race condition NarUnpacker message receive entry impl read time lookup async
11605	Race condition concurrent schema deletion Describe bug scenarios deleted topics concurrently trigger race condition deleting topic schema org apache pulsar broker service AbstractTopic deleteSchema firstly perform schemaRegistryService getSchema read bookkeeper schemaRegistryService deleteSchemaStorage delete ledgers bookkeeper delete schema concurrently threads happen thread deleted ledger thread started executing ledger exception Reproduce Steps reproduce behavior start cluster brokers create partitioned topic multiple partitions concurrently delete partitioned topics topic schema sporadically ledger exists Bookies NoNode schemas Note phenomenon happen time Expected behavior Broker service handle scenarios correctly Race condition concurrent schema deletion async set message namespace entries remove subscription messages
11689	Java consumer block batchReceive Describe bug Consumer batchReceive called concurrently threads exists race condition ConsumerBase java triggered CompletableFuture queue pendingBatchReceives removed queue completed causing consumer block issue concurrent calls peek poll peekNextBatchReceive code correct peeked polled thread calls poll peek poll bug occurs error message occurs Bug Removed entry wasn expected Reproduce Create consumer threads repeatedly call batchReceive Wait time eventually block Thread sleep peek poll peekNextBatchReceive trigger faster Expected behavior batchReceive block Java consumer block batchReceive message consumer topic async batch time messages partitions
11690	Flaky test LockManagerTest revalidateLockOnDifferentSession LockManagerTest flaky revalidateLockOnDifferentSession test method fails sporadically failure Error Tests Failures Errors Skipped Time elapsed FAILURE org apache pulsar metadata LockManagerTest Error revalidateLockOnDifferentSession org apache pulsar metadata LockManagerTest Time elapsed FAILURE java util NoSuchElementException Flaky test LockManagerTest revalidateLockOnDifferentSession test lock policy message endpoint constructor upload key
11966	Proxy Proxied admin endpoint connections remain blocked Describe bug Proxied admin endpoint connections remain blocked stacktrace pulsar external web prio prio cpu elapsed tid nid Object wait adef java lang Thread WAITING object monitor java lang Object wait java base Method waiting object reference waiting lock wait java util ArrayDeque Expected behavior timeout place prevents threads hang investigating issue code timeout isn set proxied requests call setTimeout method missing AdminProxyHandler base method overridden doesn set code base method sets timeout https github eclipse jetty project blob ecfa bef jetty proxy src main java org eclipse jetty proxy AbstractProxyServlet java observation code copy pasted Jetty code ServletConfig configuration values code cleanup Proxy Proxied admin endpoint connections remain blocked proxy cluster tls validate data namespace store admin
12723	Race condition PersistentTopic addReplicationCluster Describe bug org apache pulsar broker service persistent PersistentTopic field replicators ConcurrentOpenHashMap race condiftion method addReplicationCluster replicators computeIfAbsent remoteCluster PersistentReplicator PersistentTopic cursor localCluster remoteCluster brokerService PulsarClientImpl replicationClient PulsarServerException log error Replicator startup failed topic remoteCluster clean replicator startup failed replicators containsKey remoteCluster replicators remoteCluster replicators remove remoteCluster clear race condition multi threads code Thread execute replicators remove Thread inserts PersistentReplicator thread delete PersistentReplicator thread created thread safe measures applied code Expected behavior thead safe Screenshots applicable Desktop complete mac Additional context Nop Race condition PersistentTopic addReplicationCluster topic message test async receive entry impl tls
12885	Bug Unordered consuming Key Shared subscription Describe bug previous flaky test org apache pulsar client api KeySharedSubscriptionTest testRemoveFirstConsumer race condition PersistentDispatcherMultipleConsumers previous client closed unack messaages Detailed Explanation core steps produce messages wait unitl message create setting produce messages receive messages processing prefetched close Call receive receive chance race condition step step retry loop consumer Thread PersistentDispatcherMultipleConsumers readMoreEntries calculateToRead xxx getMessagesToReplayNow havePendingReplayRead asyncReplayEntriesInOrder cursor asyncReplayEntries callback readEntriesComplete async Thread PersistentDispatcherMultipleConsumers readEntriesComplete havePendingReplayRead PersistentStickyKeyDispatcherMultipleConsumers sendMessagesToConsumers DEBUG Log select consumer messages num read type Replay send runs permits DEBUG Log select consumer messages num read type Replay send wait complete unacked messages consumer send message schedule call readMoreEntries close PersistentDispatcherMultipleConsumers removeConsumer called Thread PersistentDispatcherMultipleConsumers removeConsumer consumer getPendingAcks forEach addMessageToReplay calls readMoreEntries Thread Thread real cases time Thread Thread small order Thread Thread Thread disorder occurs readMoreEntries calculateToRead havePendingReplayRead Thread readMoreEntries returns actions Thread previous reading ended dispatch select consumer waiting client Reproduce Steps reproduce behavior easier reproduce local environment changing pulsar pulsar broker src main java org apache pulsar broker service persistent PersistentStickyKeyDispatcherMultipleConsumers java TimeUnit MILLISECONDS Test org apache pulsar client api KeySharedSubscriptionTest testRemoveFirstConsumer hit race condition retries Expected behavior designed testRemoveFirstConsumer consuming order Screenshots Nop Desktop complete macOS Additional context Bug Unordered consuming Key Shared subscription ack message consumer messages batch set test key
12929	Deadlock internalDeleteSubscription metadata store callback thread Describe bug topic operations delete subscription result deadlock metadata store callback thread stack trace metadata store prio prio cpu elapsed tid ffc nid waiting condition java lang Thread WAITING parking jdk internal misc Unsafe park java base Method parking wait ffe java util concurrent CompletableFuture Signaller issue Reproduce race condition reliable reproduce easily reproducible inin node broker setup creating deleting topic consumers Expected behavior metadata store callback thread deadlock Screenshots applicable add screenshots explain problem Desktop complete iOS Additional context Add context problem Deadlock internalDeleteSubscription metadata store callback thread ledger position read entries cursor async check delete
13004	metadata Race condition ResourceLockImpl revalidate Describe bug Current unit test org apache pulsar metadata LockManagerTest updateValueWhenKeyDisappears small chance fails exception java util concurrent CompletionException org apache pulsar metadata api MetadataStoreException LockBusyException Resource path locked Caused org apache pulsar metadata api MetadataStoreException LockBusyException Resource path locked fails pulsar pulsar metadata src test java org apache pulsar metadata LockManagerTest java lock updateValue join digging race condition method org apache pulsar metadata coordination impl ResourceLockImpl revalidate Call stack store delete path Optional empty join Node Delete Event LockManagerImpl handleDataNotification ResourceLockImpl lockWasInvalidated ResourceLockImpl revalidate Call stack lock updateValue join org apache pulsar metadata coordination impl ResourceLockImpl acquire ResourceLockImpl acquireWithNoRevalidation fails LockBusyException ResourceLockImpl revalidate pulsar pulsar metadata src main java org apache pulsar metadata coordination impl ResourceLockImpl java revalidate newValue node deleted ResourceLockImpl revalidate called time fail lock updateValue failed Reproduce Steps reproduce behavior easier reproduce add delay MetadataStore DelayInjectionMetadataStore metadata add DelayInjectionMetadataStore  updateValueWhenKeyDisappears times error Expected behavior lock updateValue success Screenshots Desktop complete iOS Additional context metadata Race condition ResourceLockImpl revalidate entries position async read message ledger entry batch
13923	Proxy Race condition Pulsar Proxy UnsupportedOperationExceptions Proxy logs Describe bug common UnsupportedOperationExceptions Proxy logs issue reproduced Geo replication configured clusters pulsar proxy INFO org apache pulsar proxy server ProxyConnection connection opened pulsar proxy INFO org apache pulsar proxy server ProxyConnection complete connection init proxy handler authenticated token role superuser hasProxyToBrokerUrl pulsar proxy WARN netty channel DefaultChannelPipeline exceptionCaught event fired reached tail pipeline handler pipeline handle exception java lang UnsupportedOperationException netty netty transport jar nal netty netty transport jar nal netty netty transport jar Fina netty netty codec jar netty netty codec jar netty netty transport jar nal netty netty transport jar nal netty netty transport jar Fina netty netty handler jar netty netty handler jar netty netty handler jar netty netty codec jar netty netty codec jar netty netty codec jar netty netty transport jar nal netty netty transport jar nal netty netty transport jar Fina netty netty transport jar netty netty transport jar nal netty netty transport jar nal netty netty transport jar netty netty transport classes epoll jar netty netty transport classes epoll jar netty netty transport classes epoll jar netty netty common jar netty netty common jar netty netty common jar Reproduce Steps reproduce behavior Setup Pulsar clusters enable geo replication namespace shared clusters Create topic partitions replicated namespace Restart brokers cluster geo replication connections initialize untill reproduced issue Pulsar Proxy logs Expected behavior race conditions handled Pulsar Proxy Proxy Race condition Pulsar Proxy UnsupportedOperationExceptions Proxy logs proxy service channel client broker start command container
13964	Flaky tests PulsarClientImpl close hangs PulsarClientImpl close hangs ClientDeduplicationFailureTest shutdown failure main prio prio cpu elapsed tid nid waiting condition java lang Thread WAITING parking jdk internal misc Unsafe park java base Method parking wait dde java util concurrent CompletableFuture Signaller pulsar client shutdown threadawaiting notification pulsar client shutdown threadawaiting notification java lang Object wait java base Method deadlock Flaky tests PulsarClientImpl close hangs test message read partition topic consumer reader client
13986	Transactiion Performance bottleneck TransactionBufferHandler enhancement request problem describe synchronization lock timeout performance bottleneck TransactionBufferHandler Describe solution method timeout processing sync locks Transactiion Performance bottleneck TransactionBufferHandler handle command test topic resource request message schema
14362	Broker Healthcheck Endpoint Exposes Race Conditions Describe bug appears race conditions brokers health endpoint verified master issues exposed behavior stack traces call endpoint force fail chance NPE pulsar pulsar broker src main java org apache pulsar broker service persistent PersistentTopic java Lines removeSubscription String subscriptionName PersistentSubscription subscriptions remove subscriptionName preserve accumulative stats form removed subscription SubscriptionStatsImpl stats getStats bytesOutFromRemovedSubscriptions add stats bytesOutCounter msgOutFromRemovedSubscriptions add stats msgOutCounter relevant code called lock subscription remove wrong subscription method blocking pulsar thread obvious reason pulsar managed ledger src main java org apache bookkeeper mledger impl ManagedLedgerImpl java Lines deleteCursor String InterruptedException ManagedLedgerException CountDownLatch counter CountDownLatch Result ManagedLedgerException exception Result result Result asyncDeleteCursor DeleteCursorCallback Override deleteCursorComplete Object ctx counter countDown Override deleteCursorFailed ManagedLedgerException exception Object ctx result exception exception counter countDown counter await AsyncOperationTimeoutSeconds TimeUnit SECONDS ManagedLedgerException Timeout delete cursors operation result exception log error Deleting cursor result exception result exception obvious endpoint work concurrent calls start focusing calls Reproduce Steps reproduce behavior Deploy broker curl fail http localhost admin brokers health sleep curl fail http localhost admin brokers health Observer logs rerun step times race endpoint guaranteed trigger time stack trace pulsar web INFO org apache pulsar broker admin impl BrokersBase Running healthCheck topic persistent pulsar pulsar healthcheck pulsar INFO org apache pulsar client impl ProducerImpl persistent pulsar pulsar healthcheck Creating producer cnx pulsar INFO org apache pulsar broker service ServerCnx persistent pulsar pulsar healthcheck Creating producer producerId pulsar INFO org apache pulsar client impl ConsumerImpl persistent pulsar pulsar healthcheck reader dcd Subscribing topic cnx consumerId pulsar INFO org apache pulsar broker service ServerCnx Subscribing topic persistent pulsar pulsar healthcheck reader dcd BookKeeperClientWorker OrderedExecutor INFO org apache pulsar broker service ServerCnx Created producer Producer topic PersistentTopic topic persistent pulsar pulsar healthcheck
14413	ConsumerBuilderImpl subscribeAsync blocks calling thread Describe bug Retry topics enabled ConsumerBuilderImpl performs compatibility check DLQ Retry topics created previous version Pulsar naming scheme calling getPartitionedTopicMetadata block waiting client getPartitionedTopicMetadata oldRetryLetterTopic client conf getOperationTimeoutMs TimeUnit MILLISECONDS partitions retryLetterTopic oldRetryLetterTopic client getPartitionedTopicMetadata oldDeadLetterTopic client conf getOperationTimeoutMs TimeUnit MILLISECONDS partitions deadLetterTopic oldDeadLetterTopic implemented partial add Timeout implemented block calling thread lookup issue code attempt call subscribeAsync blocking Pool Netty signature subscribeAsync implies blocking pointless subscribeAsync blocks Note undocumented breaking change behavior safe call blocking pool running custom SLF log exporter thread pool deadlock number concurrent subscribeAsync calls exceeded pool size extreme poor decision good unexpected blocking dangerous Note blocking call retry DLQ names explicitly DeadLetterPolicy scenario check needed blocking calling Thread unneeded lookup requests Reproduce Call subscribeAsync enableRetry calling thread blocked metadata lookup complete Expected behavior subscribeAsync CompletableFuture performing Proposed Restructure subscribeAsync chain getPartitionedTopicMetadata calls blocking Don perform metadata lookup DLQ Retry topic names Add flag disable compatibility check projects don project maintainer happy proposal happy raise change ConsumerBuilderImpl subscribeAsync blocks calling thread message topic impl time consumer async executor producer
14438	internalDeleteTopicForcefully block pulsar pulsar broker src main java org apache pulsar broker admin impl PersistentTopicsBase java pulsar getBrokerService deleteTopic topicName toString deleteSchema pulsar web prio prio tid fcbf nid waiting condition fcabc java lang Thread WAITING parking parking wait java util concurrent CompletableFuture Signaller scene dump thread times wait internalDeleteTopicForcefully block decoder block column ledger row check entry type
14633	setupTopicPublishRateLimiterMonitor block causing deadlock metadata store operations Describe bug pulsar pulsar broker src main java org apache pulsar broker service BrokerService java setupTopicPublishRateLimiterMonitor block causing metadata operations deadlock metadata store prio prio cpu elapsed tid nid waiting monitor entry java lang Thread BLOCKED object monitor waiting lock org apache pulsar broker service BrokerService Reproduce reliable reproduce problem production deployment Expected behavior method block setupTopicPublishRateLimiterMonitor block causing deadlock metadata store operations ledger metadata transaction txn store update cursor block
17446	Bug Producer permanently blocked chunking messages blockIfQueueFull enabled Search searched issues Version Pulsar Minimal reproduce step reproduced simply Test testMiniChunkingBlockIfQueueFull Exception conf setMaxMessageSize String topicName persistent property testChunkingWithOrderingKey ExecutorService exec Executors newFixedThreadPool Cleanup Producer producer pulsarClient newProducer topic topicName enableChunking chunkMaxMessageSize blockIfQueueFull maxPendingMessages enableBatching create data RandomUtils nextBytes producer newMessage data send expect reason bug chunk message semaphore pulsar pulsar client src main java org apache pulsar client impl ProducerImpl java Lines cfa chunked message individually acquire send permits totalChunks canEnqueueRequest callback message getSequenceId memory reserved client getMemoryLimitController releaseMemory uncompressedSize semaphoreRelease large message split large number chunks message big chunkMaxMessageSize set small remaining semaphores acquired sending send sendAsync large message blocked blockIfQueueFull maxPendingMessages chunking enabled time risk deadlock exists number chunks single message large response submit submit Bug Producer permanently blocked chunking messages blockIfQueueFull enabled test message consumer topic producer set messages block
17913	Bug Deadlock reading Schema BookKeeper Search searched issues Version Minimal reproduce step combination facts stuck broker main client thread stuck main EventThread daemon prio prio cpu elapsed tid nid waiting condition java lang Thread WAITING parking jdk internal misc Unsafe park java base Method parking wait java util concurrent CompletableFuture Signaller expect broker works broker stuck consequence main problem PulsarRegistrationClient MetadataCache chance load blocking call https github datastax pulsar blob aececf apache pulsar metadata bookkeeper PulsarRegistrationClient java BookKeeper Registration Driver perform reads method https github datastax bookkeeper blob java org apache bookkeeper discover ZKRegistrationClient java submit submit Bug Deadlock reading Schema BookKeeper schema ledger cursor read entry delete type topic
18196	Bug locallyAcquiredLocks leak OwnershipCache Search searched issues Version master Minimal reproduce step review code expect CompletableFuture removeOwnership NamespaceBundle bundle ResourceLock NamespaceEphemeralData lock locallyAcquiredLocks bundle lock don bundle CompletableFuture completedFuture lock release locallyAcquiredLocks remove bundle leak response submit submit Bug locallyAcquiredLocks leak OwnershipCache namespace test bundle ownership service owned owner topic
18988	Bug Deadlock pulsar metadata store transactions enabled Search searched issues Version issue exists current master reproduce Minimal reproduce step reproduce programatically expect deadlock Metadata store stdout stdout stdout stdout stdout stdout stdout stdout stdout stdout stdout stdout stdout stdout stdout locked org apache pulsar broker transaction pendingack impl PendingAckHandleImpl stdout stdout stdout stdout stdout stdout stdout owned pulsar stdout metadata store BLOCKED lock org apache pulsar broker service persistent PersistentSubscription pulsar stdout stdout stdout stdout stdout stdout stdout stdout stdout stdout stdout stdout stdout stdout stdout stdout stdout stdout stdout stdout stdout stdout stdout stdout stdout locked org apache pulsar broker service persistent PersistentSubscription stdout stdout stdout stdout stdout stdout locked org apache pulsar broker service persistent PersistentSubscription stdout stdout stdout owned metadata store stdout pulsar BLOCKED lock org apache pulsar broker transaction pendingack impl PendingAckHandleImpl response submit submit Bug Deadlock pulsar metadata store transactions enabled metadata transaction skip partition async coordinator topic txn