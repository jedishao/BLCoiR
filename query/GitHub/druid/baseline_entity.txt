582	Race jar upload indexing solutions locking have job upload jars directory indexing JobHelper does something upload jar using create jar jar path is used druid jobs running cluster jobs start time find file does exist one overwrite cause AM fail hadoop AM is mtime jar files
812	RealtimePlumber Race server view callback merge push thread have realtime tasks node load segment pushed task A task B is performing merging segment case task B server view callback see loaded segment call abandonSegment unannounce segment delete files release locks indexing service are running indexing service cause havoc merge push thread is trying merge segment
1014	time node lead result result request regexp filter time node is ingesting increase kafka message send speed time query result be request regex filter request is type regex dimension sub5 pattern B type default columns dimension clicks direction DESCENDING limit result is version v1 timestamp Z clicks version v1 timestamp Z clicks sub5 BB1 solve problem druid be time system tested 0 6 121 1 0 6 160 Note did send value dimension queried result show value sub5 dimension query result disappear seems thread race condition leads error
1210	race condition coordinator coordniator node stopped responding did broker coordinator logs say Crazy race condition Druid logs coordinator INFO Master PeonExec LoggingEmitter Event feed alerts timestamp Z service coordinator host severity component failure description Crazy race condition LoadQueuePeon INFO CoordinatorLeader CuratorServiceAnnouncer Unannouncing service DruidNode serviceName coordinator host port INFO EventThread ConnectionStateManager State change RECONNECTED INFO SendThread ClientCnxn Session establishment server sessionid 0x24bde5fbb1f0007 negotiated timeout INFO SendThread ClientCnxn Socket connection established initiating session INFO SendThread ClientCnxn Opening socket connection server attempt authenticate using SASL error INFO CoordinatorLeader DruidCoordinator am leader INFO EventThread ConnectionStateManager State change SUSPENDED INFO SendThread ClientCnxn Client session timed have heard server 20008ms sessionid 0x24bde5fbb1f0007 closing socket connection attempting reconnect INFO Coordinator Exec LoggingEmitter Event feed metrics timestamp Z service coordinator host coordinator segment count value user1 d
1360	Race condition autoscaling terminates nodes were assigned tasks is indexing service auto scaling terminate nodes have been assigned task have updated task status running Autoscaling relies task status provided workers does take account tasks are known be running run given worker are checks task has been assigned worker announces task status worker is running tasks tasks get killed killed Running task replicas help situations indexing service was updated spawned middle managers are running anything is nodes be killed were run tasks
1715	Zombie tasks acquire locks failure are overlord Suffice say is running task acquires hr locks course execution had issue disconnect occurred overlord log task failed task was running mins task submitted lock acquire request was granted task had been failed was cleaned  102 INFO RemoteTaskRunner Scheduled RemoteTaskRunner Running scheduled cleanup Worker REDACTED  106 INFO RemoteTaskRunner Scheduled RemoteTaskRunner Failing task index_realtime_REDACTED  106 INFO RemoteTaskRunner Scheduled TaskQueue Received FAILED status task index_realtime_REDACTED  109 INFO RemoteTaskRunner Scheduled RemoteTaskRunner Ca shutdown worker running task index_realtime_REDACTED  132 INFO RemoteTaskRunner Scheduled TaskLockbox Removing task index_realtime_REDACTED TaskLock index_realtime_REDACTED  428 INFO qtpREDACTED TaskLockbox Added task index_realtime_REDACTED TaskLock index_realtime_REDACTED
2793	Duplicate errors cause TaskQueue lock be held way   introduced addition e4e5f03  diff e677e1ba7e3cf3b5b97660cfc17749beR144 causes errors entries be retried retry holds lock TaskQueue exhausts attempts causing backlog things wanting use lock TaskQueue  269 WARN qtp726762476 RetryUtils Failed try retrying ms  CallbackFailedException UnableToExecuteStatementException MySQLIntegrityConstraintViolationException Duplicate entry index_realtime_REDACTED_2016  04 05T20 00 0 PRIMARY statement INSERT REDACTED id created_date datasource payload status_payload VALUES id created_date datasource payload status_payload located INSERT REDACTED id created_date datasource payload status_payload VALUES id created_date datasource payload status_payload rewritten INSERT REDACTED id created_date datasource payload status_payload VALUES arguments named payload invoke0 Method
2842	NPE RTR threads task assignment threads task assignment causes NPE Seems have been introduced    335 ERROR rtr pending tasks runner RemoteTaskRunner Exception trying assign task RemoteTask NullPointerException task  336 ERROR rtr pending tasks runner RemoteTaskRunner Exception running pending tasks RemoteTaskRun NullPointerException taskRunnerWorkItem
2991	Race condition IncrementalIndex facts do need deal do find multi thread adds IncremetalIndex OnheapIncrementalIndex addToFacts get fact add mapping fact index do aggregate cause query saw metrics value cause situations use LongMax build use LongSum query result add LongMax value is LONG MIN_VALUE
3063	lookups tie query threads solutions requests need be blocking limit number druid listen v1 requests failing requests are X flight X seems 0 9 1 rc1 coordinator post druid listen v1 involves lookup be loaded cause request block lookup load times 10s coordinator time request issue one request thread is be request thread block trying acquire lock held request thread forward minutes jetty threads are blocked lookup related stuff queries be made Make druid listen v1 requests having insert queue do work work be done thread request thread have fail queue is block
3393	handle channel disconnected NettyHttpClient Druid  m facing race condition exception occurs hundreds times druid cluster is cluster is trace Broker runs query calls go DirectDruidClient httpClient is instance NettyHttpClient go method channel is taken pool verified shape fire query side reaches time disconnect channel channelDisconnected callback is called query is failed broker channel has chance connect get byte think go retry time get channel finish go set future fail thing happen NettyHttpClient channel write be closed server is taken pool channel be retried invoke Source Caused ExecutionException ChannelException Channel Caused ChannelException Channel
3459	Deadlock lookup cache Had issue query node ended reporting deadlock kill  3  m investigating intend make   avoids case Found Java level deadlock NamespaceExtractionCacheManager is held Z 2016 09 01T16 00 00 Z topN_REDACTED Z 2016 09 01T16 00 00 Z is held Z 2016 09 01T16 00 00 Z topN_REDACTED Z 2016 09 01T16 00 00 Z is held Z 2016 09 01T16 00 00 Z Java stack information threads listed NamespaceExtractionCacheManager topN_REDACTED Z 2016 09 01T16 00 00 Z topN_REDACTED Z 2016 09 01T16 00 00 Z Found deadlock waiting synchronizer 0x00000004c42eaba8 ReentrantLock waiting synchronizer 0x00000004c42eacc8 ReentrantLock waiting synchronizer 0x00000004c42eaba8 ReentrantLock parking wait ReentrantLock locked AtomicBoolean parking wait ReentrantLock locked Object parking wait ReentrantLock locked Object
3593	QTL Deadlock offheap cache NamespaceExtractionCacheManager is held qtp1930842682 qtp1930842682 is held NamespaceExtractionCacheManager Java stack information threads listed NamespaceExtractionCacheManager qtp1930842682 Found deadlock waiting synchronizer 0x00000004f0550030 ReentrantLock waiting lock monitor 0x00007fa3d4009bd8 object 0x00000004c38b04a8 AtomicBoolean parking wait ReentrantLock locked AtomicBoolean waiting lock AtomicBoolean
3600	race condition updating DataSource Metadata Kafka Indexing Service id index_kafka_v2_metrics_cluster_966f1c1b7a001cf_menkjigj status FAILED duration task log see was log have Kafka indexing service running replication task count equivalent number partitions tasks failed exception ISE Transaction failure publishing segments aborting  572 INFO task runner TaskRunnerUtils Task index_kafka_v2_metrics_cluster_966f1c1b7a001cf_menkjigj status changed FAILED  318 INFO task runner ChannelResourceFactory Generating  411 INFO task runner FiniteAppenderatorDriver Transaction failure publishing segments checking someone beat  422 INFO task runner ChannelResourceFactory Generating  513 WARN task runner FiniteAppenderatorDriver Our segments do exist giving  524 INFO task runner AppenderatorImpl Shutting  327 INFO qtp370356001 IndexerSQLMetadataStorageCoordinator Updated metadata KafkaDataSourceMetadata kafkaPartitions KafkaPartitions topic mx cluster production metrics partitionOffsetMap KafkaDataSourceMetadata kafkaPartitions KafkaPartitions topic mx cluster production metrics partitionOffsetMap  342 INFO qtp370356001 IndexerSQLMetadataStorageCoordinator Published segment v2_metrics_cluster_2016  10 19T06 Z_2016  10 19T07 Z_2016  10 19T06 Z_12 DB  357 INFO qtp370356001 IndexerSQLMetadataStorageCoordinator Published segment v2_metrics_cluster_2016  10 19T07 Z_2016  10 19T08 Z_2016  10 19T07 Z_7 DB  372 INFO qtp370356001 IndexerSQLMetadataStorageCoordinator Published segment v2_metrics_cluster_2016  10 19T08 Z_2016  10 19T09 Z_2016  10 19T08 Z_20 DB  387 INFO qtp370356001 IndexerSQLMetadataStorageCoordinator Published segment v2_metrics_cluster_2016  10 19T05 Z_2016  10 19T06 Z_2016  10 19T05 Z_33 DB  392 INFO qtp370356001 IndexerSQLMetadataStorageCoordinator Not updating metadata compare swap failure  085 INFO Curator PathChildrenCache RemoteTaskRunner Worker wrote FAILED status task index_kafka_v2_metrics_cluster_966f1c1b7a001cf_menkjigj TaskLocation host port  085 INFO Curator PathChildrenCache RemoteTaskRunner Worker completed task index_kafka_v2_metrics_cluster_966f1c1b7a001cf_menkjigj status FAILED  085 INFO Curator PathChildrenCache TaskQueue Received FAILED status task index_kafka_v2_metrics_cluster_966f1c1b7a001cf_menkjigj logs seems threads qtp370356001 wanted update datasource metadata threads read commit_metadata_payload DB qtp370356001 updated metadata qtp370356001 failed commit metadata read is commit metadata DB happens updateDataSourceMetadataWithHandle method java class
3608	IngestSegmentFirehoseFactory race tasks situation happen is  re reindexing datasource datasources reducing levels grain tasks proceed  s cross locking be downloading segments input datasource fix is having use task id need get plumbed has advantage putting task files using existing mechanisms cleaning task work directories IngestSegmentFirehoseFactory uses fixed task id reindex creating toolbox factory uses get segments creates race condition tasks download segment time directory get clobbered fail
3772	Race condition KafkaLookupExtractorFactory   comment  gvsmirnov creating issue order forget
4226	druid lookups cached race condition realtime node starts spawn realtime node tranquility storm takes bit load lookups aprox seconds time node published segment queries using lookups fail be seen log realtime task loads  s seconds  880 ERROR timeseries_stats Z 2017 04 28T08 00 25 Z ChainedExecutionQueryRunner Exception sequences NullPointerException Lookup advertiser_account_manager_id found run Source submit Source run Source runWorker Source run Source run Source  210 INFO NamespaceExtractionCacheManager JDBCExtractionNamespaceCacheFactory Finished loading values namespace namespace factory JDBCExtractionNamespace connectorConfig DbConnectorConfig createTables connectURI jdbc mysql user DefaultPasswordProvider table adserver_sf_backoffice_user_advertiser keyColumn id valueColumn acc_manager_id tsColumn pollPeriod PT5M cb7e90b1 cf67 495c 9ce7 0473aeb68c79
4296	HLL BufferUnderflowException querying realtime indexing tasks Query queryType timeseries dataSource memcached_v1 intervals  05 18T17 20Z  05 18T18 20Z granularity timeout aggregations name count type doubleSum fieldName count name requests type hyperUnique fieldName requests_hll name unique_keys type hyperUnique fieldName name T_0 type doubleSum fieldName duration postAggregations type arithmetic fn fields type fieldAccess fieldName count type hyperUniqueCardinality fieldName requests name type arithmetic fn fields type fieldAccess fieldName T_0 type value name duration Stacktrace middleManger configuration is fix  ve found is set have issues leads think am running race condition described linked issue ends corrupting HLL segment Setting processing threads is like efficiency having indexing thread query thread task tried upgrading cluster 0 10 0 ran issue context  m running indexing realtime tasks middleManagers have events pushed applications using tranquility run timeseries queries intervals are being indexed indexing node queries return data time run queries begin receiving BufferUnderflowException errors peon nodes is query stack trace pulled peon task logs  439 ERROR processing ChainedExecutionQueryRunner Exception sequences BufferUnderflowException  441 WARN qtp1259065345 timeseries_memcached_v1_858753f9 49f0 4fa6  9916 f60f48a42ad9 QueryResource Exception occurred request TimeseriesQuery dataSource memcached_v1 querySegmentSpec MultipleSpecificSegmentSpec descriptors SegmentDescriptor interval Z 2017 05 18T18 20 00 Z version 2017 05 18T18 15 04 Z partitionNumber descending dimFilter granularity AllGranularity aggregatorSpecs DoubleSumAggregatorFactory fieldName count name count HyperUniquesAggregatorFactory name requests fieldName requests_hll HyperUniquesAggregatorFactory name unique_keys fieldName DoubleSumAggregatorFactory fieldName duration name T_0 postAggregatorSpecs ArithmeticPostAggregator name fnName fields FieldAccessPostAggregator name fieldName count HyperUniqueFinalizingPostAggregator 7d250277 op DIV ArithmeticPostAggregator name duration fnName fields FieldAccessPostAggregator name fieldName T_0 ConstantPostAggregator name constantValue op DIV context finalize queryId 49f0 4fa6  9916 f60f48a42ad9 timeout BufferUnderflowException capacity baseTaskDir mnt druid task restoreTasksOnRestart numThreads sizeBytes locations path mnt druid segment_cache javaOpts server Xmx3221225472 XX UseG1GC XX MaxGCPauseMillis numThreads
4984	race start cachingCost balancer discovered trying test cachingCost balancer cluster has number segments found missed initialization callback happened refused create cc  dgolitsyn  leventov CachingCostBalancerStrategyFactory registers callbacks start method is callbacks happen start ServerInventoryView BalancerStrategyFactory be missed Inventory view callbacks be registered constructors start methods
5338	bug HttpPostEmitter causing CPU usage upgrading 0 11 0 deployments are facing CPU usage issue taking thread dump was suspicion emitter thread be causing Thread state IN_JAVA verify issue added executor DruidCoordinator class keeps emitting events while loop is happening happening deployments be concurrency issue  leventov Event  bci line Compiled frame information be Event  bci line Compiled frame Event  bci line Compiled frame Event  bci line Compiled frame ServiceEventBuilder  bci line Compiled frame found time tryAddEvents method return reference concurrentBatch changes while loop keeps spinning sending anything creating batch
6020	Race taskMaster overlord becomes leader Optional getTaskRunner TaskMaster has interfaces return variables taskRunner taskQueue are initialized overlord becomes leader code interfaces is taskRunner is initialized becomeLeader is called overlord becomes leader throws NPE stack trace is follows NullPointerException invoke0 Method
6028	Error SqlMetadataRuleManagerTest Lock ROW SYSCOLUMNS Waiting XID X APP DROP TABLE druidTestc0dd9b47c4df453daeba2aca4613783e_rules Lock TABLE DRUIDTESTC0DD9B47C4DF453DAEBA2ACA4613783E_RULES Tablelock selected victim is XID statement DROP TABLE druidTestc0dd9b47c4df453daeba2aca4613783e_rules located DROP TABLE druidTestc0dd9b47c4df453daeba2aca4613783e_rules rewritten DROP TABLE druidTestc0dd9b47c4df453daeba2aca4613783e_rules arguments named finder Lock ROW SYSCOLUMNS Waiting XID X APP DROP TABLE druidTestc0dd9b47c4df453daeba2aca4613783e_rules Lock TABLE DRUIDTESTC0DD9B47C4DF453DAEBA2ACA4613783E_RULES Tablelock selected victim is XID statement DROP TABLE druidTestc0dd9b47c4df453daeba2aca4613783e_rules located DROP TABLE druidTestc0dd9b47c4df453daeba2aca4613783e_rules rewritten DROP TABLE druidTestc0dd9b47c4df453daeba2aca4613783e_rules arguments named finder lock be obtained deadlock cycle locks waiters is Lock ROW SYSCOLUMNS Waiting XID X APP DROP TABLE druidTestc0dd9b47c4df453daeba2aca4613783e_rules Lock TABLE DRUIDTESTC0DD9B47C4DF453DAEBA2ACA4613783E_RULES Tablelock selected victim is XID lock be obtained deadlock cycle locks waiters is Lock ROW SYSCOLUMNS Waiting XID X APP DROP TABLE druidTestc0dd9b47c4df453daeba2aca4613783e_rules Lock TABLE DRUIDTESTC0DD9B47C4DF453DAEBA2ACA4613783E_RULES Tablelock selected victim is XID Tests run Failures Errors Skipped Time elapsed sec FAILURE SQLMetadataRuleManagerTest SQLMetadataRuleManagerTest Time elapsed sec ERROR CallbackFailedException UnableToExecuteStatementException SQLTransactionRollbackException lock be obtained deadlock cycle locks waiters is Waiting XID IS APP SELECT dataSource payload druidTestc0dd9b47c4df453daeba2aca4613783e_rules r JOIN SELECT dataSource max version version druidTestc0dd9b47c4df453daeba2aca4613783e_rules GROUP dataSource ds datasource datasource version version Caused UnableToExecuteStatementException SQLTransactionRollbackException lock be obtained deadlock cycle locks waiters is Waiting XID IS APP SELECT dataSource payload druidTestc0dd9b47c4df453daeba2aca4613783e_rules r JOIN SELECT dataSource max version version druidTestc0dd9b47c4df453daeba2aca4613783e_rules GROUP dataSource ds datasource datasource version version Caused SQLTransactionRollbackException Waiting XID IS APP SELECT dataSource payload druidTestc0dd9b47c4df453daeba2aca4613783e_rules r JOIN SELECT dataSource max version version druidTestc0dd9b47c4df453daeba2aca4613783e_rules GROUP dataSource ds datasource datasource version version Caused StandardException Waiting XID IS APP SELECT dataSource payload druidTestc0dd9b47c4df453daeba2aca4613783e_rules r JOIN SELECT dataSource max version version druidTestc0dd9b47c4df453daeba2aca4613783e_rules GROUP dataSource ds datasource datasource version version
6139	Race testCheckpointForUnknownTaskGroup KafkaSupervisorTest stacktrace is corresponding code is ISE WTH find taskGroup taskGroups issue is getStackTrace return check is called test wait stacktrace be set
6201	Deadlock overlord HttpRemoteTaskRunner noticed deadlocks overlord test cluster HttpRemoteTaskRunner hrtr pending tasks runner   daemon prio os_prio tid nid waiting monitor entry 0x00007fc5644b4000 HttpRemoteTaskRunner worker sync   daemon prio os_prio tid nid waiting monitor entry 0x00007fc569801000 State BLOCKED object monitor waiting lock Object State BLOCKED object monitor waiting lock Object State BLOCKED object monitor waiting lock LifecycleLock locked ConcurrentHashMap locked ConcurrentHashMap State BLOCKED object monitor waiting lock Object locked LifecycleLock
6287	Race condition Kafka Indexing Service verifyAndMergeCheckpoints KafkaSupervisor has issue have been completed results are used sort o1 o2 firstKey
6826	gianm Concurrency bug refreshSegmentsForDataSource segmentMap is created lock time SegmentMetadataHolder holder get segment segment be removed cause NPE
6867	deadlock found DruidStatement found deadlock DruidStatement DruidConnection cause exhaust connections Found Java level deadlock DruidMeta 4e50ae56 ScheduledExecutor is held qtp1871838170 qtp1871838170 is held DruidMeta 4e50ae56 ScheduledExecutor Java stack information threads listed DruidMeta 4e50ae56 ScheduledExecutor qtp1871838170 Found Java level deadlock qtp1871838170 is held qtp1871838170 qtp1871838170 is held qtp1871838170 Java stack information threads listed qtp1871838170 qtp1871838170 waiting lock monitor 0x00007fa5084802b8 object 0x00000000d6389830 Object waiting lock monitor 0x00007fa5084916b8 object 0x00000000d603e4b8 HashMap waiting lock Object locked HashMap waiting lock HashMap locked Object locked Object waiting lock monitor 0x00007fa50b53c918 object 0x00000007712471d8 Object waiting lock monitor 0x00007fa508d0ae68 object 0x00000007766ce418 HashMap waiting lock Object locked HashMap waiting lock HashMap locked Object locked Object
7400	Allow users use provider metadata username Description Motivation use PasswordProvider provide credentials connecting metadata store hardcoding need hardcode username need restart Druid want change username like be change user Druid uses interact metadata database needing restart Druid do need be change user property operation way change password Druid is running case like be use provider furnish user name password implementation avoid introducing race condition   users wanted use providers username password build PasswordProvider yoked PasswordProviders provide field
8622	Proposal concept supervisor type task slots resolving task deadlocks Motivation is discussed   comment Proposed changes Http RemoteTaskRunner code be updated recognize supervisor tasks consume slot supervisorCapacity capacity Rationale alternative is use   send supervisor tasks set middleManagers get supervisor tasks impact Test plan run staging cluster work reliability supervisor tasks be treated be imposing restriction failing middleManager running crashed ParallelIndexSupervisorTask is supervisor style task delegates work spawned subtasks supervisor task subtasks are using task slot pool is possibility deadlock example say druid cluster has task slots ParallelIndexSupervisorTask tasks are submitted started running task slots Subtasks spawned supervisor tasks be run supervisor tasks keep waiting Add method isSupervisor Task interface returns task is supervisor task spawns subtasks delegate work ParallelIndexSupervisorTask return task impls return Add supervisorCapacity configuration middleManagers designates slots run supervisor tasks config is capacity designates task slots User ParallelIndexSupervisorTask need set property supervisorCapacity middleManagers
9292	rules does need store ConcurrentHashMap CoordinatorRuleManager did have race condition   ConcurrentHashMap is modified assigning AtomicReference fix was action is replace ConcurrentHashMap HashMap
10005	API verify published segments are loaded datasource Description differences API existing coordinator loadstatus API Takes datasource required be check iterate number segments Takes interval be check iterate number segments API Path druid coordinator v1 datasources dataSourceName loadstatus Request  GET  Path dataSourceName loadstatus Response getDatasourceLoadstatus  PathParam dataSourceName String dataSourceName  QueryParam interval String interval  QueryParam forceMetadataRefresh forceMetadataRefresh  QueryParam  Nullabl String  QueryParam  Nullabl String Response Default given Returns percentage segments loaded cluster segments be loaded cluster given datasource given interval weeks given value response is percentage    GIVEN_DATASOURCE  value response is number segments    GIVEN_DATASOURCE  value response is number segments    GIVEN_DATASOURCE  interval be default weeks forceMetadataRefresh be default Motivation is address   workflow be submit ingestion task poll task api task succeeded API be use verify published segments are loaded datasource API be do following api takes datasource returns used segment past weeks given datasource are be query e loaded Return api takes datasource time interval start end returns used segment segment given start given end time given datasource are be query e loaded Return Note are API time interval is parameter time interval referred is timestamp data segment nothing do segment is ingested be time interval time interval user want query data user wants query x y call api datasource time interval x y ensure segments datasource timestamp x y is be query loaded Takes forceMetadataRefresh is force poll metadata source get published segment information APPLICATION_JSON class Returns number segments left load segments be loaded cluster are queries does include replication Returns number segments left load tier segments be loaded cluster are includes replication existing loadstatus API Coordinator reads segments SqlSegmentsMetadataManager Coordinator caches segments memory updates be race condition API implementation compares segments metadata mentioned cache published segments is ingestion load datasource cache contains metadata segments API compares list segments is published returns everything is segments are poll api datasource interval forceMetadataRefresh go step data is user query poll api datasource interval forceMetadataRefresh return data is user query