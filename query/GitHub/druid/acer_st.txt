582	Race jar upload hadoop indexing Hadoop indexing druid indexer JobHelper exists jar upload jar create workingPath classpath jarName jar jar path druid jobs running cluster jobs start time find file doesn exist overwrite fail hadoop pretty mtime jar files solutions locking job upload jars separate directory Race jar upload hadoop indexing path hadoop file segment loader extension input zip
812	RealtimePlumber Race server view callback merge push thread redundant realtime tasks historical node load segment pushed task task performing merging segment task server view callback loaded segment call abandonSegment unannounce segment delete local files release locks indexing service running indexing service havoc merge push thread merge segment RealtimePlumber Race server view callback merge push thread segment server persist callback add inventory cache row
1014	real time node lead wrong result empty result request regexp filter real time node ingesting kafka msg increase kafka message send speed gradually real time query result wrong request regex filter request filter type regex dimension pattern orderBy type columns dimension clicks direction DESCENDING limit result version timestamp event clicks version timestamp event clicks Note send empty dimension queried result dimension query empty result disappear thread race condition leads error solve problem druid real time system tested real time node lead wrong result empty result request regexp filter real time node ingesting kafka msg node segment server test sync lookups config key
1210	race condition coordinator coordniator node stopped responding broker coordinator logs Crazy race condition Druid logs coordinator INFO Master PeonExec metamx emitter core LoggingEmitter Event feed alerts timestamp service coordinator host severity component failure description Crazy race condition server druidprod base loadQueue data druid server coordinator LoadQueuePeon ERROR Master PeonExec druid server coordinator LoadQueuePeon Crazy race condition server druidprod base loadQueue druid server coordinator LoadQueuePeon INFO CoordinatorLeader druid curator discovery CuratorServiceAnnouncer Unannouncing service DruidNode serviceName coordinator host port INFO main EventThread org apache curator framework ConnectionStateManager change RECONNECTED INFO main SendThread org apache zookeeper ClientCnxn Session establishment complete server sessionid bde fbb negotiated timeout INFO main SendThread org apache zookeeper ClientCnxn Socket connection established initiating session INFO main SendThread org apache zookeeper ClientCnxn Opening socket connection server attempt authenticate SASL unknown error INFO CoordinatorLeader druid server coordinator DruidCoordinator longer leader INFO main EventThread org apache curator framework ConnectionStateManager change SUSPENDED INFO main SendThread org apache zookeeper ClientCnxn Client session timed heard server sessionid bde fbb closing socket connection attempting reconnect INFO Coordinator Exec metamx emitter core LoggingEmitter Event feed metrics timestamp service coordinator host metric coordinator segment count user race condition coordinator segment callback segments config node condition joinable coordinator
1360	Race condition autoscaling terminates nodes assigned tasks indexing service auto scaling terminate nodes assigned task updated task status running Autoscaling relies task status workers account tasks running worker unlucky autoscaling checks task assigned worker announces task status worker running tasks tasks killed Running task replicas situations indexing service updated spawned middle managers running multiple nodes killed tasks Race condition autoscaling terminates nodes assigned tasks task worker workers tasks running config list pending
1715	Zombie tasks acquire locks failure issue disconnect occurred overlord log task failed task running mins task submitted lock acquire request granted task failed properly cleaned overlord INFO RemoteTaskRunner Scheduled Cleanup druid indexing overlord RemoteTaskRunner Running scheduled cleanup Worker REDACTED INFO RemoteTaskRunner Scheduled Cleanup druid indexing overlord RemoteTaskRunner Failing task realtime REDACTED INFO RemoteTaskRunner Scheduled Cleanup druid indexing overlord TaskQueue Received FAILED status task realtime REDACTED INFO RemoteTaskRunner Scheduled Cleanup druid indexing overlord RemoteTaskRunner shutdown worker running task realtime REDACTED INFO RemoteTaskRunner Scheduled Cleanup druid indexing overlord MetadataTaskStorage Updating task realtime REDACTED status TaskStatus realtime REDACTED status FAILED duration INFO RemoteTaskRunner Scheduled Cleanup druid indexing overlord TaskLockbox Removing task realtime REDACTED TaskLock realtime REDACTED INFO qtpREDACTED druid indexing common actions LocalTaskActionClient Performing action task realtime REDACTED LockAcquireAction interval INFO qtpREDACTED druid indexing overlord TaskLockbox Created TaskLockPosse TaskLockPosse taskLock TaskLock groupId realtime REDACTED dataSource REDACTED interval version taskIds INFO qtpREDACTED druid indexing overlord TaskLockbox task realtime REDACTED TaskLock realtime REDACTED Suffice running task acquires multiple locks execution Zombie tasks acquire locks failure task lock segment test interval type segments time
2793	withHandle SQLMetadataStorageActionHandler SQLMetadataConnector 2 retryWithHandle Handle MetadataTaskStorage RetryUtils SQLMetadataConnector DBI TaskQueue OverlordResource 1 MySQLIntegrityConstraintViolationException UnableToExecuteStatementException CallbackFailedException Duplicate primary key errors cause TaskQueue big lock to be held for way longer than it should
2842	run RemoteTaskRunner 3 RemoteTaskRunner checkNotNull access 1400 ThreadPoolExecutor Worker tryAssignTask ThreadPoolExecutor Task call Preconditions NullPointerException Exception NPE in RTR with multiple threads for task assignment
2991	Race condition IncrementalIndex facts OnheapIncrementalIndex addToFacts fact add mapping key fact aggregate query unaggregated metrics initial weird situations LongMax build LongSum query result add LongMax initial MIN BTW deal Integer prev facts putIfAbsent key rowIndex prev numEntries incrementAndGet lost race aggs concurrentGet prev Free misfire concurrentRemove rowIndex expected occur time worst scenarios don find multi thread adds IncremetalIndex Race condition IncrementalIndex facts row test column time dimension segment metric joinable
3063	Unloadable lookups tie query threads coordinator post druid listen involves lookup loaded request block lookup load times coordinator time request issue original request thread active totally request thread block acquire lock held request thread Fast minutes jetty threads blocked lookup stuff queries solutions druid listen requests nonblocking insert queue work work thread request thread fail queue full block full requests blocking limit number concurrent druid listen requests failing requests flight reasonable Unloadable lookups tie query threads lookup query segment time report factory server node
3393	DirectDruidClient JsonParserIterator MergeSequence 2 BaseSequence toYielder YieldingAccumulators 1 MappedSequence init accumulate Sequence hasNext makeYielder ExecutionException Exception ChannelException should handle channel disconnected better in NettyHttpClient or Druid
3459	park parkAndCheckInterrupt AbstractQueuedSynchronizer ReentrantLock NonfairSync LockSupport OffHeapNamespaceExtractionCacheManager NamespaceExtractionCacheManager 2 NamespaceExtractionCacheManager 4 swapAndClearCache acquireQueued ReentrantLock Deadlock in global lookup cache
3593	park parkAndCheckInterrupt AbstractQueuedSynchronizer ReentrantLock NonfairSync LockSupport OffHeapNamespaceExtractionCacheManager NamespaceExtractionCacheManager 2 NamespaceExtractionCacheManager 4 swapAndClearCache acquireQueued ReentrantLock QTL  Deadlock in offheap cache
3600	ThreadPoolTaskRunner ThreadPoolTaskRunnerCallable run KafkaIndexTask ThreadPoolExecutor Worker ThreadPoolExecutor Task Thread FutureTask call runWorker Pool RuntimeException Possible race condition while updating DataSource Metadata  Kafka Indexing Service
3608	IngestSegmentFirehoseFactory race tasks IngestSegmentFirehoseFactory fixed task reindex creating toolbox factory segments creates race condition tasks download segment time directory clobbered fail situation happen easily reindexing datasource datasources reducing levels grain tasks proceed simultaneously cross locking downloading segments input datasource real task plumbed advantage putting task files existing mechanisms cleaning task work directories IngestSegmentFirehoseFactory race tasks task segment worker segments input test lock time
3772	Race condition KafkaLookupExtractorFactory comment FYI gvsmirnov creating issue order forget Race condition KafkaLookupExtractorFactory test config joinable condition segment key fails lookup
4226	checkNotNull IncrementalIndexStorageAdapter CursorAndEntryHolderValueMatcherFactory RegisteredLookupExtractionFn Preconditions StringDimensionIndexer InFilter 2 1 check ensureDelegate apply makeIndexingValueMatcher Matcher NullPointerException Exception druid lookups cached global race condition when realtime node starts
4296	DirectByteBuffer Buffer TimeseriesQueryEngine 1 HyperLogLogCollector QueryRunnerHelper 1 HyperUniquesAggregator nextGetIndex getShort apply MappingAccumulator Direct BufferUnderflowException Exception HLL BufferUnderflowException querying realtime indexing tasks
4984	Callback race start cachingCost balancer CachingCostBalancerStrategyFactory registers callbacks start method problematic callbacks happen start ServerInventoryView BalancerStrategyFactory missed Inventory view callbacks generally registered constructors start methods discovered test cachingCost balancer cluster small number segments missed initialization callback happened fast refused create dgolitsyn leventov Callback race start cachingCost balancer segment server callback segments load set executor request
5338	Potential bug HttpPostEmitter causing high CPU usage upgrading deployments facing high CPU usage issue thread dump suspicion emitter thread causing Thread JAVA metamx emitter core HttpPostEmitter emitAndReturnBatch metamx emitter core Event bci Compiled frame imprecise metamx emitter core HttpPostEmitter emit metamx emitter core Event bci Compiled frame metamx emitter core ComposingEmitter emit metamx emitter core Event bci Compiled frame metamx emitter service ServiceEmitter emit metamx emitter core Event bci Compiled frame metamx emitter service ServiceEmitter emit metamx emitter service ServiceEventBuilder bci Compiled frame verify issue executor DruidCoordinator emitting events loop emitter emit ServiceMetricEvent builder setDimension dataSource build test time batch tryAddEvents method reference concurrentBatch loop spinning sending creating batch happening happening deployments concurrency issue leventov Potential bug HttpPostEmitter causing high CPU usage emitter test http set size event flush emit
6020	checkNotNull JavaMethodInvokerFactory 1 Preconditions AbstractResourceMethodDispatchProvider ResponseOutInvoker check getTaskRunner NativeMethodAccessorImpl TaskMaster invoke DelegatingMethodAccessorImpl Method NullPointerException Race in taskMaster when the overlord becomes the leader
6028	SQLMetadataRuleManagerTest dropTable cleanup drop Table Test SQLMetadata Rule Manager StandardException SQLTransactionRollbackException Error UnableToExecuteStatementException CallbackFailedException Error in SqlMetadataRuleManagerTest
6139	KafkaSupervisor CheckpointNotice isValidTaskGroup Executors RunnableAdapter KafkaSupervisor 2 run ThreadPoolExecutor Worker ThreadPoolExecutor FutureTask Task Kafka Supervisor Race in testCheckpointForUnknownTaskGroup  of KafkaSupervisorTest
6201	HttpRemoteTaskRunner Lambda 133 748833484 lambda addPendingTaskToExecutor 7 HttpRemoteTaskRunner run Task TaskQueue ThreadPoolExecutor Worker ThreadPoolExecutor access 000 runTaskOnWorker getKnownTasks Deadlock on overlord with HttpRemoteTaskRunner
6287	Race condition Kafka Indexing Service verifyAndMergeCheckpoints KafkaSupervisor issue Futures addCallback completed taskSequences sort rhs firstKey compareTo rhs firstKey Race condition Kafka Indexing Service task require partition druid config record service sequence
6826	Concurrency bug DruidSchema refreshSegmentsForDataSource segmentMap created lock time SegmentMetadataHolder holder dataSourceSegments segment segment removed NPE FYI surekhasaharan gianm Concurrency bug DruidSchema refreshSegmentsForDataSource segment server inventory path data druid schema test
6867	DruidMeta Lambda 90 10531789 ScheduledThreadPoolExecutor ScheduledFutureTask lambda getDruidConnection 0 Executors RunnableAdapter Druid DruidMeta close run DruidStatement DruidConnection closeConnection deadlock found in DruidStatement
7400	users provider metadata username Description PasswordProvider provide credentials connecting metadata store hardcoding hardcode username restart Druid change username Motivation change user Druid interact metadata database needing restart Druid change druid metadata storage connector user property operation change druid metadata storage connector password Druid running specific single provider furnish user password implementation avoid introducing race condition users wanted separate providers username password build PasswordProvider yoked PasswordProviders provide field users provider metadata username user role group update key authenticator authorizer credentials
8622	Proposal concept supervisor type task slots resolving parallel task deadlocks Motivation ParallelIndexSupervisorTask supervisor style task delegates work spawned subtasks supervisor task subtasks task slot pool possibility deadlock druid cluster task slots ParallelIndexSupervisorTask tasks submitted simultaneously started running task slots Subtasks spawned supervisor tasks supervisor tasks waiting discussed comment Proposed Add method Task isSupervisor Task returns task supervisor task spawns subtasks delegate work ParallelIndexSupervisorTask current task impls Add druid worker supervisorCapacity configuration middleManagers designates slots supervisor tasks config druid worker capacity designates supervisor task slots Http RemoteTaskRunner code updated recognize supervisor tasks consume slot supervisorCapacity capacity Rationale potential alternative send supervisor tasks dedicated set middleManagers supervisor tasks Operational impact User ParallelIndexSupervisorTask set property druid worker supervisorCapacity middleManagers Test plan optional staging cluster work optional reliability supervisor tasks treated specially imposing restartable restriction failing middleManager running crashed Proposal concept supervisor type task slots resolving parallel task deadlocks task compaction worker segment partition num config spec
9292	CoordinatorRuleManager rules doesn store ConcurrentHashMap CoordinatorRuleManager didn race condition prior ConcurrentHashMap modified assigning AtomicReference proper proper action replace ConcurrentHashMap simple HashMap CoordinatorRuleManager rules doesn store ConcurrentHashMap rule rules datasource broker test metadata opt data
10005	API verify published segments loaded datasource Description API verify published segments loaded datasource API api takes datasource returns segment weeks datasource query loaded historical api takes datasource time interval start returns segment start time datasource query loaded historical Note API time interval optional parameter time interval referred timestamp data segment segment ingested time interval time interval user query data Basically user query call api datasource time interval ensure segments datasource timestamp ready query loaded historical differences API existing coordinator loadstatus API Takes datasource required check faster iterate smaller number segments Takes interval optional check faster iterate smaller number segments Takes forceMetadataRefresh force poll metadata source latest published segment API Path druid coordinator datasources dataSourceName loadstatus Request Path dataSourceName loadstatus Produces MediaType APPLICATION JSON ResourceFilters DatasourceResourceFilter Response getDatasourceLoadstatus PathParam dataSourceName String dataSourceName QueryParam interval Nullable String interval QueryParam forceMetadataRefresh Nullable forceMetadataRefresh QueryParam simple Nullabl String simple QueryParam full Nullabl String full Response simple full Returns percentage segments loaded cluster segments loaded cluster datasource interval weeks response percentage DATASOURCE Simple Returns number segments left load segments loaded cluster queries include replication response number segments DATASOURCE full Returns number segments left load tier segments loaded cluster includes replication response number segments tier DATASOURCE interval weeks forceMetadataRefresh Motivation address existing loadstatus API Coordinator reads segments SqlSegmentsMetadataManager Coordinator caches segments memory periodically updates race condition API implementation compares segments metadata mentioned cache published segments historical ingestion initial load datasource cache metadata segments API compares list segments published historical returns segments workflow submit ingestion task poll task api task succeeded poll api datasource interval forceMetadataRefresh step data user query poll api datasource interval forceMetadataRefresh data user query API verify published segments loaded datasource test segment segments task data unused interval metadata