582	Race jar upload hadoop indexing Hadoop indexing druid indexer JobHelper exists jar upload jar create workingPath classpath jarName jar jar path druid jobs running cluster jobs start time find file doesn exist overwrite fail hadoop pretty mtime jar files solutions locking job upload jars separate directory Race jar upload hadoop indexing path hadoop file segment loader extension input zip
812	RealtimePlumber Race server view callback merge push thread redundant realtime tasks historical node load segment pushed task task performing merging segment task server view callback loaded segment call abandonSegment unannounce segment delete local files release locks indexing service running indexing service havoc merge push thread merge segment RealtimePlumber Race server view callback merge push thread segment server persist callback add inventory cache row
1014	real time node lead wrong result empty result request regexp filter real time node ingesting kafka msg increase kafka message send speed gradually real time query result wrong request regex filter request filter type regex dimension pattern orderBy type columns dimension clicks direction DESCENDING limit result version timestamp event clicks version timestamp event clicks Note send empty dimension queried result dimension query empty result disappear thread race condition leads error solve problem druid real time system tested real time node lead wrong result empty result request regexp filter real time node ingesting kafka msg node segment server test sync lookups config key
1210	race condition coordinator coordniator node stopped responding broker coordinator logs Crazy race condition Druid logs coordinator INFO Master PeonExec metamx emitter core LoggingEmitter Event feed alerts timestamp service coordinator host severity component failure description Crazy race condition server druidprod base loadQueue data druid server coordinator LoadQueuePeon ERROR Master PeonExec druid server coordinator LoadQueuePeon Crazy race condition server druidprod base loadQueue druid server coordinator LoadQueuePeon INFO CoordinatorLeader druid curator discovery CuratorServiceAnnouncer Unannouncing service DruidNode serviceName coordinator host port INFO main EventThread org apache curator framework ConnectionStateManager change RECONNECTED INFO main SendThread org apache zookeeper ClientCnxn Session establishment complete server sessionid bde fbb negotiated timeout INFO main SendThread org apache zookeeper ClientCnxn Socket connection established initiating session INFO main SendThread org apache zookeeper ClientCnxn Opening socket connection server attempt authenticate SASL unknown error INFO CoordinatorLeader druid server coordinator DruidCoordinator longer leader INFO main EventThread org apache curator framework ConnectionStateManager change SUSPENDED INFO main SendThread org apache zookeeper ClientCnxn Client session timed heard server sessionid bde fbb closing socket connection attempting reconnect INFO Coordinator Exec metamx emitter core LoggingEmitter Event feed metrics timestamp service coordinator host metric coordinator segment count user race condition coordinator segment callback segments config node condition joinable coordinator
1360	Race condition autoscaling terminates nodes assigned tasks indexing service auto scaling terminate nodes assigned task updated task status running Autoscaling relies task status workers account tasks running worker unlucky autoscaling checks task assigned worker announces task status worker running tasks tasks killed Running task replicas situations indexing service updated spawned middle managers running multiple nodes killed tasks Race condition autoscaling terminates nodes assigned tasks task worker workers tasks running config list pending
1715	Zombie tasks acquire locks failure issue disconnect occurred overlord log task failed task running mins task submitted lock acquire request granted task failed properly cleaned overlord INFO RemoteTaskRunner Scheduled Cleanup druid indexing overlord RemoteTaskRunner Running scheduled cleanup Worker REDACTED INFO RemoteTaskRunner Scheduled Cleanup druid indexing overlord RemoteTaskRunner Failing task realtime REDACTED INFO RemoteTaskRunner Scheduled Cleanup druid indexing overlord TaskQueue Received FAILED status task realtime REDACTED INFO RemoteTaskRunner Scheduled Cleanup druid indexing overlord RemoteTaskRunner shutdown worker running task realtime REDACTED INFO RemoteTaskRunner Scheduled Cleanup druid indexing overlord MetadataTaskStorage Updating task realtime REDACTED status TaskStatus realtime REDACTED status FAILED duration INFO RemoteTaskRunner Scheduled Cleanup druid indexing overlord TaskLockbox Removing task realtime REDACTED TaskLock realtime REDACTED INFO qtpREDACTED druid indexing common actions LocalTaskActionClient Performing action task realtime REDACTED LockAcquireAction interval INFO qtpREDACTED druid indexing overlord TaskLockbox Created TaskLockPosse TaskLockPosse taskLock TaskLock groupId realtime REDACTED dataSource REDACTED interval version taskIds INFO qtpREDACTED druid indexing overlord TaskLockbox task realtime REDACTED TaskLock realtime REDACTED Suffice running task acquires multiple locks execution Zombie tasks acquire locks failure task lock segment test interval type segments time
2793	Duplicate primary key errors TaskQueue big lock held longer introduced addition diff cfc beR errors duplicate primary key entries retried WARN qtp metamx common RetryUtils Failed retrying org skife jdbi exceptions CallbackFailedException org skife jdbi exceptions UnableToExecuteStatementException mysql jdbc exceptions jdbc MySQLIntegrityConstraintViolationException Duplicate entry realtime REDACTED key PRIMARY statement INSERT REDACTED created datasource payload active status payload VALUES created datasource payload active status payload located INSERT REDACTED created datasource payload active status payload VALUES created datasource payload active status payload rewritten INSERT REDACTED created datasource payload active status payload VALUES arguments positional named payload druid selfcontained mmx jar mmx druid selfcontained mmx jar mmx druid selfcontained mmx jar mmx druid selfcontained mmx jar mmx druid selfcontained mmx jar mmx druid selfcontained mmx jar mmx druid selfcontained mmx jar mmx druid selfcontained mmx jar mmx druid selfcontained mmx jar mmx druid selfcontained mmx jar mmx druid selfcontained mmx jar mmx druid selfcontained mmx jar mmx druid selfcontained mmx jar mmx druid selfcontained mmx jar mmx druid selfcontained mmx jar mmx druid selfcontained mmx jar mmx druid selfcontained mmx jar mmx druid selfcontained mmx jar mmx druid selfcontained mmx jar mmx druid selfcontained mmx jar mmx druid selfcontained mmx jar mmx druid selfcontained mmx jar mmx druid selfcontained mmx jar mmx druid selfcontained mmx jar mmx druid selfcontained mmx jar mmx druid selfcontained mmx jar mmx druid selfcontained mmx jar mmx druid selfcontained mmx jar mmx druid selfcontained mmx jar mmx druid selfcontained mmx jar mmx druid selfcontained mmx jar mmx druid selfcontained mmx jar mmx druid selfcontained mmx jar mmx druid selfcontained mmx jar mmx druid selfcontained mmx jar mmx druid selfcontained mmx jar mmx druid selfcontained mmx jar mmx druid selfcontained mmx jar mmx druid selfcontained mmx jar mmx retry holds big lock TaskQueue exhausts attempts causing big backlog wanting big lock TaskQueue Duplicate primary key errors TaskQueue big lock held longer task segment table key create lock config type
2842	NPE RTR multiple threads task assignment Multiple threads task assignment NPE introduced ERROR rtr pending tasks runner druid indexing overlord RemoteTaskRunner Exception assign task druid indexing overlord RemoteTask Runner exceptionType java lang NullPointerException exceptionMessage task taskId TASKID java lang NullPointerException task druid selfcontained aaf jar aaf druid selfcontained aaf jar aaf druid selfcontained aaf jar aaf druid selfcontained aaf jar aaf druid selfcontained aaf jar aaf ERROR rtr pending tasks runner druid indexing overlord RemoteTaskRunner Exception running pending tasks druid indexing overlord RemoteTaskRun ner exceptionType java lang NullPointerException exceptionMessage taskRunnerWorkItem java lang NullPointerException taskRunnerWorkItem druid selfcontained aaf jar aaf druid selfcontained aaf jar aaf druid selfcontained aaf jar aaf druid selfcontained aaf jar aaf druid selfcontained aaf jar aaf NPE RTR multiple threads task assignment task worker sequence time record runner start workers
2991	Race condition IncrementalIndex facts OnheapIncrementalIndex addToFacts fact add mapping key fact aggregate query unaggregated metrics initial weird situations LongMax build LongSum query result add LongMax initial MIN BTW deal Integer prev facts putIfAbsent key rowIndex prev numEntries incrementAndGet lost race aggs concurrentGet prev Free misfire concurrentRemove rowIndex expected occur time worst scenarios don find multi thread adds IncremetalIndex Race condition IncrementalIndex facts row test column time dimension segment metric joinable
3063	Unloadable lookups tie query threads coordinator post druid listen involves lookup loaded request block lookup load times coordinator time request issue original request thread active totally request thread block acquire lock held request thread Fast minutes jetty threads blocked lookup stuff queries solutions druid listen requests nonblocking insert queue work work thread request thread fail queue full block full requests blocking limit number concurrent druid listen requests failing requests flight reasonable Unloadable lookups tie query threads lookup query segment time report factory server node
3393	handle channel disconnected NettyHttpClient Druid facing race condition Broker runs query calls httpClient DirectDruidClient httpClient instance NettyHttpClient NettyHttpClient method channel pool verified good shape ready fire query historical side reaches idle time disconnect channel handler channelDisconnected callback called query failed broker exception occurs hundreds times druid cluster busy cluster channel chance connect historical single NettyHttpClient retry internally time channel finish set retVal fail happen channel write httpRequest addListener NettyHttpClient channel write closed historical server pool channel retried trace ERROR qtp timeseries eternal olap click eec druid server QueryResource Exception handling request druid server QueryResource exceptionType metamx common exceptionMessage Failure http hdppic tbsite net druid org jboss netty channel ChannelException Channel disconnected exception metamx common Failure http hdppic tbsite net druid org jboss netty channel ChannelException Channel disconnected query TimeseriesQuery dataSource eternal olap click querySegmentSpec LegacySegmentSpec intervals descending dimFilter scene tag sort type coefp src taobao topic item exper token str topic sort action type click granularity PeriodGranularity period timeZone origin aggregatorSpecs DoubleSumAggregatorFactory fieldName ipv ipv postAggregatorSpecs context queryId eec timeout peer metamx common Failure http hdppic tbsite net druid org jboss netty channel ChannelException Channel disconnected druid server jar druid server jar java util jar java util jar java util jar java util jar java util jar java util jar java util jar java util jar java util jar java util jar java util jar druid processing jar druid common jar java util jar druid processing jar java util jar druid server jar jersey server jar jersey server jar jersey server jar jersey server jar jersey server jar jersey server jar jersey server jar jersey server jar jersey server jar jersey server jar jersey server jar jersey server jar jersey server jar jersey server jar jersey server jar jersey servlet jar jersey servlet jar jersey servlet jar javax servlet api jar guice servlet beta jar guice servlet beta jar guice servlet beta jar guice servlet beta jar guice servlet beta jar guice servlet beta jar guice servlet beta jar guice servlet beta jar guice servlet beta jar guice servlet beta jar jetty servlet jar jetty servlets jar jetty servlet jar jetty servlet jar jetty server jar jetty server jar jetty servlet jar jetty server jar jetty server jar jetty server jar jetty server jar jetty server jar jetty server jar jetty server jar jetty server jar jetty util jar jetty util jar jetty util jar jetty util jar Caused java util concurrent ExecutionException org jboss netty channel ChannelException Channel disconnected guava jar guava jar guava jar druid server jar Caused org jboss netty channel ChannelException Channel disconnected http client jar netty jar netty jar netty jar netty jar netty jar netty jar netty jar netty jar netty jar netty jar netty jar netty jar netty jar netty jar netty jar netty jar netty jar netty jar netty jar netty jar netty jar netty jar netty jar netty jar netty jar netty jar handle channel disconnected NettyHttpClient Druid segment metadata data segments coordinator read type handle
3459	Deadlock global lookup cache issue query node ended reporting deadlock kill investigating intend avoids Java level deadlock NamespaceExtractionCacheManager waiting ownable synchronizer eaba java util concurrent locks ReentrantLock NonfairSync held topN REDACTED topN REDACTED waiting ownable synchronizer eacc java util concurrent locks ReentrantLock NonfairSync held topN REDACTED topN REDACTED waiting ownable synchronizer eaba java util concurrent locks ReentrantLock NonfairSync held topN REDACTED Java stack threads listed NamespaceExtractionCacheManager parking wait eaba java util concurrent locks ReentrantLock NonfairSync locked java util concurrent atomic AtomicBoolean topN REDACTED parking wait eacc java util concurrent locks ReentrantLock NonfairSync locked java lang Object topN REDACTED parking wait eaba java util concurrent locks ReentrantLock NonfairSync locked java lang Object deadlock Deadlock global lookup cache cache lookup key count callable shape runtime entry
3593	QTL Deadlock offheap cache NamespaceExtractionCacheManager waiting ownable synchronizer java util concurrent locks ReentrantLock NonfairSync held qtp qtp waiting lock monitor object java util concurrent atomic AtomicBoolean held NamespaceExtractionCacheManager Java stack threads listed NamespaceExtractionCacheManager parking wait java util concurrent locks ReentrantLock NonfairSync locked java util concurrent atomic AtomicBoolean qtp waiting lock java util concurrent atomic AtomicBoolean deadlock QTL Deadlock offheap cache cache test hash metric buffer callable loading map
3600	race condition updating DataSource Metadata Kafka Indexing Service Kafka indexing service running replication task count equivalent number kafka partitions tasks failed exception metamx common ISE Transaction failure publishing segments aborting druid kafka indexing service jar druid indexing service jar druid indexing service jar INFO task runner priority druid indexing overlord TaskRunnerUtils Task kafka metrics cluster menkjigj status changed FAILED INFO task runner priority druid indexing worker executor ExecutorLifecycle Task completed status kafka metrics cluster menkjigj status FAILED duration Earlier task log INFO task runner priority druid indexing common actions RemoteTaskActionClient Submitting action task kafka metrics cluster menkjigj overlord druid indexer action SegmentInsertAction segments DataSegment size shardSpec NumberedShardSpec partitionNum partitions metrics dimensions version loadSpec type hdfs path interval dataSource metrics cluster binaryVersion DataSegment size shardSpec NumberedShardSpec partitionNum partitions metrics dimensions version loadSpec type hdfs path interval dataSource metrics cluster binaryVersion DataSegment size shardSpec NumberedShardSpec partitionNum partitions metrics dimensions version loadSpec type hdfs path interval dataSource metrics cluster binaryVersion DataSegment size shardSpec NumberedShardSpec partitionNum partitions metrics dimensions version loadSpec type hdfs path interval dataSource metrics cluster binaryVersion startMetadata KafkaDataSourceMetadata kafkaPartitions KafkaPartitions topic cluster production metrics partitionOffsetMap endMetadata KafkaDataSourceMetadata kafkaPartitions KafkaPartitions topic cluster production metrics partitionOffsetMap INFO task runner priority metamx http client pool ChannelResourceFactory Generating INFO task runner priority druid segment realtime appenderator FiniteAppenderatorDriver Transaction failure publishing segments checking beat INFO task runner priority druid indexing common actions RemoteTaskActionClient Performing action task kafka metrics cluster menkjigj SegmentListUsedAction dataSource metrics cluster intervals INFO task runner priority druid indexing common actions RemoteTaskActionClient Submitting action task kafka metrics cluster menkjigj overlord druid indexer action SegmentListUsedAction dataSource metrics cluster intervals INFO task runner priority metamx http client pool ChannelResourceFactory Generating WARN task runner priority druid segment realtime appenderator FiniteAppenderatorDriver segments don exist INFO task runner priority druid segment realtime appenderator AppenderatorImpl Shutting overlord log INFO qtp druid indexing common actions LocalTaskActionClient Performing action task kafka metrics cluster ddb opnaifmo SegmentInsertAction segments DataSegment size shardSpec NumberedShardSpec partitionNum partitions metrics dimensions version loadSpec type hdfs path interval dataSource metrics cluster binaryVersion DataSegment size shardSpec NumberedShardSpec partitionNum partitions metrics dimensions version loadSpec type hdfs path interval dataSource metrics cluster binaryVersion DataSegment size shardSpec NumberedShardSpec partitionNum partitions metrics dimensions version loadSpec type hdfs path interval dataSource metrics cluster binaryVersion DataSegment size shardSpec NumberedShardSpec partitionNum partitions metrics dimensions version loadSpec type hdfs path interval dataSource metrics cluster binaryVersion startMetadata KafkaDataSourceMetadata kafkaPartitions KafkaPartitions topic cluster production metrics partitionOffsetMap endMetadata KafkaDataSourceMetadata kafkaPartitions KafkaPartitions topic cluster production metrics partitionOffsetMap INFO qtp druid indexing common actions LocalTaskActionClient Performing action task kafka metrics cluster menkjigj SegmentInsertAction segments DataSegment size shardSpec NumberedShardSpec partitionNum partitions metrics dimensions version loadSpec type hdfs path interval dataSource metrics cluster binaryVersion DataSegment size shardSpec NumberedShardSpec partitionNum partitions metrics dimensions version loadSpec type hdfs path interval dataSource metrics cluster binaryVersion DataSegment size shardSpec NumberedShardSpec partitionNum partitions metrics dimensions version loadSpec type hdfs path interval dataSource metrics cluster binaryVersion DataSegment size shardSpec NumberedShardSpec partitionNum partitions metrics dimensions version loadSpec type hdfs path interval dataSource metrics cluster binaryVersion startMetadata KafkaDataSourceMetadata kafkaPartitions KafkaPartitions topic cluster production metrics partitionOffsetMap endMetadata KafkaDataSourceMetadata kafkaPartitions KafkaPartitions topic cluster production metrics partitionOffsetMap INFO qtp druid metadata IndexerSQLMetadataStorageCoordinator Updated metadata KafkaDataSourceMetadata kafkaPartitions KafkaPartitions topic cluster production metrics partitionOffsetMap KafkaDataSourceMetadata kafkaPartitions KafkaPartitions topic cluster production metrics partitionOffsetMap INFO qtp druid metadata IndexerSQLMetadataStorageCoordinator Published segment metrics cluster INFO qtp druid metadata IndexerSQLMetadataStorageCoordinator Published segment metrics cluster INFO qtp druid metadata IndexerSQLMetadataStorageCoordinator Published segment metrics cluster INFO qtp druid metadata IndexerSQLMetadataStorageCoordinator Published segment metrics cluster INFO qtp druid metadata IndexerSQLMetadataStorageCoordinator updating metadata compare swap failure INFO qtp druid indexing common actions LocalTaskActionClient Performing action task kafka metrics cluster menkjigj SegmentListUsedAction dataSource metrics cluster intervals INFO Curator PathChildrenCache druid indexing overlord RemoteTaskRunner Worker wrote FAILED status task kafka metrics cluster menkjigj TaskLocation host port INFO Curator PathChildrenCache druid indexing overlord RemoteTaskRunner Worker completed task kafka metrics cluster menkjigj status FAILED INFO Curator PathChildrenCache druid indexing overlord TaskQueue Received FAILED status task kafka metrics cluster menkjigj logs threads qtp qtp wanted update datasource metadata Initially threads read commit metadata payload qtp updated metadata qtp failed commit metadata read earlier commit metadata updateDataSourceMetadataWithHandle method IndexerSQLMetadataStorageCoordinator java solve issue synchronize access updateDataSourceMetadataWithHandle method retry failures retryTransaction retry RuntimeException thrown https github druid druid blob master server src main java druid metadata IndexerSQLMetadataStorageCoordinator java race condition updating DataSource Metadata Kafka Indexing Service task metadata partition segment sequence partitions data segments
3608	IngestSegmentFirehoseFactory race tasks IngestSegmentFirehoseFactory fixed task reindex creating toolbox factory segments creates race condition tasks download segment time directory clobbered fail situation happen easily reindexing datasource datasources reducing levels grain tasks proceed simultaneously cross locking downloading segments input datasource real task plumbed advantage putting task files existing mechanisms cleaning task work directories IngestSegmentFirehoseFactory race tasks task segment worker segments input test lock time
3772	Race condition KafkaLookupExtractorFactory comment FYI gvsmirnov creating issue order forget Race condition KafkaLookupExtractorFactory test config joinable condition segment key fails lookup
4226	druid lookups cached global race condition realtime node starts spawn realtime node tranquility storm takes bit load lookups aprox seconds time node published segment queries lookups fail log realtime task ERROR timeseries stats druid query ChainedExecutionQueryRunner Exception sequences java lang NullPointerException Lookup advertiser account manager guava jar druid processing jar druid processing jar druid processing jar druid processing jar druid processing jar druid processing jar druid processing jar druid processing jar druid processing jar druid processing jar druid processing jar druid processing jar druid processing jar java util jar java util jar java util jar java util jar java util jar java util jar java util jar druid processing jar druid processing jar guava jar guava jar druid processing jar druid processing jar guava jar guava jar guava jar guava jar guava jar druid processing jar java util jar druid processing jar druid processing jar druid processing jar java util jar druid processing jar druid processing jar druid processing jar druid processing jar druid processing jar java util jar druid processing jar druid processing jar druid processing jar loads seconds late INFO NamespaceExtractionCacheManager druid server lookup namespace JDBCExtractionNamespaceCacheFactory Finished loading values namespace namespace factory JDBCExtractionNamespace connectorConfig DbConnectorConfig createTables connectURI jdbc mysql user passwordProvider druid metadata DefaultPasswordProvider table adserver backoffice user advertiser keyColumn valueColumn acc manager tsColumn pollPeriod aeb druid lookups cached global race condition realtime node starts node segment server lookups lookup callback config coordinator
4296	HLL BufferUnderflowException querying realtime indexing tasks posted druid user google group https groups google forum topic druid user sEX decided post actual issue issue running release downloaded http druid artifacts releases druid bin tar context running indexing realtime tasks middleManagers events pushed applications tranquility timeseries queries intervals indexed indexing node queries initially data time repeatedly queries eventually receiving BufferUnderflowException errors peon nodes relevant query stack trace pulled peon task logs Query queryType timeseries dataSource memcached intervals granularity context timeout aggregations count type doubleSum fieldName count requests type hyperUnique fieldName requests hll unique type hyperUnique fieldName unique hll type doubleSum fieldName duration postAggregations type arithmetic fields type fieldAccess fieldName count type hyperUniqueCardinality fieldName requests avg count request type arithmetic fields type fieldAccess fieldName type constant duration Stacktrace ERROR processing druid query ChainedExecutionQueryRunner Exception sequences java nio BufferUnderflowException druid processing jar druid processing jar druid processing jar druid processing jar druid processing jar druid processing jar java util jar java util jar java util jar java util jar java util jar java util jar java util jar java util jar java util jar java util jar java util jar druid processing jar druid processing jar guava jar guava jar druid processing jar druid processing jar guava jar guava jar guava jar guava jar guava jar druid processing jar java util jar druid processing jar druid processing jar druid processing jar java util jar druid processing jar druid processing jar druid processing jar druid processing jar druid processing jar java util jar druid processing jar druid processing jar druid processing jar WARN qtp timeseries memcached druid server QueryResource Exception occurred request TimeseriesQuery dataSource memcached querySegmentSpec MultipleSpecificSegmentSpec descriptors SegmentDescriptor interval version partitionNumber descending dimFilter granularity AllGranularity aggregatorSpecs DoubleSumAggregatorFactory fieldName count count HyperUniquesAggregatorFactory requests fieldName requests hll HyperUniquesAggregatorFactory unique fieldName unique hll DoubleSumAggregatorFactory fieldName duration postAggregatorSpecs ArithmeticPostAggregator avg count request fnName fields FieldAccessPostAggregator fieldName count druid query aggregation hyperloglog HyperUniqueFinalizingPostAggregator DIV ArithmeticPostAggregator duration fnName fields FieldAccessPostAggregator fieldName ConstantPostAggregator constantValue DIV context finalize queryId timeout java nio BufferUnderflowException druid processing jar druid processing jar druid processing jar druid processing jar druid processing jar druid processing jar java util jar java util jar java util jar java util jar java util jar java util jar java util jar java util jar java util jar java util jar java util jar druid processing jar druid processing jar guava jar guava jar druid processing jar druid processing jar guava jar guava jar guava jar guava jar guava jar druid processing jar java util jar druid processing jar druid processing jar druid processing jar java util jar druid processing jar druid processing jar druid processing jar druid processing jar druid processing jar java util jar druid processing jar druid processing jar druid processing jar middleManger configuration druid worker capacity druid indexer task baseTaskDir mnt druid task druid indexer task restoreTasksOnRestart druid indexer fork property druid processing numThreads druid indexer fork property druid processing buffer sizeBytes druid segmentCache locations path mnt druid segment cache maxSize druid indexer runner javaOpts server Xmx UseG MaxGCPauseMillis set druid indexer fork property druid processing numThreads longer issues leads running race condition linked issue ends corrupting HLL segment Setting processing threads ideal efficiency indexing thread query thread task upgrading cluster issue HLL BufferUnderflowException querying realtime indexing tasks task query segment server appenderator runner time expected
4984	Callback race start cachingCost balancer CachingCostBalancerStrategyFactory registers callbacks start method problematic callbacks happen start ServerInventoryView BalancerStrategyFactory missed Inventory view callbacks generally registered constructors start methods discovered test cachingCost balancer cluster small number segments missed initialization callback happened fast refused create dgolitsyn leventov Callback race start cachingCost balancer segment server callback segments load set executor request
5338	Potential bug HttpPostEmitter causing high CPU usage upgrading deployments facing high CPU usage issue thread dump suspicion emitter thread causing Thread JAVA metamx emitter core HttpPostEmitter emitAndReturnBatch metamx emitter core Event bci Compiled frame imprecise metamx emitter core HttpPostEmitter emit metamx emitter core Event bci Compiled frame metamx emitter core ComposingEmitter emit metamx emitter core Event bci Compiled frame metamx emitter service ServiceEmitter emit metamx emitter core Event bci Compiled frame metamx emitter service ServiceEmitter emit metamx emitter service ServiceEventBuilder bci Compiled frame verify issue executor DruidCoordinator emitting events loop emitter emit ServiceMetricEvent builder setDimension dataSource build test time batch tryAddEvents method reference concurrentBatch loop spinning sending creating batch happening happening deployments concurrency issue leventov Potential bug HttpPostEmitter causing high CPU usage emitter test http set size event flush emit
6020	Race taskMaster overlord leader TaskMaster interfaces variables taskRunner taskQueue initialized overlord leader code interfaces Optional TaskRunner getTaskRunner overlordLeaderSelector isLeader Optional taskRunner Optional absent taskRunner initialized DruidLeaderSelector Listener becomeLeader called overlord leader Optional NPE full stack trace java lang NullPointerException guava jar guava jar druid indexing service iap jar iap druid indexing service iap jar iap jersey server jar jersey server jar jersey server jar jersey server jar jersey server jar jersey server jar jersey server jar jersey server jar jersey server jar jersey server jar jersey server jar jersey server jar jersey servlet jar jersey servlet jar jersey servlet jar javax servlet api jar guice servlet jar guice servlet jar guice servlet jar guice servlet jar guice servlet jar guice servlet jar guice servlet jar jetty servlet jar druid server iap jar iap jetty servlet jar druid server iap jar iap jetty servlet jar druid server iap jar iap jetty servlet jar imply druid security jar druid server iap jar iap jetty servlet jar druid basic security iap jar iap druid server iap jar iap jetty servlet jar druid server iap jar iap jetty servlet jar jetty servlet jar jetty server jar jetty server jar jetty servlet jar jetty server jar jetty server jar jetty server jar jetty server jar jetty server jar jetty server jar jetty server jar jetty server jar jetty server jar jetty jar jetty jar jetty jar jetty jar jetty jar jetty jar jetty util jar jetty util jar jetty util jar jetty util jar jetty util jar Race taskMaster overlord leader task leader redirect client overlord node service config
6028	Error SqlMetadataRuleManagerTest Tests Failures Errors Skipped Time elapsed FAILURE druid metadata SQLMetadataRuleManagerTest testMultipleStopAndStart druid metadata SQLMetadataRuleManagerTest Time elapsed ERROR org skife jdbi exceptions CallbackFailedException org skife jdbi exceptions UnableToExecuteStatementException java sql SQLTransactionRollbackException lock deadlock cycle locks waiters Lock ROW SYSCOLUMNS Waiting XID APP DROP TABLE druidTestc daeba aca rules Granted XID Lock TABLE DRUIDTESTC DAEBA ACA RULES Tablelock Waiting XID APP SELECT dataSource payload druidTestc daeba aca rules JOIN SELECT dataSource max version version druidTestc daeba aca rules GROUP dataSource datasource datasource version version Granted XID selected victim XID statement DROP TABLE druidTestc daeba aca rules located DROP TABLE druidTestc daeba aca rules rewritten DROP TABLE druidTestc daeba aca rules arguments positional named finder Caused org skife jdbi exceptions UnableToExecuteStatementException java sql SQLTransactionRollbackException lock deadlock cycle locks waiters Lock ROW SYSCOLUMNS Waiting XID APP DROP TABLE druidTestc daeba aca rules Granted XID Lock TABLE DRUIDTESTC DAEBA ACA RULES Tablelock Waiting XID APP SELECT dataSource payload druidTestc daeba aca rules JOIN SELECT dataSource max version version druidTestc daeba aca rules GROUP dataSource datasource datasource version version Granted XID selected victim XID statement DROP TABLE druidTestc daeba aca rules located DROP TABLE druidTestc daeba aca rules rewritten DROP TABLE druidTestc daeba aca rules arguments positional named finder Caused java sql SQLTransactionRollbackException lock deadlock cycle locks waiters Lock ROW SYSCOLUMNS Waiting XID APP DROP TABLE druidTestc daeba aca rules Granted XID Lock TABLE DRUIDTESTC DAEBA ACA RULES Tablelock Waiting XID APP SELECT dataSource payload druidTestc daeba aca rules JOIN SELECT dataSource max version version druidTestc daeba aca rules GROUP dataSource datasource datasource version version Granted XID selected victim XID Caused org apache derby iapi error StandardException lock deadlock cycle locks waiters Lock ROW SYSCOLUMNS Waiting XID APP DROP TABLE druidTestc daeba aca rules Granted XID Lock TABLE DRUIDTESTC DAEBA ACA RULES Tablelock Waiting XID APP SELECT dataSource payload druidTestc daeba aca rules JOIN SELECT dataSource max version version druidTestc daeba aca rules GROUP dataSource datasource datasource version version Granted XID selected victim XID Error SqlMetadataRuleManagerTest error exception test rows response transform task handler
6139	Race testCheckpointForUnknownTaskGroup KafkaSupervisorTest stacktrace ERROR KafkaSupervisor testDS druid indexing kafka supervisor KafkaSupervisor KafkaSupervisor testDS failed handle notice druid indexing kafka supervisor KafkaSupervisor exceptionType druid java util common ISE exceptionMessage WTH find taskGroup taskGroups noticeClass CheckpointNotice druid java util common ISE WTH find taskGroup taskGroups classes classes classes code assertNotNull serviceEmitter getStackTrace issue serviceEmitter getStackTrace check called test wait stacktrace set Race testCheckpointForUnknownTaskGroup KafkaSupervisorTest segment cache callback config segments task path server
6201	Deadlock overlord HttpRemoteTaskRunner noticed deadlocks overlord test cluster HttpRemoteTaskRunner hrtr pending tasks runner daemon prio prio tid nid waiting monitor entry java lang Thread BLOCKED object monitor waiting lock java lang Object java lang Thread BLOCKED object monitor waiting lock java lang Object HttpRemoteTaskRunner worker sync daemon prio prio tid nid waiting monitor entry java lang Thread BLOCKED object monitor waiting lock druid concurrent LifecycleLock locked java util concurrent ConcurrentHashMap locked java util concurrent ConcurrentHashMap java lang Thread BLOCKED object monitor waiting lock java lang Object locked druid concurrent LifecycleLock Deadlock overlord HttpRemoteTaskRunner task worker test tasks workers runner coordinator leader
6287	Race condition Kafka Indexing Service verifyAndMergeCheckpoints KafkaSupervisor issue Futures addCallback completed taskSequences sort rhs firstKey compareTo rhs firstKey Race condition Kafka Indexing Service task require partition druid config record service sequence
6826	Concurrency bug DruidSchema refreshSegmentsForDataSource segmentMap created lock time SegmentMetadataHolder holder dataSourceSegments segment segment removed NPE FYI surekhasaharan gianm Concurrency bug DruidSchema refreshSegmentsForDataSource segment server inventory path data druid schema test
6867	deadlock DruidStatement deadlock DruidStatement DruidConnection exhaust connections Java level deadlock DruidMeta ScheduledExecutor waiting lock monitor object java lang Object held qtp qtp waiting lock monitor object java util HashMap held DruidMeta ScheduledExecutor Java stack threads listed DruidMeta ScheduledExecutor waiting lock java lang Object locked java util HashMap qtp waiting lock java util HashMap locked java lang Object locked java lang Object Java level deadlock qtp waiting lock monitor object java lang Object held qtp qtp waiting lock monitor object java util HashMap held qtp Java stack threads listed qtp waiting lock java lang Object locked java util HashMap qtp waiting lock java util HashMap locked java lang Object locked java lang Object deadlock DruidStatement task test segment lock connection persist set list
7400	users provider metadata username Description PasswordProvider provide credentials connecting metadata store hardcoding hardcode username restart Druid change username Motivation change user Druid interact metadata database needing restart Druid change druid metadata storage connector user property operation change druid metadata storage connector password Druid running specific single provider furnish user password implementation avoid introducing race condition users wanted separate providers username password build PasswordProvider yoked PasswordProviders provide field users provider metadata username user role group update key authenticator authorizer credentials
8622	Proposal concept supervisor type task slots resolving parallel task deadlocks Motivation ParallelIndexSupervisorTask supervisor style task delegates work spawned subtasks supervisor task subtasks task slot pool possibility deadlock druid cluster task slots ParallelIndexSupervisorTask tasks submitted simultaneously started running task slots Subtasks spawned supervisor tasks supervisor tasks waiting discussed comment Proposed Add method Task isSupervisor Task returns task supervisor task spawns subtasks delegate work ParallelIndexSupervisorTask current task impls Add druid worker supervisorCapacity configuration middleManagers designates slots supervisor tasks config druid worker capacity designates supervisor task slots Http RemoteTaskRunner code updated recognize supervisor tasks consume slot supervisorCapacity capacity Rationale potential alternative send supervisor tasks dedicated set middleManagers supervisor tasks Operational impact User ParallelIndexSupervisorTask set property druid worker supervisorCapacity middleManagers Test plan optional staging cluster work optional reliability supervisor tasks treated specially imposing restartable restriction failing middleManager running crashed Proposal concept supervisor type task slots resolving parallel task deadlocks task compaction worker segment partition num config spec
9292	CoordinatorRuleManager rules doesn store ConcurrentHashMap CoordinatorRuleManager didn race condition prior ConcurrentHashMap modified assigning AtomicReference proper proper action replace ConcurrentHashMap simple HashMap CoordinatorRuleManager rules doesn store ConcurrentHashMap rule rules datasource broker test metadata opt data
10005	API verify published segments loaded datasource Description API verify published segments loaded datasource API api takes datasource returns segment weeks datasource query loaded historical api takes datasource time interval start returns segment start time datasource query loaded historical Note API time interval optional parameter time interval referred timestamp data segment segment ingested time interval time interval user query data Basically user query call api datasource time interval ensure segments datasource timestamp ready query loaded historical differences API existing coordinator loadstatus API Takes datasource required check faster iterate smaller number segments Takes interval optional check faster iterate smaller number segments Takes forceMetadataRefresh force poll metadata source latest published segment API Path druid coordinator datasources dataSourceName loadstatus Request Path dataSourceName loadstatus Produces MediaType APPLICATION JSON ResourceFilters DatasourceResourceFilter Response getDatasourceLoadstatus PathParam dataSourceName String dataSourceName QueryParam interval Nullable String interval QueryParam forceMetadataRefresh Nullable forceMetadataRefresh QueryParam simple Nullabl String simple QueryParam full Nullabl String full Response simple full Returns percentage segments loaded cluster segments loaded cluster datasource interval weeks response percentage DATASOURCE Simple Returns number segments left load segments loaded cluster queries include replication response number segments DATASOURCE full Returns number segments left load tier segments loaded cluster includes replication response number segments tier DATASOURCE interval weeks forceMetadataRefresh Motivation address existing loadstatus API Coordinator reads segments SqlSegmentsMetadataManager Coordinator caches segments memory periodically updates race condition API implementation compares segments metadata mentioned cache published segments historical ingestion initial load datasource cache metadata segments API compares list segments published historical returns segments workflow submit ingestion task poll task api task succeeded poll api datasource interval forceMetadataRefresh step data user query poll api datasource interval forceMetadataRefresh data user query API verify published segments loaded datasource test segment segments task data unused interval metadata