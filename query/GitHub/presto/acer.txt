1614	Query hangs missed TaskSource update Driver Driver leave source updates stuck newSources hangs query task noMoreSplits message caused race TaskSource call processNewSources unlock DriverLockResult close TaskSource queued newSources lock held machine design flawed redesigned Query hangs missed TaskSource update Driver driver task split source test node plan close
1689	Race condition fails query Stack trace Caused java lang IllegalStateException Expected single output buffer task utt regularly issue test facebook presto client FailureInfo FailureException Expected response code http task xikpe summarize Request failed Race condition fails query visit query test spark expression bind type memory
3629	TestStateMachine testSetIf fails deterministically pretty frequently Travis kind race testSetIf facebook presto execution TestStateMachine Time elapsed FAILURE java lang AssertionError expected TestStateMachine testSetIf fails deterministically test set type bind join spark node memory
3647	Report race issue Developers facebook presto writing report race issue ConcurrentHashMap issue reported tool automatic manually confirmed positive specification program check details confirm real problem refer website http sav sutd File facebook presto presto blackhole src main java facebook presto plugin blackhole BlackHoleMetadata java Location Description remove operations tables guarded lock tables intention guarantee atomicity remove operations write operations atomicity Relying ConcurrentHashMap ensure exclusive access dangerous ConcurrentHashMap guarantee exclusive access Report race issue test table plan metadata data view type column
4869	Potential deadlock phased scheduler broadcast joins SELECT orders CROSS JOIN VALUES Fragment SINGLE Output layout orderkey custkey orderstatus totalprice orderdate orderpriority clerk shippriority comment field Output partitioning SINGLE Output orderkey custkey orderstatus totalprice orderdate orderpriority clerk shippriority comment col orderkey bigint custkey bigint orderstatus varchar totalprice orderdate orderpriority col field RemoteSource orderkey bigint custkey bigint orderstatus varchar totalprice orderdate orderpriority varchar clerk varchar shippriority bigint comment varchar field bigint Fragment SOURCE Output layout orderkey custkey orderstatus totalprice orderdate orderpriority clerk shippriority comment field Output partitioning SINGLE InnerJoin orderkey bigint custkey bigint orderstatus varchar totalprice orderdate orderpriority varchar clerk varchar shippriority bigint comment varchar field bigint TableScan tpch tpch orders originalConstraint orderkey bigint custkey bigint orderstatus varchar totalprice orderdate orderpriority varchar clerk varchar shippriority bigint comm orderkey tpch orderkey custkey tpch custkey orderstatus tpch orderstatus totalprice tpch totalprice orderdate tpch orderdate orderpriority tpch orderpriority clerk tpch clerk shippriority tpch shippriority comment tpch comment RemoteSource field bigint Fragment SINGLE Output layout field Output partitioning BROADCAST Values field bigint scheduling dependency graph missing edge join stage scheduled independently build stage Potential deadlock phased scheduler broadcast joins set enabled query join aggregation execution task max
5005	presto cli shutdown hook cancel running query occasionally shutdown hook cancel query properly tracked problem issues StatementClien advance loop interrupt received httpClient execute call exception handler correctly receive InterruptedIOException interrupt flag set bug query doesn canceled loop StatementClient close async http call race main thread closes http client QueryRunner close thread http call fails silently checking status call problem handle InterruptedIOException special close client interrupt main thread synch http call rid race reproduce problem electrum thoughts presto cli shutdown hook cancel running query occasionally query test resource create queries presto file limit
5110	Race condition array concat query select count select concat type array map string fails deterministically exceptions Presto version java lang IllegalStateException closeEntry called written Query failed Expected current entry size java lang IllegalStateException Expected current entry size Query failed Expected current entry size java lang IllegalStateException Expected current entry size Race condition array concat test function array type create functions table sql
5116	Race TestTaskExecutor testTaskHandle test fails deterministically java lang AssertionError expected Expected Actual Click difference pretty easy repro set invocation count Race TestTaskExecutor testTaskHandle table split level splits provider create metadata test
5735	OperatorContext ThreadSafe Contrary misleading ThreadSafe annotation usage AtomicLong OperatorContext ThreadSafe stumbled implementing spilling revocable memory problem setMemoryReservation trySetMemoryReservation methods transferMemoryToTaskContext AtomicLong memoryReservation AtomicLong setMemoryReservation newMemoryReservation checkArgument newMemoryReservation newMemoryReservation negative delta newMemoryReservation memoryReservation delta reserveMemory delta freeMemory delta scenario memoryReservation equals caller initiate setMemoryReservation thread calculates delta hangs caller memory reservation calling setMemoryReservation finishes thread resumes work memoryReservation thread resumes work freeMemory executed memoryReservation crashes query bug haven single driver thread familiar code don feel synchronization costly inclined drop AtomicLongs methods safer OperatorContext calls rare don expect negative performance impact cberner sopel OperatorContext ThreadSafe memory factory context input set record lookup output
6196	Deadlock task info fetching Hit production Suddenly queries queued clients start timing full stack trace Java level deadlock http worker waiting lock monitor fed object facebook presto execution resourceGroups ResourceGroup RootResourceGroup held ResourceGroupManager ResourceGroupManager waiting lock monitor object facebook presto execution SqlStageExecution held HttpRemoteTask HttpRemoteTask waiting lock monitor object facebook presto server remotetask ContinuousTaskStatusFetcher held ContinuousTaskStatusFetcher ContinuousTaskStatusFetcher waiting lock monitor object facebook presto server remotetask HttpRemoteTask held HttpRemoteTask Java stack threads listed http worker waiting lock facebook presto execution resourceGroups ResourceGroup RootResourceGroup ResourceGroupManager waiting lock facebook presto execution SqlStageExecution locked facebook presto execution resourceGroups ResourceGroup RootResourceGroup locked facebook presto execution resourceGroups ResourceGroup RootResourceGroup locked facebook presto execution resourceGroups ResourceGroup RootResourceGroup HttpRemoteTask waiting lock facebook presto server remotetask ContinuousTaskStatusFetcher locked facebook presto server remotetask HttpRemoteTask locked facebook presto server remotetask HttpRemoteTask locked facebook presto execution SqlStageExecution ContinuousTaskStatusFetcher waiting lock facebook presto server remotetask HttpRemoteTask locked facebook presto server remotetask ContinuousTaskStatusFetcher deadlock Deadlock task info fetching Issue prestodb presto GitHub Hit production Suddenly queries queued clients start timing full stack trace Java level deadlock http worker waiting lock monitor fed object facebook presto execution resourceGroups ResourceGroup RootResourceGroup held ResourceGroupManager ResourceGroupManager waiting lock monitor object facebook presto execution SqlStageExecution held HttpRemoteTask HttpRemoteTask waiting lock monitor object facebook presto server remotetask ContinuousTaskStatusFetcher held ContinuousTaskStatusFetcher ContinuousTaskStatusFetcher waiting lock monitor object facebook presto server remotetask HttpRemoteTask held HttpRemoteTask Java stack threads listed http worker waiting lock facebook presto execution resourceGroups ResourceGroup RootResourceGroup ResourceGroupManager waiting lock facebook presto execution SqlStageExecution locked facebook presto execution resourceGroups ResourceGroup RootResourceGroup locked facebook presto execution resourceGroups ResourceGroup RootResourceGroup locked facebook presto execution resourceGroups ResourceGroup RootResourceGroup HttpRemoteTask waiting lock facebook presto server remotetask ContinuousTaskStatusFetcher locked facebook presto server remotetask HttpRemoteTask locked facebook presto server remotetask HttpRemoteTask locked facebook presto execution SqlStageExecution ContinuousTaskStatusFetcher waiting lock facebook presto server remotetask HttpRemoteTask locked facebook presto server remotetask ContinuousTaskStatusFetcher deadlock Deadlock task info fetching task info set update memory node request split
6319	thread safety IndexLookup AccumuloClient AccumuloClient singleton instance IndexLookup calls setAuths getTabletSplits called threads Additionally IndexLookup ColumnCardinalityCache normal HashMap synchronization code path called multiple threads classes involved store AccumuloConfig thread safety IndexLookup AccumuloClient table accumulo column lifespan create metadata connector handle
6755	Potential deadlock backed resource group config manager working reloadable file backed resource group config manager hit deadlock situation applies backed config manager missing elonazoulay cberner Assume threads DbResourceGroupConfigurationManager pool thread ClusterMemoryManager configureChangedGroups AbstractResourceConfigurationManager memory change listener lambda lock root group lock generalPoolMemoryFraction configureGroup InternalResourceGroup setSoftMemoryLimit lock generalPoolMemoryFraction lock root group Potential deadlock backed resource group config manager query max set group resource manager test configuration
6923	Performance regression JOINs simple query SELECT COUNT store sales FULL JOIN web sales item item sold sold slowed versions factor nodes cluster completing seconds completes seconds CPU usage constant cores task concurrency doesn problem hash partitioning profiling problem OuterLookupSource OuterPositionTracker positionVisited method called PartitionedLookupSource appendTo code spends time code changed dain Previous version PartitionedLookupSource didn synchronize visitedPositions array OuterLookupSource synchronize profiling synchronization locking prevents query utilizing CPU didn time deeper code synchronization absolutely required changed area KBP TDC Performance regression JOINs spatial hash variable plan expression node join position
7667	TestQueues testBasic nondeterministic TestQueues testBasic fails race condition Tests wait pattern issue TestQueues testBasic call waitForQueryState wait query running function checks machine query assertion checks counter maintains change listener change listener triggered finished point checking race condition test TestQueues testBasic nondeterministic error log reproduce issue comment increase possibility failure TestQueues testBasic nondeterministic test cache query node fragment expression split selection
7689	Flaky tests rely async counters variables Test cases AbstractTestDistributedQueries testQueryLoggingCount counter updated query change listener race condition assertion counter execution listener issue reproduce problem manually add sleep listener callback sleep Flaky tests rely async counters variables type key symbol variable constraint size servlet block
8716	Hang AWS SDK parallel uploads load PrestoS FileSystem uploadObject aws sdk race condition aws sdk waitForCompletion method proposal update AWS SDK newer stable version race condition occur multiple calls CopyMonitor setFuture UploadMonitor setFuture infinite loop AbstractTransfer waitForCompletion Hang AWS SDK parallel uploads load test set glue max column partition table hive
9881	Race condition OuterPositionTracker error OuterPositionTracker position iterator fetched reference counts caused query tearing limit stack google common base VerifyException Race condition OuterPositionTracker position storage table channel create count partitioned hash
11253	Split scheduling broken colocated join bugs affect scheduling fragment stage scan nodes colocated join create fragment stage time combined outcome pressure split scheduling scan node source scheduling order stage bug fragment stage multiple scan nodes scan nodes receive TaskSource TaskSource noMoreSplits scheduling splits scan nodes stage finishes SqlStageExecution places completeSources variable updated schedulingComplete entire stage finishes scheduling addExchangeLocations isn relevant scan nodes SqlStageExecution places task noMoreSplits invoked invoked scheduleTask task noMoreSplits invoked element completeSources schedulingComplete addExchangeLocation bug bug caused frequent query deadlock leads bug bug PipelineContext getPipelineStatus queuedDrivers computed DriverContexts note SqlTaskExecution schedulePartitionedSource concept pendingSplitsByPlanNode pendingSplitsByPlanNode buffers splits scan nodes eligible schedule scan node term source scheduling order hasn finished scheduling scan node scan node source scheduling order bug finish scheduling splits stage delivered workers queuedDrivers include splits pendingSplitsByPlanNode DriverSplitRunner created splits fact worker chose defer creation drivers implementation detail Conceptually splits delivered worker worker created drivers drivers blocked runnable NodeScheduler selectDistributionNodes depends NodeAssignmentStats getTotalSplitCount effectively queuedDrivers assignment assignment increment reset split delivered workers queuedDrivers small number eventually hit bug bug leads misleading unituitive client stats mutual bug fixed lead scheduling deadlocks bug fixed restore pressure mitigate bug Split scheduling broken colocated join node nodes task splits record split set lifespans
13142	Backport Handle race QueryStateTimer backport trinodb trino failures ERROR Tests Failures Errors Skipped Time elapsed FAILURE TestSuite ERROR tearDown facebook presto execution resourceGroups TestQueuesDb Time elapsed FAILURE java lang IllegalArgumentException negative Backport Handle race QueryStateTimer query time info spark set output execution session