1614	Query hangs missed TaskSource update Driver Driver leave source updates stuck newSources hangs query task see noMoreSplits message believe is caused race TaskSource is added call processNewSources unlock TaskSource gets queued newSources get lock is is held state machine design is need be redesigned
1689	Race condition fails query Stack trace happens CI issue test run Caused IllegalStateException Expected output buffer task found
3629	happens Travis is kind race testSetIf fails TestStateMachine Time elapsed sec FAILURE AssertionError expected found
3647	Report race issue Developers facebook presto Location Line  172 Description File java remove put operations tables line are guarded lock tables intention is guarantee atomicity remove put operations write operations line break atomicity Relying ConcurrentHashMap ensure access is ConcurrentHashMap has guarantee access
4869	deadlock using phased scheduler broadcast joins Fragment Output layout orderkey custkey orderstatus totalprice orderdate orderpriority clerk shippriority comment field Output partitioning Output orderkey custkey orderstatus totalprice orderdate orderpriority clerk shippriority comment col9 orderkey bigint custkey bigint orderstatus varchar totalprice orderdate date orderpriority col9 field RemoteSource orderkey bigint custkey bigint orderstatus varchar totalprice orderdate date orderpriority varchar clerk varchar shippriority bigint comment varchar field bigint Fragment SOURCE Output layout orderkey custkey orderstatus totalprice orderdate orderpriority clerk shippriority comment field Output partitioning InnerJoin orderkey bigint custkey bigint orderstatus varchar totalprice orderdate date orderpriority varchar clerk varchar shippriority bigint comment varchar field bigint TableScan tpch tpch orders sf originalConstraint orderkey bigint custkey bigint orderstatus varchar totalprice orderdate date orderpriority varchar clerk varchar shippriority bigint comm orderkey tpch orderkey custkey tpch custkey orderstatus tpch orderstatus totalprice tpch totalprice orderdate tpch orderdate orderpriority tpch orderpriority clerk tpch clerk shippriority tpch shippriority comment tpch comment RemoteSource field bigint Fragment Output layout field Output partitioning BROADCAST Values field bigint scheduling dependency graph is missing edge cause join stage be scheduled build stage
5005	presto cli shutdown hook cancel running query  electrum thoughts shutdown hook added   cancel query have tracked problem following issues advance loop interrupt is received execute call exception handler see receive InterruptedIOException interrupt flag is set bug query does get canceled loop goes do async http call is race thread closes http client thread doing http call fails are checking status call problem handle InterruptedIOException case close client interrupt thread one do synch call get rid race changes reproduce problem
5110	Race condition array_concat query select count x select concat b x t b are type array map string fails exceptions Presto version 0 144 2 Query 20160425_183530_20138_n949w failed entry size be was Query 20160425_183539_20170_n949w failed entry size be was IllegalStateException closeEntry called anything is written IllegalStateException entry size be was IllegalStateException entry size be was
5116	test fails Expected  s repro set invocation count 10k Race testTaskHandle AssertionError expected found
5735	OperatorContext is ThreadSafe is problem setMemoryReservation trySetMemoryReservation methods transferMemoryToTaskContext void setMemoryReservation newMemoryReservation caller A initiate setMemoryReservation thread calculates delta hangs end memoryReservation crashes query CC  cberner  sopel39  ThreadSafe annotation usage AtomicLong OperatorContext is ThreadSafe have stumbled implementing things related spilling   memory   Example scenario memoryReservation equals caller B changes memory reservation calling setMemoryReservation finishes thread resumes work give memoryReservation thread resumes work is executed bug have shown class is used driver thread  m part code do feel synchronization is be inclined drop AtomicLongs switch synchronized methods be OperatorContext calls be do expect have performance impact
6196	Deadlock task info fetching Found Java level deadlock http worker is held ResourceGroupManager ResourceGroupManager is held HttpRemoteTask 20160926_222904_08073_w6q27 1 HttpRemoteTask 20160926_222904_08073_w6q27 1 is held ContinuousTaskStatusFetcher 20160926_222904_08073_w6q27 1 ContinuousTaskStatusFetcher 20160926_222904_08073_w6q27 1  105 is held HttpRemoteTask 20160926_222904_08073_w6q27 1 Java stack information threads listed http worker ResourceGroupManager HttpRemoteTask 20160926_222904_08073_w6q27 1 ContinuousTaskStatusFetcher 20160926_222904_08073_w6q27 1  105 Found deadlock Deadlock task info fetching Issue   prestodb presto GitHub Found Java level deadlock http worker is held ResourceGroupManager ResourceGroupManager is held HttpRemoteTask 20160926_222904_08073_w6q27 1 HttpRemoteTask 20160926_222904_08073_w6q27 1 is held ContinuousTaskStatusFetcher 20160926_222904_08073_w6q27 1 ContinuousTaskStatusFetcher 20160926_222904_08073_w6q27 1  105 is held HttpRemoteTask 20160926_222904_08073_w6q27 1 Java stack information threads listed http worker ResourceGroupManager HttpRemoteTask 20160926_222904_08073_w6q27 1 ContinuousTaskStatusFetcher 20160926_222904_08073_w6q27 1  105 Found deadlock Hit one production queries get queued clients start timing is stack trace waiting lock monitor 0x00007f8fed4a6fb8 object 0x00007f9615a7e020 ResourceGroup waiting lock monitor 0x00007f91f0cc3598 object 0x00007f9a9f000a48 SqlStageExecution waiting lock monitor 0x00007f90ed8c3ee8 object 0x00007f9a9f000870 ContinuousTaskStatusFetcher waiting lock monitor 0x00007f910c0b5948 object 0x00007f9a9f0008e0 HttpRemoteTask waiting lock ResourceGroup waiting lock SqlStageExecution locked ResourceGroup locked ResourceGroup locked ResourceGroup waiting lock ContinuousTaskStatusFetcher locked HttpRemoteTask locked HttpRemoteTask locked SqlStageExecution waiting lock HttpRemoteTask locked ContinuousTaskStatusFetcher Hit one production queries get queued clients start timing is stack trace waiting lock monitor 0x00007f8fed4a6fb8 object 0x00007f9615a7e020 ResourceGroup waiting lock monitor 0x00007f91f0cc3598 object 0x00007f9a9f000a48 SqlStageExecution waiting lock monitor 0x00007f90ed8c3ee8 object 0x00007f9a9f000870 ContinuousTaskStatusFetcher waiting lock monitor 0x00007f910c0b5948 object 0x00007f9a9f0008e0 HttpRemoteTask waiting lock ResourceGroup waiting lock SqlStageExecution locked ResourceGroup locked ResourceGroup locked ResourceGroup waiting lock ContinuousTaskStatusFetcher locked HttpRemoteTask locked HttpRemoteTask locked SqlStageExecution waiting lock HttpRemoteTask locked ContinuousTaskStatusFetcher
6319	Fix thread safety IndexLookup AccumuloClient be done   classes involved store AccumuloConfig AccumuloClient is singleton contains instance IndexLookup calls setAuths getTabletSplits is called threads IndexLookup uses ColumnCardinalityCache has HashMap synchronization code path is called threads
6755	deadlock db backed resource group config manager Assume have threads T1 DbResourceGroupConfigurationManager T2 pool thread ClusterMemoryManager configureChangedGroups AbstractResourceConfigurationManager memory_change_listener_lambda lock root group lock generalPoolMemoryFraction configureGroup InternalResourceGroup setSoftMemoryLimit lock generalPoolMemoryFraction lock root group was working file backed resource group config manager hit deadlock situation think applies db backed config manager am missing something cc  cberner
6923	Performance regression OUTER JOINs Following query COUNT store_sales FULL OUTER JOIN web_sales code was changed  dain profiling looks synchronization locking prevents query utilizing CPU did have time look code is synchronization required Has something changed area CC  KBP TDC ss_item_sk has slowed versions factor nodes cluster was completing seconds completes seconds CPU usage   cores task_concurrency does seem be problem hash partitioning   profiling seems problem is OuterPositionTracker  positionVisited method called PartitionedLookupSource  appendTo code spends   time version PartitionedLookupSource did synchronize visitedPositions array OuterLookupSource did synchronize are synchronized
7667	reproduce issue comment line increase possibility failure is fails race condition Tests have wait assert pattern have issue call waitForQueryState wait query is running function checks state machine query following assertion checks counter maintains state change listener  s state change happens listener has been triggered has finished point are checking assert race condition causes test be see error log
7689	tests rely async counters variables Test cases testQueryLoggingCount assert counter is updated query state change listener is race condition assertion counter execution listener issue   reproduce problem add sleep listener callback g sleep 10ms
8716	Hang AWS SDK uploads load race condition occur calls CopyMonitor  setFuture UploadMonitor  setFuture cause loop AbstractTransfer  waitForCompletion uploadObject is using aws s3 sdk race condition aws sdk waitForCompletion method affects proposal update AWS SDK version
9881	Race condition OuterPositionTracker saw error OuterPositionTracker position iterator is being fetched are reference counts think be caused query was tearing limit is stack VerifyException
11253	Split scheduling is broken colocated join combined outcome is is back pressure split scheduling scan node source scheduling order stage bug bug scan node is scan node source scheduling order bug finish scheduling splits stage are delivered workers bug leads client stats effect bug gets fixed lead scheduling deadlocks bug gets fixed restore pressure mitigate bug are bugs affect scheduling fragment stage scan nodes colocated join create fragment stage time fragment stage contains scan nodes None scan nodes receive TaskSource noMoreSplits scheduling splits scan nodes stage finishes SqlStageExecution are places completeSources variable is updated schedulingComplete happens stage finishes scheduling addExchangeLocations is scan nodes SqlStageExecution are places noMoreSplits is invoked  s invoked scheduleTask noMoreSplits is invoked element completeSources are addExchangeLocation bug seems bug have caused query deadlock leads bug getPipelineStatus queuedDrivers is computed looking DriverContexts note schedulePartitionedSource is concept pendingSplitsByPlanNode pendingSplitsByPlanNode buffers splits scan nodes are schedule scan node is term source scheduling order has finished scheduling queuedDrivers include splits pendingSplitsByPlanNode DriverSplitRunner is be created splits fact worker chose defer creation drivers is implementation detail splits have been delivered worker worker has created drivers drivers are blocked look selectDistributionNodes depends is queuedDrivers assignment assignment increment is reset split is delivered workers queuedDrivers be number hit bug
13142	Backport Handle race QueryStateTimer backport trinodb trino   fix failures ERROR Tests run Failures Errors Skipped Time elapsed s FAILURE TestSuite ERROR TestQueuesDb Time elapsed s FAILURE IllegalArgumentException value is