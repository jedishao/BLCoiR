1247	Deadlock connection HttpClient closing Vert thread hold lock HttpClientImpl close lock acquire lock ClientConnection close lock thread hold lock ClientConnection handleClosed hold lock HttpClientImpl checkClosed boom deadlock don good repro hard reproduce consistently demonstrate stack trace Thread BLOCKED vertx core http impl ClientConnection close bci Interpreted frame vertx core http impl HttpClientImpl close bci Interpreted frame Thread BLOCKED vertx core http impl HttpClientImpl checkClosed bci Interpreted frame vertx core http impl HttpClientImpl doRequest vertx core http HttpMethod java lang String java lang String vertx core MultiMap bci Interpreted frame vertx core http impl HttpClientImpl request vertx core http HttpMethod java lang String java lang String bci Interpreted frame vertx core http impl HttpClientImpl java lang String java lang String bci Interpreted frame vertx core http impl HttpClientRequestImpl lambda exceptionHandler vertx core Handler java lang Throwable bci Interpreted frame vertx core http impl HttpClientRequestImpl Lambda handle java lang Object bci Interpreted frame vertx core http impl HttpClientRequestImpl handleException java lang Throwable bci Interpreted frame vertx core http impl ClientConnection handleClosed bci Interpreted frame vertx core net impl VertxHandler Lambda bci Interpreted frame vertx core impl ContextImpl lambda wrapTask vertx core impl ContextTask vertx core Handler bci Compiled frame vertx core impl ContextImpl Lambda bci Compiled frame vertx core impl ContextImpl executeFromIO vertx core impl ContextTask bci Compiled frame vertx core net impl VertxHandler channelInactive netty channel ChannelHandlerContext bci Interpreted frame netty channel AbstractChannelHandlerContext invokeChannelInactive bci Interpreted frame netty channel AbstractChannelHandlerContext fireChannelInactive bci Interpreted frame netty channel ChannelInboundHandlerAdapter channelInactive netty channel ChannelHandlerContext bci Interpreted frame netty handler timeout IdleStateHandler channelInactive netty channel ChannelHandlerContext bci Interpreted frame netty channel AbstractChannelHandlerContext invokeChannelInactive bci Interpreted frame netty channel AbstractChannelHandlerContext fireChannelInactive bci Interpreted frame netty handler codec ByteToMessageDecoder channelInactive netty channel ChannelHandlerContext bci Interpreted frame netty handler codec http HttpClientCodec Decoder channelInactive netty channel ChannelHandlerContext bci Interpreted frame netty channel CombinedChannelDuplexHandler channelInactive netty channel ChannelHandlerContext bci Interpreted frame netty channel AbstractChannelHandlerContext invokeChannelInactive bci Interpreted frame netty channel AbstractChannelHandlerContext fireChannelInactive bci Interpreted frame netty channel DefaultChannelPipeline fireChannelInactive bci Interpreted frame netty channel AbstractChannel AbstractUnsafe bci Interpreted frame netty util concurrent SingleThreadEventExecutor runAllTasks bci Compiled frame netty channel nio NioEventLoop bci Compiled frame netty util concurrent SingleThreadEventExecutor bci Compiled frame java lang Thread bci Compiled frame Deadlock connection HttpClient closing set socket request server options client max handler
1302	EventLoop thread blocked Vertx clusteredVertx Vertx EventLoop thread blocked Vertx clusteredVertx Method Vertx clusteredVertx called main java thread application startup Stacktrace vertx blocked thread checker WARN core impl BlockedThreadChecker Thread Thread vert eventloop thread main blocked time limit vertx core VertxException Thread blocked hazelcast jar hazelcast jar hazelcast jar hazelcast jar hazelcast jar hazelcast jar hazelcast jar hazelcast jar vertx core jar vertx core jar vertx core jar vertx core jar vertx core jar vertx core jar netty common jar netty transport jar netty common jar EventLoop thread blocked Vertx clusteredVertx set verticle blocking options time create context check
1355	Deadlock ClientConnection HttpClientRequestImpl week attached load balancer simple poll points traffic machines instances deadlock kill theory brought testing stages big problem imagine bit hair raising simple analysis Exception handling request response locking HttpClientRequestImpl handleException getlock HttpClientRequestImpl connect lamda traffic load balancer cisco content ACE module sends request response resets connection behaviour causing deadlock live create test replicate behaviour running code Ive fixes JVM RHEL jstack Debugger attached Server compiler detected JVM version Deadlock Detection Java level deadlock vert eventloop thread waiting lock Monitor Object vertx core http impl ClientConnection held vert eventloop thread vert eventloop thread waiting lock Monitor dac Object vertx core http impl HttpClientRequestImpl held vert eventloop thread total deadlock Thread BLOCKED vertx core net impl ConnectionBase writeToChannel java lang Object bci Compiled frame vertx core http impl HttpClientRequestImpl writeHeadWithContent netty buffer ByteBuf bci Compiled frame vertx core http impl HttpClientRequestImpl connected vertx core http impl ClientConnection bci Compiled frame vertx core http impl HttpClientRequestImpl lambda connect vertx core http impl ClientConnection bci Compiled frame vertx core http impl HttpClientRequestImpl Lambda handle java lang Object bci Compiled frame vertx core http impl ConnectionManager ConnQueue lambda responseEnded vertx core http impl ConnectionManager Waiter vertx core http impl ClientConnection java lang bci Compiled frame vertx core http impl ConnectionManager ConnQueue Lambda handle java lang Object bci Compiled frame vertx core impl ContextImpl lambda wrapTask vertx core impl ContextTask vertx core Handler bci Compiled frame vertx core impl ContextImpl Lambda bci Compiled frame netty util concurrent SingleThreadEventExecutor runAllTasks bci Compiled frame netty channel nio NioEventLoop bci Compiled frame netty util concurrent SingleThreadEventExecutor bci Interpreted frame java lang Thread bci Interpreted frame Thread BLOCKED vertx core http impl HttpClientRequestImpl getLock bci Compiled frame vertx core http impl HttpClientRequestImpl handleException java lang Throwable bci Compiled frame vertx core http impl ClientConnection handleException java lang Throwable bci Compiled frame vertx core net impl VertxHandler lambda exceptionCaught netty channel Channel vertx core net impl ConnectionBase java lang Throwable bci Compiled frame vertx core net impl VertxHandler Lambda bci Compiled frame vertx core impl ContextImpl lambda wrapTask vertx core impl ContextTask vertx core Handler bci Compiled frame vertx core impl ContextImpl Lambda bci Compiled frame vertx core impl ContextImpl executeFromIO vertx core impl ContextTask bci Compiled frame vertx core net impl VertxHandler exceptionCaught netty channel ChannelHandlerContext java lang Throwable bci Compiled frame netty channel AbstractChannelHandlerContext invokeExceptionCaught java lang Throwable bci Compiled frame netty channel AbstractChannelHandlerContext fireExceptionCaught java lang Throwable bci Compiled frame netty channel ChannelInboundHandlerAdapter exceptionCaught netty channel ChannelHandlerContext java lang Throwable bci Compiled frame netty channel AbstractChannelHandlerContext invokeExceptionCaught java lang Throwable bci Compiled frame netty channel AbstractChannelHandlerContext fireExceptionCaught java lang Throwable bci Compiled frame netty channel ChannelInboundHandlerAdapter exceptionCaught netty channel ChannelHandlerContext java lang Throwable bci Compiled frame netty channel CombinedChannelDuplexHandler exceptionCaught netty channel ChannelHandlerContext java lang Throwable bci Compiled frame netty channel AbstractChannelHandlerContext invokeExceptionCaught java lang Throwable bci Compiled frame netty channel AbstractChannelHandlerContext fireExceptionCaught java lang Throwable bci Compiled frame netty handler ssl SslHandler exceptionCaught netty channel ChannelHandlerContext java lang Throwable bci Compiled frame netty channel AbstractChannelHandlerContext invokeExceptionCaught java lang Throwable bci Compiled frame netty channel AbstractChannelHandlerContext fireExceptionCaught java lang Throwable bci Compiled frame netty channel DefaultChannelPipeline fireExceptionCaught java lang Throwable bci Compiled frame netty channel nio AbstractNioByteChannel NioByteUnsafe handleReadException netty channel ChannelPipeline netty buffer ByteBuf java lang Throwable bci Compiled frame netty channel nio AbstractNioByteChannel NioByteUnsafe read bci Compiled frame netty channel nio NioEventLoop processSelectedKey java nio channels SelectionKey netty channel nio AbstractNioChannel bci Compiled frame netty channel nio NioEventLoop processSelectedKeysOptimized java nio channels SelectionKey bci Compiled frame netty channel nio NioEventLoop processSelectedKeys bci Compiled frame netty channel nio NioEventLoop bci Compiled frame netty util concurrent SingleThreadEventExecutor bci Interpreted frame java lang Thread bci Interpreted frame Deadlock ClientConnection HttpClientRequestImpl test request response connection handler http server client
1466	Deadlock ServerConnection HttpClientRequestImpl HttpClient thread happened Java level deadlock vert eventloop thread waiting lock monitor object fda vertx core http impl ServerConnection held vert eventloop thread vert eventloop thread waiting lock monitor object vertx core http impl HttpClientRequestImpl held vert eventloop thread Java stack threads listed vert eventloop thread waiting lock fda vertx core http impl ServerConnection locked vertx core http impl HttpClientRequestImpl vert eventloop thread waiting lock vertx core http impl HttpClientRequestImpl locked fda vertx core http impl ServerConnection locked fda vertx core http impl ServerConnection chance glitch weird behaviour instances launched code bit dangerous vertx core http impl HttpClientRequestImpl getLock connecting synchronize client connection instance prevent deadlock conditions client connection connecting point Object getLock initial check block prevent hit conn set conn conn conn conn Deadlock ServerConnection HttpClientRequestImpl handler request set check handle socket server response
1469	HttpClientMetrics createEndpoint called multiple times endpoint implementation vertx core http impl ConnectionManager QueueManager getConnQueue lead HttpClientMetrics createEndpoint called multiple times endpoint threads fresh HTTP client ConnQueue connQueue queueMap address connQueue connQueue ConnQueue version address ConnQueue prev queueMap putIfAbsent address connQueue prev connQueue prev connQueue HttpClientMetrics createEndpoint called ConnQueue constructor single instance ConnQueue created map SPI implementations leak resources acquired createEndpoint closeEndpoint called queue instance HttpClientMetrics createEndpoint called multiple times endpoint handler endpoint write size client max set frame
1573	Blocked thread warning opening closing AsyncFile Users reported blocked thread warning opening closing AsyncFile stack traces vertx core VertxException Thread blocked vertx core VertxException Thread blocked user details reported mapped Windows shared drive reproduce opening issue slow network filesystem twickle nbd Blocked thread warning opening closing AsyncFile set time check options thread local event execute
1598	Asynchronous read write wrong thread open close issue addressed Async read write blocking aaa WARN vertx blocked thread checker vertx core impl BlockedThreadChecker Thread Thread vert eventloop thread main blocked time limit vertx core VertxException Thread blocked Asynchronous read write wrong thread handler file write read bytes handle multicast local
1633	Context executeBlocking log blocked threads description Context executeBlocking log blocked threads set context options verticle thread time worker close
1742	File caching implementation thread safe FileResolver implementation caching thread safe problem occurs file cached concurrently read multiple verticles issue reproduced FileSystem readFileBlocking async implementation yield problem file read multiple verticles parallel file reside local filesystem Vert cache file moving vertx directory verticle hits FileResolver resolveFile trigger copying action resource designated vertx cache directory copy action finished file read verticle read complete data instance hits FileResolver resolveFile find cached file resolution file copied happen read cached file copied completely verticle read partial data problem reproduced running supplied verticle multiple instances verticle reads files attached jar size outputs size read payload vertx fileread bug zip vertx data jar instances FileLengthVerticle java Sample output file data bytes file data bytes file data bytes file data bytes file data bytes file data bytes file data bytes file data bytes file data bytes file data bytes file data bytes file data bytes file data bytes file data bytes File caching implementation thread safe file set system bytes handle vertx write options
1834	Don call HttpServer request close handler holding locks Motivation ServerWebSocket HttpServerRequest close handlers called lock connection create deadlocks SockJSSocket SockJSSocket request websocket reconnects event loops Change processing Netty close event call close handlers tick scheduled context Don call HttpServer request close handler holding locks request server handler client socket event stream set
1892	Race condition setHandler completion threads projects encountered problem CompositeFuture running verticle junit tests sample program vertx core CompositeFuture vertx core vertx core Vertx java util concurrent CountDownLatch java util concurrent ExecutionException java util concurrent TimeUnit java util concurrent atomic AtomicInteger CompositeFutureTest NUMBER LOOPS Vertx vertx Vertx vertx testCompositeFuture InterruptedException ExecutionException CountDownLatch finished CountDownLatch AtomicInteger atomicCounter AtomicInteger NUMBER LOOPS vertx runOnContext complete vertx runOnContext complete CompositeFuture setHandler succeeded atomicCounter incrementAndGet NUMBER LOOPS finished countDown result finished await TimeUnit SECONDS System println String format result ERROR atomicCounter NUMBER LOOPS result main String args InterruptedException ExecutionException testCompositeFuture vertx close prints ERROR implementation CompositeFutureImpl setHandler function called composition problem completion futures runs thread setting handler functions setHandler complete atomic result situation handler called problem fundamental implementation FutureImpl thread safe threads difficulties running verticle asynchronous callbacks serialized event loop concurrently don expected behaviour Futures compositions verticles understanding based implementation CompositeFutureImpl intention thread safe Race condition setHandler completion threads blocking set test file thread options close handle
2012	Race condition AsyncFileImpl writesOutstanding AsyncFileImpl written thread context created counter writesOutstanding invalid counter updated caller thread context write complete AtomicLong writesOutstanding https gist github purplefox Race condition AsyncFileImpl writesOutstanding test internal thread multicast file handle write handler
2370	HttpClient pool inconsistent synchronous connection failure HttpClient pool assumes underlying ConnectionProvider asynchronous callback asynchronous DNS resolver JVM synchronous resolver host resolved HttpClient pool inconsistent synchronous connection failure set test connection max size options socket client
2418	deadlock multiple locks code illustrates problem Consumer verticle acuires lock stuck reproduced problem HazelcastClusterManager IgniteClusterManager Vertx clusteredVertx VertxOptions setClusterManager HazelcastClusterManager result Vertx vertx result result messagesToSend Consumer consumer Consumer vertx deployVerticle consumer DeploymentOptions event event succeeded vertx deployVerticle Supplier messagesToSend DeploymentOptions vertx setTimer messagesToSend LOCK TIMEOUT timer failsNumber messagesToSend consumer counter sum failsNumber System err println Failed failsNumber locks vertx close Supplier AbstractVerticle messagesToSend Supplier messagesToSend messagesToSend messagesToSend Override start LongAdder LongAdder vertx setPeriodic timer vertx eventBus send TEST ADDRESS message increment System println sum messages sum messagesToSend vertx cancelTimer timer Consumer AbstractVerticle LongAdder counter LongAdder Override start startFuture vertx eventBus consumer TEST ADDRESS event vertx sharedData getLock lock lock lock failed System println Failed lock lock System println Succeeded lock vertx sharedData getLock lock lock lock failed System println Failed lock lock System println Succeeded lock counter increment System println counter sum messages consumed lock result release lock result release completionHandler startFuture deadlock multiple locks set handler request server handle internal append write
2670	Client connections GlobalEventExecutor thread propagated application Netty bootstrap notify client connections GlobalEventExecutor thread early boostrap event loop determined Vertx expects notifications happen event loop thread Event loop context executing wrong thread failure Client connections GlobalEventExecutor thread propagated application set socket options max size tcp handler pool
2684	executeBlocking callback wrong thread asynchronous resolution executeBlocking Handler Handler AsyncResult execute callback wrong thread runOnContext execution loses race thread completes worker thread completes happen worker thread hands thread completes happen Mongo client fails stack trace executeBlocking callback wrong thread asynchronous resolution context close verticle blocking file local bytes http
2773	HttpClient race condition connection pool closed race condition HttpClient client request connection close pool delivers client request tick connection removed pool schedule delivery moment client connection closed aware connection close avoid tick situation client request fulfilled valid connection called avoid race fact connection pool hold connections multiples context pool requests pool situation hard avoid check connection delivered solution attach vertx context pool connections context eliminate race easily HttpClient race condition connection pool closed set test connection handler socket max size options
2916	HTTP event handler called holding lock event handlers called holding lock lead deadlocks remove HTTP event handler called holding lock handler message write local blocking context node read
2982	HTTP Client Deadlock appears eventloops blocked http client relative stuff Vert threaddump vert eventloop thread prio prio tid nid waiting monitor entry java lang Thread BLOCKED object monitor waiting lock vertx core http impl HttpClientRequestImpl locked vertx core http impl Http xClientConnection locked vertx core http impl Http xClientConnection vert eventloop thread prio prio tid nid waiting monitor entry java lang Thread BLOCKED object monitor waiting lock vertx core http impl Http xClientConnection locked vertx core http impl HttpClientRequestImpl provide simple reproducer deadlock pretty hard reproduce HTTP Client Deadlock test client server socket close request handler frame
3064	HttpServerResponse operation fail synchronously stream closed improvements behaviour responses methods stream ended user fail synchronously programming mistake stream closed fail synchronously fail asynchronously Vert synchronous operation result failed HttpServerResponse operation fail synchronously stream closed handler set stream http test connection handle request
3140	lock handler calls AsyncFile AsyncFile implementation calls file handlers block synchronization reading handler calling lock handler calls AsyncFile file test stream dir read write async copy
3142	Deadlock deploying instances verticle starting net server regression Deadlock deploying instances verticle starting net server set verticle pool redeploy create time client handler
3232	Vertx close callback handler returned vertx close completes thread pool shut works doesn Test testPromise Throwable Vertx vertx Vertx vertx logger debug Shutting promise Promise promise Promise promise vertx close promise Sync await promise logger debug Shut promise Test testFuture Throwable Vertx vertx Vertx vertx logger debug Shutting Sync await vertx close logger debug Shut Sync await blocking method waits complete setHandler output main DEBUG shared minimal vertx VertxTest Shutting promise main DEBUG shared minimal vertx VertxTest Shut promise main DEBUG shared minimal vertx VertxTest Shutting Exception thread vert eventloop thread java util concurrent RejectedExecutionException event executor terminated completes Vertx close callback handler handler close write bytes channel max file context
3335	FileSystemImpl existsInternal block event loop thread Version Context Invoking vertx filesystem exists block event loop thread resolveFile runs event loop thread worker thread https github eclipse vertx vert blob master src main java vertx core file impl FileSystemImpl java BlockingAction existsInternal String path Objects requireNonNull path BlockingAction File file vertx resolveFile path perform file exists resolveFile called perform method BlockingAction existsInternal String path Objects requireNonNull path BlockingAction perform File file vertx resolveFile path file exists reproducer mock calls resolveFile sleep amount time set breakpoint resolveFile call test runs Wait blocked thread checker interval unpause execution BlockedThreadChecker report thread blocked Steps reproduce FileSystemImpl existsInternal block event loop thread set handler thread close time event worker file
3468	Thread blocked vertx core net impl clientconnection ConnectionManager getConnection upgrading https github folio org okapi Vert milestone milestone noticed issue HttpClient connections thread blocked connection remote host client issuing request fails thread blocked warning halt event loop openjdk version OpenJDK Runtime Environment build ubuntu OpenJDK Bit Server build mixed mode openjdk version OpenJDK Runtime Environment build Ubuntu ubuntu OpenJDK Bit Server build Ubuntu ubuntu mixed mode sharing Host Ubuntu amd Log INFO Running org folio okapi common HttpClientDoubleFail WARN Thread Thread vert eventloop thread main blocked time limit WARN Thread Thread vert eventloop thread main blocked time limit WARN Thread Thread vert eventloop thread main blocked time limit WARN Thread Thread vert eventloop thread main blocked time limit vertx core VertxException Thread blocked vertx core milestone jar milestone vertx core milestone jar milestone vertx core milestone jar milestone vertx core milestone jar milestone vertx core milestone jar milestone vertx core milestone jar milestone test classes vertx core milestone jar milestone vertx core milestone jar milestone vertx core milestone jar milestone vertx core milestone jar milestone vertx core milestone jar milestone vertx core milestone jar milestone vertx core milestone jar milestone vertx core milestone jar milestone vertx core milestone jar milestone vertx core milestone jar milestone vertx core milestone jar milestone vertx core milestone jar milestone vertx core milestone jar milestone vertx core milestone jar milestone vertx core milestone jar milestone vertx core milestone jar milestone vertx core milestone jar milestone vertx core milestone jar milestone netty common jar netty common jar netty common jar netty common jar netty common jar netty common jar vertx core milestone jar milestone netty common jar netty common jar netty common jar netty common jar netty common jar netty common jar netty common jar netty transport jar netty transport jar netty transport jar netty transport jar netty transport jar netty transport jar netty common jar netty common jar netty common jar WARN Thread Thread vert eventloop thread main blocked time limit Test RunWith VertxUnitRunner HttpClientFail Test Vertx vertx setUp TestContext context vertx Vertx vertx tearDown TestContext context vertx close context asyncAssertSuccess Test test TestContext context Async async context async HttpClient client vertx createHttpClient HttpClientRequest req client request RequestOptions setAbsoluteURI http localhost exceptionHandler res HttpClientRequest req client request RequestOptions setAbsoluteURI http localhost exceptionHandler res async complete onSuccess res context fail unexpected success running async complete req onSuccess res context fail unexpected success running async complete req async await Thread blocked vertx core net impl clientconnection ConnectionManager getConnection test set connection close options pool time event
3469	HTTP client retry host deadlock HTTP client retrying host failure deadlock close pool performs callback close pool retries fail retry indefinitely HTTP client retry host deadlock test client set proxy server http trust cert
3658	Race condition unhandled exception CompositeFuture Version version encounter bug newer versions Context futures executing threads passed CompositeFuture race condition throwing unhandled unexpected exception futures fail virtually time gap block method reached fails composite composite isComplete composite fail block doComplete method doComplete Object result result result result promise handle create situation subsequent thread sees composite isComplete making doComplete method returning result returning tryFail method unhandled unexpected exception fail method fail Throwable tryFail IllegalStateException Result complete result succeeded failed Steps reproduce simple test RunWith VertxUnitRunner treating unhandled exceptions unit test failures RunWith VertxUnitRunner CompositeFutureRaceConditionTest NUM ITERATIONS NUM THREADS Test testRaceConditionRepeatedly TestContext context Exception NUM ITERATIONS raceCondition context raceCondition TestContext context Exception List Promise promises IntStream range NUM THREADS mapToObj Promise promise collect Collectors toList List futures promises stream map Promise collect Collectors toList CompositeFuture compositeFuture CompositeFuture futures ExecutorService executorService Executors newFixedThreadPool NUM THREADS CountDownLatch countDownLatch CountDownLatch NUM THREADS NUM THREADS executorService submit countDownLatch countDown countDownLatch await System println Start fail Thread Thread currentThread getName promises fail Fail System println fail Thread Thread currentThread getName Throwable printStackTrace context fail getMessage compositeFuture onComplete System println CompositeFuture onComplete called executorService shutdown terminatedSuccessfully executorService awaitTermination TimeUnit SECONDS context assertTrue terminatedSuccessfully exception depending number executions java lang IllegalStateException Result complete failed Extra Mac openjdk version OpenJDK Runtime Environment AdoptOpenJDK build OpenJDK Bit Server AdoptOpenJDK build mixed mode Race condition unhandled exception CompositeFuture test thread join concurrent event await failed wait
4024	Concurrency issue listener TCPServerBase listen Version Context stumbled concurrency issue debugging TCPServerBase context race happening listener registered bindFuture addListener code running listen method doBind bindFuture addListener listener notified listener setting field actual port field pre set listener port dependening faster listener method code sharedNetServers pick actual port predictable debugging waited sharedNetServers random port verticle correct term debugging random port Concurrency issue listener TCPServerBase listen handler server connection handle stream http socket request
4069	Deadlock closing Vertx WorkerExecutor concurrently met deadlock issue Vertx version investigated looked VertxImpl CloseFuture WorkerExecutorImpl deadlock happened Vertx deadlock issue hit vertx close workerExecutor close happened called time main thread eventloop thread workerExecutor created vertx createSharedWorkerExecutor Backtrace printed jstack Java level deadlock main waiting lock monitor object vertx core impl WorkerExecutorImpl held vert eventloop thread vert eventloop thread waiting lock monitor object vertx core impl VertxImpl held main Java stack threads listed main waiting lock vertx core impl WorkerExecutorImpl locked vertx core impl VertxImpl vert eventloop thread waiting lock vertx core impl VertxImpl locked vertx core impl WorkerExecutorImpl deadlock Checked vertx code find closing WorkerExecutor Lock WorkerExecutorImpl Remove CloseFuture Close SharedWorkerPool require lock Vertx closing Vertx Lock VertxImpl Close CloseFuture copy list callbacks invoke block callback close WorkerExecutorImpl instance copy callbacks CloseFuture happened removing WorkerExecutorImpl CloseFuture called deadlock Time Main thread Eventloop thread Start close Vertx locked VertxImpl instance Start close WorkerExecutor locked WorkerExecutorImpl instance CloseFuture list callbacks copied Remove WorkerExecutorImpl instance CloseFuture callback copied doesn prevent callback called callback close WorkerExecutorImpl instance called require lock WorkerExecutorImpl instance acquired eventloop thread waiting lock released eventloop thread Close SharedWorkerPool require lock VertxImpl instance acquired main thread waiting lock released main thread Deadlock Deadlock issue exist Deadlock closing Vertx WorkerExecutor concurrently test worker handler context verticle event message close
4104	WorkerExecutor executeBlocking holds lock WorkerExecutor blocking call completed Version Beta Context Java deadlock large application based stack trace blocked threads caused thread running WorkerExecutor executeBlocking WorkerExecutor instances order thread looked vert eventloop thread waiting lock vertx core impl WorkerExecutorImpl locked vertx core impl WorkerExecutorImpl vert eventloop thread waiting lock vertx core impl WorkerExecutorImpl locked vertx reactivex ContextScheduler ContextWorker TimedAction locked vertx core impl WorkerExecutorImpl WorkerExecutorImpl executeBlocking executeBlocking Handler Promise blockingCodeHandler ordered Handler AsyncResult asyncResultHandler fut executeBlocking blockingCodeHandler ordered asyncResultHandler fut onComplete asyncResultHandler fut onComplete call runs blockingCodeHandler finished asyncResultHandler executed current thread stay block thread executeBlocking executeBlocking thread reverse order call thread ends running asyncResultHandler deadlock reproducer simple JUnit test reproduces TestV AbstractVerticle CyclicBarrier WorkerExecutor WorkerExecutor TestV WorkerExecutor WorkerExecutor CyclicBarrier Override start Promise BrokenBarrierException InterruptedException await executeBlocking complete ign executeBlocking complete ign complete Test test TestContext context async context strictAsync CyclicBarrier CyclicBarrier vertx createSharedWorkerExecutor test vertx createSharedWorkerExecutor test vertx deployVerticle TestV ign async countDown vertx deployVerticle TestV ign async countDown Note add breakpoint WorkerExecuteImpl executeBlocking ensure blockingCodeHandler finishes fut onComplete runs asyncResultHandler Intellij Evaluate log breakpoint option insert sleep lead consistent reproductions executing test Steps reproduce suspect hard reliably reproduce carefully constructed test timing requirements specific WorkerExecutor executeBlocking holds lock WorkerExecutor blocking call completed worker context test verticle handler event create blocking
4221	Pool deliver lease connection race happen pool delivers lease Leases created pool post actions read connection slot post action executed leads NPE HttpClient closed connection connection reported comment Pool deliver lease connection set test connection max size tcp client options
4275	ConnectionBase exception handler called block ConnectionBase exception handler called block handler event verticle file channel handle queue multicast
4278	ArrayList concurrency error deploying verticles intermitent problem startup applications attempts reproduce occur vert version Java version openjdk version LTS error java util ConcurrentModificationException piece code triggering concurrency error Sort list ascending order facts sort fact fact fact order fact order DeploymentManager method registerVerticleFactory exception thrown ArrayList sort code sort Comparator expectedModCount modCount Arrays sort elementData size modCount expectedModCount ConcurrentModificationException modCount analysis ArrayList modified sorted verticles application iterate collection names invoke method vertex java rxDeployVerticle String DeploymentOptions options additional required ArrayList concurrency error deploying verticles set context verticle deployment worker options pool vertx