1247	Deadlock connection HttpClient closing Vert thread hold lock HttpClientImpl close lock acquire lock ClientConnection close lock thread hold lock ClientConnection handleClosed hold lock HttpClientImpl checkClosed boom deadlock don good repro hard reproduce consistently demonstrate stack trace Thread BLOCKED vertx core http impl ClientConnection close bci Interpreted frame vertx core http impl HttpClientImpl close bci Interpreted frame Thread BLOCKED vertx core http impl HttpClientImpl checkClosed bci Interpreted frame vertx core http impl HttpClientImpl doRequest vertx core http HttpMethod java lang String java lang String vertx core MultiMap bci Interpreted frame vertx core http impl HttpClientImpl request vertx core http HttpMethod java lang String java lang String bci Interpreted frame vertx core http impl HttpClientImpl java lang String java lang String bci Interpreted frame vertx core http impl HttpClientRequestImpl lambda exceptionHandler vertx core Handler java lang Throwable bci Interpreted frame vertx core http impl HttpClientRequestImpl Lambda handle java lang Object bci Interpreted frame vertx core http impl HttpClientRequestImpl handleException java lang Throwable bci Interpreted frame vertx core http impl ClientConnection handleClosed bci Interpreted frame vertx core net impl VertxHandler Lambda bci Interpreted frame vertx core impl ContextImpl lambda wrapTask vertx core impl ContextTask vertx core Handler bci Compiled frame vertx core impl ContextImpl Lambda bci Compiled frame vertx core impl ContextImpl executeFromIO vertx core impl ContextTask bci Compiled frame vertx core net impl VertxHandler channelInactive netty channel ChannelHandlerContext bci Interpreted frame netty channel AbstractChannelHandlerContext invokeChannelInactive bci Interpreted frame netty channel AbstractChannelHandlerContext fireChannelInactive bci Interpreted frame netty channel ChannelInboundHandlerAdapter channelInactive netty channel ChannelHandlerContext bci Interpreted frame netty handler timeout IdleStateHandler channelInactive netty channel ChannelHandlerContext bci Interpreted frame netty channel AbstractChannelHandlerContext invokeChannelInactive bci Interpreted frame netty channel AbstractChannelHandlerContext fireChannelInactive bci Interpreted frame netty handler codec ByteToMessageDecoder channelInactive netty channel ChannelHandlerContext bci Interpreted frame netty handler codec http HttpClientCodec Decoder channelInactive netty channel ChannelHandlerContext bci Interpreted frame netty channel CombinedChannelDuplexHandler channelInactive netty channel ChannelHandlerContext bci Interpreted frame netty channel AbstractChannelHandlerContext invokeChannelInactive bci Interpreted frame netty channel AbstractChannelHandlerContext fireChannelInactive bci Interpreted frame netty channel DefaultChannelPipeline fireChannelInactive bci Interpreted frame netty channel AbstractChannel AbstractUnsafe bci Interpreted frame netty util concurrent SingleThreadEventExecutor runAllTasks bci Compiled frame netty channel nio NioEventLoop bci Compiled frame netty util concurrent SingleThreadEventExecutor bci Compiled frame java lang Thread bci Compiled frame Deadlock connection HttpClient closing set socket request server options client max handler
1302	wait waitForResponse InvocationFuture MapProxySupport pollResponse invokeOperation Object MapProxyImpl get Response putInternal VertxException EventLoop thread blocked on Vertx clusteredVertx
1355	Deadlock ClientConnection HttpClientRequestImpl week attached load balancer simple poll points traffic machines instances deadlock kill theory brought testing stages big problem imagine bit hair raising simple analysis Exception handling request response locking HttpClientRequestImpl handleException getlock HttpClientRequestImpl connect lamda traffic load balancer cisco content ACE module sends request response resets connection behaviour causing deadlock live create test replicate behaviour running code Ive fixes JVM RHEL jstack Debugger attached Server compiler detected JVM version Deadlock Detection Java level deadlock vert eventloop thread waiting lock Monitor Object vertx core http impl ClientConnection held vert eventloop thread vert eventloop thread waiting lock Monitor dac Object vertx core http impl HttpClientRequestImpl held vert eventloop thread total deadlock Thread BLOCKED vertx core net impl ConnectionBase writeToChannel java lang Object bci Compiled frame vertx core http impl HttpClientRequestImpl writeHeadWithContent netty buffer ByteBuf bci Compiled frame vertx core http impl HttpClientRequestImpl connected vertx core http impl ClientConnection bci Compiled frame vertx core http impl HttpClientRequestImpl lambda connect vertx core http impl ClientConnection bci Compiled frame vertx core http impl HttpClientRequestImpl Lambda handle java lang Object bci Compiled frame vertx core http impl ConnectionManager ConnQueue lambda responseEnded vertx core http impl ConnectionManager Waiter vertx core http impl ClientConnection java lang bci Compiled frame vertx core http impl ConnectionManager ConnQueue Lambda handle java lang Object bci Compiled frame vertx core impl ContextImpl lambda wrapTask vertx core impl ContextTask vertx core Handler bci Compiled frame vertx core impl ContextImpl Lambda bci Compiled frame netty util concurrent SingleThreadEventExecutor runAllTasks bci Compiled frame netty channel nio NioEventLoop bci Compiled frame netty util concurrent SingleThreadEventExecutor bci Interpreted frame java lang Thread bci Interpreted frame Thread BLOCKED vertx core http impl HttpClientRequestImpl getLock bci Compiled frame vertx core http impl HttpClientRequestImpl handleException java lang Throwable bci Compiled frame vertx core http impl ClientConnection handleException java lang Throwable bci Compiled frame vertx core net impl VertxHandler lambda exceptionCaught netty channel Channel vertx core net impl ConnectionBase java lang Throwable bci Compiled frame vertx core net impl VertxHandler Lambda bci Compiled frame vertx core impl ContextImpl lambda wrapTask vertx core impl ContextTask vertx core Handler bci Compiled frame vertx core impl ContextImpl Lambda bci Compiled frame vertx core impl ContextImpl executeFromIO vertx core impl ContextTask bci Compiled frame vertx core net impl VertxHandler exceptionCaught netty channel ChannelHandlerContext java lang Throwable bci Compiled frame netty channel AbstractChannelHandlerContext invokeExceptionCaught java lang Throwable bci Compiled frame netty channel AbstractChannelHandlerContext fireExceptionCaught java lang Throwable bci Compiled frame netty channel ChannelInboundHandlerAdapter exceptionCaught netty channel ChannelHandlerContext java lang Throwable bci Compiled frame netty channel AbstractChannelHandlerContext invokeExceptionCaught java lang Throwable bci Compiled frame netty channel AbstractChannelHandlerContext fireExceptionCaught java lang Throwable bci Compiled frame netty channel ChannelInboundHandlerAdapter exceptionCaught netty channel ChannelHandlerContext java lang Throwable bci Compiled frame netty channel CombinedChannelDuplexHandler exceptionCaught netty channel ChannelHandlerContext java lang Throwable bci Compiled frame netty channel AbstractChannelHandlerContext invokeExceptionCaught java lang Throwable bci Compiled frame netty channel AbstractChannelHandlerContext fireExceptionCaught java lang Throwable bci Compiled frame netty handler ssl SslHandler exceptionCaught netty channel ChannelHandlerContext java lang Throwable bci Compiled frame netty channel AbstractChannelHandlerContext invokeExceptionCaught java lang Throwable bci Compiled frame netty channel AbstractChannelHandlerContext fireExceptionCaught java lang Throwable bci Compiled frame netty channel DefaultChannelPipeline fireExceptionCaught java lang Throwable bci Compiled frame netty channel nio AbstractNioByteChannel NioByteUnsafe handleReadException netty channel ChannelPipeline netty buffer ByteBuf java lang Throwable bci Compiled frame netty channel nio AbstractNioByteChannel NioByteUnsafe read bci Compiled frame netty channel nio NioEventLoop processSelectedKey java nio channels SelectionKey netty channel nio AbstractNioChannel bci Compiled frame netty channel nio NioEventLoop processSelectedKeysOptimized java nio channels SelectionKey bci Compiled frame netty channel nio NioEventLoop processSelectedKeys bci Compiled frame netty channel nio NioEventLoop bci Compiled frame netty util concurrent SingleThreadEventExecutor bci Interpreted frame java lang Thread bci Interpreted frame Deadlock ClientConnection HttpClientRequestImpl test request response connection handler http server client
1466	HttpClientRequestImpl HttpServerResponseImpl HttpClientRequestImpl Lambda 249 478457932 HttpClientRequestImpl Lambda 246 1883207809 lambda setTimeout 81 lambda exceptionHandler 80 VertxImpl InternalTimerHandler handle Impl Http handleException handleException Deadlock in ServerConnection   HttpClientRequestImpl
1469	HttpClientMetrics createEndpoint called multiple times endpoint implementation vertx core http impl ConnectionManager QueueManager getConnQueue lead HttpClientMetrics createEndpoint called multiple times endpoint threads fresh HTTP client ConnQueue connQueue queueMap address connQueue connQueue ConnQueue version address ConnQueue prev queueMap putIfAbsent address connQueue prev connQueue prev connQueue HttpClientMetrics createEndpoint called ConnQueue constructor single instance ConnQueue created map SPI implementations leak resources acquired createEndpoint closeEndpoint called queue instance HttpClientMetrics createEndpoint called multiple times endpoint handler endpoint write size client max set frame
1573	File HttpServerFileUploadImpl UnixFileSystem resolveFile FileSystemImpl FileSystemImpl 14 WindowsAsynchronousFileChannelImpl getBooleanAttributes0 FileResolver streamToFileSystem Impl VertxException Blocked thread warning when opening or closing an AsyncFile
1598	WindowsAsynchronousFileChannelImpl WindowsAsynchronousFileChannelImpl WriteTask AsyncFileImpl access 500 AsynchronousFileChannelImpl File write implWrite writeFile writeInternal Impl VertxException Asynchronous read write done on wrong thread
1633	Context executeBlocking log blocked threads description Context executeBlocking log blocked threads set context options verticle thread time worker close
1742	File caching implementation thread safe FileResolver implementation caching thread safe problem occurs file cached concurrently read multiple verticles issue reproduced FileSystem readFileBlocking async implementation yield problem file read multiple verticles parallel file reside local filesystem Vert cache file moving vertx directory verticle hits FileResolver resolveFile trigger copying action resource designated vertx cache directory copy action finished file read verticle read complete data instance hits FileResolver resolveFile find cached file resolution file copied happen read cached file copied completely verticle read partial data problem reproduced running supplied verticle multiple instances verticle reads files attached jar size outputs size read payload vertx fileread bug zip vertx data jar instances FileLengthVerticle java Sample output file data bytes file data bytes file data bytes file data bytes file data bytes file data bytes file data bytes file data bytes file data bytes file data bytes file data bytes file data bytes file data bytes file data bytes File caching implementation thread safe file set system bytes handle vertx write options
1834	Don call HttpServer request close handler holding locks Motivation ServerWebSocket HttpServerRequest close handlers called lock connection create deadlocks SockJSSocket SockJSSocket request websocket reconnects event loops Change processing Netty close event call close handlers tick scheduled context Don call HttpServer request close handler holding locks request server handler client socket event stream set
1892	Race condition setHandler completion threads projects encountered problem CompositeFuture running verticle junit tests sample program vertx core CompositeFuture vertx core vertx core Vertx java util concurrent CountDownLatch java util concurrent ExecutionException java util concurrent TimeUnit java util concurrent atomic AtomicInteger CompositeFutureTest NUMBER LOOPS Vertx vertx Vertx vertx testCompositeFuture InterruptedException ExecutionException CountDownLatch finished CountDownLatch AtomicInteger atomicCounter AtomicInteger NUMBER LOOPS vertx runOnContext complete vertx runOnContext complete CompositeFuture setHandler succeeded atomicCounter incrementAndGet NUMBER LOOPS finished countDown result finished await TimeUnit SECONDS System println String format result ERROR atomicCounter NUMBER LOOPS result main String args InterruptedException ExecutionException testCompositeFuture vertx close prints ERROR implementation CompositeFutureImpl setHandler function called composition problem completion futures runs thread setting handler functions setHandler complete atomic result situation handler called problem fundamental implementation FutureImpl thread safe threads difficulties running verticle asynchronous callbacks serialized event loop concurrently don expected behaviour Futures compositions verticles understanding based implementation CompositeFutureImpl intention thread safe Race condition setHandler completion threads blocking set test file thread options close handle
2012	Race condition AsyncFileImpl writesOutstanding AsyncFileImpl written thread context created counter writesOutstanding invalid counter updated caller thread context write complete AtomicLong writesOutstanding https gist github purplefox Race condition AsyncFileImpl writesOutstanding test internal thread multicast file handle write handler
2370	HttpClient pool inconsistent synchronous connection failure HttpClient pool assumes underlying ConnectionProvider asynchronous callback asynchronous DNS resolver JVM synchronous resolver host resolved HttpClient pool inconsistent synchronous connection failure set test connection max size options socket client
2418	deadlock multiple locks code illustrates problem Consumer verticle acuires lock stuck reproduced problem HazelcastClusterManager IgniteClusterManager Vertx clusteredVertx VertxOptions setClusterManager HazelcastClusterManager result Vertx vertx result result messagesToSend Consumer consumer Consumer vertx deployVerticle consumer DeploymentOptions event event succeeded vertx deployVerticle Supplier messagesToSend DeploymentOptions vertx setTimer messagesToSend LOCK TIMEOUT timer failsNumber messagesToSend consumer counter sum failsNumber System err println Failed failsNumber locks vertx close Supplier AbstractVerticle messagesToSend Supplier messagesToSend messagesToSend messagesToSend Override start LongAdder LongAdder vertx setPeriodic timer vertx eventBus send TEST ADDRESS message increment System println sum messages sum messagesToSend vertx cancelTimer timer Consumer AbstractVerticle LongAdder counter LongAdder Override start startFuture vertx eventBus consumer TEST ADDRESS event vertx sharedData getLock lock lock lock failed System println Failed lock lock System println Succeeded lock vertx sharedData getLock lock lock lock failed System println Failed lock lock System println Succeeded lock counter increment System println counter sum messages consumed lock result release lock result release completionHandler startFuture deadlock multiple locks set handler request server handle internal append write
2670	Client connections GlobalEventExecutor thread propagated application Netty bootstrap notify client connections GlobalEventExecutor thread early boostrap event loop determined Vertx expects notifications happen event loop thread Event loop context executing wrong thread failure Client connections GlobalEventExecutor thread propagated application set socket options max size tcp handler pool
2684	MongoIterableStream lambda doRead 5 AsyncQueryBatchCursor CommandResultSingleResultCallback lambda null 3 AsyncQueryBatchCursor ErrorHandlingResultCallback FutureImpl handleGetMoreQueryResult tryComplete access 300 onResult Error executeBlocking callback run on the wrong thread for asynchronous future resolution
2773	HttpClient race condition connection pool closed race condition HttpClient client request connection close pool delivers client request tick connection removed pool schedule delivery moment client connection closed aware connection close avoid tick situation client request fulfilled valid connection called avoid race fact connection pool hold connections multiples context pool requests pool situation hard avoid check connection delivered solution attach vertx context pool connections context eliminate race easily HttpClient race condition connection pool closed set test connection handler socket max size options
2916	HTTP event handler called holding lock event handlers called holding lock lead deadlocks remove HTTP event handler called holding lock handler message write local blocking context node read
2982	HttpClientRequestImpl VertxHandler Lambda 757 154866834 lambda channelWritabilityChanged 3 handleInterestedOpsChanged Http1xClientConnection handleDrained executeFromIO ContextImpl EventLoopContext VertxHandler handle HTTP Client   Deadlock
3064	HttpServerResponse operation fail synchronously stream closed improvements behaviour responses methods stream ended user fail synchronously programming mistake stream closed fail synchronously fail asynchronously Vert synchronous operation result failed HttpServerResponse operation fail synchronously stream closed handler set stream http test connection handle request
3140	lock handler calls AsyncFile AsyncFile implementation calls file handlers block synchronization reading handler calling lock handler calls AsyncFile file test stream dir read write async copy
3142	Deadlock deploying instances verticle starting net server regression Deadlock deploying instances verticle starting net server set verticle pool redeploy create time client handler
3232	SingleThreadEventExecutor EventLoopContext offerTask addTask execute dispatch FutureImpl reject Task doDispatch Event Exception RejectedExecutionException Vertx close Future will not callback the handler
3335	FileSystemImpl existsInternal block event loop thread Version Context Invoking vertx filesystem exists block event loop thread resolveFile runs event loop thread worker thread https github eclipse vertx vert blob master src main java vertx core file impl FileSystemImpl java BlockingAction existsInternal String path Objects requireNonNull path BlockingAction File file vertx resolveFile path perform file exists resolveFile called perform method BlockingAction existsInternal String path Objects requireNonNull path BlockingAction perform File file vertx resolveFile path file exists reproducer mock calls resolveFile sleep amount time set breakpoint resolveFile call test runs Wait blocked thread checker interval unpause execution BlockedThreadChecker report thread blocked Steps reproduce FileSystemImpl existsInternal block event loop thread set handler thread close time event worker file
3468	HttpClientDoubleFail Lambda 34 1409160703 HttpClientRequestImpl ConnectionManager Connection lambda test 2 getConnection getConnectionForRequest HttpClientImpl HttpClientDoubleFail lambda dispatch 0 Http handleException VertxException Thread blocked in io vertx core net impl clientconnection ConnectionManager getConnection
3469	HTTP client retry host deadlock HTTP client retrying host failure deadlock close pool performs callback close pool retries fail retry indefinitely HTTP client retry host deadlock test client set proxy server http trust cert
3658	CompositeFutureImpl lambda all 0 tryFail fail FutureImpl Impl Composite 0 lambda Fail IllegalStateException Exception Race condition throws an unhandled exception in CompositeFuture all
4024	Concurrency issue listener TCPServerBase listen Version Context stumbled concurrency issue debugging TCPServerBase context race happening listener registered bindFuture addListener code running listen method doBind bindFuture addListener listener notified listener setting field actual port field pre set listener port dependening faster listener method code sharedNetServers pick actual port predictable debugging waited sharedNetServers random port verticle correct term debugging random port Concurrency issue listener TCPServerBase listen handler server connection handle stream http socket request
4069	VertxImpl SharedWorkerPool close WorkerExecutorImpl Worker Impl WorkerExecutor CloseFuture VertxImpl Vertx Executor Shared Deadlock when closing Vertx and WorkerExecutor concurrently
4104	lambda rxExecuteBlocking 2 executeBlocking WorkerExecutor Lambda 1166 0x0000000840a2b440 MaybeFlatten FlatMapMaybeObserver InnerObserver WorkerExecutorImpl WorkerExecutor lambda subscribeActual 0 AsyncResultMaybe Lambda 325 0x0000000840303840 onComplete AsyncResultMaybe MaybeFilter FilterMaybeObserver BrokenBarrierException InterruptedException WorkerExecutor executeBlocking sometimes holds a lock on the WorkerExecutor after the blocking call has completed
4221	Pool deliver lease connection race happen pool delivers lease Leases created pool post actions read connection slot post action executed leads NPE HttpClient closed connection connection reported comment Pool deliver lease connection set test connection max size tcp client options
4275	ConnectionBase exception handler called block ConnectionBase exception handler called block handler event verticle file channel handle queue multicast
4278	ArrayList registerVerticleFactory sort DeploymentManager Array List VertxImpl Deployment Manager Factory Verticle ConcurrentModificationException ArrayList concurrency error when deploying the verticles