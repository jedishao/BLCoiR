1810	SFSB tx lock not released in exception was thrown in Synchronization callback  Because the owning tx was never pushed into the OwnableReentrantLock ownership stack in org jboss as ejb3 component stateful StatefulSessionSynchronizationInterceptor handleThrowableInTxSync       This will cause subsequent Lock tryAcquire     to fail for a different tx
2016	Security context associated with EJB asynchronous invocations can potentially be corrupted over time by the caller thread  Consider a servlet  S  which invokes on a asynchronous EJB  A   Let s assume  S  runs with a  foo  run as role  Now when S invokes on  A   the run as  foo  role is correctly propagated to the asynchronous EJB invocation  However  when the  S  invocation completes and potentially clears the security context  of any run as role   the invocation s  within the asynchronous EJB  A  too lose the corresponding security context role association  This is because the 2 threads  the servlet invocation one and the async EJB invocation one  literally share the same object instance of the SecurityContext  The expected behaviour is that the original security context  attributes  are copied over to the async invocation and updates to that security context later on in a separate thread shouldn t affect the ongoing async EJB invocation
2065	Update jboss transaction spi  The JPA integration test suite tests that the afterCompletion synchonization callback for timed out transactions is called from the TM transaction reaper thread by hard coding the reaper thread name  The latest SPI jar includes an interface method that does the same job  I d like to update the test suite to use the new SPI method  I have marked the jira as a bug since testing against the reaper thread name is brittle
2458	Re deployment of a clustered application fail due to race condition with infinispan  If a clustered application should be redeployed it looks like that infinispan is not able to stop complete until the deployer finish undeployment and start to deploy the new application  See the Exception below  The behaviour is the same for managed or unmanged deployments  If it is unmanaged the  failed marker file exists  After the failure the application is shown in the mgmt console without deployed Beans  A second deploy attempt will be successfull 11 22 36 397 INFO   org infinispan remoting transport jgroups JGroupsTransport   Incoming 1 shared udp  ISPN000094  Received new cluster view   home ejb 1   2   home ejb  node2 ejb  11 22 52 746 INFO   org jboss weld deployer   MSC service thread 1 11  JBAS016009  Stopping weld service for deployment appone ear 11 22 52 751 INFO   org infinispan eviction PassivationManagerImpl   ServerService Thread Pool  58  ISPN000029  Passivating all entries to disk 11 22 52 752 INFO   org infinispan eviction PassivationManagerImpl   ServerService Thread Pool  58  ISPN000030  Passivated 0 entries in 0 milliseconds 11 22 52 759 INFO   org jboss as clustering infinispan   ServerService Thread Pool  58  JBAS010282  Stopped repl cache from ejb container 11 22 52 765 INFO   org jboss as clustering infinispan   ServerService Thread Pool  60  JBAS010282  Stopped remote connector client mappings cache from ejb container 11 22 52 768 INFO   org infinispan remoting transport jgroups JGroupsTransport   MSC service thread 1 6  ISPN000080  Disconnecting and closing JGroups Channel 11 22 52 771 INFO   org jboss as server deployment   MSC service thread 1 3  JBAS015877  Stopped deployment null  runtime name  ejb jar  in 36ms 11 22 52 772 INFO   org jboss as server deployment   MSC service thread 1 11  JBAS015877  Stopped deployment appone ear  runtime name  appone ear  in 39ms 11 22 52 773 INFO   org jboss as server deployment   MSC service thread 1 5  JBAS015876  Starting deployment of  appone ear   runtime name   appone ear   11 22 52 778 INFO   org jboss as server deployment   MSC service thread 1 4  JBAS015876  Starting deployment of  null   runtime name   ejb jar   11 22 52 792 INFO   org jboss weld deployer   MSC service thread 1 12  JBAS016002  Processing weld deployment appone ear 11 22 52 803 INFO   org jboss weld deployer   MSC service thread 1 5  JBAS016002  Processing weld deployment ejb jar 11 22 52 805 INFO   org jboss as ejb3 deployment processors EjbJndiBindingsDeploymentUnitProcessor   MSC service thread 1 5  JNDI bindings for session bean named AppOneBean in deployment unit subdeployment  ejb jar  of deployment  appone ear  are as follows  java global appone ejb AppOneBeanorg jboss as quickstarts ejb multi server app AppOne java app ejb AppOneBeanorg jboss as quickstarts ejb multi server app AppOne java module AppOneBeanorg jboss as quickstarts ejb multi server app AppOne java jboss exported appone ejb AppOneBeanorg jboss as quickstarts ejb multi server app AppOne java global appone ejb AppOneBean java app ejb AppOneBean java module AppOneBean 11 22 52 807 INFO   org jboss weld deployer   MSC service thread 1 11  JBAS016005  Starting Services for CDI deployment  appone ear 11 22 52 811 INFO   org jboss weld deployer   MSC service thread 1 3  JBAS016008  Starting weld service for deployment appone ear 11 22 53 087 INFO   org infinispan remoting transport jgroups JGroupsTransport   MSC service thread 1 6  ISPN000082  Stopping the RpcDispatcher 11 22 53 118 INFO   org infinispan remoting
2467	Deadlock on startup if configured w 8 transactional Infinispan cachesCacheConfigurationService should be installed using AsynchronousService wrapper
2954	Transaction Synchronization registration issue with injected JMSContextThe JMSContextProducer registers a tx Synchronization object directly on the Transaction  That leads to issue when other parts register other Synchronization objects later on  see http   stackoverflow com questions 21523534 jboss wildfly arjuna016082 synchronizations are not allowed when sending mess   The JSMContextProducer must switch to using TransactionSynchronizationRegistry instead to register syncs
3259	Race condition in built in ServletContextListenersWeldComponentIntegrationProcessor properly adds service dependency on the WeldStartService  This however does not happen for built in components e g  Mojarra s com sun faces config ConfigureListener which does use CDI  As a result  the deployment may fail depending on timing of WeldStartService and UndertowDeploymentService      15 34 53 108 SEVERE  javax enterprise resource webcontainer jsf config   MSC service thread 1 5  Critical error during deployment    org jboss weld context ContextNotActiveException  WELD 001303  No active contexts for scope type javax faces flow builder FlowDefinition          15 34 53 120 ERROR  org jboss msc service fail   MSC service thread 1 5  MSC000001  Failed to start service jboss undertow deployment default server default host  test  org jboss msc service StartException in service jboss undertow deployment default server default host  test  Failed to start service                         Caused by  java lang RuntimeException  java lang RuntimeException  org jboss weld context ContextNotActiveException  WELD 001303  No active contexts for scope type javax faces flow builder FlowDefinition          at org wildfly extension undertow deployment UndertowDeploymentService startContext UndertowDeploymentService java 86      at org wildfly extension undertow deployment UndertowDeploymentService start UndertowDeploymentService java 71      at org jboss msc service ServiceControllerImpl StartTask startService ServiceControllerImpl java 1948   jboss msc 1 2 2 Final jar 1 2 2 Final      at org jboss msc service ServiceControllerImpl StartTask run ServiceControllerImpl java 1881   jboss msc 1 2 2 Final jar 1 2 2 Final          3 more     Caused by  java lang RuntimeException  org jboss weld context ContextNotActiveException  WELD 001303  No active contexts for scope type javax faces flow builder FlowDefinition     at com sun faces config ConfigureListener contextInitialized ConfigureListener java 274      at io undertow servlet core ApplicationListeners contextInitialized ApplicationListeners java 173      at io undertow servlet core DeploymentManagerImpl deploy DeploymentManagerImpl java 189          7 more     Caused by  org jboss weld context ContextNotActiveException  WELD 001303  No active contexts for scope type javax faces flow builder FlowDefinition     at org jboss weld manager BeanManagerImpl getContext BeanManagerImpl java 684      at org jboss weld util ForwardingBeanManager getContext ForwardingBeanManager java 181      at com sun faces application ApplicationAssociate PostConstructApplicationListener loadFlows ApplicationAssociate java 323      at com sun faces application ApplicationAssociate PostConstructApplicationListener processEvent ApplicationAssociate java 303      at javax faces event SystemEvent processListener SystemEvent java 108      at com sun faces application ApplicationImpl processListeners ApplicationImpl java 2187      at com sun faces application ApplicationImpl invokeListenersFor ApplicationImpl java 2163      at com sun faces application ApplicationImpl publishEvent ApplicationImpl java 296      at org jboss as jsf injection weld ForwardingApplication publishEvent ForwardingApplication java 294      at com sun faces config ConfigManager publishPostConfigEvent ConfigManager java 692      at com sun faces config ConfigureListener contextInitialized ConfigureListener java 254          9 more          15 34 53 407 ERROR  org jboss as controller management operation   management handler thread   1  JBAS014613  Operation   deploy   failed   address      deployment   &gt   test ear       failure description    JBAS014671  Failed services   &gt    jboss undertow deployment default server default host  test   &gt   org jboss msc service StartException in service jboss undertow deployment default server default host  test  Failed to start service     Caused by  java lang RuntimeException  java lang RuntimeException  org jboss weld context ContextNotActiveException  WELD 001303  No active contexts for scope type javax faces flow builder FlowDefinition     Caused by  java lang RuntimeException  org jboss weld context ContextNotActiveException  WELD 001303  No active contexts for scope type javax faces flow builder FlowDefinition     Caused by  org jboss weld context ContextNotActiveException  WELD 001303  No active contexts for scope type javax faces flow builder FlowDefinition        15 34 53 415 ERROR  org jboss as server   management handler thread   1  JBAS015870  Deploy of deployment  test ear  was rolled back with the following failure message        JBAS014671  Failed services   &gt    jboss undertow deployment default server default host  test   &gt   org jboss msc service StartException in service jboss undertow deployment default server default host  test  Failed to start service     Caused by  java lang RuntimeException  java lang RuntimeException  org jboss weld context ContextNotActiveException  WELD 001303  No active contexts for scope type javax faces flow builder FlowDefinition     Caused by  java lang RuntimeException  org jboss weld context ContextNotActiveException  WELD 001303  No active contexts for scope type javax faces flow builder FlowDefinition     Caused by  org jboss weld context ContextNotActiveException  WELD 001303  No active contexts for scope type javax faces flow builder FlowDefinition
3280	Thread locking problem when app server is going to shutdownI face problem that remoting thread and MSC service thread is deadlocked when server is going to shutdown  This happens in half of the cases when I run my integration arquillian tests again EAP 6 3 0 engineering releases  I deploy one testing application packaged as jar file and then jdbc driver is deployed by copying to deployments folder  I m attaching server log file and thread dump at the time when threads are stuck  I was trying to find out where the lock occurs and from the stack trace it happens on two places  One is lock on remoting queue and other is lock on DeploymentRepository object  I did a quick fix which seems to work for me that I removed synchronized keyword from the methods which remove listeners in DeploymentRepository  It means from  https   github com jbossas jboss eap blob 6 x ejb3 src main java org jboss as ejb3 deployment DeploymentRepository java L103 and https   github com jbossas jboss eap blob 6 x ejb3 src main java org jboss as ejb3 deployment DeploymentRepository java L107 I m really not sure whether this is a correct fix but I just put my observation here to have some starting point  This could not be trouble in remoting directly  maybe it s rather problem of MSC component  If so  please  change the jira type  Thank you
3338	JMSContext is not thread safe  Section 12 4 4 of the JMS 2 0 spec says   If a method is called on an injected JMSContext when there is a JTA transaction  either bean managed or container managed   the scope of the JMSContext will be  TransactionScoped  This is not currently true in WildFly  As a test case  suppose you have the following two beans   import javax annotation Resource   import javax enterprise context ApplicationScoped   import javax enterprise inject Instance    import javax inject Inject   import javax jms JMSContext    import javax jms Topic    import javax transaction Transactional    ApplicationScoped      Transactional     public class AppScopedBean             Inject     private JMSContext jmsCtx        private Instance&lt JMSContext&gt  jmsCtx       Resource lookup    jms topic test       private Topic topic           public void sendMessage         jmsCtx createProducer   setDisableMessageID true  setDisableMessageTimestamp true  send topic   a message          jmsCtx get   createProducer   setDisableMessageID true  setDisableMessageTimestamp true  send topic   a message                                 import javax annotation Resource      import javax enterprise concurrent ManagedThreadFactory      import javax enterprise context ApplicationScoped      import javax enterprise context Dependent      import javax enterprise context Initialized      import javax enterprise event Observes      import javax inject Inject            Dependent     public class ThreadLauncher             Resource     private ManagedThreadFactory threadFactory       Inject     private AppScopedBean bean           void start  Observes  Initialized ApplicationScoped class  Object event        System out println  starting threads        for  int i   0  i &lt  5  i          threadFactory newThread new SendRunnable    start              System out println  start finished                   private class SendRunnable implements Runnable            public void run         System out println  starting to send        for  int i   0  i &lt  100  i          bean sendMessage              System out println  done sending                                      If you deploy and run the above code  you will see a lot of this   2014 05 12 16 46 02 936 WARN   org hornetq core client   EE ManagedThreadFactory default Thread 4  HQ212051  Invalid concurrent session usage  Sessions are not supposed to be used by more than one thread concurrently  That should not be happening if the JMSContext is really  TransactionScoped  The problem appears to be in org jboss as messaging deployment JMSContextProducer  specifically the JMSContextWrapper getDelegate   method  If two threads call it at the same time  the first will create a delegate but the second will receive the same delegate as the first  because the delegate doesn t get nulled until the transaction in the first thread completes  This means that both threads are using the same session at the same time  which is not allowed  I don t know how HornetQ detects concurrent use  but depending on how that works  it s also possible that messages will end up being part of the wrong transaction  A workaround is to inject Instance JMSContext instead of JMSContext directly  the two commented out lines of code   Since the JMSContext producer is  Dependent  each Instance get   call will return a new instance  and only one thread will ever use any given instance
3381	Possible race between remote process  receipt of a cancellation request and its receipt of the initial request  It s possible that if a managed domain operation that sends a request to another process in the domain is cancelled immediately after initiating sending of that request that the cancellation request will be received before the original request  If that occurs  the cancellation request will fail  as there is no ActiveOperation to cancel  and then the original request can hang waiting for a tx commit rollback that will never arrive  See http   brontes lab eng brq redhat com viewLog html buildId 15650&amp tab buildResultsDiv&amp buildTypeId WF_MasterLinux testNameId2482043836298342768 for a case where this occurred
3396	NPE in TimerResourceDefinitionI am experiencing race conditions when running test remotely from Arquillian to Wildfly 8 1 0 CR2  In 2 of 3 Cases i get a NPE in Wildfly in relation to one of my own scheduled EJB  Stacktrace        10 08 56 169 INFO   org jboss as server   management handler thread   1  JBAS018559  Deployed  core dist 0 6 ear   runtime name    core dist 0 6 ear       10 08 58 102 ERROR  org jboss as controller management operation   management handler thread   2  JBAS014612  Operation   read attribute   failed   address           deployment   &gt   core dist 0 6 ear          subdeployment   &gt   core jar          subsystem   &gt   ejb3          singleton bean   &gt   FileDeploymentScanner          service   &gt   timer service          timer   &gt   53ca8249 b0a1 42ab 810b abad39cb3d19           java lang NullPointerException     at org jboss as ejb3 subsystem deployment TimerResourceDefinition 10 readAttribute TimerResourceDefinition java 268      at org jboss as ejb3 subsystem deployment TimerResourceDefinition AbstractReadAttributeHandler executeRuntime TimerResourceDefinition java 364      at org jboss as ejb3 subsystem deployment TimerResourceDefinition AbstractTimerHandler 1 execute TimerResourceDefinition java 330      at org jboss as controller AbstractOperationContext executeStep AbstractOperationContext java 606   wildfly controller 8 1 0 CR2 jar 8 1 0 CR2      at org jboss as controller AbstractOperationContext doCompleteStep AbstractOperationContext java 484   wildfly controller 8 1 0 CR2 jar 8 1 0 CR2      at org jboss as controller AbstractOperationContext completeStepInternal AbstractOperationContext java 281   wildfly controller 8 1 0 CR2 jar 8 1 0 CR2      at org jboss as controller AbstractOperationContext executeOperation AbstractOperationContext java 276   wildfly controller 8 1 0 CR2 jar 8 1 0 CR2      at org jboss as controller ModelControllerImpl internalExecute ModelControllerImpl java 271   wildfly controller 8 1 0 CR2 jar 8 1 0 CR2      at org jboss as controller ModelControllerImpl execute ModelControllerImpl java 145   wildfly controller 8 1 0 CR2 jar 8 1 0 CR2      at org jboss as controller remote ModelControllerClientOperationHandler ExecuteRequestHandler doExecute ModelControllerClientOperationHandler java 199   wildfly controller 8 1 0 CR2 jar 8 1 0 CR2      at org jboss as controller remote ModelControllerClientOperationHandler ExecuteRequestHandler access 300 ModelControllerClientOperationHandler java 130   wildfly controller 8 1 0 CR2 jar 8 1 0 CR2      at org jboss as controller remote ModelControllerClientOperationHandler ExecuteRequestHandler 1 1 run ModelControllerClientOperationHandler java 150   wildfly controller 8 1 0 CR2 jar 8 1 0 CR2      at org jboss as controller remote ModelControllerClientOperationHandler ExecuteRequestHandler 1 1 run ModelControllerClientOperationHandler java 146   wildfly controller 8 1 0 CR2 jar 8 1 0 CR2      at java security AccessController doPrivileged Native Method   rt jar 1 7 0_55      at javax security auth Subject doAs Subject java 415   rt jar 1 7 0_55      at org jboss as controller AccessAuditContext doAs AccessAuditContext java 94   wildfly controller 8 1 0 CR2 jar 8 1 0 CR2      at org jboss as controller remote ModelControllerClientOperationHandler ExecuteRequestHandler 1 execute ModelControllerClientOperationHandler java 146   wildfly controller 8 1 0 CR2 jar 8 1 0 CR2      at org jboss as protocol mgmt AbstractMessageHandler 2 1 doExecute AbstractMessageHandler java 283   wildfly protocol 8 1 0 CR2 jar 8 1 0 CR2      at org jboss as protocol mgmt AbstractMessageHandler AsyncTaskRunner run AbstractMessageHandler java 504   wildfly protocol 8 1 0 CR2 jar 8 1 0 CR2      at java util concurrent ThreadPoolExecutor runWorker ThreadPoolExecutor java 1145   rt jar 1 7 0_55      at java util concurrent ThreadPoolExecutor Worker run ThreadPoolExecutor java 615   rt jar 1 7 0_55      at java lang Thread run Thread java 745   rt jar 1 7 0_55      at org jboss threads JBossThread run JBossThread java 122   jboss threads 2 1 1 Final jar 2 1 1 Final        The arquillian test prints             com ieffects core integration ImportTest STANDARD_ERROR     May 23  2014 10 08 49 AM org xnio Xnio &lt clinit&gt      INFO  XNIO version 3 2 2 Final     May 23  2014 10 08 49 AM org xnio nio NioXnio &lt clinit&gt      INFO  XNIO NIO Implementation Version 3 2 2 Final     May 23  2014 10 08 49 AM org jboss remoting3 EndpointImpl &lt clinit&gt      INFO  JBoss Remoting version 4 0 3 Final     May 23  2014 10 08 58 AM org jboss as arquillian container ManagementClient checkSuccessful     ERROR  Operation        operation   &gt   read resource        recursive   &gt   true        address   &gt  undefined       did not succeed  Result was        outcome   &gt   failed        result   &gt         management major version   &gt  2       management micro version   &gt  0       management minor version   &gt  1       name   &gt   cust        namespaces   &gt           product name   &gt  undefined       product version   &gt  undefined       profile name   &gt  undefined       release codename   &gt   Kenny        release version   &gt   8 1 0 CR2        schema locations   &gt           core service   &gt         management   &gt         access   &gt         authorization   &gt            the complete wildfly configuration                rolled back   &gt  true             My scheduled Service FileDeploymentScanner is somewhat special  it schedules the times itself  No Schedule annotation  Simplified it looks like this         ConcurrencyManagement ConcurrencyManagementType BEAN       Singleton      Startup      TransactionAttribute TransactionAttributeType NOT_SUPPORTED      public class FileDeploymentScanner             Resource     private TimerService _timerService                     Scans and deploys files according to configuration              Timeout     public void handleClick         System out println  handle click                             Initializes the service              PostConstruct     public void startup         System out println  Starting timer service        _timerService createSingleActionTimer 10000  new TimerConfig  FileDeploymentScanner   false        try       Thread sleep 10000         catch  InterruptedException e           TODO Auto generated catch block     e printStackTrace              System out println  Started timer service                           What is happening  is  the arquillian client apparently tries to read complete wildfly configuration  dont know why   and during this step it fails to do so  I failed to write reproducer ear app  I can&amp apos t release my closed source though which produces this error  But hopefully  this NPE is easy to fix
3517	DeploymentMountProvider leaks thread poolsDeploymentMountProvider start   calls Executors newScheduledThreadPool but stop   does not shutdown the pool  The effect is the reload command results in a slow thread leak that will eventually result in OOM
3548	JTA synchronization for a distributed transaction called with incorrect TCCLIt seems the RequestProcessor which is processing JTA synchronizations does not have the right TCCL set  As a result  during synchronization invocation  NameNotFoundException is thrown for a JNDI lookup of  java comp UserTransaction  if we try to acccess org jboss weld Container by means of org jboss as weld services ModuleGroupSingletonProvider TCCLSingleton  we get ISE   Singleton not set    This means that you are trying to access a weld deployment with a Thread Context ClassLoader that is not associated with the deployment
3695	Distributed web session expiration ScheduledExecutorService leaks threads on undeployThe ScheduledExecutorService employed by the SessionExpirationScheduler uses shutdown   to shutdown the thread pool   however  unless we explicitly setExecuteExistingDelayedTasksAfterShutdownPolicy false   all scheduled tasks will attempt to execute after shutdown
3715	Async servlets cause lock timeouts for distributable sessions  This happens because Infinispan s BatchContainer relies on thread locals  We need to use the new Batcher capabilities used by ejb clustering for web clustering  These modules should be refactored so they can share these objects
3727	Race condition during channel create vs start causing NPE on channel startupMy hunch is that this is due to the fact that WildFly creates a channel in one thread but starts it in another  Specifically  Protocol up_prot is set by ChannelService start    via new JChannel       but is accessed by GlobalComponentRegistryService start    via Channel connect         which happen in different threads  To prevents NPEs like the one below  we need to ensure that any variables set during channel creation are volatile    ERROR  org jboss msc service fail   ServerService Thread Pool    30  MSC000001  Failed to start service jboss infinispan ejb global component registry  org jboss msc service StartException in service jboss infinispan ejb global component registry  org infinispan manager EmbeddedCacheManagerStartupException  org infinispan commons CacheException  Unable to invoke method public void org infinispan remoting transport jgroups JGroupsTransport start   on object of type ChannelTransport     at org jboss as clustering msc AsynchronousService 1 run AsynchronousService java 91      at java util concurrent ThreadPoolExecutor runWorker ThreadPoolExecutor java 1145   rt jar 1 7 0_51      at java util concurrent ThreadPoolExecutor Worker run ThreadPoolExecutor java 615   rt jar 1 7 0_51      at java lang Thread run Thread java 744   rt jar 1 7 0_51      at org jboss threads JBossThread run JBossThread java 122   jboss threads 2 1 1 Final jar 2 1 1 Final      Caused by  org infinispan manager EmbeddedCacheManagerStartupException  org infinispan commons CacheException  Unable to invoke method public void org infinispan remoting transport jgroups JGroupsTransport start   on object of type ChannelTransport     at org infinispan factories GlobalComponentRegistry start GlobalComponentRegistry java 241      at org jboss as clustering infinispan subsystem GlobalComponentRegistryService start GlobalComponentRegistryService java 33      at org jboss as clustering msc AsynchronousService 1 run AsynchronousService java 86          4 more     Caused by  org infinispan commons CacheException  Unable to invoke method public void org infinispan remoting transport jgroups JGroupsTransport start   on object of type ChannelTransport     at org infinispan commons util ReflectionUtil invokeAccessibly ReflectionUtil java 185      at org infinispan factories AbstractComponentRegistry PrioritizedMethod invoke AbstractComponentRegistry java 869      at org infinispan factories AbstractComponentRegistry invokeStartMethods AbstractComponentRegistry java 638      at org infinispan factories AbstractComponentRegistry internalStart AbstractComponentRegistry java 627      at org infinispan factories AbstractComponentRegistry start AbstractComponentRegistry java 530      at org infinispan factories GlobalComponentRegistry start GlobalComponentRegistry java 219          6 more     Caused by  org infinispan commons CacheException  Unable to start JGroups Channel     at org infinispan remoting transport jgroups JGroupsTransport startJGroupsChannelIfNeeded JGroupsTransport java 198      at org infinispan remoting transport jgroups JGroupsTransport start JGroupsTransport java 187      at sun reflect NativeMethodAccessorImpl invoke0 Native Method   rt jar 1 7 0_51      at sun reflect NativeMethodAccessorImpl invoke NativeMethodAccessorImpl java 57   rt jar 1 7 0_51      at sun reflect DelegatingMethodAccessorImpl invoke DelegatingMethodAccessorImpl java 43   rt jar 1 7 0_51      at java lang reflect Method invoke Method java 606   rt jar 1 7 0_51      at org infinispan commons util ReflectionUtil invokeAccessibly ReflectionUtil java 183          11 more     Caused by  java lang NullPointerException     at org jgroups protocols pbcast GMS up GMS java 1010      at org jgroups protocols pbcast STABLE up STABLE java 245      at org jgroups protocols UNICAST3 up UNICAST3 java 391      at org jgroups protocols pbcast NAKACK2 up NAKACK2 java 600      at org jgroups protocols VERIFY_SUSPECT up VERIFY_SUSPECT java 147      at org jgroups protocols FD up FD java 255      at org jgroups protocols FD_SOCK up FD_SOCK java 301      at org jgroups protocols MERGE2 up MERGE2 java 209      at org jgroups protocols Discovery up Discovery java 522      at org jgroups protocols MPING up MPING java 181      at org jgroups protocols TP fetchLocalAddresses TP java 2001      at org jgroups protocols TP start TP java 1131      at org jgroups protocols TCP start TCP java 82      at org jgroups stack ProtocolStack startStack ProtocolStack java 938      at org jgroups JChannel startStack JChannel java 864      at org jgroups JChannel _preConnect JChannel java 527      at org jgroups JChannel connect JChannel java 284      at org jgroups JChannel connect JChannel java 275      at org infinispan remoting transport jgroups JGroupsTransport startJGroupsChannelIfNeeded JGroupsTransport java 196          17 more
3731	org jboss as ejb3 component stateful StatefulSessionSynchronizationInterceptor should not register a Synchronization if the transaction was rolled back  http   fpaste org 125252  shows what happens when the transaction has already been rolled back      WFLYEJB0458  Failure in caller transaction   java lang IllegalStateException  No transaction is running at com arjuna ats internal jta transaction arjunacore TransactionSynchronizationRegistryImple getTransactionImple TransactionSynchronizationRegistryImple java 228   09 02 13 666 INFO   stdout   default task 1  about to create entity 3253 09 02 13 666 INFO   org jboss as jpa   default task 1  tx status   0 09 02 13 666 WARN   com arjuna ats arjuna   Transaction Reaper  ARJUNA012117  TransactionReaper  check timeout for TX 0 ffff7f000001 11d28655 53eb58d3 87 in state  RUN 09 02 13 666 INFO   org jboss as jpa   default task 1  tx status   0 09 02 13 667 INFO   stdout   default task 1  repeating invocation  count 3253 09 02 13 667 INFO   stdout   default task 1  about to create entity 3254 09 02 13 667 WARN   com arjuna ats arjuna   Transaction Reaper Worker 0  ARJUNA012095  Abort of action id 0 ffff7f000001 11d28655 53eb58d3 87 invoked while multiple threads active within it  09 02 13 667 WARN   com arjuna ats arjuna   Transaction Reaper Worker 0  ARJUNA012108  CheckedAction  check   atomic action 0 ffff7f000001 11d28655 53eb58d3 87 aborting with 1 threads active 09 02 13 667 INFO   org jboss as jpa   default task 1  tx status   0 09 02 13 668 INFO   org jboss as jpa   default task 1  tx status   4 09 02 13 668 INFO   stdout   default task 1  repeating invocation  count 3254 09 02 13 668 INFO   stdout   default task 1  about to create entity 3255 09 02 13 668 INFO   org jboss as jpa   default task 1  tx status   4 09 02 13 668 INFO   org jboss as jpa   default task 1  tx status   4 09 02 13 668 INFO   stdout   default task 1  repeating invocation  count 3255 09 02 13 668 INFO   stdout   default task 1  about to create entity 3256 09 02 13 669 INFO   org jboss as jpa   default task 1  tx status   4 09 02 13 669 INFO   org jboss as jpa   default task 1  tx status   4 09 02 13 669 INFO   stdout   default task 1  repeating invocation  count 3256 09 02 13 669 INFO   stdout   default task 1  about to create entity 3257 09 02 13 669 INFO   org jboss as jpa   default task 1  tx status   4 09 02 13 669 INFO   org jboss as jpa   default task 1  tx status   4 09 02 13 669 INFO   stdout   default task 1  repeating invocation  count 3257 09 02 13 669 INFO   stdout   default task 1  about to create entity 3258 09 02 13 670 INFO   org jboss as jpa   default task 1  tx status   4 09 02 13 670 INFO   org jboss as jpa   default task 1  tx status   4 09 02 13 670 INFO   stdout   default task 1  repeating invocation  count 3258 09 02 13 670 INFO   stdout   default task 1  about to create entity 3259 09 02 13 670 INFO   org jboss as jpa   default task 1  tx status   4 09 02 13 670 INFO   org jboss as jpa   default task 1  tx status   4 09 02 13 670 INFO   stdout   default task 1  repeating invocation
3942	Race condition with clean shutdown and mod_cluster session draining  Probably same issue exists in WF as well  I will revalidate the logic for race conditions  https   issues jboss org browse MODCLUSTER 399 https   bugzilla redhat com show_bug cgi id 1083563
4133	Hanging EJB threads because of a persistent timer and failed deployment  When there is a time service with pending timeouts a bad redeploy can hang worker threads in the server
4310	Race condition registering resource adapters at startupUpstream Jira of https   bugzilla redhat com show_bug cgi id 1184610 Please see bugzilla description for details and reproducer        Description of problem      During startup of JBoss  the following occurs randomly  not on every start            java lang IllegalStateException  JBAS014666  Duplicate resource resource adapters               Version Release number of selected component  if applicable       jboss as connector 7 4 2 Final redhat 2 jar                How reproducible      Random   it&amp apos s a race condition but adding Byteman which slows execution  due to synchronous logging  of the code in which the race takes place seems to increase the frequency at which the failure occurs                Steps to Reproduce      1  Copy a resource adapter archive to standalone deployments     2  Configure the standalone xml with two adapter configs specified  single RAR      3  Start JBoss  a few restarts may be required as it doesn&amp apos t always happen                Actual results      The server log shows the exception below  and I suspect at least one of the adapter configs is not deployed   though I didn&amp apos t confirm the latter            12 40 44 463 ERROR  org jboss msc service   MSC service thread 1 12  MSC000002  Invocation of listener  org jboss as connector util RaServicesFactory 1 5fc7026f  failed  java lang IllegalStateException  JBAS014666  Duplicate     resource resource adapters     at org jboss as controller registry AbstractModelResource DefaultResourceProvider register AbstractModelResource java 225   jboss as controller 7 4 2 Final redhat 2 jar 7 4 2 Final redhat 2      at org jboss as controller registry AbstractModelResource registerChild AbstractModelResource java 135   jboss as controller 7 4 2 Final redhat 2 jar 7 4 2 Final redhat 2      at org jboss as connector deployers ra processors AbstractResourceAdapterDeploymentServiceListener transition AbstractResourceAdapterDeploymentServiceListener java 122   jboss as connector 7 4 2 Final redhat 2 jar 7 4      2 Final redhat 2      at org jboss msc service ServiceControllerImpl invokeListener ServiceControllerImpl java 1565   jboss msc 1 1 5 Final redhat 1 jar 1 1 5 Final redhat 1      at org jboss msc service ServiceControllerImpl access 2800 ServiceControllerImpl java 52   jboss msc 1 1 5 Final redhat 1 jar 1 1 5 Final redhat 1      at org jboss msc service ServiceControllerImpl ListenerTask run ServiceControllerImpl java 2131   jboss msc 1 1 5 Final redhat 1 jar 1 1 5 Final redhat 1      at java util concurrent ThreadPoolExecutor runWorker ThreadPoolExecutor java 1145   rt jar 1 7 0_71      at java util concurrent ThreadPoolExecutor Worker run ThreadPoolExecutor java 615   rt jar 1 7 0_71      at java lang Thread run Thread java 745   rt jar 1 7 0_71                Expected results      No exception should be raised               Additional info                Document URL           Section Number and Name           Describe the issue      It appears that where there are multiple adapter configurations  registering of the adapters is done on different threads and sometimes two threads check to see if the resource adapters  subsystem   I think that is what is being created  exists     it is possible for two threads to be told it doesn&amp apos t exist   in which case both threads will try to create it           I think the code at issue is found in lines 120 and 122 of   connector src main java org jboss as connector deployers ra processors AbstractResourceAdapterDeploymentServiceListener java          At line 120  we check if the path exists     and if it does not try to create it at line 122     but it possible that between the two lines one thread is executing  another thread may do the same   one will  win the race  and the other will fail with the exception           I did note that the entire block is wrapped in a synchronization block   synchronized on &amp apos this&amp apos    so there must be multiple instances of the AbstractResourceAdapterDeploymentServiceListener class since the logging shows interleaved execution of the check and register calls across multiple threads                Suggestions for improvement           Additional information      Attached an archive containing a simple adapter  generated using the Ironjacamar generation tool   an excerpt of the standalone xml configuration used as well as an excerpt of the log file and a byteman script used to produce the stack traces in the log excerpt
4511	CMTTxInterceptor invokeInOurTx contains stale code handling ApplicationDeadlockExceptionDescription of problem   git   git app eng bos redhat com jbossas jboss as git ejb3 src main java org jboss as ejb3 tx CMTTxInterceptor java  There is stale code catching ApplicationDeadlockException and attempting to retry the transaction  This results in a failure if the exception is raised and retry does not occur  Version Release number of selected component  if applicable   How reproducible  Consistently Steps to Reproduce   Visual Inspection OR Register a transaction Synchronization object which raises the exception during beforeCompletion     Note that EAP no longer raises this exception  T he catch block code handling ApplicationDeadlockException seems to be an artifact of EAP 4 and should simply be removed  Actual results  Retry does not occur Expected results  Retry should not be attempted by this code
4844	When Wildfly EJB timer finishes  the transaction is not fully committed  When a Singleton EJB timer finishes  if the next run has already started but waiting on the write lock of Singleton EJB  the next run won t see the changes committed by the current run  So I assume when the EJB timers finishes  the transaction is not fully committed  or it s the next run that starts too early  Here is a test case that should be able to reproduce the issue we are facing  https   github com xiaodong xie wildfly singleton timer Here is my analysis of this issue  The CMTTxInterceptor is applied before ContainerManagedConcurrencyInterceptor  So when waiting for the write lock of EJBReadWriteLock  we ve already started the transaction  which IMHO is earlier than necessary
5186	TimeoutException  Unable to acquire lock after 15 secondsSeen in these scenarios  ejb ejbservlet shutdown repl async ejb ejbservlet jvmkill repl async http session shutdown repl async tcpStack http session undeploy dist sync With no obvious connection to failover of the nodes  usually all the 4 servers log this error few times during the testrun  each server different time          JBossINF   0m 31m17 21 36 562 ERROR  org infinispan interceptors InvocationContextInterceptor   remote thread  p4 t1  ISPN000136  Execution error  org infinispan util concurrent TimeoutException  ISPN000299  Unable to acquire lock after 15 seconds for key D89rThGoUJDT6kuJ MV7w_4TeNsSpQvBoL2wKi0l and requestor GlobalTransaction &lt perf20&gt  56262 remote  Lock is held by GlobalTransaction &lt perf20&gt  51723 remote  while request came from perf20      JBossINF  	at org infinispan util concurrent locks LockManagerImpl lock LockManagerImpl java 198       JBossINF  	at org infinispan util concurrent locks LockManagerImpl acquireLock LockManagerImpl java 171       JBossINF  	at org infinispan interceptors locking AbstractTxLockingInterceptor lockKeyAndCheckOwnership AbstractTxLockingInterceptor java 180       JBossINF  	at org infinispan interceptors locking AbstractTxLockingInterceptor lockAndRegisterBackupLock AbstractTxLockingInterceptor java 118       JBossINF  	at org infinispan interceptors locking PessimisticLockingInterceptor visitLockControlCommand PessimisticLockingInterceptor java 200       JBossINF  	at org infinispan commands control LockControlCommand acceptVisitor LockControlCommand java 110       JBossINF  	at org infinispan interceptors base CommandInterceptor invokeNextInterceptor CommandInterceptor java 97       JBossINF  	at org infinispan interceptors base CommandInterceptor handleDefault CommandInterceptor java 111       JBossINF  	at org infinispan commands AbstractVisitor visitLockControlCommand AbstractVisitor java 174       JBossINF  	at org infinispan commands control LockControlCommand acceptVisitor LockControlCommand java 110       JBossINF  	at org infinispan interceptors base CommandInterceptor invokeNextInterceptor CommandInterceptor java 97       JBossINF  	at org infinispan interceptors TxInterceptor invokeNextInterceptorAndVerifyTransaction TxInterceptor java 141       JBossINF  	at org infinispan interceptors TxInterceptor visitLockControlCommand TxInterceptor java 199       JBossINF  	at org infinispan commands control LockControlCommand acceptVisitor LockControlCommand java 110       JBossINF  	at org infinispan interceptors base CommandInterceptor invokeNextInterceptor CommandInterceptor java 97       JBossINF  	at org infinispan interceptors base CommandInterceptor handleDefault CommandInterceptor java 111       JBossINF  	at org infinispan commands AbstractVisitor visitLockControlCommand AbstractVisitor java 174       JBossINF  	at org infinispan statetransfer TransactionSynchronizerInterceptor visitLockControlCommand TransactionSynchronizerInterceptor java 75       JBossINF  	at org infinispan commands control LockControlCommand acceptVisitor LockControlCommand java 110       JBossINF  	at org infinispan interceptors base CommandInterceptor invokeNextInterceptor CommandInterceptor java 97       JBossINF  	at org infinispan statetransfer StateTransferInterceptor handleTxCommand StateTransferInterceptor java 196       JBossINF  	at org infinispan statetransfer StateTransferInterceptor visitLockControlCommand StateTransferInterceptor java 99       JBossINF  	at org infinispan commands control LockControlCommand acceptVisitor LockControlCommand java 110       JBossINF  	at org infinispan interceptors base CommandInterceptor invokeNextInterceptor CommandInterceptor java 97       JBossINF  	at org infinispan interceptors base CommandInterceptor handleDefault CommandInterceptor java 111       JBossINF  	at org infinispan commands AbstractVisitor visitLockControlCommand AbstractVisitor java 174       JBossINF  	at org infinispan commands control LockControlCommand acceptVisitor LockControlCommand java 110       JBossINF  	at org infinispan interceptors base CommandInterceptor invokeNextInterceptor CommandInterceptor java 97       JBossINF  	at org infinispan interceptors InvocationContextInterceptor handleAll InvocationContextInterceptor java 102       JBossINF  	at org infinispan interceptors InvocationContextInterceptor visitLockControlCommand InvocationContextInterceptor java 76       JBossINF  	at org infinispan commands control LockControlCommand acceptVisitor LockControlCommand java 110       JBossINF  	at org infinispan interceptors InterceptorChain invoke InterceptorChain java 336       JBossINF  	at org infinispan commands control LockControlCommand perform LockControlCommand java 129       JBossINF  	at org infinispan remoting inboundhandler BasePerCacheInboundInvocationHandler invokePerform BasePerCacheInboundInvocationHandler java 85       JBossINF  	at org infinispan remoting inboundhandler BaseBlockingRunnable run BaseBlockingRunnable java 34       JBossINF  	at java util concurrent ThreadPoolExecutor runWorker ThreadPoolExecutor java 1142       JBossINF  	at java util concurrent ThreadPoolExecutor Worker run ThreadPoolExecutor java 617       JBossINF  	at java lang Thread run Thread java 745        The error is usually followed by a warning         JBossINF   0m 33m17 21 36 563 WARN   org infinispan remoting inboundhandler NonTotalOrderPerCacheInboundInvocationHandler   remote thread  p4 t1  ISPN000071  Caught exception when handling command LockControlCommand cache clusterbench ee7 ear clusterbench ee7 web default war  keys  D89rThGoUJDT6kuJ MV7w_4TeNsSpQvBoL2wKi0l   flags  IGNORE_RETURN_VALUES   unlock false  gtx GlobalTransaction &lt perf20&gt  56262 remote   org infinispan util concurrent TimeoutException  ISPN000299  Unable to acquire lock after 15 seconds for key D89rThGoUJDT6kuJ MV7w_4TeNsSpQvBoL2wKi0l and requestor GlobalTransaction &lt perf20&gt  56262 remote  Lock is held by GlobalTransaction &lt perf20&gt  51723 remote  while request came from perf20      JBossINF  	at org infinispan util concurrent locks LockManagerImpl lock LockManagerImpl java 198       JBossINF  	at org infinispan util concurrent locks LockManagerImpl acquireLock LockManagerImpl java 171       JBossINF  	at org infinispan interceptors locking AbstractTxLockingInterceptor lockKeyAndCheckOwnership AbstractTxLockingInterceptor java 180       JBossINF  	at org infinispan interceptors locking AbstractTxLockingInterceptor lockAndRegisterBackupLock AbstractTxLockingInterceptor java 118       JBossINF  	at org infinispan interceptors locking PessimisticLockingInterceptor visitLockControlCommand PessimisticLockingInterceptor java 200       JBossINF  	at org infinispan commands control LockControlCommand acceptVisitor LockControlCommand java 110       JBossINF  	at org infinispan interceptors base CommandInterceptor invokeNextInterceptor CommandInterceptor java 97       JBossINF  	at org infinispan interceptors base CommandInterceptor handleDefault CommandInterceptor java 111       JBossINF  	at org infinispan commands AbstractVisitor visitLockControlCommand AbstractVisitor java 174       JBossINF  	at org infinispan commands control LockControlCommand acceptVisitor LockControlCommand java 110       JBossINF  	at org infinispan interceptors base CommandInterceptor invokeNextInterceptor CommandInterceptor java 97       JBossINF  	at org infinispan interceptors TxInterceptor invokeNextInterceptorAndVerifyTransaction TxInterceptor java 141       JBossINF  	at org infinispan interceptors TxInterceptor visitLockControlCommand TxInterceptor java 199       JBossINF  	at org infinispan commands control LockControlCommand acceptVisitor LockControlCommand java 110       JBossINF  	at org infinispan interceptors base CommandInterceptor invokeNextInterceptor CommandInterceptor java 97       JBossINF  	at org infinispan interceptors base CommandInterceptor handleDefault CommandInterceptor java 111       JBossINF  	at org infinispan commands AbstractVisitor visitLockControlCommand AbstractVisitor java 174       JBossINF  	at org infinispan statetransfer TransactionSynchronizerInterceptor visitLockControlCommand TransactionSynchronizerInterceptor java 75       JBossINF  	at org infinispan commands control LockControlCommand acceptVisitor LockControlCommand java 110       JBossINF  	at org infinispan interceptors base CommandInterceptor invokeNextInterceptor CommandInterceptor java 97       JBossINF  	at org infinispan statetransfer StateTransferInterceptor handleTxCommand StateTransferInterceptor java 196       JBossINF  	at org infinispan statetransfer StateTransferInterceptor visitLockControlCommand StateTransferInterceptor java 99       JBossINF  	at org infinispan commands control LockControlCommand acceptVisitor LockControlCommand java 110       JBossINF  	at org infinispan interceptors base CommandInterceptor invokeNextInterceptor CommandInterceptor java 97       JBossINF  	at org infinispan interceptors base CommandInterceptor handleDefault CommandInterceptor java 111       JBossINF  	at org infinispan commands AbstractVisitor visitLockControlCommand AbstractVisitor java 174       JBossINF  	at org infinispan commands control LockControlCommand acceptVisitor LockControlCommand java 110       JBossINF  	at org infinispan interceptors base CommandInterceptor invokeNextInterceptor CommandInterceptor java 97       JBossINF  	at org infinispan interceptors InvocationContextInterceptor handleAll InvocationContextInterceptor java 102       JBossINF  	at org infinispan interceptors InvocationContextInterceptor visitLockControlCommand InvocationContextInterceptor java 76       JBossINF  	at org infinispan commands control LockControlCommand acceptVisitor LockControlCommand java 110       JBossINF  	at org infinispan interceptors InterceptorChain invoke InterceptorChain java 336       JBossINF  	at org infinispan commands control LockControlCommand perform LockControlCommand java 129       JBossINF  	at org infinispan remoting inboundhandler BasePerCacheInboundInvocationHandler invokePerform BasePerCacheInboundInvocationHandler java 85       JBossINF  	at org infinispan remoting inboundhandler BaseBlockingRunnable run BaseBlockingRunnable java 34       JBossINF  	at java util concurrent ThreadPoolExecutor runWorker ThreadPoolExecutor java 1142       JBossINF  	at java util concurrent ThreadPoolExecutor Worker run ThreadPoolExecutor java 617       JBossINF  	at java lang Thread run Thread java 745        While the error was logged 15 times by all servers in this particular run  the warning message was logged 505 times  Server log  http   jenkins mw lab eng bos redhat com hudson job eap 7x failover ejb ejbservlet shutdown repl async 6 console perf19  The same error with different stacktrace         JBossINF   0m 31m17 21 16 585 ERROR  org infinispan interceptors InvocationContextInterceptor   default task 45  ISPN000136  Execution error  org infinispan util concurrent TimeoutException  ISPN000299  Unable to acquire lock after 15 seconds for key UnknownSessionID  5365576765655250685155485253536866686865666767514850676951495057  and requestor GlobalTransaction &lt perf20&gt  52228 local  Lock is held by GlobalTransaction &lt perf20&gt  49990 local  while request came from local      JBossINF  	at org infinispan util concurrent locks LockManagerImpl lock LockManagerImpl java 198       JBossINF  	at org infinispan util concurrent locks LockManagerImpl acquireLock LockManagerImpl java 171       JBossINF  	at org infinispan interceptors locking AbstractTxLockingInterceptor lockKeyAndCheckOwnership AbstractTxLockingInterceptor java 180       JBossINF  	at org infinispan interceptors locking PessimisticLockingInterceptor lockAndRegisterBackupLock PessimisticLockingInterceptor java 261       JBossINF  	at org infinispan interceptors locking PessimisticLockingInterceptor visitDataWriteCommand PessimisticLockingInterceptor java 131       JBossINF  	at org infinispan interceptors locking AbstractLockingInterceptor visitReplaceCommand AbstractLockingInterceptor java 60       JBossINF  	at org infinispan commands write ReplaceCommand acceptVisitor ReplaceCommand java 55       JBossINF  	at org infinispan interceptors base CommandInterceptor invokeNextInterceptor CommandInterceptor java 97       JBossINF  	at org infinispan interceptors base CommandInterceptor handleDefault CommandInterceptor java 111       JBossINF  	at org infinispan commands AbstractVisitor visitReplaceCommand AbstractVisitor java 54       JBossINF  	at org infinispan commands write ReplaceCommand acceptVisitor ReplaceCommand java 55       JBossINF  	at org infinispan interceptors base CommandInterceptor invokeNextInterceptor CommandInterceptor java 97       JBossINF  	at org infinispan interceptors TxInterceptor enlistWriteAndInvokeNext TxInterceptor java 308       JBossINF  	at org infinispan interceptors TxInterceptor visitReplaceCommand TxInterceptor java 219       JBossINF  	at org infinispan commands write ReplaceCommand acceptVisitor ReplaceCommand java 55       JBossINF  	at org infinispan interceptors base CommandInterceptor invokeNextInterceptor CommandInterceptor java 97       JBossINF  	at org infinispan interceptors base CommandInterceptor handleDefault CommandInterceptor java 111       JBossINF  	at org infinispan commands AbstractVisitor visitReplaceCommand AbstractVisitor java 54       JBossINF  	at org infinispan commands write ReplaceCommand acceptVisitor ReplaceCommand java 55       JBossINF  	at org infinispan interceptors base CommandInterceptor invokeNextInterceptor CommandInterceptor java 97       JBossINF  	at org infinispan statetransfer StateTransferInterceptor handleTxWriteCommand StateTransferInterceptor java 261       JBossINF  	at org infinispan statetransfer StateTransferInterceptor handleWriteCommand StateTransferInterceptor java 243       JBossINF  	at org infinispan statetransfer StateTransferInterceptor visitReplaceCommand StateTransferInterceptor java 124       JBossINF  	at org infinispan commands write ReplaceCommand acceptVisitor ReplaceCommand java 55       JBossINF  	at org infinispan interceptors base CommandInterceptor invokeNextInterceptor CommandInterceptor java 97       JBossINF  	at org infinispan interceptors CacheMgmtInterceptor updateStoreStatistics CacheMgmtInterceptor java 191       JBossINF  	at org infinispan interceptors CacheMgmtInterceptor visitReplaceCommand CacheMgmtInterceptor java 182       JBossINF  	at org infinispan commands write ReplaceCommand acceptVisitor ReplaceCommand java 55       JBossINF  	at org infinispan interceptors base CommandInterceptor invokeNextInterceptor CommandInterceptor java 97       JBossINF  	at org infinispan interceptors InvocationContextInterceptor handleAll InvocationContextInterceptor java 102       JBossINF  	at org infinispan interceptors InvocationContextInterceptor handleDefault InvocationContextInterceptor java 71       JBossINF  	at org infinispan commands AbstractVisitor visitReplaceCommand AbstractVisitor java 54       JBossINF  	at org infinispan commands write ReplaceCommand acceptVisitor ReplaceCommand java 55       JBossINF  	at org infinispan interceptors InterceptorChain invoke InterceptorChain java 336       JBossINF  	at org infinispan cache impl CacheImpl executeCommandAndCommitIfNeeded CacheImpl java 1613       JBossINF  	at org infinispan cache impl CacheImpl replaceInternal CacheImpl java 1158       JBossINF  	at org infinispan cache impl CacheImpl replace CacheImpl java 1151       JBossINF  	at org infinispan cache impl DecoratedCache replace DecoratedCache java 502       JBossINF  	at org infinispan cache impl AbstractDelegatingCache replace AbstractDelegatingCache java 262       JBossINF  	at org wildfly clustering ee infinispan CacheEntryMutator mutate CacheEntryMutator java 52       JBossINF  	at org wildfly clustering ejb infinispan bean InfinispanBean close InfinispanBean java 113       JBossINF  	at org wildfly clustering ejb infinispan InfinispanBeanManager SchedulableBean close InfinispanBeanManager java 406       JBossINF  	at org jboss as ejb3 cache distributable DistributableCache release DistributableCache java 136       JBossINF  	at org jboss as ejb3 component stateful StatefulSessionSynchronizationInterceptor releaseInstance StatefulSessionSynchronizationInterceptor java 168       JBossINF  	at org jboss as ejb3 component stateful StatefulSessionSynchronizationInterceptor StatefulSessionSynchronization afterCompletion StatefulSessionSynchronizationInterceptor java 250       JBossINF  	at org jboss as txn service internal tsr JCAOrderedLastSynchronizationList afterCompletion JCAOrderedLastSynchronizationList java 147       JBossINF  	at com arjuna ats internal jta resources arjunacore SynchronizationImple afterCompletion SynchronizationImple java 96       JBossINF  	at com arjuna ats arjuna coordinator TwoPhaseCoordinator afterCompletion TwoPhaseCoordinator java 545       JBossINF  	at com arjuna ats arjuna coordinator TwoPhaseCoordinator end TwoPhaseCoordinator java 101       JBossINF  	at com arjuna ats arjuna AtomicAction commit AtomicAction java 162       JBossINF  	at com arjuna ats internal jta transaction arjunacore TransactionImple commitAndDisassociate TransactionImple java 1200       JBossINF  	at com arjuna ats internal jta transaction arjunacore BaseTransaction commit BaseTransaction java 126       JBossINF  	at com arjuna ats jbossatx BaseTransactionManagerDelegate commit BaseTransactionManagerDelegate java 89       JBossINF  	at org jboss as ejb3 tx CMTTxInterceptor endTransaction CMTTxInterceptor java 91       JBossINF  	at org jboss as ejb3 tx CMTTxInterceptor invokeInOurTx CMTTxInterceptor java 279       JBossINF  	at org jboss as ejb3 tx CMTTxInterceptor required CMTTxInterceptor java 327       JBossINF  	at org jboss as ejb3 tx CMTTxInterceptor processInvocation CMTTxInterceptor java 239       JBossINF  	at org jboss invocation InterceptorContext proceed InterceptorContext java 340       JBossINF  	at org jboss as ejb3 component interceptors CurrentInvocationContextInterceptor processInvocation CurrentInvocationContextInterceptor java 41       JBossINF  	at org jboss invocation InterceptorContext proceed InterceptorContext java 340       JBossINF  	at org jboss as ejb3 component invocationmetrics WaitTimeInterceptor processInvocation WaitTimeInterceptor java 43       JBossINF  	at org jboss invocation InterceptorContext proceed InterceptorContext java 340       JBossINF  	at org jboss as ejb3 security SecurityContextInterceptor processInvocation SecurityContextInterceptor java 100       JBossINF  	at org jboss invocation InterceptorContext proceed InterceptorContext java 340       JBossINF  	at org jboss as ejb3 component interceptors ShutDownInterceptorFactory 1 processInvocation ShutDownInterceptorFactory java 64       JBossINF  	at org jboss invocation InterceptorContext proceed InterceptorContext java 340       JBossINF  	at org jboss as ejb3 component interceptors LoggingInterceptor processInvocation LoggingInterceptor java 66       JBossINF  	at org jboss invocation InterceptorContext proceed InterceptorContext java 340       JBossINF  	at org jboss as ee component NamespaceContextInterceptor processInvocation NamespaceContextInterceptor java 50       JBossINF  	at org jboss invocation InterceptorContext proceed InterceptorContext java 340       JBossINF  	at org jboss as ejb3 component interceptors AdditionalSetupInterceptor processInvocation AdditionalSetupInterceptor java 54       JBossINF  	at org jboss invocation InterceptorContext proceed InterceptorContext java 340       JBossINF  	at org jboss invocation ContextClassLoaderInterceptor processInvocation ContextClassLoaderInterceptor java 64       JBossINF  	at org jboss invocation InterceptorContext proceed InterceptorContext java 340       JBossINF  	at org jboss invocation InterceptorContext run InterceptorContext java 356       JBossINF  	at org wildfly security manager WildFlySecurityManager doChecked WildFlySecurityManager java 636       JBossINF  	at org jboss invocation AccessCheckingInterceptor processInvocation AccessCheckingInterceptor java 61       JBossINF  	at org jboss invocation InterceptorContext proceed InterceptorContext java 340       JBossINF  	at org jboss invocation InterceptorContext run InterceptorContext java 356       JBossINF  	at org jboss invocation PrivilegedWithCombinerInterceptor processInvocation PrivilegedWithCombinerInterceptor java 80       JBossINF  	at org jboss invocation InterceptorContext proceed InterceptorContext java 340       JBossINF  	at org jboss invocation ChainedInterceptor processInvocation ChainedInterceptor java 61       JBossINF  	at org jboss as ee component ViewService View invoke ViewService java 195       JBossINF  	at org jboss as ee component ViewDescription 1 processInvocation ViewDescription java 185       JBossINF  	at org jboss invocation InterceptorContext proceed InterceptorContext java 340       JBossINF  	at org jboss invocation ChainedInterceptor processInvocation ChainedInterceptor java 61       JBossINF  	at org jboss as ee component ProxyInvocationHandler invoke ProxyInvocationHandler java 73       JBossINF  	at org jboss test clusterbench ejb stateful LocalStatefulSB   view3 getSerialAndIncrement Unknown Source       JBossINF  	at sun reflect GeneratedMethodAccessor22 invoke Unknown Source       JBossINF  	at sun reflect DelegatingMethodAccessorImpl invoke DelegatingMethodAccessorImpl java 43       JBossINF  	at java lang reflect Method invoke Method java 497       JBossINF  	at org jboss weld util reflection Reflections invokeAndUnwrap Reflections java 434       JBossINF  	at org jboss weld bean proxy EnterpriseBeanProxyMethodHandler invoke EnterpriseBeanProxyMethodHandler java 127       JBossINF  	at org jboss weld bean proxy EnterpriseTargetBeanInstance invoke EnterpriseTargetBeanInstance java 56       JBossINF  	at org jboss weld bean proxy ProxyMethodHandler invoke ProxyMethodHandler java 100       JBossINF  	at org jboss test clusterbench ejb stateful LocalStatefulSB Proxy _  _Weld EnterpriseProxy  getSerialAndIncrement Unknown Source       JBossINF  	at org jboss test clusterbench ejb stateful LocalStatefulSB Proxy _  _WeldClientProxy getSerialAndIncrement Unknown Source       JBossINF  	at org jboss test clusterbench web ejb LocalEjbServlet doGet LocalEjbServlet java 38       JBossINF  	at javax servlet http HttpServlet service HttpServlet java 687       JBossINF  	at javax servlet http HttpServlet service HttpServlet java 790       JBossINF  	at io undertow servlet handlers ServletHandler handleRequest ServletHandler java 86       JBossINF  	at io undertow servlet handlers security ServletSecurityRoleHandler handleRequest ServletSecurityRoleHandler java 62       JBossINF  	at io undertow servlet handlers ServletDispatchingHandler handleRequest ServletDispatchingHandler java 36       JBossINF  	at org wildfly extension undertow security SecurityContextAssociationHandler handleRequest SecurityContextAssociationHandler java 78       JBossINF  	at io undertow server handlers PredicateHandler handleRequest PredicateHandler java 43       JBossINF  	at io undertow servlet handlers security SSLInformationAssociationHandler handleRequest SSLInformationAssociationHandler java 131       JBossINF  	at io undertow servlet handlers security ServletAuthenticationCallHandler handleRequest ServletAuthenticationCallHandler java 57       JBossINF  	at io undertow server handlers PredicateHandler handleRequest PredicateHandler java 43       JBossINF  	at io undertow security handlers AbstractConfidentialityHandler handleRequest AbstractConfidentialityHandler java 46       JBossINF  	at io undertow servlet handlers security ServletConfidentialityConstraintHandler handleRequest ServletConfidentialityConstraintHandler java 64       JBossINF  	at io undertow security handlers AuthenticationMechanismsHandler handleRequest AuthenticationMechanismsHandler java 60       JBossINF  	at io undertow servlet handlers security CachedAuthenticatedSessionHandler handleRequest CachedAuthenticatedSessionHandler java 72       JBossINF  	at io undertow security handlers NotificationReceiverHandler handleRequest NotificationReceiverHandler java 50       JBossINF  	at io undertow security handlers AbstractSecurityContextAssociationHandler handleRequest AbstractSecurityContextAssociationHandler java 43       JBossINF  	at io undertow server handlers PredicateHandler handleRequest PredicateHandler java 43       JBossINF  	at org wildfly extension undertow security jacc JACCContextIdHandler handleRequest JACCContextIdHandler java 61       JBossINF  	at io undertow server handlers PredicateHandler handleRequest PredicateHandler java 43       JBossINF  	at io undertow server handlers PredicateHandler handleRequest PredicateHandler java 43       JBossINF  	at io undertow servlet handlers ServletInitialHandler handleFirstRequest ServletInitialHandler java 282       JBossINF  	at io undertow servlet handlers ServletInitialHandler dispatchRequest ServletInitialHandler java 261       JBossINF  	at io undertow servlet handlers ServletInitialHandler access 000 ServletInitialHandler java 80       JBossINF  	at io undertow servlet handlers ServletInitialHandler 1 handleRequest ServletInitialHandler java 172       JBossINF  	at io undertow server Connectors executeRootHandler Connectors java 199       JBossINF  	at io undertow server HttpServerExchange 1 run HttpServerExchange java 778       JBossINF  	at java util concurrent ThreadPoolExecutor runWorker ThreadPoolExecutor java 1142       JBossINF  	at java util concurrent ThreadPoolExecutor Worker run ThreadPoolExecutor java 617       JBossINF  	at java lang Thread run Thread java 745        Server log  http   jenkins mw lab eng bos redhat com hudson job eap 7x failover ejb ejbservlet shutdown repl async 6 console perf20  The timeout stated in the exception is sometimes not exactly 15 seconds  so far I have seen these variants  14 99 seconds  14 97 seconds  and also only few milliseconds   see this server log  http   jenkins mw lab eng bos redhat com hudson job eap 7x failover http session undeploy dist sync 5 console perf18
5449	Custom socket factory for JGroups subsystem not set correctlyWildfly s JChannelFactory tries to set a custom socket factory on the JGroups transport  This is not the correct API to use  and it gets overwritten when the JGroups channel starts  A custom socket factory should be set on the JChannel  The only time the custom socket factory is currently used is if there s a race condition where two channels are started at the same time  and the custom factory is set just before the other channel uses it
5596	MessageDrivenComponent startDelivery stopDelivery is not thread safeWFLY 4470 made a change to prevent MDBs being activated or deactivated multiple times  but it is not thread safe  A volatile boolean is used for the flag  but there is no protection against multiple threads invoking the methods simultaneously  Possible effects include   activating the endpoint twice  with  probably  only one deactivation later  leading to not de registering XA resources from the recovery manager properly  activate   and deactivate   running in the wrong order if done by separate threads   Several simple solutions probably will not work correctly  Using an AtomicBoolean would stop multiple activations deactivations from concurrent calls  but would mean that startDelivery   could return before the activation was one  Using a synchronized block or other exclusive lock would work  however since it involves invoking non container code  the resource adapter   there could potentially be a deadlock risk if that invoked some related container functionality
5770	Lock TimeoutException on CacheRegistry close  Just happened on node shutdown when testing locally        19 22 21 114 INFO  org wildfly extension undertow   MSC service thread 1 7  WFLYUT0004  Undertow 1 3 7 Final stopping     19 22 21 114 ERROR  stderr   ServerService Thread Pool    82  Exception in thread  ServerService Thread Pool    82  org infinispan util concurrent TimeoutException  Could not acquire lock on node2 in behalf of transaction GlobalTransaction &lt node2&gt  4223 local  Current owner GlobalTransaction &lt node2&gt  4217 local      19 22 21 115 ERROR  stderr   ServerService Thread Pool    82  at org infinispan util concurrent locks impl DefaultPendingLockManager timeout DefaultPendingLockManager java 224      19 22 21 115 ERROR  stderr   ServerService Thread Pool    82  at org infinispan util concurrent locks impl DefaultPendingLockManager checkForPendingLock DefaultPendingLockManager java 196      19 22 21 115 ERROR  stderr   ServerService Thread Pool    82  at org infinispan util concurrent locks impl DefaultPendingLockManager awaitPendingTransactionsForKey DefaultPendingLockManager java 115      19 22 21 115 ERROR  stderr   ServerService Thread Pool    82  at org infinispan interceptors locking AbstractTxLockingInterceptor checkPendingAndLockKey AbstractTxLockingInterceptor java 190      19 22 21 115 ERROR  stderr   ServerService Thread Pool    82  at org infinispan interceptors locking AbstractTxLockingInterceptor lockOrRegisterBackupLock AbstractTxLockingInterceptor java 115      19 22 21 115 ERROR  stderr   ServerService Thread Pool    82  at org infinispan interceptors locking PessimisticLockingInterceptor visitDataWriteCommand PessimisticLockingInterceptor java 121      19 22 21 115 ERROR  stderr   ServerService Thread Pool    82  at org infinispan interceptors locking AbstractLockingInterceptor visitRemoveCommand AbstractLockingInterceptor java 71      19 22 21 115 ERROR  stderr   ServerService Thread Pool    82  at org infinispan commands write RemoveCommand acceptVisitor RemoveCommand java 59      19 22 21 115 ERROR  stderr   ServerService Thread Pool    82  at org infinispan interceptors base CommandInterceptor invokeNextInterceptor CommandInterceptor java 99      19 22 21 115 ERROR  stderr   ServerService Thread Pool    82  at org infinispan interceptors base CommandInterceptor handleDefault CommandInterceptor java 113      19 22 21 115 ERROR  stderr   ServerService Thread Pool    82  at org infinispan commands AbstractVisitor visitRemoveCommand AbstractVisitor java 48      19 22 21 115 ERROR  stderr   ServerService Thread Pool    82  at org infinispan commands write RemoveCommand acceptVisitor RemoveCommand java 59      19 22 21 115 ERROR  stderr   ServerService Thread Pool    82  at org infinispan interceptors base CommandInterceptor invokeNextInterceptor CommandInterceptor java 99      19 22 21 116 ERROR  stderr   ServerService Thread Pool    82  at org infinispan interceptors TxInterceptor enlistWriteAndInvokeNext TxInterceptor java 366      19 22 21 116 ERROR  stderr   ServerService Thread Pool    82  at org infinispan interceptors TxInterceptor visitRemoveCommand TxInterceptor java 230      19 22 21 116 ERROR  stderr   ServerService Thread Pool    82  at org infinispan commands write RemoveCommand acceptVisitor RemoveCommand java 59      19 22 21 116 ERROR  stderr   ServerService Thread Pool    82  at org infinispan interceptors base CommandInterceptor invokeNextInterceptor CommandInterceptor java 99      19 22 21 116 ERROR  stderr   ServerService Thread Pool    82  at org infinispan interceptors base CommandInterceptor handleDefault CommandInterceptor java 113      19 22 21 116 ERROR  stderr   ServerService Thread Pool    82  at org infinispan commands AbstractVisitor visitRemoveCommand AbstractVisitor java 48      19 22 21 116 ERROR  stderr   ServerService Thread Pool    82  at org infinispan commands write RemoveCommand acceptVisitor RemoveCommand java 59      19 22 21 116 ERROR  stderr   ServerService Thread Pool    82  at org infinispan interceptors base CommandInterceptor invokeNextInterceptor CommandInterceptor java 99      19 22 21 116 ERROR  stderr   ServerService Thread Pool    82  at org infinispan statetransfer StateTransferInterceptor handleTxWriteCommand StateTransferInterceptor java 304      19 22 21 116 ERROR  stderr   ServerService Thread Pool    82  at org infinispan statetransfer StateTransferInterceptor handleWriteCommand StateTransferInterceptor java 286      19 22 21 116 ERROR  stderr   ServerService Thread Pool    82  at org infinispan statetransfer StateTransferInterceptor visitRemoveCommand StateTransferInterceptor java 123      19 22 21 116 ERROR  stderr   ServerService Thread Pool    82  at org infinispan commands write RemoveCommand acceptVisitor RemoveCommand java 59      19 22 21 116 ERROR  stderr   ServerService Thread Pool    82  at org infinispan interceptors base CommandInterceptor invokeNextInterceptor CommandInterceptor java 99      19 22 21 116 ERROR  stderr   ServerService Thread Pool    82  at org infinispan interceptors InvocationContextInterceptor handleAll InvocationContextInterceptor java 102      19 22 21 116 ERROR  stderr   ServerService Thread Pool    82  at org infinispan interceptors InvocationContextInterceptor handleDefault InvocationContextInterceptor java 71      19 22 21 116 ERROR  stderr   ServerService Thread Pool    82  at org infinispan commands AbstractVisitor visitRemoveCommand AbstractVisitor java 48      19 22 21 116 ERROR  stderr   ServerService Thread Pool    82  at org infinispan commands write RemoveCommand acceptVisitor RemoveCommand java
6127	Throw IllegalStateException if JTA tx has an unsynchronized persistence context and the target is synchronized persistence contextSPEC  If a component is called and the JTA transaction is propagated into that component  If there is a persistence context of type SynchronizationType UNSYNCHRONIZED associated with the JTA transaction and the target component specifies a persistence context of type SynchronizationType SYNCHRONIZED  the IllegalStateException is thrown by the container  We have a stateful session bean  SFB1    PC  TRANSACTION UNSYNCHRONIZED  stateful session bean  SFB2    PC  TRANSACTION SYNCHRONIZED  SFB1 method M1  REQUIRED  calls SFB2 Method 2  REQUIRED   PC is propagated from SFB1 to SFB2 without any exception
6215	SessionSynchronization callbacks allow concurrent access to SFSBIssue first encountered by customer in EAP5  JBPAPP 11239   Assume a local SFSB  B1  with container managed transactions and a calling SFSB  B2  which has bean managed transactions  B1 implements the SessionSynchronization interface  When B2 s bean managed transaction timesout whilst executing B1 exampleMethod    B2 s transaction aborts and the transaction reaper thread calls B1 afterCompletion    However  the original worker thread that was executing B1 exampleMethod   continues to execute B1 exampleMethod   until it has completed  Hence it is possible for the B1 SFSB to be accessed concurrently  It is also possible for B1 afterCompletion   to finish executing before B1 exampleMethod
6405	Performance  WeldDeployment getBeanDeploymentArchive method is synchronized Wildfly 10 0 0 FINAL   During the performance test of my app  50 concurrent users with jmeter   I am running into the following issue  There are locked threads in the method WeldDeployment getBeanDeploymentArchive    Looking the code  this method is synchronized  so it makes sense  The question is  is this the expected behavior or this is a bug  In both cases is there any workaround to overcome this limitation  STACK TRACE       org jboss as weld WeldProvider CdiImpl getBeanManager   73 org jboss as weld WeldProvider CdiImpl getBeanManager   93 org jboss as weld deployment WeldDeployment getBeanDeploymentArchive   226
6776	Unclear error message when creating multiple thread pools of the same type for a workmanagerWhen there is already a long running thread pool for a work manager and you try to create another one   subsystem jca workmanager default long running threads custom add max threads 30  queue length 30  you only get an opaque error message   failure description   &gt   WFLYCTL0086  Failed to persist configuration change  WFLYCTL0084  Failed to marshal configuration   with a  also useless  java lang IllegalArgumentException in the server log  It should be more obvious that the error is that you cannot create two long running thread pools
6877	Fine session attributes  i e  replication granularity   ATTRIBUTE  cause org infinispan util concurrent TimeoutException  ISPN000299  Unable to acquire lock after 15 secondsOur system using the following infinispan configuration for web session cache  i e  an async  non transactional  batch  optimistic locking dustrubutable cache         &lt cache container name  web  default cache  dist  module  org wildfly clustering web infinispan &gt      &lt transport lock timeout  60000  &gt      &lt distributed cache name  dist  mode  ASYNC  l1 lifespan  0  owners  2 &gt      &lt locking isolation  REPEATABLE_READ  &gt      &lt transaction locking  OPTIMISTIC  mode  BATCH  &gt      &lt file store &gt      &lt  distributed cache&gt      &lt  cache container&gt        When we perform a load test for one of our business use case in our system  Wildfly always throw the infamous locking for 15 seconds timeout exception        2016 07 21 13 01 37 971 TRACE  org infinispan util concurrent locks impl DefaultLockManager   default task 33  Lock all keys  4V3S9Lw0pGPAK3wt8bYEt3BK06iimxk88geCH2Gl  4V3S9Lw0pGPAK3wt8bYEt3BK06iimxk88geCH2Gl &gt YYY  for owner GlobalTransaction &lt 10 1 3 29&gt  492 local  timeout 15000  MILLISECONDS      2016 07 21 13 01 52 975 ERROR  org infinispan interceptors InvocationContextInterceptor   default task 33  ISPN000136  Error executing command PrepareCommand  writing keys  4V3S9Lw0pGPAK3wt8bYEt3BK06iimxk88geCH2Gl  4V3S9Lw0pGPAK3wt8bYEt3BK06iimxk88geCH2Gl &gt YYY   org infinispan util concurrent TimeoutException  ISPN000299  Unable to acquire lock after 15 seconds for key 4V3S9Lw0pGPAK3wt8bYEt3BK06iimxk88geCH2Gl &gt YYY and requestor GlobalTransaction &lt 10 1 3 29&gt  492 local  Lock is held by GlobalTransaction &lt 10 1 3 29&gt  458 local     at org infinispan util concurrent locks impl DefaultLockManager KeyAwareExtendedLockPromise lock DefaultLockManager java 236      at org infinispan util concurrent locks impl DefaultLockManager CompositeLockPromise lock DefaultLockManager java 305      at org infinispan interceptors locking AbstractLockingInterceptor lockAllAndRecord AbstractLockingInterceptor java 199      at org infinispan interceptors locking AbstractTxLockingInterceptor checkPendingAndLockAllKeys AbstractTxLockingInterceptor java 199      at org infinispan interceptors locking AbstractTxLockingInterceptor lockAllOrRegisterBackupLock AbstractTxLockingInterceptor java 165      at org infinispan interceptors locking OptimisticLockingInterceptor visitPrepareCommand OptimisticLockingInterceptor java 69      at org infinispan commands tx PrepareCommand acceptVisitor PrepareCommand java 173      at org infinispan interceptors base CommandInterceptor invokeNextInterceptor CommandInterceptor java 99      at org infinispan interceptors TxInterceptor invokeNextInterceptorAndVerifyTransaction TxInterceptor java 157      at org infinispan interceptors TxInterceptor visitPrepareCommand TxInterceptor java 144      at org infinispan commands tx PrepareCommand acceptVisitor PrepareCommand java 173      at org infinispan interceptors base CommandInterceptor invokeNextInterceptor CommandInterceptor java 99      at org infinispan interceptors base CommandInterceptor handleDefault CommandInterceptor java 113      at org infinispan commands AbstractVisitor visitPrepareCommand AbstractVisitor java 112      at org infinispan statetransfer TransactionSynchronizerInterceptor visitPrepareCommand TransactionSynchronizerInterceptor java 42      at org infinispan commands tx PrepareCommand acceptVisitor PrepareCommand java 173      at org infinispan interceptors base CommandInterceptor invokeNextInterceptor CommandInterceptor java 99      at org infinispan statetransfer StateTransferInterceptor handleTxCommand StateTransferInterceptor java 238      at org infinispan statetransfer StateTransferInterceptor visitPrepareCommand StateTransferInterceptor java 87      at org infinispan commands tx PrepareCommand acceptVisitor PrepareCommand java 173      at org infinispan interceptors base CommandInterceptor invokeNextInterceptor CommandInterceptor java 99      at org infinispan interceptors InvocationContextInterceptor handleAll InvocationContextInterceptor java 107      at org infinispan interceptors InvocationContextInterceptor handleDefault InvocationContextInterceptor java 76      at org infinispan commands AbstractVisitor visitPrepareCommand AbstractVisitor java 112      at org infinispan commands tx PrepareCommand acceptVisitor PrepareCommand java 173      at org infinispan interceptors base CommandInterceptor invokeNextInterceptor CommandInterceptor java 99      at org infinispan interceptors base CommandInterceptor handleDefault CommandInterceptor java 113      at org infinispan commands AbstractVisitor visitPrepareCommand AbstractVisitor java 112      at org infinispan commands tx PrepareCommand acceptVisitor PrepareCommand java 173      at org infinispan interceptors InterceptorChain invoke InterceptorChain java 336      at org infinispan transaction impl TransactionCoordinator commit TransactionCoordinator java 157      at org infinispan transaction xa TransactionXaAdapter commit TransactionXaAdapter java 114      at org infinispan transaction tm DummyTransaction finishResource DummyTransaction java 389      at org infinispan transaction tm DummyTransaction commitResources DummyTransaction java 435      at org infinispan transaction tm DummyTransaction runCommit DummyTransaction java 314      at org infinispan transaction tm DummyTransaction commit DummyTransaction java 105      at org infinispan transaction tm DummyBaseTransactionManager commit DummyBaseTransactionManager java 73      at org wildfly clustering ee infinispan ActiveTransactionBatch close ActiveTransactionBatch java 48      at org wildfly clustering web undertow session DistributableSession requestDone DistributableSession java 77      at io undertow servlet spec ServletContextImpl updateSessionAccessTime ServletContextImpl java 768      at io undertow servlet spec HttpServletResponseImpl responseDone HttpServletResponseImpl java 557      at io undertow servlet handlers ServletInitialHandler handleFirstRequest ServletInitialHandler java 331      at io undertow servlet handlers ServletInitialHandler dispatchRequest ServletInitialHandler java 263      at io undertow servlet handlers ServletInitialHandler access 000 ServletInitialHandler java 81      at io undertow servlet handlers ServletInitialHandler 1 handleRequest ServletInitialHandler java 174      at io undertow server Connectors executeRootHandler Connectors java 202      at io undertow server HttpServerExchange 1 run HttpServerExchange java 793      at java util concurrent ThreadPoolExecutor runWorker ThreadPoolExecutor java 1142      at java util concurrent ThreadPoolExecutor Worker run ThreadPoolExecutor java 617      at java lang Thread run Thread java
7282	Deadlock in BasicAction when jboss remoting and JTA is used  At EJBRemoteTransactionPropagatingInterceptor  a transaction that has been already open at current server could be ignored  thus causing the transaction to be reimported  resulting in the double diamond problem and a deadlock  Issue created based on discussion at jboss support transactions list  http   post office corp redhat com archives jboss support transactions 2016 September msg00000 html  Current jboss remoting implementation on JTA does not provide correct handling of double diamond transaction propagation problem  If transaction is propagated from one server to other one and then back to the first one then such situation can cause deadlock  Remote calls and transactions are processed but when servers using the same remote resource the prepare phase of 2PC can stuck  Transaction is timed out later and recovery process rolls it back  IIOP JTS does not suffer with this flaw