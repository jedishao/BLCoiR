188	SecurityContextHolder JavaDoc errorFrom acegisecurity developer confuse users know InheritableThreadLocal used SecurityContextHolder SecurityContext be associated threads execution thread spawn Javadoc SecurityContextHolder Associates given SecurityContext execution thread threads execution thread
192	login checking fails CAS CAS authentication provider call setDetails created CASAuthenticationToken Authentication authenticate Authentication authentication catch AuthenticationException e be done authenticate is providers Something getDetails
197	ConcurrentSessionController count Sessions ConcurrentSession support enabled user close browser logging locking app session expires doing user logon ConcurrentSessionController counts SessionInformation objects are returned getAllSessions HttpSession expires logged user hits site triggering HttpSession invalidation user login have added function admin logout user calling expireNow session beloging method counted sessions sessions allow user log has HttpSession continue use system
328	AbstractUserDetailsAuthenticationProvider makes hits cache is used has be changed cacheWasUsed throw exception look authenticate notice case failure Acegi suppose is cache synchronization problem make retrieveUser use cache information were date retrieveUser is called think snippet l  avoid check
356	Changes Authentication leak requests using HttpSessionContextIntegrationFilter HttpSessionContextIntegrationFilter read existing SecurityContext object session attach Http request thread calling SecurityContextHolder  setContext means requests get SecurityContext object threads changes authentication attached context example enable Run functionality AbstractSecurityInterceptor authentication be seen change request threads enable threads be gain access have
398	HttpSessionContextIntegrationFilter AuthenticationProcessingFilter thread concurrency issue authentication get redirected login page requested protected resource is thread concurrency issue C GET protected resource S Redirect login C GET login S C POST THREAD login S Redirect resource THREAD THREAD finished reached HttpSessionContextIntegrationFilter post doFilter block means SecurityContext has been updated authentication C GET protected resource THREAD S Redirect login THREAD THREAD completes request SecurityContext is updated Solution Delay redirects using response wrapper HttpSessionContextIntegrationFilter has updated SecurityContext
423	CLONE SEC Introduces Bug Changes Authentication leak requests using HttpSessionContextIntegrationFilter HttpSessionContextIntegrationFilter read existing SecurityContext object session attach Http request thread calling SecurityContextHolder  setContext means requests get SecurityContext object threads changes authentication attached context example enable Run functionality AbstractSecurityInterceptor authentication be seen change request threads enable threads be gain access have
444	Race condition ConcurrentSessionControllerImpl was getting SessionAlreadyUsedException usage user strack trace exception is registerNewSession fail thread registers session commands strack trace http  0 0 0 0 8080 1 Authentication exception occurred redirecting authentication entry point 1E1B65235B4D42FF17C5F76E7287228D is is use problem seems be sequence commands registerSuccessfulAuthentication DEBUG ExceptionTranslationFilter SessionAlreadyUsedException Session
618	is problem classes extend AbstractUserDetailsAuthenticationProvider copies authentication details object copyDetails method be pulled ProviderManager called checkAuthenticationAllowed is called ensure details object is provider does set  s need AbstractAuthenticationManager given is Authentication details object be copied Authentication checkAuthenticationAllowed is called session control is used authentication provider does copy authentication details object authentication g CasAuthenticationProvider check session controller access is allowed takes place copyDetails method AbstractAuthenticationManager is called
670	Deleting ACL_OBJECT_IDENTITY cause deadlocks load test performing load testing found deletes ACL_OBJECT_IDENTITY table JdbcMutableAclService cause deadlocks database is problem using MS SQL server have tested RDBs deadlocks were found simulating users was reproduce deadlocks are caused reasons start deleteAcl ObjectIdentity objectIdentity deleteChildren does following find children ACL delete recursively tested cause deadlocks think call deleteEntries performs find Objectidentity pkey deletes ACL_Entry call deleteObjectIdentityAndOptionallyClass performs find Objectidentity pkey deletes ACL_OBJECT_IDENTITY selects ACL_OBJECT_IDENTITY see entry deleted was class deletes ACL_CLASS outcome MS SQL server practise is perform selects do deletes interleaving selects deletes is recipe deadlocks reorganisation operations found deadlock caused database time deletes ACL_OBJECT_IDENTITY table DB was checking key object had solve synchronized  ve pasted fixed code deletes ACL_CLASS table ACL_OBJECT_IDENTITY row is one referenced find waste time agree cause issues coinciding insert ACL_OBJECT_IDENTITY thought deleteChildren was passed  m deadlocks occur Deletes ACL specified void deleteAcl ObjectIdentity objectIdentity deleteChildren throws ChildrenExistException deleteChildren protected deleteEntries ObjectIdentity oid deleteEntries oidPKey deleted is class require cause deadlocks RDB thread creating ACL have checked ACL_CLASS row exist is waiting insert experience problems note method is synchronised is deadlock avoidance manoeuvre  s ACL_OBJECT_IDENTITY table has key support ACLs cause following situation Thread T1 is attempting delete row X obtains page lock row X buddies Thread T2 is attempting delete row Y obtains page lock row Y buddies T2 performs table scan ensure FK PARENT_OBJECT ID table remember is violated removal row Y has wait lock held T1 be released T1 performs table scan ensure FK PARENT_OBJECT ID table remember is violated removal row X has wait lock held T2 be released has been observed using MS SQL Server load testing  param oidPKey key object identity delete class name protected synchronized deleteObjectIdentity oidPKey  link  param oid find  return object identity found protected retrieveObjectIdentityPrimaryKey ObjectIdentity oid try catch DataAccessException notFound getIdentifier int i length update deleteEntryByObjectIdentityForeignKey Retrieves key acl_object_identity table passed ObjectIdentity methods implementation method create row use
809	Session Control OpenID Incompatibility openid sample worked tried use Session Control does work Solution proposed is update OpenIDAuthenticationProcessingFilter populate details call authenticationManager way uNcode suggests is way fix be related is SS configuration based sample openid is stack trace IllegalArgumentException getDetails required
1396	Race condition HttpSessionContextIntegrationFilter SessionFixationProtectionFilter seems be race condition processing HttpSessionContextIntegrationFilter SessionFixationProtectionFilter is problem fix extending SessionFixationProtectionFilter overriding protected HttpServletRequest request HttpServletResponse response user Authentication object is stored HttpSession processing enters Spring MVC framework causing execution filters request be considered authentication preserving validity session created request Is way do seems keep session fixation protection working way is supposed  m happen OnRedirectUpdateSessionResponseWrapper created HttpSessionContextIntegrationFilter request processing results sendError sendRedirect reading HttpSessionContextIntegrationFilter seems indicate work thoughts advice be appreciated have web application home page be served depending size attributes associated user are using Jetty supports HTTP chunked responses user opens browser goes home page URL using RememberMe token web request executes executes filter stack Spring MVC framework Steps 1d describe processing request 1a HttpSessionContextIntegration filter creates HttpSession puts default SecurityContext ThreadLocal handler 1b RememberMeProcessingFilter authenticates token sets user Authentication object ThreadLocal handler 1c SessionFixationProtectionFilter detects authentication invalidates existing HttpSession creates HttpSession migrating attributes does set user Authentication HttpSession is supposed be done HttpSessionContextIntegration request processing is 1d request goes Spring MVC framework causing response start be sent client using HTTP chunking response includes session id created session created SessionFixationProtectionFilter client begins receiving markup includes script elements script files served web app Steps 2c describe processing request processing takes place request is being processed request sends session id created SessionFixationProtectionFilter request 2a HttpSessionContextIntegration puts default SecurityContext ThreadLocal handler has been set HttpSession 2b RememberMeProcessingFilter authenticates token sets user Authentication object ThreadLocal handler 2c SessionFixationProtectionFilter detects authentication invalidates existing HttpSession creates HttpSession migrating attributes Processing web request is continuing Spring MVC framework happen use JSP view technology 1e processing JSP page import request causes attempt deference causing IllegalStateException Jetty apos Session class setAttribute SPRING_SECURITY_CONTEXT_KEY
2067	Security context removed session servlet used Take following sample servlet  Override  Override method was rewritten see See SEC SEC SEC tell bug lies see is find security context thread holder are flushing thread removes context session servlet logs application extracted error sample application exposing bug attached run using Atmosphere Comet library Spring Security application shows error see does nothing flushing thread servlet is secured Spring Security getOutputStream stream is instance SaveContextServletOutputStream class calls saveContext flush apos bug is method conditions removes security context session removeAttribute springSecurityContextKey Extract call mvn tomcat7 run Java class browse localhost login using admin admin follow instructions reproduce
3108	happens Digest authentication constructing Authentication object is done steps Authentication object is made threads step Consider following scenario User logs system session is created JSESSIONID is set user uses system time DigestAuthenticationFilter starts authentication process places Authentication object authorities SecurityContext Request continues authentication process AbstractSecurityInterceptor populated Authentication object is created put SecurityContext set createAuthenticatedToken DigestAuthenticationFilter comment set method says user flags isEnabled isAccountNonExpired are checked case is solution DigestAuthenticationFilter use createEmptyContext using Digest authentication are requests session is Authentication object returned getAuthentication does have authorities set g isUserInRole returns user has role User makes request server request has header Authorization Digest request user makes request server request does have Authorization Digest header re authentication is done processing request isUserInRole returns Authentication object SecurityContext does have authorities User gets Forbidden response
3109	ThreadPoolTaskScheduler do work DelegatingSecurityContextExecutorWe have setup Spring Boot scheduling suspect stopped working SEC 3031 does set security context run thread were created Getting DelegatingSecurityContextExecutor set enableOnOriginalThread property DelegatingSecurityContextRunnable fix issue TheadPoolTaskScheduler uses ReschedulingRunnable trigger mechanic use cron triggers rescheduling is done pool thread calls executed pool thread fail SecurityContext is set