188	SecurityContextHolder JavaDoc errorFrom acegisecurity developer Javadoc org acegisecurity context SecurityContextHolder Associates SecurityContext current execution thread threads current execution thread spawn confuse users InheritableThreadLocal longer SecurityContextHolder SecurityContext threads current execution thread spawn SecurityContextHolder JavaDoc errorFrom acegisecurity developer context token set factory mappable service session method
192	Concurrent login checking fails CAS CAS authentication provider call setDetails newly created CASAuthenticationToken Alternatively AbstractAuthenticationProvider authenticate common providers Authentication authenticate Authentication authentication AuthenticationException Authentication result doAuthentication authentication result getDetails result setDetails authenitication getDetails AuthenticationException setAuthentication authentication Concurrent login checking fails CAS set authentication login url service config filter servlet
197	ConcurrentSessionController count expired Sessions ConcurrentSession support enabled common user close browser logging locking app session expires function admin logout active user bascially calling SessionInformation expireNow session beloging user logon ConcurrentSessionController counts SessionInformation objects returned getAllSessions HttpSession expires logged user hits site triggering HttpSession invalidation user login ConcurrentSessionController checkAuthenticationAllowed method counted expired sessions sessions user log abondonded HttpSession system ConcurrentSessionController count expired Sessions session set sessions test authentication url control expired
328	AbstractUserDetailsAuthenticationProvider hits cache AbstractUserDetailsAuthenticationProvider authenticate notice failure Acegi suppose cache synchronization problem retrieveUser cache retrieveUser called snippet problem checking latest data cacheWasUsed user retrieveUser username UsernamePasswordAuthenticationToken authentication additionalAuthenticationChecks user UsernamePasswordAuthenticationToken authentication changed cacheWasUsed problem checking amp apos latest data cacheWasUsed user retrieveUser username UsernamePasswordAuthenticationToken authentication additionalAuthenticationChecks user UsernamePasswordAuthenticationToken authentication exception avoid useless check AbstractUserDetailsAuthenticationProvider hits cache cache set user authentication ticket rejects authorities operations
356	Authentication leak synchronous requests HttpSessionContextIntegrationFilter HttpSessionContextIntegrationFilter read existing SecurityContext object session attach Http request thread calling SecurityContextHolder setContext simultaneous requests SecurityContext object threads authentication attached context enable functionality org acegisecurity intercept AbstractSecurityInterceptor authentication change request threads enable threads gain access shouldn Authentication leak synchronous requests HttpSessionContextIntegrationFilter set authentication request session user servlet attribute authorities
398	HttpSessionContextIntegrationFilter AuthenticationProcessingFilter thread concurrency issue successful authentication occassionally redirected login requested resource thread concurrency issue resource Redirect login login POST acegi security check THREAD successful login Redirect resource THREAD THREAD finished reached HttpSessionContextIntegrationFilter post doFilter block SecurityContext updated successfull authentication resource THREAD Redirect login THREAD THREAD completes request SecurityContext updated Solution Delay redirects response wrapper HttpSessionContextIntegrationFilter updated SecurityContext HttpSessionContextIntegrationFilter AuthenticationProcessingFilter thread concurrency issue session context thread response authentication security synchronization threads
423	CLONE Introduces Bug Authentication leak synchronous requests HttpSessionContextIntegrationFilter HttpSessionContextIntegrationFilter read existing SecurityContext object session attach Http request thread calling SecurityContextHolder setContext simultaneous requests SecurityContext object threads authentication attached context enable functionality org acegisecurity intercept AbstractSecurityInterceptor authentication change request threads enable threads gain access shouldn CLONE Introduces Bug Authentication leak synchronous requests HttpSessionContextIntegrationFilter request set port session context security servlet arguments
444	SessionRegistryImpl ConcurrentSessionControllerImpl registerNewSession registerSuccessfulAuthentication Session Impl register ProviderManager Registry Authentication doAuthentication SessionAlreadyUsedException Exception Race condition inside ConcurrentSessionControllerImpl
618	Authentication details object copied successful Authentication ConcurrentSessionController checkAuthenticationAllowed called concurrent session control authentication provider doesn copy authentication details object successful authentication CasAuthenticationProvider check concurrent session controller access allowed takes place copyDetails method AbstractAuthenticationManager called isn problem classes extend AbstractUserDetailsAuthenticationProvider copies authentication details object copyDetails method pulled ProviderManager called checkAuthenticationAllowed called ensure details object provider doesn set clear AbstractAuthenticationManager Authentication details object copied successful Authentication ConcurrentSessionController checkAuthenticationAllowed called authentication set session token login filter details user
670	Deleting ACL OBJECT IDENTITY deadlocks load test performing load testing concurrent deletes ACL OBJECT IDENTITY table JdbcMutableAclService deadlocks database problem SQL server haven tested RDBs deadlocks simulating concurrent users easy reproduce deadlocks caused reasons start deleteAcl ObjectIdentity objectIdentity deleteChildren find children ACL optionally delete recursively tested deadlocks call deleteEntries performs select find Objectidentity pkey deletes ACL Entry call deleteObjectIdentityAndOptionallyClass performs select find Objectidentity pkey deletes ACL OBJECT IDENTITY selects ACL OBJECT IDENTITY entry deleted deletes ACL dependent outcome previous select SQL server practise perform selects deletes interleaving selects deletes recipe deadlocks reorganisation operations deadlock caused database time internally concurrent deletes ACL OBJECT IDENTITY table checking foreign key parent object solve pasted fixed code longer deletes ACL table ACL OBJECT IDENTITY row referenced find waste time agree issues coinciding insert ACL OBJECT IDENTITY untested fully thought deleteChildren passed deadlocks occur Deletes ACL link ObjectIdentity NOTE Passing deleteChildren code code deadlocks database recursion method select delete select sequences JDBC calls recipe deadlocks SQL server heavy load param objectIdentity param deleteChildren ChildrenExistException deleteAcl ObjectIdentity objectIdentity deleteChildren ChildrenExistException notNull objectIdentity Object Identity required notNull objectIdentity getIdentifier Object Identity doesn amp apos provide identifier deleteChildren deadlock territory ObjectIdentity children findChildren objectIdentity children length deleteAcl children find children check children occasional deadlock SQL server amp apos checking amp apos amp apos oidPkey retrieveObjectIdentityPrimaryKey objectIdentity Delete ACL amp apos ACEs acl entry table deleteEntries oidPkey Delete ACL amp apos acl object identity row deleteObjectIdentity oidPkey Clear cache aclCache evictFromCache objectIdentity Deletes ACEs defined acl entry table belonging presented ObjectIdentity param oid rows acl entry delete deleteEntries ObjectIdentity oid deleteEntries retrieveObjectIdentityPrimaryKey oid deleteEntries oidPKey jdbcTemplate update deleteEntryByObjectIdentityForeignKey Object oidPKey Deletes single row acl object identity presented ObjectIdentity delete ACL table link ObjectIdentity deleted require select delete deadlocks RDB thread creating ACL checked ACL row exist waiting insert experience problems note method synchronised deadlock avoidance manoeuvre ACL OBJECT IDENTITY table foreign key support hierarchical ACLs situation Thread attempting delete row obtains exclusive lock row close buddies Thread attempting delete row obtains exclusive lock row close buddies performs table scan ensure PARENT OBJECT table remember violated removal row wait exclusive lock held released performs table scan ensure PARENT OBJECT table remember violated removal row wait exclusive lock held released observed SQL Server load testing param oidPKey primary key object identity delete deleteObjectIdentity oidPKey Unknown macro Delete acl object identity row jdbcTemplate update deleteObjectIdentityByPrimaryKey Object oidPKey Retrieves primary key acl object identity table passed ObjectIdentity methods implementation method create row link createObjectIdentity ObjectIdentity Sid param oid find object identity retrieveObjectIdentityPrimaryKey ObjectIdentity oid Unknown macro jdbcTemplate queryForLong selectObjectIdentityPrimaryKey Object oid getJavaType getName oid getIdentifier DataAccessException notFound Deleting ACL OBJECT IDENTITY deadlocks load test performing load testing concurrent deletes ACL OBJECT IDENTITY table JdbcMutableAclService deadlocks database set object cache acl identity sid check create
809	Assert notNull ConcurrentSessionControllerImpl SessionRegistryUtils OpenIDAuthenticationProcessingFilter checkAuthenticationAllowed FilterChainProxy VirtualFilterChain Filter Authentication SpringSecurityFilter ProviderManager IllegalArgumentException Concurrent Session Control and OpenID Incompatibility
1396	Race condition HttpSessionContextIntegrationFilter SessionFixationProtectionFilter race condition processing HttpSessionContextIntegrationFilter SessionFixationProtectionFilter problem web application heavy served slowly depending size attributes user Jetty supports HTTP chunked responses user opens browser URL RememberMe token initial web request executes filter stack Spring MVC framework Steps describe processing initial request HttpSessionContextIntegration filter creates HttpSession puts SecurityContext ThreadLocal handler RememberMeProcessingFilter authenticates token sets user Authentication object ThreadLocal handler SessionFixationProtectionFilter detects authentication invalidates existing HttpSession creates HttpSession migrating attributes set user Authentication HttpSession supposed HttpSessionContextIntegration request processing complete request Spring MVC framework causing response start client HTTP chunking response includes session newly created session created SessionFixationProtectionFilter client receiving markup includes script elements script files served web app Steps describe processing request processing takes place initial request processed request sends session created SessionFixationProtectionFilter request HttpSessionContextIntegration puts SecurityContext ThreadLocal handler set HttpSession RememberMeProcessingFilter authenticates token sets user Authentication object ThreadLocal handler SessionFixationProtectionFilter detects authentication invalidates existing HttpSession creates HttpSession migrating attributes Processing initial web request continuing Spring MVC framework happen JSP view technology Continued processing JSP initial request attempt deference variable causing IllegalStateException Jetty amp apos AbstractSessionManager Session extending SessionFixationProtectionFilter overriding startNewSessionIfRequired HttpServletRequest request HttpServletResponse response startNewSessionIfRequired request response request getSession setAttribute HttpSessionContextIntegrationFilter SPRING SECURITY CONTEXT KEY SecurityContextHolder getContext getAuthentication user Authentication object stored HttpSession processing enters Spring MVC framework causing execution filters request considered authentication preserving validity session created initial request session fixation protection working supposed worried happen OnRedirectUpdateSessionResponseWrapper created HttpSessionContextIntegrationFilter request processing sendError sendRedirect casual reading HttpSessionContextIntegrationFilter work correctly thoughts advice appreciated Race condition HttpSessionContextIntegrationFilter SessionFixationProtectionFilter authentication set filter context security servlet decode attribute
2067	Security context incorrectly removed session asynchronous servlet sample servlet Override doGet HttpServletRequest req HttpServletResponse resp ServletException IOException req startAsync Thread AsyncThread Override TimeUnit SECONDS sleep resp getOutputStream flush Exception printStackTrace start flushing separate thread servlet secured Spring Security resp getOutputStream stream instance org springframework security web context SaveContextOnUpdateOrErrorResponseWrapper SaveContextServletOutputStream calls org springframework security web context HttpSessionSecurityContextRepository SaveToSessionResponseWrapper saveContext flush amp apos bug method conditions removes security context session httpSession removeAttribute springSecurityContextKey method heavily rewritten bug lies find security context thread local holder flushing thread removes context session Basically asynchronous servlet logs application extracted error prepared sample simplistic application exposing bug attached Atmosphere Comet library Spring Security application exact error Extract call mvn tomcat Java browse localhost login admin admin follow instructions reproduce Security context incorrectly removed session asynchronous servlet session context set request response url control authentication
3108	DigestAuthenticationFilter SecurityContextHolder createEmptyContext Digest authentication concurrent requests session Authentication object returned SessionContextHolder getContext getAuthentication authorities set HttpServletRequest isUserInRole returns incorrectly user role Digest authentication constructing Authentication object steps incomplete Authentication object visible threads step scenario User logs system session created JSESSIONID set user system time User request server request header Authorization Digest DigestAuthenticationFilter starts authentication process places incomplete Authentication object authorities SecurityContext Simultaneously request user request server request Authorization Digest header authentication processing request request isUserInRole returns Authentication object SecurityContext authorities User incorrectly Forbidden response Request continues authentication process AbstractSecurityInterceptor fully populated Authentication object created SecurityContext set createAuthenticatedToken DigestAuthenticationFilter comment set method user flags isEnabled isAccountNonExpired checked solution DigestAuthenticationFilter SecurityContextHolder createEmptyContext context session returns test request set nonce filter
3109	Concurrent ThreadPoolTaskScheduler don work DelegatingSecurityContextExecutorWe setup Spring Boot scheduling method security background jobs DelegatingSecurityContextScheduledExecutorService http petrikainulainen net programming spring framework spring trenches invoking secured method scheduled job Spring Security Magic suspect stopped working DelegatingSecurityContextRunnable Callable doesn set clear security context thread created Concurrent TheadPoolTaskScheduler ReschedulingRunnable trigger mechanic cron triggers rescheduling pool thread random subsequent calls executed pool thread fail SecurityContext set DelegatingSecurityContextExecutor set enableOnOriginalThread property DelegatingSecurityContextRunnable issue Concurrent ThreadPoolTaskScheduler don work DelegatingSecurityContextExecutorWe setup Spring Boot scheduling user set session correct password expired test servlet