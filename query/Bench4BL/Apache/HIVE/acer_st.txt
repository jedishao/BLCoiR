545	ArrayList Vector single threaded Hive codeMost Hive code single threaded Vector efficient ArrayList http java sun docs api java util ArrayList html ArrayList roughly equivalent Vector unsynchronized ArrayList Vector single threaded partition vector context row file column input writer
3057	metastore HiveMetaStore HMSHandler set thread local raw store shutdown shutdown function metastore HiveMetaStore HMSHandler set thread local RawStore variable threadLocalMS Subsequent getMS calls wrong RawStore object metastore HiveMetaStore HMSHandler set thread local raw store shutdown task set request node add table start partition
3408	HashMap getEntry QueryPlan logPlanProgress HashSet containsKey extractCounters HiveHistory ExecDriver MapRedTask getQueryPlan A race condition is caused within QueryPlan classHive s threads are stopped at HashMap getEntry  that is used within QueryPlan extractCounters  and QueryPlan updateCountersInQueryPlan
4000	Hive client infinite loop cpu Hive client starts multiple threads track progress MapReduce jobs threads access HashMaps locks HashMaps modified race conditions lead client threads stuck infinite loops Hive client infinite loop cpu set job config key hive conf check string
7011	HiveInputFormat split generation isn thread safe Tez split generation parallel protect inputformat cache concurrent access HiveInputFormat split generation isn thread safe split file create path reader splits conf type
7341	Support Table replication HCatalog instances HCatClient doesn provide support replicating HCatTable definitions HCatalog Server Hive metastore instances Systems Apache Falcon find replicate partition data clusters HCatalog metadata sync poses couple problems definition source table change column schema formats record formats serde parameters system diff tables update target metastore targetTable resolve sourceTable targetTable diff sourceTable hcatClient updateTableSchema dbName tableName targetTable current HCatClient addPartitions API requires partition schema derived table schema requiring table schema resolved partitions schema table problematic introduces race conditions partitions differing column schemas schema change copied parallel avoided HCatAddPartitionDesc track partition schema flight source target metastores running incompatible versions Hive impending patch attempts address concerns caveats HCatTable diff method compare HCatTable instance resolve diff method copy table attributes HCatTable serialize deserialize mechanism HCatClient serializeTable HCatClient deserializeTable HCatTable instances constructed loaders comparison HCatPartition finer grained control Partition column schema StorageDescriptor settings partitions copied completely source ability override specific properties required location HCatClient updateTableSchema update entire table definition column schema cleaned removed redundancy HCatTable HCatCreateTableDesc HCatCreateTableDesc Builder prior API failed separate table attributes add table operation attributes providing fluent interfaces HCatTable composing HCatTable instance HCatCreateTableDesc interfaces cleaner ish setters deprecated favour HCatTable HCatPartition HCatAddPartitionDesc post patch trunk shortly Support Table replication HCatalog instances table partition cat schema test replication pig event
8440	TThreadPoolServer WorkerProcess ThriftHive Processor execute ThreadPoolExecutor Worker run runInternal HiveServer HiveServerHandler Driver ProcessFunction getResult TBaseProcessor process Hiveserver block query
9199	Excessive exclusive lock DDLs DummyTxnManager DummyTxnManager lockMode WriteEntity database table determined complete writeType DDL output WriteEntity complete DDL operations exclusive locks needed unnecessary locking contention createTable DummyTxnManager suggests exclusive lock table database writeentity complete Excessive exclusive lock DDLs DummyTxnManager lock set txn locks test table write partition
9598	ReentrantLock Sync tryRelease AbstractQueuedSynchronizer ReentrantLock HiveQueryResultSet closeClientOperation HiveStatement Reentrant Lock Release release SQLException IllegalMonitorStateException Exception java lang IllegalMonitorStateException java util concurrent locks ReentrantLock Sync tryRelease
10483	insert overwrite partition deadlocks DbTxnManagerinsert overwrite partition xxxx select xxx join xxxx Shared conflicts Exclusive lock Insert Overwrite txn precisely insert overwrite requires lock partition read side lock query simpler insert overwrite partition xxxx select insert overwrite partition deadlocks DbTxnManagerinsert overwrite partition xxxx select xxx join xxxx test table bucket insert query file set column
11036	Race condition DataNucleus Metastore hangUnder moderate high concurrent query workload Metastore deadlocked DataNucleus Race condition DataNucleus Metastore hangUnder moderate high concurrent query workload Metastore deadlocked DataNucleus table partition list set query string partitions convert
11616	TThreadPoolServer WorkerProcess HadoopThriftAuthBridge Server SaslDigestCallbackHandler TokenStoreDelegationTokenSecretManager invokeOnRawStore retrievePassword DBTokenStore validateClientResponse TSaslTransport SaslParticipant DigestMD5Server evaluateChallengeOrResponse Server NucleusTransactionException Error TokenStoreException DelegationTokenSecretManager reuses the same objectstore  which has concurrency issues
12238	NumberFormatException VectorUDFDateString 1 StringGroupColConcatStringScalar forInputString SimpleDateFormat DigitList StringUnaryUDF parse String DecimalFormat parseLong NumberFormatException Vectorization  Thread safety errors in VectorUDFDate
12248	ExecutionContextImpl ExecutionContextThreadedImpl retrieveObject JDOPersistenceManager assertNotDetached jdoRetrieve retrieveAll getAllTokenIdentifiers Context Impl Execution ObjectDetachedException The rawStore used in DBTokenStore should be thread safe
12266	client exists abnormally doesn release ACID locks start Hive CLI locking enabled command acquires locks shell command completes locks command remain timeout Beeline issue add proper hooks release locks command dies client exists abnormally doesn release ACID locks table partition lock test txn locks set heartbeat
12409	SessionState initTxnMgr thread safe method multiple threads Session HIVE SessionState initTxnMgr thread safe set session operation table user hive conf current
12529	HiveTxnManager acquireLocks block foreverCurrently DbTxnManager method block competing locks clients max wait time exception timeout current method signature written HiveTxnManager acquireLocks block foreverCurrently DbTxnManager method block competing locks lock locks table test txn set partition release
12620	Misc improvement Acid module DbLockManger unlock fails lock turn timeout lock removed DbLockManger internal tracking Add logic DBLockManager detect attempt interleave transactions locks statements read auto commit mode TxnHandler checkLock connection TxnHandler timeOutLocks refactor log locks expired simplifies debugging TxnHandler getTxnIdFromLockId include lock TxnHandler checkRetryable log exception TxnHandler lock MetaException Couldn amp apos find lock created include lockid Misc improvement Acid module test table type txn acid version file conf
12768	Thread safety binary sortable serde decimal deserialization thread safety issues decimal buffer binary sortable serde Thread safety binary sortable serde decimal deserialization write timestamp set field binary ser buffer read
12797	LinkedList ListItr checkForComodification TezSessionPoolManager HiveServer2 2 stop HiveServer2 remove Comodification check Itr Linked ConcurrentModificationException Synchronization issues with tez llap session pool in hs
12904	LLAP deadlock task scheduling Thread BLOCKED org apache hadoop hive llap daemon impl TaskExecutorService TaskWrapper isInWaitQueue bci Compiled frame org apache hadoop hive llap daemon impl TaskExecutorService finishableStateUpdated org apache hadoop hive llap daemon impl TaskExecutorService TaskWrapper bci Compiled frame org apache hadoop hive llap daemon impl TaskExecutorService access org apache hadoop hive llap daemon impl TaskExecutorService org apache hadoop hive llap daemon impl TaskExecutorService TaskWrapper bci Compiled frame org apache hadoop hive llap daemon impl TaskExecutorService TaskWrapper finishableStateUpdated bci Compiled frame org apache hadoop hive llap daemon impl QueryInfo FinishableStateTracker sourceStateUpdated java lang String bci Compiled frame org apache hadoop hive llap daemon impl QueryInfo sourceStateUpdated java lang String bci Compiled frame org apache hadoop hive llap daemon impl QueryTracker registerSourceStateChange java lang String java lang String org apache hadoop hive llap daemon rpc LlapDaemonProtocolProtos SourceStateProto bci Compiled frame org apache hadoop hive llap daemon impl ContainerRunnerImpl sourceStateUpdated org apache hadoop hive llap daemon rpc LlapDaemonProtocolProtos SourceStateUpdatedRequestProto bci Compiled frame org apache hadoop hive llap daemon impl LlapDaemon sourceStateUpdated org apache hadoop hive llap daemon rpc LlapDaemonProtocolProtos SourceStateUpdatedRequestProto bci Compiled frame org apache hadoop hive llap daemon impl LlapDaemonProtocolServerImpl sourceStateUpdated google protobuf RpcController org apache hadoop hive llap daemon rpc LlapDaemonProtocolProtos SourceStateUpdatedRequestProto bci Compiled frame org apache hadoop hive llap daemon rpc LlapDaemonProtocolProtos LlapDaemonProtocol callBlockingMethod google protobuf Descriptors MethodDescriptor google protobuf RpcController google protobuf Message bci Compiled frame org apache hadoop ipc ProtobufRpcEngine Server ProtoBufRpcInvoker call org apache hadoop ipc RPC Server java lang String org apache hadoop Writable bci Compiled frame org apache hadoop ipc RPC Server call org apache hadoop ipc RPC RpcKind java lang String org apache hadoop Writable bci Compiled frame org apache hadoop ipc Server Handler bci Compiled frame org apache hadoop ipc Server Handler bci Compiled frame java security AccessController doPrivileged java security PrivilegedExceptionAction java security AccessControlContext bci Compiled frame javax security Subject doAs javax security Subject java security PrivilegedExceptionAction bci Compiled frame org apache hadoop security UserGroupInformation doAs java security PrivilegedExceptionAction bci Compiled frame org apache hadoop ipc Server Handler bci Interpreted frame Thread BLOCKED org apache hadoop hive llap daemon impl QueryInfo FinishableStateTracker unregisterForUpdates org apache hadoop hive llap daemon FinishableStateUpdateHandler bci Compiled frame org apache hadoop hive llap daemon impl QueryInfo unregisterFinishableStateUpdate org apache hadoop hive llap daemon FinishableStateUpdateHandler bci Compiled frame org apache hadoop hive llap daemon impl QueryFragmentInfo unregisterForFinishableStateUpdates org apache hadoop hive llap daemon FinishableStateUpdateHandler bci Compiled frame org apache hadoop hive llap daemon impl TaskExecutorService TaskWrapper maybeUnregisterForFinishedStateNotifications bci Compiled frame org apache hadoop hive llap daemon impl TaskExecutorService InternalCompletionListener onSuccess org apache tez runtime task TaskRunner Result bci Compiled frame org apache hadoop hive llap daemon impl TaskExecutorService InternalCompletionListener onSuccess java lang Object bci Compiled frame google common util concurrent Futures bci Compiled frame java util concurrent ThreadPoolExecutor runWorker java util concurrent ThreadPoolExecutor Worker bci Compiled frame java util concurrent ThreadPoolExecutor Worker bci Interpreted frame java lang Thread bci Interpreted frame IPC Server handler waiting lock Monitor ecb Object org apache hadoop hive llap daemon impl TaskExecutorService TaskWrapper held ExecutionCompletionThread ExecutionCompletionThread waiting lock Monitor Object org apache hadoop hive llap daemon impl QueryInfo FinishableStateTracker held IPC Server handler total deadlock amp apos caused blocks TaskWrapper maybeUnregisterForFinishedStateNotifications Eventually calls FinishableStateTracker unregisterForUpdates FinishableStateUpdateHandler handler FST sourceStateUpdated String sourceName eventually calls isInWaitQueue returns doesn don issues sync blocks synch methods objects call trivial objects good replace sync methods sync blocks cover entire method remove unnecessary isWait scope blocks adjusted based logic LLAP deadlock task scheduling task set node check list test queue llap
12926	LinkedList ListItr checkForComodification TezSessionPoolManager HiveServer2 2 stop HiveServer2 remove Comodification check Itr Linked ConcurrentModificationException Another synchronization issue with tez llap session pool in hs
12927	HBase metastore sequences row row getNextSequence sequence IOException safe presence concurrency HBase increment API HBase metastore sequences row row column set config key hive base avro properties
12996	Temp tables shouldn locked Internally INSERT VALUES statements temp table accomplish functionality temp tables shouldn stored metastore tables ACID definition visible session created don multiple threads session temp table query lock manager mysql select COMPLETED TXN COMPONENTS CTC TXNID CTC DATABASE CTC TABLE CTC PARTITION acid acid values tmp table acid acid values tmp table acid values tmp table acid acid values tmp table acid today acid values tmp table acid today hour Temp tables shouldn locked test list table data size script beeline buffer
13013	Improve concurrency TxnHandler operations TxnHandler Serializable isolation dropped READ COMMITTED SELECT UPDATE support reduce number deadlocks DBs Improve concurrency TxnHandler event column txn set reaper delay resolve partition
13213	DbLockManger work acid resources insert values ACID table acquire Read lock acid table acquire Exclusive lock DbLockManger work acid resources test function local work status resources acid resource
13395	Lost Update problem ACIDACID users Lost Update problem Hive Driver recordValidTxns records snapshot query called Driver compile suppose concurrent update set executed simplicity assume row happen compile time precisely acquireLocksAndOpenTxn runInternal called lock snapshot snapshot lock row block commits proceeds snapshot specific issue solved Hive HIVE large patch deals multi statement txns moving recordValidTxns locks acquired reduces likelihood doesn eliminate problem version code issue Assume queries start txn txnid lock blocks updates row ReaderKey currentTransactionId commits proceed snapshot includes write set ReaderKey currentTransactionId merge logic runs version row lost update problem locks insufficient MVCC architecture level Row originalTransactionId rowid bucket currentTransactionId update delete table scan check write row currentTransactionId currentTransactionId row read fail query currentTransactionId surfaced higher level check work efficiently longer term support fast update user defined vis streaming ingest work multi statement txns lock snapshot start txn queries snapshot locks queries acquired snapshot locked situation pre HIVE robust solution commonly MVCC track start commit time logical counter transaction detect txns overlap track write set data rows partitions level granularity modified txn txns overlap time wrote element abort called committer wins rule requires schema change convenient sequence txnId start commit time txnid start time add filed TXNS table complication elements sequence faster file delta base dir limited digits exceeded require thought handling upgrade migration write set tracking requires additional metastore table keeping info HIVE LOCKS longer term SQL side auto commit mode acquire locks open txn update locks txn implies Thrift change pass lockId openTxn work Streaming API opens txns acquires locks issue Streaming Insert feels hacky simple Write Set tracking multi statement txns transactions Suppose order operations conventional lock manager MVCSS block write MVCC don readers interfere writers schedule Hive semi shared write don conflict shared read locks Hive current implementation time committed released locks lost update allowed commit write set tracking Lost Update problem ACIDACID users Lost Update problem lock list txn col set file data key
13458	Heartbeater doesn apos fail query heartbeat fails heartbeat fails locate lock fail current query doesn happen bug stopHeartbeat stops heartbeat additional heartbeat assumption query fail Heartbeater doesn apos fail query heartbeat fails lock set test txn task table heartbeat request
13512	initializing dag ids TezWork thread safe parallel compilationWhen parallel query compilation enabled concurrent running threads create TezWork objects dag counter dag thread safe counter AtomicInteger counter TezWork String queryId Configuration conf dagId queryId counter initializing dag ids TezWork thread safe parallel compilationWhen parallel query compilation enabled concurrent running threads create TezWork objects dag set vertex create dir conf dag hive query
13599	TaskExecutorService WaitQueueWorker handleScheduleAttemptedRejection TaskExecutorService removeAndGetFromPreemptionQueue Executors RunnableAdapter run Queue access 1100 AbstractQueue remove ThreadPoolExecutor Worker NoSuchElementException UncaughtException Exception LLAP  Incorrect handling of the preemption queue on finishable state updates
13699	JavaDataModel thread safe parallel compilation JavaDataModel method thread safe issue parallel query compilation enabled threads attempt call JavaDataModel time JavaDataModel thread safe parallel compilation copy set test memory user operation writer context
13725	ACID Streaming API synchronize calls multiple threads endpointCurrently streaming endpoint creates metastore client RPC client internally thread safe API methods provide relevant synchronization methods called threads sample Thread creates streaming endpoint opens txn batch Thread heartbeats txn batch current impl result sequence response response calls thread thread vice versa ACID Streaming API synchronize calls multiple threads endpointCurrently streaming endpoint creates metastore client RPC test set txn create partition file conf hive
13753	metastore client thread safe DbTxnManager fact multiple threads sharing metastore client RPC Thrift thread safe Race condition happen sees sequence response error message Thrift server response Thrift server request thread Solution synchronize methods client side metastore client thread safe DbTxnManager set lock hive cache txn list config client
13833	Add initial delay starting heartbeat scheduling heartbeat lock acquisition unnecessary send heartbeat time locks acquired Add initial delay skip Add initial delay starting heartbeat task heartbeat lock request txn test count create
13858	LLAP preempted task waiting completeInitialization executing code suppressed interruptAn interrupt HiveProcessor abort call attempting preempt task specific task middle HDFS handled interrupt retrying result interrupt status thread reset skipping completeInitialization task ended blocking result single executor slot permanently blocked LLAP Depending running cluster level deadlock LLAP preempted task waiting completeInitialization task set node test check conf config lock
14357	TestDbTxnManager testLocksInSubquery failing branch checkCmdOnDriver driver compileAndRespond insert select select txnMgr openTxn txnMgr acquireLocks driver getPlan ctx locks getLocks assertEquals Unexpected lock count locks size checkLock LockType SHARED READ LockState ACQUIRED locks checkLock LockType SHARED READ LockState ACQUIRED locks checkLock LockType SHARED READ LockState ACQUIRED locks test failing expected order locks supposed closer inspection familiar locks order Raising jira understand explain helpful TestDbTxnManager testLocksInSubquery failing branch test set command jira lock write read partition
14400	Handle concurrent insert dynamic partition multiple users concurrently issuing insert statements partition side queries partition time amp apos issued realize partition add partition metastore AlreadyExistsException earlier query created race condition imagine table created create table partitioned string queries launched time sessions insert table partition values amp apos Bob amp apos amp apos today amp apos creates partition amp apos today amp apos insert table partition values amp apos Joe amp apos amp apos today amp apos fail AlreadyExistsException Handle concurrent insert dynamic partition table txn stats set lock bucket sort ctx
14463	SynchronousQueue TransferStack LockSupport parkNanos ThreadPoolExecutor awaitFulfill park ThreadPoolExecutor Worker run SynchronousQueue getTask Unsafe hcatalog server extensions test cases getting stuck
14739	Replace runnables runtime shutdown hooks avoid deadlock Deepesh Khandelwal reported deadlock occur running queries hive cli Chris Nauroth analyzed reported hive adds shutdown hooks java Runtime execute deterministic order causing deadlocks hadoop shutdown hooks hadoop shutdown locked FileSystem Cache FileSystem close hive shutdown hook locked FileSystem close FileSystem Cache order causing deadlock Hive Hadoop ShutdownHookManager runs shutdown hooks deterministic order based priority avoid deadlock code Replace runnables runtime shutdown hooks avoid deadlock session task executor hook preemption queue set work
14778	document threading model Streaming APIThe model obvious documented properly StreamingConnection internally maintains MetaStoreClient objects Thrift client actual RPC call primary heartbeat TransactionBatch created StreamingConnection reference MetaStoreClients model outstanding closed TransactionBatch StreamingConnection TransactionBatch threads accessing concurrently thread calling TransactionBatch heartbeat calling methods document threading model Streaming APIThe model obvious documented properly set hive vector length hash cost array memory
14924	HiveMetaStoreChecker checkPartitionDirs findUnknownPartitions checkTable checkMetastore check Partition Dirs Meta Checker Store NullPointerException Exception MSCK REPAIR table with single threaded is throwing null pointer exception
15090	Temporary failure ExpiredTokenRemover thread HIVE decided close metastore unexpected exception expired token removal process leaves running metastore ExpiredTokenRemover thread move running loop hope thread recover exception Temporary failure ExpiredTokenRemover thread task node job token set update log pending