543	region â€˜s state is kept places master opening possibility race conditions region apos state exists maps RegionManager unassignedRegions pendingRegions regionsToClose closingRegions regionsToDelete race conditions was found HBASE HBase 0 1 x patch holes find solution requires lot changes HMaster be applied HBase trunk Proposed solution Create class encapsulates region state provide synchronized access class validates state changes be structure holds regions states be synchronized collection kind
659	HLog  cacheFlushLock cleared hangs region have region is stuck close was ordained split is have log pertaining region thread dump have threads blocked HLog  cacheFlushLock looking code is code path get situation lock is held released regionserver 0 0 0 0 0 0 0 0 60020 compactor daemon prio tid nid waiting condition 0x0000000041c6c000 x0000000041c6ce00 regionserver 0 0 0 0 0 0 0 0 60020 logRoller daemon prio tid nid waiting condition 0x0000000041a6a000 x0000000041a6ab00 INFO HRegion checking compaction completed region enwiki IK9sWdHJe6ffGZgFPsqIvk  1212092907061 12sec INFO HRegion Splitting enwiki IK9sWdHJe6ffGZgFPsqIvk  1212092907061 size is m desired size is m DEBUG HRegion compactions cache flushes region enwiki IK9sWdHJe6ffGZgFPsqIvk DEBUG HRegion updates scanners region enwiki IK9sWdHJe6ffGZgFPsqIvk DEBUG HRegion scanners region enwiki IK9sWdHJe6ffGZgFPsqIvk DEBUG HRegion row locks region enwiki IK9sWdHJe6ffGZgFPsqIvk DEBUG HRegionServer enwiki IK9sWdHJe6ffGZgFPsqIvk  1212092907061 closing Adding retiringRegions DEBUG HRegion Started memcache flush region enwiki IK9sWdHJe6ffGZgFPsqIvk  1212092907061 region memcache size m INFO Server IPC Server handler call batchUpdate enwiki IK9sWdHJe6ffGZgFPsqIvk  1212092907061 BatchUpdate 2eeb0275 err org NotServingRegionException enwiki IK9sWdHJe6ffGZgFPsqIvk NotServingRegionException enwiki IK9sWdHJe6ffGZgFPsqIvk INFO Server IPC Server handler call batchUpdate enwiki IK9sWdHJe6ffGZgFPsqIvk  1212092907061 BatchUpdate 46ee6763 err org NotServingRegionException enwiki IK9sWdHJe6ffGZgFPsqIvk NotServingRegionException enwiki IK9sWdHJe6ffGZgFPsqIvk locked Integer locked Integer locked Integer
663	sequence number cache flushAn HRegion asks HStore flush cache sequence number X  assumption is updates X be flushed startup reconstruction updates X are skipped use updatesLock guarantee updates X be flushed HStore flushes X snapshots are taken write lock updatesLock is acquired updates are written log cache read lock updatesLock is acquired acquired sequence number X is obtained write lock updatesLock updates sequence number X have been written cache be flushed
699	Fix TestMigrate HudsonIts hanging hudson Caught threaddump tried adding relocateRegion taking scan verify was fixing region table waiting vanished unix process hbase threads hanging hung tried get region was trying go address
818	Deadlock running flushSomeRegions Playing MR uploading regionserver regions ran deadlock Found Java level deadlock IPC Server handler is held IPC Server handler IPC Server handler is held IPC Server handler IPC Server handler is held IPC Server handler Java stack information threads listed IPC Server handler IPC Server handler IPC Server handler Found deadlock Regionserver is hosed waiting lock monitor 0x084be38c object 0xb6f69a70 Flusher waiting lock monitor 0x080f8dec object 0xb73610c0 HRegion waiting lock monitor 0x086e8fe8 object 0xb6f69cf0 HashSet waiting lock Flusher waiting lock HRegion locked HashSet locked Flusher waiting lock HashSet locked HRegion
950	causes update hang rowlock expires proceeds getting row lock commit works existing RowLocks  s APIIntroduced HBASE RowLock passed commit is ignored
1569	race condition take regionserver happened hours import load cluster shutdown seemed be IllegalAccessError Call
1740	ICV has race condition load ICV demonstrates race condition load result is KeyValue timestamp memcache hfile hfile get scan code does know one read picks keyvalues is is happens level start ICV snapshot happens moves memstore snapshot ICV code puts value memstore has timestamp keyvalue snapshot is race condition attempts fix failed production SU issue is fix
1840	RowLock fails used IndexTableThe following exception is thrown using RowLock update row IndexedTable NOTE   Line numbers stacktrace make sense apos ve been hacking loads debug info NOTE   attaching fix includes unit tests IOException IOException row lock
1869	IndexedTable delete fails used conjunction RowLock Created following test TestIndexedTable void testLockedRowDelete throws IOException fails throws following exception IOException IOException row lock Patch coded version SVN looks 0 21 0 going testing packaging attach
2023	Client sync block cause thread client block others Take client processing requests table goes thread get stuck locateRegionInMeta is located following sync block synchronized userRegionLock threads need find region ITS CACHED encounter sync wait become issue thrift server noticed problem region prevent access regions solution lock get rid
6565	Coprocessor exec result Map is thread develop coprocessor program found results repeated tests example result size is appears read java code found TreeMap thread be used environment cause bug happened
8923	ChaosMonkey test teardown fail race ChaosMonkey chaosmonkey restarts RS moment test teardown happens cluster recovery see cluster status RS process is running cluster recovery tries start gets ExitCodeException Boom
13606	Assigns specified regions robin void assign List regions servers regions bulkAssignThresholdRegions assign is sync pathfrom comment behavior assign be sync code has path sync async invokeAssign region is async submit assign bulkAssign is sync calls waitUntilDone
13662	throw OutOfOrderScannerNextException scanner heartbeat patches HBASE seems be recover OutOfOrder exception error show scan throws OutOfOrderScannerNext scan has failurewhile fixing HBASE noticed have failure scan request has hasNextCallSeq nextCallSeq is means client retry send request nextCallSeq date result OutOfOrderScannerNextException scan code discussion Stack ended saying decrementing callSeq exception seems be had question having nextCallSeq be was supposed prevent requests id thoughts
13959	Region splitting uses thread cases storefiles need be split part region split logic uses threadpool size set size number stores fix increase concurrency operation table setup involves column family translates translates having store threadpool is run thread write workload be tens storefiles store time splitting threadpool size files end getting split bit tracing noticed takes average 350ms create reference file splitting storefile involves creating storefile count takes 14s get phase reference files storefile pushing time region is 18s environments are setup fail makes client exhaust retries fail NotServingRegionException
13988	Add exception handler lease thread prod cluster region server exited threads were excluding threads log doubted lease thread was root need add exception handler lease thread debug exited future INFO HRegionServer STOPPED threads are stop INFO HBaseServer Stopping server INFO LogRoller LogRoller exiting INFO MemStoreFlusher Thread exiting INFO HRegionServer regionserver21600 compactionChecker exiting INFO HRegionServer regionserver21600 periodicFlusher exiting
14178	regionserver blocks waiting offsetLock regionserver blocks client rpc timeout print regionserver jstack seems lot threads were blocked waiting offsetLock detail infomation belows PS table block cache is Locked synchronizers handler queue port   daemon prio os_prio tid nid wait State WAITING object monitor locked IdLock Entry locked HRegion ReentrantLock
14241	Fix deadlock cluster shutdown connection closeCaught testing branch shutting TestMasterMetricsWrapper Found Java level deadlock MASTER_META_SERVER_OPERATIONS ip  10 32 130 237 55342 0 is held M ip  10 32 130 237 55342 M ip  10 32 130 237 55342 is held MASTER_META_SERVER_OPERATIONS ip  10 32 130 237 55342 0 stack dump deadlock debug output attached Root cause RpcClientImpl  close obtain lock connections markClosed tries obtain lock connection object thread MetaServerShutdownHandler calls RpcClientImpl Connection  setupIOstreams Lock connection object is obtained lock connections is attempted leading deadlock waiting lock monitor 0x00007f2a040051c8 object 0x00000007e36108a8 PoolMap waiting lock monitor 0x00007f2a04005118 object 0x00000007e3610b00 RpcClientImpl Connection
14359	close hang error exception thrown AsyncProcess  sendMultiActionCurrently AsyncProcess  sendMultiAction catch RejectedExecutionException let error exception go cause decTaskCounter invoked recommendation using HTable is close table clause  close call flushCommits wait task done problem is error exception OutOfMemoryError thrown taskSent be taskDone AsyncProcess  waitUntilDone return autoflush is set data flush table be rpc call rpcTimeOut break call thread wait product env error observed is OutOfMemoryError create thread observed client thread hang hours
14463	performance downgrade reading key BucketCache store feature data items HBase do machine learning features supply outputs search engine resolve problem propose use ReentranceReadWriteLock BucketCache introduce class called IdReadWriteLock implement scenario launch hundreds yarn workers worker read features e rowkey HBase be reading rowkey were using LruCache start try BucketCache resolve gc issue titled have observed performance downgrade analytics found root cause is lock BucketCache  getBlock shown Cacheable cachedBlock len read involves array copy  s time costed operation LruCache  re using synchronized IdLock  getLockEntry read dropping bucket be executed causes performance
14555	Deadlock MVCC branch toString saw IT test State BLOCKED Blocked count Waited count Stack State BLOCKED Blocked count Waited count Stack Thread handler queue port Blocked LinkedList 32b53d9e Blocked handler queue port Thread handler queue port Blocked Object 2a5e9ae8 Blocked handler queue port Thread handler queue port
14812	Fix ResultBoundedCompletionService deadlock thrift2 worker   daemon prio os_prio tid nid wait State WAITING object monitor locked ResultBoundedCompletionService locked BufferedMutatorImpl
14926	thrift worker daemon prio tid nid recover do have client side logs  ve been HBASE connected client thrift sockets have server side read timeout patch got applied fb branch thrift has changed client crashes worker thread gets readingThrift server is hung worker threads are doing State locked BufferedInputStream
15001	Thread Safety issues ReplicationSinkManager HBaseInterClusterReplicationEndpoint ReplicationSinkManager is thread cause problems HBaseInterClusterReplicationEndpoint walprovider is example threads report sinks sink list be report size ArrayList is thread Update leads ArithmeticException division is lead retries ReplicationSource idea is make operations ReplicationSinkManager thread do verification size replicated edits report success HBaseInterClusterReplicationEndpoint depends number sinks batch edits shipping  s following code makes assume are batches process sink size is time reach batching part sink size becomes int n maxThreads size
15030	Deadlock master TableNamespaceManager running IntegrationTestDDLMasterFailoverI was running IntegrationTestDDLMasterFailover distributed cluster notice is part master jstack ProcedureExecutor daemon prio tid nid waiting monitor entry 0x00007fd2c2834000 Locked synchronizers ProcedureExecutor 3 daemon prio tid nid waiting condition Locked synchronizers None Found Java level deadlock ProcedureExecutor 3 is held ProcedureExecutor 1 ProcedureExecutor 1 is held ProcedureExecutor 3 Java stack information threads listed ProcedureExecutor 3 ProcedureExecutor 1 Found deadlock try dig info happened logs showing State BLOCKED object monitor waiting lock TableNamespaceManager ReentrantReadWriteLock State TIMED_WAITING parking parking wait ReentrantReadWriteLock locked TableNamespaceManager waiting synchronizer 0x000000072574b330 ReentrantReadWriteLock waiting lock monitor 0x00007fd2cc328908 object 0x0000000725c36a48 TableNamespaceManager parking wait ReentrantReadWriteLock locked TableNamespaceManager waiting lock TableNamespaceManager
15093	Replication report size log queue source multiwal is enabled Replication report size size log queue source multiwal is enabled happens method MetricsSource  setSizeofLogQueue performs operations world is synchronized divide MetricsSource  setSizeofLogQueue MetricsSource  incrSizeofLogQueue MetricsSource  decrSizeofLogQueue are setting size incrementing decrementing
15146	Do block Reader threads queueing scheduler queueBlocking epoll thread is dispatch method block trying add blocking queue schedulers causes readers block tcp acks are delayed everything slows rpc scheduler have lots queues queues have capacity limits
15650	Remove TimeRangeTracker point contention threads reading StoreFile HBASE is Remove TimeRangeTracker point contention threads writing Store is point contention reading
15957	bug is related HBASE HBASE Fix HBASE introduced check connections connection is worked fix HBASE introduced handling interrupt writer thread ends circumstances writer thread is running connection thread is started interrupt cause calling markClosed set shouldCloseConnection flag parent connection time handling connections markClosed return be called result connection be removed connections pool finish
16081	Replication remove_peer gets blocks WAL rollingWe use blocking take CompletionService HBaseInterClusterReplicationEndpoint remove peer try shut threads race condition underlying executor gets shutdown CompletionService  take block means remove_peer call finish ReplicationSourceManager  removePeer ReplicationSourceManager  recordLog lock object are roll WALs situation end WALs
16144	Replication queue lock live RS acquiring lock has died default use operation claimQueues ZK RS acquiring lock crash claimQueues done lock be RS claim queue set useMulti add lock copy nodes queue lock
16304	HRegion  RegionScannerImpl  handleFileNotFoundException lead deadlock trying obtain write lock updatesLockhere is jvm stack thread dump Java HotSpot TM Bit Server VM mode Attach Listener daemon prio tid nid waiting condition 0x0000000000000000 IPC Parameter Sending Thread   daemon prio tid nid waiting condition 0x00007f20362e1000 RS_LOG_REPLAY_OPS hadoop datanode  0042 16020 1 prio tid nid waiting condition 0x00007f2039a18000 RS_LOG_REPLAY_OPS hadoop datanode  0042 16020 0 prio tid nid waiting condition 0x00007f2033bba000 RS_CLOSE_REGION hadoop datanode  0042 16020 2 prio tid nid waiting condition 0x00007f2033ab9000 RS_CLOSE_REGION hadoop datanode  0042 16020 1 prio tid nid waiting condition 0x00007f2033ebd000 RS_CLOSE_REGION hadoop datanode  0042 16020 0 prio tid nid waiting condition 0x00007f203b555000 group cache daemon prio tid nid waiting condition 0x00007f20339b8000 ReplicationExecutor daemon prio tid nid waiting condition 0x00007f20356d5000 RS_OPEN_REGION hadoop datanode  0042 16020 1 prio tid nid waiting condition 0x00007f2039f3f000 RS_OPEN_REGION hadoop datanode  0042 16020 2 prio tid nid waiting condition 0x00007f203a040000 RS_OPEN_REGION hadoop datanode  0042 16020 0 prio tid nid waiting condition 0x00007f203a141000 hadoop datanode Replication Statistics daemon prio tid nid waiting condition 0x00007f203a444000 HBase Metrics2 daemon prio tid nid waiting condition 0x00007f203aa4a000 LeaseRenewer hadoop hadoop2 namenode daemon prio tid nid waiting condition JvmPauseMonitor daemon prio tid nid waiting condition 0x00007f203b959000 Service Thread daemon prio tid nid C2 CompilerThread1 daemon prio tid nid waiting condition 0x0000000000000000 C2 CompilerThread0 daemon prio tid nid waiting condition 0x0000000000000000 Signal Dispatcher daemon prio tid nid Surrogate Locker Thread GC daemon prio tid nid waiting condition 0x0000000000000000 VM Thread prio tid nid Gang worker   GC Threads prio tid nid Gang worker   GC Threads prio tid nid Gang worker   GC Threads prio tid nid Gang worker   GC Threads prio tid nid Gang worker   GC Threads prio tid nid Gang worker   GC Threads prio tid nid Gang worker   GC Threads prio tid nid Gang worker   GC Threads prio tid nid Gang worker   GC Threads prio tid nid Gang worker   GC Threads prio tid nid Gang worker   GC Threads prio tid nid Gang worker   GC Threads prio tid nid Gang worker   GC Threads prio tid nid Gang worker   GC Threads prio tid nid Gang worker   GC Threads prio tid nid Gang worker apos Object State WAITING parking parking wait AbstractQueuedSynchronizer State WAITING parking parking wait AbstractQueuedSynchronizer State WAITING parking parking wait AbstractQueuedSynchronizer State WAITING parking parking wait AbstractQueuedSynchronizer State WAITING parking parking wait AbstractQueuedSynchronizer State WAITING parking parking wait AbstractQueuedSynchronizer State WAITING parking parking wait AbstractQueuedSynchronizer PeerCache 7c1775ad daemon prio tid nid waiting condition State TIMED_WAITING sleeping State TIMED_WAITING parking parking wait AbstractQueuedSynchronizer State TIMED_WAITING parking parking wait AbstractQueuedSynchronizer prio tid nid waiting condition 0x00007f203ab4b000 State WAITING parking parking wait AbstractQueuedSynchronizer prio tid nid waiting condition 0x00007f203ac4c000 State WAITING parking parking wait AbstractQueuedSynchronizer prio tid nid waiting condition 0x00007f203ad4d000 State WAITING parking parking wait AbstractQueuedSynchronizer prio tid nid waiting condition 0x00007f203ae4e000 State WAITING parking parking wait AbstractQueuedSynchronizer prio tid nid waiting condition 0x00007f203af4f000 State WAITING parking parking wait AbstractQueuedSynchronizer append pool1 t1 prio tid nid waiting condition 0x00007f203b050000 State WAITING parking parking wait AbstractQueuedSynchronizer State TIMED_WAITING sleeping State TIMED_WAITING sleeping prio tid nid waiting condition 0x00007f203be5a000 State TIMED_WAITING sleeping handler queue port daemon prio tid nid waiting condition 0x00007f203c25e000 State WAITING parking parking wait AbstractQueuedSynchronizer handler queue port daemon prio tid nid waiting condition 0x00007f203c35f000 State WAITING parking parking wait AbstractQueuedSynchronizer handler queue port daemon prio tid nid waiting condition 0x00007f203c460000 State WAITING parking parking wait AbstractQueuedSynchronizer handler queue port daemon prio tid nid waiting
16367	Race master region server initialization lead server abort was troubleshooting case hbase master dies start see attached master log snippet turned master initialization thread was racing HRegionServer  preRegistrationInitialization initializeZooKeeper HMaster extends HRegionServer logging master found execution did reach log line region server declared cluster Id being
16429	FSHLog deadlock rollWriter called ring buffer filled experienced problem handlers are stuck handler thread RingBufferEventHandler thread waiting safePointReleasedLatch FSHLog  replaceWriter call SafePointZigZagLatch  releaseSafePoint count safePointReleasedLatch replaceWriter got stuck trying publish sync ring buffer deadlock happens process deadlock forms ring buffer filled appends happens consumer ring buffer waiting safePointReleasedLatch rollWriter publish sync ring buffer is rollWriter won apos t release safePointReleasedLatch JIRA targeting resolve issue add UT cover case Checking jstack see handler threads waiting ring buffer consumer waiting safePointReleasedLatch count handler queue port daemon prio tid nid State TIMED_WAITING parking append pool2 t1 prio tid nid waiting condition 0x00007efd2d2fa000 State WAITING parking parking wait CountDownLatch Sync logRoller daemon prio tid nid State TIMED_WAITING parking
16699	Overflows AverageIntervalRateLimiter &apos;s refill getWaitInterval seems are overflow places issue post patch days figure adding cases see following lines overflows cause behavior RateLimiters have logic byPass check
16721	Concurrency issue WAL seqId tracking  m inspecting case production cluster regionservers ends accumulating hundreds WAL files force flushes going max logs problem starts continues RS is restarted happened times cluster clusters cluster has memstore flusher does explain force flush regions max limit is working think memstore flusher masks problem is do see clusters INFO regionserver logRoller FSHLog wals logs maxlogs forcing flush regions d4cf39dc40ea79f5da4d0cf66d03cb1f WARN regionserver logRoller LogRoller Failed schedule flush d4cf39dc40ea79f5da4d0cf66d03cb1f region requester INFO regionserver logRoller FSHLog wals logs maxlogs forcing flush regions d4cf39dc40ea79f5da4d0cf66d03cb1f WARN regionserver logRoller LogRoller Failed schedule flush d4cf39dc40ea79f5da4d0cf66d03cb1f region requester problem is region d4cf39dc40ea79f5da4d0cf66d03cb1f is split time was flush data split problems FSHLog thinks is data region
16788	Race file deletion HStore closeAndArchiveCompactedFiles HBASE changed way compacted files are archived being done inline compaction completion cleanup CompactedHFilesDischarger chore looks changes HStore support introduced race condition HFile archiving following sequence wind threads trying archive HFiles causing regionserver abort compaction completes files are added compactedfiles HStore DefaultStoreFileManager threadA CompactedHFilesDischargeHandler runs RS executor service calling closeAndArchiveCompactedFiles obtains HStore readlock gets copy compactedfiles releases readlock obtains HStore writelock archives files compactedfiles threadB continues calls removeCompactedfiles compactedfiles receives FileNotFoundException files have been archived thread A throws IOException RS aborts think combination fetching compactedfiles list removing files needs be covered locking Options see are means read operations be blocked files are being archived is Synchronize closeAndArchiveCompactedFiles modify call calling removeCompactedfiles Add lock files removal use closeAndArchiveCompactedFiles close threadB calls part region calls clearCompactedfiles getting copy compactedfiles threadA calls removeCompactedfiles compactedfiles removeStoreFiles call clearCompactedFiles waits write lock calls removeStoreFiles archiveStoreFiles Modify closeAndArchiveCompactedFiles use writelock readlock move call removeCompactedfiles lock