39769	Wrong loader myServlet destroy called myServlet shared directory web app Thread currentThread getContextClassLoader application unload classes shared directory servlet getClass getClassLoader shared classloader StandardCalssLoader understanding executing code web app Thread currentThread getContextClassLoader WebappLoader StandardContext problem occurs StandardWrapper unload calling servlet destroy method ClassLoader oldCtxClassLoader Thread currentThread getContextClassLoader ClassLoader classLoader instance getClass getClassLoader PrintStream System swallowOutput SystemLogHandler startCapture Call servlet destroy method instanceSupport fireInstanceEvent InstanceEvent DESTROY EVENT instance Thread currentThread setContextClassLoader classLoader System getSecurityManager SecurityUtil doAsPrivilege destroy instance SecurityUtil remove instance instance destroy code INSTANCE variable servlet loaded SHARED classloader classloader set thread classloader StandardContext getLoader problem occurs close dos windows suppose occurs uninstall webApp notice problem verified code problem David Gagnon Wrong loader myServlet destroy called myServlet shared directory test set jsp servlet add context start init
40380	Potential syncro problem StandardSession expire expire notify Mark session expired needed expiring man land manager expiring Potential syncro problem StandardSession expire set session load store internal max object remove
42530	ManagerBase backgroundProcess NullPointerException ManagerBase backgroundProcess NullPointerException java lang NullPointerException Environment Tomcat JDK TestServletF doGet HttpServletRequest request HttpServletResponse response ServletException IOException HttpSession session request getSession session invalidate Test http localhost contextName TestServlet org apache catalina session ManagerBase findSessions called processExpires Session findSessions Session sessions Session sessions size Session sessions values toArray Tomcat sessions ManagerBase changed HashMap ConcurrentHashMap time operations sessions removed methods findSession String add Session session remove Session session lock sessions acquired add Session session remove Session session Servlets execute session invalidate result NullpointerException thrown processing ManagerBase processExpires sessions isValid add Session session remove Session session manipulate sessions manner Tomcat ManagerBase backgroundProcess NullPointerException session thread test basic login accept resolver cookies
45453	JDBCRealm getRoles bad synchronization hangs DIGEST authentication JDBCRealm getRoles bad synchronization hangs DIGEST authentication JDBCRealm caches PreparedStatement preparedRoles missing synchronization JDBCRealm DigestAuthenticator threads call getRoles simultaneously stmt executeQuery stmt setString userName executeQuery PreparedStatement object worst JDBC driver confused blocks waiting server response causing threads access hang observed PostgreSQL jdbc JDBC driver org postgresql jdbc AbstractJdbc Statement execute AbstractJdbc Statement java org postgresql jdbc AbstractJdbc Statement executeWithFlags AbstractJdbc Statement java org postgresql jdbc AbstractJdbc Statement executeQuery AbstractJdbc Statement java org apache catalina realm JDBCRealm getRoles JDBCRealm java org apache catalina realm JDBCRealm getPrincipal JDBCRealm java org apache catalina realm RealmBase authenticate RealmBase java org apache catalina authenticator DigestAuthenticator findPrincipal DigestAuthenticator java org apache catalina authenticator DigestAuthenticator authenticate DigestAuthenticator java JDBCRealm getRoles bad synchronization hangs DIGEST authentication set session digest nonce user time login cred
47158	AccessLogValve race condition problem Checked Locking pattern heavily usage AccessLogValve issues race condition judging article http umd pugh java memoryModel DoubleCheckedLocking html Based article variables declared rid race condition currentMillis currentDate AccessLogValve race condition problem set node element field log time format attribute
47524	McastServiceImpl executor dispatching events Created attachment details proposal McastServiceImpl dispatch events executor creating threads ReceiverBase queue address issue refactored code reuse attaching diff file filing bug Bugzilla procedure Trunk branch proceed Ariel McastServiceImpl executor dispatching events set async thread max executor count connection timeout
48172	JspRuntimeContext synch problems JspRuntimeContext jspReloadCount synchronised updated read getJspReloadCount instance accessed multiple threads returned current arbitrarily stale acceptable Javadoc getter synch field AtomicInteger fields classpath codeSource easily written constructor JspRuntimeContext synch problems jsp servlet set file path tag jar filter
48234	org apache catalina core ContainerBase getLogger thread safe org apache catalina core ContainerBase getLogger synchronised methods access org apache catalina core ContainerBase logger synch wrong org apache catalina core ContainerBase logger prevent unsynch access subclasses considerations apply logName logName Javadoc getLogger method returns parent logger org apache catalina core ContainerBase getLogger thread safe set test thread container find internal cache add
48248	tribes group interceptors MessageDispatchInterceptor org apache catalina tribes group interceptors MessageDispatchInterceptor communicate running threads tribes group interceptors MessageDispatchInterceptor set channel thread interceptor message object time member
48249	org apache tomcat util net NioBlockingSelector BlockPoller org apache tomcat util net NioBlockingSelector BlockPoller communicate running threads org apache tomcat util net NioBlockingSelector BlockPoller load test server client key set servlet container
48399	Lock fields Created attachment details Patch lock field field lock org apache catalina session DeltaSession diffLock mutable Lock fields set lock remove add status write attribute read
48790	Race condition org apache catalina session ManagerBase maxActive running tomcat race detector http alphaworks ibm tech msdk find race condition org apache catalina session ManagerBase field maxActive Data Race org apache catalina session ManagerBase maxActive Thread http Tid WRITE Lock Set org apache catalina session ManagerBase add Lorg apache catalina Session org apache catalina session StandardSession setId Ljava lang String org apache catalina session ManagerBase createSession Ljava lang String Lorg apache catalina Session org apache catalina session StandardManager createSession Ljava lang String Lorg apache catalina Session org apache catalina connector Request doGetSession Lorg apache catalina Session org apache catalina connector Request getSession Ljavax servlet http HttpSession org apache catalina connector RequestFacade getSession Ljavax servlet http HttpSession org apache catalina connector RequestFacade getSession Ljavax servlet http HttpSession ecyrd jspwiki AuthenticationManager login Ljavax servlet http HttpServletRequest Thread http Tid READ Lock Set org apache catalina session ManagerBase add Lorg apache catalina Session org apache catalina session StandardSession setId Ljava lang String org apache catalina session ManagerBase createSession Ljava lang String Lorg apache catalina Session org apache catalina session StandardManager createSession Ljava lang String Lorg apache catalina Session code snip ManagerBase java add Session session sessions session getIdInternal session size sessions size size maxActive maxActive size Statement statement executed atomic manner problem move statement statement block Race condition org apache catalina session ManagerBase maxActive session set test sessions time basic thread change
48843	Tomcat Acceptor Thread wait race condition Tomcat http port responsive exists code refactored find reference Bug database mailing list archives tomcat instance maxThreads set tomcat threads service incoming requests sequence events Thread Thread servicing request request JIOEndpoint java acceptor thread calls methods processSocket calls getWorkerThread calls createWorkerThread createWorkerThread returns threads busy processing requests race condition method getWorkerThread code Worker getWorkerThread Worker workerThread createWorkerThread workerThread workers workers wait acceptor thread executes workerThread statement switched CPU threads executing requests complete Worker await waiting job executing method recycleWorkerThread acceptor thread switched CPU executes block wait point Worker threads processing requests isn thread wake acceptor thread application responsive simple solution check curThreadsBusy block wait method getWorkerThread increase scope critical include loop Harshad Stack Traces bda WAITING lock org apache tomcat util net jioendpoint wor org apache tomcat util net JIoEndpoint Worker await JIoEndpoint java org apache tomcat util net JIoEndpoint Worker JIoEndpoint java http Acceptor WAITING lock org apache tomcat util net jioendpoint workerst org apache tomcat util net JIoEndpoint getWorkerThread JIoEndpoint java org apache tomcat util net JIoEndpoint processSocket JIoEndpoint java org apache tomcat util net JIoEndpoint Acceptor JIoEndpoint java Tomcat Acceptor Thread wait set test socket key thread timeout async ssl
48895	WebAppClassLoader clearThreadLocalMap concurrency issues memory leak protection WebAppClassLoader clearReferencesThreadLocals detects clears ThreadLocals prevent WebAppClassLoader instance issues concurrency enumerates Threads internal structures Thread memory barrier ensure consistent ThreadLocalMap examined theoretically ThreadLocal Thread properly cleaned application current thread undeploying application synchronization threads severe detecting leak invokes java lang ThreadLocal ThreadLocalMap remove ThreadLocal Thread ThreadLocalMap instance invocation Thread thread undeploys app remove method thread safe expungeStaleEntries method invoked clearThreadLocalMap webapp undeployed applications receive heavy load requests corrupt internal structures ThreadLocalMap instance propose detection leaks actual clearing optional disabled avoid encountering big problems production Idea improve clearing safe thread provoking leak tomcat worker threads mark dirty background task threads renew threads pool WebAppClassLoader clearThreadLocalMap concurrency issues set servlet loader message dir thread pool log
49129	DigestAuthenticator Helper incorrect lazy initialisation Findbugs method unsynchronized lazy initialization field compiler processor reorder instructions threads guaranteed completely initialized object method called multiple threads field correct problem DigestAuthenticator Helper incorrect lazy initialisation set nonce test digest invalid login jsp time
49144	Incorrect lazy initialization update fields Incorrect lazy initialization update fields org apache catalina startup Bootstrap daemon org apache catalina startup ContextConfig contextDigester Findbugs method unsynchronized lazy initialization field field set object stored location updated accessed setting field visible threads set futher accesses method set field serve initialize object multithreading bug prevents thread accessing stored object fully initialized feel confident method called multiple threads set field setting fully populated initialized Incorrect lazy initialization update fields set content member action port renderer table membership
49567	starting thread startAsync Runnable infinite amount doPosts generated Created attachment details testcase demonstrating bug starting thread startAsync Runnable infinite amount doPosts generated status Internal Server Error exception thrown tomcat attached code demonstrates printing Start async infinite amount times starting thread startAsync Runnable infinite amount doPosts generated async thread dispatch test request error servlet complete
49730	Race condition StandardThreadExecutor requests enqueued creating threads tomcat configure Executor minSpareThreads work memory leak issues redeployment development refresh webapp Safari Chrome Firefox resources seconds served resources instance requests html resources css images analysis org apache catalina core StandardThreadExecutor TaskQueue offer Runnable statement parent getActiveCount parent getPoolSize unexpectedly scenario ThreadPoolExecutor empty user refreshes accesses empty cache web browser resources browser establishes TCP connection Thread created browser receives response decides load resources parallel establishes TCP connections tests Acceptor thread calls StandardThreadExecutor execute process incoming connection call StandardThreadExecutor TaskQueue offer Runnable called study sources Java ThreadPoolExecutor small delay time Thread created increasing poolSize time starts working task increasing activeCount connections established rapid burst calls TaskQueue offer faster small delay parent getActiveCount parent getPoolSize task enqueued forcing creation thread serve Alive enabled tomcat threads care TCP connection time requests queue wait alive timeout Thread returned pool serve pending tasks keepAliveTimeOut requests served eventhough pool full server idle facts issue test starts empty pool occur loaded server triggers issue burst TCP connections problem severe keepAliveTimeout keepalive disabled depends time serve current requests issue tomcat severe threads returned pool http request TCP connection alive impact keepAlive disabled Race condition StandardThreadExecutor requests enqueued creating threads async thread set socket context pool servlet check
49905	cluster DeltaManager memory leak occur Created attachment details Patch remove context classloader threads ThreadPoolExecutor tribes Tested apache tomcat running jdk DeltaManager instantiated assigned StandardContext start StandardContext bindThreads DeltaManager turn initalization asks sessions nodes result creating threads ThreadPoolExecutor tribes threads created contextClassLoader set current webapplication WebAppClassLoader memory leak error message redeployment tomcat log WebappClassLoader clearReferencesThreads web application creditdev appears started thread named pool thread failed create memory leak Stacktrace java util concurrent ThreadPoolExecutor addIfUnderCorePoolSize Unknown Source Proposed solution implement java util concurrent ThreadFactory MessageDispatch Interceptor pass instance ThreadPoolExecutor executor creation instance call setContextClassLoader newThread overriden method cluster DeltaManager memory leak occur set session cluster send sessions load manager protection
49985	Lazy initialization synchronization data race AstInteger AstFloatingPoint AstString http svn apache org repos asf tomcat trunk java org apache parser AstInteger java http svn apache org repos asf tomcat trunk java org apache parser AstFloatingPoint java http svn apache org repos asf tomcat trunk java org apache parser AstString java lazy init synchronization methods getInteger getFloatingPoint getString AstInteger Number number Number getInteger number number image ArithmeticException number BigInteger image number Data races variable number method getInteger concurrent read concurrent write lines Lazy initialization synchronization data race AstInteger AstFloatingPoint AstString expression servlet set session endpoint ast path parse
49987	Data race ApplicationContext http svn apache org repos asf tomcat trunk java org apache catalina core ApplicationContext java Data race variable Map parameters method mergeParameters parameters concurrent read Map ConcurrentHashMap parameters concurrent write Data race ApplicationContext async context set servlet attribute session path map
50138	Lack synchronization org apache catalina security SecurityUtil Symptom processor threads spin madly tomcat processor daemon prio tid nid runnable java lang Thread RUNNABLE org apache catalina security SecurityUtil objectCache HashMap access javadoc HashMap Note implementation multiple threads access hash map concurrently threads modifies map structurally externally Proposed solution change objectCache ConcurrentHashMap Lack synchronization org apache catalina security SecurityUtil set security constraint test server target collection servlet
50293	javax CompositeELResolver synchronization issue Created attachment details Synchronize change CompositeELResolver add javax CompositeELResolver add method synchronize update resolvers threads call add threads size check thread updates size thread update size fails ArrayIndexOutOfBoundsException sense increase size ELResolver array jasper adds ELResolvers propose javax CompositeELResolver synchronization issue set context type variable att format resolver property
50352	AsyncListener onComplete called AsyncContext complete called servlet async features asyncContext complete called async thread AsyncListener onComplete method called Servlet test java IOException javax servlet AsyncContext javax servlet AsyncEvent javax servlet AsyncListener javax servlet ServletException javax servlet annotation WebServlet javax servlet http HttpServlet javax servlet http HttpServletRequest javax servlet http HttpServletResponse Servlet implementation MyServlet WebServlet MyServlet asyncSupported MyServlet HttpServlet AsyncListener serialVersionUID doGet HttpServletRequest request HttpServletResponse response ServletException IOException AsyncContext asyncContext request startAsync request response asyncContext addListener asyncContext start Runnable Override Thread sleep asyncContext getResponse getWriter write asyncContext complete Exception printStackTrace Override onComplete AsyncEvent arg IOException System println onComplete arg Override onError AsyncEvent arg IOException System println onError arg Override onStartAsync AsyncEvent arg IOException System println onStartAsync arg Override onTimeout AsyncEvent arg IOException System println onTimeout arg AsyncListener onComplete called AsyncContext complete called set async request servlet dispatch error path test
50353	Calling asyncContext getResponse returns async timeout async thread calls asyncContext getResponse async timeout reference leads NPE servlet spec clear behavior adopt timeout don returned IllegalStateException complete called timeout test java IOException java PrintWriter javax servlet AsyncContext javax servlet AsyncEvent javax servlet AsyncListener javax servlet ServletException javax servlet ServletResponse javax servlet annotation WebServlet javax servlet http HttpServlet javax servlet http HttpServletRequest javax servlet http HttpServletResponse Servlet implementation MyServlet WebServlet MyServlet asyncSupported MyServlet HttpServlet AsyncListener serialVersionUID doGet HttpServletRequest request HttpServletResponse response ServletException IOException AsyncContext asyncContext request startAsync request response asyncContext addListener asyncContext setTimeout asyncContext start Runnable Override System println Entering async thread Thread sleep System println Asyncthread write response ServletResponse response asyncContext getResponse PrintWriter writer response getWriter writer write System println Asyncthread complete asyncContext complete Exception printStackTrace Override onComplete AsyncEvent evt IOException System println onComplete evt Override onError AsyncEvent evt IOException System println onError evt Override onStartAsync AsyncEvent evt IOException System println onStartAsync evt Override onTimeout AsyncEvent evt IOException System println onTimeout evt evt getAsyncContext getResponse getWriter write Timed evt getAsyncContext complete Calling asyncContext getResponse returns async timeout dispatch test async set servlet error request complete
50459	StandardContext bindThread unbindThread symmetrical limited current thread side commit bug StandardContext bindThread unbindThread methods tomcat methods symmetrical unbindThread restore Thread CCL calling DirContextURLStreamHandler unbind ContextBindings unbindThread StandardContext bindThread call DirContextURLStreamHandler bindThread DirContextURLStreamHandler bind StandardContext unbindThread call DirContextURLStreamHandler unbindThread DirContextURLStreamHandler unbind StandardContext bindThread unbindThread symmetrical limited current thread set add servlet thread find context remove path
50547	CHANGE SESSION message received cluster session synchronization dropped CHANGE SESSION message SESSION EXPIRED message set timestamp messages received cluster sessions synchronization DeltaManager startup timestamp set dropped patch add timestamp CHANGE SESSION SESSION EXPIRED message CHANGE SESSION message received cluster session synchronization dropped session set send sessions message cluster replication context
50554	Bad getClass lead concurrency bugs method org apache naming java javaURLContextFactory getInitialContext Hashtable block getClass getClass lock bug pattern subclasses javaURLContextFactory getInitialContext called instance subclass getClass object instance Locking objects classes expected behavior remove bug pattern simply replacing getClass javaURLContextFactory https securecoding cert org confluence display java LCK synchronize object returned getClass bug pattern Keshmesh https github reprogrammer keshmesh Eclipse plugin analyzes source code Java programs detect concurrency bug patterns reported Bad getClass lead concurrency bugs set enabled test message pool event config context
50629	bindThread unbindThread method latest Tomcat codes thread created listener start filter start loadOnStartup methods bindThread unbindThread marked making methods containers methods initialization works bindThread unbindThread method set add servlet find update context remove parameter
51185	Performance DataSourceProxy createPool fine grained synchronisation don component Enhancement concerns Tomcat JDBC POOL code DataSourceProxy createPool method creation needed Sets connection pool creating pooling driver Driver SQLException ConnectionPool createPool SQLException pool pool pCreatePool SQLException ConnectionPool pCreatePool SQLException pool pool pool ConnectionPool poolProperties pool createPool called lots getters synchro IMPACT needing Philippe http ubik ingenierie Performance DataSourceProxy createPool fine grained synchronisation set connection header pool test log time max
51197	sendError sendRedirect don work AsyncContext reason response sendRedirect response sendError producing expected behavior AsyncContext server side async request completes hunky dory client response server appears Tomcat simply times seconds closes connection headers returned content confirmed thread dumps server isn stuck response setStatus response setHeader works absolutely fine client response time simple test isolates issue reliably https github dcheckoway async test README details NOTE behavior sendError changed sendError close connection client response kind sendError sendRedirect don work AsyncContext set request error dispatch test response async servlet
51212	QueryStats synchornisation issues Created attachment details Patch Atomic approach don volontary QueryStats fields Atomic accessed multiple threads time Load test heavy load collected SlowQueryReport Sql queries number executions wrong executed don approach perform synchronize add failure Atomic performance reasons Philippe Mouawad http ubik ingenierie QueryStats synchornisation issues pool servlet invocation notification endpoint source set hash
51467	usage method start start thread StandardContext method Thread mistake lines Thread join called wait completion thread remove join rid thread runnable start thread usage method start start thread set add start channel internal create data print
51545	threadname ExtendedAccessLogValve Created attachment details Threadname usable ExtendedAccessLogValve discussed tomcat users mailinglist http nabble thread extended access log valve html threadname thread served request ExtendedAccessLogValve threadname ExtendedAccessLogValve set thread element session threads connection stuck max
51688	JreMemoryLeakPreventionListener protect AWT thread creation webapp calls java awt Toolkit getDefaultToolkit launch thread AWT Windows AWT XAWT capture ContextClassLoader pinning webapp memory undeploy redeploy simple addition JreMemoryLeakPreventionListener alleviate condition JreMemoryLeakPreventionListener protect AWT thread creation set protection test thread validation time connection max
52055	ChunkedInputFilter recycled servlet asynchronous request standard servlet async APIs tomcat server side code AsyncContext asyncContext request startAsync processing thread asyncContext getRequest getInputStream read input stream asyncContext complete InputStream returns bytes HTTP post chunking debugging ChunkedInputFilter reused org apache coyote http AbstractInputBuffer recycled nextRequest reuse request result endChunk flag request reading buffer ChunkedInputFilter recycled servlet asynchronous request async set type local servlet request input parameter
52091	TagHandlerPool slow high concurrently TagHandlerPool slow stress test web application tomcat occured Profiler followings Lock log instance org apache jasper runtime TagHandlerPool Lock parameters field org apache catalina core StandardWrapper getInitParameter attached patch resolve issue environment log field StandardWrapper lock policy block ReentrantReadWriteLock TagHandlerPool slow high concurrently set invocation pool field statement query alive encode
52213	Field org apache catalina tribes transport bio util FastQueue enabled flag org apache catalina tribes transport bio util FastQueue enabled read written multiple threads concurrently http svn apache org repos asf svn tomcat trunk java org apache catalina tribes group interceptors MessageDispatchInterceptor java accesses properly sufficient flag protect access https securecoding cert org confluence display java VNA Ensure visibility accessing shared primitive variables bug pattern Keshmesh https keshmesh illinois Eclipse plugin analyzes source code Java programs common concurrency bug patterns Keshmesh detect concurrency bug pattern Field org apache catalina tribes transport bio util FastQueue enabled set bean test server check add annotation client
52259	synchonization issues dead lock realm presented configuration Problem Tomcat startup freezes INFO Deploying web application directory Nuances errors displayed logs tomcat process shutted shutdown script http request port wait multi host configuration setup works previous build including lib jar files tomcat replaced lib jar files tomcat works fine asap fill free contact details mail synchonization issues dead lock realm presented configuration set user time role context servlet nonce internal
52356	Prevent potential data races org apache catalina tribes transport bio util FastQueue size accesses org apache catalina tribes transport bio util FastQueue size org apache catalina tribes transport bio util FastQueue add ChannelMessage Member InterceptorPayload org apache catalina tribes transport bio util FastQueue remove read access org apache catalina tribes transport bio util FastQueue getSize properly lead race condition org apache catalina tribes transport bio util FastQueue getSize bug manifests Tomcat developers remove org apache catalina tribes transport bio util FastQueue getSize access shared field safely Field org apache catalina tribes transport bio util FastQueue size declared http svn apache org repos asf svn tomcat trunk java org apache catalina tribes transport bio util FastQueue java Prevent potential data races org apache catalina tribes transport bio util FastQueue size set test server check add servlet client mapping
52777	Automatically shut versions parallel deployment parallel deployment older version application sessions shut automatically release tomcat JVM resources Christopher Schultz suggested approaches Tomcat user list Modify parallel deployment code register MBean NotificationListener filters events expiring session notifications outgoing webapp listener receives notification check current session count suppose filter step session count start thread stops outgoing webapp registers listener Install SessionEventListener counts sessions count JMX suppose equal starts thread Install Timer thread polls intervals minute sessions dead starts thread idea cleanest Tomcat fire MBean events session count changing Automatically shut versions parallel deployment set add find servlet remove container context start
52999	Performance issue locking ContainerBase fireContainerEvent reported dev list org apache catalina core ContainerBase fireContainerEvent method critical listeners list listeners toArray list called pretty operation request session map code tomcat candidate CopyOnWriteArrayList confirm fireContainerEvent calls places StandardSession nested loops loop StandardSession array context getApplicationEventListeners copying list container listeners array context fireContainerEvent confirm reported problem request attributes code send events access solve ReadWriteLock helper avoids copying array access copy write classify enhancement request Thread performance problems myfaces testing dev list starting http tomcat markmail org thread bbvzmkvyvryvn http marc info Performance issue locking ContainerBase fireContainerEvent set add remove servlet find context create web
53173	maxConnections feature hangs system Created attachment details missing count maxConnections latch scenario JIO Acceptor thread hangs connections counted properly Executor tomcatThreadPool namePrefix tomcat minSpareThreads maxThreads Connector port redirectPort bio https port protocol org apache coyote http Http Protocol maxKeepAliveRequests executor tomcatThreadPool connectionTimeout acceptCount Thread dump yields http bio Acceptor daemon prio tid xXXXXXXXX nid xXX waiting condition xXXXXXXXX xXXXXXXXX java lang Thread WAITING parking parking wait xXXXXXXXX org apache tomcat util threads LimitLatch Sync imagine hard reproduce simple test easiest reproduce create configuration Executor tomcatThreadPool namePrefix catalina exec maxThreads minSpareThreads maxQueueSize Connector port protocol HTTP executor tomcatThreadPool connectionTimeout redirectPort maxConnections reproduces test machine account connections rejected queue doesn count latch attaching patch specific complete workaround patch introduces maxConnections configuration disables usage maxConnections setting administrator workaround edge cases tracked reproduce error NIO connector place JioEndpoint requires handling RejectedExecutionException processSocketAsync SocketWrapper Socket socket SocketStatus status unhandled maxConnections feature hangs system set socket server max timeout entity connection endpoint
53450	Deployment application ROOT context hangs scenario running Tomcat deploy application ROOT context deployment hangs tread dump suspicious localhost startStop daemon prio tid nid waiting condition ebf java lang Thread WAITING parking parking wait java util concurrent locks ReentrantReadWriteLock NonfairSync read lock acquired listener invoked process container event AccessLogListener invoked org apache catalina core StandardEngine AccessLogListener uninstall StandardEngine java call write lock org apache catalina core ContainerBase removeContainerListener ContainerBase java ReentrantReadWriteLock stated upgrade read write lock Reentrancy downgrading write lock read lock acquiring write lock read lock releasing write lock upgrading read lock write lock Violeta Georgieva Deployment application ROOT context hangs set add find remove deploy servlet path context
53498	Atomicity violation bugs misusing concurrent collections Created attachment details patch atomicity violation bugs Lin student department UIUC mining Java concurrent library misusages misusages ConcurrentHashMap Tomcat result potential atomicity violation bugs harm performance code snapshot code file java org apache catalina core ApplicationContext java attributes containsKey attributes attributes remove parameters containsKey parameters code atomicity violation occur lines Suppose thread executes finds concurrent hashmap attributes key thread executes thread removes key attributes thread resumes execution NullPointerException invoking method snapshot atomicity violation lines Suppose thread executes finds concurrent hashmap dose key execute thread puts pair concurrent hashmap parameters thread resumes execution overwrite written thread code longer preserves absent semantics misusages files java org apache catalina context ReplicatedContext java atomicity violation occur thread remove key concurrent hashmap tomcatAttributes thread executes java org apache catalina startup HostConfig java suppose thread executes finds concurrent hashmap dose key contextName executes thread puts pair contextName concurrent hashmap deployed thread resumes execution overwrite written thread putIfAbsent method shoule method Atomicity violation bugs misusing concurrent collections test constraint endpoint set collection servlet session add
53624	sendRedirect doesn work dispatch AsyncContext call sendRedirect AsyncContext dispatch doesn redirect returns status code project demonstrating issue https github rstoyanchev dispatch test Build deploy source tomcat issue repro deployed application select Redirect scenario scenario involves Servlet RedirectA creates thread dispatches Servlet RedirectB turn redirects Servlet RedirectC forwards simple JSP JSP rendering blank log output processing ended ServletC details setup WebAppInitializer setupRedirectScenario ServletContext FWIW dispatch async thread scenario works modify creates servlet RedirectA ForwardingAsyncServlet DispatchingAsyncServlet issue marked resolved current issue tested sendRedirect doesn work dispatch AsyncContext async dispatch servlet request error listener test complete
53843	isAsyncStarted thread started async processing async processing starts container thread subsequent calls request isAsyncStarted expected application thread calls asyncContext dispatch isAsyncStarted actual dispatch occurred spec dispatch operation delayed container initiated dispatch returned container period dispatch called actual dispatch DispatcherType ASYNC isAsyncStarted isAsyncStarted suddenly change thread exiting causing recognize async processing started exit isAsyncStarted thread started async processing async set dispatch error socket test servlet request
54045	ReplicatedMap don TcpFailureDetector configuration Tribes stack TcpPingInterceptor TcpFailureDetector MessageDispatchInterceptor StaticMembershipInterceptor work cluster side thread call TcpFailureDetector heartbeat call checkMembers call performBasicCheck membership performBasicCheck missing node add missing member membership membership memberAlive THREAD TIME WORK check memberAlive remove doesn exist side thread call channel getMembers AbstractReplicatedMap call call TcpFailureDetector getMembers wrong unavailable nodes Note synchronize membership isn TcpFailureDetector getMember getMembers hasMembers Membership equivalent method heavy lock thread TcpFailureDetector check node alive issue AbstractReplicatedMap TcpFailureDetector node disapear replicated map ReplicatedMap Channel SEND OPTIONS Channel SEND OPTIONS ACK message missing node fail exception Personnaly override TcpFailureDetector heartbeat avoid performBasicCheck configuration TcpPingInterceptor call performForcedCheck doesn ReplicatedMap issue avoid adding missing member membership list Add method memberAlive MemberImpl Membership side add member TcpFailureDetector performBasicCheck check method adding node doesn AbstractReplicatedMap issue work acknoledge nodes code Tomcat Arnoud ReplicatedMap don TcpFailureDetector configuration set member send header message servlet map test
54086	ConcurrentModificationException NioReceiver shutdown Solaris jdk tomcat clustering session replication nodes nodes ConcurrentModificationException occasionally shutdown unable reliably reproduce exception log Unable close cluster receiver selector exception java util ConcurrentModificationException java util HashMap HashIterator nextEntry HashMap java java util HashMap KeyIterator HashMap java java util Collections UnmodifiableCollection Collections java org ​apache ​catalina ​tribes ​transport ​nio ​NioReceiver ​closeSelector ​NioReceiver ​java org ​apache ​catalina ​tribes ​transport ​nio ​NioReceiver ​stopListening ​NioReceiver ​java org apache catalina tribes transport nio NioReceiver NioReceiver java org ​apache ​catalina ​tribes ​group ​ChannelCoordinator ​internalStop ​ChannelCoordinator java org ​apache ​catalina ​tribes ​group ​ChannelCoordinator ​stop ​ChannelCoordinator ​java org ​apache ​catalina ​tribes ​group ​ChannelInterceptorBase ​stop ​ChannelInterceptorBase java org ​apache ​catalina ​tribes ​group ​ChannelInterceptorBase ​stop ​ChannelInterceptorBase java org ​apache ​catalina ​tribes ​group ​ChannelInterceptorBase ​stop ​ChannelInterceptorBase java org ​apache ​catalina ​tribes ​group ​interceptors ​MessageDispatchInterceptor ​stop ​MessageDispatchInterceptor java org ​apache ​catalina ​tribes ​group ​ChannelInterceptorBase ​stop ​ChannelInterceptorBase java org ​apache ​catalina ​tribes ​group ​ChannelInterceptorBase ​stop ​ChannelInterceptorBase java org apache catalina tribes group GroupChannel GroupChannel java org ​apache ​catalina ​ha ​tcp ​SimpleTcpCluster ​stopInternal ​SimpleTcpCluster ​java org apache catalina util LifecycleBase LifecycleBase java org apache catalina core ContainerBase stopInternal ContainerBase java org apache catalina util LifecycleBase LifecycleBase java org apache catalina core StandardService stopInternal StandardService java org apache catalina util LifecycleBase LifecycleBase java org apache catalina core StandardServer stopInternal StandardServer java org apache catalina util LifecycleBase LifecycleBase java org apache catalina startup Catalina Catalina java org apache catalina startup Catalina start Catalina java sun reflect NativeMethodAccessorImpl invoke Method sun reflect NativeMethodAccessorImpl invoke NativeMethodAccessorImpl java sun ​reflect ​DelegatingMethodAccessorImpl ​invoke ​DelegatingMethodAccessorImpl ​java java lang reflect Method invoke Method java org apache catalina startup Bootstrap start Bootstrap java org apache catalina startup Bootstrap main Bootstrap java looked code noticed SelectionKey Iterator dug deep find issue NioReceiver code find relevant text Selector javadocs http docs oracle javase docs api java nio channels Selector html selector key selected key sets general safe multiple concurrent threads thread modify sets access controlled synchronizing set iterators returned sets iterator methods fail fast set modified iterator created invoking iterator remove method ConcurrentModificationException thrown ConcurrentModificationException NioReceiver shutdown set channel service key message internal send test
54521	DigestAuthenticator nonceCountValid fails simultaneous asynchronous requests client Concerned components org apache catalina authenticator DigestAuthenticator org apache catalina authenticator DigestAuthenticator NonceInfo Scenario multithreaded client sends requests millisecond DigestAuthenticator creates request nonce NonceInfo instance nonces equal created millisecond writing data cache method generateNonce NonceInfo instance overwrites key Problem client threads send request digest authentication header requests “nc� nonce count equal nonce newly created NonceInfo request array “seen� set “true� nonceCount offset length request NonceInfo instance instance retrieved map “nonces� “nonce� key requests key method “nonceCountValid returns „false“ nonceCount offset length set „true“ authentication fails client valid digest authentication header Conclusion Working multi threaded clients requests digest authentication function reliably DigestAuthenticator nonceCountValid fails simultaneous asynchronous requests client set nonce request invalid header async message test
55267	NIO thread locked load test thread stuck dump Basically simulate users connect disconnect NIO thread locked set protection remove timeout request nio internal add
55309	Concurrent issue TagPluginManager Created attachment details Patch TagPluginManager TagPluginManager shared ServletContext variable PageInfo pageInfo PageInfo aligned PageInfo holding compiled parallel encounters concurrent issue compiled server restarted Concurrent issue TagPluginManager set servlet web jsp context plugin xml source
55521	Race Condition HttpSession invalidate HttpServletRequest getSession Created attachment details code flow exhibits race condition session fixation protection discard user session create user login rely Spring Security SessionFixationProtectionStrategy core commands session invalidate session request getSession Yesterday message log command returned session invalidated servlet container change session session created adequately session fixation attacks catalina exec org springframework security web authentication session SessionFixationProtectionStrategy SessionFixationProtectionStrategy java investigated issue fact race condition threads requests client enter session fixation protection code parallel attached TXT file illustrates code flow leads race condition thread calls session invalidate call returns becuase session expiring session invalid call request getSession won create session thread session documentation http tomcat apache org tomcat doc servletapi indication session invalid session invalidate returns session detect expiring session error message appears production log files weeks infrequent event implement session fixation race condition Christoph Race Condition HttpSession invalidate HttpServletRequest getSession session set object path servlet async local scope
55524	Deadlock produced Websocket write operation org apache catalina websocket WsOutbound Created attachment details thread dump deadlock Tomcat application Websockets websockets handled Atmosphere framework https github Atmosphere atmosphere deadlock occurs write operations websocket attached thread dump deadlock issue duscussed https github Atmosphere atmosphere issues deadlocked threads Java level deadlock Atmosphere Shared AsyncOp waiting lock monitor efebc object org apache catalina websocket WsOutbound held Atmosphere Scheduler Atmosphere Scheduler waiting lock monitor efe object org atmosphere cpr AtmosphereResourceImpl held Atmosphere Shared AsyncOp Java stack threads listed Atmosphere Shared AsyncOp waiting lock org apache catalina websocket WsOutbound locked org atmosphere cpr AtmosphereResourceImpl Atmosphere Scheduler waiting lock org atmosphere cpr AtmosphereResourceImpl locked org apache catalina websocket WsOutbound Deadlock produced Websocket write operation org apache catalina websocket WsOutbound test message set servlet outbound write upgrade endpoint
55582	Concurrent issue TagFileProcessor Created attachment details Unsynchronized wrapper RuntimeContext code concurrent issue JspRuntimeContext rctxt ctxt getRuntimeContext JspServletWrapper wrapper rctxt getWrapper wrapperUri rctxt wrapper creates duplicated JspServletWrapper scenario jsp tag jsp tag jsp jsp compiling lines threads JspRuntimeContext JspServletWrapper instances JspServletWrapper created Concurrent issue TagFileProcessor write servlet read set java generated shared filter
55684	WebappClassLoader getThread access root ThreadGroup Tomcat permissions granted method WebappClassLoader getThread access root ThreadGroup order list threads manage SecurityException avoid access parent ThreadGroup thread start Tomcat WebappClassLoader getThread access root ThreadGroup set test thread add path servlet dir key
55799	websocket Stability issues concurrently sending large messages Created attachment details Test modifications Chat thread Users List problems occur sending large messages WebSocket connection getBasicRemote sendText String ChatAnnotation synchronize method multiple threads call RemoteEndpoint Basic sendText concurrently JavaDoc RemoteEndpoint Basic websocket connection underlying RemoteEndpoint busy sending message call send threads attempt call send method concurrently developer attempts send message middle sending existing send method called connection busy IllegalStateException thought read earlier implementation synchronize calls methods RemoteEndpoint Basic throwing ISE changed sending large Messages Websocket RemoteEndpoint Basic threads synchronization problems happen WebSocket connection suddenly closed guess browser aborts connections data corruption Timeout errors examined raw data TCP Exceptions occur open chat xhtml browser raw WebSocket response xhtml file screenshots issues happen synchronizing calls RemoteEndpoint Basic sendText harder reproduce reproduce Checkout Tomcat trunk apply attached patch applies modifications Chat Websocket Javascript sends messages regular interval ChatAnnotation modifies message times large original message sends session getBasicRemote sendText msg Build Tomcat Windows machine Windows Java NIO HTTP connector configuration Open Firefox browsers open Chat http localhost examples websocket chat xhtml Repeat actions regular interval Wait seconds Tomcat closes WebSocket connections time browsers press times time browsers WebSocket connection suddenly closed Tomcat exceptions IOException ClosedChannelException expected browser aborts connection Nov SEVERE http nio ClientPoller org apache tomcat util net NioEndpoint processSocket Error allocating socket processor java lang NullPointerException Nov SEVERE http nio exec websocket chat ChatAnnotation onError Chat Error java nio channels ClosedChannelException java nio channels ClosedChannelException Nov SEVERE http nio exec websocket chat ChatAnnotation onError Chat Error java lang IllegalArgumentException java lang reflect InvocationTargetException java lang IllegalArgumentException java lang reflect InvocationTargetException Caused java lang reflect InvocationTargetException Caused java nio charset CoderMalfunctionError java nio BufferOverflowException Caused java nio BufferOverflowException Nov SEVERE http nio exec websocket chat ChatAnnotation onError Chat Error java IOException Eine vorhandene Verbindung wurde vom Remotehost geschlossen java IOException Eine vorhandene Verbindung wurde vom Remotehost geschlossen press Websocket connection closed opened browser doesn response request chat xhtml add synchronization modifying ChatAnnotation broadcast method broadcast String msg ChatAnnotation client connections client client session getBasicRemote sendText msg Exception repeat steps open chat xhtml Firefox WebSocket connection closed start repeatedly press time normal IOExceptions ClosedChannelExceptions minutes problems WebSocket connections closed opening time browser didn response HTTP request browser raw WebSocket reply XHTML reply screenshots exceptions Nov SEVERE http nio exec websocket chat ChatAnnotation onError Chat Error java IOException java util concurrent ExecutionException java IOException Key cancelled java IOException java util concurrent ExecutionException java IOException Key cancelled Caused java util concurrent ExecutionException java IOException Key cancelled Caused java IOException Key cancelled Nov SEVERE http nio exec org apache tomcat util net NioEndpoint SocketProcessor doRun java lang NullPointerException Nov SEVERE http nio exec org apache tomcat websocket server WsHttpUpgradeHandler destroy Failed close WebConnection destroying WebSocket HttpUpgradeHandler java lang NullPointerException Nov SEVERE http nio exec org apache coyote http AbstractHttp Processor process Error processing request java lang IllegalArgumentException http markmail org message jch orltzs websocket Stability issues concurrently sending large messages message send endpoint set max buffer remove rsv
55996	Async context timeout HTTP NIO connector Created attachment details Servlet Async processing Java Based client created ProblemServlet receives request Java based client Servlet starts Async processing request Async processing method loop cyclically sends String messages client implementation method String msg ServletOutputStream outputStream publisherAsyncCtx getResponse getOutputStream continu continu msg msg System println publishing message msg outputStream println msg publisherAsyncCtx getResponse flushBuffer Thread sleep InterruptedException System println sleep InterruptedException getMessage printStackTrace Java based console application client hits servlet reads output stream messages arrive seconds connection closed server Logs Server side Starting Async Context publishing message Mon Jan IST publishing message Mon Jan IST publishing message Mon Jan IST publishing message Mon Jan IST publishing message Mon Jan IST publishing message Mon Jan IST publishing message Mon Jan IST publishing message Mon Jan IST publishing message Mon Jan IST publishing message Mon Jan IST publishing message Mon Jan IST publishing message Mon Jan IST Exception thread http bio exec java lang IllegalStateException request AsyncContext completed processing Issue apache tomcat apache tomcat tested release variants codebase apache tomcat issues Async context timeout HTTP NIO connector set socket internal max request alive parse size
56042	java lang IllegalStateException Calling asyncComplete valid request Async DISPATCH issue appears response set startAsync response setStatus HttpServletResponse BAD REQUEST AsyncContext asyncContext request startAsync request response asyncContext dispatch actual scenario bit complex involves separate thread completes fast startAsync called stack trace java lang IllegalStateException Calling asyncComplete valid request Async DISPATCH Servlet spec illegal call startAsync response committed closed reason clear error raised startAsync allowed proceed issue fixed worth works Jetty spec illegal java lang IllegalStateException Calling asyncComplete valid request Async DISPATCH async dispatch error servlet request test listener complete
56082	ConcurrentModificationException org apache juli ClassLoaderLogManager Created attachment details Source reproduce Tomcat java util logging LogManager getLogManager general instance org apache juli ClassLoaderLogManager webapp iterating result LogManager getLogManager getLoggerNames ConcurrentModification occur reproduce download attached test zip mvn clean Maven copy target test war tomcat webapps start Tomcat lot Issue reproduced java util ConcurrentModificationException System output webapp simple Logger getLogger String LogManager getLoggerNames threads reproduced Tomcat JDK suppose copy result org apache juli ClassLoaderLogManager getLoggerNames ConcurrentModificationException org apache juli ClassLoaderLogManager set test origin request filter type check simple
56518	NIO async servlet limit latch leak Created attachment details sample webapp reproduce bug encouter bug real product webapp tested linux oracle jdk jdk tomcat tomcat CONFIG change HTTP Connector NIO server xml protocol org apache coyote http Http NioProtocol WEBAPP LOGIC simplified situation call req startAsync start async serlvet execute async logic user thread user thread interrupted timeout logic code user code call resp flushBuffer send response client PROBLEM situation descibed LimitLatch countDown called connections limit latch count max tomcat accept connection incoming client hangs REPRODUCER clean tomcat installation change server xml Connector config change protocol org apache coyote http Http NioProtocol Optional add maxConnections reproduce bug faster copy sample webapp attachment webapps ROOT war start tomcat plenty request async html echo curl localhost async html request limit latch leak requests reaches maxConnections set client curl hangs TECHNIC DETAILS debug thread interrupted user code call resp flushBuffer NioChannel Closed jdk NIO code ClosedByInterruptException thrown channel closed SelectionKey removed Poller thread stack trace Daemon Thread http nio ClientPoller Suspended owns Object owns HashSet owns EPollSelectorImpl owns Collections UnmodifiableSet owns Util SocketChannelImpl AbstractSelectableChannel removeKey SelectionKey EPollSelectorImpl AbstractSelector deregister AbstractSelectionKey EPollSelectorImpl implDereg SelectionKeyImpl EPollSelectorImpl SelectorImpl processDeregisterQueue EPollSelectorImpl doSelect EPollSelectorImpl SelectorImpl lockAndDoSelect EPollSelectorImpl SelectorImpl select NioEndpoint Poller Thread call ctx complete org apache tomcat util net NioEndpoint processSocket NioChannel SocketStatus code processSocket NioChannel socket SocketStatus status dispatch KeyAttachment attachment KeyAttachment socket getAttachment attachment SelectionKey removed attachment returns logic AbstractEndpoint countDownConnection called limit latch leak WORK work stable BIO connector avoid call resp flushBuffer user thread NIO async servlet limit latch leak set async annotations max servlet threads thread socket
56577	websocket Inappropriate executor WsServerContainer executor service process SendHandler sendAsync calls initialized WsServerContainer unbounded queue corePoolSize threads created maximumPoolSize doesn corePoolSize changed context parameter hard find optimized create issue SendHandler close session sending message stack trace WebSocketServer spring websocket test daemon prio tid nid waiting condition java lang Thread TIMED WAITING parking parking wait java util concurrent CountDownLatch Sync locked java lang Object threads threads clear SendHandler Remote send methods TimeoutException clients receive messages http docs oracle javase docs api java util concurrent ThreadPoolExecutor html websocket Inappropriate executor WsServerContainer thread set session path internal endpoint pool context
56653	Concurrency issue Mapper ContextList stopping Contexts noticed issue reviewing code Mapper removeContextVersion current trunk code exists Tomcat Mapper removeContextVersion Mapper removeContext Tomcat host contextList contexts newContexts Recalculate nesting host contextList nesting newContexts length slashCount slashCount newContexts slashCount host contextList nesting host contextList nesting slashCount problem delay list contexts updated contextList contexts contextList nesting field updated nesting field mapping contexts contexts ROOT foo foo bar Context foo bar stopped request foo http localhost foo html Expected behaviour Map context foo application Actual behaviour request erroneously mapped ROOT webapp foo test Concurrency issue Mapper ContextList stopping Contexts set add find context remove servlet wrapper resource
56724	Restart Container background thread died unexpectedly address issue raised times mailing lists http tomcat markmail org thread xooxcq ehki ContainerBackgroundProcessor compounding OOMEs http tomcat markmail org thread vicg kusckra Background thread died errors log invoking backgroundProcess JMX start background thread delay start succeeds thread clean stack StackOverflowError partially OutOfMemoryError thread death strategy admin handle OutOfMemoryError start JVM OnOutOfMemoryError flag script shuts restarts Tomcat Restart Container background thread died unexpectedly set thread stuck jsp internal add stream start
56746	Webssocket secure client thread access webapp resources SecureIOThreadFactory method org apache tomcat websocket AsyncChannelWrapperSecure sets context loader secure websocket client threads standard loader preventing accessing webapp resources Removing restores access threads classloader calling webapp thread Webssocket secure client thread access webapp resources set socket test server accept session login basic
56857	Thread safety issue ApplicationContextFacade invokeMethod Multiple subsequent Thread dumps exhibiting lots threads hanging HashMap RUNNABLE status consuming high CPU typical indicator thread safety issue threadsafe Maps Thread stacks ApplicationContextFacade ServletContext objects singletons webapp passed multiple threads member objectCache HashMap thread safe accessed modified synchronization invokeMethod Suggested remedy change ConcurrentHashMap thread safe performs synchronizing access connector userId sessionId daemon prio tid nid runnable java lang Thread RUNNABLE Thread safety issue ApplicationContextFacade invokeMethod set load servlet protection remove add context thread
56907	Threads leak WebSocket implementation versions leaking threads noticed method WsWebSocketContainer connection endpoint clientEndpointConfiguration path reproduce issue URL existent result connection error threads created AsyncChannelWrapperSecure stay alive time source threads creation ExecutorService executor Executors newFixedThreadPool SecureIOThreadFactory Count threads increasing reconnect attempt existent URL live time disable application calls connection WsWebSocketContainer connection Leakage threads observed jvisualvm program deal kind situations destroy unused threads Threads leak async load thread protection set test servlet log
57265	Tomcat hiden NGINX fails send file NIO connector moved Tomcat server nginx balancing server started experiencing problem org apache tomcat util net NioEndpoint NioBufferHandler Nov SEVERE http nio ClientPoller org apache tomcat util net NioEndpoint Poller processSendfile java lang IllegalArgumentException read application read buffer handler Problem occurres irregularly loading lots scripts refencenced homepage useSendfile add slow logging flushing output code lowers occurrence rate race condition problem Tomcat hiden NGINX fails send file NIO connector set read test add bean comet request socket
57338	SingleSignOnEntry cache ClusterSingleSignOn valve Tomcat startup ClusterSingleSignOn valve single sign session cluster nodes start replicated moment action performed nodes online action sync mailing list discussion http mail archive users tomcat apache org msg html SingleSignOnEntry cache ClusterSingleSignOn valve Tomcat startup set bean session test object servlet context create
57340	NioConnector caches corrupted concurrent comet close Configuration Tomcat NioConnector nginx atmosphere nginx atmosphere close comet connection concurrently NioEndpoint Poller thread SocketChannel ready read nginx closes Poller unregisters channel read forks thread handle close event NioEndpoint atmosphere calls close connection thread Tomcat receives internal action code ActionCode COMET CLOSE adds channel Poller registers read Http NioProcessor java SocketChannel readable thread hasn’t invalidated SelectionKey Poller thread initiates closing process forks thread Thread completes closing process puts NioChannel AttachmentKey caches Thread close channel realizes closed AbstractProtocol java puts NioChannel AttachmentKey caches Caches corrupted references object subsequent requests NioChannel AttachmentKey crazy stuff happen mixed responses NioConnector caches corrupted concurrent comet close set read socket comet write ssl event key
57420	Wrong names generated URL ENCODER DirContextURLConnection thread safe debugging time tomcat starts fail deploy webapp find complete garbage error stack trace SEVERE Unable process resource element jndi localhost testapp WEB INF classes blabli dNlewrP lculgiansDisalog annotations java FileNotFoundException jndi localhost testapp WEB INF classes blabli dNlewrP lculgiansDisalog time time referenced mix real classes exist vicinity exception debugger dcUrlConn DirContextURLConnection correct entries WAR file Enumeration String dirs dcUrlConn list Calling list debugger yields correct contents dirs variable lCsosn oCrAopnpfliigcEadtiitoonr AEpdpiltiocraMtoidoen acslsass tCioonnfi aticolnaLsosad liconaftgiuroatni LocadlLaisstsen cCaotnifiognur clastsi lCaonsfsig cluaiss CwoindgfetisegtEditorApplication ConfigEditorApplication ApplicationConfigLoadListener ConfigEditorApplication ConfigEditorToParameterHandlerIntegration ConfigEditorApplication EditorMode ConfigEditorApplication EditorMode ConfigEditorApplication EditorMode ConfigEditorApplication ConfigLoader ConfigLoader ConfigurationLoadListener ConfigType ConfigurationLoadListener ConfigurationLoadedEvent ConfigurationLoadListener FailedToLoadConfigurationEvent ConfigurationLoadListener command data field rendering session util widgetset walking list command leads collection list turn encoded URL ENCODER UEncoder URL ENCODER thread safe result garbage concurrently interesting note single failure step caused classes WEB INF classes directory JAR files WEB INF lib appears DirContextURLConnections rare concurrency issues URL ENCODER full stacktrace error occurs Jan org apache catalina startup ContextConfig processAnnotationsJndi SEVERE Unable process resource element jndi localhost medusa config editor WEB INF classes ergon medusa configeditor dialog TeerstRelgeaxsDialog annotations java FileNotFoundException jndi localhost medusa config editor WEB INF classes ergon medusa configeditor dialog TeerstRelgeaxsDialog Jan org apache catalina startup ContextConfig processAnnotationsJndi SEVERE Unable process resource element jndi localhost medusa config editor WEB INF classes ergon medusa configeditor dialog aTsesxtAreaDialog annotations java FileNotFoundException jndi localhost medusa config editor WEB INF classes ergon medusa configeditor dialog aTsesxtAreaDialog Wrong names generated URL ENCODER DirContextURLConnection thread safe web thread type annotations servlet set context init
57681	parallel loading web application loader synchronizing specific object Created attachment details Parallel classloading port Tomcat https issues apache org bugzilla bug cgi Add web application loader implementation supports parallel loading web application classes Source file patch https svn apache org viewvc tomcat trunk java org apache catalina loader WebappClassLoader java revision view markup parallel loading web application loader synchronizing specific object set protection log servlet loader find thread references
57683	Crash stockticket async caused aborted client request mentioned issue Time thread dev bug error handling webapp regression reproducible Steps reproduce Tomcat JDK Start Tomcat Visit stockicker http localhost examples async stockticker Abort request loaded Press Esc key keyboard visit http localhost examples async stockticker Expected Working stockicker Actual Browser waits response seconds progress indicator stops blank displayed Access log response status counter Mar examples async stockticker HTTP catalina log exception org apache coyote AbstractProcessor setErrorState INFO error occurred processing container thread connection closed java net SocketException Software caused connection abort socket write error console exception exception java lang IllegalStateException request AsyncContext completed processing Essentially async Stockticker thread crashed handled ISE explains behaviour exception logged console logged Tomcat log files Crash stockticket async caused aborted client request test socket header set response async path servlet
57779	Deadlock separate thread write ServletOutputStream separate container thread write ServletOutputStream deadlock occur error occurs write client drops connection caused operation underlying socket object servlet handling thread blocked waiting output separate thread holds lock socket object http bio exec daemon prio tid nid waiting condition aeeb java lang Thread WAITING parking parking wait java util concurrent locks AbstractQueuedSynchronizer ConditionObject locked org apache tomcat util net SocketWrapper separate thread trys write error occurs Thread daemon prio tid nid fda waiting monitor entry java lang Thread BLOCKED object monitor waiting lock org apache tomcat util net SocketWrapper trys lock socket object threads blocked tomcat version issue source code failing code invented Deadlock separate thread write ServletOutputStream set write response header buffer servlet output compression
57943	NioEndpoint poller thread died restart tomcat tomcat process request soon，i find error log Exception thread http nio ClientPoller java util ConcurrentModificationException tomcat poller thread exception thread died connection accept poller thread process NioEndpoint poller thread died set socket ssl write key read buffer size
57959	Deadlock FileHandler java log rotated Tomcat deadlock log file rotated issue fixed latest tomcat tomcat tomcat issue code apache tomcat src java org apache juli FileHandler java writerLock writeLock unlock grade read lock ensures writer remains valid log message written writerLock readLock lock comment order wrong acquire read lock release write lock race condition occur correct writerLock readLock lock writerLock writeLock unlock tomc order correct Deadlock FileHandler java log rotated set log element file servlet attribute format context
57977	original loader isn bound thread PersistentValve invoke Created attachment details patch trunk PersistentValve invoke Request Response method Webapp loader bound current thread original loader bind isn restored thread original loader bound thread original loader isn bound thread PersistentValve invoke set protection thread session container internal start child
58179	Atomicity violation Bai Guangdong fellow National University Singapore find atomicity violation bug problem occurs file java org apache catalina core ApplicationContext java code snippet oldValue attributes oldValue replaced attributes replaced event ServletContextAttributeEvent context getServletContext oldValue event ServletContextAttributeEvent context getServletContext replaced context fireContainerEvent beforeContextAttributeReplaced listener listener attributeReplaced event context fireContainerEvent afterContextAttributeReplaced listener context fireContainerEvent beforeContextAttributeAdded listener listener attributeAdded event context fireContainerEvent afterContextAttributeAdded listener Suppose threads executes code snippet key Initially attributes empty executes oldValue executes executes oldValue executes replaces fire beforeContextAttributeAdded event situation replaced beforeContextAttributeReplaced fired Atomicity violation set references find resource jar loader thread add
58522	concurrency problem corrupts WARDirContext Entry children discovered problem calling ServletContext getResourcePaths jsp corrupt WARDirContext Entry children WARDirContext list Entry method performs Arrays sort children call thread safe Calling multiple request threads result children array losing entries duplicating entries representing directories war lost Tomcat load resources resource requests result http error code jsp compliation JasperException included files CentOS newer versions Tomcat Java attached zip Test project demonstrates corruption requires multiple runs stack trace illustrating problematic flow patch file WARDirContext java concurrency problem corrupts WARDirContext Entry children set node add internal jjt container start find
58946	ApplicationHttpRequest enforce immutability ParameterMap JavaDoc ServletRequest getParameterMap Oracle site Returns immutable java util Map problem immutability enforced org apache catalina core ApplicationHttpRequest implement included forwarded requests Note org apache catalina util ParameterMap usual forwarded requests enforce immutability message Reproducible current Tomcat dev Steps reproduce JSPs ROOT web application test jsp contentType text plain charset UTF java util RequestDispatcher request getRequestDispatcher test jsp request response test jsp contentType text plain charset UTF java util Map map request getParameterMap map foo bar map Call http localhost test jsp Actual response observed foo bar Ljava lang String Expected call test jsp application behaviour expected http localhost test jsp HTTP Status exception occurred processing JSP test jsp root java lang IllegalStateException modifications allowed locked ParameterMap org apache catalina util ParameterMap ParameterMap java org apache jsp test jsp jspService test jsp java noticed issue performing code review inspired thread started users mailing list http docs oracle javaee api javax servlet ServletRequest html getParameterMap http tomcat markmail org thread fghtoxcj ApplicationHttpRequest enforce immutability ParameterMap load set servlet request path dispatcher parameter arse
59138	checkThreadLocalMapForLeaks positives ThreadLocal ThreadLocalMap weakly references references values appears checkThreadLocalMapForLeaks checking reports positives key ThreadLocal subclass anonymous reference loader Integer List SimpleDateFormatter output Mar SEVERE localhost startStop org apache catalina loader WebappClassLoaderBase checkThreadLocalMapForLeaks web application servlettest created ThreadLocal key type servlettest TestServlet servlettest TestServlet type java lang Integer failed remove web application stopped Threads renewed time avoid probable memory leak large web applications positives output tracking noticing real issues difficult party libraries refuse adjust ThreadLocal IMO rightly code causing leaks read bug comment current heuristic positives compromise reached configuration stifling warning key basis acceptable configuration instance message issued single suppressing ThreadLocal warnings based config info warning message checkThreadLocalMapForLeaks positives set references find resource jar thread add loader