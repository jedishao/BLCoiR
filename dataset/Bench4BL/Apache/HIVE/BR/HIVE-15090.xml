<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 02 05:55:27 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HIVE-15090/HIVE-15090.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HIVE-15090] Temporary DB failure can stop ExpiredTokenRemover thread</title>
                <link>https://issues.apache.org/jira/browse/HIVE-15090</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;In &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-13090&quot; title=&quot;Hive metastore crashes on NPE with ZooKeeperTokenStore&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-13090&quot;&gt;&lt;del&gt;HIVE-13090&lt;/del&gt;&lt;/a&gt; we decided that we should not close the metastore if there is an unexpected exception during the expired token removal process, but that fix leaves a running metastore without ExpiredTokenRemover thread.&lt;/p&gt;

&lt;p&gt;To fix this I will move the catch inside the running loop, and hope the thread could recover from the exception&lt;/p&gt;</description>
                <environment></environment>
        <key id="13016129">HIVE-15090</key>
            <summary>Temporary DB failure can stop ExpiredTokenRemover thread</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="pvary">Peter Vary</assignee>
                                    <reporter username="pvary">Peter Vary</reporter>
                        <labels>
                    </labels>
                <created>Fri, 28 Oct 2016 12:11:18 +0000</created>
                <updated>Thu, 17 Nov 2016 17:06:33 +0000</updated>
                            <resolved>Thu, 17 Nov 2016 17:06:31 +0000</resolved>
                                    <version>1.3.0</version>
                    <version>2.1.0</version>
                    <version>2.0.1</version>
                    <version>2.2.0</version>
                                    <fixVersion>2.2.0</fixVersion>
                    <fixVersion>2.1.1</fixVersion>
                                    <component>Metastore</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                <comments>
                            <comment id="15615454" author="pvary" created="Fri, 28 Oct 2016 13:45:18 +0000"  >&lt;p&gt;Moved the try/catch into the while cycle, so the thread will keep running after the exception.&lt;br/&gt;
Added an extra sleep when there is an exception so we do not end up busy waiting for the solution of the problem which caused the exception&lt;/p&gt;</comment>
                            <comment id="15615471" author="pvary" created="Fri, 28 Oct 2016 13:52:56 +0000"  >&lt;p&gt;I have tested with the following configuration:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&amp;lt;property&amp;gt;
  &amp;lt;!-- So the tokens are stored in database --&amp;gt;
  &amp;lt;name&amp;gt;hive.cluster.delegation.token.store.class&amp;lt;/name&amp;gt;
  &amp;lt;value&amp;gt;org.apache.hadoop.hive.thrift.DBTokenStore&amp;lt;/value&amp;gt;
&amp;lt;/property&amp;gt;
&amp;lt;property&amp;gt;
   &amp;lt;!-- So the removal happens often --&amp;gt;
   &amp;lt;name&amp;gt;hive.cluster.delegation.token.gc-interval&amp;lt;/name&amp;gt;
   &amp;lt;value&amp;gt;10&amp;lt;/value&amp;gt;
&amp;lt;/property&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Started the Metastore, and after a while I have stopped the database. When the database was turned off the metastore logged the &lt;tt&gt;ExpiredTokenRemover thread received unexpected exception&lt;/tt&gt; message, after the database restarted the messages are stopped, and everything become normal. In the debugger I have verified the thread is running.&lt;/p&gt;</comment>
                            <comment id="15615490" author="pvary" created="Fri, 28 Oct 2016 13:56:42 +0000"  >&lt;p&gt;Added it to the review board:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/53261/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/53261/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15615573" author="pvary" created="Fri, 28 Oct 2016 14:31:56 +0000"  >&lt;p&gt;Spelling issues fixed&lt;/p&gt;</comment>
                            <comment id="15615594" author="aihuaxu" created="Fri, 28 Oct 2016 14:40:29 +0000"  >&lt;p&gt;+1. The patch looks good to me. &lt;/p&gt;</comment>
                            <comment id="15637581" author="aihuaxu" created="Fri, 4 Nov 2016 20:29:39 +0000"  >&lt;p&gt;Reattach the same patch.&lt;/p&gt;</comment>
                            <comment id="15637991" author="hiveqa" created="Fri, 4 Nov 2016 23:04:19 +0000"  >

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12837282/HIVE-15090.2.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12837282/HIVE-15090.2.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to no test(s) being added or modified.&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 3 failed/errored test(s), 10628 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[join_acid_non_acid] (batchId=150)
org.apache.hadoop.hive.cli.TestMiniLlapLocalCliDriver.testCliDriver[union_fast_stats] (batchId=145)
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver[explainanalyze_2] (batchId=91)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/1973/testReport&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/1973/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/1973/console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/1973/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://104.198.109.242/logs/PreCommit-HIVE-Build-1973/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://104.198.109.242/logs/PreCommit-HIVE-Build-1973/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 3 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12837282 - PreCommit-HIVE-Build&lt;/p&gt;</comment>
                            <comment id="15643551" author="pvary" created="Mon, 7 Nov 2016 08:56:49 +0000"  >&lt;p&gt;The failed tests are flaky. See:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-15084&quot; title=&quot;Flaky test: TestMiniTezCliDriver:explainanalyze_2, 3, 4, 5&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-15084&quot;&gt;HIVE-15084&lt;/a&gt; Flaky test: TestMiniTezCliDriver:explainanalyze_2, 3, 4&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-15115&quot; title=&quot;Flaky test: TestMiniLlapLocalCliDriver.testCliDriver[union_fast_stats]&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-15115&quot;&gt;HIVE-15115&lt;/a&gt; Flaky test: TestMiniLlapLocalCliDriver.testCliDriver union_fast_stats&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-15116&quot; title=&quot;Flaky test: TestMiniLlapLocalCliDriver.testCliDriver[join_acid_non_acid]&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-15116&quot;&gt;HIVE-15116&lt;/a&gt; Flaky test: TestMiniLlapLocalCliDriver.testCliDriver join_acid_non_acid&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15644272" author="aihuaxu" created="Mon, 7 Nov 2016 14:10:17 +0000"  >&lt;p&gt;Pushed to master. Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=pvary&quot; class=&quot;user-hover&quot; rel=&quot;pvary&quot;&gt;Peter Vary&lt;/a&gt; for your work.&lt;/p&gt;</comment>
                            <comment id="15647100" author="pvary" created="Tue, 8 Nov 2016 09:57:07 +0000"  >&lt;p&gt;I think we should backport this at least to 2.1&lt;/p&gt;</comment>
                            <comment id="15647132" author="pvary" created="Tue, 8 Nov 2016 10:07:42 +0000"  >&lt;p&gt;Reopen to backport it to branch2.1&lt;/p&gt;</comment>
                            <comment id="15647466" author="hiveqa" created="Tue, 8 Nov 2016 12:43:54 +0000"  >

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12837943/HIVE-15090.2-branch-2.1.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12837943/HIVE-15090.2-branch-2.1.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to no test(s) being added or modified.&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 66 failed/errored test(s), 10462 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;TestJdbcWithMiniHA - did not produce a TEST-*.xml file (likely timed out) (batchId=494)
TestJdbcWithMiniMr - did not produce a TEST-*.xml file (likely timed out) (batchId=491)
TestMsgBusConnection - did not produce a TEST-*.xml file (likely timed out) (batchId=362)
TestOperationLoggingAPIWithTez - did not produce a TEST-*.xml file (likely timed out) (batchId=484)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_acid_table_stats (batchId=92)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_insert_values_orig_table_use_metadata (batchId=109)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_orc_ppd_schema_evol_3a (batchId=97)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_schema_evol_orc_acid_mapwork_part (batchId=68)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_schema_evol_orc_acid_mapwork_table (batchId=5)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_schema_evol_orc_acidvec_mapwork_part (batchId=142)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_schema_evol_orc_acidvec_mapwork_table (batchId=77)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_schema_evol_orc_nonvec_fetchwork_part (batchId=84)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_schema_evol_orc_nonvec_fetchwork_table (batchId=65)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_schema_evol_orc_nonvec_mapwork_part (batchId=12)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_schema_evol_orc_nonvec_mapwork_table (batchId=126)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_schema_evol_orc_vec_mapwork_part (batchId=76)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_schema_evol_orc_vec_mapwork_table (batchId=3)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_schema_evol_text_nonvec_mapwork_part (batchId=136)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_schema_evol_text_nonvec_mapwork_table (batchId=58)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_schema_evol_text_vec_mapwork_part (batchId=112)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_schema_evol_text_vec_mapwork_table (batchId=43)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_schema_evol_text_vecrow_mapwork_part (batchId=6)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_schema_evol_text_vecrow_mapwork_table (batchId=132)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_stats_null_optimizer (batchId=154)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_vector_between_in (batchId=99)
org.apache.hadoop.hive.cli.TestMiniLlapCliDriver.testCliDriver_orc_ppd_basic (batchId=521)
org.apache.hadoop.hive.cli.TestMiniLlapCliDriver.testCliDriver_schema_evol_orc_acid_mapwork_part (batchId=521)
org.apache.hadoop.hive.cli.TestMiniLlapCliDriver.testCliDriver_schema_evol_orc_acid_mapwork_table (batchId=521)
org.apache.hadoop.hive.cli.TestMiniLlapCliDriver.testCliDriver_schema_evol_orc_acidvec_mapwork_part (batchId=521)
org.apache.hadoop.hive.cli.TestMiniLlapCliDriver.testCliDriver_schema_evol_orc_acidvec_mapwork_table (batchId=521)
org.apache.hadoop.hive.cli.TestMiniLlapCliDriver.testCliDriver_schema_evol_orc_nonvec_fetchwork_part (batchId=521)
org.apache.hadoop.hive.cli.TestMiniLlapCliDriver.testCliDriver_schema_evol_orc_nonvec_fetchwork_table (batchId=521)
org.apache.hadoop.hive.cli.TestMiniLlapCliDriver.testCliDriver_schema_evol_orc_nonvec_mapwork_part (batchId=521)
org.apache.hadoop.hive.cli.TestMiniLlapCliDriver.testCliDriver_schema_evol_orc_nonvec_mapwork_table (batchId=521)
org.apache.hadoop.hive.cli.TestMiniLlapCliDriver.testCliDriver_schema_evol_orc_vec_mapwork_part (batchId=521)
org.apache.hadoop.hive.cli.TestMiniLlapCliDriver.testCliDriver_schema_evol_orc_vec_mapwork_table (batchId=521)
org.apache.hadoop.hive.cli.TestMiniLlapCliDriver.testCliDriver_schema_evol_text_nonvec_mapwork_part (batchId=521)
org.apache.hadoop.hive.cli.TestMiniLlapCliDriver.testCliDriver_schema_evol_text_nonvec_mapwork_table (batchId=521)
org.apache.hadoop.hive.cli.TestMiniLlapCliDriver.testCliDriver_schema_evol_text_vec_mapwork_part (batchId=521)
org.apache.hadoop.hive.cli.TestMiniLlapCliDriver.testCliDriver_schema_evol_text_vec_mapwork_table (batchId=521)
org.apache.hadoop.hive.cli.TestMiniLlapCliDriver.testCliDriver_schema_evol_text_vecrow_mapwork_part (batchId=521)
org.apache.hadoop.hive.cli.TestMiniLlapCliDriver.testCliDriver_schema_evol_text_vecrow_mapwork_table (batchId=521)
org.apache.hadoop.hive.cli.TestMiniSparkOnYarnCliDriver.testCliDriver_constprog_partitioner (batchId=539)
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver_orc_ppd_basic (batchId=187)
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver_orc_ppd_schema_evol_3a (batchId=198)
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver_schema_evol_orc_acid_mapwork_part (batchId=193)
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver_schema_evol_orc_acid_mapwork_table (batchId=182)
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver_schema_evol_orc_acidvec_mapwork_part (batchId=206)
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver_schema_evol_orc_acidvec_mapwork_table (batchId=195)
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver_schema_evol_orc_nonvec_fetchwork_part (batchId=196)
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver_schema_evol_orc_nonvec_fetchwork_table (batchId=192)
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver_schema_evol_orc_nonvec_mapwork_part (batchId=183)
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver_schema_evol_orc_nonvec_mapwork_table (batchId=203)
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver_schema_evol_orc_vec_mapwork_part (batchId=195)
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver_schema_evol_orc_vec_mapwork_table (batchId=182)
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver_schema_evol_text_nonvec_mapwork_part (batchId=205)
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver_schema_evol_text_nonvec_mapwork_table (batchId=191)
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver_schema_evol_text_vec_mapwork_part (batchId=201)
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver_schema_evol_text_vec_mapwork_table (batchId=188)
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver_schema_evol_text_vecrow_mapwork_part (batchId=182)
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver_schema_evol_text_vecrow_mapwork_table (batchId=204)
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver_vector_between_in (batchId=199)
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver_vector_cast_constant (batchId=183)
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver_vector_complex_all (batchId=200)
org.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver_vector_between_in (batchId=233)
org.apache.hive.jdbc.TestJdbcWithMiniLlap.testLlapInputFormatEndToEnd (batchId=487)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/2023/testReport&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/2023/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/2023/console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/2023/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://104.198.109.242/logs/PreCommit-HIVE-Build-2023/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://104.198.109.242/logs/PreCommit-HIVE-Build-2023/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 66 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12837943 - PreCommit-HIVE-Build&lt;/p&gt;</comment>
                            <comment id="15648745" author="thejas" created="Tue, 8 Nov 2016 20:49:15 +0000"  >&lt;p&gt;We shouldn&apos;t be catching all throwables, that will include errors like OOM where retrying doesn&apos;t make sense. Can we limit it to certain exceptions that can be realistically thrown ?&lt;/p&gt;</comment>
                            <comment id="15651254" author="pvary" created="Wed, 9 Nov 2016 15:40:17 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thejas&quot; class=&quot;user-hover&quot; rel=&quot;thejas&quot;&gt;Thejas M Nair&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;I was thinking about the same lines as you, but finally decided against it.&lt;br/&gt;
My reasoning was that the METASTORE_CLUSTER_DELEGATION_TOKEN_STORE_CLS is a configuration variable and could be set by the administrator to any class, that is why we will never be able to handle every future exception here correctly. So finally I decided to stick to a clean, easily understandable solution rather than create a partial solution for the DBTokenStore only.&lt;/p&gt;

&lt;p&gt;Since this one is already committed to master, I think if we find a better approach I think we should open another jira to handle it.&lt;br/&gt;
I would be happy to help out there too.&lt;/p&gt;

&lt;p&gt;Thanks again for taking a look at this!&lt;/p&gt;

&lt;p&gt;Peter&lt;/p&gt;</comment>
                            <comment id="15651265" author="pvary" created="Wed, 9 Nov 2016 15:45:46 +0000"  >&lt;p&gt;Retriggering the patch, and hoping to get only the same failing tests as &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-15094&quot; title=&quot;Fix test failures for 2.1.1 regarding schema evolution with DECIMAL types&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-15094&quot;&gt;&lt;del&gt;HIVE-15094&lt;/del&gt;&lt;/a&gt; &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="15651344" author="thejas" created="Wed, 9 Nov 2016 16:23:28 +0000"  >&lt;p&gt;Some options are - &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Defining the exceptions that can be thrown by DelegationTokenStore that are not fatal and can be ignored.&lt;/li&gt;
	&lt;li&gt;Updating DBTokenStore to not thrown what could be transient errors, and just log those&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=pvary&quot; class=&quot;user-hover&quot; rel=&quot;pvary&quot;&gt;Peter Vary&lt;/a&gt; What are your thoughts ?&lt;/p&gt;</comment>
                            <comment id="15651499" author="pvary" created="Wed, 9 Nov 2016 17:19:56 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thejas&quot; class=&quot;user-hover&quot; rel=&quot;thejas&quot;&gt;Thejas M Nair&lt;/a&gt; You are thinking like me &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;&lt;cite&gt;Defining the exceptions that can be thrown by DelegationTokenStore that are not fatal and can be ignored.&lt;/cite&gt;&lt;br/&gt;
I have chickened out of this since it is a compatibility change - at least in my unpracticed view. If I change the DelegationTokenStore interface to add the new type of exception, then if someone has implemented his own DelegationTokenStore, it has to be changed to work with the new version of hive.&lt;/p&gt;

&lt;p&gt;&lt;cite&gt;Updating DBTokenStore to not thrown what could be transient errors, and just log those&lt;/cite&gt;&lt;br/&gt;
ExpiredTokenRemover uses the following DelegationTokenStore methods: updateMasterKey, removeMasterKey, getAllDelegationTokenIdentifiers, removeToken, getToken. Changing the behavior of these methods could cause unexpected results.&lt;/p&gt;

&lt;p&gt;So I leaned for your first suggestion, but &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-13090&quot; title=&quot;Hive metastore crashes on NPE with ZooKeeperTokenStore&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-13090&quot;&gt;&lt;del&gt;HIVE-13090&lt;/del&gt;&lt;/a&gt; was a longstanding issue (introduced at Dec 7, 2011) with very visible effects and with only two jiras for it. I thought it is not that common to warrant the compatibility change.&lt;/p&gt;

&lt;p&gt;What do you think &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thejas&quot; class=&quot;user-hover&quot; rel=&quot;thejas&quot;&gt;Thejas M Nair&lt;/a&gt;? Is it worth to change the DelegationTokenStore interface? You have more experience with Hive than me.&lt;/p&gt;

&lt;p&gt;Thanks,&lt;br/&gt;
Peter&lt;/p&gt;</comment>
                            <comment id="15651643" author="hiveqa" created="Wed, 9 Nov 2016 18:16:47 +0000"  >

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12838189/HIVE-15090.3-branch-2.1.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12838189/HIVE-15090.3-branch-2.1.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to no test(s) being added or modified.&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 20 failed/errored test(s), 10462 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;TestJdbcWithMiniHA - did not produce a TEST-*.xml file (likely timed out) (batchId=494)
TestJdbcWithMiniMr - did not produce a TEST-*.xml file (likely timed out) (batchId=491)
TestMsgBusConnection - did not produce a TEST-*.xml file (likely timed out) (batchId=362)
TestOperationLoggingAPIWithTez - did not produce a TEST-*.xml file (likely timed out) (batchId=484)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_acid_table_stats (batchId=92)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_insert_values_orig_table_use_metadata (batchId=109)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_list_bucket_dml_12 (batchId=87)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_orc_ppd_schema_evol_3a (batchId=97)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_stats_null_optimizer (batchId=154)
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_vector_between_in (batchId=99)
org.apache.hadoop.hive.cli.TestMiniLlapCliDriver.testCliDriver_orc_ppd_basic (batchId=521)
org.apache.hadoop.hive.cli.TestMiniSparkOnYarnCliDriver.testCliDriver_constprog_partitioner (batchId=539)
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver_orc_ppd_basic (batchId=187)
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver_orc_ppd_schema_evol_3a (batchId=198)
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver_vector_between_in (batchId=199)
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver_vector_cast_constant (batchId=183)
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver_vector_complex_all (batchId=200)
org.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver_vector_between_in (batchId=233)
org.apache.hive.jdbc.TestJdbcWithMiniHS2.testAddJarConstructorUnCaching (batchId=492)
org.apache.hive.jdbc.TestJdbcWithMiniLlap.testLlapInputFormatEndToEnd (batchId=487)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/2049/testReport&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/2049/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/2049/console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/2049/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://104.198.109.242/logs/PreCommit-HIVE-Build-2049/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://104.198.109.242/logs/PreCommit-HIVE-Build-2049/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 20 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12838189 - PreCommit-HIVE-Build&lt;/p&gt;</comment>
                            <comment id="15654432" author="pvary" created="Thu, 10 Nov 2016 16:13:34 +0000"  >&lt;p&gt;We have an ongoing discussion with &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thejas&quot; class=&quot;user-hover&quot; rel=&quot;thejas&quot;&gt;Thejas M Nair&lt;/a&gt; about a followup patch, but since this patch is already committed to master and the test results are good for the branch 2.1, I think it would be ok to submit this to branch 2.1 anyway.&lt;/p&gt;

&lt;p&gt;Any objections?&lt;/p&gt;

&lt;p&gt;Thanks,&lt;br/&gt;
Peter &lt;/p&gt;</comment>
                            <comment id="15656279" author="thejas" created="Fri, 11 Nov 2016 06:17:38 +0000"  >&lt;p&gt;I haven&apos;t come across any DelegationTokenStore implementation outside of hive. I think that is highly unlikely to exist. Even if it exists, the user would be sophisticated enough to update the implementation. Also, we haven&apos;t documented that as a public interface. So, changing the interface if needed is OK.&lt;/p&gt;</comment>
                            <comment id="15656284" author="thejas" created="Fri, 11 Nov 2016 06:19:33 +0000"  >&lt;p&gt;Looks like DBTokenStore methods all call DBTokenStore.invokeOnTokenStore , which would throw TokenStoreException on these transient errors. Catching and retrying on that seems like a reasonable option.&lt;/p&gt;</comment>
                            <comment id="15660683" author="lefty@hortonworks.com" created="Sun, 13 Nov 2016 02:19:09 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=pvary&quot; class=&quot;user-hover&quot; rel=&quot;pvary&quot;&gt;Peter Vary&lt;/a&gt; or &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aihuaxu&quot; class=&quot;user-hover&quot; rel=&quot;aihuaxu&quot;&gt;Aihua Xu&lt;/a&gt;, please update the status of this issue.  It was committed to master on November 7 (commit dfb868d1af5bcc0db517c4a7d3675d1971284ef3).  Thanks.&lt;/p&gt;</comment>
                            <comment id="15663268" author="pvary" created="Mon, 14 Nov 2016 09:26:41 +0000"  >&lt;p&gt;Created &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-15184&quot; title=&quot;Add the possibility to separate recoverable and not recoverable errors in DeletagionTokenStore&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-15184&quot;&gt;HIVE-15184&lt;/a&gt; to track this improvement. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thejas&quot; class=&quot;user-hover&quot; rel=&quot;thejas&quot;&gt;Thejas M Nair&lt;/a&gt;, could you please check there?&lt;/p&gt;

&lt;p&gt;Thanks,&lt;br/&gt;
Peter&lt;/p&gt;</comment>
                            <comment id="15663277" author="pvary" created="Mon, 14 Nov 2016 09:28:36 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=leftylev&quot; class=&quot;user-hover&quot; rel=&quot;leftylev&quot;&gt;Lefty Leverenz&lt;/a&gt;: Reopened this, so we could backport to branch 2.1.&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aihuaxu&quot; class=&quot;user-hover&quot; rel=&quot;aihuaxu&quot;&gt;Aihua Xu&lt;/a&gt;: Could you please commit the patch to the 2.1 branch? Both of them are the same, only submitted twice to check the test results.&lt;/p&gt;

&lt;p&gt;Thanks,&lt;br/&gt;
Peter&lt;/p&gt;</comment>
                            <comment id="15674250" author="aihuaxu" created="Thu, 17 Nov 2016 17:06:33 +0000"  >&lt;p&gt;Pushed to branch 2.1 as well. &lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13020094">HIVE-15184</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="12310050">
                    <name>Regression</name>
                                                                <inwardlinks description="is broken by">
                                        <issuelink>
            <issuekey id="12940299">HIVE-13090</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12837943" name="HIVE-15090.2-branch-2.1.patch" size="1985" author="pvary" created="Tue, 8 Nov 2016 09:57:07 +0000"/>
                            <attachment id="12837282" name="HIVE-15090.2.patch" size="1985" author="aihuaxu" created="Fri, 4 Nov 2016 20:29:09 +0000"/>
                            <attachment id="12835821" name="HIVE-15090.2.patch" size="1985" author="pvary" created="Fri, 28 Oct 2016 14:31:56 +0000"/>
                            <attachment id="12838189" name="HIVE-15090.3-branch-2.1.patch" size="1985" author="pvary" created="Wed, 9 Nov 2016 15:45:46 +0000"/>
                            <attachment id="12835807" name="HIVE-15090.patch" size="1787" author="pvary" created="Fri, 28 Oct 2016 13:45:18 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 28 Oct 2016 14:40:29 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i35jhj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>