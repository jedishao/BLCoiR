<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 02 23:33:57 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HIVE-31/HIVE-31.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HIVE-31] Hive: support CREATE TABLE xxx SELECT yyy.* FROM yyy</title>
                <link>https://issues.apache.org/jira/browse/HIVE-31</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;We should allow users to create a table using query result, without specifying the column names and column types.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12407384">HIVE-31</key>
            <summary>Hive: support CREATE TABLE xxx SELECT yyy.* FROM yyy</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="nzhang">Ning Zhang</assignee>
                                    <reporter username="zshao">Zheng Shao</reporter>
                        <labels>
                    </labels>
                <created>Wed, 29 Oct 2008 02:51:14 +0000</created>
                <updated>Sat, 17 Dec 2011 00:05:44 +0000</updated>
                            <resolved>Thu, 1 Oct 2009 20:07:18 +0000</resolved>
                                                    <fixVersion>0.5.0</fixVersion>
                                    <component>Query Processor</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>4</watches>
                                                                <comments>
                            <comment id="12651676" author="electrum" created="Fri, 28 Nov 2008 22:36:52 +0000"  >&lt;p&gt;This is commonly known as &quot;CREATE TABLE AS SELECT&quot; or &quot;CTAS&quot;.  Do we want to require the &quot;AS&quot; keyword?&lt;/p&gt;

&lt;p&gt;MySQL: optional&lt;br/&gt;
Oracle: required&lt;br/&gt;
PostgreSQL: required&lt;br/&gt;
SQLite: required&lt;/p&gt;
</comment>
                            <comment id="12655579" author="akramer" created="Thu, 11 Dec 2008 09:29:14 +0000"  >&lt;p&gt;Similar request would be a straightforward LIKE command:&lt;/p&gt;

&lt;p&gt;CREATE TABLE new_table LIKE preexisting_table;&lt;/p&gt;

&lt;p&gt;...I&apos;ve been meaning to request this functionality for a while.&lt;/p&gt;

&lt;p&gt;Comment 2: I think it would be very useful to ensure that we can create temporary tables this way, too: CTTAS.&lt;/p&gt;</comment>
                            <comment id="12704445" author="zshao" created="Thu, 30 Apr 2009 02:27:43 +0000"  >&lt;p&gt;We can create tables with good column names only when we have meaningful names from the plan.&lt;/p&gt;</comment>
                            <comment id="12710443" author="akramer" created="Mon, 18 May 2009 18:49:22 +0000"  >&lt;p&gt;Well, functionally, renaming table names is easy. It would be very useful for me to have this functionality even if the names were just key, value1, value2, ..., valueN.&lt;/p&gt;

&lt;p&gt;And now I open a JIRA that requests ability to select columns by number...&lt;/p&gt;</comment>
                            <comment id="12752641" author="appodictic" created="Tue, 8 Sep 2009 17:52:48 +0000"  >&lt;p&gt;This will be helpful. I find this is mostly a problem when dealing with columns that are partitioned. For example I may have a table &lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;month day   id value
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Where month and day are partitions I either have to remove the columns or do the multi-insert.&lt;/p&gt;

&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="12752655" author="nzhang" created="Tue, 8 Sep 2009 18:14:24 +0000"  >&lt;p&gt;Edward, do you mean the input table is partitioned or the newly created table should also support partitions? &lt;/p&gt;</comment>
                            <comment id="12752704" author="appodictic" created="Tue, 8 Sep 2009 20:06:21 +0000"  >&lt;p&gt;I don&apos;t know if anyone can solve this. I will try to replicate the situation it came up on.&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;create table tableA(  url string , time string, cookies string) partitioned by (year string,month string)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;create table tableb(  url string , time string, cookies string) partitioned by (year string,month string)
row format compressed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;INSERT INTO tableb (url,time,string)partition x,y &lt;br/&gt;
from select * from tablea where year=x,month=y&lt;/p&gt;

&lt;p&gt;See? I needed to list every column because the select * from tableA turns a partition into a column. In my case both tables are partitioned in the same way. I am not sure if this Jira can deal with this directly but I found this fact annoying.&lt;/p&gt;</comment>
                            <comment id="12752709" author="zshao" created="Tue, 8 Sep 2009 20:11:20 +0000"  >&lt;p&gt;Edward,&lt;/p&gt;

&lt;p&gt;This should solve your problem:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
INSERT OVERWRITE tableB PARTITION(year=xxx, month=yyy)
SELECT `(year|month)?+.+` FROM tableA
WHERE year = xxx and month = yyy;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12752722" author="appodictic" created="Tue, 8 Sep 2009 20:28:16 +0000"  >&lt;p&gt;Interesting. I figured the regex select would help, however I have some week regex skills. Thanks Zheng&lt;/p&gt;</comment>
                            <comment id="12760667" author="nzhang" created="Tue, 29 Sep 2009 18:41:35 +0000"  >&lt;p&gt;Attaching &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-31&quot; title=&quot;Hive: support CREATE TABLE xxx SELECT yyy.* FROM yyy&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-31&quot;&gt;&lt;del&gt;HIVE-31&lt;/del&gt;&lt;/a&gt;.patch. &lt;/p&gt;

&lt;p&gt;This patch implements the CTAS feature:&lt;/p&gt;

&lt;p&gt;1) The select statement could be any query we support right now.&lt;br/&gt;
2) The created table and and source tables could have different SerDe and/or Storage formats.&lt;br/&gt;
3) the schema of the created table is detected from the select statement. User don&apos;t need to (and should not) specify that.&lt;/p&gt;

&lt;p&gt;Limitations:&lt;br/&gt;
1) Created table does not support partition now. There is another work on automatic partitioning for insert statement. That will solve this problem.&lt;br/&gt;
2) Create table could not be an external table. &lt;/p&gt;</comment>
                            <comment id="12760728" author="nzhang" created="Tue, 29 Sep 2009 21:42:06 +0000"  >&lt;p&gt;Namit&apos;s comments:&lt;br/&gt;
====&lt;/p&gt;

&lt;p&gt;Due to jira connection problems (and losing them twice), sending them by mail.&lt;br/&gt;
You can copy in the jira when it is stable:&lt;/p&gt;

&lt;p&gt;Looks good - some minor comments.&lt;/p&gt;



&lt;p&gt;Tests:&lt;/p&gt;

&lt;p&gt;1. Negative: exit at first error, so have a separate file for each case.&lt;br/&gt;
2. Positive: Output not deterministic&lt;br/&gt;
            Add describe also.&lt;/p&gt;

&lt;p&gt;ErrorMsg.java:&lt;/p&gt;

&lt;p&gt; CTAS_COLLST_COEXISTENCE(&quot;Create table as select command cannot specify the list of columns for the target table.&quot;),&lt;br/&gt;
 CTLT_COLLST_COEXISTENCE(&quot;Create table like command cannot specify the list of columns for the target table.&quot;),&lt;/p&gt;


&lt;p&gt;Why not ? If it is not supported currently, but you want to add it in a follow-up, can you file a jira for that ?&lt;/p&gt;



&lt;p&gt;SemanticAnalyzerFactory.java:&lt;/p&gt;

&lt;p&gt;This affects the ReplicationHook which is used for logging statements.&lt;br/&gt;
For CTAS, the output should be the final table which is created - currently, it is the directory &amp;#8211; needs&lt;br/&gt;
to be investigated&lt;/p&gt;


&lt;p&gt;SemanticAnalyzer.java:&lt;/p&gt;


&lt;p&gt;4370 		  if ( ! oneLoadFile ) &lt;/p&gt;
{
		  		4371 		  // should not have more than one files to load
		  		4372 		  throw new SemanticException(ErrorMsg.CTAS_MULTI_LOADFILE.getMsg());
		  		4373 		  }

&lt;p&gt;The above error is not really a exception - it can be a assert&lt;/p&gt;


&lt;p&gt;Currently, for non CTAS create tables, root tasks are created by analyzeCreateTable, whereas for CTAS,&lt;br/&gt;
it is created later on &amp;#8211; can you file a new jira for this cleanup.&lt;/p&gt;
</comment>
                            <comment id="12760767" author="prasadc" created="Tue, 29 Sep 2009 23:33:13 +0000"  >&lt;p&gt;I don&apos;t understand why analyzeCreateTable() is moved to SemanticAnalyzer.java. That file is already very big. Can you not call analyzeInternal() from DDLSemanticAnalyzer?&lt;/p&gt;</comment>
                            <comment id="12760775" author="nzhang" created="Tue, 29 Sep 2009 23:58:06 +0000"  >&lt;p&gt;Chatted with Prasad offline. The decision to move the task of DDLSemanticAnalyzer to SemanticAnalyzer is to have a single SemanticAnalyzer instance for the whole CTAS statement (otherwise, a SemanticsAnalyzer is needed for the SELECT part to get the resulting schema, and a DDLSemanticAnalyzer for the CREATE TABLE part). With one instance of SA, all info is shared and don&apos;t need to pass around. &lt;/p&gt;

&lt;p&gt;Another issue Prasad raised is that the DDLWork is chained as the root task, and that should be moved to the end of the task chain. I will change that in the next revision. &lt;/p&gt;</comment>
                            <comment id="12760973" author="nzhang" created="Wed, 30 Sep 2009 18:12:21 +0000"  >&lt;p&gt;fixes issues raised by Namit and Prasad. &lt;br/&gt;
1) output file is the table only in the posthook.&lt;br/&gt;
2) DDLwork is moved to the end of the task chain.&lt;/p&gt;</comment>
                            <comment id="12760983" author="nzhang" created="Wed, 30 Sep 2009 18:51:46 +0000"  >&lt;p&gt;Additional changes in &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-31&quot; title=&quot;Hive: support CREATE TABLE xxx SELECT yyy.* FROM yyy&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-31&quot;&gt;&lt;del&gt;HIVE-31&lt;/del&gt;&lt;/a&gt;_2.patch:&lt;/p&gt;

&lt;p&gt;3) added sort by and explain in the clientpositive tests. &lt;br/&gt;
4) removed the if-not-exists in clientnegative since it is already covered in clientpositive. &lt;br/&gt;
5) SemanticAnalyzer.java:4370 changed to assert rather than throw an exception.&lt;/p&gt;</comment>
                            <comment id="12761061" author="nzhang" created="Thu, 1 Oct 2009 01:00:49 +0000"  >&lt;p&gt;This patch incorporated Prasad&apos;s comment about early exception when the target table exists. Prasad, please look at this patch as the previous one just return and won&apos;t throw an exception. &lt;/p&gt;</comment>
                            <comment id="12761280" author="namit" created="Thu, 1 Oct 2009 17:44:20 +0000"  >&lt;p&gt;Ning, can you generate the patch again - there were many many conflicts when I tried to apply the patch.&lt;/p&gt;</comment>
                            <comment id="12761290" author="nzhang" created="Thu, 1 Oct 2009 18:17:02 +0000"  >&lt;p&gt;Namit, &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-31&quot; title=&quot;Hive: support CREATE TABLE xxx SELECT yyy.* FROM yyy&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-31&quot;&gt;&lt;del&gt;HIVE-31&lt;/del&gt;&lt;/a&gt;_4.patch is compatible with the latest revision (820742)&lt;/p&gt;</comment>
                            <comment id="12761321" author="namit" created="Thu, 1 Oct 2009 20:03:37 +0000"  >&lt;p&gt;+1&lt;/p&gt;

&lt;p&gt;looks good&lt;/p&gt;</comment>
                            <comment id="12761322" author="namit" created="Thu, 1 Oct 2009 20:07:18 +0000"  >&lt;p&gt;Committed. Thanks Ning&lt;/p&gt;</comment>
                            <comment id="12890984" author="cwsteinbach" created="Thu, 22 Jul 2010 01:31:35 +0000"  >&lt;p&gt;This was accidentally committed as &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-861&quot; title=&quot;NumberFormatException in sum and avg&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-861&quot;&gt;&lt;del&gt;HIVE-861&lt;/del&gt;&lt;/a&gt;:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
% git log --stat c795b31e70 -n 1
commit c795b31e7009d6f95018c9a2fcbdff0b0ce26591
Author: Namit Jain &amp;lt;namit@apache.org&amp;gt;
Date:   Thu Oct 1 20:06:57 2009 +0000

    HIVE-861. NumberFormatException in sum and average
    (Zheng Shao via namit)
    
    
    
    git-svn-id: https:&lt;span class=&quot;code-comment&quot;&gt;//svn.apache.org/repos/asf/hadoop/hive/trunk@820771 13f79535-47bb-0310-9956-ffa450edef68
&lt;/span&gt;
 CHANGES.txt                                        |    3 +
 .../org/apache/hadoop/hive/ql/exec/ColumnInfo.java |   11 +
 .../hadoop/hive/ql/parse/BaseSemanticAnalyzer.java |   90 ++++
 .../hadoop/hive/ql/parse/DDLSemanticAnalyzer.java  |  339 +-------------
 .../org/apache/hadoop/hive/ql/parse/ErrorMsg.java  |   12 +-
 ql/src/java/org/apache/hadoop/hive/ql/parse/Hive.g |   29 +-
 .../java/org/apache/hadoop/hive/ql/parse/QB.java   |   19 +-
 .../hadoop/hive/ql/parse/SemanticAnalyzer.java     |  523 ++++++++++++++++++--
 .../hive/ql/parse/SemanticAnalyzerFactory.java     |    3 +-
 .../org/apache/hadoop/hive/ql/plan/PlanUtils.java  |   45 ++-
 ql/src/test/queries/clientnegative/ctas.q          |    5 +
 ql/src/test/queries/clientpositive/ctas.q          |   34 ++
 ql/src/test/results/clientnegative/ctas.q.out      |    5 +
 ql/src/test/results/clientpositive/create_1.q.out  |    7 +-
 .../test/results/clientpositive/create_like.q.out  |   16 +-
 ql/src/test/results/clientpositive/ctas.q.out      |  421 ++++++++++++++++
 ql/src/test/results/compiler/plan/cast1.q.xml      |   29 +-
 ql/src/test/results/compiler/plan/groupby2.q.xml   |   17 +-
 ql/src/test/results/compiler/plan/groupby3.q.xml   |   23 +-
 ql/src/test/results/compiler/plan/groupby4.q.xml   |   11 +-
 ql/src/test/results/compiler/plan/groupby5.q.xml   |   14 +-
 ql/src/test/results/compiler/plan/groupby6.q.xml   |   11 +-
 ql/src/test/results/compiler/plan/input20.q.xml    |   14 +-
 ql/src/test/results/compiler/plan/input3.q.xml     |    3 +
 ql/src/test/results/compiler/plan/input8.q.xml     |   17 +-
 .../test/results/compiler/plan/input_part1.q.xml   |   20 +-
 .../results/compiler/plan/input_testxpath.q.xml    |   17 +-
 .../results/compiler/plan/input_testxpath2.q.xml   |   17 +-
 ql/src/test/results/compiler/plan/join4.q.xml      |   12 +
 ql/src/test/results/compiler/plan/join5.q.xml      |   12 +
 ql/src/test/results/compiler/plan/join6.q.xml      |   12 +
 ql/src/test/results/compiler/plan/join7.q.xml      |   18 +
 ql/src/test/results/compiler/plan/join8.q.xml      |   12 +
 ql/src/test/results/compiler/plan/sample1.q.xml    |   20 +-
 ql/src/test/results/compiler/plan/subq.q.xml       |    6 +
 ql/src/test/results/compiler/plan/udf1.q.xml       |   59 ++-
 ql/src/test/results/compiler/plan/udf4.q.xml       |   65 +++-
 ql/src/test/results/compiler/plan/udf6.q.xml       |   14 +-
 ql/src/test/results/compiler/plan/udf_case.q.xml   |   14 +-
 ql/src/test/results/compiler/plan/udf_when.q.xml   |   14 +-
 ql/src/test/results/compiler/plan/union.q.xml      |    6 +
 41 files changed, 1564 insertions(+), 455 deletions(-)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                                                <inwardlinks description="is blocked by">
                                        <issuelink>
            <issuekey id="12426159">HIVE-509</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12410412">HIVE-153</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12420813" name="HIVE-31.patch" size="173695" author="nzhang" created="Tue, 29 Sep 2009 18:41:35 +0000"/>
                            <attachment id="12420931" name="HIVE-31_2.patch" size="186686" author="nzhang" created="Wed, 30 Sep 2009 18:12:21 +0000"/>
                            <attachment id="12420973" name="HIVE-31_3.patch" size="187534" author="nzhang" created="Thu, 1 Oct 2009 01:00:49 +0000"/>
                            <attachment id="12421041" name="HIVE-31_4.patch" size="175431" author="nzhang" created="Thu, 1 Oct 2009 18:17:02 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 28 Nov 2008 22:36:52 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>73823</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 20 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0iv4v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>108138</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310230" key="com.atlassian.jira.plugin.system.customfieldtypes:textfield">
                        <customfieldname>Tags</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>svn_id:&lt;a href=&apos;mailto:trunk@820771&apos;&gt;trunk@820771&lt;/a&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>