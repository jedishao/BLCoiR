<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 02 11:56:02 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HIVE-14003/HIVE-14003.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HIVE-14003] queries running against llap hang at times - preemption issues</title>
                <link>https://issues.apache.org/jira/browse/HIVE-14003</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;The preemption logic in the Hive processor needs some more work. There are definitely windows where the abort flag is completely dropped within the Hive processor.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12978186">HIVE-14003</key>
            <summary>queries running against llap hang at times - preemption issues</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="sseth">Siddharth Seth</assignee>
                                    <reporter username="taksaito">Takahiko Saito</reporter>
                        <labels>
                    </labels>
                <created>Mon, 13 Jun 2016 15:13:26 +0000</created>
                <updated>Sun, 19 Jun 2016 19:30:42 +0000</updated>
                            <resolved>Sun, 19 Jun 2016 19:30:42 +0000</resolved>
                                    <version>2.1.0</version>
                                    <fixVersion>2.1.1</fixVersion>
                                    <component>llap</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                <comments>
                            <comment id="15327669" author="sseth" created="Mon, 13 Jun 2016 16:15:35 +0000"  >&lt;p&gt;This is a continuation of &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-13858&quot; title=&quot;LLAP: A preempted task can end up waiting on completeInitialization if some part of the executing code suppressed the interrupt&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-13858&quot;&gt;&lt;del&gt;HIVE-13858&lt;/del&gt;&lt;/a&gt;. Not all problems related to abort processing were fixed there.&lt;/p&gt;

&lt;p&gt;There&apos;s a window at the moment, while the RecordProcessor is being initialized where an abort can be ignored. initialize in progress, mapOp/reduceOp not setup yet, abort received - this sends an abort to the RecordProcessor - but it&apos;s essentially useless since it&apos;s not propagated to the operator (which hasn&apos;t been setup yet)&lt;/p&gt;

&lt;p&gt;Uploading a patch shortly to resolve this.&lt;/p&gt;</comment>
                            <comment id="15327672" author="sseth" created="Mon, 13 Jun 2016 16:17:34 +0000"  >&lt;p&gt;Patch to fix the issue mentioned below.&lt;/p&gt;

&lt;p&gt;I&apos;ve left some TODOs in the code, which will likely be fixed in subsequent jiras. Need information from someone more familiar with the code. (Some of the comments read TODO: reviewer - those specifically need more info, ideally on RB)&lt;/p&gt;

&lt;p&gt;Any operation which can block - e.g. processorContext.waitTillReady within the hive codebase has the potential to lead to problems like this. To be fixed in subsequent jiras. Some have been identified in the patch.&lt;/p&gt;

&lt;p&gt;cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=prasanth_j&quot; class=&quot;user-hover&quot; rel=&quot;prasanth_j&quot;&gt;Prasanth Jayachandran&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sershe&quot; class=&quot;user-hover&quot; rel=&quot;sershe&quot;&gt;Sergey Shelukhin&lt;/a&gt;&lt;/p&gt;
</comment>
                            <comment id="15328067" author="sershe" created="Mon, 13 Jun 2016 19:56:14 +0000"  >&lt;p&gt;I think  TODO: Reviewer:  things need to be investigated (and other TODOs may need to be fixed). I don&apos;t have exact answers to most of them.&lt;br/&gt;
Dummy ops are used for mapjoin. Prasanth may know more about merge. The global map does not need to be cleaned up explicitly; you can check the existing cleanup, as far as I can tell this patch wouldn&apos;t interfere with it.&lt;/p&gt;

&lt;p&gt;Overall, I think we should be able to interrupt the execution with interrupt exception, so I am not sure why some comments say that having a blocking op is a problem - shouldn&apos;t an interrupt there abort properly? Abort flag would only be an optimization then. The only problem are other library calls that can swallow interrupt exceptions... as long as abort flag is checked after those it should be alright. Also we should file JIRAs to fix the code if these are Hadoop libraries/components. At the very least they should restore the interrupt flag. There should be not retries on interrupts, etc.&lt;/p&gt;</comment>
                            <comment id="15329052" author="sseth" created="Tue, 14 Jun 2016 07:59:44 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hagleitn&quot; class=&quot;user-hover&quot; rel=&quot;hagleitn&quot;&gt;Gunther Hagleitner&lt;/a&gt; - mind taking a look at the patch, and providing some more information on dummyOps / mergeOps.&lt;/p&gt;

&lt;p&gt;An interrupt would ideally stop an opeartion - however it&apos;s really a suggestion, and we cannot rely on libraries to handle them correctly. I suspect most of Hadoop has issues here. An HDFS jira was created and has already been fixed.&lt;br/&gt;
The abort flag serves to protect against operations which reset the interrupt status - which is where the avoid blocking op comment comes in. In most cases we&apos;ll be OK, with an abort flag check.&lt;/p&gt;</comment>
                            <comment id="15332229" author="sseth" created="Wed, 15 Jun 2016 18:09:46 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sershe&quot; class=&quot;user-hover&quot; rel=&quot;sershe&quot;&gt;Sergey Shelukhin&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=prasanth_j&quot; class=&quot;user-hover&quot; rel=&quot;prasanth_j&quot;&gt;Prasanth Jayachandran&lt;/a&gt; - is the patch good to go in (with the comments changed to point to new jiras which will be created). I think there are additional cases which need to be addressed; they can be addressed in a different jira. This one, in it&apos;s current form, does get rid of queries getting stuck on hash table creation.&lt;/p&gt;</comment>
                            <comment id="15334987" author="sershe" created="Thu, 16 Jun 2016 23:43:14 +0000"  >&lt;p&gt;looks good to me with comments addressed...&lt;/p&gt;</comment>
                            <comment id="15335050" author="sseth" created="Fri, 17 Jun 2016 00:15:12 +0000"  >&lt;p&gt;Which ones specifically ?&lt;br/&gt;
My intent was to fix the rest of the TODOs left in the code as follow ups (after getting more clarity, and some more support from Tez). Fix one known problem for now. Create new jiras to fix others.&lt;/p&gt;</comment>
                            <comment id="15335111" author="prasanth_j" created="Fri, 17 Jun 2016 00:47:28 +0000"  >&lt;p&gt;Can you make the TODOs as follow up jiras? nit: &quot;KKK&quot; can be removed. Also &quot;Reviewer&quot; comments.&lt;br/&gt;
Other than that LGTM +1&lt;/p&gt;</comment>
                            <comment id="15335193" author="sseth" created="Fri, 17 Jun 2016 01:50:40 +0000"  >&lt;p&gt;Updated patch with comments cleaned up and converted to TODOs - to be addressed in &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-14042&quot; title=&quot;Potential improvements to abort task handling - tez/llap&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-14042&quot;&gt;HIVE-14042&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="15337250" author="sershe" created="Fri, 17 Jun 2016 23:56:04 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="15337469" author="hiveqa" created="Sat, 18 Jun 2016 03:03:11 +0000"  >

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12811266/HIVE-14003.02.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12811266/HIVE-14003.02.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to no test(s) being added or modified.&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 11 failed/errored test(s), 10220 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;TestMiniTezCliDriver-join1.q-mapjoin_decimal.q-vectorized_distinct_gby.q-and-12-more - did not produce a TEST-*.xml file
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_acid_globallimit
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_constantPropagateForSubQuery
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_list_bucket_dml_13
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_repair
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_stats_list_bucket
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_subquery_multiinsert
org.apache.hadoop.hive.cli.TestMiniSparkOnYarnCliDriver.testCliDriver_index_bitmap3
org.apache.hadoop.hive.cli.TestMinimrCliDriver.testCliDriver_table_nonprintable
org.apache.hadoop.hive.ql.metadata.TestHiveMetaStoreChecker.testPartitionsCheck
org.apache.hadoop.hive.ql.metadata.TestHiveMetaStoreChecker.testTableCheck
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-MASTER-Build/158/testReport&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-MASTER-Build/158/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-MASTER-Build/158/console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-MASTER-Build/158/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://ec2-50-18-27-0.us-west-1.compute.amazonaws.com/logs/PreCommit-HIVE-MASTER-Build-158/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://ec2-50-18-27-0.us-west-1.compute.amazonaws.com/logs/PreCommit-HIVE-MASTER-Build-158/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 11 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12811266 - PreCommit-HIVE-MASTER-Build&lt;/p&gt;</comment>
                            <comment id="15338735" author="sseth" created="Sun, 19 Jun 2016 19:28:29 +0000"  >&lt;p&gt;Thanks for the reviews &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=prasanth_j&quot; class=&quot;user-hover&quot; rel=&quot;prasanth_j&quot;&gt;Prasanth Jayachandran&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sershe&quot; class=&quot;user-hover&quot; rel=&quot;sershe&quot;&gt;Sergey Shelukhin&lt;/a&gt;. Test failures are unrelated. Committing.&lt;/p&gt;

&lt;p&gt;Wonder why the test failures are up to 10 now. It was down to 4-5 a while ago.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12809880" name="HIVE-14003.01.patch" size="19474" author="sseth" created="Mon, 13 Jun 2016 16:17:34 +0000"/>
                            <attachment id="12811266" name="HIVE-14003.02.patch" size="18087" author="sseth" created="Fri, 17 Jun 2016 01:50:40 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 13 Jun 2016 16:15:35 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            23 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2zdxz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310320" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Target Version/s</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue>12335838</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>