<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun Dec 04 00:17:15 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HIVE-1624/HIVE-1624.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HIVE-1624] Patch to allows scripts in S3 location</title>
                <link>https://issues.apache.org/jira/browse/HIVE-1624</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;I want to submit a patch which allows user to run scripts located in S3.&lt;/p&gt;

&lt;p&gt;This patch enables Hive to download the hive scripts located in S3 buckets and execute them. This saves users the effort of copying scripts to HDFS before executing them.&lt;/p&gt;

&lt;p&gt;Thanks&lt;br/&gt;
Vaibhav&lt;/p&gt;</description>
                <environment></environment>
        <key id="12473631">HIVE-1624</key>
            <summary>Patch to allows scripts in S3 location</summary>
                <type id="2" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/newfeature.png">New Feature</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="vaggarw">Vaibhav Aggarwal</assignee>
                                    <reporter username="vaggarw">Vaibhav Aggarwal</reporter>
                        <labels>
                    </labels>
                <created>Wed, 8 Sep 2010 22:26:01 +0000</created>
                <updated>Fri, 16 Dec 2011 23:59:22 +0000</updated>
                            <resolved>Thu, 30 Sep 2010 21:35:05 +0000</resolved>
                                                    <fixVersion>0.7.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12908729" author="he yongqiang" created="Mon, 13 Sep 2010 11:38:48 +0000"  >&lt;p&gt;S3 -&amp;gt; client -&amp;gt; cluster maybe better than directly downloading the script from S3 to TaskTracker node.&lt;br/&gt;
There may be thousands of concurrent downloading request to S3 for downloading a script. (I agree that the script can be cached in local machine, but right now hive does not do any cache clean up).&lt;br/&gt;
S3 -&amp;gt; client -&amp;gt; cluster will be able to use hadoop distributed cache.&lt;/p&gt;</comment>
                            <comment id="12913124" author="vaggarw" created="Tue, 21 Sep 2010 17:57:45 +0000"  >&lt;p&gt;Thanks for looking at this. I will experiment with the suggested approach today.&lt;/p&gt;</comment>
                            <comment id="12913875" author="vaggarw" created="Thu, 23 Sep 2010 01:24:48 +0000"  >&lt;p&gt;Hi&lt;/p&gt;

&lt;p&gt;I have attached a new patch.&lt;br/&gt;
It uses the add_resource functionality to make the script available to all nodes instead of downloading the script on each node.&lt;/p&gt;

&lt;p&gt;Thanks&lt;br/&gt;
Vaibhav&lt;/p&gt;</comment>
                            <comment id="12913878" author="he yongqiang" created="Thu, 23 Sep 2010 01:47:37 +0000"  >&lt;p&gt;looks good basically. need to remove some unneeded logging information&lt;/p&gt;

&lt;p&gt;one main problem here is to determine when to download file. We can not simply try downloading file when can not be found in local. &lt;br/&gt;
Sometimes scripts exist in some remote dir that the hadoop cluster nodes can access but the client can not.&lt;/p&gt;</comment>
                            <comment id="12913881" author="vaggarw" created="Thu, 23 Sep 2010 02:12:18 +0000"  >&lt;p&gt;I will remove some of the unnecessary log statements.&lt;/p&gt;

&lt;p&gt;The patch consists of two parts:&lt;/p&gt;

&lt;p&gt;1. It extends the add file/jar functionality to download remote files. I think it makes sense as it is as the user is expected to have access to the file from the client location. In case that is not true, the patch will fail with an IOException which will notify the user of the problem appropriately.&lt;/p&gt;

&lt;p&gt;2. It eliminates the need for user to run an extra add file command. I think that the current norm in Hive is for the user to execute the &apos;add file ....&apos; command to add a resource before using it in the transform function. This patch allows user to directly specify a resource instead of doing it in two steps.&lt;/p&gt;

&lt;p&gt;The patch does not attempt to address the case when the script exists on a remote location not accessible to the client.&lt;/p&gt;

&lt;p&gt;Please let me know what you think.&lt;/p&gt;

&lt;p&gt;Thanks&lt;br/&gt;
Vaibhav&lt;/p&gt;</comment>
                            <comment id="12913895" author="he yongqiang" created="Thu, 23 Sep 2010 04:00:09 +0000"  >&lt;p&gt;For 2, sometimes it is actually a common case. For example, User can use php but no need to have php program in local. We can add some simple rule for downloading resource files, such as starts with s3 schema in this case.  &lt;/p&gt;</comment>
                            <comment id="12914149" author="vaggarw" created="Thu, 23 Sep 2010 18:34:18 +0000"  >&lt;p&gt;So current patch matches the &quot;&amp;lt;word&amp;gt;://&amp;lt;anything&amp;gt;&quot; in file path before downloading the file.&lt;br/&gt;
Should I modify it to be &quot;hdfs://&amp;lt;anything&amp;gt; || s3://&amp;lt;anything&amp;gt;&quot; like path?&lt;br/&gt;
The first one is a more generic case to match any file system.&lt;br/&gt;
I can implement it either ways.&lt;br/&gt;
Please let me know what you prefer.&lt;/p&gt;

&lt;p&gt;Thanks&lt;br/&gt;
Vaibhav&lt;/p&gt;</comment>
                            <comment id="12914176" author="he yongqiang" created="Thu, 23 Sep 2010 19:17:08 +0000"  >&lt;p&gt;&amp;gt;&amp;gt;Should I modify it to be &quot;hdfs://&amp;lt;anything&amp;gt; || s3://&amp;lt;anything&amp;gt;&quot; like path?&lt;br/&gt;
Yes. That will be a great start. We can add more if needed in future.&lt;/p&gt;

&lt;p&gt;Also please make sure if a program, neither hdfs nor s3 , can not be found locally, the query should not fail in semantic analyzer. Otherwise, it may break a lot of existing queries.&lt;/p&gt;</comment>
                            <comment id="12914314" author="vaggarw" created="Fri, 24 Sep 2010 01:53:44 +0000"  >&lt;p&gt;Hi&lt;/p&gt;

&lt;p&gt;I made the changes you had suggested.&lt;br/&gt;
Please review the patch.&lt;/p&gt;

&lt;p&gt;Thanks&lt;br/&gt;
Vaibhav&lt;/p&gt;</comment>
                            <comment id="12915391" author="he yongqiang" created="Mon, 27 Sep 2010 17:50:52 +0000"  >&lt;p&gt;Great. some nitpick, sorry for not posting them in the previous comment. &lt;br/&gt;
1) It seems there is still one logging code &quot;+    getConsole().printInfo(&quot;Testing &quot; + value);&quot;&lt;br/&gt;
2) Also can you add one junit test for DosToUnix?&lt;br/&gt;
3) Do you think it maybe better to move fetchFilesNotInLocalFilesystem to SessionState?&lt;/p&gt;</comment>
                            <comment id="12915926" author="vaggarw" created="Tue, 28 Sep 2010 21:16:15 +0000"  >&lt;p&gt;Hi&lt;/p&gt;

&lt;p&gt;I have attached a new patch.&lt;br/&gt;
I have added unit tests for DosToUnix and removede the logging code.&lt;br/&gt;
I still kept the fetchFilesNotInLocalFilesystem in SemanticAnalyzer as I felt that it was not shared code and also depended on calls to getScriptProgName(). I felt that SessionState calling into SemanticAnalyzer might not be a good idea.&lt;/p&gt;

&lt;p&gt;Thanks&lt;br/&gt;
Vaibhav&lt;/p&gt;</comment>
                            <comment id="12915942" author="he yongqiang" created="Tue, 28 Sep 2010 22:15:46 +0000"  >&lt;p&gt;Mostly look good. &lt;/p&gt;

&lt;p&gt;In your testcase, can you put the new script file in&lt;br/&gt;
new Path(System.getProperty(&quot;test.data.dir&quot;, &quot;.&quot;) + &quot;file name&quot;) ?&lt;/p&gt;

&lt;p&gt;By move fetchFilesNotInLocalFilesystem to SessionState, you can keep getScriptProgName() ect in SemanticAnalyer by changing fetchFilesNotInLocalFilesystem&apos;s arguments to pass in the command etc. I am also ok with current way.&lt;/p&gt;</comment>
                            <comment id="12915995" author="vaggarw" created="Wed, 29 Sep 2010 02:17:14 +0000"  >&lt;p&gt;Made the change.&lt;/p&gt;

&lt;p&gt;Thanks&lt;br/&gt;
Vaibhav&lt;/p&gt;</comment>
                            <comment id="12916242" author="he yongqiang" created="Wed, 29 Sep 2010 19:12:44 +0000"  >&lt;p&gt;+1 running tests&lt;/p&gt;</comment>
                            <comment id="12916688" author="he yongqiang" created="Thu, 30 Sep 2010 21:35:05 +0000"  >&lt;p&gt;I just committed! Thanks Vaibhav Aggarwal!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12455979">HIVE-1157</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12455337" name="HIVE-1624-2.patch" size="11185" author="vaggarw" created="Thu, 23 Sep 2010 01:22:53 +0000"/>
                            <attachment id="12455457" name="HIVE-1624-3.patch" size="11224" author="vaggarw" created="Fri, 24 Sep 2010 01:52:38 +0000"/>
                            <attachment id="12455874" name="HIVE-1624-4.patch" size="15046" author="vaggarw" created="Tue, 28 Sep 2010 21:14:12 +0000"/>
                            <attachment id="12455894" name="HIVE-1624-5.patch" size="15047" author="vaggarw" created="Wed, 29 Sep 2010 02:16:55 +0000"/>
                            <attachment id="12454167" name="HIVE-1624.patch" size="9956" author="vaggarw" created="Wed, 8 Sep 2010 22:28:02 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 13 Sep 2010 11:38:48 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>72807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 10 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0lg2f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>123253</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>