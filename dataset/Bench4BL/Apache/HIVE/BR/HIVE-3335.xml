<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sat Dec 03 23:33:44 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HIVE-3335/HIVE-3335.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HIVE-3335] Thousand of CLOSE_WAIT socket when we using SymbolicInputFormat</title>
                <link>https://issues.apache.org/jira/browse/HIVE-3335</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;Procedure for reproduction:&lt;br/&gt;
 1. Set up hadoop&lt;br/&gt;
 2. Prepare data file and link.txt:&lt;br/&gt;
    data:&lt;br/&gt;
      $ hadoop fs -cat /path/to/data/2012-07-01/20120701.csv&lt;br/&gt;
      1, 20120701 00:00:00&lt;br/&gt;
      2, 20120701 00:00:01&lt;br/&gt;
      3, 20120701 01:12:45&lt;br/&gt;
    link.txt&lt;br/&gt;
      $ cat link.txt&lt;br/&gt;
       /path/to/data/2012-07-01//*&lt;/p&gt;

&lt;p&gt; 2. On hive, create table like below:&lt;br/&gt;
   CREATE TABLE user_logs(id INT, created_at STRING)&lt;br/&gt;
   row format delimited fields terminated by &apos;,&apos; lines terminated by &apos;\n&apos;&lt;br/&gt;
   stored as inputformat &apos;org.apache.hadoop.hive.ql.io.SymlinkTextInputFormat&apos;&lt;br/&gt;
   outputformat &apos;org.apache.hadoop.hive.ql.io.HiveIgnoreKeyTextOutputFormat&apos;;&lt;/p&gt;

&lt;p&gt; 3. Put link.txt to /user/hive/warehouse/user_logs&lt;br/&gt;
   $ sudo -u hdfs hadoop fs -put link.txt  /user/hive/warehouse/user_logs&lt;/p&gt;

&lt;p&gt; 4. Open another session(A session), and watch socket,&lt;br/&gt;
   $ netstat -a | grep CLOSE_WAIT&lt;br/&gt;
    tcp        1      0 localhost:48121             localhost:50010&lt;br/&gt;
         CLOSE_WAIT&lt;br/&gt;
    tcp        1      0 localhost:48124             localhost:50010&lt;br/&gt;
         CLOSE_WAIT&lt;br/&gt;
   $&lt;/p&gt;

&lt;p&gt; 5. Return to hive session, execute this,&lt;br/&gt;
   $ select * from user_logs;&lt;/p&gt;

&lt;p&gt; 6. Return to A session, watch socket again,&lt;br/&gt;
   $ netstat -a | grep CLOSE_WAIT&lt;br/&gt;
   tcp        1      0 localhost:48121             localhost:50010&lt;br/&gt;
        CLOSE_WAIT&lt;br/&gt;
   tcp        1      0 localhost:48124             localhost:50010&lt;br/&gt;
        CLOSE_WAIT&lt;br/&gt;
   tcp        1      0 localhost:48166             localhost:50010&lt;br/&gt;
        CLOSE_WAIT&lt;/p&gt;

&lt;p&gt; If you makes any partitions, you&apos;ll watch unclosed socket whose count&lt;br/&gt;
equals partitions by once.&lt;/p&gt;


&lt;p&gt;I think that this problem maybe is caused by this point:&lt;br/&gt;
  At &lt;a href=&quot;https://github.com/apache/hive/blob/trunk/ql/src/java/org/apache/hadoop/hive/ql/io/SymbolicInputFormat.java&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/apache/hive/blob/trunk/ql/src/java/org/apache/hadoop/hive/ql/io/SymbolicInputFormat.java&lt;/a&gt;,&lt;br/&gt;
  line 66. BufferedReader was opened, but it doesn&apos;t closed.&lt;/p&gt;</description>
                <environment>&lt;p&gt; CentOS 5.8 x64&lt;br/&gt;
 CDH3u4&lt;br/&gt;
   hadoop-0.20-0.20.2+923.256-1&lt;br/&gt;
   hadoop-0.20-&lt;/p&gt;
{namenode,secondarynamenode,jobtracker,tasktracker,datanode}
&lt;p&gt;-0.20.2+923.256-1&lt;br/&gt;
   hadoop-0.20-conf-pseudo-0.20.2+923.256-1(but same error was&lt;br/&gt;
occurred on not pseudo env)&lt;br/&gt;
 apache hive-0.8.1(but same error was occurred on hive 0.9)&lt;/p&gt;</environment>
        <key id="12601520">HIVE-3335</key>
            <summary>Thousand of CLOSE_WAIT socket when we using SymbolicInputFormat</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="3">Duplicate</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="showyou">Yuki Yoi</reporter>
                        <labels>
                    </labels>
                <created>Mon, 6 Aug 2012 01:07:21 +0000</created>
                <updated>Fri, 26 Feb 2016 09:13:50 +0000</updated>
                            <resolved>Fri, 26 Feb 2016 09:13:34 +0000</resolved>
                                    <version>0.8.1</version>
                                                    <component>Clients</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                <comments>
                            <comment id="13428987" author="ashutoshc" created="Mon, 6 Aug 2012 06:03:05 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=showyou&quot; class=&quot;user-hover&quot; rel=&quot;showyou&quot;&gt;Yuki Yoi&lt;/a&gt; Your analysis seems correct. Mind submitting a patch for it?&lt;/p&gt;</comment>
                            <comment id="13480932" author="showyou" created="Sun, 21 Oct 2012 09:14:23 +0000"  >&lt;p&gt;A patch of this issue&lt;/p&gt;</comment>
                            <comment id="13480933" author="showyou" created="Sun, 21 Oct 2012 09:17:10 +0000"  >&lt;p&gt;I&apos;m sorry to too late. I attach a patch for this issue.&lt;/p&gt;</comment>
                            <comment id="13481011" author="ashutoshc" created="Sun, 21 Oct 2012 18:17:29 +0000"  >&lt;p&gt;Couple of comments:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;In finally block, instead of &lt;tt&gt;reader.close();&lt;/tt&gt; better is to do &lt;tt&gt;org.apache.hadoop.io.IOUtils.closeStream(reader);&lt;/tt&gt; since reader could be either null or can throw IOException in close(). IOUtils handles both of those cases.&lt;/li&gt;
	&lt;li&gt;Same problem exists even in unit test code of this class, where reader.close() is never invoked, resulting in socket leak. In both tests testAccuracy1() and testAccuracy2() can you add &lt;tt&gt;reader.close()&lt;/tt&gt; I don&apos;t think we need to do full try-catch-block in testcases, since there as soon as exception occurs we want to start unwinding the stack.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15168697" author="qwertymaniac" created="Fri, 26 Feb 2016 09:13:50 +0000"  >&lt;p&gt;This was fixed via &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-3480&quot; title=&quot;&amp;lt;Resource leak&amp;gt;: Fix the file handle leaks in Symbolic &amp;amp; Symlink related input formats.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-3480&quot;&gt;&lt;del&gt;HIVE-3480&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="12608077">HIVE-3480</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12550176" name="HIVE-3335.patch" size="3022" author="showyou" created="Sun, 21 Oct 2012 09:14:23 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 6 Aug 2012 06:03:05 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>250177</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            40 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0aub3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>61183</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>