<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 02 06:18:58 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HIVE-13858/HIVE-13858.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HIVE-13858] LLAP: A preempted task can end up waiting on completeInitialization if some part of the executing code suppressed the interrupt</title>
                <link>https://issues.apache.org/jira/browse/HIVE-13858</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;An interrupt along with a HiveProcessor.abort call is made when attempting to preempt a task.&lt;/p&gt;

&lt;p&gt;In this specific case, the task was in the middle of HDFS IO - which &apos;handled&apos; the interrupt by retrying. As a result the interrupt status on the thread was reset - so instead of skipping the future.get in completeInitialization - the task ended up blocking there.&lt;/p&gt;

&lt;p&gt;End result - a single executor slot permanently blocked in LLAP. Depending on what else is running - this can cause a cluster level deadlock.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12972927">HIVE-13858</key>
            <summary>LLAP: A preempted task can end up waiting on completeInitialization if some part of the executing code suppressed the interrupt</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.png">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="sseth">Siddharth Seth</assignee>
                                    <reporter username="sseth">Siddharth Seth</reporter>
                        <labels>
                            <label>llap</label>
                    </labels>
                <created>Thu, 26 May 2016 01:41:35 +0000</created>
                <updated>Tue, 21 Jun 2016 15:06:03 +0000</updated>
                            <resolved>Wed, 1 Jun 2016 18:09:43 +0000</resolved>
                                    <version>2.0.0</version>
                                    <fixVersion>2.1.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="15301285" author="sseth" created="Thu, 26 May 2016 01:44:18 +0000"  >&lt;p&gt;Patch which should fix this.&lt;/p&gt;

&lt;p&gt;1. It changes a &apos;aborted &amp;amp;&amp;amp; interrupted&apos; check to just say &apos;aborted&apos;&lt;br/&gt;
2. It changes completeInitialization - to do a future.get with a timeout, and check the abort status between these waits.&lt;/p&gt;

&lt;p&gt;cc &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=prasanth_j&quot; class=&quot;user-hover&quot; rel=&quot;prasanth_j&quot;&gt;Prasanth Jayachandran&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sershe&quot; class=&quot;user-hover&quot; rel=&quot;sershe&quot;&gt;Sergey Shelukhin&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15301307" author="prasanth_j" created="Thu, 26 May 2016 02:02:18 +0000"  >&lt;p&gt;Left some comments in RB&lt;/p&gt;</comment>
                            <comment id="15303104" author="sseth" created="Thu, 26 May 2016 22:45:56 +0000"  >&lt;p&gt;Updated patch with review comments addressed.&lt;/p&gt;</comment>
                            <comment id="15303670" author="prasanth_j" created="Fri, 27 May 2016 07:01:26 +0000"  >&lt;p&gt;Looks like RB went down when I was commenting. Adding the comments here&lt;br/&gt;
1) CancellationException seems to be not caught. Is it not expected?&lt;br/&gt;
2) I think we can remove the TODO for throwing HiveException and replace it with InterruptedException. IIRC throwing InterruptedException will also clear the interrupt status flag, so the Thread.interrupted() call is also not required. TezProcessor anyways catches Throwable, so it should be safe to throw InterruptedException.&lt;/p&gt;</comment>
                            <comment id="15304294" author="sseth" created="Fri, 27 May 2016 16:37:18 +0000"  >&lt;p&gt;Updated patch with comments addressed.&lt;/p&gt;

&lt;p&gt;Throwing an InterruptedException does not clear the InterruptStatus (&lt;del&gt;catching it probably does&lt;/del&gt;. Don&apos;t think catching it does anything either.). Going by most recommendations - I&apos;ve removed the code to clear the interrupt status. Also, propagating InterruptedException all the way out of the Hive processor.&lt;/p&gt;</comment>
                            <comment id="15304781" author="prasanth_j" created="Fri, 27 May 2016 21:09:09 +0000"  >&lt;p&gt;LGMT, +1. Pending tests&lt;/p&gt;</comment>
                            <comment id="15308453" author="jcamachorodriguez" created="Tue, 31 May 2016 19:44:26 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sseth&quot; class=&quot;user-hover&quot; rel=&quot;sseth&quot;&gt;Siddharth Seth&lt;/a&gt;, what is the status on this one? I plan to create the first 2.1.0 RC tomorrow and this is marked as Critical. Should it go in and can it be deferred? Thanks&lt;/p&gt;</comment>
                            <comment id="15308553" author="sseth" created="Tue, 31 May 2016 20:20:32 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jcamachorodriguez&quot; class=&quot;user-hover&quot; rel=&quot;jcamachorodriguez&quot;&gt;Jesus Camacho Rodriguez&lt;/a&gt; - this is pending a jenkins run - which is next in line. If it comes back clean, I&apos;ll commit it.&lt;br/&gt;
I would ideally like to include it in 2.1 - given that preemption in LLAP can run into issues without this. If you&apos;re creating the RC tomorrow - I guess it gets documented as a known issue and will get fixed in 2.1.1 or 2.2&lt;/p&gt;</comment>
                            <comment id="15309008" author="hiveqa" created="Wed, 1 Jun 2016 01:17:53 +0000"  >

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12806662/HIVE-13858.03.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12806662/HIVE-13858.03.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to no test(s) being added or modified.&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 12 failed/errored test(s), 10195 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;TestHWISessionManager - did not produce a TEST-*.xml file
TestJdbcWithMiniHA - did not produce a TEST-*.xml file
TestJdbcWithMiniMr - did not produce a TEST-*.xml file
TestOperationLoggingAPIWithTez - did not produce a TEST-*.xml file
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_ivyDownload
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_list_bucket_dml_12
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_stats_list_bucket
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_subquery_multiinsert
org.apache.hadoop.hive.cli.TestMiniSparkOnYarnCliDriver.testCliDriver_constprog_partitioner
org.apache.hadoop.hive.cli.TestMiniSparkOnYarnCliDriver.testCliDriver_index_bitmap3
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver_vector_complex_all
org.apache.hadoop.hive.ql.lockmgr.TestDbTxnManager2.testLocksInSubquery
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://ec2-54-177-240-2.us-west-1.compute.amazonaws.com/job/PreCommit-HIVE-MASTER-Build/472/testReport&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://ec2-54-177-240-2.us-west-1.compute.amazonaws.com/job/PreCommit-HIVE-MASTER-Build/472/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://ec2-54-177-240-2.us-west-1.compute.amazonaws.com/job/PreCommit-HIVE-MASTER-Build/472/console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://ec2-54-177-240-2.us-west-1.compute.amazonaws.com/job/PreCommit-HIVE-MASTER-Build/472/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://ec2-50-18-27-0.us-west-1.compute.amazonaws.com/logs/PreCommit-HIVE-MASTER-Build-472/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://ec2-50-18-27-0.us-west-1.compute.amazonaws.com/logs/PreCommit-HIVE-MASTER-Build-472/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 12 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12806662 - PreCommit-HIVE-MASTER-Build&lt;/p&gt;</comment>
                            <comment id="15310790" author="sseth" created="Wed, 1 Jun 2016 18:07:35 +0000"  >&lt;p&gt;The test failures are unrelated. This particular run took over 4 hours compared to other runs which take 2 hours. However, from the logs it looks like the mvn build started at 23:00, and the test run completed at 01:19 - which is a 2h20m and consistent with other runs. Looks to be a delay in the run actually starting.&lt;/p&gt;

&lt;p&gt;Committing.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12806280" name="HIVE-13858.01.patch" size="3934" author="sseth" created="Thu, 26 May 2016 01:44:18 +0000"/>
                            <attachment id="12806504" name="HIVE-13858.02.patch" size="8152" author="sseth" created="Thu, 26 May 2016 22:45:56 +0000"/>
                            <attachment id="12806662" name="HIVE-13858.03.patch" size="9003" author="sseth" created="Fri, 27 May 2016 16:37:18 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 26 May 2016 02:02:18 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            26 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2yilz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310320" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Target Version/s</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue>12334255</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>