<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 02 05:09:42 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HIVE-13646/HIVE-13646.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HIVE-13646] make hive.optimize.sort.dynamic.partition compatible with ACID tables</title>
                <link>https://issues.apache.org/jira/browse/HIVE-13646</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-8875&quot; title=&quot;hive.optimize.sort.dynamic.partition should be turned off for ACID&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-8875&quot;&gt;&lt;del&gt;HIVE-8875&lt;/del&gt;&lt;/a&gt; disabled hive.optimize.sort.dynamic.partition for ACID queries.&lt;br/&gt;
dynamic inserts are common in ACID and this leaves users with few options if they are seeing OutOfMemory errors due to too many writers.&lt;/p&gt;

&lt;p&gt;hive.optimize.sort.dynamic.partition sorts data by partition col/bucket col/sort col to ensure each reducer only needs 1 writer.&lt;/p&gt;

&lt;p&gt;Acid requires data in each bucket file to be sorted by ROW__ID and thus doesn&apos;t allow end user to determine sorting.&lt;/p&gt;

&lt;p&gt;So we should be able to support hive.optimize.sort.dynamic.partition with&lt;br/&gt;
sort on partition col/bucket col/ROW__ID &lt;/p&gt;</description>
                <environment></environment>
        <key id="12963641">HIVE-13646</key>
            <summary>make hive.optimize.sort.dynamic.partition compatible with ACID tables</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.png">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ekoifman">Eugene Koifman</assignee>
                                    <reporter username="ekoifman">Eugene Koifman</reporter>
                        <labels>
                    </labels>
                <created>Thu, 28 Apr 2016 20:34:09 +0000</created>
                <updated>Tue, 21 Jun 2016 15:10:59 +0000</updated>
                            <resolved>Wed, 4 May 2016 00:12:46 +0000</resolved>
                                    <version>1.0.0</version>
                                    <fixVersion>1.3.0</fixVersion>
                    <fixVersion>2.1.0</fixVersion>
                                    <component>Transactions</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                    <timeoriginalestimate seconds="604800">168h</timeoriginalestimate>
                            <timeestimate seconds="604800">168h</timeestimate>
                                        <comments>
                            <comment id="15268997" author="ekoifman" created="Tue, 3 May 2016 16:31:15 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=wzheng&quot; class=&quot;user-hover&quot; rel=&quot;wzheng&quot;&gt;Wei Zheng&lt;/a&gt; could you review please&lt;/p&gt;</comment>
                            <comment id="15269253" author="wzheng" created="Tue, 3 May 2016 18:12:08 +0000"  >&lt;p&gt;patch looks good. +1&lt;/p&gt;</comment>
                            <comment id="15269820" author="ekoifman" created="Tue, 3 May 2016 23:20:30 +0000"  >&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;
Test Name Duration Age
 org.apache.hadoop.hive.llap.tezplugins.TestLlapTaskSchedulerService.testDelayedLocalityNodeCommErrorImmediateAllocation	10 sec	1
 org.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver_groupby8_map	1 min 5 sec	1
 org.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver_bucketmapjoin_negative3	1.4 sec	1
 org.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver_bucketmapjoin11	0.95 sec	1
 org.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver_cbo_udf_udaf	1 sec	1
 org.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver_skewjoinopt13	1.2 sec	1
 org.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver_join0	0.86 sec	1
 org.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver_avro_joins_native	0.74 sec	1
 org.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver_stats13	0.53 sec	1
 org.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver_groupby10	0.89 sec	1
 org.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver_vector_cast_constant	0.83 sec	1
 org.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver_smb_mapjoin_14	0.9 sec	1
 org.apache.hadoop.hive.llap.daemon.impl.comparator.TestShortestJobFirstComparator.testWaitQueueComparatorWithinDagPriority	5.1 sec	2
 org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_join32	6.2 sec	3
 org.apache.hadoop.hive.cli.TestEncryptedHDFSCliDriver.testCliDriver_encryption_select_read_only_encrypted_tbl	1 min 23 sec	3
 org.apache.hadoop.hive.cli.TestEncryptedHDFSCliDriver.testCliDriver_encryption_insert_partition_dynamic	1 min 16 sec	3
 org.apache.hadoop.hive.llap.tezplugins.TestLlapTaskCommunicator.testFinishableStateUpdateFailure	2.7 sec	6
 org.apache.hadoop.hive.metastore.TestHiveMetaStorePartitionSpecs.testFetchingPartitionsWithDifferentSchemas	3 sec	7
 org.apache.hadoop.hive.metastore.TestHiveMetaStorePartitionSpecs.testAddPartitions	3 sec	7
 org.apache.hadoop.hive.metastore.TestHiveMetaStoreGetMetaConf.testGetMetaConfDefault	10 sec	8
 org.apache.hadoop.hive.cli.TestEncryptedHDFSCliDriver.testCliDriver_encryption_insert_partition_static	2 min 2 sec	9
 org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_selectindate	13 sec	13
 org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_avrocountemptytbl	10 sec	13
 org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_order_null	35 sec	13
 org.apache.hive.hcatalog.api.repl.commands.TestCommands.org.apache.hive.hcatalog.api.repl.commands.TestCommands	20 sec	13
 org.apache.hadoop.hive.cli.TestEncryptedHDFSCliDriver.testCliDriver_encryption_join_with_different_encryption_keys	1 min 49 sec	13
 org.apache.hive.minikdc.TestHiveAuthFactory.testStartTokenManagerForMemoryTokenStore	1.8 sec	13
 org.apache.hive.minikdc.TestHiveAuthFactory.testStartTokenManagerForDBTokenStore	0.38 sec	13
 org.apache.hadoop.hive.metastore.TestHiveMetaStorePartitionSpecs.testGetPartitionSpecs_WithAndWithoutPartitionGrouping	3.4 sec	13
 org.apache.hive.minikdc.TestMiniHiveKdc.testLogin	1 min 32 sec	13
 org.apache.hadoop.hive.cli.TestMiniSparkOnYarnCliDriver.testCliDriver_index_bitmap3	7.2 sec	13
 org.apache.hadoop.hive.cli.TestMinimrCliDriver.org.apache.hadoop.hive.cli.TestMinimrCliDriver	54 sec	13
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;test failures are not related&lt;/p&gt;</comment>
                            <comment id="15269842" author="ekoifman" created="Tue, 3 May 2016 23:33:07 +0000"  >&lt;p&gt;The fix makes Acid queries respect hive.optimize.sort.dynamic.partition setting.  In case of update/delete the query plan is not optimal (it has 2 ReduceSinks which will be addressed in a separate ticket)  but now the user has a choice of whether to use hive.optimize.sort.dynamic.partition.&lt;/p&gt;

&lt;p&gt;thanks Wei for the review&lt;/p&gt;</comment>
                            <comment id="15269900" author="ekoifman" created="Wed, 4 May 2016 00:12:46 +0000"  >&lt;p&gt;committed to branch-1 and master&lt;/p&gt;</comment>
                            <comment id="15272038" author="hiveqa" created="Thu, 5 May 2016 07:48:31 +0000"  >

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12801997/HIVE-13646.2.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12801997/HIVE-13646.2.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to build exiting with an error&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://ec2-54-177-240-2.us-west-1.compute.amazonaws.com/job/PreCommit-HIVE-MASTER-Build/181/testReport&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://ec2-54-177-240-2.us-west-1.compute.amazonaws.com/job/PreCommit-HIVE-MASTER-Build/181/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://ec2-54-177-240-2.us-west-1.compute.amazonaws.com/job/PreCommit-HIVE-MASTER-Build/181/console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://ec2-54-177-240-2.us-west-1.compute.amazonaws.com/job/PreCommit-HIVE-MASTER-Build/181/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://ec2-50-18-27-0.us-west-1.compute.amazonaws.com/logs/PreCommit-HIVE-MASTER-Build-181/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://ec2-50-18-27-0.us-west-1.compute.amazonaws.com/logs/PreCommit-HIVE-MASTER-Build-181/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Tests exited with: NonZeroExitCodeException
Command &apos;bash /data/hive-ptest/working/scratch/source-prep.sh&apos; failed with exit status 1 and output &apos;+ [[ -n /usr/java/jdk1.7.0_45-cloudera ]]
+ export JAVA_HOME=/usr/java/jdk1.7.0_45-cloudera
+ JAVA_HOME=/usr/java/jdk1.7.0_45-cloudera
+ export PATH=/usr/java/jdk1.7.0_45-cloudera/bin/:/usr/lib64/qt-3.3/bin:/usr/local/apache-maven-3.0.5/bin:/usr/java/jdk1.7.0_45-cloudera/bin:/usr/local/apache-ant-1.9.1/bin:/usr/local/bin:/bin:/usr/bin:/usr/local/sbin:/usr/sbin:/sbin:/home/hiveptest/bin
+ PATH=/usr/java/jdk1.7.0_45-cloudera/bin/:/usr/lib64/qt-3.3/bin:/usr/local/apache-maven-3.0.5/bin:/usr/java/jdk1.7.0_45-cloudera/bin:/usr/local/apache-ant-1.9.1/bin:/usr/local/bin:/bin:/usr/bin:/usr/local/sbin:/usr/sbin:/sbin:/home/hiveptest/bin
+ export &apos;ANT_OPTS=-Xmx1g -XX:MaxPermSize=256m &apos;
+ ANT_OPTS=&apos;-Xmx1g -XX:MaxPermSize=256m &apos;
+ export &apos;M2_OPTS=-Xmx1g -XX:MaxPermSize=256m -Dhttp.proxyHost=localhost -Dhttp.proxyPort=3128&apos;
+ M2_OPTS=&apos;-Xmx1g -XX:MaxPermSize=256m -Dhttp.proxyHost=localhost -Dhttp.proxyPort=3128&apos;
+ cd /data/hive-ptest/working/
+ tee /data/hive-ptest/logs/PreCommit-HIVE-MASTER-Build-181/source-prep.txt
+ [[ false == \t\r\u\e ]]
+ mkdir -p maven ivy
+ [[ git = \s\v\n ]]
+ [[ git = \g\i\t ]]
+ [[ -z master ]]
+ [[ -d apache-github-source-source ]]
+ [[ ! -d apache-github-source-source/.git ]]
+ [[ ! -d apache-github-source-source ]]
+ cd apache-github-source-source
+ git fetch origin
From https://github.com/apache/hive
   a88050b..cbebb4d  master     -&amp;gt; origin/master
+ git reset --hard HEAD
HEAD is now at a88050b HIVE-13671: Add PerfLogger to log4j2.properties logger (Prasanth Jayachandran reviewed by Sergey Shelukhin)
+ git clean -f -d
Removing ql/src/test/queries/clientpositive/parquet_array_map_emptynullvals.q
Removing ql/src/test/results/clientpositive/parquet_array_map_emptynullvals.q.out
+ git checkout master
Already on &apos;master&apos;
Your branch is behind &apos;origin/master&apos; by 1 commit, and can be fast-forwarded.
+ git reset --hard origin/master
HEAD is now at cbebb4d HIVE-12837 : Better memory estimation/allocation for hybrid grace hash join during hash table loading (Wei Zheng, reviewed by Vikram Dixit K)
+ git merge --ff-only origin/master
Already up-to-date.
+ git gc
+ patchCommandPath=/data/hive-ptest/working/scratch/smart-apply-patch.sh
+ patchFilePath=/data/hive-ptest/working/scratch/build.patch
+ [[ -f /data/hive-ptest/working/scratch/build.patch ]]
+ chmod +x /data/hive-ptest/working/scratch/smart-apply-patch.sh
+ /data/hive-ptest/working/scratch/smart-apply-patch.sh /data/hive-ptest/working/scratch/build.patch
The patch does not appear to apply with p0, p1, or p2
+ exit 1
&apos;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12801997 - PreCommit-HIVE-MASTER-Build&lt;/p&gt;</comment>
                            <comment id="15297363" author="pxiong" created="Mon, 23 May 2016 23:48:32 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ekoifman&quot; class=&quot;user-hover&quot; rel=&quot;ekoifman&quot;&gt;Eugene Koifman&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=wzheng&quot; class=&quot;user-hover&quot; rel=&quot;wzheng&quot;&gt;Wei Zheng&lt;/a&gt;, thanks for your work to make hive.optimize.sort.dynamic.partition compatible with ACID tables. However, it seems that extra work is needed to make them work together. After I discuss with &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=prasanth_j&quot; class=&quot;user-hover&quot; rel=&quot;prasanth_j&quot;&gt;Prasanth Jayachandran&lt;/a&gt;, this problem sounds serious as we are getting wrong #rows and also wrong total data size which will result in correctness issue and also performance issue. Could you guys take a look at &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-13773&quot; title=&quot;Stats state is not captured correctly in dynpart_sort_optimization_acid.q&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-13773&quot;&gt;HIVE-13773&lt;/a&gt;? I have attached a t.q and a wrong t.q.out and it can be easily repro on master. If I revert the patch in this JIRA, it works fine. Thanks. also ccing &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ashutoshc&quot; class=&quot;user-hover&quot; rel=&quot;ashutoshc&quot;&gt;Ashutosh Chauhan&lt;/a&gt;.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                            <outwardlinks description="blocks">
                                        <issuelink>
            <issuekey id="12855943">HIVE-11550</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is blocked by">
                                        <issuelink>
            <issuekey id="12970226">HIVE-13773</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12801997" name="HIVE-13646.2.patch" size="12064" author="ekoifman" created="Tue, 3 May 2016 17:58:23 +0000"/>
                            <attachment id="12801978" name="HIVE-13646.patch" size="781" author="ekoifman" created="Tue, 3 May 2016 16:31:15 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 3 May 2016 18:12:08 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            27 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2wxg7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310320" key="com.atlassian.jira.plugin.system.customfieldtypes:multiversion">
                        <customfieldname>Target Version/s</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue>12332154</customfieldvalue>
    <customfieldvalue>12334255</customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>