<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 02 04:48:48 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HIVE-14574/HIVE-14574.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HIVE-14574] use consistent hashing for LLAP consistent splits to alleviate impact from cluster changes</title>
                <link>https://issues.apache.org/jira/browse/HIVE-14574</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description></description>
                <environment></environment>
        <key id="12998314">HIVE-14574</key>
            <summary>use consistent hashing for LLAP consistent splits to alleviate impact from cluster changes</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="sershe">Sergey Shelukhin</assignee>
                                    <reporter username="sershe">Sergey Shelukhin</reporter>
                        <labels>
                    </labels>
                <created>Thu, 18 Aug 2016 21:10:22 +0000</created>
                <updated>Wed, 24 Aug 2016 23:51:16 +0000</updated>
                            <resolved>Wed, 24 Aug 2016 23:51:15 +0000</resolved>
                                                    <fixVersion>2.2.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                <comments>
                            <comment id="15427171" author="sershe" created="Thu, 18 Aug 2016 21:18:22 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gopalv&quot; class=&quot;user-hover&quot; rel=&quot;gopalv&quot;&gt;Gopal V&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sseth&quot; class=&quot;user-hover&quot; rel=&quot;sseth&quot;&gt;Siddharth Seth&lt;/a&gt; can you take a look?&lt;/p&gt;</comment>
                            <comment id="15427192" author="gopalv" created="Thu, 18 Aug 2016 21:30:59 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sershe&quot; class=&quot;user-hover&quot; rel=&quot;sershe&quot;&gt;Sergey Shelukhin&lt;/a&gt;: adding to my build for today - minor comment&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
block boundaries and stripe boundaries
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The start offset can vary by 3-5 bytes depending on this too - round that down to a multiple of 8?&lt;/p&gt;</comment>
                            <comment id="15427204" author="sershe" created="Thu, 18 Aug 2016 21:37:06 +0000"  >&lt;p&gt;Hrrm. That sounds like some voodoo magic. Sure...&lt;/p&gt;</comment>
                            <comment id="15427219" author="sseth" created="Thu, 18 Aug 2016 21:49:47 +0000"  >&lt;blockquote&gt;&lt;p&gt;block boundaries and stripe boundaries&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I&apos;n not sure why this comment was even added in there. In terms of the 3 byte difference in ORC - &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=prasanth_j&quot; class=&quot;user-hover&quot; rel=&quot;prasanth_j&quot;&gt;Prasanth Jayachandran&lt;/a&gt; may have fixed that already.&lt;/p&gt;

&lt;p&gt;Will Hashing.consistentHash generate the same values across different JVMs ? I think I had considered this earlier, and finally went with murmur since that does generate the same value across different JVMs / machines.&lt;/p&gt;

&lt;p&gt;Needs new unit tests to validate behaviour. Don&apos;t think there&apos;s any reasons for the existing ones to break.&lt;/p&gt;</comment>
                            <comment id="15427231" author="gopalv" created="Thu, 18 Aug 2016 21:53:13 +0000"  >&lt;p&gt;&amp;gt; In terms of the 3 byte difference in ORC &lt;/p&gt;

&lt;p&gt;That&apos;s the file MAGIC of &quot;ORC&quot; ... 3 byte.&lt;/p&gt;</comment>
                            <comment id="15427233" author="prasanth_j" created="Thu, 18 Aug 2016 21:54:55 +0000"  >&lt;p&gt;The 3 byte difference will still be there based on what split strategy is chosen. If a big file is chosen by ETL split strategy the first split will start from 3 offset. If chosen by BI split strategy the first split will start from 0. My fix was related to inconsistently choosing strategies based on AM cache being on or off. &lt;/p&gt;</comment>
                            <comment id="15427244" author="sseth" created="Thu, 18 Aug 2016 21:58:37 +0000"  >&lt;p&gt;Another thing to consider here is that knownLocations is a list sorted by name (random uuid i think). A new node could show up anywhere in this array. The name generation would need to be fixed as well if doing something like this. That could be as simple as a counter in ZK - but I think a fix is required for something like this to actually work.&lt;/p&gt;</comment>
                            <comment id="15427319" author="sershe" created="Thu, 18 Aug 2016 22:50:35 +0000"  >&lt;p&gt;We can easily achieve unique IDs by taking ZK node name (which is unique and sequential). However, as the new node is re-added to the tail on every restart, it throws everything off.&lt;br/&gt;
What we want conceptually is that restarted nodes go into the same position in the order as the nodes they replaced, but that is difficult to achieve (or impossible, I am not sure we have such a concept with Slider). We can just have sequential numbers in ZK to take, with every registering node fighting for the lowest number. I wonder if there&apos;s already a primitive for that in curator &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; That way the replacement nodes take the place of the nodes that died, most of the time, and leave the running ones undisturbed for most of the time.&lt;br/&gt;
We can also assume we usually restart in the same place and order by the first time there was LLAP on that particular node for that cluster, then by name. &lt;/p&gt;</comment>
                            <comment id="15427451" author="sershe" created="Fri, 19 Aug 2016 01:23:12 +0000"  >&lt;p&gt;Added test and naming... this is the most over-engineered test ever. The number trends to more reasonable with more splits, strangely enough &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;br/&gt;
I think we can make a separate jira for more the machine accounting described above.&lt;/p&gt;</comment>
                            <comment id="15427543" author="hiveqa" created="Fri, 19 Aug 2016 03:17:44 +0000"  >

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12824479/HIVE-14574.01.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12824479/HIVE-14574.01.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;SUCCESS:&lt;/font&gt; +1 due to 1 test(s) being added or modified.&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 7 failed/errored test(s), 10443 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver[explainuser_1]
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver[explainuser_2]
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver[load_dyn_part1]
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver[transform_ppr1]
org.apache.hive.beeline.TestBeeLineWithArgs.testEmbeddedBeelineOutputs
org.apache.hive.jdbc.TestJdbcWithMiniHS2.testSelectThriftSerializeInTasks
org.apache.hive.service.cli.operation.TestOperationLoggingLayout.testSwitchLogLayout
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-MASTER-Build/933/testReport&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-MASTER-Build/933/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-MASTER-Build/933/console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-MASTER-Build/933/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://ec2-204-236-174-241.us-west-1.compute.amazonaws.com/logs/PreCommit-HIVE-MASTER-Build-933/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://ec2-204-236-174-241.us-west-1.compute.amazonaws.com/logs/PreCommit-HIVE-MASTER-Build-933/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 7 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12824479 - PreCommit-HIVE-MASTER-Build&lt;/p&gt;</comment>
                            <comment id="15429150" author="prasanth_j" created="Sat, 20 Aug 2016 01:48:01 +0000"  >&lt;p&gt;Can worker identity be same across different llap clusters using same zk (under different namespaces)?&lt;/p&gt;</comment>
                            <comment id="15429151" author="sershe" created="Sat, 20 Aug 2016 01:49:15 +0000"  >&lt;p&gt;Yes, in this patch. Why?&lt;/p&gt;</comment>
                            <comment id="15431823" author="sershe" created="Tue, 23 Aug 2016 00:02:51 +0000"  >&lt;p&gt;ping?&lt;/p&gt;</comment>
                            <comment id="15431857" author="gopalv" created="Tue, 23 Aug 2016 00:22:54 +0000"  >&lt;p&gt;Why remove UNIQUE_IDENTIFIER UUID? That was for debugging purposes.&lt;/p&gt;</comment>
                            <comment id="15431860" author="sershe" created="Tue, 23 Aug 2016 00:27:36 +0000"  >&lt;p&gt;This patch actually breaks unique Ids cause it is no longer propagated to clients... I&apos;m fixing this in the other JIRA and may just resolve this as dup of that, or port it back into this patch.&lt;br/&gt;
The reason is that worker-xxxxx is also unique (for debug purposes too) so there&apos;s no point in the guid. Is there?&lt;/p&gt;</comment>
                            <comment id="15431864" author="gopalv" created="Tue, 23 Aug 2016 00:29:47 +0000"  >&lt;p&gt;No, because of network splits to ZK - the only way to know a process came back from a GC pause is to see a UUID disappear and come back.&lt;/p&gt;</comment>
                            <comment id="15431925" author="sershe" created="Tue, 23 Aug 2016 01:19:42 +0000"  >&lt;p&gt;Undid the guid-to-path change. I think the unique worker-... node name is sufficient (and actually more helpful &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;) but it doesn&apos;t really matter, and not in the scope of this patch anyway&lt;/p&gt;</comment>
                            <comment id="15432287" author="hiveqa" created="Tue, 23 Aug 2016 07:24:30 +0000"  >

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12824961/HIVE-14574.02.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12824961/HIVE-14574.02.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;SUCCESS:&lt;/font&gt; +1 due to 1 test(s) being added or modified.&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 6 failed/errored test(s), 10473 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[acid_mapjoin]
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver[explainuser_1]
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver[explainuser_2]
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver[load_dyn_part1]
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver[transform_ppr1]
org.apache.hive.service.cli.operation.TestOperationLoggingLayout.testSwitchLogLayout
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-MASTER-Build/961/testReport&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-MASTER-Build/961/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-MASTER-Build/961/console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-MASTER-Build/961/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://ec2-204-236-174-241.us-west-1.compute.amazonaws.com/logs/PreCommit-HIVE-MASTER-Build-961/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://ec2-204-236-174-241.us-west-1.compute.amazonaws.com/logs/PreCommit-HIVE-MASTER-Build-961/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 6 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12824961 - PreCommit-HIVE-MASTER-Build&lt;/p&gt;</comment>
                            <comment id="15435541" author="sershe" created="Wed, 24 Aug 2016 19:46:41 +0000"  >&lt;p&gt;ping again? &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="15435593" author="prasanth_j" created="Wed, 24 Aug 2016 20:13:32 +0000"  >&lt;p&gt;lgtm, +1&lt;/p&gt;</comment>
                            <comment id="15435961" author="sershe" created="Wed, 24 Aug 2016 23:51:16 +0000"  >&lt;p&gt;Committed to master. Thanks for the review!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12824479" name="HIVE-14574.01.patch" size="10329" author="sershe" created="Fri, 19 Aug 2016 01:23:12 +0000"/>
                            <attachment id="12824961" name="HIVE-14574.02.patch" size="8040" author="sershe" created="Tue, 23 Aug 2016 01:19:42 +0000"/>
                            <attachment id="12824442" name="HIVE-14574.patch" size="2916" author="sershe" created="Thu, 18 Aug 2016 21:18:22 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 18 Aug 2016 21:30:59 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i32hsn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>