<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sat Dec 03 22:45:17 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HIVE-10474/HIVE-10474.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HIVE-10474] LLAP: investigate why TPCH Q1 1k is slow</title>
                <link>https://issues.apache.org/jira/browse/HIVE-10474</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;While most queries run faster in LLAP than just Tez with container reuse, TPCH Q1 is much slower.&lt;br/&gt;
On my run, on tez with container reuse (current default LLAP configuration but mode == container and no daemons running)  runs 2-6 (out of 6 consecutive runs in the same session) finished in 25.5sec average; with 16 LLAP daemons in default config the average was 35.5sec; same w/o IO elevator (to rule out its impact) it took 59.7sec w/strange distribution (later runs were slower than earlier runs, still, fastest run was 49.5sec).&lt;/p&gt;

&lt;p&gt;So excluding IO elevator it&apos;s more than 2x degradation.&lt;/p&gt;

&lt;p&gt;We need to figure out why this is happening. Is it just slot discrepancy? Regardless, this needs to be addressed.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12823603">HIVE-10474</key>
            <summary>LLAP: investigate why TPCH Q1 1k is slow</summary>
                <type id="7" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/subtask_alternate.png">Sub-task</type>
                            <parent id="12738189">HIVE-7926</parent>
                                    <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="3">Duplicate</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="sershe">Sergey Shelukhin</reporter>
                        <labels>
                    </labels>
                <created>Thu, 23 Apr 2015 23:16:22 +0000</created>
                <updated>Thu, 17 Dec 2015 09:40:07 +0000</updated>
                            <resolved>Wed, 20 May 2015 23:08:05 +0000</resolved>
                                                                    <component>llap</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="14510047" author="sershe" created="Thu, 23 Apr 2015 23:19:20 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hagleitn&quot; class=&quot;user-hover&quot; rel=&quot;hagleitn&quot;&gt;Gunther Hagleitner&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sseth&quot; class=&quot;user-hover&quot; rel=&quot;sseth&quot;&gt;Siddharth Seth&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gopalv&quot; class=&quot;user-hover&quot; rel=&quot;gopalv&quot;&gt;Gopal V&lt;/a&gt; fyi&lt;/p&gt;</comment>
                            <comment id="14511235" author="gopalv" created="Fri, 24 Apr 2015 15:34:13 +0000"  >&lt;p&gt;I restored the &lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-11772&quot; title=&quot;RPC Invoker relies on static ClientCache which has synchronized(this) blocks&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-11772&quot;&gt;&lt;del&gt;HADOOP-11772&lt;/del&gt;&lt;/a&gt; fix on the cluster and re-ran this.&lt;/p&gt;

&lt;p&gt;The GC pressure has gone way up since I tested this last - 20-25 full collections every minute.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/12727938/12727938_llap-gc-pauses.png&quot; align=&quot;absmiddle&quot; border=&quot;0&quot; /&gt;&lt;/p&gt;

&lt;p&gt;something&apos;s changed that made the tenured generation huge recently - the daemon slows down as you keep using it. This looks like a recent regression in perf.&lt;/p&gt;</comment>
                            <comment id="14511244" author="sershe" created="Fri, 24 Apr 2015 15:39:30 +0000"  >&lt;p&gt;IO enabled or not?&lt;/p&gt;</comment>
                            <comment id="14511255" author="gopalv" created="Fri, 24 Apr 2015 15:48:09 +0000"  >&lt;p&gt;IO is enabled - this is not a map-join so it is not the hashtable cache that&apos;s accumulating across queries.&lt;/p&gt;</comment>
                            <comment id="14511260" author="gopalv" created="Fri, 24 Apr 2015 15:53:01 +0000"  >&lt;p&gt;I should be able to get a memory dump on the cluster, but my internet connection is too slow for me to copy it to my laptop.&lt;/p&gt;

&lt;p&gt;Let me see if I can analyze from the histograms.&lt;/p&gt;</comment>
                            <comment id="14511281" author="sershe" created="Fri, 24 Apr 2015 16:07:24 +0000"  >&lt;p&gt;When I was running, I only saw this pattern with IO not enabled. Note that each 6-query run is a separate LLAP cluster&lt;/p&gt;</comment>
                            <comment id="14511287" author="gopalv" created="Fri, 24 Apr 2015 16:11:52 +0000"  >&lt;p&gt;Huge numbers of int[] arrays - I was expecting to find a huge number of ColumnVectors or something like that&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
 JVM version is 25.25-b02
   5 &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; Histogram:
   6 
   7 num       #instances    #bytes  &lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt; description
   8 --------------------------------------------------------------------------
   9 1:              70473   227976176       &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;[]
  10 2:              852738  88757176        &lt;span class=&quot;code-object&quot;&gt;char&lt;/span&gt;[]
  11 3:              7152    58638832        &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;[]
  12 4:              30035   22348928        &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[][]
  13 5:              686743  21975776        java.util.Hashtable$Entry
  14 6:              293811  18803904        java.nio.DirectByteBuffer
  15 7:              762767  18306408        java.lang.&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;
  16 8:              219901  14073664        org.apache.hadoop.hive.llap.cache.LlapDataBuffer
  17 9:              37270   13536408        &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt;[]
  18 10:             357189  11430048        java.util.concurrent.ConcurrentHashMap$Node
  19 11:             457895  10989480        java.lang.&lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt;
  20 12:             129347  9312984 org.apache.hadoop.hive.ql.io.orc.OrcProto$ColumnStatistics
  21 13:             141337  8986752 java.lang.&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;[]
  22 14:             316768  7641760 java.lang.&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[]
  23 15:             1481    6373792 java.util.Hashtable$Entry[]
  24 16:             127001  6096048 org.apache.hadoop.hive.ql.io.orc.OrcProto$RowIndexEntry
  25 17:             234784  5634816 java.util.concurrent.ConcurrentSkipListMap$Node
  26 18:             857     4361200 java.util.concurrent.ConcurrentHashMap$Node[]
  27 19:             64053   3586968 org.apache.hadoop.hive.ql.io.orc.OrcProto$DoubleStatistics
  28 20:             221391  3542256 java.util.concurrent.atomic.AtomicInteger
  29 21:             133161  3195864 java.util.ArrayList
  30 22:             112042  2689008 java.util.Collections$UnmodifiableRandomAccessList
  31 23:             109038  2616912 java.util.concurrent.ConcurrentSkipListMap$Index
  32 24:             48730   2339040 org.apache.hadoop.hive.ql.io.orc.OrcProto$StringStatistics
  33 25:             66161   1587864 com.google.protobuf.LiteralByteString
  34 26:             32529   1301160 sun.misc.Cleaner
  35 27:             24668   1184064 org.apache.hadoop.hive.ql.exec.vector.VectorHashKeyWrapper
  36 28:             22467   1078416 org.apache.hadoop.hive.ql.io.orc.RecordReaderImpl$BufferChunk
  37 29:             14850   1069200 java.lang.reflect.Field
  38 30:             32529   1040928 java.nio.DirectByteBuffer$Deallocator
  39 31:             14496   927744  org.apache.hive.com.esotericsoftware.kryo.serializers.UnsafeCacheFields$UnsafeObjectField
  40 32:             516     881544  &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt;[]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14511298" author="sershe" created="Fri, 24 Apr 2015 16:21:21 +0000"  >&lt;p&gt;Is it possible to see w/o IO enabled on &quot;fresh&quot; daemon?&lt;br/&gt;
LlapDataBuffer can be reused (it&apos;s passed between threads), DirectByteBuffer-s may also be reusable to an extent (or we can get read buffers from Allocator).&lt;br/&gt;
Gopal suggested that reuse of objects that will be collected efficiently (are not passed between threads) may actually hurt us. &lt;br/&gt;
There&apos;s way too much protobuf stuff. I wonder if statistics are read and discarded somewhere where they could be cached/reused?&lt;/p&gt;</comment>
                            <comment id="14553298" author="sershe" created="Wed, 20 May 2015 23:08:05 +0000"  >&lt;p&gt;did some investigation, forgot about this jira, will close the other now.&lt;br/&gt;
RPC patch does not significantly change the issue and GC doesn&apos;t explain it either (at least not directly via GC time)&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="12831489">HIVE-10772</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12727938" name="llap-gc-pauses.png" size="24027" author="gopalv" created="Fri, 24 Apr 2015 15:34:13 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 24 Apr 2015 15:34:13 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 28 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2doxr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>