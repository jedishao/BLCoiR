<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 02 06:22:28 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HIVE-14799/HIVE-14799.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HIVE-14799] Query operation are not thread safe during its cancellation</title>
                <link>https://issues.apache.org/jira/browse/HIVE-14799</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;When a query is cancelled either via Beeline (Ctrl-C) or API call TCLIService.Client.CancelOperation, SQLOperation.cancel is invoked in a different thread from that running the query to close/destroy its encapsulated Driver object. Both SQLOperation and Driver are not thread-safe which could sometimes result in Runtime exceptions like NPE. The errors from the running query are not handled properly therefore probably causing some stuffs (files, locks etc) not being cleaned after the query termination.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13006226">HIVE-14799</key>
            <summary>Query operation are not thread safe during its cancellation</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ctang.ma">Chaoyu Tang</assignee>
                                    <reporter username="ctang.ma">Chaoyu Tang</reporter>
                        <labels>
                    </labels>
                <created>Tue, 20 Sep 2016 16:14:46 +0000</created>
                <updated>Sun, 16 Oct 2016 13:53:44 +0000</updated>
                            <resolved>Sun, 16 Oct 2016 13:53:43 +0000</resolved>
                                                    <fixVersion>2.2.0</fixVersion>
                    <fixVersion>2.1.1</fixVersion>
                                    <component>HiveServer2</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>8</watches>
                                                                <comments>
                            <comment id="15549261" author="hiveqa" created="Wed, 5 Oct 2016 16:39:57 +0000"  >

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12831737/HIVE-14799.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12831737/HIVE-14799.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to no test(s) being added or modified.&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 32 failed/errored test(s), 9307 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;161_TestHCatLoader - did not produce a TEST-*.xml file
162_TestHCatStorer - did not produce a TEST-*.xml file
163_UTBatch_hcatalog__hcatalog-pig-adapter_8_tests - did not produce a TEST-*.xml file
169_TestHCatMutableDynamicPartitioned - did not produce a TEST-*.xml file
170_TestHCatDynamicPartitioned - did not produce a TEST-*.xml file
171_TestHCatExternalDynamicPartitioned - did not produce a TEST-*.xml file
172_UTBatch_hcatalog__core_9_tests - did not produce a TEST-*.xml file
174_UTBatch_hcatalog__server-extensions_2_tests - did not produce a TEST-*.xml file
181_TestTxnCommands2WithSplitUpdate - did not produce a TEST-*.xml file
185_TestDbTxnManager2 - did not produce a TEST-*.xml file
196_UTBatch_ql_10_tests - did not produce a TEST-*.xml file
204_TestTxnCommands2WithSplitUpdateAndVectorization - did not produce a TEST-*.xml file
228_UTBatch_itests__hcatalog-unit_6_tests - did not produce a TEST-*.xml file
229_UTBatch_itests__hive-unit-hadoop2_5_tests - did not produce a TEST-*.xml file
243_UTBatch_itests__hive-unit_9_tests - did not produce a TEST-*.xml file
244_TestMetaStoreEventListener - did not produce a TEST-*.xml file
252_TestAuthorizationPreEventListener - did not produce a TEST-*.xml file
253_UTBatch_itests__hive-unit_9_tests - did not produce a TEST-*.xml file
254_TestAcidOnTezWithSplitUpdate - did not produce a TEST-*.xml file
255_TestAcidOnTez - did not produce a TEST-*.xml file
257_TestCompactor - did not produce a TEST-*.xml file
258_UTBatch_itests__hive-unit_9_tests - did not produce a TEST-*.xml file
266_TestHBaseNegativeCliDriver - did not produce a TEST-*.xml file
TestHBaseCliDriver-hbase_handler_snapshot.q-hbase_binary_map_queries_prefix.q-external_table_ppd.q-and-2-more - did not produce a TEST-*.xml file
TestHBaseCliDriver-hbase_joins.q-hbase_ppd_join.q-hbase_binary_map_queries.q-and-2-more - did not produce a TEST-*.xml file
TestHBaseCliDriver-hbase_ppd_key_range.q-hbase_binary_external_table_queries.q-hbase_pushdown.q-and-2-more - did not produce a TEST-*.xml file
TestHBaseCliDriver-hbase_queries.q-hbase_handler_bulk.q-hbase_viewjoins.q-and-2-more - did not produce a TEST-*.xml file
TestHBaseCliDriver-hbase_timestamp_format.q-hbase_custom_key2.q-hbasestats.q-and-2-more - did not produce a TEST-*.xml file
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[acid_mapjoin]
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[ctas]
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[vector_join_part_col_char]
org.apache.hive.jdbc.TestJdbcWithMiniHS2.testAddJarConstructorUnCaching
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/1404/testReport&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/1404/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/1404/console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/1404/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://ec2-204-236-174-241.us-west-1.compute.amazonaws.com/logs/PreCommit-HIVE-Build-1404/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://ec2-204-236-174-241.us-west-1.compute.amazonaws.com/logs/PreCommit-HIVE-Build-1404/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 32 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12831737 - PreCommit-HIVE-Build&lt;/p&gt;</comment>
                            <comment id="15549296" author="ctang.ma" created="Wed, 5 Oct 2016 16:51:36 +0000"  >&lt;p&gt;This patch is going to fix a couple of Driver issues related to the close request from a thread other than the one running the query (e.g. from SQLOperation cancel via Timeout or Ctrl-C):&lt;br/&gt;
1. Driver is not thread safe and usually supports only one thread at time since it has variables like ctx, plan which are not thread protected. But certain special use cases need access the Driver objects from multiply threads. For example, when a query runs in a background thread, driver.close is invoked in another thread by the query timeout (see &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-4924&quot; title=&quot;JDBC: Support query timeout for jdbc&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-4924&quot;&gt;&lt;del&gt;HIVE-4924&lt;/del&gt;&lt;/a&gt;). The close process could nullify the shared variables like ctx which could cause NPE in the other query thread which is using them. This runtime exception is unpredictable and not well handled in the code. Some resources (e.g. locks, files) are left behind and not be cleaned because there are no more available = references to them.  In this patch, I use the waiting in the close which makes sure only one thread uses these variables and the resource cleaning happens after the query finished (or interrupted).&lt;br/&gt;
2. SQLOperation.cancel sends the interrupt signal to the background thread running the query (via backgroundHandle.cancel(true)) but it could not stop that process since there is no code to capture the signal in the process. In another word, current timeout code could not gracefully and promptly stop the query process, though it could eventually stop the process by killing the running tasks (e.g. MapRedTask) via driverContext.shutdown (see &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-5901&quot; title=&quot;Query cancel should stop running MR tasks&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-5901&quot;&gt;&lt;del&gt;HIVE-5901&lt;/del&gt;&lt;/a&gt;). So in the patch,  I added a couple of checkpoints to intercept the interrupt signal either set by close method (a volatile variable) or thread.interrupt. They should be helpful to capture these signals earlier , though not intermediately.&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=vgumashta&quot; class=&quot;user-hover&quot; rel=&quot;vgumashta&quot;&gt;Vaibhav Gumashta&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sershe&quot; class=&quot;user-hover&quot; rel=&quot;sershe&quot;&gt;Sergey Shelukhin&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ychena&quot; class=&quot;user-hover&quot; rel=&quot;ychena&quot;&gt;Yongzhi Chen&lt;/a&gt;, you have done the related work before, could you review the patch to see if it makes sense? Thanks&lt;/p&gt;</comment>
                            <comment id="15549316" author="ctang.ma" created="Wed, 5 Oct 2016 16:57:11 +0000"  >&lt;p&gt;the patch has been uploaded to &lt;a href=&quot;https://reviews.apache.org/r/52559/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/52559/&lt;/a&gt; and requested for review.&lt;/p&gt;</comment>
                            <comment id="15549806" author="sershe" created="Wed, 5 Oct 2016 20:12:10 +0000"  >&lt;p&gt;Hmm.. wouldn&apos;t the thread just get interrupted and die on the next waiting operation?&lt;br/&gt;
Overall I wonder if simple solution is possible where we merely ensure that one thread does the cleanup.&lt;br/&gt;
The states needed are &quot;driver is responsible&quot;, &quot;driver is not responsible&quot;, &quot;driver should cleanup&quot;, &quot;cleanup&quot;.&lt;br/&gt;
The first two are set by driver depending on whether it would handle interrupt from there on.&lt;br/&gt;
If the driver is responsible, the stopping thread can set (atomically) &quot;should cleanup&quot;, interrupt the driver thread via system call and exit (does it have to wait?)&lt;br/&gt;
If the driver is not, the stopping thread can set &quot;cleanup&quot; atomically and do it.&lt;br/&gt;
The driver would have the interrupt and maybe the periodic checks to see when it should clean up. Again it would atomically set state to cleanup and clean up.&lt;br/&gt;
That way only one thread can clean up, and the stopping thread can only do when driver is AWOL.&lt;/p&gt;</comment>
                            <comment id="15550164" author="ctang.ma" created="Wed, 5 Oct 2016 22:36:55 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sershe&quot; class=&quot;user-hover&quot; rel=&quot;sershe&quot;&gt;Sergey Shelukhin&lt;/a&gt; Thanks for looking into the patch, please see the following comments and hope they are helpful:&lt;br/&gt;
1. The query thread could stop at some points like wait, sleep, and throws InterruptedException in response to the interrupt signal, but the only place that so far has such waiting is in DriverContext.pollFinished(), which is almost at the end of query process. We need some checkpoints which can stop the process sooner, especially before some expensive operations.&lt;br/&gt;
2. The driver encapsulated in SQLOperation is kind of stateful and keep its referenced resources in instance variables (ctx, plan, resStream, locks, contextDriver etc). The compile/run releases resources only related itself such as plan, driverContext after the query is processed, but most other resources (ctx, resStream, fetchTask, locks etc) are released by explicitly calling close/destroy in a separate step. The patch does not change the cleaning responsibility of these methods but only coordinates the order of the cleaning. &lt;br/&gt;
The whole cancel process is quite straightforward:&lt;br/&gt;
a) the close process flags to query process and requests for a stop &lt;br/&gt;
b) the query process (run/compile) aborts the checkpoint, rollback and cleans its own used resource (like in a normal case), then signals to the query process to continue&lt;br/&gt;
c) close process continues to clean all resources which it should do in a normal close operation.&lt;br/&gt;
I add the DriverState to facilitate the order coordination. Of course, the way you pointed out is doable, but it looks to me a little complex since we should determine cleaning responsibility and add that to query process (run/compile) which under normal situation it is not responsible for.&lt;br/&gt;
3. As for your comments &quot;interrupt the driver thread via system call and exit (does it have to wait?)&quot;: yes, the running query should stop gracefully by rolling back, cleaning its used resources, returning error status.&lt;/p&gt;</comment>
                            <comment id="15550174" author="ctang.ma" created="Wed, 5 Oct 2016 22:40:23 +0000"  >&lt;p&gt;Attach a new patch which:&lt;br/&gt;
1. fix the issue causing the test failures in precommit build&lt;br/&gt;
2. check the finished thread more frequently (change the sleep time from 1000 ms to 100 ms)&lt;br/&gt;
3. remove the empty spaces&lt;/p&gt;</comment>
                            <comment id="15550182" author="ctang.ma" created="Wed, 5 Oct 2016 22:43:46 +0000"  >&lt;p&gt;oops, I did not notice there were also some comments in RB. I am going to address them.&lt;/p&gt;</comment>
                            <comment id="15550456" author="hiveqa" created="Thu, 6 Oct 2016 00:47:29 +0000"  >

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12831830/HIVE-14799.1.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12831830/HIVE-14799.1.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to no test(s) being added or modified.&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 5 failed/errored test(s), 10657 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[acid_mapjoin]
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[ctas]
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[vector_join_part_col_char]
org.apache.hive.jdbc.TestJdbcWithMiniHS2.testAddJarConstructorUnCaching
org.apache.hive.spark.client.TestSparkClient.testJobSubmission
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/1408/testReport&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/1408/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/1408/console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/1408/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://ec2-204-236-174-241.us-west-1.compute.amazonaws.com/logs/PreCommit-HIVE-Build-1408/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://ec2-204-236-174-241.us-west-1.compute.amazonaws.com/logs/PreCommit-HIVE-Build-1408/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 5 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12831830 - PreCommit-HIVE-Build&lt;/p&gt;</comment>
                            <comment id="15550905" author="ctang.ma" created="Thu, 6 Oct 2016 05:11:58 +0000"  >&lt;p&gt;Revised the patch based on &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sershe&quot; class=&quot;user-hover&quot; rel=&quot;sershe&quot;&gt;Sergey Shelukhin&lt;/a&gt;&apos;s review.&lt;/p&gt;</comment>
                            <comment id="15551537" author="hiveqa" created="Thu, 6 Oct 2016 10:09:10 +0000"  >

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12831889/HIVE-14799.2.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12831889/HIVE-14799.2.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to no test(s) being added or modified.&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 1 failed/errored test(s), 10656 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.hive.jdbc.TestJdbcWithMiniHS2.testAddJarConstructorUnCaching
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/1415/testReport&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/1415/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/1415/console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/1415/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://ec2-204-236-174-241.us-west-1.compute.amazonaws.com/logs/PreCommit-HIVE-Build-1415/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://ec2-204-236-174-241.us-west-1.compute.amazonaws.com/logs/PreCommit-HIVE-Build-1415/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 1 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12831889 - PreCommit-HIVE-Build&lt;/p&gt;</comment>
                            <comment id="15553026" author="sershe" created="Thu, 6 Oct 2016 20:05:01 +0000"  >&lt;p&gt;New patch mostly looks good. I was suggesting we move to the model where only one thread from the driver manages all the resources except before it&apos;s started, but I guess the current model also works.&lt;br/&gt;
There&apos;s a typo in description (&quot;until&quot;)&lt;br/&gt;
+1&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ashutoshc&quot; class=&quot;user-hover&quot; rel=&quot;ashutoshc&quot;&gt;Ashutosh Chauhan&lt;/a&gt; do you also want to take a look?&lt;/p&gt;</comment>
                            <comment id="15560653" author="ctang.ma" created="Sun, 9 Oct 2016 21:27:13 +0000"  >&lt;p&gt;Revised the patch and use the model &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sershe&quot; class=&quot;user-hover&quot; rel=&quot;sershe&quot;&gt;Sergey Shelukhin&lt;/a&gt; suggestged. The close operation will defer the resource releases to the query process if the driver is running (compiling/executing) the query. The resources get released once the query is finished (or interrupted). Otherwise the close releases the driver resource by itself. So there will be no waiting for the close (or cancel) operation. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sershe&quot; class=&quot;user-hover&quot; rel=&quot;sershe&quot;&gt;Sergey Shelukhin&lt;/a&gt; Could you review it? I have also uploaded the new patch to RB  &lt;a href=&quot;https://reviews.apache.org/r/52559/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/52559/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15560773" author="hiveqa" created="Sun, 9 Oct 2016 22:56:31 +0000"  >

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12832379/HIVE-14799.3.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12832379/HIVE-14799.3.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to no test(s) being added or modified.&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 4 failed/errored test(s), 10663 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver[explainanalyze_2]
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver[explainanalyze_3]
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver[explainanalyze_5]
org.apache.hive.jdbc.TestJdbcWithMiniHS2.testAddJarConstructorUnCaching
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/1445/testReport&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/1445/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/1445/console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/1445/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://ec2-204-236-174-241.us-west-1.compute.amazonaws.com/logs/PreCommit-HIVE-Build-1445/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://ec2-204-236-174-241.us-west-1.compute.amazonaws.com/logs/PreCommit-HIVE-Build-1445/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 4 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12832379 - PreCommit-HIVE-Build&lt;/p&gt;</comment>
                            <comment id="15560881" author="ctang.ma" created="Mon, 10 Oct 2016 00:15:35 +0000"  >&lt;p&gt;The tests failed in my local env even without the patch, so I wonder if the patch is related. Reattach for another run&lt;/p&gt;</comment>
                            <comment id="15561022" author="hiveqa" created="Mon, 10 Oct 2016 01:57:38 +0000"  >

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12832386/HIVE-14799.4.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12832386/HIVE-14799.4.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to no test(s) being added or modified.&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 5 failed/errored test(s), 10663 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver[explainanalyze_2]
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver[explainanalyze_3]
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver[explainanalyze_5]
org.apache.hive.jdbc.TestJdbcWithMiniHS2.testAddJarConstructorUnCaching
org.apache.hive.spark.client.TestSparkClient.testJobSubmission
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/1448/testReport&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/1448/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/1448/console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/1448/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://ec2-204-236-174-241.us-west-1.compute.amazonaws.com/logs/PreCommit-HIVE-Build-1448/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://ec2-204-236-174-241.us-west-1.compute.amazonaws.com/logs/PreCommit-HIVE-Build-1448/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 5 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12832386 - PreCommit-HIVE-Build&lt;/p&gt;</comment>
                            <comment id="15561106" author="hiveqa" created="Mon, 10 Oct 2016 02:58:30 +0000"  >

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12832386/HIVE-14799.4.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12832386/HIVE-14799.4.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to no test(s) being added or modified.&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 4 failed/errored test(s), 10663 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver[explainanalyze_2]
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver[explainanalyze_3]
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver[explainanalyze_5]
org.apache.hive.jdbc.TestJdbcWithMiniHS2.testAddJarConstructorUnCaching
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/1449/testReport&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/1449/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/1449/console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/1449/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://ec2-204-236-174-241.us-west-1.compute.amazonaws.com/logs/PreCommit-HIVE-Build-1449/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://ec2-204-236-174-241.us-west-1.compute.amazonaws.com/logs/PreCommit-HIVE-Build-1449/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 4 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12832386 - PreCommit-HIVE-Build&lt;/p&gt;</comment>
                            <comment id="15564075" author="ctang.ma" created="Tue, 11 Oct 2016 01:08:37 +0000"  >&lt;p&gt;Revised the patch to fix the test failures.&lt;/p&gt;</comment>
                            <comment id="15566144" author="ctang.ma" created="Tue, 11 Oct 2016 18:15:23 +0000"  >&lt;p&gt;Reattach patch to kick off the precommit build.&lt;/p&gt;</comment>
                            <comment id="15566736" author="hiveqa" created="Tue, 11 Oct 2016 21:55:56 +0000"  >

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12832731/HIVE-14799.5.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12832731/HIVE-14799.5.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to no test(s) being added or modified.&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 1 failed/errored test(s), 10664 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.hive.jdbc.TestJdbcWithMiniHS2.testAddJarConstructorUnCaching
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/1485/testReport&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/1485/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/1485/console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/1485/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://ec2-204-236-174-241.us-west-1.compute.amazonaws.com/logs/PreCommit-HIVE-Build-1485/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://ec2-204-236-174-241.us-west-1.compute.amazonaws.com/logs/PreCommit-HIVE-Build-1485/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 1 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12832731 - PreCommit-HIVE-Build&lt;/p&gt;</comment>
                            <comment id="15566777" author="ctang.ma" created="Tue, 11 Oct 2016 22:14:02 +0000"  >&lt;p&gt;The failed test is not related. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sershe&quot; class=&quot;user-hover&quot; rel=&quot;sershe&quot;&gt;Sergey Shelukhin&lt;/a&gt; Could you review again the patch using the new model? I have also uploaded the patch to &lt;a href=&quot;https://reviews.apache.org/r/52559/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/52559/&lt;/a&gt; for review. Thanks.&lt;/p&gt;</comment>
                            <comment id="15567210" author="sershe" created="Wed, 12 Oct 2016 01:28:02 +0000"  >&lt;p&gt;Left some comments on RB&lt;/p&gt;</comment>
                            <comment id="15567538" author="ctang.ma" created="Wed, 12 Oct 2016 04:32:49 +0000"  >&lt;p&gt;address the comments from last review. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sershe&quot; class=&quot;user-hover&quot; rel=&quot;sershe&quot;&gt;Sergey Shelukhin&lt;/a&gt;, could you take a look? Thanks&lt;/p&gt;</comment>
                            <comment id="15569254" author="hiveqa" created="Wed, 12 Oct 2016 17:03:32 +0000"  >

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12832818/HIVE-14799.6.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12832818/HIVE-14799.6.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to no test(s) being added or modified.&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 2 failed/errored test(s), 10636 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.hive.service.cli.TestEmbeddedThriftBinaryCLIService.testTaskStatus
org.apache.hive.spark.client.TestSparkClient.testJobSubmission
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/1504/testReport&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/1504/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/1504/console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/1504/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://ec2-204-236-174-241.us-west-1.compute.amazonaws.com/logs/PreCommit-HIVE-Build-1504/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://ec2-204-236-174-241.us-west-1.compute.amazonaws.com/logs/PreCommit-HIVE-Build-1504/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 2 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12832818 - PreCommit-HIVE-Build&lt;/p&gt;</comment>
                            <comment id="15571034" author="hiveqa" created="Thu, 13 Oct 2016 06:36:54 +0000"  >

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12832977/HIVE-14799.6.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12832977/HIVE-14799.6.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to no test(s) being added or modified.&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 4 failed/errored test(s), 10560 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[reloadJar]
org.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver[join30]
org.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver[stats18]
org.apache.hive.spark.client.TestSparkClient.testJobSubmission
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/1520/testReport&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/1520/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/1520/console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/1520/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://ec2-204-236-174-241.us-west-1.compute.amazonaws.com/logs/PreCommit-HIVE-Build-1520/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://ec2-204-236-174-241.us-west-1.compute.amazonaws.com/logs/PreCommit-HIVE-Build-1520/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 4 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12832977 - PreCommit-HIVE-Build&lt;/p&gt;</comment>
                            <comment id="15572287" author="ctang.ma" created="Thu, 13 Oct 2016 15:41:40 +0000"  >&lt;p&gt;The failed tests should not be related to this patch and I am not able to reproduce it in my local env. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sershe&quot; class=&quot;user-hover&quot; rel=&quot;sershe&quot;&gt;Sergey Shelukhin&lt;/a&gt; Could you review the revised patch based on your last review comments? Thanks&lt;/p&gt;</comment>
                            <comment id="15573545" author="ctang.ma" created="Thu, 13 Oct 2016 23:37:21 +0000"  >&lt;p&gt;revised the patch to address an issue raised by &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ychena&quot; class=&quot;user-hover&quot; rel=&quot;ychena&quot;&gt;Yongzhi Chen&lt;/a&gt;. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sershe&quot; class=&quot;user-hover&quot; rel=&quot;sershe&quot;&gt;Sergey Shelukhin&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ychena&quot; class=&quot;user-hover&quot; rel=&quot;ychena&quot;&gt;Yongzhi Chen&lt;/a&gt;, could you review it.&lt;/p&gt;</comment>
                            <comment id="15574273" author="hiveqa" created="Fri, 14 Oct 2016 05:34:26 +0000"  >

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12833239/HIVE-14799.7.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12833239/HIVE-14799.7.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to no test(s) being added or modified.&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 10 failed/errored test(s), 10534 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;TestMiniLlapLocalCliDriver - did not produce a TEST-*.xml file
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[acid_globallimit]
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[order_null]
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[reloadJar]
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[union_fast_stats]
org.apache.hadoop.hive.metastore.TestMetaStoreMetrics.testConnections
org.apache.hive.beeline.TestBeelineArgParsing.testAddLocalJarWithoutAddDriverClazz[0]
org.apache.hive.beeline.TestBeelineArgParsing.testAddLocalJar[0]
org.apache.hive.beeline.TestBeelineArgParsing.testAddLocalJar[1]
org.apache.hive.jdbc.authorization.TestJdbcWithSQLAuthorization.testBlackListedUdfUsage
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/1556/testReport&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/1556/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/1556/console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/1556/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://104.198.109.242/logs/PreCommit-HIVE-Build-1556/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://104.198.109.242/logs/PreCommit-HIVE-Build-1556/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 10 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12833239 - PreCommit-HIVE-Build&lt;/p&gt;</comment>
                            <comment id="15575355" author="ctang.ma" created="Fri, 14 Oct 2016 13:37:00 +0000"  >&lt;p&gt;The failed tests are aged or not related.&lt;/p&gt;</comment>
                            <comment id="15575417" author="ychena" created="Fri, 14 Oct 2016 14:00:17 +0000"  >&lt;p&gt;LGTM +1&lt;/p&gt;</comment>
                            <comment id="15575461" author="ctang.ma" created="Fri, 14 Oct 2016 14:15:09 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ychena&quot; class=&quot;user-hover&quot; rel=&quot;ychena&quot;&gt;Yongzhi Chen&lt;/a&gt;. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sershe&quot; class=&quot;user-hover&quot; rel=&quot;sershe&quot;&gt;Sergey Shelukhin&lt;/a&gt; Please feel free to let me know if you see any further problems, otherwise I am going to commit it tomorrow. Thanks.&lt;/p&gt;</comment>
                            <comment id="15577204" author="sershe" created="Sat, 15 Oct 2016 02:43:04 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="15579106" author="lefty@hortonworks.com" created="Sun, 16 Oct 2016 01:54:32 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ctang.ma&quot; class=&quot;user-hover&quot; rel=&quot;ctang.ma&quot;&gt;Chaoyu Tang&lt;/a&gt; since you&apos;ve committed this to master, please update the status and fix version.  Thanks.&lt;/p&gt;

&lt;p&gt;Commit 1901e3a6ab97c150905c04c591b33b2c640e4b87.&lt;/p&gt;</comment>
                            <comment id="15579146" author="ctang.ma" created="Sun, 16 Oct 2016 02:27:58 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=leftylev&quot; class=&quot;user-hover&quot; rel=&quot;leftylev&quot;&gt;Lefty Leverenz&lt;/a&gt; Thanks for that. I am working on the backport of the patch to 2.1.1, and will update the status/fix version when the JIRA is resolved.&lt;/p&gt;</comment>
                            <comment id="15579154" author="lefty@hortonworks.com" created="Sun, 16 Oct 2016 02:34:22 +0000"  >&lt;p&gt;Oops, sorry about the nudge then.&lt;/p&gt;</comment>
                            <comment id="15579299" author="ctang.ma" created="Sun, 16 Oct 2016 04:26:53 +0000"  >&lt;p&gt;Attach the patch for 2.1.&lt;/p&gt;</comment>
                            <comment id="15580011" author="ctang.ma" created="Sun, 16 Oct 2016 13:53:44 +0000"  >&lt;p&gt;Committed to 2.2.0 and 2.1.1. Thank &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sershe&quot; class=&quot;user-hover&quot; rel=&quot;sershe&quot;&gt;Sergey Shelukhin&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ychena&quot; class=&quot;user-hover&quot; rel=&quot;ychena&quot;&gt;Yongzhi Chen&lt;/a&gt; for review.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12833632" name="HIVE-14799-branch-2.1.patch" size="34324" author="ctang.ma" created="Sun, 16 Oct 2016 04:26:53 +0000"/>
                            <attachment id="12831830" name="HIVE-14799.1.patch" size="34598" author="ctang.ma" created="Wed, 5 Oct 2016 22:40:23 +0000"/>
                            <attachment id="12831889" name="HIVE-14799.2.patch" size="36952" author="ctang.ma" created="Thu, 6 Oct 2016 05:11:58 +0000"/>
                            <attachment id="12832379" name="HIVE-14799.3.patch" size="36368" author="ctang.ma" created="Sun, 9 Oct 2016 21:27:13 +0000"/>
                            <attachment id="12832386" name="HIVE-14799.4.patch" size="36261" author="ctang.ma" created="Mon, 10 Oct 2016 00:38:05 +0000"/>
                            <attachment id="12832731" name="HIVE-14799.5.patch" size="36313" author="ctang.ma" created="Tue, 11 Oct 2016 18:56:58 +0000"/>
                            <attachment id="12832588" name="HIVE-14799.5.patch" size="36313" author="ctang.ma" created="Tue, 11 Oct 2016 01:28:43 +0000"/>
                            <attachment id="12832977" name="HIVE-14799.6.patch" size="36458" author="ctang.ma" created="Wed, 12 Oct 2016 21:11:24 +0000"/>
                            <attachment id="12832818" name="HIVE-14799.6.patch" size="36458" author="ctang.ma" created="Wed, 12 Oct 2016 04:32:49 +0000"/>
                            <attachment id="12833239" name="HIVE-14799.7.patch" size="36875" author="ctang.ma" created="Thu, 13 Oct 2016 23:37:21 +0000"/>
                            <attachment id="12831737" name="HIVE-14799.patch" size="34174" author="ctang.ma" created="Wed, 5 Oct 2016 12:55:58 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>11.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 5 Oct 2016 16:39:57 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i33ukf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>