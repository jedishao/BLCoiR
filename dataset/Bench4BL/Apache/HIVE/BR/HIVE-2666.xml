<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sat Dec 03 00:15:15 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HIVE-2666/HIVE-2666.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HIVE-2666] StackOverflowError when using custom UDF in map join</title>
                <link>https://issues.apache.org/jira/browse/HIVE-2666</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;When a custom UDF is used as part of a join which is converted to a map join, the XMLEncoder enters an infinite loop when serializing the map reduce task for the second time, as part of sending it to be executed.  This results in a stack overflow error.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12535907">HIVE-2666</key>
            <summary>StackOverflowError when using custom UDF in map join</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="kevinwilfong">Kevin Wilfong</assignee>
                                    <reporter username="kevinwilfong">Kevin Wilfong</reporter>
                        <labels>
                    </labels>
                <created>Tue, 20 Dec 2011 21:38:34 +0000</created>
                <updated>Wed, 10 Apr 2013 03:43:22 +0000</updated>
                            <resolved>Wed, 21 Dec 2011 18:23:42 +0000</resolved>
                                                    <fixVersion>0.9.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="13173603" author="phabricator@reviews.facebook.net" created="Tue, 20 Dec 2011 23:21:30 +0000"  >&lt;p&gt;kevinwilfong requested code review of &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2666&quot; title=&quot;StackOverflowError when using custom UDF in map join&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2666&quot;&gt;&lt;del&gt;HIVE-2666&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; StackOverflowError when using custom UDF in map join&quot;.&lt;br/&gt;
Reviewers: JIRA&lt;/p&gt;

&lt;p&gt;  Resource files are now added to the class path as soon as they are added via the CLI.  This fixes the stack overflow error mentioned in the JIRA by ensuring a consistent class loader between serializers and deserializers for the same query.&lt;/p&gt;

&lt;p&gt;  Note that now serdes which contain a static block to register themselves are now registered twice, once when adding the file to the class loader, and once when an instance of the class is created.  Previously, registering a serde twice resulted in an exception, to avoid this, I have downgraded it to a warning.&lt;/p&gt;

&lt;p&gt;  When a custom UDF is used as part of a join which is converted to a map join, the XMLEncoder enters an infinite loop when serializing the map reduce task for the second time, as part of sending it to be executed.  This results in a stack overflow error.&lt;/p&gt;

&lt;p&gt;TEST PLAN&lt;br/&gt;
  EMPTY&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D957&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D957&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;AFFECTED FILES&lt;br/&gt;
  serde/src/java/org/apache/hadoop/hive/serde2/SerDeUtils.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/exec/Utilities.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/processors/AddResourceProcessor.java&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/processors/DeleteResourceProcessor.java&lt;/p&gt;

&lt;p&gt;MANAGE HERALD DIFFERENTIAL RULES&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/herald/view/differential/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/herald/view/differential/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;WHY DID I GET THIS EMAIL?&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/herald/transcript/1989/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/herald/transcript/1989/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Tip: use the X-Herald-Rules header to filter Herald messages in your client.&lt;/p&gt;</comment>
                            <comment id="13173609" author="phabricator@reviews.facebook.net" created="Tue, 20 Dec 2011 23:25:30 +0000"  >&lt;p&gt;heyongqiang has commented on the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2666&quot; title=&quot;StackOverflowError when using custom UDF in map join&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2666&quot;&gt;&lt;del&gt;HIVE-2666&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; StackOverflowError when using custom UDF in map join&quot;.&lt;/p&gt;

&lt;p&gt;INLINE COMMENTS&lt;br/&gt;
  ql/src/java/org/apache/hadoop/hive/ql/processors/DeleteResourceProcessor.java:63 have u verified the delete also work fine?&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D957&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D957&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13173617" author="phabricator@reviews.facebook.net" created="Tue, 20 Dec 2011 23:33:30 +0000"  >&lt;p&gt;kevinwilfong has commented on the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2666&quot; title=&quot;StackOverflowError when using custom UDF in map join&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2666&quot;&gt;&lt;del&gt;HIVE-2666&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; StackOverflowError when using custom UDF in map join&quot;.&lt;/p&gt;

&lt;p&gt;  There is a unit test query in TestNegativeCliDriver called deletejar, which verifies an error is thrown if you add a jar, delete that jar, and then attempt to use a class in the jar.&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D957&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D957&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13173714" author="phabricator@reviews.facebook.net" created="Wed, 21 Dec 2011 01:07:30 +0000"  >&lt;p&gt;heyongqiang has accepted the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2666&quot; title=&quot;StackOverflowError when using custom UDF in map join&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2666&quot;&gt;&lt;del&gt;HIVE-2666&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; StackOverflowError when using custom UDF in map join&quot;.&lt;/p&gt;

&lt;p&gt;  running tests&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D957&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D957&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13174275" author="he yongqiang" created="Wed, 21 Dec 2011 18:23:42 +0000"  >&lt;p&gt;committed, thanks Kevin!&lt;/p&gt;</comment>
                            <comment id="13174279" author="phabricator@reviews.facebook.net" created="Wed, 21 Dec 2011 18:29:30 +0000"  >&lt;p&gt;heyongqiang has committed the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2666&quot; title=&quot;StackOverflowError when using custom UDF in map join&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2666&quot;&gt;&lt;del&gt;HIVE-2666&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; StackOverflowError when using custom UDF in map join&quot;.&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D957&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D957&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;COMMIT&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/rHIVE1221830&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/rHIVE1221830&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13174331" author="hudson" created="Wed, 21 Dec 2011 19:17:37 +0000"  >&lt;p&gt;Integrated in Hive-trunk-h0.23.0 #42 (See &lt;a href=&quot;https://builds.apache.org/job/Hive-trunk-h0.23.0/42/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/Hive-trunk-h0.23.0/42/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2666&quot; title=&quot;StackOverflowError when using custom UDF in map join&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2666&quot;&gt;&lt;del&gt;HIVE-2666&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; StackOverflowError when using custom UDF in map join&lt;br/&gt;
(Kevin Wilfong via Yongqiang He)&lt;/p&gt;

&lt;p&gt;Summary:&lt;br/&gt;
Resource files are now added to the class path as soon as they are added via the&lt;br/&gt;
CLI.  This fixes the stack overflow error mentioned in the JIRA by ensuring a&lt;br/&gt;
consistent class loader between serializers and deserializers for the same&lt;br/&gt;
query.&lt;/p&gt;

&lt;p&gt;Note that now serdes which contain a static block to register themselves are now&lt;br/&gt;
registered twice, once when adding the file to the class loader, and once when&lt;br/&gt;
an instance of the class is created.  Previously, registering a serde twice&lt;br/&gt;
resulted in an exception, to avoid this, I have downgraded it to a warning.&lt;/p&gt;

&lt;p&gt;When a custom UDF is used as part of a join which is converted to a map join,&lt;br/&gt;
the XMLEncoder enters an infinite loop when serializing the map reduce task for&lt;br/&gt;
the second time, as part of sending it to be executed.  This results in a stack&lt;br/&gt;
overflow error.&lt;/p&gt;

&lt;p&gt;Test Plan:&lt;br/&gt;
I ran the unit tests to verify nothing was broken.&lt;/p&gt;

&lt;p&gt;I ran several queries which used custom UDFs and involved a join which was&lt;br/&gt;
converted to a map join.  I verified these completed successfully consistently&lt;/p&gt;

&lt;p&gt;Reviewers: JIRA, heyongqiang&lt;/p&gt;

&lt;p&gt;Reviewed By: heyongqiang&lt;/p&gt;

&lt;p&gt;CC: heyongqiang, kevinwilfong&lt;/p&gt;

&lt;p&gt;Differential Revision: 957&lt;/p&gt;

&lt;p&gt;heyongqiang : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1221830&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1221830&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/Utilities.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/processors/AddResourceProcessor.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/processors/DeleteResourceProcessor.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/serde/src/java/org/apache/hadoop/hive/serde2/SerDeUtils.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13174521" author="hudson" created="Thu, 22 Dec 2011 00:19:34 +0000"  >&lt;p&gt;Integrated in Hive-trunk-h0.21 #1164 (See &lt;a href=&quot;https://builds.apache.org/job/Hive-trunk-h0.21/1164/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/Hive-trunk-h0.21/1164/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2666&quot; title=&quot;StackOverflowError when using custom UDF in map join&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2666&quot;&gt;&lt;del&gt;HIVE-2666&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; StackOverflowError when using custom UDF in map join&lt;br/&gt;
(Kevin Wilfong via Yongqiang He)&lt;/p&gt;

&lt;p&gt;Summary:&lt;br/&gt;
Resource files are now added to the class path as soon as they are added via the&lt;br/&gt;
CLI.  This fixes the stack overflow error mentioned in the JIRA by ensuring a&lt;br/&gt;
consistent class loader between serializers and deserializers for the same&lt;br/&gt;
query.&lt;/p&gt;

&lt;p&gt;Note that now serdes which contain a static block to register themselves are now&lt;br/&gt;
registered twice, once when adding the file to the class loader, and once when&lt;br/&gt;
an instance of the class is created.  Previously, registering a serde twice&lt;br/&gt;
resulted in an exception, to avoid this, I have downgraded it to a warning.&lt;/p&gt;

&lt;p&gt;When a custom UDF is used as part of a join which is converted to a map join,&lt;br/&gt;
the XMLEncoder enters an infinite loop when serializing the map reduce task for&lt;br/&gt;
the second time, as part of sending it to be executed.  This results in a stack&lt;br/&gt;
overflow error.&lt;/p&gt;

&lt;p&gt;Test Plan:&lt;br/&gt;
I ran the unit tests to verify nothing was broken.&lt;/p&gt;

&lt;p&gt;I ran several queries which used custom UDFs and involved a join which was&lt;br/&gt;
converted to a map join.  I verified these completed successfully consistently&lt;/p&gt;

&lt;p&gt;Reviewers: JIRA, heyongqiang&lt;/p&gt;

&lt;p&gt;Reviewed By: heyongqiang&lt;/p&gt;

&lt;p&gt;CC: heyongqiang, kevinwilfong&lt;/p&gt;

&lt;p&gt;Differential Revision: 957&lt;/p&gt;

&lt;p&gt;heyongqiang : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1221830&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1221830&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/exec/Utilities.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/processors/AddResourceProcessor.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/processors/DeleteResourceProcessor.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/serde/src/java/org/apache/hadoop/hive/serde2/SerDeUtils.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13265312" author="ashutoshc" created="Mon, 30 Apr 2012 21:11:40 +0000"  >&lt;p&gt;This issue is closed now. It was released with the fix in 0.9.0. If there is a problem, please open a new jira and link this one with that.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12641520">HIVE-4317</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12508149" name="ASF.LICENSE.NOT.GRANTED--HIVE-2666.D957.1.patch" size="8074" author="phabricator@reviews.facebook.net" created="Tue, 20 Dec 2011 23:21:31 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 20 Dec 2011 23:21:30 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>221590</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 31 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0ll2f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>124063</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>