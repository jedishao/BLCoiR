<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sat Dec 03 00:11:00 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HIVE-1510/HIVE-1510.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HIVE-1510] HiveCombineInputFormat should not use prefix matching to find the partitionDesc for a given path</title>
                <link>https://issues.apache.org/jira/browse/HIVE-1510</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;set hive.input.format=org.apache.hadoop.hive.ql.io.CombineHiveInputFormat;&lt;/p&gt;

&lt;p&gt;drop table combine_3_srcpart_seq_rc;&lt;/p&gt;

&lt;p&gt;create table combine_3_srcpart_seq_rc (key int , value string) partitioned by (ds string, hr string) stored as sequencefile;&lt;/p&gt;

&lt;p&gt;insert overwrite table combine_3_srcpart_seq_rc partition (ds=&quot;2010-08-03&quot;, hr=&quot;00&quot;) select * from src;&lt;/p&gt;

&lt;p&gt;alter table combine_3_srcpart_seq_rc set fileformat rcfile;&lt;br/&gt;
insert overwrite table combine_3_srcpart_seq_rc partition (ds=&quot;2010-08-03&quot;, hr=&quot;001&quot;) select * from src;&lt;/p&gt;

&lt;p&gt;desc extended combine_3_srcpart_seq_rc partition(ds=&quot;2010-08-03&quot;, hr=&quot;00&quot;);&lt;br/&gt;
desc extended combine_3_srcpart_seq_rc partition(ds=&quot;2010-08-03&quot;, hr=&quot;001&quot;);&lt;/p&gt;

&lt;p&gt;select * from combine_3_srcpart_seq_rc where ds=&quot;2010-08-03&quot; order by key;&lt;/p&gt;

&lt;p&gt;drop table combine_3_srcpart_seq_rc;&lt;/p&gt;


&lt;p&gt;will fail.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12470780">HIVE-1510</key>
            <summary>HiveCombineInputFormat should not use prefix matching to find the partitionDesc for a given path</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="he yongqiang">He Yongqiang</assignee>
                                    <reporter username="he yongqiang">He Yongqiang</reporter>
                        <labels>
                    </labels>
                <created>Wed, 4 Aug 2010 00:50:33 +0000</created>
                <updated>Fri, 16 Dec 2011 23:59:59 +0000</updated>
                            <resolved>Sat, 21 Aug 2010 13:07:35 +0000</resolved>
                                                    <fixVersion>0.7.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12895370" author="namit" created="Wed, 4 Aug 2010 19:03:50 +0000"  >&lt;p&gt;Some minor comments&lt;br/&gt;
TestHiveFileFormatUtils:&lt;/p&gt;

&lt;p&gt;1. Use a different PartitionDesc every time instead of partDesc_1 for the partitions.&lt;br/&gt;
2. Spelling mistakes: forth group&lt;/p&gt;


&lt;p&gt;Otherwise, it looks good to me. Ning, can you also OK it , since we spent a lot of time debugging in the past.&lt;/p&gt;

&lt;p&gt;Also, before checking it, can you try the following 4 types of queries (with CombineHiveInputFormat):&lt;/p&gt;

&lt;p&gt;1. hadoop 17 normal query&lt;br/&gt;
2. hadoop 17 sampling query&lt;br/&gt;
3. hadoop 20 normal query&lt;br/&gt;
4. hadoop 20 sampling query&lt;/p&gt;
</comment>
                            <comment id="12895381" author="nzhang" created="Wed, 4 Aug 2010 19:36:53 +0000"  >&lt;p&gt;In HiveFileFormatUtils, removing scheme and authorities from the URI and only retain the path part may cause problem when the URI is har:// rather than hdfs://. This is one of the bugs that Paul fixed in hadoop for HAR to be able to work with CHIF. &lt;/p&gt;

&lt;p&gt;As a general comment, is it easier to just modify the pathToPartitionInfo to add a Path.SEPARATER at the end? You don&apos;t need to introduce the recursive checking and still can use the prefix matching. &lt;/p&gt;</comment>
                            <comment id="12895386" author="he yongqiang" created="Wed, 4 Aug 2010 19:49:31 +0000"  >&lt;p&gt;will also test against har. even the old code also remove the scheme and authorities part when try to match partitionDesc.&lt;br/&gt;
no offense &amp;#8211; the old code is not very clear, and not efficient.  The new code does the same thing with simplified logic.&lt;/p&gt;</comment>
                            <comment id="12895428" author="nzhang" created="Wed, 4 Aug 2010 21:23:56 +0000"  >&lt;p&gt;It&apos;s fine for me if you feel strong for it. The concern from me (besides har+CHIF support) is the performance implication when using CHIF merging large number of small files inside a partition. Siying has a use case where the pathToPartitionInfo is very large and the # of files in the splits is also very large. Determining whether partitionDesc for each input path takes a long time. In your patch, you have another HashMap for the path part of the pathToPartitionInfo (which trade memory for speed), but introduced another loop for comparing parent of paths. It would be nice (better performance) if you could avoid this loop by simply appending &apos;/&apos; at the end.  But if it doesn&apos;t hurt the performance or appending &apos;/&apos; doesn&apos;t work, the current patch is fine for me too.&lt;/p&gt;

&lt;p&gt;As an aside, we should find out why pathToPartitionInfo in some cases contains paths only rather than the full URI. The ideal case is that it should always contains the full URI so that we don&apos;t rely on heuristics. But this could be another JIRA.&lt;/p&gt;</comment>
                            <comment id="12896752" author="he yongqiang" created="Tue, 10 Aug 2010 00:53:27 +0000"  >&lt;p&gt;Will update the patch once &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-1515&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-1515&lt;/a&gt; is in.&lt;/p&gt;</comment>
                            <comment id="12899086" author="he yongqiang" created="Mon, 16 Aug 2010 20:58:46 +0000"  >&lt;p&gt;Since &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-1515&quot; title=&quot;archive is not working when multiple partitions inside one table are archived.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-1515&quot;&gt;HIVE-1515&lt;/a&gt; depends on Hadoop, can we close this jira without adding new archive testcases.&lt;/p&gt;</comment>
                            <comment id="12900057" author="nzhang" created="Wed, 18 Aug 2010 21:58:52 +0000"  >&lt;p&gt;As discussed offline with Yongqiang, we should clean up the pathToPartitionInfo to contain only canonical representations for each partition. This could result in much cleaner code. If we do that IOPrepareCache is not needed at all and the function getPartitionDescFromPath is just simple hash lookup. We can make it as a follow up JIRA along with cleaning up the unnecessary info in pathToPartitionInfo as well.&lt;/p&gt;

&lt;p&gt;Here&apos;s some comments on the current patch:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;the IOPrepareCache is cleared in Driver, which should only contain generic code irrespect to task types. Can you do it in ExecDriver.execute()? This will new cache is only used in ExecDriver anyways.&lt;/li&gt;
	&lt;li&gt;some comments on why you need a new hash map keyed with the paths only will be helpful.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="12900063" author="he yongqiang" created="Wed, 18 Aug 2010 22:08:05 +0000"  >&lt;p&gt;&amp;gt;&amp;gt;the IOPrepareCache is cleared in Driver, which should only contain generic code irrespect to task types. Can you do it in ExecDriver.execute()? This will new cache is only used in ExecDriver anyways.&lt;/p&gt;

&lt;p&gt;ExecDriver is per map-reduce task. Driver is per query. We should do this for query granularity. I think the pathToPartitionDesc is also per query map?&lt;/p&gt;


&lt;p&gt;&amp;gt;&amp;gt;some comments on why you need a new hash map keyed with the paths only will be helpful.&lt;br/&gt;
will do it in a next patch.&lt;/p&gt;</comment>
                            <comment id="12900074" author="he yongqiang" created="Wed, 18 Aug 2010 22:33:51 +0000"  >&lt;p&gt;About the additional hashmap added, it is used to match path to partitionDesc by discarding partitionDesc&apos;s schema information. &lt;/p&gt;

&lt;p&gt;In the long run, we should normalize all input path to let them contain full schema and authorization information. This is a must to let hive work with multiple hdfs clusters.&lt;/p&gt;</comment>
                            <comment id="12900113" author="nzhang" created="Wed, 18 Aug 2010 23:49:41 +0000"  >&lt;p&gt;Other than the clean architecture concerns (Driver should be generic and should not assume tasks contain MR jobs), it seems also doesn&apos;t work if parallel execution is enabled: IOPrepareCache is thread local and parallel MR jobs are launched in different threads.&lt;/p&gt;
</comment>
                            <comment id="12900417" author="nzhang" created="Thu, 19 Aug 2010 19:53:34 +0000"  >&lt;p&gt;+1, will commit if tests pass&lt;/p&gt;</comment>
                            <comment id="12900567" author="nzhang" created="Fri, 20 Aug 2010 04:06:12 +0000"  >&lt;p&gt;Yongqiang, the 0.17 test failed on index_compact3.q and script_pipe.q (the latter may be a false alarm). Can you take a look?&lt;/p&gt;</comment>
                            <comment id="12900904" author="he yongqiang" created="Fri, 20 Aug 2010 23:01:27 +0000"  >&lt;p&gt;even without this patch, the 0.17 test failed on index_compat3.q. Please file a separate jira for this issue. &lt;/p&gt;</comment>
                            <comment id="12900940" author="nzhang" created="Sat, 21 Aug 2010 00:15:11 +0000"  >&lt;p&gt;it does&apos;t fail on trunk but caused by parallel test. &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-1576&quot; title=&quot;index_compact*.q should not share common result file&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-1576&quot;&gt;HIVE-1576&lt;/a&gt; was filed for this. &lt;/p&gt;

&lt;p&gt;Will tes again and commit once &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-1307&quot; title=&quot;More generic and efficient merge method&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-1307&quot;&gt;&lt;del&gt;HIVE-1307&lt;/del&gt;&lt;/a&gt; is committed.&lt;/p&gt;</comment>
                            <comment id="12901025" author="nzhang" created="Sat, 21 Aug 2010 13:07:35 +0000"  >&lt;p&gt;Committed. Thanks Yongqiang!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12451184" name="hive-1510.1.patch" size="36610" author="he yongqiang" created="Wed, 4 Aug 2010 01:05:57 +0000"/>
                            <attachment id="12452442" name="hive-1510.3.patch" size="42081" author="he yongqiang" created="Wed, 18 Aug 2010 19:46:09 +0000"/>
                            <attachment id="12452551" name="hive-1510.4.patch" size="42845" author="he yongqiang" created="Thu, 19 Aug 2010 17:33:37 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 4 Aug 2010 19:03:50 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>72864</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 15 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0lffz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>123152</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>