<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sat Dec 03 22:32:26 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HIVE-6819/HIVE-6819.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HIVE-6819] Correctness issue with Hive limit operator &amp; predicate push down</title>
                <link>https://issues.apache.org/jira/browse/HIVE-6819</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;Following query produces 0 rows with Predicate Push Down optimization turned on; the same query produces 130 rows with predicate push down turned off.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-sql&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;SELECT&lt;/span&gt; t2.c_int &lt;span class=&quot;code-keyword&quot;&gt;FROM&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;select&lt;/span&gt; key, value, c_float, c_int &lt;span class=&quot;code-keyword&quot;&gt;from&lt;/span&gt; t1 ORDER &lt;span class=&quot;code-keyword&quot;&gt;BY&lt;/span&gt; key, value, c_float, c_int LIMIT 10) t1 JOIN t2 on t1.c_int=t2.c_int and t1.c_float=t2.c_float &lt;span class=&quot;code-keyword&quot;&gt;WHERE&lt;/span&gt; t2.c_int&amp;gt;=1;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I could reproduce this on Apache Trunk.&lt;br/&gt;
Haven&apos;t checked if previous releases have the same issue.&lt;/p&gt;

&lt;p&gt;hive&amp;gt; desc t1;&lt;br/&gt;
Query ID = jpullokkaran_20140401191515_36e441c6-074b-45ae-aff6-489e13a6f401&lt;br/&gt;
OK&lt;br/&gt;
key string &lt;br/&gt;
value string &lt;br/&gt;
c_int int &lt;br/&gt;
c_float float &lt;br/&gt;
c_boolean boolean &lt;br/&gt;
Time taken: 0.077 seconds, Fetched: 5 row(s)&lt;br/&gt;
hive&amp;gt; select distinct key, value, c_float, c_int from t1; &lt;br/&gt;
OK&lt;br/&gt;
1	 1	1.0	1&lt;br/&gt;
1 1 1.0	1&lt;br/&gt;
1	1	1.0	1&lt;br/&gt;
1 1 1.0	1&lt;br/&gt;
null	null	NULL	NULL&lt;br/&gt;
Time taken: 0.062 seconds, Fetched: 5 row(s)&lt;br/&gt;
hive&amp;gt; desc t2;&lt;br/&gt;
Query ID = jpullokkaran_20140401191616_dfbd14bb-b5b8-4165-8d01-e9a61a7f1c33&lt;br/&gt;
OK&lt;br/&gt;
key string &lt;br/&gt;
value string &lt;br/&gt;
c_int int &lt;br/&gt;
c_float float &lt;br/&gt;
c_boolean boolean &lt;br/&gt;
Time taken: 0.062 seconds, Fetched: 5 row(s)&lt;br/&gt;
hive&amp;gt; select distinct key, value, c_float, c_int from t2;&lt;br/&gt;
OK&lt;br/&gt;
1	 1	1.0	1&lt;br/&gt;
1 1 1.0	1&lt;br/&gt;
1	1	1.0	1&lt;br/&gt;
1 1 1.0	1&lt;br/&gt;
2	2	2.0	2&lt;br/&gt;
null	null	NULL	NULL&lt;br/&gt;
Time taken: 4.698 seconds, Fetched: 6 row(s)&lt;br/&gt;
hive&amp;gt; select t2.c_int from (select key, value, c_float, c_int from t1 order by key,value,c_float,c_int limit 10)t1 join t2 on t1.c_int=t2.c_int and t1.c_float=t2.c_float where t2.c_int&amp;gt;=1;&lt;br/&gt;
MapredLocal task succeeded&lt;br/&gt;
OK&lt;br/&gt;
Time taken: 13.029 seconds&lt;br/&gt;
hive&amp;gt;&lt;br/&gt;
hive&amp;gt; select t2.c_int from (select key, value, c_float, c_int from t1 order by key,value,c_float,c_int limit 10)t1 join t2 on t1.c_int=t2.c_int and t1.c_float=t2.c_float where t2.c_int&amp;gt;=1;&lt;br/&gt;
MapredLocal task succeeded&lt;br/&gt;
OK&lt;br/&gt;
...&lt;br/&gt;
1&lt;br/&gt;
1&lt;br/&gt;
1&lt;br/&gt;
1&lt;br/&gt;
1&lt;br/&gt;
1&lt;br/&gt;
1&lt;br/&gt;
1&lt;br/&gt;
1&lt;br/&gt;
1&lt;br/&gt;
1&lt;br/&gt;
Time taken: 9.317 seconds, Fetched: 130 row(s)&lt;br/&gt;
hive&amp;gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12706299">HIVE-6819</key>
            <summary>Correctness issue with Hive limit operator &amp; predicate push down</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="3">Duplicate</resolution>
                                        <assignee username="jpullokkaran">Laljo John Pullokkaran</assignee>
                                    <reporter username="jpullokkaran">Laljo John Pullokkaran</reporter>
                        <labels>
                    </labels>
                <created>Wed, 2 Apr 2014 21:38:16 +0000</created>
                <updated>Fri, 4 Apr 2014 21:56:32 +0000</updated>
                            <resolved>Fri, 4 Apr 2014 21:56:32 +0000</resolved>
                                    <version>0.12.0</version>
                                    <fixVersion>0.13.0</fixVersion>
                                    <component>Query Processor</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="13958423" author="rhbutani" created="Thu, 3 Apr 2014 01:36:00 +0000"  >&lt;p&gt;Problem is:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Column Pruning is not pruning past the Limit Operator. So the first MR job has the FilterOp whose inputSchema has the all the columns but its outputSchema is the pruned column list.&lt;/li&gt;
	&lt;li&gt;But at runtime we assume the Operators on the Reduce side have the same schema as the ExtractOperator, unless you hit a SelectOperator. So in this case the FilterOp and subsequent FileSink output rows with all the columns.&lt;/li&gt;
	&lt;li&gt;So you end up in a state: where the 2nd job is expecting a pruned row, but gets rows with all columns.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;This is probably because we didn&apos;t expect to see queries with OrderBy/Limit in SubQuery blocks. So ColumnPruner is not handling this case correctly. Investigating some more on this point...&lt;/p&gt;</comment>
                            <comment id="13959111" author="rhbutani" created="Thu, 3 Apr 2014 19:24:16 +0000"  >&lt;p&gt;Attached a preliminary patch. If the FIletrOp follows a Order or Limit inject a SelectOp to handle outputting only the columns expected by FiletrOp.&lt;/p&gt;

&lt;p&gt;But &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ashutoshc&quot; class=&quot;user-hover&quot; rel=&quot;ashutoshc&quot;&gt;Ashutosh Chauhan&lt;/a&gt; pointed out that &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-4904&quot; title=&quot;A little more CP crossing RS boundaries&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-4904&quot;&gt;&lt;del&gt;HIVE-4904&lt;/del&gt;&lt;/a&gt; is related and may already cover this issue. It seems to address the issue of ReduceSink ignoring the pruned list for this case. Will look into it shortly.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12659018">HIVE-4904</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="12310051">
                    <name>Supercedes</name>
                                                                <inwardlinks description="is superceded by">
                                        <issuelink>
            <issuekey id="12659018">HIVE-4904</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12638540" name="HIVE-6819.1.patch" size="3527" author="rhbutani" created="Thu, 3 Apr 2014 19:21:52 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 3 Apr 2014 01:36:00 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>384622</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 35 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1u9fb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>384890</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>