<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 02 23:41:50 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HIVE-519/HIVE-519.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HIVE-519] Regex processing gets stuck when querying weblogs</title>
                <link>https://issues.apache.org/jira/browse/HIVE-519</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;When running a simple query on a table similar to the apachelog table here: &lt;a href=&quot;http://wiki.apache.org/hadoop/Hive/UserGuide&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://wiki.apache.org/hadoop/Hive/UserGuide&lt;/a&gt; the regular expression matcher gets stuck in an infinite loop.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12426452">HIVE-519</key>
            <summary>Regex processing gets stuck when querying weblogs</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.png">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="zshao">Zheng Shao</assignee>
                                    <reporter username="johanoskarsson">Johan Oskarsson</reporter>
                        <labels>
                    </labels>
                <created>Wed, 27 May 2009 10:36:06 +0000</created>
                <updated>Sat, 17 Dec 2011 00:07:12 +0000</updated>
                            <resolved>Fri, 24 Jul 2009 08:46:54 +0000</resolved>
                                    <version>0.4.0</version>
                                    <fixVersion>0.4.0</fixVersion>
                                    <component>Serializers/Deserializers</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="12713524" author="johanoskarsson" created="Wed, 27 May 2009 10:37:51 +0000"  >&lt;p&gt;Attaching a thread dump from one of the map tasks.&lt;/p&gt;

&lt;p&gt;Example query that triggers this behaviour:&lt;br/&gt;
select remote_ip, count(1) from weblogs  where insertdate=&apos;2009-05-26&apos; group by remote_ip limit 10;&lt;/p&gt;</comment>
                            <comment id="12713820" author="zshao" created="Thu, 28 May 2009 01:06:57 +0000"  >&lt;p&gt;Can you upload the line of data that caused the trouble?&lt;/p&gt;</comment>
                            <comment id="12713824" author="zshao" created="Thu, 28 May 2009 01:13:23 +0000"  >&lt;p&gt;For debugging, please try&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
(?:^| )((&lt;span class=&quot;code-quote&quot;&gt;&quot;|\[|\])(?:[^(&quot;&lt;/span&gt;|\[|\])]+|(&lt;span class=&quot;code-quote&quot;&gt;&quot;|\[|\])(&quot;&lt;/span&gt;|\[|\]))*(&quot;|\[|\])|[^ ]*)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;and&lt;br/&gt;
your line of log&lt;br/&gt;
on&lt;br/&gt;
&lt;a href=&quot;http://www.fileformat.info/tool/regex.htm&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://www.fileformat.info/tool/regex.htm&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12713947" author="johanoskarsson" created="Thu, 28 May 2009 11:26:05 +0000"  >&lt;p&gt;127.0.0.1 - - &lt;span class=&quot;error&quot;&gt;&amp;#91;26/May/2009:00:00:00 +0000&amp;#93;&lt;/span&gt; &quot;GET /someurl/?track=Blabla(Main) HTTP/1.1&quot; 200 5864 - &quot;Mozilla/5.0 (Windows; U; Windows NT 6.0; en-US) AppleWebKit/525.19 (KHTML, like Gecko) Chrome/1.0.154.65 Safari/525.19&quot;&lt;/p&gt;

&lt;p&gt;Example of a line that takes 15 seconds to process on my machine, it does eventually complete though. If I remove the (Main) part of the url it takes 29 milliseconds to finish.&lt;/p&gt;</comment>
                            <comment id="12714102" author="martind" created="Thu, 28 May 2009 18:25:00 +0000"  >&lt;p&gt;To reiterate &amp;#8211; the behaviour reported is that records with certain character sequences (in this example: an HTTP request line with parentheses in the requested path) take many orders of magnitude longer to process than usual. &lt;/p&gt;

&lt;p&gt;This looks like it&apos;s a result of Java&apos;s regex implementation using a Non-deterministic Finite Automaton, which performs badly in worst-case scenarios (like probably this one.) Check e.g. &lt;a href=&quot;http://weblogs.java.net/blog/tomwhite/archive/2006/03/a_faster_java_r.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://weblogs.java.net/blog/tomwhite/archive/2006/03/a_faster_java_r.html&lt;/a&gt; for some background.&lt;/p&gt;

&lt;p&gt;There are essentially two options to avoid this: Alter the expression, or use a different regex library. There may be a way to do the former. &lt;/p&gt;

&lt;p&gt;I&apos;ll use TestTCTLSeparatedProtocol.test1ApacheLogFormat() as an example.&lt;/p&gt;

&lt;p&gt;This is the pattern generated for this test: (?:^| )((&quot;|[|])(?:&lt;span class=&quot;error&quot;&gt;&amp;#91;^(&amp;quot;|\[|\])&amp;#93;&lt;/span&gt;+|(&quot;|[|])(&quot;|[|]))&lt;b&gt;(&quot;|[|])|&lt;span class=&quot;error&quot;&gt;&amp;#91;^ &amp;#93;&lt;/span&gt;&lt;/b&gt;)&lt;br/&gt;
Note the sub-expression: ...&lt;span class=&quot;error&quot;&gt;&amp;#91;^(&amp;quot;|\[|\])&amp;#93;&lt;/span&gt;+...&lt;/p&gt;

&lt;p&gt;I.e., it builds a pattern for a negating character class (&quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;^...&amp;#93;&lt;/span&gt;&quot;) that unfortunately doesn&apos;t contain a list of characters, but instead another pattern group in parentheses. Namely, the value of QUOTE_CHAR: (&quot;|[|])&lt;/p&gt;

&lt;p&gt;After I manually converted this sub-expression to the legitimate &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;^&amp;quot;\[\]&amp;#93;&lt;/span&gt;+&quot; character class the pattern matcher performed admirably against Johan&apos;s test case.&lt;/p&gt;

&lt;p&gt;Tbh I&apos;m not sure if the character class that currently gets generated is valid; at minimum it may have some unintended side-effects. To implement this properly the pattern builder would need to have access to two different representations of the QUOTE_CHAR parameter (as a grouped expression and as a character class) when there currently only is one. &lt;/p&gt;

&lt;p&gt;(You probably need to apply &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-520&quot; title=&quot;TestTCTLSeparatedProtocol is broken&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-520&quot;&gt;&lt;del&gt;HIVE-520&lt;/del&gt;&lt;/a&gt; first to make the TestTCTLSeparatedProtocol unit test run.)&lt;/p&gt;</comment>
                            <comment id="12734980" author="zshao" created="Fri, 24 Jul 2009 08:46:54 +0000"  >&lt;p&gt;Fixed as part of &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-167&quot; title=&quot;Hive: add a RegularExpressionDeserializer&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-167&quot;&gt;&lt;del&gt;HIVE-167&lt;/del&gt;&lt;/a&gt;. Please see &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-662&quot; title=&quot;Add a method to parse apache weblogs&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-662&quot;&gt;&lt;del&gt;HIVE-662&lt;/del&gt;&lt;/a&gt; for the example query for apache web log files.&lt;/p&gt;</comment>
                            <comment id="12734986" author="zshao" created="Fri, 24 Jul 2009 08:58:28 +0000"  >&lt;p&gt;By the way, we plan to deprecate DynamicSerDe (with all protocols) at some time, because a lot of protocols (like TCTLSeparatedProtocol) are not real Thrift Protocols and it&apos;s overly complicated to fit these serialization methods into Thrift.  We will still support the &quot;ThriftDeserializer&quot; which supports statically generated java classes.&lt;/p&gt;

&lt;p&gt;What do you guys think? Are there any dependencies on DynamicSerDe on your end?&lt;/p&gt;</comment>
                            <comment id="12735595" author="johanoskarsson" created="Mon, 27 Jul 2009 12:56:13 +0000"  >&lt;p&gt;We don&apos;t depend on DynamicSerDe, so we don&apos;t mind if it is deprecated.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12431012">HIVE-662</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12407566">HIVE-167</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12409153" name="hive-stdout" size="14015" author="johanoskarsson" created="Wed, 27 May 2009 10:37:51 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 28 May 2009 01:06:57 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>73474</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 19 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0la9b:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>122312</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>