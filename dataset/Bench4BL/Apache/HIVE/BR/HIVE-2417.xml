<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sat Dec 03 00:00:32 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HIVE-2417/HIVE-2417.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HIVE-2417] Merging of compressed rcfiles fails to write the valuebuffer part correctly</title>
                <link>https://issues.apache.org/jira/browse/HIVE-2417</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;The blockmerge task does not create proper rc files when merging compressed rc files as the valuebuffer writing is incorrect.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12520545">HIVE-2417</key>
            <summary>Merging of compressed rcfiles fails to write the valuebuffer part correctly</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="n_krishna_kumar">Krishna Kumar</assignee>
                                    <reporter username="n_krishna_kumar">Krishna Kumar</reporter>
                        <labels>
                    </labels>
                <created>Mon, 29 Aug 2011 10:21:41 +0000</created>
                <updated>Fri, 16 Dec 2011 23:55:58 +0000</updated>
                            <resolved>Thu, 1 Sep 2011 21:18:05 +0000</resolved>
                                                    <fixVersion>0.8.0</fixVersion>
                                    <component>Query Processor</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="13092747" author="n_krishna_kumar" created="Mon, 29 Aug 2011 10:23:34 +0000"  >&lt;p&gt;Test added&lt;/p&gt;</comment>
                            <comment id="13094287" author="he yongqiang" created="Wed, 31 Aug 2011 03:47:14 +0000"  >&lt;p&gt;Good catch, this is a regression introduced in &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2396&quot; title=&quot;RCFileReader Buffer Reuse&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2396&quot;&gt;&lt;del&gt;HIVE-2396&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
Can you make the testcase more easy to reproduce the problem? I mean if without the change in this diff, should get an error or incorrect results when running with that testcase. &lt;/p&gt;

&lt;p&gt;1. remove this &quot;+set mapred.output.compression.codec=org.apache.hadoop.io.compress.BZip2Codec;&quot;,&lt;br/&gt;
2. tgt_rc_merge_test only contains one file, so the &apos;alter table tgt_rc_merge_test concatenate;&apos; will basically do nothing. Can you make sure this table at least contains 2 files? You can upload 2 gzip compressed rcfile if there is not.&lt;/p&gt;

</comment>
                            <comment id="13094294" author="n_krishna_kumar" created="Wed, 31 Aug 2011 04:10:51 +0000"  >&lt;p&gt;Yes, the test is designed to produce the error when run without the change. Are you finding that that&apos;s not the case? I get an EOFException while running the same steps in my development environment (i.e., not as a unit test).&lt;/p&gt;

&lt;p&gt;1. This is needed so that the rcfiles in the target table are compressed with Bzip2. Do you mean that we should be using Default compression codec instead? Fine with me but why is that important?&lt;/p&gt;

&lt;p&gt;2. tgt does contain more than one file.&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;before alter&amp;#93;&lt;/span&gt;&lt;br/&gt;
+POSTHOOK: query: show table extended like `tgt_rc_merge_test`&lt;br/&gt;
...&lt;br/&gt;
+totalNumberFiles:2&lt;br/&gt;
...&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;after alter&amp;#93;&lt;/span&gt;&lt;br/&gt;
+POSTHOOK: query: show table extended like `tgt_rc_merge_test`&lt;br/&gt;
...&lt;br/&gt;
+totalNumberFiles:1&lt;/p&gt;

&lt;p&gt;The &apos;create&apos; adds one file, and the insert adds another file. &lt;span class=&quot;error&quot;&gt;&amp;#91;OT: Does it make sense append a block merge task after an non-overwrite insert? Dunno...&amp;#93;&lt;/span&gt;&lt;/p&gt;</comment>
                            <comment id="13094297" author="he yongqiang" created="Wed, 31 Aug 2011 04:33:34 +0000"  >&lt;blockquote&gt;&lt;p&gt;The &apos;create&apos; adds one file, and the insert adds another file.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;sorry, i thought you are doing an &quot;insert overwrite &quot;, can u do 2 inserts? &lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;This is needed so that the rcfiles in the target table are compressed with Bzip2. Do you mean that we should be using Default compression codec instead? Fine with me but why is that important?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes. i mean if you remove this line and keep the line &quot;set hive.exec.compress.output = true;&quot;. The output will be compressed using DefaultCodec. The reason is that BZip2 may not installed for all hive users/dev.&lt;/p&gt;</comment>
                            <comment id="13094298" author="he yongqiang" created="Wed, 31 Aug 2011 04:34:20 +0000"  >&lt;p&gt;by &quot;2 inserts&quot;, i mean remove the &quot;load&quot; command, and use 2 inserts to pop the data. &lt;/p&gt;</comment>
                            <comment id="13094306" author="n_krishna_kumar" created="Wed, 31 Aug 2011 05:01:32 +0000"  >&lt;p&gt;Test changed after review comments&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;default codec instead of bzip2&lt;/li&gt;
	&lt;li&gt;Create + 2 inserts instead of CTAS + 1 insert&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13094963" author="he yongqiang" created="Wed, 31 Aug 2011 22:33:16 +0000"  >&lt;p&gt;+1, will commit after tests pass&lt;/p&gt;</comment>
                            <comment id="13095608" author="he yongqiang" created="Thu, 1 Sep 2011 21:18:00 +0000"  >&lt;p&gt;Committed, thanks Krishna Kumar!&lt;/p&gt;</comment>
                            <comment id="13095920" author="hudson" created="Fri, 2 Sep 2011 11:28:06 +0000"  >&lt;p&gt;Integrated in Hive-trunk-h0.21 #928 (See &lt;a href=&quot;https://builds.apache.org/job/Hive-trunk-h0.21/928/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/Hive-trunk-h0.21/928/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2417&quot; title=&quot;Merging of compressed rcfiles fails to write the valuebuffer part correctly&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2417&quot;&gt;&lt;del&gt;HIVE-2417&lt;/del&gt;&lt;/a&gt;: Merging of compressed rcfiles fails to write the valuebuffer part correctly (Krishna Kumar via He Yongqiang)&lt;/p&gt;

&lt;p&gt;heyongqiang : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1164278&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1164278&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hive/trunk/ql/src/java/org/apache/hadoop/hive/ql/io/RCFile.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/queries/clientpositive/create_merge_compressed.q&lt;/li&gt;
	&lt;li&gt;/hive/trunk/ql/src/test/results/clientpositive/create_merge_compressed.q.out&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12492052" name="HIVE-2417.v0.patch" size="13891" author="n_krishna_kumar" created="Mon, 29 Aug 2011 10:23:34 +0000"/>
                            <attachment id="12492414" name="HIVE-2417.v1.patch" size="14500" author="n_krishna_kumar" created="Wed, 31 Aug 2011 05:01:32 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 31 Aug 2011 03:47:14 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>35780</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 14 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0ljx3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>123877</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>