<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 02 06:03:59 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HIVE-13959/HIVE-13959.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HIVE-13959] MoveTask should only release its query associated locks</title>
                <link>https://issues.apache.org/jira/browse/HIVE-13959</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;releaseLocks in MoveTask releases all locks under a HiveLockObject pathNames. But some of locks under this pathNames might be for other queries and should not be released.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12976265">HIVE-13959</key>
            <summary>MoveTask should only release its query associated locks</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ctang.ma">Chaoyu Tang</assignee>
                                    <reporter username="ctang.ma">Chaoyu Tang</reporter>
                        <labels>
                    </labels>
                <created>Tue, 7 Jun 2016 02:24:51 +0000</created>
                <updated>Tue, 21 Jun 2016 15:05:59 +0000</updated>
                            <resolved>Tue, 14 Jun 2016 21:26:17 +0000</resolved>
                                                    <fixVersion>2.1.0</fixVersion>
                                    <component>Locking</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="15317734" author="ctang.ma" created="Tue, 7 Jun 2016 03:08:46 +0000"  >&lt;p&gt;The patch only releases the locks held for MoveTask related query, where the lock was once acquired for this query and in the ctx.getHiveLocks(), so ctx.getHiveLocks().remove(lock) returns true.&lt;br/&gt;
Have done manual tests with two Hive debug sessions running two different queries, and verified that one query with MoveTask does not remove the locks acquired for the other query running in other session.&lt;/p&gt;</comment>
                            <comment id="15317735" author="ctang.ma" created="Tue, 7 Jun 2016 03:09:21 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=alangates&quot; class=&quot;user-hover&quot; rel=&quot;alangates&quot;&gt;Alan Gates&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ychena&quot; class=&quot;user-hover&quot; rel=&quot;ychena&quot;&gt;Yongzhi Chen&lt;/a&gt;, could you review the patch? Thanks&lt;/p&gt;</comment>
                            <comment id="15318990" author="hiveqa" created="Tue, 7 Jun 2016 17:46:33 +0000"  >

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12808546/HIVE-13959.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12808546/HIVE-13959.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to no test(s) being added or modified.&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 26 failed/errored test(s), 10223 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_acid_globallimit
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_acid_table_stats
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_create_func1
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_list_bucket_dml_12
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_list_bucket_dml_13
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_stats_list_bucket
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_subquery_multiinsert
org.apache.hadoop.hive.cli.TestMiniSparkOnYarnCliDriver.testCliDriver_constprog_partitioner
org.apache.hadoop.hive.cli.TestMiniSparkOnYarnCliDriver.testCliDriver_index_bitmap3
org.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver_auto_sortmerge_join_9
org.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver_bucketsortoptimize_insert_7
org.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver_groupby4_map_skew
org.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver_groupby_bigdata
org.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver_groupby_resolution
org.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver_groupby_sort_1_23
org.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver_join_literals
org.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver_join_merging
org.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver_mapreduce1
org.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver_skewjoinopt2
org.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver_statsfs
org.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver_union_remove_19
org.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver_union_remove_4
org.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver_union_remove_8
org.apache.hadoop.hive.cli.TestSparkCliDriver.testCliDriver_union_view
org.apache.hive.jdbc.TestJdbcWithLocalClusterSpark.testPermFunc
org.apache.hive.jdbc.TestJdbcWithMiniMr.testPermFunc
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-MASTER-Build/31/testReport&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-MASTER-Build/31/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-MASTER-Build/31/console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-MASTER-Build/31/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://ec2-50-18-27-0.us-west-1.compute.amazonaws.com/logs/PreCommit-HIVE-MASTER-Build-31/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://ec2-50-18-27-0.us-west-1.compute.amazonaws.com/logs/PreCommit-HIVE-MASTER-Build-31/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 26 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12808546 - PreCommit-HIVE-MASTER-Build&lt;/p&gt;</comment>
                            <comment id="15319023" author="ctang.ma" created="Tue, 7 Jun 2016 17:59:18 +0000"  >&lt;p&gt;The TestSparkCliDriver test failures seem not related to this patch, they might be due to infra issue (java.lang.IllegalStateException: Error trying to obtain executor info: java.lang.IllegalStateException: RPC channel is closed.). All other failures are aged and also not related to this patch.&lt;br/&gt;
Kick off another run of precommit build test.&lt;/p&gt;</comment>
                            <comment id="15319241" author="ychena" created="Tue, 7 Jun 2016 19:57:53 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ctang.ma&quot; class=&quot;user-hover&quot; rel=&quot;ctang.ma&quot;&gt;Chaoyu Tang&lt;/a&gt;&lt;br/&gt;
I do not quite understand how MoveTask releases all locks under a HiveLockObject pathNames.&lt;br/&gt;
It looks for me as following:&lt;br/&gt;
One LoadTableDesc object map to one WriteEntity;&lt;br/&gt;
one WriteEntity map to one List&amp;lt;HiveLockObj&amp;gt;.&lt;br/&gt;
These list of HiveLockObj are all created during acquireLocks related to the query.&lt;br/&gt;
In the releaseLocks code, lockObj.getObj() return HiveLockObject&lt;br/&gt;
List&amp;lt;HiveLock&amp;gt; locks = lockMgr.getLocks(lockObj.getObj(), false, true);&lt;br/&gt;
HiveLockObject equals method need both &lt;br/&gt;
pathNames are same and HiveLockObjectData are same. &lt;br/&gt;
HiveLockObjectData equals method need query_id, lock_mode, lock_time... are all same. &lt;br/&gt;
So I think the locks return by getLocks should all related to the query. &lt;br/&gt;
Therefore, MoveTask has no chance to release other query&apos;s locks. &lt;br/&gt;
Do I miss something? &lt;/p&gt;</comment>
                            <comment id="15319545" author="hiveqa" created="Tue, 7 Jun 2016 22:02:38 +0000"  >

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12808724/HIVE-13959.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12808724/HIVE-13959.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to no test(s) being added or modified.&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 11 failed/errored test(s), 10223 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_acid_globallimit
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_acid_table_stats
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_create_func1
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_list_bucket_dml_12
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_list_bucket_dml_13
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_stats_list_bucket
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_subquery_multiinsert
org.apache.hadoop.hive.cli.TestMiniSparkOnYarnCliDriver.testCliDriver_constprog_partitioner
org.apache.hadoop.hive.cli.TestMiniSparkOnYarnCliDriver.testCliDriver_index_bitmap3
org.apache.hive.jdbc.TestJdbcWithLocalClusterSpark.testPermFunc
org.apache.hive.jdbc.TestJdbcWithMiniMr.testPermFunc
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-MASTER-Build/36/testReport&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-MASTER-Build/36/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-MASTER-Build/36/console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-MASTER-Build/36/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://ec2-50-18-27-0.us-west-1.compute.amazonaws.com/logs/PreCommit-HIVE-MASTER-Build-36/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://ec2-50-18-27-0.us-west-1.compute.amazonaws.com/logs/PreCommit-HIVE-MASTER-Build-36/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 11 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12808724 - PreCommit-HIVE-MASTER-Build&lt;/p&gt;</comment>
                            <comment id="15319761" author="ctang.ma" created="Wed, 8 Jun 2016 00:17:39 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ychena&quot; class=&quot;user-hover&quot; rel=&quot;ychena&quot;&gt;Yongzhi Chen&lt;/a&gt; Thanks for the review. For your analysis and questions, please see below:&lt;br/&gt;
Yes &amp;#8211; one WriteEntity map to one List&amp;lt;HiveLockObj&amp;gt;&lt;br/&gt;
Yes &amp;#8211; These list of HiveLockObj are all created during acquireLocks related to the query.&lt;br/&gt;
Yes &amp;#8211; In the releaseLocks code, lockObj.getObj() return HiveLockObject&lt;br/&gt;
The problem is here: List&amp;lt;HiveLock&amp;gt; locks = lockMgr.getLocks(lockObj.getObj(), false, true); it returns all locks under the pathName which might not related to this MoveTask query:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt; 
The getLocks method in ZookeeperHiveLockManager:
&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; List&amp;lt;HiveLock&amp;gt; getLocks(HiveConf conf,
      HiveLockObject key, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; parent, &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; verifyTablePartition, &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; fetchData)
      &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; LockException {
    List&amp;lt;HiveLock&amp;gt; locks = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ArrayList&amp;lt;HiveLock&amp;gt;();
    List&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; children;
    &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; recurse = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
    &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; commonParent;

    &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (key != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
        commonParent = &lt;span class=&quot;code-quote&quot;&gt;&quot;/&quot;&lt;/span&gt; + parent + &lt;span class=&quot;code-quote&quot;&gt;&quot;/&quot;&lt;/span&gt; + key.getName();
        children = curatorFramework.getChildren().forPath(commonParent); 
        /* ==&amp;gt; &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; call returns all locks under commonParent, say db/cdhpart/LOCK-SHARE-000000, db/cdhpart/LOCK-SHARE-000001 &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; pathNames db/cdhpart */
        recurse = &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
      }
      &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
        commonParent = &lt;span class=&quot;code-quote&quot;&gt;&quot;/&quot;&lt;/span&gt; + parent;
        children = curatorFramework.getChildren().forPath(commonParent);
      }
    } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (Exception e) {
      &lt;span class=&quot;code-comment&quot;&gt;// no locks present
&lt;/span&gt;      &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; locks;
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;For an example, if we run query1 in one session &quot;insert overwrite table cdhpart partition (level1= &apos;l1&apos;, level2=&apos;l2&apos;, level3 = &apos;l3&apos;, level4) select key, value, level4 from cdhsrc;&quot; and query2 in the other session concurrently &quot;select * from cdhpart where level1 = &apos;l1&apos;&quot;&lt;br/&gt;
query1 and query2 both have its own znode (lock) under pathNames (db/cdhpart/) say LOCK-SHARE-000000, LOCK-SHARE-000001 respectively, the getLocks for HiveLockObject key with its getName() value db/cdhpart/ will return both LOCK-SHARE-000000, LOCK-SHARE-000001. But LOCK-SHARE-000001 is not in the ctx.getHiveLocks(), the lock list for the query1, so ctx.getHiveLocks().remove() returns false because the HiveLockObjectData.equals always return false due to the different queryStr/queryId, therefore lockMgr.unlock(lock) should not be called to unlock the LOCK-SHARE-000001 for query2.&lt;/p&gt;
</comment>
                            <comment id="15320673" author="ychena" created="Wed, 8 Jun 2016 14:46:49 +0000"  >&lt;p&gt;It seems that the ZookeeperHiveLockManager may have some issue, it does not store and use HiveLockObjectData&lt;br/&gt;
See EmbeddedLockManager.java &lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/hive/blob/master/ql/src/java/org/apache/hadoop/hive/ql/lockmgr/EmbeddedLockManager.java#L403&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/apache/hive/blob/master/ql/src/java/org/apache/hadoop/hive/ql/lockmgr/EmbeddedLockManager.java#L403&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15327164" author="ctang.ma" created="Mon, 13 Jun 2016 11:09:21 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ychena&quot; class=&quot;user-hover&quot; rel=&quot;ychena&quot;&gt;Yongzhi Chen&lt;/a&gt; I made the change in ZookeeperHiveManager as we discussed offline. Please take a look. Thanks&lt;/p&gt;</comment>
                            <comment id="15327506" author="hiveqa" created="Mon, 13 Jun 2016 14:37:39 +0000"  >

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12809813/HIVE-13959.1.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12809813/HIVE-13959.1.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to no test(s) being added or modified.&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 4 failed/errored test(s), 10224 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_acid_globallimit
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_stats_list_bucket
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_subquery_multiinsert
org.apache.hadoop.hive.cli.TestMiniSparkOnYarnCliDriver.testCliDriver_index_bitmap3
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-MASTER-Build/106/testReport&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-MASTER-Build/106/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-MASTER-Build/106/console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-MASTER-Build/106/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://ec2-50-18-27-0.us-west-1.compute.amazonaws.com/logs/PreCommit-HIVE-MASTER-Build-106/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://ec2-50-18-27-0.us-west-1.compute.amazonaws.com/logs/PreCommit-HIVE-MASTER-Build-106/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 4 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12809813 - PreCommit-HIVE-MASTER-Build&lt;/p&gt;</comment>
                            <comment id="15327551" author="ctang.ma" created="Mon, 13 Jun 2016 15:06:31 +0000"  >&lt;p&gt;The failed tests seem not related to the patch.&lt;/p&gt;</comment>
                            <comment id="15327753" author="ychena" created="Mon, 13 Jun 2016 17:02:35 +0000"  >&lt;p&gt;After talked with &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ctang.ma&quot; class=&quot;user-hover&quot; rel=&quot;ctang.ma&quot;&gt;Chaoyu Tang&lt;/a&gt;, getLocks return all the locks related to the path. It seems a consistent behavior in EmbeddedLockManager&lt;br/&gt;
and ZooKeeperHiveLockManager. &lt;br/&gt;
So the first patch is a good fix.&lt;br/&gt;
+1 for the fix &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-13959&quot; title=&quot;MoveTask should only release its query associated locks&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-13959&quot;&gt;&lt;del&gt;HIVE-13959&lt;/del&gt;&lt;/a&gt;.patch&lt;/p&gt;</comment>
                            <comment id="15330647" author="ctang.ma" created="Tue, 14 Jun 2016 21:26:17 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-13959&quot; title=&quot;MoveTask should only release its query associated locks&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-13959&quot;&gt;&lt;del&gt;HIVE-13959&lt;/del&gt;&lt;/a&gt;.patch has committed to 2.2.0 and 2.1.1. Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ychena&quot; class=&quot;user-hover&quot; rel=&quot;ychena&quot;&gt;Yongzhi Chen&lt;/a&gt; for review.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12809813" name="HIVE-13959.1.patch" size="1996" author="ctang.ma" created="Mon, 13 Jun 2016 11:09:21 +0000"/>
                            <attachment id="12808724" name="HIVE-13959.patch" size="1777" author="ctang.ma" created="Tue, 7 Jun 2016 17:59:42 +0000"/>
                            <attachment id="12808546" name="HIVE-13959.patch" size="1777" author="ctang.ma" created="Tue, 7 Jun 2016 03:08:46 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 7 Jun 2016 17:46:33 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            24 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2z23j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>