<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sat Dec 03 23:09:46 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HIVE-8231/HIVE-8231.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HIVE-8231] Error when insert into empty table with ACID</title>
                <link>https://issues.apache.org/jira/browse/HIVE-8231</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;Steps to show the bug :&lt;br/&gt;
1. create table &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
create table encaissement_1b_64m like encaissement_1b;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;2. check table &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
desc encaissement_1b_64m;
dfs -ls hdfs:&lt;span class=&quot;code-comment&quot;&gt;//nc-h04/user/hive/warehouse/casino.db/encaissement_1b_64m;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;everything is ok:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;0: jdbc:hive2://nc-h04:10000/casino&amp;gt; desc encaissement_1b_64m;                                                                                                              +------------+------------+----------+--+
|  col_name  | data_type  | comment  |
+------------+------------+----------+--+
| id         | int        |          |
| idmagasin  | int        |          |
| zibzin     | string     |          |
| cheque     | int        |          |
| montant    | double     |          |
| date       | timestamp  |          |
| col_6      | string     |          |
| col_7      | string     |          |
| col_8      | string     |          |
+------------+------------+----------+--+
9 rows selected (0.158 seconds)
0: jdbc:hive2://nc-h04:10000/casino&amp;gt; dfs -ls hdfs://nc-h04/user/hive/warehouse/casino.db/encaissement_1b_64m/;
+-------------+--+
| DFS Output  |
+-------------+--+
+-------------+--+
No rows selected (0.01 seconds)

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;3. Insert values into the new table&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;insert into table encaissement_1b_64m VALUES (1, 1, &apos;800000000909000000000000&apos;, 1, 12.5, &apos;12/05/2014&apos;, &apos;&apos;,&apos;&apos;,&apos;&apos;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;4. Check&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;0: jdbc:hive2://nc-h04:10000/casino&amp;gt; select id from encaissement_1b_64m;
+-----+--+
| id  |
+-----+--+
+-----+--+
No rows selected (0.091 seconds)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;There are already a pb. I don&apos;t see the inserted row.&lt;/p&gt;

&lt;p&gt;5. When I&apos;m checking HDFS directory, I see &lt;tt&gt;delta_0000421_0000421&lt;/tt&gt; folder&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;0: jdbc:hive2://nc-h04:10000/casino&amp;gt; dfs -ls hdfs://nc-h04/user/hive/warehouse/casino.db/encaissement_1b_64m/;
+-----------------------------------------------------------------------------------------------------------------------------------------------------+--+
|                                                                     DFS Output                                                                      |
+-----------------------------------------------------------------------------------------------------------------------------------------------------+--+
| Found 1 items                                                                                                                                       |
| drwxr-xr-x   - hduser supergroup          0 2014-09-23 12:17 hdfs://nc-h04/user/hive/warehouse/casino.db/encaissement_1b_64m/delta_0000421_0000421  |
+-----------------------------------------------------------------------------------------------------------------------------------------------------+--+
2 rows selected (0.014 seconds)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;6. Doing a major compaction solves the bug&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;0: jdbc:hive2://nc-h04:10000/casino&amp;gt; alter table encaissement_1b_64m compact &apos;major&apos;;
No rows affected (0.046 seconds)
0: jdbc:hive2://nc-h04:10000/casino&amp;gt; dfs -ls hdfs://nc-h04/user/hive/warehouse/casino.db/encaissement_1b_64m/;
+--------------------------------------------------------------------------------------------------------------------------------------------+--+
|                                                                 DFS Output                                                                 |
+--------------------------------------------------------------------------------------------------------------------------------------------+--+
| Found 1 items                                                                                                                              |
| drwxr-xr-x   - hduser supergroup          0 2014-09-23 12:21 hdfs://nc-h04/user/hive/warehouse/casino.db/encaissement_1b_64m/base_0000421  |
+--------------------------------------------------------------------------------------------------------------------------------------------+--+
2 rows selected (0.02 seconds)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
</description>
                <environment></environment>
        <key id="12743489">HIVE-8231</key>
            <summary>Error when insert into empty table with ACID</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.png">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="3">Duplicate</resolution>
                                        <assignee username="damien.carol">Damien Carol</assignee>
                                    <reporter username="damien.carol">Damien Carol</reporter>
                        <labels>
                    </labels>
                <created>Tue, 23 Sep 2014 10:08:57 +0000</created>
                <updated>Thu, 13 Nov 2014 19:42:04 +0000</updated>
                            <resolved>Thu, 2 Oct 2014 08:26:47 +0000</resolved>
                                    <version>0.14.0</version>
                                    <fixVersion>0.14.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="14149134" author="damien.carol" created="Fri, 26 Sep 2014 13:26:25 +0000"  >&lt;p&gt;&lt;b&gt;seams to only affects ORC format&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;More investigation on last trunk (26/09/2014):&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;0: jdbc:hive2://nc-h04:10000/casino&amp;gt; drop table if exists foo6;
No rows affected (0.121 seconds)
0: jdbc:hive2://nc-h04:10000/casino&amp;gt; create table foo6 (id int);
No rows affected (0.08 seconds)
0: jdbc:hive2://nc-h04:10000/casino&amp;gt; insert into table foo6 VALUES(1);
No rows affected (2.823 seconds)
0: jdbc:hive2://nc-h04:10000/casino&amp;gt; select * from foo6;
+----------+--+
| foo6.id  |
+----------+--+
| 1        |
+----------+--+
1 row selected (0.079 seconds)
0: jdbc:hive2://nc-h04:10000/casino&amp;gt;
0: jdbc:hive2://nc-h04:10000/casino&amp;gt;
0: jdbc:hive2://nc-h04:10000/casino&amp;gt; drop table if exists foo7;
No rows affected (0.127 seconds)
0: jdbc:hive2://nc-h04:10000/casino&amp;gt; create table foo7 (id int) STORED AS ORC;
No rows affected (0.059 seconds)
0: jdbc:hive2://nc-h04:10000/casino&amp;gt; insert into table foo7 VALUES(1);
No rows affected (1.707 seconds)
0: jdbc:hive2://nc-h04:10000/casino&amp;gt; select * from foo7;
+----------+--+
| foo7.id  |
+----------+--+
+----------+--+
No rows selected (0.084 seconds)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14149142" author="damien.carol" created="Fri, 26 Sep 2014 13:38:24 +0000"  >&lt;p&gt;I see in log :&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;2014-09-26 15:32:18,483 ERROR [Thread-8]: compactor.Initiator (Initiator.java:run(111)) - Caught exception while trying to determine if we should compact testsimon.values__tmp__table__11.  Marking clean to avoid repeated failures, java.lang.NullPointerException
        at org.apache.hadoop.hive.ql.txn.compactor.Initiator.run(Initiator.java:88)

2014-09-26 15:32:18,484 ERROR [Thread-8]: txn.CompactionTxnHandler (CompactionTxnHandler.java:markCleaned(355)) - Unable to delete compaction record
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I wonder if there is a problem with the tables that store &quot;values&quot;.&lt;/p&gt;

&lt;p&gt;Every &quot;values&quot; table stay in database :&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;0: jdbc:hive2://nc-h04:10000/casino&amp;gt; show tables;
+-----------------------------------+--+
|             tab_name              |
+-----------------------------------+--+
| classification_compte             |
| dim_hotesse                       |
...
| societe                           |
| testsimon__dim_lieu_sorted_dls__  |
| values__tmp__table__10            |
| values__tmp__table__11            |
| values__tmp__table__12            |
| values__tmp__table__2             |
| values__tmp__table__3             |
| values__tmp__table__4             |
| values__tmp__table__5             |
| values__tmp__table__6             |
| values__tmp__table__7             |
| values__tmp__table__8             |
| values__tmp__table__9             |
+-----------------------------------+--+
47 rows selected (0.061 seconds)
0: jdbc:hive2://nc-h04:10000/casino&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14149206" author="alangates" created="Fri, 26 Sep 2014 14:21:08 +0000"  >&lt;p&gt;The values table should vanish as soon as you close the session that did the insert, since they are temp tables.&lt;/p&gt;</comment>
                            <comment id="14149215" author="alangates" created="Fri, 26 Sep 2014 14:28:40 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=damien.carol&quot; class=&quot;user-hover&quot; rel=&quot;damien.carol&quot;&gt;Damien Carol&lt;/a&gt;, based on your output above it looks like you are reading the data via HS2 (since it says jdbc in your command line).  There was a definite bug in using ACID via HS2.  I&apos;m curious if you still see this after &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-8203&quot; title=&quot;ACID operations result in NPE when run through HS2&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-8203&quot;&gt;&lt;del&gt;HIVE-8203&lt;/del&gt;&lt;/a&gt;.  I&apos;ll have that one checked in as soon as the 24 hours after Eugene&apos;s +1 passes.&lt;/p&gt;</comment>
                            <comment id="14149938" author="damien.carol" created="Fri, 26 Sep 2014 20:38:37 +0000"  >&lt;blockquote&gt;&lt;p&gt;&quot;... based on your output above it looks like you are reading the data via HS2.&quot;&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=alangates&quot; class=&quot;user-hover&quot; rel=&quot;alangates&quot;&gt;Alan Gates&lt;/a&gt; yes, I&apos;m using HS2. I saw your comment on &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-8203&quot; title=&quot;ACID operations result in NPE when run through HS2&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-8203&quot;&gt;&lt;del&gt;HIVE-8203&lt;/del&gt;&lt;/a&gt; and I made the link. I&apos;m waiting the fix of &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-8203&quot; title=&quot;ACID operations result in NPE when run through HS2&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-8203&quot;&gt;&lt;del&gt;HIVE-8203&lt;/del&gt;&lt;/a&gt; and I will re-test on real data.&lt;br/&gt;
The behaviour of &quot;values&quot; tables is still confusing.&lt;/p&gt;</comment>
                            <comment id="14151757" author="damien.carol" created="Mon, 29 Sep 2014 14:54:53 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=alangates&quot; class=&quot;user-hover&quot; rel=&quot;alangates&quot;&gt;Alan Gates&lt;/a&gt; I made lot of tests in WE. It seems that INSERT/DELETE/UPDATE doesn&apos;t work at all with concurrency enabled.&lt;/p&gt;

&lt;p&gt;If I deactivate ACID with :&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;&amp;lt;!-- concurrency --&amp;gt;
&amp;lt;property&amp;gt;
  &amp;lt;name&amp;gt;hive.support.concurrency&amp;lt;/name&amp;gt;
  &amp;lt;value&amp;gt;false&amp;lt;/value&amp;gt;
&amp;lt;/property&amp;gt;

&amp;lt;!-- compactor org.apache.hadoop.hive.ql.lockmgr.DummyTxnManager / org.apache.hadoop.hive.ql.lockmgr.DbTxnManager --&amp;gt;
&amp;lt;property&amp;gt;
  &amp;lt;name&amp;gt;hive.txn.manager&amp;lt;/name&amp;gt;
  &amp;lt;value&amp;gt;org.apache.hadoop.hive.ql.lockmgr.DummyTxnManager&amp;lt;/value&amp;gt;
&amp;lt;/property&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;then everything is ok.&lt;/p&gt;</comment>
                            <comment id="14151758" author="damien.carol" created="Mon, 29 Sep 2014 14:56:44 +0000"  >&lt;p&gt;To be more precise, this commands works :&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
drop table &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; exists foo6;
create table foo6 (id &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) clustered by (id) into 1 buckets;
insert into table foo6 VALUES(1);
select * from foo6;

drop table &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; exists foo7;
create table foo7 (id &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) STORED AS ORC;
insert into table foo7 VALUES(1);
select * from foo7;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14151759" author="damien.carol" created="Mon, 29 Sep 2014 14:57:56 +0000"  >&lt;p&gt;This bug is still here even with &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-8203&quot; title=&quot;ACID operations result in NPE when run through HS2&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-8203&quot;&gt;&lt;del&gt;HIVE-8203&lt;/del&gt;&lt;/a&gt; committed.&lt;/p&gt;</comment>
                            <comment id="14152007" author="alangates" created="Mon, 29 Sep 2014 18:22:47 +0000"  >&lt;p&gt;I think I can reproduce the same bug with 2 command line sessions doing things in the following order:&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;Start session 1&lt;/li&gt;
	&lt;li&gt;in session 1 insert into table&lt;/li&gt;
	&lt;li&gt;start session 2&lt;/li&gt;
	&lt;li&gt;in session 2 select * see all rows&lt;/li&gt;
	&lt;li&gt;in session 1, delete some rows&lt;/li&gt;
	&lt;li&gt;in session 1 selec *, see less rows&lt;/li&gt;
	&lt;li&gt;in session 2 select * , see all rows&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;If I stop and restart session 2 after this, than it sees the appropriate number of rows.  So either it isn&apos;t getting new transaction information for each query in the session, or the results are being cached somewhere on it.&lt;/p&gt;

&lt;p&gt;Does this match the behavior you&apos;re seeing?&lt;/p&gt;</comment>
                            <comment id="14152384" author="damien.carol" created="Mon, 29 Sep 2014 22:09:55 +0000"  >&lt;p&gt;I need to test &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=alangates&quot; class=&quot;user-hover&quot; rel=&quot;alangates&quot;&gt;Alan Gates&lt;/a&gt; use case.&lt;br/&gt;
I will also try another test:  stop and restart session between each query.&lt;/p&gt;

&lt;p&gt;Few details on my config:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;We use Tez session&lt;/li&gt;
	&lt;li&gt;We use container re-use&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14152518" author="alangates" created="Mon, 29 Sep 2014 23:35:28 +0000"  >&lt;p&gt;At the moment I&apos;m testing with MR.&lt;/p&gt;

&lt;p&gt;Also, I see that if I do a query that causes an MR job (for instance &lt;tt&gt;select count &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/star_yellow.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;)&lt;/tt&gt;) then it gets the right result.&lt;/p&gt;

&lt;p&gt;In looking through the logs the select * on session two (step 7 above) actually sees the wrong number of delta files in the directory.  I&apos;m working on debugging whether this is because it is caching the file listing (which I doubt) or because it is caching the transaction information (more likely) and not seeing the newer files because it believes it shouldn&apos;t.  I have confirmed that Driver.runInternal (which encodes the transaction information) is encoding the right information, but that may not be being properly propagated to the FileSinkOperator reading the data. &lt;/p&gt;</comment>
                            <comment id="14152951" author="damien.carol" created="Tue, 30 Sep 2014 08:32:13 +0000"  >&lt;p&gt;Restarting HDFS AND Yarn AND remote Metastore AND Hiveserver2 didn&apos;t helped.&lt;br/&gt;
I think the bug comes because there are no &quot;base&quot; dir.&lt;br/&gt;
When I&apos;m doing major compaction. The base is created and I can see the new rows.&lt;/p&gt;
</comment>
                            <comment id="14152978" author="damien.carol" created="Tue, 30 Sep 2014 08:57:43 +0000"  >&lt;p&gt;I don&apos;t think it&apos;s a cache issue. Doing stop/run of ALL daemons of the cluster change nothing.&lt;/p&gt;</comment>
                            <comment id="14153012" author="damien.carol" created="Tue, 30 Sep 2014 09:32:45 +0000"  >&lt;p&gt;Another strange result, when I&apos;m doing this query:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
select ROW__ID, INPUT__FILE__NAME, * from foo7;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I&apos;m having this result :&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;+-----------------------------------------------+-----------------------------------------------------------------------------+----------+--+
|                    row__id                    |                              input__file__name                              | foo7.id  |
+-----------------------------------------------+-----------------------------------------------------------------------------+----------+--+
| {&quot;transactionid&quot;:536,&quot;bucketid&quot;:0,&quot;rowid&quot;:0}  | hdfs://nc-h04/user/hive/warehouse/casino.db/foo7/base_0000542/bucket_00000  | 1        |
| {&quot;transactionid&quot;:537,&quot;bucketid&quot;:0,&quot;rowid&quot;:0}  | hdfs://nc-h04/user/hive/warehouse/casino.db/foo7/base_0000542/bucket_00000  | 1        |
| {&quot;transactionid&quot;:538,&quot;bucketid&quot;:0,&quot;rowid&quot;:0}  | hdfs://nc-h04/user/hive/warehouse/casino.db/foo7/base_0000542/bucket_00000  | 1        |
| {&quot;transactionid&quot;:539,&quot;bucketid&quot;:0,&quot;rowid&quot;:0}  | hdfs://nc-h04/user/hive/warehouse/casino.db/foo7/base_0000542/bucket_00000  | 1        |
| {&quot;transactionid&quot;:540,&quot;bucketid&quot;:0,&quot;rowid&quot;:0}  | hdfs://nc-h04/user/hive/warehouse/casino.db/foo7/base_0000542/bucket_00000  | 1        |
| {&quot;transactionid&quot;:541,&quot;bucketid&quot;:0,&quot;rowid&quot;:0}  | hdfs://nc-h04/user/hive/warehouse/casino.db/foo7/base_0000542/bucket_00000  | 1        |
| {&quot;transactionid&quot;:542,&quot;bucketid&quot;:0,&quot;rowid&quot;:0}  | hdfs://nc-h04/user/hive/warehouse/casino.db/foo7/base_0000542/bucket_00000  | 1        |
| {&quot;transactionid&quot;:544,&quot;bucketid&quot;:0,&quot;rowid&quot;:0}  | hdfs://nc-h04/user/hive/warehouse/casino.db/foo7/base_0000542/bucket_00000  | 1        |
| {&quot;transactionid&quot;:545,&quot;bucketid&quot;:0,&quot;rowid&quot;:0}  | hdfs://nc-h04/user/hive/warehouse/casino.db/foo7/base_0000542/bucket_00000  | 1        |
| {&quot;transactionid&quot;:546,&quot;bucketid&quot;:0,&quot;rowid&quot;:0}  | hdfs://nc-h04/user/hive/warehouse/casino.db/foo7/base_0000542/bucket_00000  | 1        |
+-----------------------------------------------+-----------------------------------------------------------------------------+----------+--+
10 rows selected (0.168 seconds)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Which is wrong.&lt;/p&gt;

&lt;p&gt;See here :&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;0: jdbc:hive2://nc-h04:10000/casino&amp;gt; dfs -ls /user/hive/warehouse/casino.db/foo7;
+-------------------------------------------------------------------------------------------------------------------------+--+
|                                                       DFS Output                                                        |
+-------------------------------------------------------------------------------------------------------------------------+--+
| Found 4 items                                                                                                           |
| drwxr-xr-x   - hduser supergroup          0 2014-09-30 11:29 /user/hive/warehouse/casino.db/foo7/base_0000542           |
| drwxr-xr-x   - hduser supergroup          0 2014-09-30 11:30 /user/hive/warehouse/casino.db/foo7/delta_0000544_0000544  |
| drwxr-xr-x   - hduser supergroup          0 2014-09-30 11:30 /user/hive/warehouse/casino.db/foo7/delta_0000545_0000545  |
| drwxr-xr-x   - hduser supergroup          0 2014-09-30 11:30 /user/hive/warehouse/casino.db/foo7/delta_0000546_0000546  |
+-------------------------------------------------------------------------------------------------------------------------+--+
5 rows selected (0.025 seconds)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14153022" author="damien.carol" created="Tue, 30 Sep 2014 09:51:13 +0000"  >&lt;p&gt;With block offset VC :&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;+-----------------------------------------------+-----------------------------------------------------------------------------+------------------------------+----------+--+
|                    row__id                    |                              input__file__name                              | block__offset__inside__file  | foo7.id  |
+-----------------------------------------------+-----------------------------------------------------------------------------+------------------------------+----------+--+
| {&quot;transactionid&quot;:536,&quot;bucketid&quot;:0,&quot;rowid&quot;:0}  | hdfs://nc-h04/user/hive/warehouse/casino.db/foo7/base_0000546/bucket_00000  | 61                           | 1        |
| {&quot;transactionid&quot;:537,&quot;bucketid&quot;:0,&quot;rowid&quot;:0}  | hdfs://nc-h04/user/hive/warehouse/casino.db/foo7/base_0000546/bucket_00000  | 122                          | 1        |
| {&quot;transactionid&quot;:538,&quot;bucketid&quot;:0,&quot;rowid&quot;:0}  | hdfs://nc-h04/user/hive/warehouse/casino.db/foo7/base_0000546/bucket_00000  | 183                          | 1        |
| {&quot;transactionid&quot;:539,&quot;bucketid&quot;:0,&quot;rowid&quot;:0}  | hdfs://nc-h04/user/hive/warehouse/casino.db/foo7/base_0000546/bucket_00000  | 244                          | 1        |
| {&quot;transactionid&quot;:540,&quot;bucketid&quot;:0,&quot;rowid&quot;:0}  | hdfs://nc-h04/user/hive/warehouse/casino.db/foo7/base_0000546/bucket_00000  | 306                          | 1        |
| {&quot;transactionid&quot;:541,&quot;bucketid&quot;:0,&quot;rowid&quot;:0}  | hdfs://nc-h04/user/hive/warehouse/casino.db/foo7/base_0000546/bucket_00000  | 367                          | 1        |
| {&quot;transactionid&quot;:542,&quot;bucketid&quot;:0,&quot;rowid&quot;:0}  | hdfs://nc-h04/user/hive/warehouse/casino.db/foo7/base_0000546/bucket_00000  | 428                          | 1        |
| {&quot;transactionid&quot;:544,&quot;bucketid&quot;:0,&quot;rowid&quot;:0}  | hdfs://nc-h04/user/hive/warehouse/casino.db/foo7/base_0000546/bucket_00000  | 489                          | 1        |
| {&quot;transactionid&quot;:545,&quot;bucketid&quot;:0,&quot;rowid&quot;:0}  | hdfs://nc-h04/user/hive/warehouse/casino.db/foo7/base_0000546/bucket_00000  | 550                          | 1        |
| {&quot;transactionid&quot;:546,&quot;bucketid&quot;:0,&quot;rowid&quot;:0}  | hdfs://nc-h04/user/hive/warehouse/casino.db/foo7/base_0000546/bucket_00000  | 612                          | 1        |
| {&quot;transactionid&quot;:547,&quot;bucketid&quot;:0,&quot;rowid&quot;:0}  | hdfs://nc-h04/user/hive/warehouse/casino.db/foo7/base_0000546/bucket_00000  | 612                          | 1        |
| {&quot;transactionid&quot;:548,&quot;bucketid&quot;:0,&quot;rowid&quot;:0}  | hdfs://nc-h04/user/hive/warehouse/casino.db/foo7/base_0000546/bucket_00000  | 612                          | 1        |
| {&quot;transactionid&quot;:549,&quot;bucketid&quot;:0,&quot;rowid&quot;:0}  | hdfs://nc-h04/user/hive/warehouse/casino.db/foo7/base_0000546/bucket_00000  | 612                          | 1        |
+-----------------------------------------------+-----------------------------------------------------------------------------+------------------------------+----------+--+
13 rows selected (0.162 seconds)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Column &lt;tt&gt;input&amp;#95;&amp;#95;file&amp;#95;&amp;#95;name&lt;/tt&gt; and &lt;tt&gt;block&amp;#95;&amp;#95;offset&amp;#95;&amp;#95;inside&amp;#95;&amp;#95;file&lt;/tt&gt; have wrong values for the last 3 rows. These rows are in delta directories.&lt;/p&gt;</comment>
                            <comment id="14153279" author="alangates" created="Tue, 30 Sep 2014 15:26:12 +0000"  >&lt;p&gt;Ok, I&apos;m not sure if we&apos;re chasing the same bug or not.  But I&apos;ll keep chasing the one I see and if we get lucky it will turn out to have the same root cause.&lt;/p&gt;

&lt;p&gt;Could you turn on debug level logging on your hive client and HiveServer2 instance, then do the insert and select that reproduces the error and attach both logs.  That would help me have an idea where things may be going wrong.&lt;/p&gt;</comment>
                            <comment id="14153281" author="alangates" created="Tue, 30 Sep 2014 15:27:00 +0000"  >&lt;p&gt;I mean JDBC client, not hive client.&lt;/p&gt;</comment>
                            <comment id="14153627" author="alangates" created="Tue, 30 Sep 2014 19:33:13 +0000"  >&lt;p&gt;I definitely think we are seeing separate issues.  I have a filed a new issue &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-8311&quot; title=&quot;Driver is encoding transaction information too late&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-8311&quot;&gt;&lt;del&gt;HIVE-8311&lt;/del&gt;&lt;/a&gt; for what I am seeing.&lt;/p&gt;</comment>
                            <comment id="14153669" author="damien.carol" created="Tue, 30 Sep 2014 19:57:29 +0000"  >&lt;p&gt;Attached few files.&lt;/p&gt;

&lt;p&gt;Use case :&lt;br/&gt;
1. drop table if exists foo7 (no log)&lt;br/&gt;
2. create table foo7 (id int) STORED AS ORC (no log)&lt;br/&gt;
3. insert into table foo7 VALUES(1) (log a_hiveserver2 and a_beeline)&lt;br/&gt;
4. select * from foo7  (log b_hiveserver2 and b_beeline)&lt;/p&gt;</comment>
                            <comment id="14153682" author="damien.carol" created="Tue, 30 Sep 2014 20:10:48 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=alangates&quot; class=&quot;user-hover&quot; rel=&quot;alangates&quot;&gt;Alan Gates&lt;/a&gt; I agree because every query in my cluster use the SAME Tez Session and reuse the same containers.&lt;br/&gt;
Feel free to help me on this one once &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-8311&quot; title=&quot;Driver is encoding transaction information too late&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-8311&quot;&gt;&lt;del&gt;HIVE-8311&lt;/del&gt;&lt;/a&gt; is out &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="14153696" author="damien.carol" created="Tue, 30 Sep 2014 20:19:26 +0000"  >&lt;p&gt;5. select distinct id from foo7 (log c_beeline and c_hiveserver2)&lt;/p&gt;</comment>
                            <comment id="14155640" author="alangates" created="Wed, 1 Oct 2014 22:08:03 +0000"  >&lt;p&gt;Damien, I&apos;m definitely still trying to debug this.  But I&apos;m juggling it with several other bugs, so it may be a day or until until I figure anything out.&lt;/p&gt;</comment>
                            <comment id="14156223" author="damien.carol" created="Thu, 2 Oct 2014 08:25:58 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=alangates&quot; class=&quot;user-hover&quot; rel=&quot;alangates&quot;&gt;Alan Gates&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-8290&quot; title=&quot;With DbTxnManager configured, all ORC tables forced to be transactional&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-8290&quot;&gt;&lt;del&gt;HIVE-8290&lt;/del&gt;&lt;/a&gt; solve this issue.&lt;/p&gt;

&lt;p&gt;As &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-8290&quot; title=&quot;With DbTxnManager configured, all ORC tables forced to be transactional&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-8290&quot;&gt;&lt;del&gt;HIVE-8290&lt;/del&gt;&lt;/a&gt; is commited, HIVE don&apos;t try to use &lt;tt&gt;foo7&lt;/tt&gt; as bucketed table.&lt;/p&gt;</comment>
                            <comment id="14210686" author="thejas" created="Thu, 13 Nov 2014 19:42:04 +0000"  >&lt;p&gt;This has been fixed in 0.14 release. Please open new jira if you see any issues.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="12744712">HIVE-8290</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12672113" name="a_beeline_insert.txt" size="43804" author="damien.carol" created="Tue, 30 Sep 2014 19:57:29 +0000"/>
                            <attachment id="12672112" name="a_hiveserver2_insert.txt" size="179988" author="damien.carol" created="Tue, 30 Sep 2014 19:57:29 +0000"/>
                            <attachment id="12672111" name="b_beeline_insert.txt" size="10202" author="damien.carol" created="Tue, 30 Sep 2014 19:57:29 +0000"/>
                            <attachment id="12672110" name="b_hiveserver2_insert.txt" size="52672" author="damien.carol" created="Tue, 30 Sep 2014 19:57:29 +0000"/>
                            <attachment id="12672122" name="c_beeline.txt" size="46131" author="damien.carol" created="Tue, 30 Sep 2014 20:19:26 +0000"/>
                            <attachment id="12672121" name="c_hiveserver2.txt" size="142069" author="damien.carol" created="Tue, 30 Sep 2014 20:19:26 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 26 Sep 2014 14:21:08 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 3 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i20dzb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>