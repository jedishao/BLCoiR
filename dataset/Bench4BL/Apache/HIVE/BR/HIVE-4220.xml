<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sat Dec 03 23:37:21 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HIVE-4220/HIVE-4220.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HIVE-4220] TimestampWritable.toString throws array index exception sometimes</title>
                <link>https://issues.apache.org/jira/browse/HIVE-4220</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.hive.service.cli.HiveSQLException: java.io.IOException: java.lang.ArrayIndexOutOfBoundsException: 45
        at org.apache.hive.service.cli.operation.SQLOperation.getNextRowSet(SQLOperation.java:215)
        at org.apache.hive.service.cli.operation.OperationManager.getOperationNextRowSet(OperationManager.java:170)
        at org.apache.hive.service.cli.CLIService.fetchResults(CLIService.java:288)
        at org.apache.hive.service.cli.thrift.ThriftCLIService.FetchResults(ThriftCLIService.java:348)
        at org.apache.hive.service.cli.thrift.TCLIService$Processor$FetchResults.getResult(TCLIService.java:1553)
        at org.apache.hive.service.cli.thrift.TCLIService$Processor$FetchResults.getResult(TCLIService.java:1538)
        at org.apache.thrift.ProcessFunction.process(ProcessFunction.java:39)
        at org.apache.thrift.TBaseProcessor.process(TBaseProcessor.java:39)
        at org.apache.thrift.server.TThreadPoolServer$WorkerProcess.run(TThreadPoolServer.java:206)
        at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)
        at java.lang.Thread.run(Thread.java:662)
Caused by: java.io.IOException: java.lang.ArrayIndexOutOfBoundsException: 45
        at org.apache.hadoop.hive.ql.exec.FetchTask.fetch(FetchTask.java:194)
        at org.apache.hadoop.hive.ql.Driver.getResults(Driver.java:1449)
        at org.apache.hive.service.cli.operation.SQLOperation.getNextRowSet(SQLOperation.java:193)
        ... 11 more
Caused by: java.lang.ArrayIndexOutOfBoundsException: 45
        at sun.util.calendar.BaseCalendar.getCalendarDateFromFixedDate(BaseCalendar.java:436)
        at java.util.GregorianCalendar.computeFields(GregorianCalendar.java:2081)
        at java.util.GregorianCalendar.computeFields(GregorianCalendar.java:1996)
        at java.util.Calendar.setTimeInMillis(Calendar.java:1110)
        at java.util.Calendar.setTime(Calendar.java:1076)
        at java.text.SimpleDateFormat.format(SimpleDateFormat.java:875)
        at java.text.SimpleDateFormat.format(SimpleDateFormat.java:868)
        at java.text.DateFormat.format(DateFormat.java:316)
        at org.apache.hadoop.hive.serde2.io.TimestampWritable.toString(TimestampWritable.java:327)
        at org.apache.hadoop.hive.serde2.lazy.LazyTimestamp.writeUTF8(LazyTimestamp.java:95)
        at org.apache.hadoop.hive.serde2.lazy.LazyUtils.writePrimitiveUTF8(LazyUtils.java:234)
        at org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe.serialize(LazySimpleSerDe.java:427)
        at org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe.serializeField(LazySimpleSerDe.java:381)
        at org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe.serialize(LazySimpleSerDe.java:365)
        at org.apache.hadoop.hive.ql.exec.ListSinkOperator.processOp(ListSinkOperator.java:96)
        at org.apache.hadoop.hive.ql.exec.Operator.process(Operator.java:487)
        at org.apache.hadoop.hive.ql.exec.Operator.forward(Operator.java:821)
        at org.apache.hadoop.hive.ql.exec.SelectOperator.processOp(SelectOperator.java:84)
        at org.apache.hadoop.hive.ql.exec.Operator.process(Operator.java:487)
        at org.apache.hadoop.hive.ql.exec.Operator.forward(Operator.java:821)
        at org.apache.hadoop.hive.ql.exec.TableScanOperator.processOp(TableScanOperator.java:90)
        at org.apache.hadoop.hive.ql.exec.Operator.process(Operator.java:487)
        at org.apache.hadoop.hive.ql.exec.FetchOperator.pushRow(FetchOperator.java:474)
        at org.apache.hadoop.hive.ql.exec.FetchOperator.pushRow(FetchOperator.java:468)
        at org.apache.hadoop.hive.ql.exec.FetchTask.fetchAndPush(FetchTask.java:222)
        at org.apache.hadoop.hive.ql.exec.FetchTask.fetch(FetchTask.java:188)
        ... 13 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;data formatter in TimestampWritable is declared static and shared but it&apos;s not thread-safe.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12638443">HIVE-4220</key>
            <summary>TimestampWritable.toString throws array index exception sometimes</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="3">Duplicate</resolution>
                                        <assignee username="navis">Navis</assignee>
                                    <reporter username="navis">Navis</reporter>
                        <labels>
                    </labels>
                <created>Fri, 22 Mar 2013 05:28:04 +0000</created>
                <updated>Thu, 23 May 2013 03:50:56 +0000</updated>
                            <resolved>Thu, 23 May 2013 03:50:56 +0000</resolved>
                                                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                <comments>
                            <comment id="13610024" author="phabricator@reviews.facebook.net" created="Fri, 22 Mar 2013 07:55:14 +0000"  >&lt;p&gt;navis requested code review of &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-4220&quot; title=&quot;TimestampWritable.toString throws array index exception sometimes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-4220&quot;&gt;&lt;del&gt;HIVE-4220&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; TimestampWritable.toString throws array index exception sometimes&quot;.&lt;/p&gt;

&lt;p&gt;Reviewers: JIRA&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-4220&quot; title=&quot;TimestampWritable.toString throws array index exception sometimes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-4220&quot;&gt;&lt;del&gt;HIVE-4220&lt;/del&gt;&lt;/a&gt; TimestampWritable.toString throws array index exception sometimes&lt;/p&gt;

&lt;p&gt;org.apache.hive.service.cli.HiveSQLException: java.io.IOException: java.lang.ArrayIndexOutOfBoundsException: 45&lt;br/&gt;
        at org.apache.hive.service.cli.operation.SQLOperation.getNextRowSet(SQLOperation.java:215)&lt;br/&gt;
        at org.apache.hive.service.cli.operation.OperationManager.getOperationNextRowSet(OperationManager.java:170)&lt;br/&gt;
        at org.apache.hive.service.cli.CLIService.fetchResults(CLIService.java:288)&lt;br/&gt;
        at org.apache.hive.service.cli.thrift.ThriftCLIService.FetchResults(ThriftCLIService.java:348)&lt;br/&gt;
        at org.apache.hive.service.cli.thrift.TCLIService$Processor$FetchResults.getResult(TCLIService.java:1553)&lt;br/&gt;
        at org.apache.hive.service.cli.thrift.TCLIService$Processor$FetchResults.getResult(TCLIService.java:1538)&lt;br/&gt;
        at org.apache.thrift.ProcessFunction.process(ProcessFunction.java:39)&lt;br/&gt;
        at org.apache.thrift.TBaseProcessor.process(TBaseProcessor.java:39)&lt;br/&gt;
        at org.apache.thrift.server.TThreadPoolServer$WorkerProcess.run(TThreadPoolServer.java:206)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)&lt;br/&gt;
        at java.lang.Thread.run(Thread.java:662)&lt;br/&gt;
Caused by: java.io.IOException: java.lang.ArrayIndexOutOfBoundsException: 45&lt;br/&gt;
        at org.apache.hadoop.hive.ql.exec.FetchTask.fetch(FetchTask.java:194)&lt;br/&gt;
        at org.apache.hadoop.hive.ql.Driver.getResults(Driver.java:1449)&lt;br/&gt;
        at org.apache.hive.service.cli.operation.SQLOperation.getNextRowSet(SQLOperation.java:193)&lt;br/&gt;
        ... 11 more&lt;br/&gt;
Caused by: java.lang.ArrayIndexOutOfBoundsException: 45&lt;br/&gt;
        at sun.util.calendar.BaseCalendar.getCalendarDateFromFixedDate(BaseCalendar.java:436)&lt;br/&gt;
        at java.util.GregorianCalendar.computeFields(GregorianCalendar.java:2081)&lt;br/&gt;
        at java.util.GregorianCalendar.computeFields(GregorianCalendar.java:1996)&lt;br/&gt;
        at java.util.Calendar.setTimeInMillis(Calendar.java:1110)&lt;br/&gt;
        at java.util.Calendar.setTime(Calendar.java:1076)&lt;br/&gt;
        at java.text.SimpleDateFormat.format(SimpleDateFormat.java:875)&lt;br/&gt;
        at java.text.SimpleDateFormat.format(SimpleDateFormat.java:868)&lt;br/&gt;
        at java.text.DateFormat.format(DateFormat.java:316)&lt;br/&gt;
        at org.apache.hadoop.hive.serde2.io.TimestampWritable.toString(TimestampWritable.java:327)&lt;br/&gt;
        at org.apache.hadoop.hive.serde2.lazy.LazyTimestamp.writeUTF8(LazyTimestamp.java:95)&lt;br/&gt;
        at org.apache.hadoop.hive.serde2.lazy.LazyUtils.writePrimitiveUTF8(LazyUtils.java:234)&lt;br/&gt;
        at org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe.serialize(LazySimpleSerDe.java:427)&lt;br/&gt;
        at org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe.serializeField(LazySimpleSerDe.java:381)&lt;br/&gt;
        at org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe.serialize(LazySimpleSerDe.java:365)&lt;br/&gt;
        at org.apache.hadoop.hive.ql.exec.ListSinkOperator.processOp(ListSinkOperator.java:96)&lt;br/&gt;
        at org.apache.hadoop.hive.ql.exec.Operator.process(Operator.java:487)&lt;br/&gt;
        at org.apache.hadoop.hive.ql.exec.Operator.forward(Operator.java:821)&lt;br/&gt;
        at org.apache.hadoop.hive.ql.exec.SelectOperator.processOp(SelectOperator.java:84)&lt;br/&gt;
        at org.apache.hadoop.hive.ql.exec.Operator.process(Operator.java:487)&lt;br/&gt;
        at org.apache.hadoop.hive.ql.exec.Operator.forward(Operator.java:821)&lt;br/&gt;
        at org.apache.hadoop.hive.ql.exec.TableScanOperator.processOp(TableScanOperator.java:90)&lt;br/&gt;
        at org.apache.hadoop.hive.ql.exec.Operator.process(Operator.java:487)&lt;br/&gt;
        at org.apache.hadoop.hive.ql.exec.FetchOperator.pushRow(FetchOperator.java:474)&lt;br/&gt;
        at org.apache.hadoop.hive.ql.exec.FetchOperator.pushRow(FetchOperator.java:468)&lt;br/&gt;
        at org.apache.hadoop.hive.ql.exec.FetchTask.fetchAndPush(FetchTask.java:222)&lt;br/&gt;
        at org.apache.hadoop.hive.ql.exec.FetchTask.fetch(FetchTask.java:188)&lt;br/&gt;
        ... 13 more&lt;/p&gt;

&lt;p&gt;data formatter in TimestampWritable is declared static and shared but it&apos;s not thread-safe.&lt;/p&gt;

&lt;p&gt;TEST PLAN&lt;br/&gt;
  EMPTY&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D9669&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D9669&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;AFFECTED FILES&lt;br/&gt;
  serde/src/java/org/apache/hadoop/hive/serde2/io/TimestampWritable.java&lt;/p&gt;

&lt;p&gt;MANAGE HERALD RULES&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/herald/view/differential/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/herald/view/differential/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;WHY DID I GET THIS EMAIL?&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/herald/transcript/23067/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/herald/transcript/23067/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To: JIRA, navis&lt;/p&gt;</comment>
                            <comment id="13624532" author="ashutoshc" created="Sat, 6 Apr 2013 23:22:40 +0000"  >&lt;p&gt;Since there is no test-case, I am having hard time envisioning the scenario where this might occur. Is it that there is a concurrent access of this non-thread-safe formatter where this will occur? Explaining the scenario where this bug will showup will be useful.&lt;/p&gt;</comment>
                            <comment id="13624779" author="navis" created="Sun, 7 Apr 2013 07:54:48 +0000"  >&lt;p&gt;Yes it is, and it&apos;s very hard to reproduce. It happened once on hive server when multiple clients are fetching rows containing timestamp and after applying this, not happened till now.&lt;/p&gt;</comment>
                            <comment id="13652133" author="mikhail" created="Wed, 8 May 2013 17:59:59 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=navis&quot; class=&quot;user-hover&quot; rel=&quot;navis&quot;&gt;Navis&lt;/a&gt;: I think &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-4516&quot; title=&quot;Fix concurrency bug in serde/src/java/org/apache/hadoop/hive/serde2/io/TimestampWritable.java&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-4516&quot;&gt;&lt;del&gt;HIVE-4516&lt;/del&gt;&lt;/a&gt; solves the same problem but in somewhat simpler way (using ThreadLocal). Could you please take a look at the patch there and let us know what you think?&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ashutoshc&quot; class=&quot;user-hover&quot; rel=&quot;ashutoshc&quot;&gt;Ashutosh Chauhan&lt;/a&gt;: I think it is reasonable to assume at this point that Hive primitives, especially as low-level as TimestampWritable, have to be thread-safe. This is not only required by third-party low-latency query processing systems such as AmpLab&apos;s Shark, but also by the effort in the Hive community itself to speed up query processing (e.g. &lt;a href=&quot;http://hortonworks.com/blog/introducing-tez-faster-hadoop-processing/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hortonworks.com/blog/introducing-tez-faster-hadoop-processing/&lt;/a&gt;) that I believe will inevitably require keeping pre-existing multi-threaded &quot;executor&quot; JVMs around.&lt;/p&gt;</comment>
                            <comment id="13664801" author="navis" created="Thu, 23 May 2013 02:30:11 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mikhail&quot; class=&quot;user-hover&quot; rel=&quot;mikhail&quot;&gt;Mikhail Bautin&lt;/a&gt; The default value of max-worker of HiveServer is Integer.MAX and I&apos;ve thought it could make too many formatters in some (erroneous) situation. But admittedly, it&apos;s safer and cleaner. +1 and running test.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="12646446">HIVE-4516</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12574981" name="HIVE-4220.D9669.1.patch" size="2297" author="phabricator@reviews.facebook.net" created="Fri, 22 Mar 2013 07:55:14 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 22 Mar 2013 07:55:14 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>318919</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 28 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1j113:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>319260</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>