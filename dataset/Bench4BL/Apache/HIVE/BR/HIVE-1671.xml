<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sat Dec 03 01:01:00 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HIVE-1671/HIVE-1671.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HIVE-1671] multithreading on Context.pathToCS</title>
                <link>https://issues.apache.org/jira/browse/HIVE-1671</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;we having 2 threads running at 100%&lt;/p&gt;

&lt;p&gt;With a stacktrace like this:&lt;/p&gt;

&lt;p&gt;&quot;Thread-16725&quot; prio=10 tid=0x00007ff410662000 nid=0x497d runnable &lt;span class=&quot;error&quot;&gt;&amp;#91;0x00000000442eb000&amp;#93;&lt;/span&gt;&lt;br/&gt;
   java.lang.Thread.State: RUNNABLE&lt;br/&gt;
        at java.util.HashMap.get(HashMap.java:303)&lt;br/&gt;
        at org.apache.hadoop.hive.ql.Context.getCS(Context.java:524)&lt;br/&gt;
        at org.apache.hadoop.hive.ql.exec.Utilities.getInputSummary(Utilities.java:1369)&lt;br/&gt;
        at org.apache.hadoop.hive.ql.exec.MapRedTask.estimateNumberOfReducers(MapRedTask.java:329)&lt;br/&gt;
        at org.apache.hadoop.hive.ql.exec.MapRedTask.setNumberOfReducers(MapRedTask.java:297)&lt;br/&gt;
        at org.apache.hadoop.hive.ql.exec.MapRedTask.execute(MapRedTask.java:84)&lt;br/&gt;
        at org.apache.hadoop.hive.ql.exec.Task.executeTask(Task.java:108)&lt;br/&gt;
        at org.apache.hadoop.hive.ql.exec.TaskRunner.runSequential(TaskRunner.java:55)&lt;br/&gt;
        at org.apache.hadoop.hive.ql.exec.TaskRunner.run(TaskRunner.java:47)&lt;/p&gt;</description>
                <environment></environment>
        <key id="12475177">HIVE-1671</key>
            <summary>multithreading on Context.pathToCS</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="bennies">Bennie Schut</assignee>
                                    <reporter username="bennies">Bennie Schut</reporter>
                        <labels>
                    </labels>
                <created>Mon, 27 Sep 2010 10:03:17 +0000</created>
                <updated>Sat, 17 Dec 2011 00:00:46 +0000</updated>
                            <resolved>Tue, 28 Sep 2010 00:35:36 +0000</resolved>
                                                    <fixVersion>0.7.0</fixVersion>
                                    <component>Query Processor</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12915262" author="bennies" created="Mon, 27 Sep 2010 10:10:56 +0000"  >&lt;p&gt;Perhaps because we now have multiple sub queries running in hive for the same overall query we can have concurrent use of this map?&lt;br/&gt;
We could simply fix this by using the ConcurrentHashMap&lt;/p&gt;


&lt;p&gt;  private Map&amp;lt;String, ContentSummary&amp;gt; pathToCS = new ConcurrentHashMap&amp;lt;String, ContentSummary&amp;gt;();&lt;/p&gt;</comment>
                            <comment id="12915265" author="bennies" created="Mon, 27 Sep 2010 10:32:59 +0000"  >&lt;p&gt;No tests are added. It would be difficult to time a test to reproduce this and then it would show a normal HashMap isn&apos;t thread safe which we already know.&lt;/p&gt;</comment>
                            <comment id="12915275" author="hbasereviewboard" created="Mon, 27 Sep 2010 11:35:55 +0000"  >&lt;p&gt;Message from: &quot;Bennie Schut&quot; &amp;lt;bennie@schut.cc&amp;gt;&lt;/p&gt;

&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;http://review.cloudera.org/r/909/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.cloudera.org/r/909/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;Review request for Hive Developers.&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;simple change HashMap into ConcurrentHashMap&lt;/p&gt;


&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-1671&quot; title=&quot;multithreading on Context.pathToCS&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-1671&quot;&gt;&lt;del&gt;HIVE-1671&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;http://issues.apache.org/jira/browse/HIVE-1671&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/browse/HIVE-1671&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  trunk/ql/src/java/org/apache/hadoop/hive/ql/Context.java 1001658 &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;http://review.cloudera.org/r/909/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.cloudera.org/r/909/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Bennie&lt;/p&gt;

</comment>
                            <comment id="12915440" author="namit" created="Mon, 27 Sep 2010 19:21:58 +0000"  >&lt;p&gt;Are your using HiveServer ?&lt;/p&gt;

&lt;p&gt;&amp;gt;&amp;gt; we having 2 threads running at 100%&lt;/p&gt;

&lt;p&gt;What do you mean by the above ? Are you setting hive.exec.parallel to true, in which case, I can see the problem happening ?&lt;/p&gt;</comment>
                            <comment id="12915468" author="bennies" created="Mon, 27 Sep 2010 20:30:36 +0000"  >&lt;p&gt;Sorry I was a bit short on the description. I&apos;m running the HiveServer with hive.exec.parallel set to true. I&apos;m running many jobs each day for about a week after startup. Then I notice 2 threads are stuck at 100% cpu for about 3days. I used jstack to look at both threads and they showed the same stacktrace.&lt;/p&gt;</comment>
                            <comment id="12915508" author="namit" created="Mon, 27 Sep 2010 22:04:53 +0000"  >&lt;p&gt;OK, I can now see the problem.&lt;/p&gt;

&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="12915572" author="namit" created="Tue, 28 Sep 2010 00:35:35 +0000"  >&lt;p&gt;Committed. Thanks Bennie&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12455656" name="HIVE-1671-1.patch" size="1277" author="bennies" created="Mon, 27 Sep 2010 10:32:59 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 27 Sep 2010 11:35:55 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>72781</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 10 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0lgav:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>123291</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>