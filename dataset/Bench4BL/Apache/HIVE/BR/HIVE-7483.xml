<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sat Dec 03 23:42:44 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HIVE-7483/HIVE-7483.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HIVE-7483] hive insert overwrite table select from self dead lock</title>
                <link>https://issues.apache.org/jira/browse/HIVE-7483</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;CREATE TABLE test(&lt;br/&gt;
  id int, &lt;br/&gt;
  msg string)&lt;br/&gt;
PARTITIONED BY ( &lt;br/&gt;
  continent string, &lt;br/&gt;
  country string)&lt;br/&gt;
CLUSTERED BY (id) &lt;br/&gt;
INTO 10 BUCKETS&lt;br/&gt;
STORED AS ORC;&lt;/p&gt;

&lt;p&gt;alter table test add partition(continent=&apos;Asia&apos;,country=&apos;India&apos;);&lt;/p&gt;

&lt;p&gt;in hive-site.xml:&lt;br/&gt;
hive.txn.manager=org.apache.hadoop.hive.ql.lockmgr.DbTxnManager;&lt;br/&gt;
hive.support.concurrency=true;&lt;/p&gt;

&lt;p&gt;in hive shell:&lt;br/&gt;
set hive.input.format=org.apache.hadoop.hive.ql.io.HiveInputFormat;&lt;/p&gt;

&lt;p&gt;insert into test table some records first.&lt;/p&gt;

&lt;p&gt;then execute sql:&lt;br/&gt;
insert overwrite table test partition(continent=&apos;Asia&apos;,country=&apos;India&apos;) select id,msg from test;&lt;/p&gt;

&lt;p&gt;the log stop at :&lt;br/&gt;
INFO log.PerfLogger: &amp;lt;PERFLOG method=acquireReadWriteLocks from=org.apache.hadoop.hive.ql.Driver&amp;gt;&lt;/p&gt;

&lt;p&gt;i think it has dead lock when insert overwrite table from it self.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12729076">HIVE-7483</key>
            <summary>hive insert overwrite table select from self dead lock</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="3">Duplicate</resolution>
                                        <assignee username="ekoifman">Eugene Koifman</assignee>
                                    <reporter username="wangxiaoyu">Xiaoyu Wang</reporter>
                        <labels>
                    </labels>
                <created>Wed, 23 Jul 2014 03:02:34 +0000</created>
                <updated>Fri, 21 Oct 2016 00:48:43 +0000</updated>
                            <resolved>Fri, 21 Oct 2016 00:48:43 +0000</resolved>
                                    <version>0.13.1</version>
                                                    <component>Locking</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>4</watches>
                                                                <comments>
                            <comment id="14071344" author="ekoifman" created="Wed, 23 Jul 2014 04:19:34 +0000"  >&lt;p&gt;DbTxnManager will use DbLockManager(), so I think hive.zookeeper.quorum is not relevant.&lt;/p&gt;</comment>
                            <comment id="14071356" author="wangxiaoyu" created="Wed, 23 Jul 2014 04:43:48 +0000"  >&lt;p&gt;yes you are right!&lt;/p&gt;</comment>
                            <comment id="14072654" author="wangxiaoyu" created="Thu, 24 Jul 2014 00:55:46 +0000"  >&lt;p&gt;but still deadlock.&lt;/p&gt;</comment>
                            <comment id="14714475" author="fpin" created="Wed, 26 Aug 2015 16:34:06 +0000"  >&lt;p&gt;I confirm, we are having the same issue on Hive 1.1.0, and I reproduced it on 1.2.1&lt;/p&gt;

&lt;p&gt;CREATE TABLE test_db.test_table (id INT) &lt;br/&gt;
PARTITIONED BY (part STRING)&lt;br/&gt;
STORED AS ORC ;&lt;/p&gt;

&lt;p&gt;INSERT INTO TABLE test_db.test_table PARTITION (part=&quot;test&quot;)&lt;br/&gt;
VALUES (1), (2), (3), (4) &lt;br/&gt;
;&lt;/p&gt;

&lt;p&gt;SET hive.exec.dynamic.partition.mode=nonstrict ;&lt;br/&gt;
SET hive.support.concurrency=true ;&lt;/p&gt;

&lt;p&gt;INSERT OVERWRITE TABLE test_db.test_table PARTITION (part)&lt;br/&gt;
SELECT * FROM test_db.test_table ;&lt;/p&gt;

&lt;p&gt;nothing happens, and when doing a SHOW LOCKS in another shell we get :&lt;/p&gt;

&lt;p&gt;&lt;ins&gt;---------&lt;del&gt;&lt;/ins&gt;&lt;/del&gt;---------&lt;del&gt;&lt;ins&gt;&lt;/del&gt;----------&lt;del&gt;&lt;/ins&gt;&lt;/del&gt;----------&lt;del&gt;&lt;ins&gt;&lt;/del&gt;-----------&lt;del&gt;&lt;/ins&gt;&lt;/del&gt;------------&lt;del&gt;&lt;ins&gt;&lt;/del&gt;---------------&lt;del&gt;&lt;/ins&gt;&lt;/del&gt;---------------&lt;del&gt;&lt;ins&gt;&lt;/del&gt;---------------&lt;/ins&gt;&lt;/p&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; lockid   &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; database  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; table      &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; partition  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; lock_state  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; lock_type    &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; transaction_id  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; last_heartbeat  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;  acquired_at   &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;

&lt;p&gt;&lt;ins&gt;---------&lt;del&gt;&lt;/ins&gt;&lt;/del&gt;---------&lt;del&gt;&lt;ins&gt;&lt;/del&gt;----------&lt;del&gt;&lt;/ins&gt;&lt;/del&gt;----------&lt;del&gt;&lt;ins&gt;&lt;/del&gt;-----------&lt;del&gt;&lt;/ins&gt;&lt;/del&gt;------------&lt;del&gt;&lt;ins&gt;&lt;/del&gt;---------------&lt;del&gt;&lt;/ins&gt;&lt;/del&gt;---------------&lt;del&gt;&lt;ins&gt;&lt;/del&gt;---------------&lt;/ins&gt;&lt;/p&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 3765     &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; test_db   &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; test_table &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; NULL       &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; WAITING     &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; EXCLUSIVE    &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; NULL            &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 1440603633148   &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; NULL           &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 3765     &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; test_db   &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; test_table &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; part=test  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; WAITING     &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; SHARED_READ  &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; NULL            &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 1440603633148   &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; NULL           &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;

&lt;p&gt;&lt;ins&gt;---------&lt;del&gt;&lt;/ins&gt;&lt;/del&gt;---------&lt;del&gt;&lt;ins&gt;&lt;/del&gt;----------&lt;del&gt;&lt;/ins&gt;&lt;/del&gt;----------&lt;del&gt;&lt;ins&gt;&lt;/del&gt;-----------&lt;del&gt;&lt;/ins&gt;&lt;/del&gt;------------&lt;del&gt;&lt;ins&gt;&lt;/del&gt;---------------&lt;del&gt;&lt;/ins&gt;&lt;/del&gt;---------------&lt;del&gt;&lt;ins&gt;&lt;/del&gt;---------------&lt;/ins&gt;&lt;/p&gt;

&lt;p&gt;from looking at the source of org.apache.hadoop.hive.ql.lockmgr.EmbeddedLockManager, I would say it is stuck&lt;br/&gt;
in the for loop of the method lock(List&amp;lt;HiveLockObj&amp;gt; objs, int numRetriesForLock, long sleepTime), &lt;br/&gt;
where lockPrimitive() keeps failing on the second lock.&lt;/p&gt;




</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="12823883">HIVE-10483</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 23 Jul 2014 04:19:34 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>407150</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 14 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1y293:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>407166</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>