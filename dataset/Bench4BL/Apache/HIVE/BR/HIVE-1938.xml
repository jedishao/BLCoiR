<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun Dec 04 00:14:44 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HIVE-1938/HIVE-1938.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HIVE-1938] Cost Based Query optimization for Joins in Hive</title>
                <link>https://issues.apache.org/jira/browse/HIVE-1938</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;Current optimization in Hive is just rule-based and involves applying a set of rules on the Plan tree. This depends on hints given by the user (which may or may-not be correct) and might result in execution of costlier plans.So this jira aims at building a cost-model which can give a good estimate various plans before hand (using some meta-data already collected) and we can choose the best plan which incurs the least cost.&lt;/p&gt;</description>
                <environment>&lt;p&gt;*nix,java&lt;/p&gt;</environment>
        <key id="12497287">HIVE-1938</key>
            <summary>Cost Based Query optimization for Joins in Hive</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="bharathv">bharath v</assignee>
                                    <reporter username="bharathv">bharath v</reporter>
                        <labels>
                    </labels>
                <created>Tue, 1 Feb 2011 06:50:48 +0000</created>
                <updated>Tue, 12 Jun 2012 00:15:07 +0000</updated>
                                                                            <component>Query Processor</component>
                    <component>Statistics</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>19</watches>
                                                                <comments>
                            <comment id="12989084" author="bharathv" created="Tue, 1 Feb 2011 08:03:51 +0000"  >&lt;p&gt;I have a few basic ideas about join costs. Consider the case of Common Join(We can extend it to other joins) for which I propose a mathematical approach.&lt;/p&gt;


&lt;p&gt;We can consider disk IO and Communication cost as the major bottlenecks and optimize the join based on these factors.The challenge here is in predicting the size of the intermediate tables output ( while joining more than 2 tables).&lt;/p&gt;

&lt;p&gt;Suppose the there are &quot;N&quot; machines in the Hive-Hadoop cluster.&lt;/p&gt;

&lt;p&gt;Suppose we are joining 2 table &quot;A&quot; on column &quot;a&quot; with  table &quot;B&quot; ob column &quot;b&quot;.Table A contains n1 rows and table B has n2 rows. Suppose A.a has &quot;d1&quot; distinct values and B.b has &quot;d2&quot; distinct values and suppose d1&amp;lt;d2 without loss of generality. The cost computation of a single join can be divided into 3 phases &lt;/p&gt;

&lt;p&gt;1) Map phase : &lt;br/&gt;
   Both the tables are scanned from the disks once and we can assume that this is done parallely on N machines. So total disk IO cost is estimated as O((n1+n2)/N) (Assuming constant page size)&lt;/p&gt;

&lt;p&gt;2) Shuffle Phase:&lt;br/&gt;
   The cost estimation during this phase depends on the type of join. In the worst case every row gets transferred to a reducer on different machine (other than the one on which it resides). This results in movement of every row to a different machine . Assuming some constant ping-time (that we get after making some avg calculations) the cost is O(k*(n1+n2)) where this k is &quot;cost/unit-transfer&quot; of data. Actual shuffle costs may be less than this due to &quot;maximizing locality&quot; effect in hadoop MR. Iam just providing an upper bound and we can surely improve upon this depending on the type of join.&lt;/p&gt;

&lt;p&gt;For eg: Consider map-side join we can add the cost of moving the smaller table to all the mappers = O(k*N*N3) where N3 is no. of rows in the smaller table.&lt;/p&gt;

&lt;p&gt;3) Reduce phase :&lt;/p&gt;

&lt;p&gt;In each reduce we just do a simple nested-loop join. Assuming &quot;AVERAGE DISTRIBUTION&quot; of data, we get (n1/d1) rows of &quot;A&quot; and (n2/d2) rows of &quot;B&quot; per a single call of reducer and cost for this is O(n1/d1*n2/d2) and there can be at-max d1/N sequential reducers running . So multiplying that factor, the total cost is O((n1*n2)/(N*d2)).&lt;/p&gt;

&lt;p&gt;The above cost is as a result of assuming uniform distribution of data per table. We can improve this by maintaining histograms of statistics per node by which we can improve upon this calculation.&lt;/p&gt;

&lt;p&gt;After calculation of join cost we need to predict the size of resultant join table so that it&apos;s statistics can be used in continuing the above procedure for the rest of the tables.&lt;/p&gt;

&lt;p&gt;Estimating the result table size:&lt;/p&gt;

&lt;p&gt;The resultant table will have O(n1*n2/d1) rows assuming that the distribution of A.a and B.b &apos;s distinct values is same. This is where we can improve a great deal by maintaining good statistics so that we can predict correct size of the resultant table.&lt;/p&gt;

&lt;p&gt;We can follow a simple system-R approach of dynamic programming where we choose the best-ones in each iteration using the above cost formulae.&lt;/p&gt;

&lt;p&gt;This is a pretty long post already .. This is the basic approach and we can improve upon this further depending on the feedback I get.&lt;/p&gt;

&lt;p&gt;I presented this work as a poster at ACM-SIGMOD 2010 and I got some positive feedback.&lt;/p&gt;


</comment>
                            <comment id="12989389" author="namit" created="Tue, 1 Feb 2011 21:30:35 +0000"  >&lt;p&gt;Currently, Hive does not maintain statistics (distinct values per table/partition), which is the basis for the&lt;br/&gt;
cost model for this discussion.&lt;/p&gt;

&lt;p&gt;Do you want to work on collecting such statistis first, and then we can use them for various plan optimizations ?&lt;/p&gt;

&lt;p&gt;I can think of some advantages of the cost model right away (and I am sure there are many more):&lt;br/&gt;
1. Predict &quot;progress&quot; for a query, predict the time taken.&lt;br/&gt;
2. Determine the join order.&lt;/p&gt;
</comment>
                            <comment id="12989404" author="bharathv" created="Tue, 1 Feb 2011 22:02:01 +0000"  >&lt;p&gt;Can you please see &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-33&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-33&lt;/a&gt; .. Column-level statistics part remain unresolved though!&lt;/p&gt;</comment>
                            <comment id="12989488" author="namit" created="Wed, 2 Feb 2011 01:20:48 +0000"  >&lt;p&gt;Yes, but do need column stats for this&lt;/p&gt;</comment>
                            <comment id="12989541" author="bharathv" created="Wed, 2 Feb 2011 07:23:41 +0000"  >&lt;p&gt;So do I need to start working on collecting column-stats first and then continue to join reordering ? Any hints or suggestions on where to start ?&lt;/p&gt;</comment>
                            <comment id="12989582" author="bharathv" created="Wed, 2 Feb 2011 10:08:08 +0000"  >&lt;p&gt;We need &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-1362&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-1362&lt;/a&gt; to resolved to start this .. But it seems to be inactive. &lt;/p&gt;</comment>
                            <comment id="12989583" author="bharathv" created="Wed, 2 Feb 2011 10:13:02 +0000"  >&lt;p&gt;We need column level statistics per table to implement our cost model.&lt;/p&gt;</comment>
                            <comment id="12989585" author="bharathv" created="Wed, 2 Feb 2011 10:14:31 +0000"  >&lt;p&gt;We need column level statistics to implement our cost model.&lt;/p&gt;</comment>
                            <comment id="13235914" author="srini1985" created="Thu, 22 Mar 2012 19:15:55 +0000"  >&lt;p&gt;Bharath, &lt;br/&gt;
       Still you are working with this ticket. I am interested in doing join optimization in Hive. I am also interested in the idea of implementing statistics in Hive. Does it implemented??&lt;/p&gt;

&lt;p&gt;If you are not working I can take this ticket and work or Suggest me some ticket related to this, so that I can take it up and work.&lt;/p&gt;</comment>
                            <comment id="13236032" author="bharathv" created="Thu, 22 Mar 2012 21:06:57 +0000"  >&lt;p&gt;Hey,&lt;/p&gt;

&lt;p&gt;I am currently working on Hive-33 (which blocks this JIRA) and I am submitting a proposal to GSOC&apos;2012. If everything works as planned, I&apos;ll submit some patches for it in a couple of months or so. &lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                                                <inwardlinks description="is blocked by">
                                        <issuelink>
            <issuekey id="12465176">HIVE-1362</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12497405">HIVE-1940</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12497405">HIVE-1940</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12555278">HIVE-3027</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12407019">HIVE-33</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 1 Feb 2011 21:30:35 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>42327</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 37 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i00x6f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3307</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310230" key="com.atlassian.jira.plugin.system.customfieldtypes:textfield">
                        <customfieldname>Tags</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Query optimization . Query processor</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>