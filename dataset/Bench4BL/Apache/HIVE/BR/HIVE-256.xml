<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sat Dec 03 00:37:04 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HIVE-256/HIVE-256.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HIVE-256] map side aggregation : number of output rows is same as number of input rows</title>
                <link>https://issues.apache.org/jira/browse/HIVE-256</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;map side aggregation : number of output rows is same as number of input rows&lt;/p&gt;</description>
                <environment></environment>
        <key id="12413503">HIVE-256</key>
            <summary>map side aggregation : number of output rows is same as number of input rows</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="namit">Namit Jain</assignee>
                                    <reporter username="namit">Namit Jain</reporter>
                        <labels>
                    </labels>
                <created>Wed, 28 Jan 2009 23:56:08 +0000</created>
                <updated>Sat, 17 Dec 2011 00:08:35 +0000</updated>
                            <resolved>Thu, 29 Jan 2009 03:55:26 +0000</resolved>
                                                    <fixVersion>0.3.0</fixVersion>
                                    <component>Query Processor</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12668281" author="athusoo" created="Thu, 29 Jan 2009 01:55:49 +0000"  >&lt;p&gt;can you give a description of the bug? How is it triggered?&lt;/p&gt;</comment>
                            <comment id="12668282" author="athusoo" created="Thu, 29 Jan 2009 01:57:19 +0000"  >&lt;p&gt;where is the aggrPositions variable used? Seems like it is not used anywhere...&lt;/p&gt;</comment>
                            <comment id="12668301" author="namit" created="Thu, 29 Jan 2009 03:02:28 +0000"  >&lt;p&gt;It is used to keep track of the aggregation classes using variable length fields. There were few bugs there, which were getting hidden because the reflection API getFields() only shows public fields, whereas getDeclaredFields() shows all fields.&lt;/p&gt;

&lt;p&gt;For example, max has a string variable whose size is not fixed, it is sampled at runtime&lt;/p&gt;</comment>
                            <comment id="12668307" author="athusoo" created="Thu, 29 Jan 2009 03:26:36 +0000"  >&lt;p&gt;got it..&lt;/p&gt;

&lt;p&gt;+1&lt;/p&gt;

&lt;p&gt;Running tests now and will check in if everything passes.&lt;/p&gt;</comment>
                            <comment id="12668310" author="jsensarma" created="Thu, 29 Jan 2009 03:42:09 +0000"  >&lt;p&gt;is this the source of the count(1) issue?&lt;/p&gt;</comment>
                            <comment id="12668311" author="namit" created="Thu, 29 Jan 2009 03:43:55 +0000"  >&lt;p&gt;yes, ran that on the production successfully&lt;/p&gt;</comment>
                            <comment id="12668315" author="athusoo" created="Thu, 29 Jan 2009 03:55:26 +0000"  >&lt;p&gt;committed. Thanks Namit!!&lt;/p&gt;</comment>
                            <comment id="12668334" author="jsensarma" created="Thu, 29 Jan 2009 04:34:13 +0000"  >&lt;p&gt;man - the commits are fast! &lt;/p&gt;

&lt;p&gt;i had some questions:&lt;/p&gt;

&lt;p&gt;Curious - &lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if ((numEntries % NUMROWSESTIMATESIZE) == 0) {&lt;br/&gt;
+    if ((numEntriesHashTable == 0) || ((numEntries % NUMROWSESTIMATESIZE) == 0)) {&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Guessing this was the critical change - but couldn&apos;t follow how numEntriesHashTable could ever be 0 without numEntries being 0 as well.&lt;/p&gt;

&lt;p&gt;Also - I couldn&apos;t understand this code fragment (quoting the old code since it doesn&apos;t matter):&lt;/p&gt;

&lt;p&gt;      Field[] fArr = agg.getFields();&lt;br/&gt;
      for (Field f : fArr) &lt;br/&gt;
        fixedRowSize += getSize(i, agg, f);&lt;/p&gt;

&lt;p&gt;the getSize() call doesn&apos;t even look at the Field - it seems to base it&apos;s decision on the class type of agg - and I think will default to unknowntype (which is a whopping 256 bytes)?&lt;/p&gt;

&lt;p&gt;(sorry - unrelated to this bug - just generally curious since looking at this code in detail for first time)&lt;/p&gt;
</comment>
                            <comment id="12668339" author="athusoo" created="Thu, 29 Jan 2009 04:43:47 +0000"  >&lt;p&gt;From what Namit told me, there were 3 bugs:&lt;/p&gt;

&lt;p&gt;1. aggrPositions was not being initialized so we were not tracking the variable length fields properly.&lt;br/&gt;
2. Instead of getFields he had to use getDeclaredFields as the former only gives public fields where as most of our fields are private.&lt;br/&gt;
3. The numEntries stuff which would not let the code kick in if there were less thatn NUMROWESTIMATESIZE of rows...&lt;/p&gt;

&lt;p&gt;We had used 256 as a heuristic for unknown types...&lt;/p&gt;</comment>
                            <comment id="12668341" author="jsensarma" created="Thu, 29 Jan 2009 04:49:18 +0000"  >&lt;p&gt;the getSize() call ignores the field altogether. it looks at the aggregation class. the code seems to indicate that the intent was to sum up the sizes of the fields in the aggregation class - so something amiss there. perhaps we should just open a separate jira since the issue here is resolved.&lt;/p&gt;

&lt;p&gt;ok - got it on the numEntries thing - seems like we never call shouldFlushed with hashsize of zero.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                                                <inwardlinks description="is blocked by">
                                        <issuelink>
            <issuekey id="12412042">HIVE-219</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12398952" name="patch-256.1.txt" size="2099" author="namit" created="Thu, 29 Jan 2009 00:00:30 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 29 Jan 2009 01:55:49 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>73668</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 45 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0l8sf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>122074</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>