<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sat Dec 03 00:39:37 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HIVE-131/HIVE-131.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HIVE-131] insert overwrite directory leaves behind uncommitted/tmp files from failed tasks</title>
                <link>https://issues.apache.org/jira/browse/HIVE-131</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;_tmp files are getting left behind on insert overwrite directory:&lt;/p&gt;

&lt;p&gt;/user/jssarma/ctst1/40422_m_000195_0.deflate  &amp;lt;r 3&amp;gt; 13285 2008-12-07 01:47  rw-r-&lt;del&gt;r&lt;/del&gt;- jssarma supergroup&lt;br/&gt;
/user/jssarma/ctst1/40422_m_000196_0.deflate  &amp;lt;r 3&amp;gt; 3055  2008-12-07 01:46  rw-r-&lt;del&gt;r&lt;/del&gt;- jssarma supergroup&lt;br/&gt;
/user/jssarma/ctst1/_tmp.40422_m_000033_0 &amp;lt;r 3&amp;gt; 0 2008-12-07 01:53  rw-r-&lt;del&gt;r&lt;/del&gt;- jssarma supergroup&lt;br/&gt;
/user/jssarma/ctst1/_tmp.40422_m_000037_1 &amp;lt;r 3&amp;gt; 0 2008-12-07 01:53  rw-r-&lt;del&gt;r&lt;/del&gt;- jssarma supergroup&lt;/p&gt;


&lt;p&gt;this happened with speculative execution. the code looks good (in fact in this case many speculative tasks were launched - and only a couple caused problems). Almost seems like these files did not appear in the namespace until after the map-reduce job finished and the movetask did a listing of the output dir ..&lt;/p&gt;</description>
                <environment></environment>
        <key id="12410151">HIVE-131</key>
            <summary>insert overwrite directory leaves behind uncommitted/tmp files from failed tasks</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.png">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jsensarma">Joydeep Sen Sarma</assignee>
                                    <reporter username="jsensarma">Joydeep Sen Sarma</reporter>
                        <labels>
                    </labels>
                <created>Sun, 7 Dec 2008 10:07:00 +0000</created>
                <updated>Sat, 17 Dec 2011 00:09:00 +0000</updated>
                            <resolved>Thu, 19 Feb 2009 02:38:53 +0000</resolved>
                                                    <fixVersion>0.3.0</fixVersion>
                                    <component>Query Processor</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="12654313" author="zshao" created="Mon, 8 Dec 2008 05:21:55 +0000"  >&lt;p&gt;We should start using the standard way to create side-effect files. This could remove the potential race condition.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://hadoop.apache.org/core/docs/r0.17.2/api/org/apache/hadoop/mapred/FileOutputFormat.html#getWorkOutputPath(org.apache.hadoop.mapred.JobConf&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hadoop.apache.org/core/docs/r0.17.2/api/org/apache/hadoop/mapred/FileOutputFormat.html#getWorkOutputPath(org.apache.hadoop.mapred.JobConf&lt;/a&gt;)&lt;/p&gt;</comment>
                            <comment id="12654321" author="jsensarma" created="Mon, 8 Dec 2008 06:06:13 +0000"  >&lt;p&gt;i quickly glanced at the doc mentioned. seems like hadoop will move the files automatically to mapred.output.dir - but we don&apos;t have a single output directory for the task (since we can have multiple outputs).&lt;/p&gt;

&lt;p&gt;anyway - i am not sure why the problem happens (it almost seems like map-reduce can declare a job complete while (speculative) tasks are still running) - but a trivial fix is to just create the tmp files in a completely different directory (say scratch dir per query) and then move from there. we can discard the scratch dir entirely on query completion. there&apos;s still some risk of these runaway files leaking inodes/space. but if these are known hive scratchdir locations - they can always be cleaned up later on.&lt;/p&gt;</comment>
                            <comment id="12654322" author="jsensarma" created="Mon, 8 Dec 2008 06:08:53 +0000"  >&lt;p&gt;btw - if we can solve a problem at the application layer - i would really prefer doing that. we are trying to get hive to compile and run for different hadoop versions. the less dependency on non-critical hadoop apis/mechanisms - the less trouble we will have with portability.&lt;/p&gt;</comment>
                            <comment id="12654329" author="namit" created="Mon, 8 Dec 2008 07:15:35 +0000"  >&lt;p&gt;we already have this infrastructure in place - the intermediate results, describe output etc. are created in the scratch directory, which&lt;br/&gt;
are deleted at the end of query execution - Driver has a close() call which is supposed to be called at the end of query execution&lt;/p&gt;</comment>
                            <comment id="12654479" author="athusoo" created="Mon, 8 Dec 2008 17:46:09 +0000"  >&lt;p&gt;Maybe the driver close is not getting called for this failure. Is this ctrl-C case? Or an actual failure. Can you put ut the stack trace of the failure.&lt;/p&gt;</comment>
                            <comment id="12654504" author="jsensarma" created="Mon, 8 Dec 2008 18:31:49 +0000"  >&lt;p&gt;no - no failures here (from hive perspective). no ctrl-C. speculative map-reduce tasks are causing this problem.&lt;/p&gt;</comment>
                            <comment id="12672885" author="jsensarma" created="Thu, 12 Feb 2009 05:30:41 +0000"  >&lt;p&gt;Dhruba said:&lt;/p&gt;

&lt;p&gt;&amp;gt; 1. I see that execute returns values 1, 2, and 3. It will be good to document what these values mean.&lt;br/&gt;
&amp;gt; 2. Staring hadoop 0.19, it might make sense to set FileSystem.deleteOnExit() for files that are temporary.&lt;br/&gt;
&amp;gt; 3. It is interesting to note that now there is an extra step jobClose() that gets triggered on the client-side after the job is complete. Prior to this patch, a job would be successful even if the client-side has disappeared before the job is completed. This patch requires that the client remains active and healthy till the entire job is complete. This probably is ok for Hive, especially because Hive anyway requires job-chaining and I do not see any other way to do it&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;incorporated  suggestion to use deleteOnExit where available.&lt;/li&gt;
	&lt;li&gt;return codes are always accompanied by a corresponding message on the console/log. So don&apos;t see much point creating additional documentation around them.&lt;/li&gt;
	&lt;li&gt;hive has always depended on client side code-patch for query completion.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="12674382" author="zshao" created="Tue, 17 Feb 2009 22:45:23 +0000"  >&lt;p&gt;+1 Looks good to me.&lt;/p&gt;</comment>
                            <comment id="12674776" author="jsensarma" created="Wed, 18 Feb 2009 21:01:20 +0000"  >&lt;p&gt;please commit this to 0.2 also since it&apos;s a pretty severe bug&lt;/p&gt;</comment>
                            <comment id="12674868" author="zshao" created="Thu, 19 Feb 2009 02:38:53 +0000"  >&lt;p&gt;trunk: Committed revision 745709.&lt;br/&gt;
branch-0.2: Committed revision 745710.&lt;/p&gt;
</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12414198">HIVE-277</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12399794" name="HIVE-131.patch.1" size="13900" author="jsensarma" created="Mon, 9 Feb 2009 04:44:51 +0000"/>
                            <attachment id="12400078" name="hive-131.patch.2" size="15098" author="jsensarma" created="Thu, 12 Feb 2009 05:30:41 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 8 Dec 2008 05:21:55 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>73763</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 42 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0l81z:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>121955</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310192" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Release Note</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-131&quot; title=&quot;insert overwrite directory leaves behind uncommitted/tmp files from failed tasks&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-131&quot;&gt;&lt;strike&gt;HIVE-131&lt;/strike&gt;&lt;/a&gt;. Remove uncommitted files from failed tasks. (Joydeep Sen Sarma via zshao)</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>