<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sat Dec 03 00:11:38 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HIVE-2800/HIVE-2800.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HIVE-2800] NPE in &quot;create index&quot; without comment clause in external metastore</title>
                <link>https://issues.apache.org/jira/browse/HIVE-2800</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;This happens only when using external metastore (with --hiveconf hive.metastore.uris=thrift://localhost:8088 --hiveconf hive.metastore.local=false). Also if I gave a comment in the statement, this exception go away.&lt;/p&gt;

&lt;p&gt;Here is the statement:&lt;br/&gt;
create index test111 on table hcat_test(name) as &apos;compact&apos; with deferred rebuild;&lt;/p&gt;

&lt;p&gt;Here is the stack:&lt;br/&gt;
2012-02-10 17:07:42,612 ERROR exec.Task (SessionState.java:printError(380)) - FAILED: Error in metadata: java.lang.NullPointerException&lt;br/&gt;
org.apache.hadoop.hive.ql.metadata.HiveException: java.lang.NullPointerException&lt;br/&gt;
        at org.apache.hadoop.hive.ql.metadata.Hive.createIndex(Hive.java:725)&lt;br/&gt;
        at org.apache.hadoop.hive.ql.exec.DDLTask.createIndex(DDLTask.java:822)&lt;br/&gt;
        at org.apache.hadoop.hive.ql.exec.DDLTask.execute(DDLTask.java:231)&lt;br/&gt;
        at org.apache.hadoop.hive.ql.exec.Task.executeTask(Task.java:134)&lt;br/&gt;
        at org.apache.hadoop.hive.ql.exec.TaskRunner.runSequential(TaskRunner.java:57)&lt;br/&gt;
        at org.apache.hadoop.hive.ql.Driver.launchTask(Driver.java:1291)&lt;br/&gt;
        at org.apache.hadoop.hive.ql.Driver.execute(Driver.java:1082)&lt;br/&gt;
        at org.apache.hadoop.hive.ql.Driver.run(Driver.java:933)&lt;br/&gt;
        at org.apache.hadoop.hive.cli.CliDriver.processLocalCmd(CliDriver.java:255)&lt;br/&gt;
        at org.apache.hadoop.hive.cli.CliDriver.processCmd(CliDriver.java:212)&lt;br/&gt;
        at org.apache.hadoop.hive.cli.CliDriver.processLine(CliDriver.java:403)&lt;br/&gt;
        at org.apache.hadoop.hive.cli.CliDriver.run(CliDriver.java:671)&lt;br/&gt;
        at org.apache.hadoop.hive.cli.CliDriver.main(CliDriver.java:554)&lt;br/&gt;
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)&lt;br/&gt;
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
        at java.lang.reflect.Method.invoke(Method.java:597)&lt;br/&gt;
        at org.apache.hadoop.util.RunJar.main(RunJar.java:156)&lt;br/&gt;
Caused by: java.lang.NullPointerException&lt;br/&gt;
        at org.apache.thrift.protocol.TBinaryProtocol.writeString(TBinaryProtocol.java:185)&lt;br/&gt;
        at org.apache.hadoop.hive.metastore.api.Index.write(Index.java:1032)&lt;br/&gt;
        at org.apache.hadoop.hive.metastore.api.ThriftHiveMetastore$add_index_args.write(ThriftHiveMetastore.java:47518)&lt;br/&gt;
        at org.apache.thrift.TServiceClient.sendBase(TServiceClient.java:63)&lt;br/&gt;
        at org.apache.hadoop.hive.metastore.api.ThriftHiveMetastore$Client.send_add_index(ThriftHiveMetastore.java:1675)&lt;br/&gt;
        at org.apache.hadoop.hive.metastore.api.ThriftHiveMetastore$Client.add_index(ThriftHiveMetastore.java:1666)&lt;br/&gt;
        at org.apache.hadoop.hive.metastore.HiveMetaStoreClient.createIndex(HiveMetaStoreClient.java:853)&lt;br/&gt;
        at org.apache.hadoop.hive.ql.metadata.Hive.createIndex(Hive.java:722)&lt;br/&gt;
        ... 17 more&lt;/p&gt;</description>
                <environment></environment>
        <key id="12542211">HIVE-2800</key>
            <summary>NPE in &quot;create index&quot; without comment clause in external metastore</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="sushanth">Sushanth Sowmyan</assignee>
                                    <reporter username="daijy">Daniel Dai</reporter>
                        <labels>
                    </labels>
                <created>Sat, 11 Feb 2012 01:17:40 +0000</created>
                <updated>Thu, 10 Jan 2013 19:54:09 +0000</updated>
                            <resolved>Fri, 23 Nov 2012 05:01:14 +0000</resolved>
                                    <version>0.7.1</version>
                    <version>0.8.1</version>
                    <version>0.9.0</version>
                                    <fixVersion>0.10.0</fixVersion>
                                    <component>Metastore</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                <comments>
                            <comment id="13280054" author="bejoyks" created="Mon, 21 May 2012 09:31:37 +0000"  >&lt;p&gt;The same bug is found on hive 0.7.1 as well&lt;/p&gt;</comment>
                            <comment id="13290537" author="sushanth" created="Wed, 6 Jun 2012 22:43:55 +0000"  >&lt;p&gt;This seems to be because the we don&apos;t check if the comment is null before we add it. Then, later, when we&apos;re trying to write out using thrift, thrift throws the NPE when it tries to read from parameters and tries to write out as-is. The following fixes this error:&lt;/p&gt;


&lt;p&gt;&amp;#8212; ql/src/java/org/apache/hadoop/hive/ql/metadata/Hive.java	(revision 1347150)&lt;br/&gt;
+++ ql/src/java/org/apache/hadoop/hive/ql/metadata/Hive.java	(working copy)&lt;br/&gt;
@@ -709,7 +709,10 @@&lt;/p&gt;

&lt;p&gt;       Index indexDesc = new Index(indexName, indexHandlerClass, dbName, tableName, time, time, indexTblName,&lt;br/&gt;
           storageDescriptor, params, deferredRebuild);&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;indexDesc.getParameters().put(&quot;comment&quot;, indexComment);&lt;br/&gt;
+      if (indexComment != null)&lt;br/&gt;
+      
{
+        indexDesc.getParameters().put(&quot;comment&quot;, indexComment);
+      }&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;       if (idxProps != null)&lt;br/&gt;
       {&lt;/p&gt;</comment>
                            <comment id="13290575" author="sushanth" created="Wed, 6 Jun 2012 23:18:23 +0000"  >&lt;p&gt;Sample code that demonstrates bug:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
drop table &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; exists missing_ddl_3;
drop index &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; exists missing_ddl_3_index on missing_ddl_3;
create table missing_ddl_3(name string, age &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;, gpa &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;);
insert overwrite table missing_ddl_3 select name, age, gpa from studenttab10k;
create index missing_ddl_3_index on table missing_ddl_3(name) as &apos;COMPACT&apos; WITH DEFERRED REBUILD;
alter index missing_ddl_3_index on missing_ddl_3 rebuild;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This will fail at the create index time itself(ignoring the rebuild).&lt;/p&gt;</comment>
                            <comment id="13291088" author="ashutoshc" created="Thu, 7 Jun 2012 16:02:33 +0000"  >&lt;p&gt;@Sushanth,&lt;br/&gt;
Reason it happens only in thrift client-server mode and your suggested fix of null-checking strongly hints to me that thrift layer is not able to handle nulls very well. This is  kind of surprise to me as I thought thrift can handle nulls. I think there is a value in figuring out if this really is the case and file a bug with thrift project since it looks like this may bite us again in future.&lt;/p&gt;</comment>
                            <comment id="13291334" author="sushanth" created="Thu, 7 Jun 2012 21:41:37 +0000"  >&lt;p&gt;Ashutosh, digging a bit more into thrift sources, this is what I find:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://svn.apache.org/repos/asf/thrift/trunk/lib/java/src/org/apache/thrift/protocol/TBinaryProtocol.java&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/repos/asf/thrift/trunk/lib/java/src/org/apache/thrift/protocol/TBinaryProtocol.java&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;If you look at the method writeString there, it does not check for null, it calls str.getBytes(). So as of thrift trunk, this does not work. I&apos;m not sure if that&apos;s intentional on thrift&apos;s part (to maximize speed by minimizing checks) and something to fix on hive&apos;s side, or something to fix on thrift&apos;s side.&lt;/p&gt;

&lt;p&gt;In the meanwhile, I&apos;ve added a testcase for this bug in the RemoteHiveMetaStore, I&apos;m updating the patch now.&lt;/p&gt;</comment>
                            <comment id="13291347" author="sushanth" created="Thu, 7 Jun 2012 21:51:00 +0000"  >&lt;p&gt;Hmm, actually, the problem does go deeper than that. We&apos;d have the same issue if a user were to set one of the parameter values as null. We&apos;d fix this issue by this patch, but only to hit it again with other user code.&lt;/p&gt;</comment>
                            <comment id="13291355" author="ashutoshc" created="Thu, 7 Jun 2012 21:56:05 +0000"  >&lt;p&gt;Thanks, Sushanth for digging in. I have created &lt;a href=&quot;https://issues.apache.org/jira/browse/THRIFT-1625&quot; title=&quot;Null handling in TBinaryProtocol&quot; class=&quot;issue-link&quot; data-issue-key=&quot;THRIFT-1625&quot;&gt;&lt;del&gt;THRIFT-1625&lt;/del&gt;&lt;/a&gt; to get response from thrift devs. Thats what my worry is if thrift can&apos;t handle nulls cleanly then we have to litter our codebase with null-checks everywhere.&lt;/p&gt;</comment>
                            <comment id="13291357" author="ashutoshc" created="Thu, 7 Jun 2012 21:57:11 +0000"  >&lt;p&gt;Linking with thrift issue.&lt;/p&gt;</comment>
                            <comment id="13291385" author="sushanth" created="Thu, 7 Jun 2012 22:30:13 +0000"  >&lt;p&gt;This thread makes for interesting reading, and refers to the same issue:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://www.mail-archive.com/thrift-dev@incubator.apache.org/msg01185.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://www.mail-archive.com/thrift-dev@incubator.apache.org/msg01185.html&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13503020" author="ashutoshc" created="Fri, 23 Nov 2012 05:01:14 +0000"  >&lt;p&gt;Fixed as a part of &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-3722&quot; title=&quot;Create index fails on CLI using remote metastore&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-3722&quot;&gt;&lt;del&gt;HIVE-3722&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13506120" author="phabricator@reviews.facebook.net" created="Thu, 29 Nov 2012 01:24:57 +0000"  >&lt;p&gt;khorgath has abandoned the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2800&quot; title=&quot;NPE in &amp;quot;create index&amp;quot; without comment clause in external metastore&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2800&quot;&gt;&lt;del&gt;HIVE-2800&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; NPE in &quot;create index&quot; without comment clause in external metastore&quot;.&lt;/p&gt;

&lt;p&gt;  Same change implemented by &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-3722&quot; title=&quot;Create index fails on CLI using remote metastore&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-3722&quot;&gt;&lt;del&gt;HIVE-3722&lt;/del&gt;&lt;/a&gt;, redundant now.&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D3519&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D3519&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To: JIRA, ashutoshc, khorgath&lt;/p&gt;</comment>
                            <comment id="13550297" author="ashutoshc" created="Thu, 10 Jan 2013 19:54:09 +0000"  >&lt;p&gt;This issue is fixed and released as part of 0.10.0 release. If you find an issue which seems to be related to this one, please create a new jira and link this one with new jira.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310050">
                    <name>Regression</name>
                                                                <inwardlinks description="is broken by">
                                        <issuelink>
            <issuekey id="12559759">THRIFT-1625</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 21 May 2012 09:31:37 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>227498</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 47 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0llm7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>124152</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>