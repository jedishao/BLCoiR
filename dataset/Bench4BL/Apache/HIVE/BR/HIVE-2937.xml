<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sat Dec 03 23:54:59 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HIVE-2937/HIVE-2937.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HIVE-2937] TestHiveServerSessions hangs when executed directly</title>
                <link>https://issues.apache.org/jira/browse/HIVE-2937</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
ant test -Doffline=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt; -Dtestcase=TestHiveServerSessions
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Hangs infinitely.&lt;/p&gt;

&lt;p&gt;I couldn&apos;t imagine exact cause of the problem, but found that by adding &apos;new HiveServer.HiveServerHandler();&apos; in setup(), test resulted to success.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12550278">HIVE-2937</key>
            <summary>TestHiveServerSessions hangs when executed directly</summary>
                <type id="6" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/requirement.png">Test</type>
                                            <priority id="5" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.png">Trivial</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="navis">Navis</assignee>
                                    <reporter username="navis">Navis</reporter>
                        <labels>
                    </labels>
                <created>Mon, 9 Apr 2012 20:37:49 +0000</created>
                <updated>Wed, 9 Jan 2013 10:24:23 +0000</updated>
                            <resolved>Fri, 13 Apr 2012 16:29:52 +0000</resolved>
                                                    <fixVersion>0.10.0</fixVersion>
                                    <component>Metastore</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                <comments>
                            <comment id="13250172" author="ashutoshc" created="Mon, 9 Apr 2012 20:52:29 +0000"  >&lt;p&gt;@Navis,&lt;/p&gt;

&lt;p&gt;I have also found this test hanging on my machines. Looking at apache build logs, either of &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2929&quot; title=&quot;race condition in DAG execute tasks for hive&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2929&quot;&gt;&lt;del&gt;HIVE-2929&lt;/del&gt;&lt;/a&gt; or &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2858&quot; title=&quot;Cache remote map reduce job stack traces for additional logging&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2858&quot;&gt;&lt;del&gt;HIVE-2858&lt;/del&gt;&lt;/a&gt; is the cause. &lt;a href=&quot;https://builds.apache.org/job/Hive-trunk-h0.21/1360/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/Hive-trunk-h0.21/1360/&lt;/a&gt; Though atleast one of the subsequent build has passed. So, may be there is a race condition somewhere.&lt;/p&gt;

&lt;p&gt;Nsmit was involved in both of those patches, so may have more context.&lt;/p&gt;</comment>
                            <comment id="13250231" author="phabricator@reviews.facebook.net" created="Mon, 9 Apr 2012 22:09:17 +0000"  >&lt;p&gt;navis requested code review of &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2937&quot; title=&quot;TestHiveServerSessions hangs when executed directly&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2937&quot;&gt;&lt;del&gt;HIVE-2937&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; TestHiveServerSessions hangs when executed directly&quot;.&lt;br/&gt;
Reviewers: JIRA&lt;/p&gt;

&lt;p&gt;  DPAL-1079 TestHiveServerSessions hangs when executed directly&lt;/p&gt;

&lt;p&gt;  ant test -Doffline=true -Dtestcase=TestHiveServerSessions&lt;/p&gt;

&lt;p&gt;  Hangs infinitely.&lt;/p&gt;

&lt;p&gt;  I couldn&apos;t imagine exact cause of the problem, but found that by adding &apos;new HiveServer.HiveServerHandler();&apos; in setup(), test resulted to success.&lt;/p&gt;

&lt;p&gt;TEST PLAN&lt;br/&gt;
  EMPTY&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D2697&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D2697&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;AFFECTED FILES&lt;br/&gt;
  metastore/src/java/org/apache/hadoop/hive/metastore/HiveMetaStore.java&lt;/p&gt;

&lt;p&gt;MANAGE HERALD DIFFERENTIAL RULES&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/herald/view/differential/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/herald/view/differential/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;WHY DID I GET THIS EMAIL?&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/herald/transcript/6183/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/herald/transcript/6183/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Tip: use the X-Herald-Rules header to filter Herald messages in your client.&lt;/p&gt;</comment>
                            <comment id="13250238" author="navis" created="Mon, 9 Apr 2012 22:12:24 +0000"  >&lt;p&gt;@Ashutosh Chauhan&lt;/p&gt;

&lt;p&gt;It was related to initialization of metastore. Just added static sync in HMSHandler#createDefaultDB and seemed enough to solve this.&lt;/p&gt;</comment>
                            <comment id="13250243" author="ashutoshc" created="Mon, 9 Apr 2012 22:19:01 +0000"  >&lt;p&gt;@Navis&lt;/p&gt;

&lt;p&gt;Can you add Namit in reviewer list?&lt;/p&gt;</comment>
                            <comment id="13251808" author="kevinwilfong" created="Wed, 11 Apr 2012 18:21:16 +0000"  >&lt;p&gt;I ran into this issue too.  It seems to be caused by creating the HiveClient&apos;s too quickly.  The initialization of the HiveClient initializes the HiveServerHandler which initializes the HMSHandler.  The initializations of the HMSHandler&apos;s happen in such quick succession that when the second call to create the default db occurs, the first call hasn&apos;t finished creating the db yet so it attempts to create the same db and never gets out of this method (possibly a derby issue).&lt;/p&gt;

&lt;p&gt;It could also be fixed by adding a Thread.sleep between creating HiveClient&apos;s, but Navis&apos;s solution seems much more appropriate.&lt;/p&gt;

&lt;p&gt;@Ashutosh I don&apos;t think it is related to either of those patches as previous builds appear to fail for the same reason&lt;br/&gt;
&lt;a href=&quot;https://builds.apache.org/job/Hive-trunk-h0.21/1355/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/Hive-trunk-h0.21/1355/&lt;/a&gt; also both of those patches should have only affected map reduce jobs, not the metastore.&lt;/p&gt;</comment>
                            <comment id="13251812" author="phabricator@reviews.facebook.net" created="Wed, 11 Apr 2012 18:23:16 +0000"  >&lt;p&gt;kevinwilfong has accepted the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2937&quot; title=&quot;TestHiveServerSessions hangs when executed directly&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2937&quot;&gt;&lt;del&gt;HIVE-2937&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; TestHiveServerSessions hangs when executed directly&quot;.&lt;/p&gt;

&lt;p&gt;  +1 running tests&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D2697&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D2697&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;BRANCH&lt;br/&gt;
  DPAL-1079&lt;/p&gt;</comment>
                            <comment id="13252487" author="ashutoshc" created="Thu, 12 Apr 2012 15:27:38 +0000"  >&lt;p&gt;@Kevin,&lt;/p&gt;

&lt;p&gt;What you said make sense. But, I am still puzzled why this has started to show up recently. I see this hang ~70% of time on my builds starting last week. If the bug is as described, this should have always been the case. Isn&apos;t it?&lt;/p&gt;</comment>
                            <comment id="13253073" author="kevinwilfong" created="Fri, 13 Apr 2012 03:11:58 +0000"  >&lt;p&gt;@Ashutosh&lt;/p&gt;

&lt;p&gt;I dug deeper into the issue.  I verified that the second HiveServerHandler does exit the method, just via an exception rather than via the return.  This prevents the HiveServerHandler from being created.  The test actually gets stuck making the first execute call on the second HiveClient, presumably because there is no handler on the other end of the connection to handle the request, so it gets stuck waiting for a response.&lt;/p&gt;

&lt;p&gt;I admit I am equally confused as to why this started showing up so frequently recently.  I had seen this problem a few times before, I had assumed it was caused by running the tests twice on the same machine.  Now however, I&apos;ve run into this problem every time I try to run tests, since yesterday.&lt;/p&gt;

&lt;p&gt;As far as I can tell, there is no, and never was any logic to handle this problem.  So Navis&apos;s diff seems worth committing to fix that issue, and it is at least a plus that it gets us around this issue, even if the root cause of why this issue suddenly became so prominent is still unsolved.&lt;/p&gt;

&lt;p&gt;I would like to commit this patch, unless you have any objections.&lt;/p&gt;</comment>
                            <comment id="13253077" author="ashutoshc" created="Fri, 13 Apr 2012 03:25:58 +0000"  >&lt;p&gt;Go ahead and commit it will unblock us from this failing test. But do file a follow-up jira describing your findings so in case anyone is interested to further pursue this will have some context to begin with.&lt;/p&gt;</comment>
                            <comment id="13253108" author="phabricator@reviews.facebook.net" created="Fri, 13 Apr 2012 04:55:13 +0000"  >&lt;p&gt;navis updated the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2937&quot; title=&quot;TestHiveServerSessions hangs when executed directly&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2937&quot;&gt;&lt;del&gt;HIVE-2937&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; TestHiveServerSessions hangs when executed directly&quot;.&lt;br/&gt;
Reviewers: JIRA, njain, kevinwilfong&lt;/p&gt;

&lt;p&gt;  1. When failed to create server handler, close transport and make a log&lt;br/&gt;
  2. Fix lint warning&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D2697&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D2697&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;AFFECTED FILES&lt;br/&gt;
  metastore/src/java/org/apache/hadoop/hive/metastore/HiveMetaStore.java&lt;br/&gt;
  service/src/java/org/apache/hadoop/hive/service/HiveServer.java&lt;/p&gt;</comment>
                            <comment id="13253111" author="navis" created="Fri, 13 Apr 2012 04:57:49 +0000"  >&lt;p&gt;Modified to close connection when exception is thrown initializing HiveServerHandler.&lt;/p&gt;</comment>
                            <comment id="13253114" author="phabricator@reviews.facebook.net" created="Fri, 13 Apr 2012 05:03:24 +0000"  >&lt;p&gt;kevinwilfong has commented on the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2937&quot; title=&quot;TestHiveServerSessions hangs when executed directly&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2937&quot;&gt;&lt;del&gt;HIVE-2937&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; TestHiveServerSessions hangs when executed directly&quot;.&lt;/p&gt;

&lt;p&gt;  Awesome!  I wasn&apos;t sure if Thrift supported this, at least with this we won&apos;t end up with these mysterious infinite hangs.&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D2697&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D2697&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;BRANCH&lt;br/&gt;
  DPAL-1079&lt;/p&gt;</comment>
                            <comment id="13253518" author="kevinwilfong" created="Fri, 13 Apr 2012 16:29:52 +0000"  >&lt;p&gt;Committed, thanks Navis.&lt;/p&gt;</comment>
                            <comment id="13254070" author="hudson" created="Sat, 14 Apr 2012 10:21:25 +0000"  >&lt;p&gt;Integrated in Hive-trunk-h0.21 #1373 (See &lt;a href=&quot;https://builds.apache.org/job/Hive-trunk-h0.21/1373/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/Hive-trunk-h0.21/1373/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2937&quot; title=&quot;TestHiveServerSessions hangs when executed directly&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2937&quot;&gt;&lt;del&gt;HIVE-2937&lt;/del&gt;&lt;/a&gt;. TestHiveServerSessions hangs when executed directly. (navis via kevinwilfong) (Revision 1325830)&lt;/p&gt;

&lt;p&gt;     Result = SUCCESS&lt;br/&gt;
kevinwilfong : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1325830&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1325830&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hive/trunk/metastore/src/java/org/apache/hadoop/hive/metastore/HiveMetaStore.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/service/src/java/org/apache/hadoop/hive/service/HiveServer.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13265323" author="ashutoshc" created="Mon, 30 Apr 2012 21:11:43 +0000"  >&lt;p&gt;This issue is closed now. It was released with the fix in 0.9.0. If there is a problem, please open a new jira and link this one with that.&lt;/p&gt;</comment>
                            <comment id="13283262" author="navis" created="Fri, 25 May 2012 09:50:24 +0000"  >&lt;p&gt;This is not applied to hive-0.9.0 and not consistent with release note.&lt;/p&gt;</comment>
                            <comment id="13548097" author="hudson" created="Wed, 9 Jan 2013 10:24:23 +0000"  >&lt;p&gt;Integrated in Hive-trunk-hadoop2 #54 (See &lt;a href=&quot;https://builds.apache.org/job/Hive-trunk-hadoop2/54/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/Hive-trunk-hadoop2/54/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2937&quot; title=&quot;TestHiveServerSessions hangs when executed directly&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2937&quot;&gt;&lt;del&gt;HIVE-2937&lt;/del&gt;&lt;/a&gt;. TestHiveServerSessions hangs when executed directly. (navis via kevinwilfong) (Revision 1325830)&lt;/p&gt;

&lt;p&gt;     Result = ABORTED&lt;br/&gt;
kevinwilfong : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1325830&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1325830&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hive/trunk/metastore/src/java/org/apache/hadoop/hive/metastore/HiveMetaStore.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/service/src/java/org/apache/hadoop/hive/service/HiveServer.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12607753">HIVE-3469</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12522026" name="ASF.LICENSE.NOT.GRANTED--HIVE-2937.D2697.1.patch" size="1364" author="phabricator@reviews.facebook.net" created="Mon, 9 Apr 2012 22:09:19 +0000"/>
                            <attachment id="12522528" name="ASF.LICENSE.NOT.GRANTED--HIVE-2937.D2697.2.patch" size="2636" author="phabricator@reviews.facebook.net" created="Fri, 13 Apr 2012 04:55:14 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 9 Apr 2012 20:52:29 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>235143</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 47 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i02uqv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>14582</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>