<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 02 23:43:22 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HIVE-179/HIVE-179.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HIVE-179] SUBSTR function should work like other databases</title>
                <link>https://issues.apache.org/jira/browse/HIVE-179</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;Positions start at 1, not 0.  Negative positions start at the end of the string and count backwards.&lt;/p&gt;

&lt;p&gt;Oracle returns null for lengths less than 1 or non-existent substrings (any empty strings are null).  MySQL and PostgreSQL return empty strings, never null.  PostgreSQL errors for negative lengths.  I suggest we follow the MySQL behavior.&lt;/p&gt;

&lt;p&gt;Oracle treats position 0 the same as 1.  Perhaps we should too?&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt; SUBSTR(&apos;ABCDEFG&apos;,3,4): CDEF
SUBSTR(&apos;ABCDEFG&apos;,-5,4): CDEF
   SUBSTR(&apos;ABCDEFG&apos;,3): CDEFG
  SUBSTR(&apos;ABCDEFG&apos;,-5): CDEFG
     SUBSTR(&apos;ABC&apos;,1,1): A

MySQL:
     SUBSTR(&apos;ABC&apos;,0,1): &amp;lt;empty&amp;gt;
     SUBSTR(&apos;ABC&apos;,0,2): &amp;lt;empty&amp;gt;
     SUBSTR(&apos;ABC&apos;,1,0): &amp;lt;empty&amp;gt;
    SUBSTR(&apos;ABC&apos;,1,-1): &amp;lt;empty&amp;gt;

Oracle:
     SUBSTR(&apos;ABC&apos;,0,1): A
     SUBSTR(&apos;ABC&apos;,0,2): AB
     SUBSTR(&apos;ABC&apos;,1,0): &amp;lt;null&amp;gt;
    SUBSTR(&apos;ABC&apos;,1,-1): &amp;lt;null&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12410745">HIVE-179</key>
            <summary>SUBSTR function should work like other databases</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.png">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="electrum">David Phillips</assignee>
                                    <reporter username="electrum">David Phillips</reporter>
                        <labels>
                    </labels>
                <created>Tue, 16 Dec 2008 00:08:07 +0000</created>
                <updated>Sat, 17 Dec 2011 00:08:48 +0000</updated>
                            <resolved>Wed, 28 Jan 2009 00:14:01 +0000</resolved>
                                                    <fixVersion>0.3.0</fixVersion>
                                    <component>Query Processor</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="12657619" author="electrum" created="Wed, 17 Dec 2008 23:47:33 +0000"  >&lt;p&gt;I note this will break ~27 tests that use &lt;tt&gt;substr(src.value,4)&lt;/tt&gt; or similar.  Is this going to be a problem for existing user code?&lt;/p&gt;</comment>
                            <comment id="12657633" author="athusoo" created="Thu, 18 Dec 2008 00:16:51 +0000"  >&lt;p&gt;I think we should change it and make it ANSI compliant. It is still early days and I think we can ask the users to change their scripts. Not being SQL compliant will present more problems in the future. &lt;/p&gt;</comment>
                            <comment id="12657638" author="zshao" created="Thu, 18 Dec 2008 00:46:46 +0000"  >&lt;p&gt;Totally agree. Let&apos;s make it ANSI compliant!&lt;/p&gt;</comment>
                            <comment id="12657639" author="zshao" created="Thu, 18 Dec 2008 00:47:40 +0000"  >&lt;p&gt;Another thing to test is what does MYSQL returns when the string, or index, or len is NULL.&lt;/p&gt;</comment>
                            <comment id="12658611" author="electrum" created="Mon, 22 Dec 2008 18:11:13 +0000"  >&lt;p&gt;MySQL and Oracle both return NULL if any of the parameters are NULL.&lt;/p&gt;</comment>
                            <comment id="12661629" author="electrum" created="Wed, 7 Jan 2009 16:43:12 +0000"  >&lt;p&gt;The test cases groupby2_map.q and groupby3_map.q break when substr(src.value,4) is changed to substr(src.value,5), even though the output from the UDF is the same (&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-215&quot; title=&quot;Map-side aggregate with DISTINCT generates bad intermediate table&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-215&quot;&gt;&lt;del&gt;HIVE-215&lt;/del&gt;&lt;/a&gt;).&lt;/p&gt;</comment>
                            <comment id="12662014" author="electrum" created="Thu, 8 Jan 2009 15:50:35 +0000"  >&lt;p&gt;This patch is tentative.  All tests pass except these two due to &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-215&quot; title=&quot;Map-side aggregate with DISTINCT generates bad intermediate table&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-215&quot;&gt;&lt;del&gt;HIVE-215&lt;/del&gt;&lt;/a&gt;:&lt;/p&gt;

&lt;p&gt;ant -Dtestcase=TestCliDriver -Dqfile=groupby2_map.q test&lt;br/&gt;
ant -Dtestcase=TestCliDriver -Dqfile=groupby3_map.q test&lt;/p&gt;
</comment>
                            <comment id="12662395" author="athusoo" created="Fri, 9 Jan 2009 15:22:15 +0000"  >&lt;p&gt;The patch looks correct and rather harmless. I tried the change that you suggested to groupby2_map.q on a clean branch and it worked find. If you are getting a cast exception it is likely related to the change of signatures but even that seems harmless. Trying out this patch in my environment now.&lt;/p&gt;</comment>
                            <comment id="12662598" author="athusoo" created="Sat, 10 Jan 2009 01:23:29 +0000"  >&lt;p&gt;This seems to be exposing a latent bug in plan generation. Still investigating this, but here is an explanation. If you do &lt;/p&gt;

&lt;p&gt;diff -y ./ql/src/test/results/clientpositive/groupby2_map.q.out ./ql/src/test/results/clientpositive/.svn/text-base/groupby2_map.q.out.svn-base | less &lt;/p&gt;

&lt;p&gt;you will see the plan changes that this patch makes. An excerpt is as follows: &lt;br/&gt;
-------------------------------- &lt;br/&gt;
STAGE PLANS: STAGE PLANS: &lt;br/&gt;
  Stage: Stage-1 Stage: Stage-1 &lt;br/&gt;
    Map Reduce Map Reduce &lt;br/&gt;
      Alias -&amp;gt; Map Operator Tree: Alias -&amp;gt; Map Operator Tree: &lt;br/&gt;
        src src &lt;br/&gt;
            Group By Operator Group By Operator &lt;br/&gt;
              aggregations: aggregations: &lt;br/&gt;
                    expr: sum(UDFToDouble(substr(value, 5))) | expr: count(DISTINCT substr(value, 4)) &lt;br/&gt;
                    expr: count(DISTINCT substr(value, 5)) | expr: sum(UDFToDouble(substr(value, 4))) &lt;br/&gt;
              keys: keys: &lt;br/&gt;
                    expr: substr(key, 1, 1) | expr: substr(key, 0, 1) &lt;br/&gt;
                    type: string type: string &lt;br/&gt;
                    expr: substr(value, 5) | expr: substr(value, 4) &lt;br/&gt;
                    type: string type: string &lt;br/&gt;
              mode: hash mode: hash &lt;br/&gt;
              Reduce Output Operator Reduce Output Operator &lt;br/&gt;
                key expressions: key expressions: &lt;br/&gt;
                      expr: 0 expr: 0 &lt;br/&gt;
                      type: string type: string &lt;br/&gt;
                      expr: 1 expr: 1 &lt;br/&gt;
                      type: string type: string &lt;br/&gt;
                sort order: ++ sort order: ++ &lt;br/&gt;
                Map-reduce partition columns: Map-reduce partition columns: &lt;br/&gt;
                      expr: 0 expr: 0 &lt;br/&gt;
                      type: string type: string &lt;br/&gt;
                      expr: 1 expr: 1 &lt;br/&gt;
                      type: string type: string &lt;br/&gt;
                tag: -1 tag: -1 &lt;br/&gt;
                value expressions: value expressions: &lt;br/&gt;
                      expr: 2 expr: 2 &lt;br/&gt;
                      type: double &amp;lt; &lt;br/&gt;
                      expr: 3 &amp;lt; &lt;br/&gt;
                      type: bigint type: bigint &lt;br/&gt;
                                                              &amp;gt; expr: 3 &lt;br/&gt;
                                                              &amp;gt; type: double &lt;br/&gt;
      Reduce Operator Tree: Reduce Operator Tree: &lt;br/&gt;
        Group By Operator Group By Operator &lt;br/&gt;
          aggregations: aggregations: &lt;br/&gt;
                expr: count(DISTINCT KEY.1) expr: count(DISTINCT KEY.1) &lt;br/&gt;
                expr: sum(VALUE.0) | expr: sum(VALUE.1) &lt;br/&gt;
          keys: keys: &lt;br/&gt;
                expr: KEY.0 expr: KEY.0 &lt;br/&gt;
---------------------------- &lt;br/&gt;
So the point to note here is that the count and the sum expressions are the top most group by operator so &lt;br/&gt;
in the last group by operator in the excerpt I think expr: count(DISTINCT KEY.1) should have been expr: count(DISTINCT KEY0) &lt;/p&gt;

&lt;p&gt;Still debugging this one..&lt;/p&gt;</comment>
                            <comment id="12662600" author="athusoo" created="Sat, 10 Jan 2009 01:44:53 +0000"  >&lt;p&gt;On second thoughts, the plan seems to be ok. Since the keys have not swapped (only the values have swapped), count(DISTINCT KEY.1) seems to be correct.&lt;/p&gt;</comment>
                            <comment id="12662602" author="athusoo" created="Sat, 10 Jan 2009 01:57:10 +0000"  >&lt;p&gt;The first map/reduce job produces longs where as the second map/reduce job expects a double.&lt;/p&gt;</comment>
                            <comment id="12662606" author="athusoo" created="Sat, 10 Jan 2009 02:24:45 +0000"  >&lt;p&gt;The actual error is happening between the map and reduce boundary of the second map reduce job. The ddl for the dynamic serde that is used to serialize data at this boundary is double, long where as the output generated is long, double as seen in the plan.&lt;/p&gt;</comment>
                            <comment id="12662667" author="athusoo" created="Sat, 10 Jan 2009 15:25:56 +0000"  >&lt;p&gt;Filed another JIRA for the issue as it is unrelated to this one. Will post a patch to 222 during the weekend.&lt;/p&gt;</comment>
                            <comment id="12667547" author="athusoo" created="Tue, 27 Jan 2009 01:53:14 +0000"  >&lt;p&gt;Running tests on this. Will commit once it is done. Sorry, this one fell off my radar...&lt;/p&gt;</comment>
                            <comment id="12667882" author="athusoo" created="Wed, 28 Jan 2009 00:14:01 +0000"  >&lt;p&gt;committed. Thanks David!! Sorry for not doing this before...&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                                                <inwardlinks description="is blocked by">
                                        <issuelink>
            <issuekey id="12411832">HIVE-215</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12412118">HIVE-222</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12397433" name="hive-substr.patch" size="84031" author="electrum" created="Thu, 8 Jan 2009 15:50:35 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 18 Dec 2008 00:16:51 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>73726</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10342"><![CDATA[Incompatible change]]></customfieldvalue>
    <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 45 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0l8cn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>122003</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310192" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Release Note</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>SUBSTR position now starts at 1, not 0.  A negative position counts backwards from the end of the string, starting at -1.  Position 0 is treated as position 1.</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>