<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 02 23:56:02 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HIVE-77/HIVE-77.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HIVE-77] thread safe query execution</title>
                <link>https://issues.apache.org/jira/browse/HIVE-77</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;this came up in hive-30 where there&apos;s a multithreaded hive server in the works. at the minimum, the sessionstate objects should be thread local singletons. but filing a more general bug that can cover this issue + code audit for any other static variables + test suite for running queries from a multi-threaded environment&lt;/p&gt;</description>
                <environment></environment>
        <key id="12409031">HIVE-77</key>
            <summary>thread safe query execution</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jsensarma">Joydeep Sen Sarma</assignee>
                                    <reporter username="jsensarma">Joydeep Sen Sarma</reporter>
                        <labels>
                    </labels>
                <created>Fri, 21 Nov 2008 21:53:35 +0000</created>
                <updated>Sat, 17 Dec 2011 00:08:27 +0000</updated>
                            <resolved>Fri, 5 Dec 2008 10:11:39 +0000</resolved>
                                                    <fixVersion>0.3.0</fixVersion>
                                    <component>Server Infrastructure</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12651321" author="jsensarma" created="Thu, 27 Nov 2008 10:58:15 +0000"  >&lt;p&gt;this patch includes:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;test for multithreaded execution&lt;/li&gt;
	&lt;li&gt;fixes to SessionState.java and CliDriver.java for MT safe (and to run MT tests)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;however - the test is disabled. while this seems to fix issues with session management etc. - there are bugs in metastore client code that are not resolved. i would like to file a separate jira for those.&lt;/p&gt;

&lt;p&gt;unfortunately metastore client issues are not limited to DDLTasks only - regular table metadata fetches are also affected. (the patch allows testing of clientpositive queries without running DDL commands in MT mode - but in an extremely hacky way)&lt;/p&gt;</comment>
                            <comment id="12652188" author="athusoo" created="Mon, 1 Dec 2008 22:42:57 +0000"  >&lt;p&gt;Comments are inlined.&lt;/p&gt;

&lt;p&gt;There are two major ones:&lt;br/&gt;
1. static LOG - we do that all over our code. Will that cause a problem or do we have to clean that up in the same way that you have done for CliDriver and SessionState.&lt;br/&gt;
2. This is the bigger one - I think we should just extend QTestUtil so that it can run in a multi threaded mode instead of creating another class to run those tests. We can then call QTestUtil in two modes and pass the list of tests that want it to executed in the multi threaded mode. That would be more maintainable in the long run.&lt;/p&gt;

&lt;p&gt;Rest a few minor things like missing javadocs..&lt;br/&gt;
Inline Comments&lt;br/&gt;
ql/src/test/org/apache/hadoop/hive/ql/QTestUtil.java:687	Please add javadocs for these.&lt;br/&gt;
ql/src/test/org/apache/hadoop/hive/ql/TestMTQueries.java:0	This file needs javadocs.&lt;br/&gt;
ql/src/test/org/apache/hadoop/hive/ql/TestMTQueries.java:32	Can we pass the names into this instead of hardcoding these in the code.&lt;br/&gt;
ql/src/test/org/apache/hadoop/hive/ql/TestMTQueries.java:0	Also instead of a brand new test class, it is perhaps better to extend QTestUtil to run using the Runner and then run it in two modes, concurrent and serial. We would be able to avoid duplicate code and just have a single utility to test out both the concurrent and serial tests.&lt;br/&gt;
ql/src/test/org/apache/hadoop/hive/ql/QTestUtil.java:202	Can we create a similar array as source array for destination tables and destination files and then loop over those arrays.&lt;br/&gt;
ql/src/test/org/apache/hadoop/hive/ql/QTestUtil.java:391	javadocs.&lt;br/&gt;
ql/src/test/org/apache/hadoop/hive/ql/QTestUtil.java:391	Where is this function called from?&lt;br/&gt;
build-common.xml:226	why are we excluding TestMTQueries here?&lt;br/&gt;
cli/src/java/org/apache/hadoop/hive/cli/CliDriver.java:62	Would static log not work. If so, we have that all over the code and just fixing it here will not work.&lt;br/&gt;
ql/src/java/org/apache/hadoop/hive/ql/session/SessionState.java:265	javadocs for these.&lt;/p&gt;</comment>
                            <comment id="12652195" author="jsensarma" created="Mon, 1 Dec 2008 23:05:44 +0000"  >&lt;p&gt;thx - will fix the inline comments.&lt;/p&gt;

&lt;p&gt;static LOG: this is not a blocking issue. I am assuming that log4j itself is multithread safe. The main issue is that all log events are going to end up in the same log file - and log entries from different sessions will be interleaved without any clear headers. There&apos;s something called NDC that&apos;s apparently used widely in multi-threaded environments to put prefixes on log entries per thread (in our case session). we can use NDC interfaces from log4j - but it&apos;s more work - potentially more disruptive changes.&lt;/p&gt;

&lt;p&gt;QTestUtil: don&apos;t understand this. today every query file is run independently in a different junit test. if QTestUtil ran all of them (either in sequence or in parallel) - this would not be possible. can u explain a bit more?&lt;/p&gt;</comment>
                            <comment id="12652211" author="appodictic" created="Tue, 2 Dec 2008 00:10:32 +0000"  >&lt;p&gt;Log4j has a variable that will print the thread name. &lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://logging.apache.org/log4j/1.2/apidocs/org/apache/log4j/PatternLayout.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://logging.apache.org/log4j/1.2/apidocs/org/apache/log4j/PatternLayout.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;%t should do it.&lt;/p&gt;</comment>
                            <comment id="12652247" author="athusoo" created="Tue, 2 Dec 2008 02:52:57 +0000"  >&lt;p&gt;@Joy&lt;/p&gt;

&lt;p&gt;I meant rolling up the TestMTQueries into QTestUtil so that we just have a single tool to deal with when it comes to query testing.&lt;/p&gt;

&lt;p&gt;%t as suggested by Edward should work for now. Later when we expand this so that a thread is able to handle multiple sessions (a requirement on JDBC) we can start exploring NDC and MDCs to log thread specific information.&lt;/p&gt;</comment>
                            <comment id="12652448" author="jsensarma" created="Tue, 2 Dec 2008 18:25:09 +0000"  >&lt;p&gt;fixed all the inline comments and moved multithreaded query harness to QTestUtil. &lt;/p&gt;

&lt;p&gt;&amp;gt; ql/src/test/org/apache/hadoop/hive/ql/QTestUtil.java:391 Where is this function called from?&lt;br/&gt;
This is a temporary hack for non-DDL related metastore issues.&lt;/p&gt;

&lt;p&gt;also - i am actually able to run TestMTqueries succesfully now. funnily all the metastore issues are not showing up. There were some more changes required:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;randomize hadoop execution directories for local mode execution (otherwise there are collisions when submitting jobs concurrently)&lt;/li&gt;
	&lt;li&gt;fix taskfactory id to be threadlocal static&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="12653035" author="jsensarma" created="Wed, 3 Dec 2008 23:04:30 +0000"  >&lt;p&gt;another one after resolving Namit&apos;s changes.&lt;/p&gt;</comment>
                            <comment id="12653510" author="athusoo" created="Thu, 4 Dec 2008 22:03:19 +0000"  >&lt;p&gt;+1&lt;/p&gt;

&lt;p&gt;looks good to me.&lt;/p&gt;

&lt;p&gt;Zheng can you checkin...&lt;/p&gt;</comment>
                            <comment id="12653729" author="zshao" created="Fri, 5 Dec 2008 10:11:39 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-77&quot; title=&quot;thread safe query execution&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-77&quot;&gt;&lt;del&gt;HIVE-77&lt;/del&gt;&lt;/a&gt;. Thread safe query execution. (Joydeep through zshao)&lt;br/&gt;
Committed revision 723699.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                            <outwardlinks description="blocks">
                                        <issuelink>
            <issuekey id="12408847">HIVE-73</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12407155">HIVE-30</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12409298">HIVE-80</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12394837" name="hive-77.patch.1" size="31517" author="jsensarma" created="Thu, 27 Nov 2008 10:50:25 +0000"/>
                            <attachment id="12395105" name="hive-77.patch.2" size="38823" author="jsensarma" created="Tue, 2 Dec 2008 18:06:45 +0000"/>
                            <attachment id="12395108" name="hive-77.patch.3" size="40748" author="jsensarma" created="Tue, 2 Dec 2008 18:25:46 +0000"/>
                            <attachment id="12395226" name="hive-77.patch.4" size="47867" author="jsensarma" created="Wed, 3 Dec 2008 23:04:30 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 1 Dec 2008 22:42:57 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>73798</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 1 week ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0l7pj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>121899</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>