<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun Dec 04 00:23:39 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HIVE-3709/HIVE-3709.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HIVE-3709] Stop storing default ConfVars in temp file</title>
                <link>https://issues.apache.org/jira/browse/HIVE-3709</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;To work around issues with Hadoop&apos;s Configuration object, specifically it&apos;s addResource(InputStream), default configurations are written to a temp file (I think &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2362&quot; title=&quot;HiveConf properties not appearing in the output of &amp;#39;set&amp;#39; or &amp;#39;set -v&amp;#39;&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2362&quot;&gt;&lt;del&gt;HIVE-2362&lt;/del&gt;&lt;/a&gt; introduced this).&lt;/p&gt;

&lt;p&gt;This, however, introduces the problem that once that file is deleted from /tmp the client crashes.  This is particularly problematic for long running services like the metastore server.&lt;/p&gt;

&lt;p&gt;Writing a custom InputStream to deal with the problems in the Configuration object should provide a work around, which does not introduce a time bomb into Hive.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12616002">HIVE-3709</key>
            <summary>Stop storing default ConfVars in temp file</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="kevinwilfong">Kevin Wilfong</assignee>
                                    <reporter username="kevinwilfong">Kevin Wilfong</reporter>
                        <labels>
                    </labels>
                <created>Wed, 14 Nov 2012 01:39:35 +0000</created>
                <updated>Thu, 16 May 2013 21:10:08 +0000</updated>
                            <resolved>Thu, 29 Nov 2012 04:50:44 +0000</resolved>
                                    <version>0.10.0</version>
                                    <fixVersion>0.11.0</fixVersion>
                                    <component>Configuration</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                <comments>
                            <comment id="13496751" author="ashutoshc" created="Wed, 14 Nov 2012 01:48:15 +0000"  >&lt;p&gt;+1 for getting rid of writing temp file. I have also been hit by this. &lt;/p&gt;</comment>
                            <comment id="13496763" author="kevinwilfong" created="Wed, 14 Nov 2012 02:12:56 +0000"  >&lt;p&gt;&lt;a href=&quot;https://reviews.facebook.net/D6723&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D6723&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13496810" author="cwsteinbach" created="Wed, 14 Nov 2012 03:29:49 +0000"  >&lt;p&gt;+1. Will commit if tests pass.&lt;/p&gt;</comment>
                            <comment id="13497821" author="cwsteinbach" created="Thu, 15 Nov 2012 07:41:15 +0000"  >&lt;p&gt;@Kevin: While testing I got a failures in TestMTQueries and TestHiveServerSessions. I think these problems can probably be fixed by modifying getConfVarInputStream() to return a new InputStream instead of a cached copy.&lt;/p&gt;</comment>
                            <comment id="13498291" author="kevinwilfong" created="Thu, 15 Nov 2012 20:01:42 +0000"  >&lt;p&gt;Thanks Carl, I switched to caching the byte[] and returning a new InputStream wrapping that byte[]. Now those two tests pass.&lt;/p&gt;</comment>
                            <comment id="13498325" author="cwsteinbach" created="Thu, 15 Nov 2012 20:53:47 +0000"  >&lt;p&gt;+1. Running tests.&lt;/p&gt;</comment>
                            <comment id="13500554" author="cwsteinbach" created="Mon, 19 Nov 2012 19:40:56 +0000"  >&lt;p&gt;@Kevin: I still see errors in TestHiveServerSessions when I run the test individually:&lt;/p&gt;

&lt;p&gt;% ant clean package test -Dtestcase=TestHiveServerSessions&lt;/p&gt;

&lt;p&gt;test:&lt;br/&gt;
     &lt;span class=&quot;error&quot;&gt;&amp;#91;echo&amp;#93;&lt;/span&gt; Project: service&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; WARNING: multiple versions of ant detected in path for junit &lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt;          jar:&lt;a href=&quot;file:/Users/carl/.local/java/ant/lib/ant.jar!/org/apache/tools/ant/Project.class&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;file:/Users/carl/.local/java/ant/lib/ant.jar!/org/apache/tools/ant/Project.class&lt;/a&gt;&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt;      and jar:&lt;a href=&quot;file:/Users/carl/Work/repos/hive-test/build/ivy/lib/hadoop0.20.shim/ant-1.6.5.jar!/org/apache/tools/ant/Project.class&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;file:/Users/carl/Work/repos/hive-test/build/ivy/lib/hadoop0.20.shim/ant-1.6.5.jar!/org/apache/tools/ant/Project.class&lt;/a&gt;&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; Running org.apache.hadoop.hive.service.TestHiveServerSessions&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; Hive history file=/Users/carl/Work/repos/hive-test/build/service/tmp/hive_job_log_carl_201211191056_789001489.txt&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; Tests run: 1, Failures: 0, Errors: 1, Time elapsed: 8.439 sec&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; Hive history file=/Users/carl/Work/repos/hive-test/build/service/tmp/hive_job_log_carl_201211191056_788616740.txt&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;Fatal Error&amp;#93;&lt;/span&gt; :1:1: Content is not allowed in prolog.&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;Fatal Error&amp;#93;&lt;/span&gt; :92:58: The element type &quot;name&quot; must be terminated by the matching end-tag &quot;&amp;lt;/name&amp;gt;&quot;.&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; Test org.apache.hadoop.hive.service.TestHiveServerSessions FAILED&lt;br/&gt;
      &lt;span class=&quot;error&quot;&gt;&amp;#91;for&amp;#93;&lt;/span&gt; /Users/carl/Work/repos/hive-test/service/build.xml: The following error occurred while executing this line:&lt;br/&gt;
      &lt;span class=&quot;error&quot;&gt;&amp;#91;for&amp;#93;&lt;/span&gt; /Users/carl/Work/repos/hive-test/build.xml:325: The following error occurred while executing this line:&lt;br/&gt;
      &lt;span class=&quot;error&quot;&gt;&amp;#91;for&amp;#93;&lt;/span&gt; /Users/carl/Work/repos/hive-test/build-common.xml:455: Tests failed!&lt;/p&gt;

&lt;p&gt;BUILD FAILED&lt;br/&gt;
/Users/carl/Work/repos/hive-test/build.xml:320: Keepgoing execution: 1 of 12 iterations failed.&lt;/p&gt;</comment>
                            <comment id="13501329" author="kevinwilfong" created="Tue, 20 Nov 2012 17:48:13 +0000"  >&lt;p&gt;Individually ran TestHiveServerSessions (several times), TestHiveServer and TestMTQueries and they passed.  Ran the full ant test and that still passes for me.&lt;/p&gt;</comment>
                            <comment id="13504437" author="ashutoshc" created="Tue, 27 Nov 2012 08:03:27 +0000"  >&lt;p&gt;Kevin, Will &lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-8573&quot; title=&quot;Configuration tries to read from an inputstream resource multiple times. &quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-8573&quot;&gt;&lt;del&gt;HADOOP-8573&lt;/del&gt;&lt;/a&gt; fix this?&lt;/p&gt;</comment>
                            <comment id="13504814" author="kevinwilfong" created="Tue, 27 Nov 2012 18:21:43 +0000"  >&lt;p&gt;It looks like that fixes the issue on a single thread where it ends up reading from the same InputStream repeatedly, which is why I overrode the close method to reset the InputStream.&lt;/p&gt;

&lt;p&gt;It does not look like it will fix the multi-threaded issue.  If two threads get Configuration objects constructed using the copy constructor, and hence get the same InputStream since the resources are not cloned themselves, and loadResources has not been called before the copy constructor, it looks like it could be possible that both threads call loadResources at about the same time causing the issues Carl was seeing in TestHiveServerSessions.&lt;/p&gt;</comment>
                            <comment id="13505292" author="cwsteinbach" created="Wed, 28 Nov 2012 08:19:55 +0000"  >&lt;p&gt;Another option for fixing this problem is to give administrators the ability to specify the location where the temporary file should be written (for setuid processes running on POSIX systems the conventional location is somewhere under /var). For example we could add a configuration property named hive.process.local.temporary.dir and have it default to $&lt;/p&gt;
{user.home}
&lt;p&gt;/.hive/$&lt;/p&gt;
{process_id}
&lt;p&gt;.&lt;/p&gt;
</comment>
                            <comment id="13505455" author="ctm" created="Wed, 28 Nov 2012 14:02:55 +0000"  >&lt;p&gt;I was also looking into this with 3596, I was able to fix utilizing a location similar to the suggestion Carl made above, however I think that pushes the problem to another location, rather than addressing the actual issue. I like where Kevin is going with this fix, I had thought about the possibility of checking the confVarURL in the copy constructor, removing and re-creating if it did not exist, but even that would not be perfect depending upon timing. &lt;/p&gt;</comment>
                            <comment id="13505838" author="kevinwilfong" created="Wed, 28 Nov 2012 19:49:58 +0000"  >&lt;p&gt;I had considered the solution Carl mentioned, but I didn&apos;t go that route because it could result in clutter in the directory specified, in particular we can&apos;t guarantee the file will be deleted in the presence of catastrophic failures.  To solve this the user would need to set up some sort of periodic cleanup which puts us back in the same position.  We might be able to work around this by regularly touching the file, but I&apos;m not 100% sure.&lt;/p&gt;

&lt;p&gt;Carl, are you still seeing threading problems with the most recent patch?  TestHiveServerSessions has been succeeding for me consistently.&lt;/p&gt;</comment>
                            <comment id="13505847" author="ashutoshc" created="Wed, 28 Nov 2012 19:56:57 +0000"  >&lt;p&gt;I am also not in favor of workaround. Writing to a filesystem unnecessarily should be avoided. Kevin&apos;s approach is better.&lt;/p&gt;</comment>
                            <comment id="13506213" author="cwsteinbach" created="Thu, 29 Nov 2012 04:50:44 +0000"  >&lt;p&gt;Committed to trunk. Thanks Kevin!&lt;/p&gt;</comment>
                            <comment id="13506216" author="cwsteinbach" created="Thu, 29 Nov 2012 04:52:02 +0000"  >&lt;p&gt;@Kevin: I tried running TestHiveServerSessions again and wasn&apos;t able to provoke the failure I saw before.&lt;/p&gt;</comment>
                            <comment id="13506407" author="hudson" created="Thu, 29 Nov 2012 11:21:19 +0000"  >&lt;p&gt;Integrated in Hive-trunk-h0.21 #1824 (See &lt;a href=&quot;https://builds.apache.org/job/Hive-trunk-h0.21/1824/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/Hive-trunk-h0.21/1824/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-3709&quot; title=&quot;Stop storing default ConfVars in temp file&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-3709&quot;&gt;&lt;del&gt;HIVE-3709&lt;/del&gt;&lt;/a&gt;. Stop storing default ConfVars in temp file (Kevin Wilfong via cws) (Revision 1415038)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
cws : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1415038&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1415038&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hive/trunk/common/src/java/org/apache/hadoop/hive/conf/HiveConf.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/common/src/java/org/apache/hadoop/hive/conf/LoopingByteArrayInputStream.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13547880" author="hudson" created="Wed, 9 Jan 2013 10:23:26 +0000"  >&lt;p&gt;Integrated in Hive-trunk-hadoop2 #54 (See &lt;a href=&quot;https://builds.apache.org/job/Hive-trunk-hadoop2/54/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/Hive-trunk-hadoop2/54/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-3709&quot; title=&quot;Stop storing default ConfVars in temp file&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-3709&quot;&gt;&lt;del&gt;HIVE-3709&lt;/del&gt;&lt;/a&gt;. Stop storing default ConfVars in temp file (Kevin Wilfong via cws) (Revision 1415038)&lt;/p&gt;

&lt;p&gt;     Result = ABORTED&lt;br/&gt;
cws : &lt;a href=&quot;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1415038&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewcvs.cgi/?root=Apache-SVN&amp;amp;view=rev&amp;amp;rev=1415038&lt;/a&gt;&lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hive/trunk/common/src/java/org/apache/hadoop/hive/conf/HiveConf.java&lt;/li&gt;
	&lt;li&gt;/hive/trunk/common/src/java/org/apache/hadoop/hive/conf/LoopingByteArrayInputStream.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="12612412">HIVE-3596</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12553434" name="HIVE-3709.1.patch.txt" size="5445" author="kevinwilfong" created="Wed, 14 Nov 2012 02:13:54 +0000"/>
                            <attachment id="12553692" name="HIVE-3709.2.patch.txt" size="5432" author="kevinwilfong" created="Thu, 15 Nov 2012 20:01:24 +0000"/>
                            <attachment id="12554373" name="HIVE-3709.3.patch.txt" size="7371" author="kevinwilfong" created="Tue, 20 Nov 2012 17:46:59 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 14 Nov 2012 01:48:15 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>257615</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 47 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0k3kv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>115397</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>