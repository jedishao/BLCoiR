<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sat Dec 03 01:04:27 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HIVE-84/HIVE-84.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HIVE-84] MetaStore Client is not thread safe</title>
                <link>https://issues.apache.org/jira/browse/HIVE-84</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;when running DDL Tasks in concurrent threads - the following exception trace is observed:&lt;/p&gt;

&lt;p&gt;java.sql.SQLIntegrityConstraintViolationException: The statement was aborted because it would have caused a duplicate ke\ y value in a unique or primary key constraint or unique index identified by &apos;UNIQUETABLE&apos; defined on &apos;TBLS&apos;.&lt;br/&gt;
  at org.apache.hadoop.hive.ql.metadata.Hive.createTable(Hive.java:207)&lt;br/&gt;
  at org.apache.hadoop.hive.ql.exec.DDLTask.execute(DDLTask.java:209)&lt;br/&gt;
  at org.apache.hadoop.hive.ql.Driver.run(Driver.java:174)&lt;br/&gt;
  at org.apache.hadoop.hive.cli.CliDriver.processCmd(CliDriver.java:185)&lt;br/&gt;
  at org.apache.hadoop.hive.cli.CliDriver.processLine(CliDriver.java:210)&lt;br/&gt;
  at org.apache.hadoop.hive.ql.QTestUtil.executeClient(QTestUtil.java:390)&lt;br/&gt;
  at org.apache.hadoop.hive.ql.QTestUtil$QTRunner.run(QTestUtil.java:681)&lt;br/&gt;
  at java.lang.Thread.run(Thread.java:619)&lt;br/&gt;
Caused by: javax.jdo.JDODataStoreException: Insert of object &quot;org.apache.hadoop.hive.metastore.model.MTable@3bc8d400&quot; us\ ing statement &quot;INSERT INTO TBLS (TBL_ID,CREATE_TIME,DB_ID,RETENTION,TBL_NAME,SD_ID,OWNER,LAST_ACCESS_TIME) VALUES (?,?,?\ ,?,?,?,?,?)&quot; failed : The statement was aborted because it would have caused a duplicate key value in a unique or primar\ y key constraint or unique index identified by &apos;UNIQUETABLE&apos; defined on &apos;TBLS&apos;.&lt;br/&gt;
NestedThrowables:&lt;br/&gt;
java.sql.SQLIntegrityConstraintViolationException: The statement was aborted because it would have caused a duplicate ke\ y value in a unique or primary key constraint or unique index identified by &apos;UNIQUETABLE&apos; defined on &apos;TBLS&apos;.&lt;br/&gt;
  at org.jpox.jdo.JPOXJDOHelper.getJDOExceptionForJPOXException(JPOXJDOHelper.java:291)&lt;br/&gt;
  at org.jpox.jdo.AbstractPersistenceManager.jdoMakePersistent(AbstractPersistenceManager.java:671)&lt;br/&gt;
  at org.jpox.jdo.AbstractPersistenceManager.makePersistent(AbstractPersistenceManager.java:691)&lt;br/&gt;
  at org.apache.hadoop.hive.metastore.ObjectStore.createTable(ObjectStore.java:479)&lt;br/&gt;
  at org.apache.hadoop.hive.metastore.HiveMetaStore$HMSHandler.create_table(HiveMetaStore.java:292)&lt;br/&gt;
  at org.apache.hadoop.hive.metastore.HiveMetaStoreClient.createTable(HiveMetaStoreClient.java:252)&lt;br/&gt;
  at org.apache.hadoop.hive.ql.metadata.Hive.createTable(Hive.java:205)&lt;br/&gt;
  ... 7 more&lt;br/&gt;
Caused by: java.sql.SQLIntegrityConstraintViolationException: The statement was aborted because it would have caused a d\ uplicate key value in a unique or primary key constraint or unique index identified by &apos;UNIQUETABLE&apos; defined on &apos;TBLS&apos;.&lt;br/&gt;
  at org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(Unknown Source)&lt;br/&gt;
  at org.apache.derby.impl.jdbc.Util.generateCsSQLException(Unknown Source)&lt;br/&gt;
  at org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(Unknown Source)&lt;br/&gt;
  at org.apache.derby.impl.jdbc.TransactionResourceImpl.handleException(Unknown Source)&lt;br/&gt;
  at org.apache.derby.impl.jdbc.EmbedConnection.handleException(Unknown Source)&lt;br/&gt;
  at org.apache.derby.impl.jdbc.ConnectionChild.handleException(Unknown Source)&lt;br/&gt;
  at org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(Unknown Source)&lt;br/&gt;
  at org.apache.derby.impl.jdbc.EmbedPreparedStatement.executeStatement(Unknown Source)&lt;br/&gt;
  at org.apache.derby.impl.jdbc.EmbedPreparedStatement.executeUpdate(Unknown Source)&lt;br/&gt;
  at org.jpox.store.rdbms.SQLController.executeStatementUpdate(SQLController.java:396)&lt;br/&gt;
  at org.jpox.store.rdbms.request.InsertRequest.execute(InsertRequest.java:370)&lt;br/&gt;
  at org.jpox.store.rdbms.RDBMSPersistenceHandler.insertTable(RDBMSPersistenceHandler.java:157)&lt;br/&gt;
  at org.jpox.store.rdbms.RDBMSPersistenceHandler.insertObject(RDBMSPersistenceHandler.java:136)&lt;br/&gt;
  at org.jpox.state.JDOStateManagerImpl.internalMakePersistent(JDOStateManagerImpl.java:3082)&lt;br/&gt;
  at org.jpox.state.JDOStateManagerImpl.makePersistent(JDOStateManagerImpl.java:3062)&lt;br/&gt;
  at org.jpox.ObjectManagerImpl.persistObjectInternal(ObjectManagerImpl.java:1231)&lt;br/&gt;
  at org.jpox.ObjectManagerImpl.persistObject(ObjectManagerImpl.java:1077)&lt;br/&gt;
  at org.jpox.jdo.AbstractPersistenceManager.jdoMakePersistent(AbstractPersistenceManager.java:666)&lt;br/&gt;
  ... 12 more&lt;br/&gt;
Caused by: java.sql.SQLException: The statement was aborted because it would have caused a duplicate key value in a uniq\ ue or primary key constraint or unique index identified by &apos;UNIQUETABLE&apos; defined on &apos;TBLS&apos;.&lt;br/&gt;
  at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(Unknown Source)&lt;br/&gt;
  at org.apache.derby.impl.jdbc.SQLExceptionFactory40.wrapArgsForTransportAcrossDRDA(Unknown Source)&lt;br/&gt;
  ... 30 more&lt;br/&gt;
Caused by: ERROR 23505: The statement was aborted because it would have caused a duplicate key value in a unique or prim\ ary key constraint or unique index identified by &apos;UNIQUETABLE&apos; defined on &apos;TBLS&apos;.&lt;br/&gt;
  at org.apache.derby.iapi.error.StandardException.newException(Unknown Source)&lt;br/&gt;
  at org.apache.derby.impl.sql.execute.IndexChanger.insertAndCheckDups(Unknown Source)&lt;br/&gt;
  at org.apache.derby.impl.sql.execute.IndexChanger.doInsert(Unknown Source)&lt;br/&gt;
  at org.apache.derby.impl.sql.execute.IndexChanger.insert(Unknown Source)&lt;br/&gt;
  at org.apache.derby.impl.sql.execute.IndexSetChanger.insert(Unknown Source)&lt;br/&gt;
  at org.apache.derby.impl.sql.execute.RowChangerImpl.insertRow(Unknown Source)&lt;br/&gt;
  at org.apache.derby.impl.sql.execute.InsertResultSet.normalInsertCore(Unknown Source)&lt;br/&gt;
  at org.apache.derby.impl.sql.execute.InsertResultSet.open(Unknown Source)&lt;/p&gt;

&lt;p&gt;when running normal select queries as well - one hits exception, stack trace:&lt;/p&gt;

&lt;p&gt;2008-11-27 01:54:00,216 ERROR metadata.Hive (Hive.java:getTable(275)) - NoSuchObjectException(message:default.dummySrc t\&lt;br/&gt;
able not found)&lt;br/&gt;
  at org.apache.hadoop.hive.metastore.HiveMetaStore$HMSHandler.get_table(HiveMetaStore.java:347)&lt;br/&gt;
  at org.apache.hadoop.hive.metastore.HiveMetaStoreClient.getTable(HiveMetaStoreClient.java:433)&lt;br/&gt;
  at org.apache.hadoop.hive.metastore.HiveMetaStoreClient.getTable(HiveMetaStoreClient.java:472)&lt;br/&gt;
  at org.apache.hadoop.hive.ql.metadata.Hive.getTable(Hive.java:272)&lt;br/&gt;
  at org.apache.hadoop.hive.ql.metadata.Hive.getTable(Hive.java:254)&lt;br/&gt;
  at org.apache.hadoop.hive.ql.parse.SemanticAnalyzer.getMetaData(SemanticAnalyzer.java:544)&lt;br/&gt;
  at org.apache.hadoop.hive.ql.parse.SemanticAnalyzer.analyzeInternal(SemanticAnalyzer.java:3192)&lt;br/&gt;
  at org.apache.hadoop.hive.ql.parse.BaseSemanticAnalyzer.analyze(BaseSemanticAnalyzer.java:73)&lt;br/&gt;
  at org.apache.hadoop.hive.ql.QTestUtil.analyzeAST(QTestUtil.java:672)&lt;br/&gt;
  at org.apache.hadoop.hive.ql.parse.TestParseNegative.testParseNegative_unknown_table1(TestParseNegative.java:231)&lt;br/&gt;
  at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
  at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)&lt;br/&gt;
  at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
  at java.lang.reflect.Method.invoke(Method.java:597)&lt;br/&gt;
  at junit.framework.TestCase.runTest(TestCase.java:154)&lt;br/&gt;
  at junit.framework.TestCase.runBare(TestCase.java:127)&lt;br/&gt;
  at junit.framework.TestResult$1.protect(TestResult.java:106)&lt;br/&gt;
  at junit.framework.TestResult.runProtected(TestResult.java:124)&lt;br/&gt;
  at junit.framework.TestResult.run(TestResult.java:109)&lt;br/&gt;
  at junit.framework.TestCase.run(TestCase.java:118)&lt;br/&gt;
  at junit.framework.TestSuite.runTest(TestSuite.java:208)&lt;br/&gt;
  at junit.framework.TestSuite.run(TestSuite.java:203)&lt;br/&gt;
  at org.apache.tools.ant.taskdefs.optional.junit.JUnitTestRunner.run(JUnitTestRunner.java:297)&lt;br/&gt;
  at org.apache.tools.ant.taskdefs.optional.junit.JUnitTestRunner.launch(JUnitTestRunner.java:672)&lt;br/&gt;
  at org.apache.tools.ant.taskdefs.optional.junit.JUnitTestRunner.main(JUnitTestRunner.java:567)&lt;/p&gt;
</description>
                <environment>&lt;p&gt;with patch for hive-77 - run:&lt;/p&gt;

&lt;p&gt;ant -lib ./testlibs -Dtestcase=TestMTQueries test&lt;/p&gt;</environment>
        <key id="12409386">HIVE-84</key>
            <summary>MetaStore Client is not thread safe</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="prasadc">Prasad Chakka</assignee>
                                    <reporter username="jsensarma">Joydeep Sen Sarma</reporter>
                        <labels>
                    </labels>
                <created>Thu, 27 Nov 2008 11:03:48 +0000</created>
                <updated>Sat, 17 Dec 2011 00:08:31 +0000</updated>
                            <resolved>Tue, 6 Jan 2009 22:03:49 +0000</resolved>
                                    <version>0.6.0</version>
                                    <fixVersion>0.3.0</fixVersion>
                                    <component>Metastore</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="12658075" author="prasadc" created="Fri, 19 Dec 2008 12:41:04 +0000"  >&lt;p&gt;I think each thread here needs a separate Hive db since each thread will have its own database session (transaction). Metastore Client (s0 Hive.java) is never intended to be thread-safe. I am not sure how the problem went away in &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-77&quot; title=&quot;thread safe query execution&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-77&quot;&gt;&lt;del&gt;HIVE-77&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;
</comment>
                            <comment id="12660169" author="prasadc" created="Thu, 1 Jan 2009 01:30:24 +0000"  >&lt;p&gt;in the patch, Hive.java maintains metastore client in tss which makes it thread safe. Also it provides a new function to refresh the HiveConf. &lt;/p&gt;</comment>
                            <comment id="12660785" author="athusoo" created="Mon, 5 Jan 2009 15:21:20 +0000"  >&lt;p&gt;Do you still need the needsRefresh code in SessionState.java&lt;/p&gt;

&lt;p&gt;Also why just check for the refresh stuff only for MetaVars and why not do it for all the vars? Why the special case?&lt;/p&gt;</comment>
                            <comment id="12660840" author="prasadc" created="Mon, 5 Jan 2009 18:30:38 +0000"  >&lt;p&gt;I don&apos;t think needsRefresh code is needed in SessionState.java&lt;/p&gt;

&lt;p&gt;I think only these variables are needed to check whether connection to metadata server is needs to reset. But would it be safe to change conf to whatever passed in through Hive.get() function and refresh only when meta vars change?&lt;/p&gt;</comment>
                            <comment id="12660877" author="prasadc" created="Mon, 5 Jan 2009 19:54:09 +0000"  >&lt;p&gt;ok, i take back my previous comment about needsRefresh code not being needed in SessionState.java. That is the only place where a copy of the current metastore options stored. So even if HiveConf object is directly changed, we would know what these options were for the current connection.&lt;/p&gt;</comment>
                            <comment id="12661007" author="athusoo" created="Tue, 6 Jan 2009 00:53:50 +0000"  >&lt;p&gt;Prasad explained to me why this is needed in SessionState.java.&lt;/p&gt;

&lt;p&gt;So &lt;/p&gt;

&lt;p&gt;+1 on this modulo cleanups. I think we can refactor the code a bit so that all the refresh logic is at one place. Please file a separate JIRA for that.&lt;/p&gt;</comment>
                            <comment id="12661358" author="dhruba" created="Tue, 6 Jan 2009 22:03:49 +0000"  >&lt;p&gt;I just committed this. Thanks Prasad!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12396987" name="hive-84.patch" size="14982" author="prasadc" created="Thu, 1 Jan 2009 01:29:05 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 19 Dec 2008 12:41:04 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>73793</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 48 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0l7r3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>121906</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>