<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 02 23:52:52 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HIVE-1681/HIVE-1681.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HIVE-1681] ObjectStore.commitTransaction() does not properly handle transactions that have already been rolled back</title>
                <link>https://issues.apache.org/jira/browse/HIVE-1681</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;Here&apos;s the code for ObjectStore.commitTransaction() and ObjectStore.rollbackTransaction():&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; commitTransaction() {
    &lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; (openTrasactionCalls &amp;gt;= 1);
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!currentTransaction.isActive()) {
      &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; RuntimeException(
          &lt;span class=&quot;code-quote&quot;&gt;&quot;Commit is called, but transaction is not active. Either there are&quot;&lt;/span&gt;
              + &lt;span class=&quot;code-quote&quot;&gt;&quot; mismatching open and close calls or rollback was called in the same trasaction&quot;&lt;/span&gt;);
    }
    openTrasactionCalls--;
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; ((openTrasactionCalls == 0) &amp;amp;&amp;amp; currentTransaction.isActive()) {
      transactionStatus = TXN_STATUS.COMMITED;
      currentTransaction.commit();
    }
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
  }

  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void rollbackTransaction() {
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (openTrasactionCalls &amp;lt; 1) {
      &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt;;
    }
    openTrasactionCalls = 0;
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (currentTransaction.isActive()
        &amp;amp;&amp;amp; transactionStatus != TXN_STATUS.ROLLBACK) {
      transactionStatus = TXN_STATUS.ROLLBACK;
      &lt;span class=&quot;code-comment&quot;&gt;// could already be rolled back
&lt;/span&gt;      currentTransaction.rollback();
    }
  }

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Now suppose a nested transaction throws an exception which results&lt;br/&gt;
in the nested pseudo-transaction calling rollbackTransaction(). This causes&lt;br/&gt;
rollbackTransaction() to rollback the actual transaction, as well as to set &lt;br/&gt;
openTransactionCalls=0 and transactionStatus = TXN_STATUS.ROLLBACK.&lt;br/&gt;
Suppose also that this nested transaction squelches the original exception.&lt;br/&gt;
In this case the stack will unwind and the caller will eventually try to commit the&lt;br/&gt;
transaction by calling commitTransaction() which will see that currentTransaction.isActive() returns&lt;br/&gt;
FALSE and will throw a RuntimeException. The fix for this problem is&lt;br/&gt;
that commitTransaction() needs to first check transactionStatus and return immediately&lt;br/&gt;
if transactionStatus==TXN_STATUS.ROLLBACK.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12475585">HIVE-1681</key>
            <summary>ObjectStore.commitTransaction() does not properly handle transactions that have already been rolled back</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="cwsteinbach">Carl Steinbach</assignee>
                                    <reporter username="cwsteinbach">Carl Steinbach</reporter>
                        <labels>
                    </labels>
                <created>Fri, 1 Oct 2010 08:29:48 +0000</created>
                <updated>Sat, 17 Dec 2011 00:03:53 +0000</updated>
                            <resolved>Fri, 15 Oct 2010 16:45:32 +0000</resolved>
                                    <version>0.5.0</version>
                                    <fixVersion>0.6.0</fixVersion>
                                    <component>Metastore</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="12917520" author="svenkat" created="Mon, 4 Oct 2010 08:36:37 +0000"  >&lt;p&gt;The query ran successfully with this patch. Thanks Carl. Appreciate if this can be committed quickly.&lt;/p&gt;</comment>
                            <comment id="12920266" author="nzhang" created="Tue, 12 Oct 2010 17:32:33 +0000"  >&lt;p&gt;@venkatesh, could you reproduce the error without the patch? If so could you share your query so that Carl could include that in a unit test?&lt;/p&gt;</comment>
                            <comment id="12920318" author="pauly" created="Tue, 12 Oct 2010 19:33:31 +0000"  >&lt;p&gt;Somewhat related - can you make a change to add_partitions_core() to use the return value of commitTransaction() as a part of this patch? Also, is it possible to make a test case for this issue?&lt;/p&gt;</comment>
                            <comment id="12920771" author="cwsteinbach" created="Wed, 13 Oct 2010 21:24:59 +0000"  >&lt;p&gt;@Ning/Paul: We need to add concurrent metastore tests in order to catch problems like this.&lt;br/&gt;
I filed this task as a separate ticket: &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-1710&quot; title=&quot;Add Metastore Concurrency Tests&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-1710&quot;&gt;HIVE-1710&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="12921069" author="nzhang" created="Thu, 14 Oct 2010 18:36:58 +0000"  >&lt;p&gt;Looks good to me. I&apos;ll start testing.&lt;/p&gt;

&lt;p&gt;Paul can you also take a look?&lt;/p&gt;
</comment>
                            <comment id="12921149" author="jvs" created="Thu, 14 Oct 2010 22:02:56 +0000"  >&lt;p&gt;Marking this for 0.6 since Carl posted a backport.&lt;/p&gt;</comment>
                            <comment id="12921153" author="cwsteinbach" created="Thu, 14 Oct 2010 22:44:12 +0000"  >&lt;p&gt;Uploading a new version of the backport patch which is a verbatim backport of the patch for trunk. I accidentally included additional changes in the original backport patch which are not present in the trunk patch.&lt;/p&gt;</comment>
                            <comment id="12921247" author="nzhang" created="Fri, 15 Oct 2010 06:30:01 +0000"  >&lt;p&gt;Committed the patch for trunk. Will test the new 0.6 patch.&lt;/p&gt;</comment>
                            <comment id="12921439" author="nzhang" created="Fri, 15 Oct 2010 16:45:32 +0000"  >&lt;p&gt;Committed to both trunk and branch 0.6. Thanks Carl!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12477276">HIVE-1710</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12477276">HIVE-1710</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12457100" name="HIVE-1681-backport06.1.patch.txt" size="3386" author="cwsteinbach" created="Wed, 13 Oct 2010 21:25:35 +0000"/>
                            <attachment id="12457201" name="HIVE-1681-backport06.2.patch.txt" size="1049" author="cwsteinbach" created="Thu, 14 Oct 2010 22:44:12 +0000"/>
                            <attachment id="12456093" name="HIVE-1681.1.patch.txt" size="2623" author="cwsteinbach" created="Fri, 1 Oct 2010 08:49:45 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 4 Oct 2010 08:36:37 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>72773</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 8 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0lgd3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>123301</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>