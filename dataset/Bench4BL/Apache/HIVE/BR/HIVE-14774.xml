<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 02 06:19:40 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HIVE-14774/HIVE-14774.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HIVE-14774] Canceling query using Ctrl-C in beeline might lead to stale locks</title>
                <link>https://issues.apache.org/jira/browse/HIVE-14774</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;Terminating a running query using Ctrl-C in Beeline might lead to stale locks since the process running the query might still be able to acquire the locks but fail to release them after the query terminate abnormally.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13005436">HIVE-14774</key>
            <summary>Canceling query using Ctrl-C in beeline might lead to stale locks</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ctang.ma">Chaoyu Tang</assignee>
                                    <reporter username="ctang.ma">Chaoyu Tang</reporter>
                        <labels>
                    </labels>
                <created>Fri, 16 Sep 2016 13:30:29 +0000</created>
                <updated>Thu, 22 Sep 2016 18:50:38 +0000</updated>
                            <resolved>Thu, 22 Sep 2016 18:50:38 +0000</resolved>
                                                    <fixVersion>2.2.0</fixVersion>
                    <fixVersion>2.1.1</fixVersion>
                                    <component>Locking</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                <comments>
                            <comment id="15511379" author="ctang.ma" created="Wed, 21 Sep 2016 22:20:34 +0000"  >&lt;p&gt;Kill the process running query in the background before close/destroy the Driver instance. Otherwise, under certain race condition, the running process might still access some driver fields (e.g. plan, ctx) which have been nullified in the cleanup process and cause some uncaught runtime errors. Some resources such as locks might also not be cleared properly.&lt;/p&gt;</comment>
                            <comment id="15511383" author="ctang.ma" created="Wed, 21 Sep 2016 22:21:50 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mohitsabharwal&quot; class=&quot;user-hover&quot; rel=&quot;mohitsabharwal&quot;&gt;Mohit Sabharwal&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jxiang&quot; class=&quot;user-hover&quot; rel=&quot;jxiang&quot;&gt;Jimmy Xiang&lt;/a&gt; could you review the patch? Thanks.&lt;/p&gt;</comment>
                            <comment id="15511503" author="jxiang" created="Wed, 21 Sep 2016 23:21:31 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="15511583" author="hiveqa" created="Thu, 22 Sep 2016 00:04:09 +0000"  >

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12829705/HIVE-14774.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12829705/HIVE-14774.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to no test(s) being added or modified.&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 6 failed/errored test(s), 10554 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[acid_mapjoin]
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[ctas]
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver[vector_join_part_col_char]
org.apache.hadoop.hive.cli.TestMiniTezCliDriver.testCliDriver[explainuser_3]
org.apache.hadoop.hive.metastore.TestMetaStoreMetrics.testMetaDataCounts
org.apache.hive.jdbc.TestJdbcWithMiniHS2.testAddJarConstructorUnCaching
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/1262/testReport&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/1262/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HIVE-Build/1262/console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HIVE-Build/1262/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://ec2-204-236-174-241.us-west-1.compute.amazonaws.com/logs/PreCommit-HIVE-Build-1262/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://ec2-204-236-174-241.us-west-1.compute.amazonaws.com/logs/PreCommit-HIVE-Build-1262/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 6 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12829705 - PreCommit-HIVE-Build&lt;/p&gt;</comment>
                            <comment id="15511956" author="mohitsabharwal" created="Thu, 22 Sep 2016 03:11:34 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ctang.ma&quot; class=&quot;user-hover&quot; rel=&quot;ctang.ma&quot;&gt;Chaoyu Tang&lt;/a&gt;, since locks are cleared in driver.destroy(), I was wondering how killing the query process is related to clearing locks.  &lt;/p&gt;</comment>
                            <comment id="15512057" author="ctang.ma" created="Thu, 22 Sep 2016 04:10:51 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mohitsabharwal&quot; class=&quot;user-hover&quot; rel=&quot;mohitsabharwal&quot;&gt;Mohit Sabharwal&lt;/a&gt; SQLOperation is running a query in a background thread, its driver does lock acquisition, query execution etc. When Ctrl-C shuts down Beeline, it triggers TServerEventHandler deleteContext which in term closes the Session therefore cleaning up the operation (in the session thread). This cleanup close/destroy Driver (nullify its fields like ctx, plan etc), so the Driver running in background might fail in a certain step by RuntimeException (e.g. NPE) which have not been handled completely or properly in Hive. In a race condition when the Drive is about to acquire the locks in background thread and the SQLOperation cleanup has destroyed/closed driver but not yet kill the ground thread, the query process running in the background could still be able to acquire the locks but these locks might never have a chance to be cleared later.&lt;br/&gt;
The simplest and right way is first to kill the running query in the background, followed by driver close/destroy which ensures that  the locks, if any, acquired in the Driver would be cleared.&lt;br/&gt;
Does that make sense?&lt;/p&gt;</comment>
                            <comment id="15513999" author="mohitsabharwal" created="Thu, 22 Sep 2016 17:59:14 +0000"  >&lt;p&gt;LGTM as well +1&lt;/p&gt;</comment>
                            <comment id="15514151" author="ctang.ma" created="Thu, 22 Sep 2016 18:50:38 +0000"  >&lt;p&gt;Committed to 2.2.0 and 2.1.1. Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jxiang&quot; class=&quot;user-hover&quot; rel=&quot;jxiang&quot;&gt;Jimmy Xiang&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mohitsabharwal&quot; class=&quot;user-hover&quot; rel=&quot;mohitsabharwal&quot;&gt;Mohit Sabharwal&lt;/a&gt; for the review.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12829705" name="HIVE-14774.patch" size="1462" author="ctang.ma" created="Wed, 21 Sep 2016 22:20:34 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 21 Sep 2016 23:21:31 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i33ppj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>