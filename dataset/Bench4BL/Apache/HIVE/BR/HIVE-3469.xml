<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sat Dec 03 22:21:59 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HIVE-3469/HIVE-3469.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HIVE-3469] When new hive cluster is started, hive jdbc client hangs.</title>
                <link>https://issues.apache.org/jira/browse/HIVE-3469</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;The scenario is as follows  : &lt;br/&gt;
For the new hive cluster , when multiple hive client is getting the connection for hive server , there are 3 problems in metastore , hive client.&lt;br/&gt;
1. Since the derby is booted at first connection,  multiple client try to create database.One of the client succeed and another one throw exception because of &lt;b&gt;unique primary constraint&lt;/b&gt; in metatables.&lt;/p&gt;

&lt;p&gt;2. Once the Runtime exception is throw, the hive client which is made connection request will hang forever.&lt;/p&gt;

&lt;p&gt;3. Potentially &quot;ConcurrentModificationException&quot; is thrown by JDOQuery.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Hadoop-2.0.1 + Hive-0.9.0&lt;/p&gt;</environment>
        <key id="12607753">HIVE-3469</key>
            <summary>When new hive cluster is started, hive jdbc client hangs.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="3">Duplicate</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="rohithsharma">Rohith Sharma K S</reporter>
                        <labels>
                    </labels>
                <created>Sat, 15 Sep 2012 08:58:00 +0000</created>
                <updated>Mon, 24 Sep 2012 06:25:02 +0000</updated>
                            <resolved>Mon, 24 Sep 2012 06:24:41 +0000</resolved>
                                                                    <component>Clients</component>
                    <component>Metastore</component>
                    <component>Thrift API</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="13456356" author="rohithsharma" created="Sat, 15 Sep 2012 09:04:05 +0000"  >&lt;p&gt;1. For the first problem , exception from JDO is primary constraint.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Caused by: javax.jdo.JDODataStoreException: Insert of object &quot;org.apache.hadoop.hive.metastore.model.MDatabase@63280c85&quot; using statement &quot;INSERT INTO DBS (DB_ID,DB_LOCATION_URI,&quot;NAME&quot;,&quot;DESC&quot;) VALUES (?,?,?,?)&quot; failed : The statement was aborted because it would have caused a duplicate key value in a unique or primary key constraint or unique index identified by &apos;UNIQUE_DATABASE&apos; defined on &apos;DBS&apos;.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;2. For the third proble, exception trace is  &lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;2012-09-14 20:26:22,507 ERROR server.TThreadPoolServer (TThreadPoolServer.java:run(182)) - Error occurred during processing of message.
java.lang.RuntimeException: java.util.ConcurrentModificationException
	at org.apache.hadoop.hive.service.HiveServer$ThriftHiveProcessorFactory.getProcessor(HiveServer.java:572)
	at org.apache.thrift.server.TThreadPoolServer$WorkerProcess.run(TThreadPoolServer.java:169)
	at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)
	at java.lang.Thread.run(Thread.java:662)
Caused by: java.util.ConcurrentModificationException
	at java.util.Hashtable$Enumerator.next(Hashtable.java:1031)
	at org.datanucleus.store.rdbms.query.legacy.JDOQLQuery.getParsedImports(JDOQLQuery.java:364)
	at org.datanucleus.store.rdbms.query.legacy.JDOQLQuery.compileInternal(JDOQLQuery.java:174)
	at org.datanucleus.store.query.Query.executeQuery(Query.java:1628)
	at org.datanucleus.store.rdbms.query.legacy.JDOQLQuery.executeQuery(JDOQLQuery.java:245)
	at org.datanucleus.store.query.Query.executeWithArray(Query.java:1499)
	at org.datanucleus.jdo.JDOQuery.execute(JDOQuery.java:243)
	at org.apache.hadoop.hive.metastore.ObjectStore.getMDatabase(ObjectStore.java:389)
	at org.apache.hadoop.hive.metastore.ObjectStore.getDatabase(ObjectStore.java:408)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
         ...
         ...
         at $Proxy0.getDatabase(Unknown Source)
	at org.apache.hadoop.hive.metastore.HiveMetaStore$HMSHandler.createDefaultDB_core(HiveMetaStore.java:351)
	at org.apache.hadoop.hive.metastore.HiveMetaStore$HMSHandler.createDefaultDB(HiveMetaStore.java:375)
	at org.apache.hadoop.hive.metastore.HiveMetaStore$HMSHandler.init(HiveMetaStore.java:278)  
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13456357" author="rohithsharma" created="Sat, 15 Sep 2012 09:09:48 +0000"  >&lt;p&gt;Any exception in above 1 or 3, Hive client hangs forever.&lt;/p&gt;

&lt;p&gt;If we synchronize Metastore.createDefaultDB_core(), all the 3 problem can be resolved. Please suggest your opinion..&lt;/p&gt;</comment>
                            <comment id="13457216" author="cwsteinbach" created="Mon, 17 Sep 2012 18:44:17 +0000"  >&lt;p&gt;It looks like createDefaultDB() (which calls createDefaultDB_core()) is already synchronized. Any idea why this doesn&apos;t solve the problem?&lt;/p&gt;</comment>
                            <comment id="13457605" author="rohithsharma" created="Tue, 18 Sep 2012 05:07:13 +0000"  >&lt;blockquote&gt;&lt;p&gt;Any idea why this doesn&apos;t solve the problem?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I am using hive branch-0.9.0. The above problem is fixed in Hive-Trunk only.&lt;/p&gt;

&lt;p&gt;I gone through the hive-trunk code for the above problem. I have one doubt on the synchronization,&lt;br/&gt;
Exact synchronization problem exist on method createDefaultDB_core(). Why it is synchronized for calling method createDefaultDB().?&lt;/p&gt;

&lt;p&gt;Correct me If I am wrong, synchronizing calling method impact would be on getting client connection is delayed. There is &quot;if&quot; block in method &quot;createDefaultDB()&quot;  that check for flag &quot;createDefaultDB&quot;. Synchronizing to this method lead execute this if check only one client. This if check we can do parallel by bringing down synchronization one layer to the method createDefaultDB_core().&lt;/p&gt;</comment>
                            <comment id="13458001" author="cwsteinbach" created="Tue, 18 Sep 2012 17:57:34 +0000"  >&lt;p&gt;@Rohit: We could probably adjust the layering of these two methods slightly, but I doubt that it would accomplish much in terms of improving performance, mainly because this operation is done once per connection, and we expect clients to spend most of their time doing something else. If &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2937&quot; title=&quot;TestHiveServerSessions hangs when executed directly&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2937&quot;&gt;&lt;del&gt;HIVE-2937&lt;/del&gt;&lt;/a&gt; fixes the concurrency issue then I think we should probably mark this ticket as a duplicate of 2937 and backport 2937 to 0.9.&lt;/p&gt;</comment>
                            <comment id="13461604" author="rohithsharma" created="Mon, 24 Sep 2012 05:16:51 +0000"  >&lt;p&gt;Applying patch of &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2937&quot; title=&quot;TestHiveServerSessions hangs when executed directly&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2937&quot;&gt;&lt;del&gt;HIVE-2937&lt;/del&gt;&lt;/a&gt; has fixed all 3 issue as per description. This we can mark as duplicate of 2937.&lt;/p&gt;</comment>
                            <comment id="13461618" author="cwsteinbach" created="Mon, 24 Sep 2012 06:24:41 +0000"  >&lt;p&gt;@Rohit: Thanks for verifying that this is duplicate.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="12550278">HIVE-2937</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 17 Sep 2012 18:44:17 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>259260</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 10 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0lnu7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>124512</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>