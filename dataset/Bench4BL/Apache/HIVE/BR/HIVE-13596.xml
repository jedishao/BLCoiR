<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 02 05:43:28 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HIVE-13596/HIVE-13596.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HIVE-13596] HS2 should be able to get UDFs on demand from metastore</title>
                <link>https://issues.apache.org/jira/browse/HIVE-13596</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;When multiple HS2s are run, creating a permanent fn is only executed on one of them, and the other HS2s don&apos;t get the new function. Unlike say with tables, where we always get stuff from db on demand, fns are registered at certain points in the code and if the new one is not registered, it will not be available. &lt;br/&gt;
We should restore the pre-&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-2573&quot; title=&quot;Create per-session function registry &quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-2573&quot;&gt;&lt;del&gt;HIVE-2573&lt;/del&gt;&lt;/a&gt; behavior of being able to refresh the UDFs on demand.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12961977">HIVE-13596</key>
            <summary>HS2 should be able to get UDFs on demand from metastore</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="sershe">Sergey Shelukhin</assignee>
                                    <reporter username="sershe">Sergey Shelukhin</reporter>
                        <labels>
                    </labels>
                <created>Sat, 23 Apr 2016 00:22:12 +0000</created>
                <updated>Mon, 21 Nov 2016 22:46:31 +0000</updated>
                            <resolved>Fri, 29 Apr 2016 18:09:05 +0000</resolved>
                                                    <fixVersion>2.1.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                <comments>
                            <comment id="15258649" author="sershe" created="Tue, 26 Apr 2016 18:29:52 +0000"  >&lt;p&gt;This restores some of the functionality, with a config flag, and accounting for other registry changes. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jdere&quot; class=&quot;user-hover&quot; rel=&quot;jdere&quot;&gt;Jason Dere&lt;/a&gt; can you take a look?&lt;/p&gt;</comment>
                            <comment id="15258709" author="jdere" created="Tue, 26 Apr 2016 19:03:12 +0000"  >&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Should this be a settable option (as opposed to always on)? And why default to false?&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Which Registry is performing the UDF lookup, the system registry or the session registry? If it is the system registry, then we may run into &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-6672&quot; title=&quot;JARs loaded by permanent functions don&amp;#39;t work properly with HiveServer2&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-6672&quot;&gt;&lt;del&gt;HIVE-6672&lt;/del&gt;&lt;/a&gt; again. checkFunctionClass() (removed in your patch) was added for this purpose.&lt;br/&gt;
If the functions are being looked up/added to the session registry, then this may not be an issue because every session would need to lookup UDF/load JARs. Actually I see that the permanent UDFs by Hive.reloadFunctions() (at initialize time) are added to the system registry .. I suspect Hive probably has class loading issues if we ever use &quot;RELOAD FUNCTIONS&quot; to pick up new UDFs, since Hive no longer seems to be calling checkFunctionClass().&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;public Registry(boolean isNative, HiveConf conf):&lt;/li&gt;
	&lt;li&gt;conf needs a null check before it&apos;s used&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;private FunctionInfo getQualifiedFunctionInfo():&lt;/li&gt;
	&lt;li&gt;Wrap if/then with braces&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;private boolean refreshFunctionInfoFromMetastore(String functionName)&lt;/li&gt;
	&lt;li&gt;line 629: wrap if/then with braces&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15258724" author="sershe" created="Tue, 26 Apr 2016 19:11:57 +0000"  >&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;    Should this be a settable option (as opposed to always on)? And why default to false?
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;It&apos;s settable per session. Defaulting to false because that was the current behavior for a while.&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;    Which Registry is performing the UDF lookup, the system registry or the session registry? If it is the system registry, then we may run into HIVE-6672 again. checkFunctionClass() (removed in your patch) was added for this purpose.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Session registry. I removed the method because it was unused... &lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;    If the functions are being looked up/added to the session registry, then this may not be an issue because every session would need to lookup UDF/load JARs. Actually I see that the permanent UDFs by Hive.reloadFunctions() (at initialize time) are added to the system registry .. I suspect Hive probably has class loading issues if we ever use &quot;RELOAD FUNCTIONS&quot; to pick up new UDFs, since Hive no longer seems to be calling checkFunctionClass().
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Hmm... should this be done in the system registry then? Does it hurt to have them in the session registry? &lt;br/&gt;
Also, does checkFunctionClass need to be reinstated here or in a separate JIRA.&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;    public Registry(boolean isNative, HiveConf conf):
    conf needs a null check before it&apos;s used
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Implied that it&apos;s not used for a native registry; I will add an explicit check.&lt;/p&gt;</comment>
                            <comment id="15258888" author="jdere" created="Tue, 26 Apr 2016 20:44:59 +0000"  >&lt;p&gt;Ok, looking at the code again, I see why checkFunctionClass() is no longer called - there is a separate registerToSessionRegistry() method to add a UDF from the system registry to the session registry. It&apos;s not bad to have it in the session registry, since the UDF does eventually need to get added there, though it is a bit different from the UDFs added via reloadFunctions() since those are added to the system registry.&lt;/p&gt;</comment>
                            <comment id="15259135" author="sershe" created="Tue, 26 Apr 2016 23:05:37 +0000"  >&lt;p&gt;Updated the patch to add it to the system registry instead, after some discussion. I changed the synchronized methods to use a lock object without any logic changes wrt locking, and then took the MS call (and resource acquisition) out of the lock to avoid bottlenecking on the system registry.&lt;/p&gt;</comment>
                            <comment id="15259139" author="sershe" created="Tue, 26 Apr 2016 23:07:07 +0000"  >&lt;p&gt;RB at &lt;a href=&quot;https://reviews.apache.org/r/46715/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/46715/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15261303" author="jdere" created="Thu, 28 Apr 2016 00:36:27 +0000"  >&lt;p&gt;ok, i think this looks good. +1 if tests look good.&lt;/p&gt;</comment>
                            <comment id="15263429" author="hiveqa" created="Fri, 29 Apr 2016 02:30:59 +0000"  >

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12801156/HIVE-13596.03.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12801156/HIVE-13596.03.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to no test(s) being added or modified.&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 42 failed/errored test(s), 9961 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;TestHWISessionManager - did not produce a TEST-*.xml file
TestMiniTezCliDriver-vector_non_string_partition.q-delete_where_non_partitioned.q-auto_sortmerge_join_16.q-and-12-more - did not produce a TEST-*.xml file
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_nomore_ambiguous_table_col
org.apache.hadoop.hive.cli.TestCliDriver.testCliDriver_regexp_extract
org.apache.hadoop.hive.cli.TestMiniSparkOnYarnCliDriver.testCliDriver_index_bitmap3
org.apache.hadoop.hive.cli.TestNegativeCliDriver.testNegativeCliDriver_clustern3
org.apache.hadoop.hive.cli.TestNegativeCliDriver.testNegativeCliDriver_clustern4
org.apache.hadoop.hive.cli.TestNegativeCliDriver.testNegativeCliDriver_nonkey_groupby
org.apache.hadoop.hive.cli.TestNegativeCliDriver.testNegativeCliDriver_selectDistinctStarNeg_2
org.apache.hadoop.hive.cli.TestNegativeCliDriver.testNegativeCliDriver_subquery_shared_alias
org.apache.hadoop.hive.cli.TestNegativeCliDriver.testNegativeCliDriver_udtf_not_supported1
org.apache.hadoop.hive.cli.TestNegativeMinimrCliDriver.testNegativeCliDriver_minimr_broken_pipe
org.apache.hadoop.hive.llap.tezplugins.TestLlapTaskCommunicator.testFinishableStateUpdateFailure
org.apache.hadoop.hive.metastore.TestAuthzApiEmbedAuthorizerInRemote.org.apache.hadoop.hive.metastore.TestAuthzApiEmbedAuthorizerInRemote
org.apache.hadoop.hive.metastore.TestFilterHooks.org.apache.hadoop.hive.metastore.TestFilterHooks
org.apache.hadoop.hive.metastore.TestMetaStoreEndFunctionListener.testEndFunctionListener
org.apache.hadoop.hive.metastore.TestMetaStoreEventListenerOnlyOnCommit.testEventStatus
org.apache.hadoop.hive.metastore.TestMetaStoreInitListener.testMetaStoreInitListener
org.apache.hadoop.hive.metastore.TestMetaStoreMetrics.org.apache.hadoop.hive.metastore.TestMetaStoreMetrics
org.apache.hadoop.hive.metastore.TestPartitionNameWhitelistValidation.testAppendPartitionWithCommas
org.apache.hadoop.hive.metastore.TestPartitionNameWhitelistValidation.testAppendPartitionWithUnicode
org.apache.hadoop.hive.metastore.TestPartitionNameWhitelistValidation.testAppendPartitionWithValidCharacters
org.apache.hadoop.hive.metastore.TestRetryingHMSHandler.testRetryingHMSHandler
org.apache.hadoop.hive.ql.security.TestClientSideAuthorizationProvider.testSimplePrivileges
org.apache.hadoop.hive.ql.security.TestFolderPermissions.org.apache.hadoop.hive.ql.security.TestFolderPermissions
org.apache.hadoop.hive.ql.security.TestMetastoreAuthorizationProvider.testSimplePrivileges
org.apache.hadoop.hive.ql.security.TestMultiAuthorizationPreEventListener.org.apache.hadoop.hive.ql.security.TestMultiAuthorizationPreEventListener
org.apache.hadoop.hive.ql.security.TestStorageBasedClientSideAuthorizationProvider.testSimplePrivileges
org.apache.hadoop.hive.ql.security.TestStorageBasedMetastoreAuthorizationDrops.testDropPartition
org.apache.hadoop.hive.ql.security.TestStorageBasedMetastoreAuthorizationProvider.testSimplePrivileges
org.apache.hadoop.hive.ql.security.TestStorageBasedMetastoreAuthorizationProviderWithACL.testSimplePrivileges
org.apache.hadoop.hive.ql.security.TestStorageBasedMetastoreAuthorizationReads.testReadDbFailure
org.apache.hadoop.hive.ql.security.TestStorageBasedMetastoreAuthorizationReads.testReadDbSuccess
org.apache.hadoop.hive.ql.security.TestStorageBasedMetastoreAuthorizationReads.testReadTableFailure
org.apache.hadoop.hive.ql.security.TestStorageBasedMetastoreAuthorizationReads.testReadTableSuccess
org.apache.hadoop.hive.ql.security.TestStorageBasedMetastoreAuthorizationReads.testReadTableSuccessWithReadOnly
org.apache.hadoop.hive.thrift.TestHadoopAuthBridge23.testDelegationTokenSharedStore
org.apache.hadoop.hive.thrift.TestHadoopAuthBridge23.testMetastoreProxyUser
org.apache.hadoop.hive.thrift.TestHadoopAuthBridge23.testSaslWithHiveMetaStore
org.apache.hive.jdbc.TestSSL.testSSLFetchHttp
org.apache.hive.minikdc.TestJdbcWithDBTokenStore.org.apache.hive.minikdc.TestJdbcWithDBTokenStore
org.apache.hive.service.TestHS2ImpersonationWithRemoteMS.org.apache.hive.service.TestHS2ImpersonationWithRemoteMS
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://ec2-54-177-240-2.us-west-1.compute.amazonaws.com/job/PreCommit-HIVE-MASTER-Build/111/testReport&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://ec2-54-177-240-2.us-west-1.compute.amazonaws.com/job/PreCommit-HIVE-MASTER-Build/111/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://ec2-54-177-240-2.us-west-1.compute.amazonaws.com/job/PreCommit-HIVE-MASTER-Build/111/console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://ec2-54-177-240-2.us-west-1.compute.amazonaws.com/job/PreCommit-HIVE-MASTER-Build/111/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://ec2-50-18-27-0.us-west-1.compute.amazonaws.com/logs/PreCommit-HIVE-MASTER-Build-111/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://ec2-50-18-27-0.us-west-1.compute.amazonaws.com/logs/PreCommit-HIVE-MASTER-Build-111/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 42 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12801156 - PreCommit-HIVE-MASTER-Build&lt;/p&gt;</comment>
                            <comment id="15264438" author="sershe" created="Fri, 29 Apr 2016 17:57:12 +0000"  >&lt;p&gt;Test failures are the same as in other recent JIRAs... metastore problems on the server, or broken by other jiras&lt;/p&gt;</comment>
                            <comment id="15264462" author="sershe" created="Fri, 29 Apr 2016 18:09:05 +0000"  >&lt;p&gt;Committed to master - thanks for the review!&lt;/p&gt;</comment>
                            <comment id="15265227" author="lefty@hortonworks.com" created="Sat, 30 Apr 2016 07:46:34 +0000"  >&lt;p&gt;Doc note:  This adds &lt;b&gt;hive.allow.udf.load.on.demand&lt;/b&gt; to HiveConf.java so it will need to be documented in the wiki for release 2.1.0.&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;&lt;a href=&quot;https://cwiki.apache.org/confluence/display/Hive/Configuration+Properties#ConfigurationProperties-QueryandDDLExecution&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;Configuration Properties &amp;#8211; Query and DDL Execution &lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;TODOC2.1 label added to this issue.&lt;/p&gt;</comment>
                            <comment id="15279362" author="asears" created="Wed, 11 May 2016 01:42:02 +0000"  >&lt;p&gt;Doc&apos;d!&lt;/p&gt;</comment>
                            <comment id="15279417" author="sershe" created="Wed, 11 May 2016 02:57:38 +0000"  >&lt;p&gt;Thanks!&lt;/p&gt;</comment>
                            <comment id="15279674" author="lefty@hortonworks.com" created="Wed, 11 May 2016 06:51:23 +0000"  >&lt;p&gt;Removed the TODOC2.1 label.  Thanks, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=asears&quot; class=&quot;user-hover&quot; rel=&quot;asears&quot;&gt;Andrew Sears&lt;/a&gt;.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12938557">HIVE-13043</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="12310050">
                    <name>Regression</name>
                                                                <inwardlinks description="is broken by">
                                        <issuelink>
            <issuekey id="12531100">HIVE-2573</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12800854" name="HIVE-13596.01.patch" size="7824" author="sershe" created="Tue, 26 Apr 2016 19:12:20 +0000"/>
                            <attachment id="12800905" name="HIVE-13596.02.patch" size="20969" author="sershe" created="Tue, 26 Apr 2016 23:05:37 +0000"/>
                            <attachment id="12801156" name="HIVE-13596.03.patch" size="19921" author="sershe" created="Thu, 28 Apr 2016 00:20:37 +0000"/>
                            <attachment id="12800843" name="HIVE-13596.patch" size="7771" author="sershe" created="Tue, 26 Apr 2016 18:29:52 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 26 Apr 2016 19:03:12 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            29 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2wn87:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>