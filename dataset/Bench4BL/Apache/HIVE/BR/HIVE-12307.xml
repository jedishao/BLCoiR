<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 02 06:10:04 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HIVE-12307/HIVE-12307.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HIVE-12307] Streaming API TransactionBatch.close() must abort any remaining transactions in the batch</title>
                <link>https://issues.apache.org/jira/browse/HIVE-12307</link>
                <project id="12310843" key="HIVE">Hive</project>
                    <description>&lt;p&gt;When the client of TransactionBatch API encounters an error it must close() the batch and start a new one.  This prevents attempts to continue writing to a file that may damaged in some way.&lt;/p&gt;

&lt;p&gt;The close() should ensure to abort the any txns that still remain in the batch and close (best effort) all the files it&apos;s writing to.  The batch should also put itself into a mode where any future ops on this batch fail.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12909306">HIVE-12307</key>
            <summary>Streaming API TransactionBatch.close() must abort any remaining transactions in the batch</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ekoifman">Eugene Koifman</assignee>
                                    <reporter username="ekoifman">Eugene Koifman</reporter>
                        <labels>
                    </labels>
                <created>Fri, 30 Oct 2015 19:51:24 +0000</created>
                <updated>Tue, 16 Feb 2016 23:52:27 +0000</updated>
                            <resolved>Thu, 26 Nov 2015 20:39:43 +0000</resolved>
                                    <version>0.14.0</version>
                                    <fixVersion>1.3.0</fixVersion>
                    <fixVersion>2.0.0</fixVersion>
                                    <component>HCatalog</component>
                    <component>Transactions</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="15024902" author="ekoifman" created="Tue, 24 Nov 2015 17:26:41 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=alangates&quot; class=&quot;user-hover&quot; rel=&quot;alangates&quot;&gt;Alan Gates&lt;/a&gt; could you review please&lt;/p&gt;</comment>
                            <comment id="15025157" author="alangates" created="Tue, 24 Nov 2015 19:27:52 +0000"  >&lt;p&gt;HiveEndPoint.TransactionBatchImpl:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;I&apos;m +1 on making this package level, but does it do any good to make the class non-private and leave the constructor private?&lt;/li&gt;
	&lt;li&gt;Why did you make the isClosed value volatile?  Are you assuming users will use this in a multi-threaded way?  I think this class is thread safe in as much as users can have per-thread instances, but I don&apos;t think the class is re-entrant itself.  I see in other comments you&apos;re expecting heartbeating to be done in a separate thread.  Is that the only case you think this will be used?  If so, it seems we should comment this well so people know what is and isn&apos;t safe to do multi-threaded.&lt;/li&gt;
	&lt;li&gt;write()
	&lt;ul&gt;
		&lt;li&gt;I don&apos;t understand why when the code gets a SerializationError it should still declare success and re-throw.  I see re-throwing so the user can see the error, but don&apos;t we still need to mark the batch a failure and abort?  How can the caller recover here?&lt;/li&gt;
		&lt;li&gt;Since the logic here is getting more complex I would suggest that we refactor write(byte) to be simply: write(Collections.singleList(byte)).  This way we only have the logic in one place.&lt;/li&gt;
		&lt;li&gt;A thought on the produceFault() calls.  Would it be better to create a special RecordWriter implementation that wraps other RecordWriters and throws when you want it to?  That way you don&apos;t have to pollute this code with produceFault() calls and you can eventually test errors at more locations.&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
	&lt;li&gt;abortImpl()
	&lt;ul&gt;
		&lt;li&gt;We should look at adding a call to rollback a group of transactions, so that large aborted batches don&apos;t cause a storm of metastore calls.  That obviously doesn&apos;t need to be part of this patch.&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;

</comment>
                            <comment id="15025266" author="ekoifman" created="Tue, 24 Nov 2015 20:14:49 +0000"  >&lt;blockquote&gt;&lt;p&gt;I&apos;m +1 on making this package level, but does it do any good to make the class non-private and leave the constructor private?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;The class is made package level for testing only.  Private c&apos;tor ensures that it&apos;s only constructed via factory methods as originally implemented.&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;Why did you make the isClosed value volatile? &lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;heartbeating is commonly done from separate thread, for example, Storm does it this way.  Also, it&apos;s not unusual for  application clean up logic to come from a different thread (for example calling close() as a form of cancel).  So this is volatile to make sure this works properly regardless of how the client is implemented.&lt;br/&gt;
I didn&apos;t try any more general thread safety issues in this patch.  Judging by &lt;a href=&quot;https://cwiki.apache.org/confluence/display/Hive/Streaming+Data+Ingest#StreamingDataIngest-Example&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://cwiki.apache.org/confluence/display/Hive/Streaming+Data+Ingest#StreamingDataIngest-Example&lt;/a&gt;&#8211;Non-secureMode the original intent was to NOT to have multiple threads in a StreamingConnection.  It&apos;s worthwhile to do a thread safety review but was not my goal here.  &lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;write()&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I&apos;ll refactor this&lt;/p&gt;



&lt;blockquote&gt;&lt;p&gt;SerializationError&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;This is was meant to indicate that a particular row is bad.  For example missing columns, etc.  This gives the client ability to drop this row (or send to dead letter queue) since replaying it won&apos;t help.  Unfortunately, w/o my changes here the client never sees SerializationError - it gets wrapped in other exceptions.&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;abortImpl()&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;there is &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-12440&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HIVE-12440&lt;/a&gt; for that&lt;/p&gt;</comment>
                            <comment id="15025731" author="ekoifman" created="Tue, 24 Nov 2015 23:47:39 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=alangates&quot; class=&quot;user-hover&quot; rel=&quot;alangates&quot;&gt;Alan Gates&lt;/a&gt;, I uploaded a new patch with refactored write() and using your wrapper/delegator idea, which makes things look much cleaner.&lt;/p&gt;</comment>
                            <comment id="15027381" author="alangates" created="Wed, 25 Nov 2015 19:06:09 +0000"  >&lt;p&gt;+1&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;It&apos;s worthwhile to do a thread safety review but was not my goal here.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Agreed, I&apos;m not trying to add a thread safety review to this patch.&lt;/p&gt;

&lt;p&gt;I&apos;ve created &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-12521&quot; title=&quot;Better javadoc for Hive streaming&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-12521&quot;&gt;HIVE-12521&lt;/a&gt; to start tracking javadoc issues in Hive streaming.  I&apos;ve put in there that we should document the assumptions about thread safety and the meaning of SerializationError.  If there are other issues you are aware of in here that need documenting feel free to add to that JIRA.  I&apos;ve assigned it to myself so I don&apos;t forget about it but feel free to take it on if you want.&lt;/p&gt;


</comment>
                            <comment id="15028414" author="hiveqa" created="Thu, 26 Nov 2015 09:24:31 +0000"  >

&lt;p&gt;Here are the results of testing the latest attachment:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12774201/HIVE-12307.2.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12774201/HIVE-12307.2.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;SUCCESS:&lt;/font&gt; +1 due to 1 test(s) being added or modified.&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; -1 due to 3 failed/errored test(s), 9865 tests executed&lt;br/&gt;
&lt;b&gt;Failed tests:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;TestHWISessionManager - did not produce a TEST-*.xml file
org.apache.hadoop.hive.cli.TestNegativeCliDriver.testNegativeCliDriver_authorization_uri_import
org.apache.hive.jdbc.TestSSL.testSSLVersion
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/6131/testReport&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/6131/testReport&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/6131/console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/jenkins/job/PreCommit-HIVE-TRUNK-Build/6131/console&lt;/a&gt;&lt;br/&gt;
Test logs: &lt;a href=&quot;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-6131/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://ec2-174-129-184-35.compute-1.amazonaws.com/logs/PreCommit-HIVE-TRUNK-Build-6131/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Executing org.apache.hive.ptest.execution.TestCheckPhase
Executing org.apache.hive.ptest.execution.PrepPhase
Executing org.apache.hive.ptest.execution.ExecutionPhase
Executing org.apache.hive.ptest.execution.ReportingPhase
Tests exited with: TestsFailedException: 3 tests failed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;

&lt;p&gt;ATTACHMENT ID: 12774201 - PreCommit-HIVE-TRUNK-Build&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                            <outwardlinks description="blocks">
                                        <issuelink>
            <issuekey id="12913843">HIVE-12440</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12774201" name="HIVE-12307.2.patch" size="28458" author="ekoifman" created="Tue, 24 Nov 2015 23:47:39 +0000"/>
                            <attachment id="12773978" name="HIVE-12307.patch" size="28233" author="ekoifman" created="Tue, 24 Nov 2015 03:52:49 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 24 Nov 2015 19:27:52 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 1 week ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2nrd3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>