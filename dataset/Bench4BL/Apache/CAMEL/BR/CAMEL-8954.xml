<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sat Dec 03 01:38:16 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/CAMEL-8954/CAMEL-8954.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[CAMEL-8954] Lock information is not handovered together with Exchange on-completion synchronizations</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-8954</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;This applies to the file components when using common read-lock strategies:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;&lt;b&gt;markerFile&lt;/b&gt; - org.apache.camel.component.file.strategy.MarkerFileExclusiveReadLockStrategy&lt;/li&gt;
	&lt;li&gt;&lt;b&gt;fileLock&lt;/b&gt; - org.apache.camel.component.file.strategy.FileLockExclusiveReadLockStrategy&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;This strategies stores lock information in the Exchange properties:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;&lt;b&gt;Exchange.FILE_LOCK_FILE_ACQUIRED&lt;/b&gt; == &quot;CamelFileLockFileAcquired&quot;&lt;/li&gt;
	&lt;li&gt;&lt;b&gt;Exchange.FILE_LOCK_FILE_NAME&lt;/b&gt; == &quot;CamelFileLockFileName&quot;&lt;/li&gt;
	&lt;li&gt;&lt;b&gt;Exchange.FILE_LOCK_EXCLUSIVE_LOCK&lt;/b&gt; == &quot;CamelFileLockExclusiveLock&quot;&lt;/li&gt;
	&lt;li&gt;&lt;b&gt;Exchange.FILE_LOCK_RANDOM_ACCESS_FILE&lt;/b&gt; == &quot;CamelFileLockRandomAccessFile&quot;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Lock information is stored as scalar values and can hold information about &lt;em&gt;only one single lock&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;When there are two Exchanges participates in the route, share UoW, and synchronizations are handovered from one Exchange to another, information about both locks can&apos;t be stored in the Exchange properties and lost. Consequently when on-completion synchronizations are performed, read-lock strategies can&apos;t access information about all the locks and they are not released.&lt;/p&gt;

&lt;p&gt;For example, after completing this route lock for file1.dat is not released:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
from(&lt;span class=&quot;code-quote&quot;&gt;&quot;file:data/input-a?fileName=file1.dat&amp;amp;readLock=markerFile&quot;&lt;/span&gt;)
    .pollEnrich(&lt;span class=&quot;code-quote&quot;&gt;&quot;file:data/input-b?fileName=file2.dat&amp;amp;readLock=markerFile&quot;&lt;/span&gt;)
    .to(&lt;span class=&quot;code-quote&quot;&gt;&quot;mock:result&quot;&lt;/span&gt;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12844423">CAMEL-8954</key>
            <summary>Lock information is not handovered together with Exchange on-completion synchronizations</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="davsclaus">Claus Ibsen</assignee>
                                    <reporter username="andy.fedotov">Andy Fedotov</reporter>
                        <labels>
                    </labels>
                <created>Sun, 12 Jul 2015 11:01:35 +0000</created>
                <updated>Thu, 16 Jul 2015 19:49:32 +0000</updated>
                            <resolved>Thu, 16 Jul 2015 19:49:32 +0000</resolved>
                                    <version>2.14.3</version>
                                    <fixVersion>2.15.3</fixVersion>
                    <fixVersion>2.16.0</fixVersion>
                                    <component>camel-core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="14623752" author="andy.fedotov" created="Sun, 12 Jul 2015 11:03:20 +0000"  >&lt;p&gt;Added unit test - &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12744926/12744926_MarkerFileExclusiveReadLockStrategyUnlockTest.java&quot; title=&quot;MarkerFileExclusiveReadLockStrategyUnlockTest.java attached to CAMEL-8954&quot;&gt;MarkerFileExclusiveReadLockStrategyUnlockTest.java&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;&lt;/p&gt;</comment>
                            <comment id="14623820" author="davsclaus" created="Sun, 12 Jul 2015 14:06:04 +0000"  >&lt;p&gt;This is not really intended to do such use-case. &lt;/p&gt;</comment>
                            <comment id="14623906" author="andy.fedotov" created="Sun, 12 Jul 2015 17:16:03 +0000"  >&lt;p&gt;Currently in our project we actively use file/sftp components and similar use-cases with poll-enrich pattern. There are no any problem with locking because it is not needed at all, we are using &lt;b&gt;readLock=none&lt;/b&gt;.&lt;/p&gt;

&lt;p&gt;Maybe this has no really serious impact and has no actual use-cases, but such locking strategy design seems slightly wrong. When I tried to implement my own custom processor bean to handle poll-enrich, I also tried to figure out how to &lt;ins&gt;correctly&lt;/ins&gt; deal with Exchange UoW and synchronizations, and stumbled on this problem. I thought that I was doing something wrong, because lock files are not gone after route completion.&lt;/p&gt;

&lt;p&gt;Just in case, I also stuck on that MarkerFileExclusiveReadLockStrategy is intended as kind of cross-route/JVM lock sharing. But MarkerFileExclusiveReadLockStrategy.prepareOnStartup() is blindly deletes all created *.camelLock files on every Consumer creation and startup.&lt;/p&gt;</comment>
                            <comment id="14623922" author="davsclaus" created="Sun, 12 Jul 2015 17:55:50 +0000"  >&lt;p&gt;Now its not, see the documentation about readLock and the warning section: &lt;a href=&quot;http://camel.apache.org/file2&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://camel.apache.org/file2&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14626461" author="davsclaus" created="Tue, 14 Jul 2015 15:16:01 +0000"  >&lt;p&gt;I though we had an option to turn of deleting orphan lock files, but didn&apos;t so I logged a ticket:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-8970&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/CAMEL-8970&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14630049" author="davsclaus" created="Thu, 16 Jul 2015 17:33:51 +0000"  >&lt;p&gt;Yeah the state should really be per file, so when you poll in that 2nd file, it wont override state from the 1st file. Thanks for the suggestion and the unit test.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12744926" name="MarkerFileExclusiveReadLockStrategyUnlockTest.java" size="2205" author="andy.fedotov" created="Sun, 12 Jul 2015 11:03:20 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sun, 12 Jul 2015 14:06:04 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 20 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2h59z:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>