<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sat Dec 03 03:20:16 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/CAMEL-9202/CAMEL-9202.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[CAMEL-9202] Flatpack: Body reader never closed </title>
                <link>https://issues.apache.org/jira/browse/CAMEL-9202</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;Hello Camel team,&lt;/p&gt;

&lt;p&gt;First of all I want to thank you for all great work you do to provide such a powerful tool as Camel. I really enjoy using it in my work. &lt;/p&gt;

&lt;p&gt;Currently I am working on an application that requires delimited and fixed width parsing tools and I decided to use Camel Flatpack because we already use some other Camel stuff. We use Camel 2.14.3 which is not the latest one but forks fine. During my work with Flatpack consumer I found several issues and some room for improvements and I decided to share my thoughts/findings with you. Our team have plans to migrate to the latest version of Camel in near future and we all will be happy if the new version includes fixes/improvements that I am goint to suggest.&lt;/p&gt;

&lt;p&gt;The main issue that I found is that flatpack endpoint does not close body reader if an exception is thrown during parser creation step. As a result the related resource remains opened forever. For example in my cases when PZMAP files was missing my data file (csv file) was locked and my file consumer ended in endless loop in which it was trying to move a file to .error folder but was not able to do this because the file was opened for read.&lt;/p&gt;

&lt;p&gt;Another problem that I noticed is that I cannot use allowShortLines and ignoreExtraColumns attributes if my parser uses inline headers from files. Flatpack simply ignores them in this case.&lt;/p&gt;

&lt;p&gt;Finally I think that there is some  room for improvements:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;It would be nice to have a possibility to provide PZMAP as a bean via JNDI context instead of having to generate a file. This feature will be very useful and content parsing should work faster because the XML will be read from memory instead of reading it from a file each time you parse some content;&lt;/li&gt;
	&lt;li&gt;It would be nice to have a possibility to provide content format as an URI attribute instead of using these ugly URI prefixes that we should use right now. With such possibility in plase URI will look the same all the time and developers won&apos;t need to reformat URI differently for different content types.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I attached a patch file with code fragments and comments to them that illustrate my findings/thoughts. Unformtunatelly I don&apos;t have enough time to provide real fixes and unit tests so please excuse me for this. &lt;/p&gt;

&lt;p&gt;Please let me know if something is unclear or require more details.&lt;/p&gt;

&lt;p&gt;Looking forward for your feedback,&lt;br/&gt;
Mykhailo&lt;/p&gt;</description>
                <environment></environment>
        <key id="12903398">CAMEL-9202</key>
            <summary>Flatpack: Body reader never closed </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="davsclaus">Claus Ibsen</assignee>
                                    <reporter username="mvlakh">MykhailoVlakh</reporter>
                        <labels>
                    </labels>
                <created>Thu, 8 Oct 2015 15:38:16 +0000</created>
                <updated>Thu, 26 Nov 2015 12:21:48 +0000</updated>
                            <resolved>Sun, 22 Nov 2015 13:45:38 +0000</resolved>
                                    <version>2.14.3</version>
                                    <fixVersion>2.15.5</fixVersion>
                    <fixVersion>2.16.2</fixVersion>
                    <fixVersion>2.17.0</fixVersion>
                                    <component>camel-flatpack</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="14948864" author="mvlakh" created="Thu, 8 Oct 2015 15:40:11 +0000"  >&lt;p&gt;Please note that the provided code changes are just for illustration of the found issues and you should not expect to compile and run this code.&lt;/p&gt;</comment>
                            <comment id="15020995" author="davsclaus" created="Sun, 22 Nov 2015 13:33:21 +0000"  >&lt;p&gt;Please only provide a patch for closing the reader. Please do not add in other functionality in the same patch. &lt;/p&gt;</comment>
                            <comment id="15021004" author="davsclaus" created="Sun, 22 Nov 2015 13:45:38 +0000"  >&lt;p&gt;The reader is now closed. Thanks for that part of the patch.&lt;/p&gt;

&lt;p&gt;I logged another ticket to allow reading the resource from the registry, then you can just refer to that using the existing option, and no need to introduce a new option for that.&lt;/p&gt;</comment>
                            <comment id="15021872" author="mvlakh" created="Mon, 23 Nov 2015 10:00:56 +0000"  >&lt;p&gt;Thank you for the fix. Good to hear that the possibility to read PZMAP from registry will be added. &lt;/p&gt;

&lt;p&gt;The only question which is left unanswered is - Will you fix the issue with isAllowShortLines and isIgnoreExtraColumns attributes that are taken into account only if user provides PZMAP resource? My patch includes a fix for this problem as well so could you please take a look at let me know what do you think? Thank you.&lt;/p&gt;</comment>
                            <comment id="15021873" author="davsclaus" created="Mon, 23 Nov 2015 10:05:19 +0000"  >&lt;p&gt;Can you provide a new patch based on latest code for master to fix that other issue you mention?&lt;/p&gt;</comment>
                            <comment id="15028574" author="mvlakh" created="Thu, 26 Nov 2015 11:20:07 +0000"  >&lt;p&gt;Added a new patch with a fix for the issue in the delimited content parser creation code which does not allow to use isAllowShortLines and isIgnoreExtraColumns if PZMAP is not used.&lt;/p&gt;</comment>
                            <comment id="15028577" author="mvlakh" created="Thu, 26 Nov 2015 11:21:50 +0000"  >&lt;p&gt;Sorry for a delay. Attached a new diff file with the necessary changes.&lt;/p&gt;</comment>
                            <comment id="15028661" author="davsclaus" created="Thu, 26 Nov 2015 12:21:48 +0000"  >&lt;p&gt;Thanks for the 2nd patch.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12915157">CAMEL-9349</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12765619" name="patchfile.diff" size="11321" author="mvlakh" created="Thu, 8 Oct 2015 15:38:58 +0000"/>
                            <attachment id="12774509" name="patchfile2.diff" size="3075" author="mvlakh" created="Thu, 26 Nov 2015 11:20:07 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sun, 22 Nov 2015 13:33:21 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10061"><![CDATA[Novice]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 1 week, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2mrbr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>