<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sat Dec 03 02:31:31 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/CAMEL-3438/CAMEL-3438.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[CAMEL-3438] JAXBDataFormatter should using Spring ApplicationContext&apos;s classLoader explicitly</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-3438</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;JAXBDataFormatter now using JAXBContext.newInstance(path) to create JAXBContext,&lt;br/&gt;
but this will using Thread&apos;s context classLoader.&lt;br/&gt;
this may causing un-expected class or resource not found exceptions;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12493539">CAMEL-3438</key>
            <summary>JAXBDataFormatter should using Spring ApplicationContext&apos;s classLoader explicitly</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="hadrian">Hadrian Zbarcea</assignee>
                                    <reporter username="ext2xhb">ext2</reporter>
                        <labels>
                    </labels>
                <created>Fri, 17 Dec 2010 17:35:25 +0000</created>
                <updated>Tue, 25 Oct 2011 11:35:18 +0000</updated>
                            <resolved>Sat, 5 Feb 2011 03:50:36 +0000</resolved>
                                    <version>2.4.0</version>
                                    <fixVersion>2.7.0</fixVersion>
                                    <component>camel-jaxb</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="12972556" author="ext2xhb" created="Fri, 17 Dec 2010 17:37:24 +0000"  >&lt;p&gt;This is a patch for JAXBDataFormatter to explicitly using Spring Application context&apos;s class loader;&lt;/p&gt;

&lt;p&gt;major changes exists in the JAXBDataFormatter .getContext() method&lt;/p&gt;</comment>
                            <comment id="12972561" author="davsclaus" created="Fri, 17 Dec 2010 17:59:41 +0000"  >&lt;p&gt;Sorry but we cannot accept the patch as it&apos;s tied to Spring. Its important the camel-core is independent on any other framework.&lt;br/&gt;
Also classloading should work with OSGi, J2EE app servers and whatnot, so its not trivial to do.&lt;/p&gt;

&lt;p&gt;That said CamelContext has a classResolver which is runtime agnostic. So I suggest to use that.&lt;/p&gt;</comment>
                            <comment id="12972591" author="ext2xhb" created="Fri, 17 Dec 2010 18:54:09 +0000"  >&lt;p&gt;Hi ,Clause&lt;/p&gt;

&lt;p&gt;I don&apos;t think so.  &lt;br/&gt;
I aggree the camel-jaxb component should not dependency to spring&lt;/p&gt;

&lt;p&gt;But I don&apos;t agree &quot;manageing context classLoader&quot; is a trivial things in osgi;&lt;/p&gt;

&lt;p&gt;J2EE will managed the context class loader carefully. &lt;br/&gt;
 But osgi doesn&apos;t. &lt;/p&gt;

&lt;p&gt; the osgi specification(expect osgi-enterprise) doesn&apos;t give any rules about thread&apos;s context class loader;&lt;br/&gt;
if you check spring-dm &apos;s reference, even spring-dm just give rules of context class loader for osgi-services configured by spring ; and doesn&apos;t give any rules for other situation;&lt;/p&gt;

&lt;p&gt; so the thread context  will act as  jdk default behavior, &quot;inherit parent thread&apos;s context class Loader&quot;, so that&apos;s to say:&lt;/p&gt;

&lt;p&gt;1)  thread context class loader is leaved as unmanaged in standard osgi environment; &lt;br/&gt;
2) it dependency the thread is how created;&lt;/p&gt;

&lt;p&gt;So camel should managed context class loader carefully, otherwise, it hardly to use in standard osgi . servicemix 4 is a standard osgi environment too;&lt;/p&gt;
</comment>
                            <comment id="12972739" author="ext2xhb" created="Sat, 18 Dec 2010 04:11:55 +0000"  >&lt;p&gt;Hi:&lt;/p&gt;

&lt;p&gt;Could the DataFormatter interface add a initialize method? it need&apos;s no arguments. just plain init () method;&lt;br/&gt;
if so, we could prepare the jaxb context at initializing time, but not at executing time(because at executing time to create jaxb context , will be unexpected)&lt;/p&gt;

&lt;p&gt;If camel doesn&apos;t accept , it&apos;s unfortunally.&lt;br/&gt;
 this means I cannot using jaxb databinding in osgi safely. etc: if I using a global OSGI ThreadPoolExecutor service to serve as the threadpool for camel components, then jaxb convert will failed; (because  threads of ThreadPoolExecutor is not always created in the correct bundles); &lt;/p&gt;

&lt;p&gt;if you check the mail-list in the community, you will find such bug is reported by the other user, not only mine; you can find it by the topic (&quot; Help with Camel JAXB (SMX4 + Camel 2.1.0)&quot;). the mail is sent very earlier; The original mail illustrate two route, one route start by file component, jaxb will work right; while another route started by &quot;direct&quot; endpoint, it will failed.&lt;br/&gt;
 I think the reason is file component&apos;s thread is created in the spring context loading time, so it inherit the spring extender thread&apos;s context class loader.  while the direct endpoint&apos;s belong to another user created thread, it&apos;s context class loader is not correct, so jaxb will failed;&lt;/p&gt;</comment>
                            <comment id="12972747" author="njiang" created="Sat, 18 Dec 2010 06:11:21 +0000"  >&lt;p&gt;@xuhongbo&lt;br/&gt;
You can get the Spring Application Context Classloader from the SpringCamelContext.&lt;br/&gt;
But I don&apos;t think you can get the CamelContext from the JAXBDataFormatter now.&lt;/p&gt;

&lt;p&gt;Maybe we can do some improvement in Camel3.0.&lt;/p&gt;</comment>
                            <comment id="12972757" author="davsclaus" created="Sat, 18 Dec 2010 09:31:59 +0000"  >&lt;p&gt;You ought to be able to implement &lt;tt&gt;Service&lt;/tt&gt; and &lt;tt&gt;CamelContextAware&lt;/tt&gt; on the data format to have the CamelContext injected and have start/stop methods invoked.&lt;br/&gt;
If possible then extend ServiceSupport which has doStart and doStop callbacks and is capable of storing the state whether its started or not.&lt;/p&gt;

&lt;p&gt;That ought to work for DataFormat as well, as it does work for Processor.&lt;/p&gt;

&lt;p&gt;Could you try that?&lt;/p&gt;
</comment>
                            <comment id="12972801" author="davsclaus" created="Sat, 18 Dec 2010 14:54:44 +0000"  >&lt;p&gt;I took a look and DataFormat didn&apos;t have the same level as Components in Camel. So I added support for Service and CamelContextAware callbacks on DataFormat as well.&lt;br/&gt;
This allows you much easier to do init logic in the start method. And you have access to CamelContext as well.&lt;/p&gt;

&lt;p&gt;I made a slight change to camel-jaxb to use the classloader of CamelContext with JAXB.&lt;br/&gt;
Maybe you can try this out. It may need some other tweaks to run with OSGi, but it ought to be the same as you&apos;s as we grab the classloader which created SpringCamelContext.&lt;/p&gt;

&lt;p&gt;trunk: 1050641.&lt;/p&gt;</comment>
                            <comment id="12972843" author="davsclaus" created="Sat, 18 Dec 2010 18:12:09 +0000"  >&lt;p&gt;I have modified JaxbDataFormat a bit more to let it leverage the ApplicationContext classloader if it was present.&lt;/p&gt;

&lt;p&gt;I also optimized and removed the need for synchronization to initialize various pieces as we can do this in start now.&lt;/p&gt;

&lt;p&gt;trunk: 1050688.&lt;/p&gt;</comment>
                            <comment id="12972844" author="davsclaus" created="Sat, 18 Dec 2010 18:12:58 +0000"  >&lt;p&gt;This nabble thread should take about some of the issues reported here&lt;br/&gt;
&lt;a href=&quot;http://camel.465427.n5.nabble.com/Help-with-Camel-JAXB-SMX4-Camel-2-1-0-tp470566p470566.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://camel.465427.n5.nabble.com/Help-with-Camel-JAXB-SMX4-Camel-2-1-0-tp470566p470566.html&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12972916" author="ext2xhb" created="Sun, 19 Dec 2010 05:14:22 +0000"  >&lt;p&gt;Thanks for thequickly patch;&lt;br/&gt;
Just as Claus Ibsen has said, there are still other tweaks in OSGI.&lt;/p&gt;

&lt;p&gt;The end user must make ensure that the generated JAXB class is visible to the camel route&apos;s bundle;  &lt;/p&gt;

&lt;p&gt;some times the end-user should manually import the generated JAXB package , if  the generated JAXB class doesn&apos;t exists in the same bundle of camel routes; because the maven-bundle-plugin cannot recognize the spring configuration automatically.&lt;/p&gt;</comment>
                            <comment id="12972932" author="sharma_arun_se" created="Sun, 19 Dec 2010 08:12:24 +0000"  >&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;Thanks ext2 for taking initiative and pointing out the bug and suggesting solution (though spring centric &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; ).  Thanks Claus and Willem for such a quick action and response. &lt;/p&gt;

&lt;p&gt;I am already working with OSGI and will report back, if I faced any issue.&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Arun Kumar (sharma_arun_se)&lt;/p&gt;</comment>
                            <comment id="12973101" author="davsclaus" created="Mon, 20 Dec 2010 06:16:35 +0000"  >&lt;p&gt;Did you guys have any chance to test this patch in your system, and see if it resolves the JAXB issues you may have?&lt;/p&gt;

&lt;p&gt;I think we should also offer a setter so you can set a custom ClassLoader on the JaxbDataFormat.&lt;/p&gt;</comment>
                            <comment id="12989474" author="hadrian" created="Wed, 2 Feb 2011 00:45:33 +0000"  >&lt;p&gt;Fails for injected jaxb context.&lt;/p&gt;</comment>
                            <comment id="12989476" author="nickheudecker" created="Wed, 2 Feb 2011 00:47:56 +0000"  >&lt;p&gt;Attaching a patch to fix JaxbDataFormat when a JAXBContext is passed in instead of a context path.  In the 2.6.0 version, the passed in JAXBContext is clobbered by the created context.  &lt;/p&gt;</comment>
                            <comment id="12990906" author="hadrian" created="Sat, 5 Feb 2011 03:48:33 +0000"  >&lt;p&gt;Updated fix version to 2.7.0. &lt;br/&gt;
A fix was available in 2.6.0 missing just the case where the context is injected.&lt;/p&gt;</comment>
                            <comment id="12990908" author="hadrian" created="Sat, 5 Feb 2011 03:50:36 +0000"  >&lt;p&gt;Patch applied in r1067385. Thanks Nick for spotting this and providing the patch.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310040">
                    <name>Required</name>
                                            <outwardlinks description="requires">
                                        <issuelink>
            <issuekey id="12493584">CAMEL-3441</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12466472" name="JaxbDataFormat.java" size="9185" author="ext2xhb" created="Fri, 17 Dec 2010 17:37:24 +0000"/>
                            <attachment id="12470005" name="JaxbDataFormat.patch.diff" size="1057" author="nickheudecker" created="Wed, 2 Feb 2011 00:47:56 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 17 Dec 2010 17:59:41 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>76251</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 43 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i01uqv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>8750</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310080" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Regression</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10091"><![CDATA[Regression]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>