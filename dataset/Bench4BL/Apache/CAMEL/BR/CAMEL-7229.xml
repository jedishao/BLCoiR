<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sat Dec 03 04:01:52 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/CAMEL-7229/CAMEL-7229.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[CAMEL-7229] [cxfrs] Producer override bean bus</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-7229</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;Bean configuration:&lt;br/&gt;
org.apache.cxf.jaxrs.client.JAXRSClientFactoryBean cf_cCXFRS_1 = new org.apache.cxf.jaxrs.client.JAXRSClientFactoryBean();&lt;br/&gt;
cf_cCXFRS_1.setBus(customBus);&lt;/p&gt;

&lt;p&gt;Route:&lt;br/&gt;
.to(&quot;cxfrs://bean://cCXFRS_1&quot;)&lt;/p&gt;

&lt;p&gt;But at&lt;br/&gt;
org.apache.camel.component.cxf.jaxrs.CxfRsProducer.invokeHttpClient(Exchange)&lt;br/&gt;
cfb.setBus(((CxfRsEndpoint)getEndpoint()).getBus());&lt;/p&gt;</description>
                <environment></environment>
        <key id="12696259">CAMEL-7229</key>
            <summary>[cxfrs] Producer override bean bus</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="njiang">Willem Jiang</assignee>
                                    <reporter username="amarkevich">Alexey Markevich</reporter>
                        <labels>
                    </labels>
                <created>Thu, 20 Feb 2014 14:44:52 +0000</created>
                <updated>Mon, 3 Mar 2014 10:06:28 +0000</updated>
                            <resolved>Mon, 3 Mar 2014 10:06:28 +0000</resolved>
                                    <version>2.12.1</version>
                                    <fixVersion>2.11.5</fixVersion>
                    <fixVersion>2.12.4</fixVersion>
                    <fixVersion>2.13.0</fixVersion>
                                    <component>camel-cxf</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="13912773" author="sergey_beryozkin" created="Wed, 26 Feb 2014 11:11:56 +0000"  >&lt;p&gt;Hi Willem, can we just remove this call where the custom producer bus is lost ?&lt;/p&gt;

&lt;p&gt;If this may be done for a reason to take care of some scenarios (where using the thread default bus is not OK), can we, in CxfRsProducer do something like:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;

&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; class ProducerJAXRSClientFactoryBean &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; JAXRSClientFactoryBean {

   &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; isBusSet() {
       &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;super&lt;/span&gt;.bus != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
   }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;and use ProducerJAXRSClientFactoryBean instead of JAXRSClientFactoryBean within the producer code and then&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;

&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!cfb.isBusSet()) {
    cfb.setBus(((CxfRsEndpoint)getEndpoint()).getBus());
}

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Introducing the custom bean may be the safest bet...&lt;/p&gt;

&lt;p&gt;What do you think ?&lt;br/&gt;
Sergey&lt;/p&gt;</comment>
                            <comment id="13912803" author="sergey_beryozkin" created="Wed, 26 Feb 2014 11:58:50 +0000"  >&lt;p&gt;If the custom bean is introduced then it can be dropped once &lt;a href=&quot;https://issues.apache.org/jira/browse/CXF-5579&quot; title=&quot;Add getBus(boolean createIfNeeded) to AbstractEndpointFactory &quot; class=&quot;issue-link&quot; data-issue-key=&quot;CXF-5579&quot;&gt;&lt;del&gt;CXF-5579&lt;/del&gt;&lt;/a&gt; is resolved, we&apos;d check &quot;if (cxf.getBus(false) == null)&quot;&lt;/p&gt;</comment>
                            <comment id="13914227" author="njiang" created="Thu, 27 Feb 2014 08:50:16 +0000"  >&lt;p&gt;Hi Sergey,&lt;/p&gt;

&lt;p&gt;The below code of CxfRsProducer just make sure the bus setting on the cxfrs endpoint can take effect.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
 cfb.setBus(((CxfRsEndpoint)getEndpoint()).getBus());
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Current work around of setting custom bus is using option of &quot;bus=#MyBus&quot; for the cxfrs enpdoint the URI. &lt;br/&gt;
If we check the &quot;if (cxf.getBus(false) == null)&quot;, we may lost the control of setting the custom bus from the URI.&lt;/p&gt;

&lt;p&gt;I think the better solution is we set the cfb bus when the cxfrs enpdoint is not using the default bus.&lt;br/&gt;
Any thought?&lt;/p&gt;

&lt;p&gt;Willem&lt;/p&gt;</comment>
                            <comment id="13914411" author="sergey_beryozkin" created="Thu, 27 Feb 2014 11:28:32 +0000"  >&lt;p&gt;Hi Willem &lt;/p&gt;

&lt;p&gt;May be &quot;If cxfrs endpoint is not using the default bus and if the client bean has either null or the default bus&quot; ?&lt;/p&gt;

&lt;p&gt;This way if we have a case where someone sets a custom, non-default bus on the client bean then it will not be overridden, but if it is null or it is a default bus then we can safely copy the custom cxfrs endpoint bus ?&lt;/p&gt;

&lt;p&gt;Cheers, Sergey&lt;/p&gt;
</comment>
                            <comment id="13914434" author="amarkevich" created="Thu, 27 Feb 2014 11:55:36 +0000"  >&lt;p&gt;Same time Consumer works as expected (I used preconfigured beans)&lt;/p&gt;</comment>
                            <comment id="13915401" author="njiang" created="Fri, 28 Feb 2014 03:00:24 +0000"  >&lt;p&gt;Hi Sergey, &lt;/p&gt;

&lt;p&gt;In camel-cxf we prefer the rule that the URI option can override the spring or blueprint configuration.&lt;br/&gt;
As the client bean&apos;s getBus can provides the default bus by default, we don&apos;t need to do anything on the client bean if the cxfrs endpoint is not set with a customer bus.&lt;/p&gt;

&lt;p&gt;Regards,&lt;/p&gt;

&lt;p&gt;Willem&lt;/p&gt;
</comment>
                            <comment id="13915404" author="njiang" created="Fri, 28 Feb 2014 03:02:19 +0000"  >&lt;p&gt;Hi Alexey,&lt;/p&gt;

&lt;p&gt;I just checked the code and found we don&apos;t override the bus setting of the server bean. I will clean up the code once we come to an agreement on the CxfRsProducer.&lt;/p&gt;

&lt;p&gt;Regards,&lt;/p&gt;

&lt;p&gt;Willem&lt;/p&gt;</comment>
                            <comment id="13915628" author="sergey_beryozkin" created="Fri, 28 Feb 2014 10:11:04 +0000"  >&lt;p&gt;Hi Willem&lt;/p&gt;

&lt;p&gt;Sure, the idea in your original comment above &lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; sounds OK. So,&lt;/p&gt;

&lt;p&gt;1. If the route sets a custom bus on the client bean then it will still be protected/kept in place as long as the the endpoint uses a default bus or the same custom bus.&lt;br/&gt;
(this will work after your proposed fix)&lt;/p&gt;

&lt;p&gt;2. If we have the client bean using the default bus and we have the endpoint using a custom bus as in &quot;bus=#MyBus&quot; then the custom bus will be set on the client bean, as per the camel-cxf rules, this is fine too.&lt;br/&gt;
(this works now and will work after your proposed fix)&lt;/p&gt;

&lt;p&gt;There&apos;s only one case I&apos;m concerned about:&lt;br/&gt;
3. The client and the server have both custom but different buses. &lt;/p&gt;

&lt;p&gt;That is why I thought that the rule &quot; (a)Set the client bus only if the cxfrs endpoint is not using the default bus and (b) the client bean has the default bus&quot; will ensure 1. and 2. cases are still supported as expected today, but we the client does set its own unique bus then this bus is protected. It will probably make sense for WS producers too...&lt;br/&gt;
Note (a) - is what you propose, which is good, and (b) is what I propose to add...&lt;/p&gt;

&lt;p&gt;Do you think it makes sense to keep the non-default custom buses on the client bean ? We have it working right now by extending the client bean and blocking the overriding of the bus, so if 3, is not implemented then it won&apos;t be an issue for us, but I wonder, does it makes sense to preserve the custom client buses or not&lt;/p&gt;

&lt;p&gt;Thanks, Sergey&lt;/p&gt;



</comment>
                            <comment id="13915633" author="sergey_beryozkin" created="Fri, 28 Feb 2014 10:16:25 +0000"  >&lt;p&gt;Yes, we&apos;ve confirmed we a client and a server using their own, different custom bus instances, this is why it can be handy to have the client custom bus preserved; should be useful for the WS producer too IMHO.&lt;/p&gt;

&lt;p&gt;Thanks, Sergey&lt;/p&gt;</comment>
                            <comment id="13917883" author="njiang" created="Mon, 3 Mar 2014 09:43:28 +0000"  >&lt;p&gt;Hi Sergey,&lt;/p&gt;

&lt;p&gt;Thanks for you comments, I just remove the default bus creation in the CxfRsEndpoint, so we don&apos;t need to setup the default bus to the JAXRSClientFactoryBean or JAXRSServerFactoryBean any more.&lt;br/&gt;
In this way, the bus setting of JAXRSClientFactoryBean and JAXRSServerFactoryBean won&apos;t be override if we don&apos;t set up customer bus on the CxfRsEndpoint.&lt;/p&gt;

&lt;p&gt;Regards,&lt;/p&gt;

&lt;p&gt;Willem&lt;/p&gt;</comment>
                            <comment id="13917904" author="njiang" created="Mon, 3 Mar 2014 10:06:28 +0000"  >&lt;p&gt;Applied the patch into master, camel-2.12.x and camel-2.11.x branches.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12697351">CXF-5579</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 26 Feb 2014 11:11:56 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>374735</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 39 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1skrr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>375035</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>