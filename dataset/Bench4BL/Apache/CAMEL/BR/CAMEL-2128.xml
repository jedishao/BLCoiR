<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sat Dec 03 03:27:20 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/CAMEL-2128/CAMEL-2128.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[CAMEL-2128] Rollback does not work for transactional routes using camel-cxf</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-2128</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;I have a request reply service that should be able to do three different&lt;br/&gt;
things:&lt;/p&gt;

&lt;p&gt;1)  no exception occurs in the implementation: The jms Message should be&lt;br/&gt;
committed and the normal reply should be sent&lt;br/&gt;
2) The implementation throws an exception defined in the service contract:&lt;br/&gt;
The jms message should be committed and a fault should be sent&lt;br/&gt;
3) The implemementation throws another kind of exception: The message delivery should&lt;br/&gt;
be rolled back so it can be received again&lt;/p&gt;

&lt;p&gt;Case 1 and 2 currently work as expected.&lt;/p&gt;

&lt;p&gt;For Case 3 a fault is returned to the caller and the transaction is committed which is wrong. &lt;/p&gt;</description>
                <environment></environment>
        <key id="12486528">CAMEL-2128</key>
            <summary>Rollback does not work for transactional routes using camel-cxf</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="njiang">Willem Jiang</assignee>
                                    <reporter username="chris@die-schneider.net">Christian Schneider</reporter>
                        <labels>
                    </labels>
                <created>Tue, 3 Nov 2009 12:30:30 +0000</created>
                <updated>Fri, 6 Nov 2009 11:28:56 +0000</updated>
                            <resolved>Wed, 4 Nov 2009 02:27:51 +0000</resolved>
                                    <version>2.0.0</version>
                                    <fixVersion>1.6.2</fixVersion>
                    <fixVersion>2.1.0</fixVersion>
                                    <component>camel-cxf</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                            <comments>
                            <comment id="12953308" author="chris@die-schneider.net" created="Tue, 3 Nov 2009 12:33:54 +0000"  >&lt;p&gt;Sample Applicationcontext that contains a transactional route that forwards from jms to a cxf service&lt;/p&gt;</comment>
                            <comment id="12953310" author="chris@die-schneider.net" created="Tue, 3 Nov 2009 12:34:43 +0000"  >&lt;p&gt;Also see the thread Problem with SOAP/JMS and transactions in the user list:&lt;br/&gt;
&lt;a href=&quot;http://mail-archives.apache.org/mod_mbox/camel-users/200911.mbox/thread&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://mail-archives.apache.org/mod_mbox/camel-users/200911.mbox/thread&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12953330" author="chris@die-schneider.net" created="Tue, 3 Nov 2009 12:36:12 +0000"  >&lt;p&gt;Willem Jiang has created a patch that partly resolves this issue:&lt;/p&gt;</comment>
                            <comment id="12953336" author="chris@die-schneider.net" created="Tue, 3 Nov 2009 12:37:00 +0000"  >&lt;p&gt;Patch from Willem&lt;/p&gt;</comment>
                            <comment id="12953317" author="chris@die-schneider.net" created="Tue, 3 Nov 2009 12:37:59 +0000"  >&lt;p&gt;I have built a camel-cxf module that includes the patch. Now the rollback&lt;br/&gt;
basically works.&lt;br/&gt;
The problem is that it happens for all exceptions. I think a good default&lt;br/&gt;
would be to return a fault for all exceptions that the service explicitly&lt;br/&gt;
defines and roll back for all other exceptions. The problem is I have no&lt;br/&gt;
idea how this could be done.&lt;/p&gt;

&lt;p&gt;In the meantime I will try to use an onException() clause to do this&lt;br/&gt;
differentiation.&lt;/p&gt;</comment>
                            <comment id="12953388" author="chris@die-schneider.net" created="Tue, 3 Nov 2009 13:29:13 +0000"  >&lt;p&gt;I have managed to route my special NoSuchCustomerException so that it will commit and return a fault by using the following camel context.&lt;br/&gt;
While I still think the defined exceptions should be handled as a Soap Fault by default this at least means that my transactional CXF Service works. So I think the patch from Willem should go into trunk.&lt;/p&gt;

&lt;p&gt;&amp;lt;camelContext id=&quot;camelContext&quot; trace=&quot;false&quot; xmlns=&quot;http://camel.apache.org/schema/spring&quot;&amp;gt;&lt;br/&gt;
  &amp;lt;onException&amp;gt;&lt;br/&gt;
    &amp;lt;exception&amp;gt;net.enbw.services.etg.examples.customerservice.NoSuchCustomerException&amp;lt;/exception&amp;gt;&lt;br/&gt;
      &amp;lt;handled&amp;gt;&amp;lt;constant&amp;gt;true&amp;lt;/constant&amp;gt;&amp;lt;/handled&amp;gt;&lt;br/&gt;
    &amp;lt;/onException&amp;gt;&lt;br/&gt;
    &amp;lt;route&amp;gt;&lt;br/&gt;
      &amp;lt;from uri=&quot;direct:client&quot;/&amp;gt;&lt;br/&gt;
      &amp;lt;to uri=&quot;jms://queue.net.enbw.services.etg.examples.customerservice.CustomerService&quot; /&amp;gt;&lt;br/&gt;
  &amp;lt;/route&amp;gt;&lt;br/&gt;
  &amp;lt;route&amp;gt;&lt;br/&gt;
    &amp;lt;from uri=&quot;jms://queue.net.enbw.services.etg.examples.customerservice.CustomerService&quot; /&amp;gt;&lt;br/&gt;
    &amp;lt;transacted/&amp;gt;&lt;br/&gt;
    &amp;lt;to uri=&quot;direct:server&quot;/&amp;gt;&lt;br/&gt;
  &amp;lt;/route&amp;gt;&lt;br/&gt;
&amp;lt;/camelContext&amp;gt;&lt;/p&gt;</comment>
                            <comment id="12951246" author="njiang" created="Wed, 4 Nov 2009 01:55:42 +0000"  >&lt;p&gt;@Christian&lt;br/&gt;
It is hard to let CamelTransport to know which kind of exception is defined by User, and the CamelTransport should now nothing about the application level thing. Let&apos;s put the ignoring the customer exception on the camel&apos;s error handler framework.&lt;br/&gt;
I will commit my patch in a min &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="12951349" author="njiang" created="Wed, 4 Nov 2009 02:27:51 +0000"  >&lt;p&gt;trunk&lt;br/&gt;
&lt;a href=&quot;http://svn.apache.org/viewvc?rev=832647&amp;amp;view=rev&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewvc?rev=832647&amp;amp;view=rev&lt;/a&gt;&lt;br/&gt;
camel 1.x branch&lt;br/&gt;
&lt;a href=&quot;http://svn.apache.org/viewvc?rev=832648&amp;amp;view=rev&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewvc?rev=832648&amp;amp;view=rev&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12951630" author="njiang" created="Fri, 6 Nov 2009 11:16:03 +0000"  >&lt;p&gt;@Christian,&lt;br/&gt;
I just found this fix broken the old camel transport example , which don&apos;t want to camel error handle to be involved.  &lt;br/&gt;
I will create a new JIRA &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-2142&quot; title=&quot;Add a flag to CamelTransportFactory to let camelDestination throw the exception when it gets fault message &quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-2142&quot;&gt;&lt;del&gt;CAMEL-2142&lt;/del&gt;&lt;/a&gt; to add a flag on the CamelTransportFactory to enable this feature. &lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12462877" name="appcontext.xml" size="4793" author="chris@die-schneider.net" created="Tue, 3 Nov 2009 12:33:54 +0000"/>
                            <attachment id="12462889" name="patch.txt" size="1036" author="chris@die-schneider.net" created="Tue, 3 Nov 2009 12:37:00 +0000"/>
                    </attachments>
                <subtasks>
                            <subtask id="12486877">CAMEL-2142</subtask>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 4 Nov 2009 01:55:42 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>76629</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 5 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310041" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Patch Info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10042"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i01mof:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>7443</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>