<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sat Dec 03 02:50:26 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/CAMEL-9281/CAMEL-9281.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[CAMEL-9281] Http4 component removes trailing slashes from http requests (producer)</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-9281</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;I have created a scenario which seems to exploit a bug in the HttpHelper createURL method.&lt;/p&gt;

&lt;p&gt;My use case:&lt;/p&gt;

&lt;p&gt;Using http4 component in an http proxy with bridgeEndpoint true&lt;/p&gt;

&lt;p&gt;Send a request such as &lt;a href=&quot;http://somesite/contextpath&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://somesite/contextpath&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Request is forwarded by my proxy to a tomcat server.  Tomcat will reply with a 302 and a new Location of &lt;a href=&quot;http://somesite/contextpath/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://somesite/contextpath/&lt;/a&gt; as this is a built in behavior of tomcat to redirect the caller to the contextpath INCLUDING the trailing slash&lt;/p&gt;

&lt;p&gt;I have http client configured with httpClient.redirectsEnabled=false&lt;br/&gt;
Therefore the 302 is sent back through my proxy to the caller.&lt;/p&gt;

&lt;p&gt;The caller then makes the call to &lt;a href=&quot;http://somesite/contextpath/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://somesite/contextpath/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This is where the problem occurs,  within the createUrl method:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
        &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; path = exchange.getIn().getHeader(Exchange.HTTP_PATH, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;.class);
        &lt;span class=&quot;code-comment&quot;&gt;// NOW the HTTP_PATH is just related path, we don&apos;t need to trim it
&lt;/span&gt;        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (path != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (path.startsWith(&lt;span class=&quot;code-quote&quot;&gt;&quot;/&quot;&lt;/span&gt;)) {
                path = path.substring(1);
            }
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (path.length() &amp;gt; 0) {
                &lt;span class=&quot;code-comment&quot;&gt;// make sure that there is exactly one &lt;span class=&quot;code-quote&quot;&gt;&quot;/&quot;&lt;/span&gt; between HTTP_URI and
&lt;/span&gt;                &lt;span class=&quot;code-comment&quot;&gt;// HTTP_PATH
&lt;/span&gt;                &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!uri.endsWith(&lt;span class=&quot;code-quote&quot;&gt;&quot;/&quot;&lt;/span&gt;)) {
                    uri = uri + &lt;span class=&quot;code-quote&quot;&gt;&quot;/&quot;&lt;/span&gt;;
                }
                uri = uri.concat(path);
            }
        }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;When the second request is made with the trailing slash, the string &quot;path&quot; is / (just a single forward slash)&lt;/p&gt;

&lt;p&gt;This hits the first conditional and results in true, which the following substring then removes this slash.&lt;/p&gt;

&lt;p&gt;Now path.length() is not &amp;gt; 0 so the second conditional evaluates false.&lt;/p&gt;

&lt;p&gt;And we end up with a uri returned that no longer has the trailing slash.&lt;/p&gt;

&lt;p&gt;This is sent to Tomcat, Tomcat then promptly returns another 302 and a redirect loop is created.&lt;/p&gt;

&lt;p&gt;I think the intent of this block of code is to combine the uri and path and make sure there isn&apos;t a duplicate forward slash?&lt;/p&gt;

&lt;p&gt;So the simplest fix I can suggest would be something like&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
        &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; path = exchange.getIn().getHeader(Exchange.HTTP_PATH, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;.class);
        &lt;span class=&quot;code-comment&quot;&gt;// NOW the HTTP_PATH is just related path, we don&apos;t need to trim it
&lt;/span&gt;        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (path != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; ! path.equals(&lt;span class=&quot;code-quote&quot;&gt;&quot;/&quot;&lt;/span&gt;)) {
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (path.startsWith(&lt;span class=&quot;code-quote&quot;&gt;&quot;/&quot;&lt;/span&gt;)) {
                path = path.substring(1);
            }
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (path.length() &amp;gt; 0) {
                &lt;span class=&quot;code-comment&quot;&gt;// make sure that there is exactly one &lt;span class=&quot;code-quote&quot;&gt;&quot;/&quot;&lt;/span&gt; between HTTP_URI and
&lt;/span&gt;                &lt;span class=&quot;code-comment&quot;&gt;// HTTP_PATH
&lt;/span&gt;                &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!uri.endsWith(&lt;span class=&quot;code-quote&quot;&gt;&quot;/&quot;&lt;/span&gt;)) {
                    uri = uri + &lt;span class=&quot;code-quote&quot;&gt;&quot;/&quot;&lt;/span&gt;;
                }
                uri = uri.concat(path);
            }
        }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Where we would just check for this case explicitly with:&lt;/p&gt;

&lt;p&gt;if (path != null &amp;amp;&amp;amp; ! path.equals(&quot;/&quot;)) {&lt;/p&gt;

&lt;p&gt;Thoughts?&lt;/p&gt;

&lt;p&gt;I could probably put together a PR and add some test cases&lt;/p&gt;</description>
                <environment></environment>
        <key id="12909492">CAMEL-9281</key>
            <summary>Http4 component removes trailing slashes from http requests (producer)</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="davsclaus">Claus Ibsen</assignee>
                                    <reporter username="erwelch">Edward Welch</reporter>
                        <labels>
                    </labels>
                <created>Sun, 1 Nov 2015 15:21:51 +0000</created>
                <updated>Sat, 9 Jan 2016 14:38:09 +0000</updated>
                            <resolved>Sat, 9 Jan 2016 14:38:09 +0000</resolved>
                                    <version>2.15.4</version>
                    <version>2.16.1</version>
                                    <fixVersion>2.16.2</fixVersion>
                    <fixVersion>2.17.0</fixVersion>
                                    <component>camel-http</component>
                    <component>camel-http4</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="14985571" author="erwelch" created="Mon, 2 Nov 2015 17:22:03 +0000"  >&lt;p&gt;My initial suggestion will not work, this is what I&apos;m thinking now:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (path != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
            &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; both the path and the uri have slashes, remove a slash from the uri
&lt;/span&gt;            &lt;span class=&quot;code-comment&quot;&gt;// we don&apos;t remove it from &lt;span class=&quot;code-quote&quot;&gt;&quot;path&quot;&lt;/span&gt; to handle the &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; where the path is equal to &lt;span class=&quot;code-quote&quot;&gt;&quot;/&quot;&lt;/span&gt;
&lt;/span&gt;            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (path.startsWith(&lt;span class=&quot;code-quote&quot;&gt;&quot;/&quot;&lt;/span&gt;) &amp;amp;&amp;amp; uri.endsWith(&lt;span class=&quot;code-quote&quot;&gt;&quot;/&quot;&lt;/span&gt;)) {
                uri = uri.substring(0, uri.length());
            }
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (path.length() &amp;gt; 0) {
                &lt;span class=&quot;code-comment&quot;&gt;// make sure that there is exactly one &lt;span class=&quot;code-quote&quot;&gt;&quot;/&quot;&lt;/span&gt; between HTTP_URI and
&lt;/span&gt;                &lt;span class=&quot;code-comment&quot;&gt;// HTTP_PATH
&lt;/span&gt;                &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!uri.endsWith(&lt;span class=&quot;code-quote&quot;&gt;&quot;/&quot;&lt;/span&gt;) &amp;amp;&amp;amp; !path.startsWith(&lt;span class=&quot;code-quote&quot;&gt;&quot;/&quot;&lt;/span&gt;)) {
                    uri = uri + &lt;span class=&quot;code-quote&quot;&gt;&quot;/&quot;&lt;/span&gt;;
                }
                uri = uri.concat(path);
            }
        }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I haven&apos;t tested all the cases yet, just wanted to get some opinions if this solution looks workable?&lt;/p&gt;

&lt;p&gt;Also, if I were going to make a PR, is it ok if I make my PR branch from 2.15.x?  I get a lot more build errors from master and would be easier to work with 2.15.x branch&lt;/p&gt;</comment>
                            <comment id="14989608" author="erwelch" created="Wed, 4 Nov 2015 14:22:53 +0000"  >&lt;p&gt;Was doing some more digging, realized this block of code was changed to address &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-9104&quot; title=&quot;HttpHelper concats fixed endpoint URI query parameters with CamelHttpPath header in wrong order&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-9104&quot;&gt;&lt;del&gt;CAMEL-9104&lt;/del&gt;&lt;/a&gt; in version 2.16.0, but was not backported to 2.15.x because of some refactoring.&lt;/p&gt;

&lt;p&gt;Looking at the code in 2.16.0, I have come up with this solution:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (path != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; path.length() &amp;gt; 0) {

            &lt;span class=&quot;code-comment&quot;&gt;//Find a ? indicating there are query params
&lt;/span&gt;            &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; idx = uri.indexOf(&lt;span class=&quot;code-quote&quot;&gt;&quot;?&quot;&lt;/span&gt;);

            &lt;span class=&quot;code-comment&quot;&gt;//Break apart the uri into base and queryParams
&lt;/span&gt;            &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; base;
            &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; queryParams;
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (idx == -1) {
                &lt;span class=&quot;code-comment&quot;&gt;//No query params
&lt;/span&gt;                base = uri;
                queryParams = &quot;&quot;;
            } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
                base = uri.substring(0, idx);
                queryParams = uri.substring(idx);
            }

            &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; the base ends with a / and the path starts with a /, remove a slash from the path
&lt;/span&gt;            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (base.endsWith(&lt;span class=&quot;code-quote&quot;&gt;&quot;/&quot;&lt;/span&gt;) &amp;amp;&amp;amp; path.startsWith(&lt;span class=&quot;code-quote&quot;&gt;&quot;/&quot;&lt;/span&gt;)) {
                path = path.substring(1);
            }
            &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; the neither the base ends with a / or the path starts with a /, add one to the base
&lt;/span&gt;            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!base.endsWith(&lt;span class=&quot;code-quote&quot;&gt;&quot;/&quot;&lt;/span&gt;) &amp;amp;&amp;amp; !path.startsWith(&lt;span class=&quot;code-quote&quot;&gt;&quot;/&quot;&lt;/span&gt;) ) {
                base = base + &lt;span class=&quot;code-quote&quot;&gt;&quot;/&quot;&lt;/span&gt;;
            }

            &lt;span class=&quot;code-comment&quot;&gt;// add everything together;
&lt;/span&gt;            uri = base.concat(path).concat(queryParams);

        }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Unfortunately, the patch for this is a little complicated, because the HttpHelper tests were not refactored into camel-http-common when HttpHelper was moved.  Also, I noticed this code is copied and pasted in the NettyHttpHelper class which exists in both the netty and netty4 components.&lt;/p&gt;

&lt;p&gt;Not sure the best place to put unit tests for this?&lt;/p&gt;</comment>
                            <comment id="15071462" author="davsclaus" created="Fri, 25 Dec 2015 09:42:01 +0000"  >&lt;p&gt;There has been some new changes in the code. &lt;/p&gt;

&lt;p&gt;I assume the fix can be as simple as &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (path.startsWith(&lt;span class=&quot;code-quote&quot;&gt;&quot;/&quot;&lt;/span&gt;)) {
                path = path.substring(1);
            }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;--&amp;gt;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (path.length() &amp;gt; 1 &amp;amp;&amp;amp; path.startsWith(&lt;span class=&quot;code-quote&quot;&gt;&quot;/&quot;&lt;/span&gt;)) {
                path = path.substring(1);
            }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;to only clip the trailing / if its not just a slash.&lt;/p&gt;

&lt;p&gt;Can you take a look again with latest source code and give it a test on your system?&lt;/p&gt;</comment>
                            <comment id="15081174" author="erwelch" created="Mon, 4 Jan 2016 13:56:32 +0000"  >&lt;p&gt;Hi Claus, sorry, was away from computers for a couple weeks.  Will try to take a look at this today or tomorrow!&lt;/p&gt;</comment>
                            <comment id="15081273" author="erwelch" created="Mon, 4 Jan 2016 15:27:07 +0000"  >&lt;p&gt;I ran your proposed solution and still found an issue with this block, it adds a duplicate trailing slash:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
 &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (idx == -1) {
      &lt;span class=&quot;code-comment&quot;&gt;// make sure that there is exactly one &lt;span class=&quot;code-quote&quot;&gt;&quot;/&quot;&lt;/span&gt; between HTTP_URI and HTTP_PATH
&lt;/span&gt;      uri = uri.endsWith(&lt;span class=&quot;code-quote&quot;&gt;&quot;/&quot;&lt;/span&gt;) ? uri : uri + &lt;span class=&quot;code-quote&quot;&gt;&quot;/&quot;&lt;/span&gt;;
      uri = uri.concat(path);
  } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;What happens now is we end up with two trailing slashes, uri does not end with a slash, so one is added, but path contains &quot;/&quot; which is also concatenated giving use two trailing slashes&lt;/p&gt;

&lt;p&gt;I think this could be remedied by adding one more check like so:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; there are no query params
&lt;/span&gt;&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (idx == -1) {
    &lt;span class=&quot;code-comment&quot;&gt;// make sure that there is exactly one &lt;span class=&quot;code-quote&quot;&gt;&quot;/&quot;&lt;/span&gt; between HTTP_URI and HTTP_PATH
&lt;/span&gt;    uri = uri.endsWith(&lt;span class=&quot;code-quote&quot;&gt;&quot;/&quot;&lt;/span&gt;) || path.startsWith(&lt;span class=&quot;code-quote&quot;&gt;&quot;/&quot;&lt;/span&gt;) ? uri : uri + &lt;span class=&quot;code-quote&quot;&gt;&quot;/&quot;&lt;/span&gt;;
    uri = uri.concat(path);
} &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;



&lt;p&gt;BTW, These are the test cases I had added regarding this issue:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
@Test
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void createURLShouldNotRemoveTrailingSlash() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
    &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; url = HttpHelper.createURL(
            createExchangeWithOptionalCamelHttpUriHeader(&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;/&quot;&lt;/span&gt;),
            createHttpEndpoint(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;http:&lt;span class=&quot;code-comment&quot;&gt;//www.google.com&quot;&lt;/span&gt;));
&lt;/span&gt;    assertEquals(&lt;span class=&quot;code-quote&quot;&gt;&quot;http:&lt;span class=&quot;code-comment&quot;&gt;//www.google.com/&quot;&lt;/span&gt;, url);
&lt;/span&gt;}
@Test
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void createURLShouldAddPathAndQueryParamsAndSlash() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
    &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; url = HttpHelper.createURL(
            createExchangeWithOptionalCamelHttpUriHeader(&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;search&quot;&lt;/span&gt;),
            createHttpEndpoint(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;http:&lt;span class=&quot;code-comment&quot;&gt;//www.google.com/context?test=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;));
&lt;/span&gt;    assertEquals(&lt;span class=&quot;code-quote&quot;&gt;&quot;http:&lt;span class=&quot;code-comment&quot;&gt;//www.google.com/context/search?test=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;, url);
&lt;/span&gt;}
@Test
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void createURLShouldAddPathAndQueryParamsAndRemoveDuplicateSlash() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
    &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; url = HttpHelper.createURL(
            createExchangeWithOptionalCamelHttpUriHeader(&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;/search&quot;&lt;/span&gt;),
            createHttpEndpoint(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;http:&lt;span class=&quot;code-comment&quot;&gt;//www.google.com/context/?test=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;));
&lt;/span&gt;    assertEquals(&lt;span class=&quot;code-quote&quot;&gt;&quot;http:&lt;span class=&quot;code-comment&quot;&gt;//www.google.com/context/search?test=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;, url);
&lt;/span&gt;}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15090645" author="davsclaus" created="Sat, 9 Jan 2016 14:30:41 +0000"  >&lt;p&gt;Thanks Edward, working on your patch now.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 25 Dec 2015 09:42:01 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            46 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2nsif:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>