<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sat Dec 03 02:31:40 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/CAMEL-2922/CAMEL-2922.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[CAMEL-2922] XMPPConsumer does not remove the message which causes OOME with XMPP</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-2922</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description></description>
                <environment></environment>
        <key id="12485960">CAMEL-2922</key>
            <summary>XMPPConsumer does not remove the message which causes OOME with XMPP</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="davsclaus">Claus Ibsen</assignee>
                                    <reporter username="davsclaus">Claus Ibsen</reporter>
                        <labels>
                    </labels>
                <created>Thu, 8 Jul 2010 05:13:50 +0000</created>
                <updated>Sun, 24 Apr 2011 09:57:31 +0000</updated>
                            <resolved>Wed, 14 Jul 2010 04:36:16 +0000</resolved>
                                    <version>2.1.0</version>
                    <version>2.2.0</version>
                    <version>2.3.0</version>
                                    <fixVersion>2.5.0</fixVersion>
                                    <component>camel-xmpp</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                            <aggregatetimeoriginalestimate seconds="300">5m</aggregatetimeoriginalestimate>
                                        <aggregatetimeremainingestimate seconds="300">5m</aggregatetimeremainingestimate>
                                                <comments>
                            <comment id="12953443" author="davsclaus" created="Thu, 8 Jul 2010 05:14:45 +0000"  >&lt;p&gt;See &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-1476&quot; title=&quot;Set property in the exchange to identify CXF component DataFormat mode (payload, message, or pojo)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-1476&quot;&gt;&lt;del&gt;CAMEL-1476&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;The patch for this bug was removed in revision 779121. The result is that the XMPPConsumer does not remove the message from the MultiUserChat and the possibility for an OutOfMemoryException still exists.&lt;br/&gt;
The OOM occurs because the org.jivesoftware.smackx.muc.RoomListenerMultiplexor is a packet listener that contains a collector that stores all of the messages received up to a hard coded limit of 65k messages. These messages are not removed unless muc.pollMessage() or muc.nextMessage() is called. I&apos;m not sure the reason behind storing these messages in a collector.&lt;/p&gt;

&lt;p&gt;I have tested this in 2.1.0 and 2.3.0 and reviewed the code in 2.4-SNAPSHOT. I can supply a test case if needed.&lt;/p&gt;&lt;/blockquote&gt;</comment>
                            <comment id="12953011" author="mark.ford" created="Wed, 14 Jul 2010 03:27:17 +0000"  >&lt;p&gt;I haven&apos;t had a chance to look at integrating my test into the integration tests for this component. &lt;/p&gt;

&lt;p&gt;However, the snippet below is almost the same as what was originally applied and mistakenly overwritten. My only change is to call the non-blocking pollMessage() instead of nextMessage(). The non-blocking call seems safer in case the packet listener that&apos;s doing the collecting hasn&apos;t been called yet.&lt;/p&gt;

&lt;p&gt;The diff below is from the 2.1.0 base. The method (public void processMessage(Chat chat, Message message)) is the same in the 2.4-SNAPSHOT version.&lt;/p&gt;

&lt;p&gt;Index: XmppConsumer.java&lt;br/&gt;
===================================================================&lt;br/&gt;
&amp;#8212; XmppConsumer.java	(revision 960908)&lt;br/&gt;
+++ XmppConsumer.java	(working copy)&lt;br/&gt;
@@ -130,5 +130,9 @@&lt;br/&gt;
         } catch (Exception e) &lt;/p&gt;
{
             exchange.setException(e);
         }
&lt;p&gt;+        &lt;br/&gt;
+        if (muc != null) &lt;/p&gt;
{
+            muc.pollMessage();
+        }
&lt;p&gt;     }&lt;br/&gt;
 }&lt;/p&gt;</comment>
                            <comment id="12951352" author="davsclaus" created="Wed, 14 Jul 2010 04:36:16 +0000"  >&lt;p&gt;Thanks Mark for pointing this out. I have committed a fix and polished the logging a bit.&lt;/p&gt;

&lt;p&gt;trunk: 963946.&lt;/p&gt;</comment>
                            <comment id="13023831" author="davsclaus" created="Sun, 24 Apr 2011 09:57:31 +0000"  >&lt;p&gt;Closing all resolved tickets from 2010 or older&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                            <subtask id="12486155">CAMEL-1467</subtask>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 14 Jul 2010 03:27:17 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>76398</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 32 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i01rk7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>8234</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>