<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sat Dec 03 05:16:29 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/CAMEL-7653/CAMEL-7653.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[CAMEL-7653] camel-sql endpoint oracle failure</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-7653</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;I use the sql endpoint against oracle, however the &lt;tt&gt;DefaultSqlPrepareStatementStrategy&lt;/tt&gt; uses &lt;tt&gt;PreparedStatement.setObject&lt;/tt&gt; to set all the named parameters. With most jdbc drives this works fine except for oracle. Oracle throws an ORA-17004 exception stating an invalid column type. &lt;/p&gt;

&lt;p&gt;My route looks like this&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
from(&lt;span class=&quot;code-quote&quot;&gt;&quot;{{ktn.stkbal.in&quot;&lt;/span&gt;)
                .routeId(&lt;span class=&quot;code-quote&quot;&gt;&quot;KTN.StkBal&quot;&lt;/span&gt;)
                .onCompletion().onCompleteOnly()
                    .to(&lt;span class=&quot;code-quote&quot;&gt;&quot;seda:generatestockbalancereport&quot;&lt;/span&gt;)
                .end()
                .setHeader(&lt;span class=&quot;code-quote&quot;&gt;&quot;ts&quot;&lt;/span&gt;,constant(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Timestamp(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Date().getTime())))
                .split().tokenizeXML(&lt;span class=&quot;code-quote&quot;&gt;&quot;product&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;stockPicture&quot;&lt;/span&gt;).streaming()
                    .setHeader(&lt;span class=&quot;code-quote&quot;&gt;&quot;ean&quot;&lt;/span&gt;,xpath(&lt;span class=&quot;code-quote&quot;&gt;&quot;/st:product/@ean&quot;&lt;/span&gt;).resultType(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;.class).namespaces(KTNConstants.STOCK_NAMESPACES))
                    .setHeader(&lt;span class=&quot;code-quote&quot;&gt;&quot;available&quot;&lt;/span&gt;, xpath(&lt;span class=&quot;code-quote&quot;&gt;&quot;/st:product/st:available&quot;&lt;/span&gt;).resultType(&lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;.class).namespaces(KTNConstants.STOCK_NAMESPACES))
                    .setHeader(&lt;span class=&quot;code-quote&quot;&gt;&quot;blocked&quot;&lt;/span&gt;,xpath(&lt;span class=&quot;code-quote&quot;&gt;&quot;/st:product/st:blocked&quot;&lt;/span&gt;).resultType(&lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;.class).namespaces(KTNConstants.STOCK_NAMESPACES))
                    .to(&lt;span class=&quot;code-quote&quot;&gt;&quot;sql:insert into stockbalance(ean,available,blocked,picturets) values (:#ean,:#available,:#blocked,:#ts)?dataSourceRef=hybrisDataSource&quot;&lt;/span&gt;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And from our dear oracle i get&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
23:34:20,821 | TRACE | 2/STKBAL/inbound | faultSqlPrepareStatementStrategy | 286 - org.apache.camel.camel-sql - 2.12.0.redhat-610379 | Prepared query: insert into stockbalance(ean,available,blocked,picturets) values (?,?,?,?)
23:34:20,824 | TRACE | 2/STKBAL/inbound | faultSqlPrepareStatementStrategy | 286 - org.apache.camel.camel-sql - 2.12.0.redhat-610379 | Setting parameter #1 with value: 10000000000001
23:34:20,825 | TRACE | 2/STKBAL/inbound | faultSqlPrepareStatementStrategy | 286 - org.apache.camel.camel-sql - 2.12.0.redhat-610379 | Setting parameter #2 with value: 2
23:34:20,826 | TRACE | 2/STKBAL/inbound | faultSqlPrepareStatementStrategy | 286 - org.apache.camel.camel-sql - 2.12.0.redhat-610379 | Setting parameter #3 with value: 5
23:34:20,828 | TRACE | 2/STKBAL/inbound | faultSqlPrepareStatementStrategy | 286 - org.apache.camel.camel-sql - 2.12.0.redhat-610379 | Setting parameter #4 with value: Wed Jul 30 23:33:18 CEST 2014
23:34:20,831 | ERROR | 2/STKBAL/inbound | DefaultErrorHandler              | 142 - org.apache.camel.camel-core - 2.12.0.redhat-610379 | Failed delivery &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (MessageId: ID-tst-esb-inno1-41429-1406755976005-6-7 on ExchangeId: ID-tst-esb-inno1-41429-1406755976005-6-9). Exha
usted after delivery attempt: 1 caught: org.springframework.jdbc.UncategorizedSQLException: PreparedStatementCallback; uncategorized SQLException &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; SQL [insert into stockbalance(ean,available,blocked,picturets) values (?,?,?,?)]; SQL state [99999]; error code [17004];
Invalid column type; nested exception is java.sql.SQLException: Invalid column type

Message History
---------------------------------------------------------------------------------------------------------------------------------------
RouteId              ProcessorId          Processor                                                                        Elapsed (ms)
[KTN.StkBal        ] [KTN.StkBal        ] [sftp:&lt;span class=&quot;code-comment&quot;&gt;//TSTKATOEN2341@&amp;lt;edited&amp;gt;/STKBAL/inbound?antExcl] [        21]
&lt;/span&gt;[KTN.StkBal        ] [setHeader69       ] [setHeader[ean]                                                                ] [         2]
[KTN.StkBal        ] [setHeader70       ] [setHeader[available]                                                          ] [         1]
[KTN.StkBal        ] [setHeader71       ] [setHeader[blocked]                                                            ] [         1]
[KTN.StkBal        ] [to107             ] [sql:insert into stockbalance(ean,available,blocked,picturets) values (:#ean,:#] [         9]

Stacktrace
---------------------------------------------------------------------------------------------------------------------------------------
org.springframework.jdbc.UncategorizedSQLException: PreparedStatementCallback; uncategorized SQLException &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; SQL [insert into stockbalance(ean,available,blocked,picturets) values (?,?,?,?)]; SQL state [99999]; error code [17004]; Invalid column type; nested exception is
 java.sql.SQLException: Invalid column type
        at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:83)[285:org.apache.servicemix.bundles.spring-jdbc:3.2.8.RELEASE_1]
        at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:80)[285:org.apache.servicemix.bundles.spring-jdbc:3.2.8.RELEASE_1]
        at org.springframework.jdbc.support.AbstractFallbackSQLExceptionTranslator.translate(AbstractFallbackSQLExceptionTranslator.java:80)[285:org.apache.servicemix.bundles.spring-jdbc:3.2.8.RELEASE_1]

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;As workaround i extended the &lt;tt&gt;DefaultSqlPrepareStatementStrategy&lt;/tt&gt; and override &lt;tt&gt;populateStatement&lt;/tt&gt;. It leverages springs &lt;tt&gt;ArgumentPreparedStatementSetter&lt;/tt&gt; to do the right thing.  &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    @Override
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void populateStatement(PreparedStatement ps, Iterator&amp;lt;?&amp;gt; iterator, &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; expectedParams) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; SQLException {
        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;[] args = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;[expectedParams];
        &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i = 0 ;
        &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; (iterator != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; iterator.hasNext()) {
            args[i]=iterator.next();
            i++;
        }
        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; ArgumentPreparedStatementSetter setter = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ArgumentPreparedStatementSetter(args);
        setter.setValues(ps);
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12731024">CAMEL-7653</key>
            <summary>camel-sql endpoint oracle failure</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="davsclaus">Claus Ibsen</assignee>
                                    <reporter username="jogeraerts">Jo Geraerts</reporter>
                        <labels>
                    </labels>
                <created>Thu, 31 Jul 2014 09:45:36 +0000</created>
                <updated>Mon, 4 Aug 2014 07:26:39 +0000</updated>
                            <resolved>Mon, 4 Aug 2014 07:26:39 +0000</resolved>
                                    <version>2.12.0</version>
                                    <fixVersion>2.12.5</fixVersion>
                    <fixVersion>2.13.3</fixVersion>
                    <fixVersion>2.14.0</fixVersion>
                                    <component>camel-sql</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                        <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>409096</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 18 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1ye0n:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>409092</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>