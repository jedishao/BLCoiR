<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sat Dec 03 02:28:44 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/CAMEL-1513/CAMEL-1513.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[CAMEL-1513] camel-csv : mutliple messages lead to repeated values</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-1513</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;I have this config : &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-xml&quot;&gt;&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;route&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;from uri=&lt;span class=&quot;code-quote&quot;&gt;&quot;direct:msgIn&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;marshal&amp;gt;&lt;/span&gt;&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;csv /&amp;gt;&lt;/span&gt;&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/marshal&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;to uri=&lt;span class=&quot;code-quote&quot;&gt;&quot;file://msgs?fileName=messages.csv&quot;&lt;/span&gt; /&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/route&amp;gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I send Map objects with this :&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
ProducerTemplate template = context.createProducerTemplate();

Map msg1 = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HashMap();
msg1.put(&lt;span class=&quot;code-quote&quot;&gt;&quot;A&quot;&lt;/span&gt;, 1);
msg1.put(&lt;span class=&quot;code-quote&quot;&gt;&quot;B&quot;&lt;/span&gt;, 1);
Map msg2 = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HashMap();
msg2.put(&lt;span class=&quot;code-quote&quot;&gt;&quot;A&quot;&lt;/span&gt;, 2);
msg2.put(&lt;span class=&quot;code-quote&quot;&gt;&quot;B&quot;&lt;/span&gt;, 2);
template.sendBody(&lt;span class=&quot;code-quote&quot;&gt;&quot;direct:msgIn&quot;&lt;/span&gt;, msg1);
template.sendBody(&lt;span class=&quot;code-quote&quot;&gt;&quot;direct:msgIn&quot;&lt;/span&gt;, msg2);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This produces the following result :&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;1,1
2,2,2,2
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;instead of &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;1,1
2,2
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The more messages are pumped into the CSV marshaller, the more the values are repeated. This is because the marshal method in CsvDataFormat keeps adding columns to the config even if they are already present :&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;CsvDataFormat.java&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;  ........
        CSVConfig conf = getConfig();
        &lt;span class=&quot;code-comment&quot;&gt;// lets add fields
&lt;/span&gt;        Set set = map.keySet();
        &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; value : set) {
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (value != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
                &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; text = value.toString();
                CSVField field = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; CSVField(text);
                conf.addField(field);
            }
        }
        CSVWriter writer = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; CSVWriter(conf);

  .......
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I think the marshal method should perform something like&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (config == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
    config = createConfig();
    &lt;span class=&quot;code-comment&quot;&gt;// lets add fields
&lt;/span&gt;    Set set = map.keySet();
    &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; value : set) {
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (value != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
     ..............
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
</description>
                <environment></environment>
        <key id="12485438">CAMEL-1513</key>
            <summary>camel-csv : mutliple messages lead to repeated values</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="davsclaus">Claus Ibsen</assignee>
                                    <reporter username="jfe">Julien Faissolle</reporter>
                        <labels>
                    </labels>
                <created>Thu, 2 Apr 2009 14:42:51 +0000</created>
                <updated>Sat, 21 Nov 2009 11:57:57 +0000</updated>
                            <resolved>Thu, 9 Apr 2009 08:17:15 +0000</resolved>
                                    <version>2.0-M1</version>
                                    <fixVersion>1.6.1</fixVersion>
                    <fixVersion>2.0-M2</fixVersion>
                                    <component>camel-core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12951631" author="davsclaus" created="Sat, 4 Apr 2009 18:23:17 +0000"  >&lt;p&gt;Julien, well spotted&lt;/p&gt;

&lt;p&gt;Do you care to try to create a patch?&lt;br/&gt;
&lt;a href=&quot;http://camel.apache.org/support.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://camel.apache.org/support.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;And please add an unit test demonstrating this bug is fixed.&lt;/p&gt;

&lt;p&gt;The problem is indeed the fact that CSVConfig is not created on each operation.&lt;/p&gt;

&lt;p&gt;So the CSVConfig should &lt;b&gt;not&lt;/b&gt; be a shared instance. It should be created on each invocation.&lt;/p&gt;
</comment>
                            <comment id="12951656" author="jfe" created="Mon, 6 Apr 2009 06:44:13 +0000"  >&lt;p&gt;Ok, I&apos;ll work on it. But I don&apos;t think the CSVConfig should be automatically created on each invocation because it would forbid providing one&apos;s own CSVConfig instance through setConfig(). Note that manually assigning a CSVConfig doesn&apos;t work as it should because of the current bug.&lt;/p&gt;</comment>
                            <comment id="12951694" author="jfe" created="Thu, 9 Apr 2009 07:48:29 +0000"  >&lt;p&gt;Here is a patch for this issue along with unit tests. The behavior is now by default to add new fields only if they have not already been set by previous messages. Thus, the field order stays consistent. The field addition is synchronized to avoid concurrency problems. The new property &lt;em&gt;autogenColumns&lt;/em&gt; can be set to false in order to disable the automatic generation of fields. Disabling automatic generation is especially useful in the case of a custom CSVConfig.&lt;/p&gt;</comment>
                            <comment id="12951708" author="davsclaus" created="Thu, 9 Apr 2009 08:17:15 +0000"  >&lt;p&gt;Applied patch with thanks to Julien&lt;/p&gt;

&lt;p&gt;trunk: 763551&lt;br/&gt;
1.x: 763553&lt;/p&gt;</comment>
                            <comment id="12953636" author="davsclaus" created="Sat, 21 Nov 2009 11:57:57 +0000"  >&lt;p&gt;Closing all 2.0M2 tickets&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12462915" name="camel-csv.patch" size="8186" author="jfe" created="Thu, 9 Apr 2009 07:48:29 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sat, 4 Apr 2009 18:23:17 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>76826</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 2 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i01ivj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6827</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>