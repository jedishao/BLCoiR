<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sat Dec 03 04:26:35 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/CAMEL-10115/CAMEL-10115.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[CAMEL-10115] Kafka consumer stays running if no messages were received after shutdown start</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-10115</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;After triggering &lt;tt&gt;CamelContext#close()&lt;/tt&gt; method the execution will reach &lt;tt&gt;org.apache.camel.component.kafka.KafkaConsumer#doStop&lt;/tt&gt; where the shutdown of the executor instance will be triggered and where in it&apos;s turn the interruption of the submitted to the executor threads should happen (by reaching the native implementation of Thread#interrupt())&lt;/p&gt;

&lt;p&gt;According to &lt;a href=&quot;https://docs.oracle.com/javase/8/docs/api/java/lang/Thread.html#interrupt--&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://docs.oracle.com/javase/8/docs/api/java/lang/Thread.html#interrupt--&lt;/a&gt; interrupt method will only set a corresponding status to the thread, but will not terminate it. &lt;/p&gt;

&lt;p&gt;Problem is in the line &lt;tt&gt;KafkaConsumer.java:108&lt;/tt&gt;:&lt;br/&gt;
&lt;tt&gt;ConsumerRecords&amp;lt;Object, Object&amp;gt; records = consumer.poll(Long.MAX_VALUE);&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;In the Kafka implementation of the poll method this will lead to almost infinite &lt;tt&gt;while&lt;/tt&gt; loop which is not checking the thread status and this loop will exit only in case of receiving a message from a broker. Only after exciting the loop the interrupted status of the thread will be discovered and the thread will be terminated.&lt;/p&gt;

&lt;p&gt;This leads to a couple of problems:&lt;br/&gt;
1. The KafkaConsumers remain alive until receiving at least one more message from the broker.&lt;br/&gt;
2. As the CamelContext at this point of time is most likely already shut down, the received message is not going to be processed, but will be acknowledged to the broker. So effectively the message gets lost.&lt;/p&gt;

&lt;p&gt;A potential fix would be to either make the poll timeout reasonably small or configurable.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Spring Boot 1.4.0.M3 with Tomcat&lt;br/&gt;
Java 8&lt;br/&gt;
Camel 2.17.1&lt;/p&gt;</environment>
        <key id="12986222">CAMEL-10115</key>
            <summary>Kafka consumer stays running if no messages were received after shutdown start</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="anoordover">Arno Noordover</assignee>
                                    <reporter username="vchekrii">Vadym Chekrii</reporter>
                        <labels>
                    </labels>
                <created>Fri, 1 Jul 2016 15:50:26 +0000</created>
                <updated>Mon, 4 Jul 2016 12:34:41 +0000</updated>
                            <resolved>Mon, 4 Jul 2016 12:34:41 +0000</resolved>
                                    <version>2.17.1</version>
                                    <fixVersion>2.18.0</fixVersion>
                                    <component>camel-kafka</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>4</watches>
                                                                <comments>
                            <comment id="15360638" author="githubbot" created="Sun, 3 Jul 2016 18:38:44 +0000"  >&lt;p&gt;GitHub user anoordover opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/camel/pull/1057&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/apache/camel/pull/1057&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-10115&quot; title=&quot;Kafka consumer stays running if no messages were received after shutdown start&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-10115&quot;&gt;&lt;del&gt;CAMEL-10115&lt;/del&gt;&lt;/a&gt;: introduced pollTimeOutMs with default 30000&lt;/p&gt;

&lt;p&gt;    Please provide comment about two things:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;the default time of 30000ms for pollTimeOutMs;&lt;/li&gt;
	&lt;li&gt;the assumption that the configuration of the endpoint (see line 50 in KafkaConsumer) is never null.&lt;/li&gt;
&lt;/ul&gt;




&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/anoordover/camel&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/anoordover/camel&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-10115&quot; title=&quot;Kafka consumer stays running if no messages were received after shutdown start&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-10115&quot;&gt;&lt;del&gt;CAMEL-10115&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/camel/pull/1057.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/apache/camel/pull/1057.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #1057&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 2ee1ed1f2ef86310e750d7ce86f786add0b4535a&lt;br/&gt;
Author: Arno Noordover &amp;lt;anoordover@users.noreply.github.com&amp;gt;&lt;br/&gt;
Date:   2016-07-03T18:30:03Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-10115&quot; title=&quot;Kafka consumer stays running if no messages were received after shutdown start&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-10115&quot;&gt;&lt;del&gt;CAMEL-10115&lt;/del&gt;&lt;/a&gt;: introduced pollTimeOutMs with default 30000&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15361240" author="githubbot" created="Mon, 4 Jul 2016 12:24:38 +0000"  >&lt;p&gt;Github user anoordover closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/camel/pull/1057&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/apache/camel/pull/1057&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15361251" author="anoordover" created="Mon, 4 Jul 2016 12:34:41 +0000"  >&lt;p&gt;Cherry-picking isn&apos;t easy in 2.17.x&lt;br/&gt;
Vote to have it back-ported to 2.17.3&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sun, 3 Jul 2016 18:38:44 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            21 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i30fpz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>