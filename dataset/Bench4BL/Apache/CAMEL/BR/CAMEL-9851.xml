<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sat Dec 03 02:20:39 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/CAMEL-9851/CAMEL-9851.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[CAMEL-9851] Zookeeper RoutePolicy failing to create znode</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-9851</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;I am trying to setup a ZooKeeper route policy like this&lt;/p&gt;

&lt;p&gt;ZooKeeperRoutePolicy policy = new ZooKeeperRoutePolicy(&quot;zookeeper:localhost/regexTest1?create=true&quot;, 1);&lt;br/&gt;
from(&quot;direct:start&quot;).routePolicy(policy).to(&#8220;mock:end&#8221;);&lt;/p&gt;

&lt;p&gt;And when I run my unit test to trigger the route, I get the following exception in my logs&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Node &apos;/regexTest1/192.168.202.25-3306c9d2-1354-4dbe-aaff-846eee5bb60d&apos; did not exist, creating it.
Error setting up election node /regexTest1/192.168.202.25-25829641-de1f-4389-9bb6-2967ea60de1a
org.apache.zookeeper.KeeperException$NoNodeException: KeeperErrorCode = NoNode for /regexTest1/192.168.202.25-25829641-de1f-4389-9bb6-2967ea60de1a
	at org.apache.zookeeper.KeeperException.create(KeeperException.java:111) ~[zookeeper-3.4.8.jar:3.4.8--1]
	at org.apache.zookeeper.KeeperException.create(KeeperException.java:51) ~[zookeeper-3.4.8.jar:3.4.8--1]
	at org.apache.zookeeper.ZooKeeper.create(ZooKeeper.java:783) ~[zookeeper-3.4.8.jar:3.4.8--1]
	at org.apache.camel.component.zookeeper.operations.CreateOperation.getResult(CreateOperation.java:52) ~[camel-zookeeper-2.17.0.jar:2.17.0]
	at org.apache.camel.component.zookeeper.operations.ZooKeeperOperation.get(ZooKeeperOperation.java:70) ~[camel-zookeeper-2.17.0.jar:2.17.0]
	at org.apache.camel.component.zookeeper.ZookeeperProducer.createNode(ZookeeperProducer.java:222) ~[camel-zookeeper-2.17.0.jar:2.17.0]
	at org.apache.camel.component.zookeeper.ZookeeperProducer.synchronouslySetData(ZookeeperProducer.java:238) ~[camel-zookeeper-2.17.0.jar:2.17.0]
	at org.apache.camel.component.zookeeper.ZookeeperProducer.process(ZookeeperProducer.java:88) ~[camel-zookeeper-2.17.0.jar:2.17.0]
	at org.apache.camel.util.AsyncProcessorConverterHelper$ProcessorToAsyncProcessorBridge.process(AsyncProcessorConverterHelper.java:61) ~[camel-core-2.17.0.jar:2.17.0]
	at org.apache.camel.processor.CamelInternalProcessor.process(CamelInternalProcessor.java:190) [camel-core-2.17.0.jar:2.17.0]
	at org.apache.camel.util.AsyncProcessorHelper.process(AsyncProcessorHelper.java:109) [camel-core-2.17.0.jar:2.17.0]
	at org.apache.camel.processor.UnitOfWorkProducer.process(UnitOfWorkProducer.java:68) [camel-core-2.17.0.jar:2.17.0]
	at org.apache.camel.impl.ProducerCache$2.doInProducer(ProducerCache.java:412) [camel-core-2.17.0.jar:2.17.0]
	at org.apache.camel.impl.ProducerCache$2.doInProducer(ProducerCache.java:380) [camel-core-2.17.0.jar:2.17.0]
	at org.apache.camel.impl.ProducerCache.doInProducer(ProducerCache.java:270) [camel-core-2.17.0.jar:2.17.0]
	at org.apache.camel.impl.ProducerCache.sendExchange(ProducerCache.java:380) [camel-core-2.17.0.jar:2.17.0]
	at org.apache.camel.impl.ProducerCache.send(ProducerCache.java:205) [camel-core-2.17.0.jar:2.17.0]
	at org.apache.camel.impl.DefaultProducerTemplate.send(DefaultProducerTemplate.java:119) [camel-core-2.17.0.jar:2.17.0]
	at org.apache.camel.component.zookeeper.policy.ZooKeeperElection.createCandidateNode(ZooKeeperElection.java:146) [camel-zookeeper-2.17.0.jar:2.17.0]
	at org.apache.camel.component.zookeeper.policy.ZooKeeperElection.testAndCreateCandidateNode(ZooKeeperElection.java:116) [camel-zookeeper-2.17.0.jar:2.17.0]
	at org.apache.camel.component.zookeeper.policy.ZooKeeperElection.isMaster(ZooKeeperElection.java:92) [camel-zookeeper-2.17.0.jar:2.17.0]
	at org.apache.camel.component.zookeeper.policy.ZooKeeperRoutePolicy.onExchangeBegin(ZooKeeperRoutePolicy.java:79) [camel-zookeeper-2.17.0.jar:2.17.0]
	at org.apache.camel.processor.CamelInternalProcessor$RoutePolicyAdvice.before(CamelInternalProcessor.java:483) [camel-core-2.17.0.jar:2.17.0]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It looks like it knows the znode doesn&#8217;t exist but seems to be unable to create it? From the zookeeper server side logs, I can see incoming connections and it returning the error that the znode doesn&#8217;t exist but doesn&#8217;t look like there&#8217;s any attempts to create it after that.&lt;/p&gt;

&lt;p&gt;I&#8217;ve tried using the zookeeper component directly in my route and I am able to create/write/read from a znode fine so it seems like it&#8217;s just failing in the route policy for some reason.&lt;/p&gt;

&lt;p&gt;I am using Camel 2.17.0 and zookeeper 3.4.8&lt;/p&gt;


&lt;p&gt;I&#8217;ve investigated this further and the exception is thrown from the ZooKeeper.create method. Camel is actually trying to create a znode with a path /regexTest1/192.168.202.25-25829641-de1f-4389-9bb6-2967ea60de1a without creating the parent node /regexTest1 first. &lt;/p&gt;

&lt;p&gt;According to the Zookeeper.create method documentation &lt;/p&gt;

&lt;p&gt;&quot;If the parent node does not exist in the ZooKeeper, a KeeperException&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;with error code KeeperException.NoNode will be thrown.&quot;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;And I don&#8217;t see anywhere in Camel&#8217;s code where it is creating the parent nodes first before attempting to create the final node for master election.&lt;/p&gt;

&lt;p&gt;So I removed the path off the uri for the route policy like this&lt;/p&gt;

&lt;p&gt;ZooKeeperRoutePolicy policy = new ZooKeeperRoutePolicy(&quot;zookeeper:localhost&quot;, 1);&lt;/p&gt;

&lt;p&gt;And it has gotten past that error but now has encountered a different error where it has trouble creating a threadpool.&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;2016-04-08 11:47:15,071 [main] ERROR org.apache.camel.component.zookeeper.policy.ZooKeeperElection - Error configuring ZookeeperElection
java.lang.IllegalArgumentException: id for thread pool org.apache.camel.util.concurrent.RejectableThreadPoolExecutor@1ec912d7[Running, pool size = 0, active threads = 0, queued tasks = 0, completed tasks = 0][Camel-Zookeeper Ops executor] must be specified and not empty
	at org.apache.camel.util.ObjectHelper.notEmpty(ObjectHelper.java:351) ~[camel-core-2.16.0.jar:2.16.0]
	at org.apache.camel.impl.DefaultExecutorServiceManager.onThreadPoolCreated(DefaultExecutorServiceManager.java:522) ~[camel-core-2.16.0.jar:2.16.0]
	at org.apache.camel.impl.DefaultExecutorServiceManager.newThreadPool(DefaultExecutorServiceManager.java:191) ~[camel-core-2.16.0.jar:2.16.0]
	at org.apache.camel.impl.DefaultExecutorServiceManager.newFixedThreadPool(DefaultExecutorServiceManager.java:230) ~[camel-core-2.16.0.jar:2.16.0]
	at org.apache.camel.component.zookeeper.ZooKeeperConsumer.doStart(ZooKeeperConsumer.java:72) ~[camel-zookeeper-2.16.0.jar:2.16.0]
	at org.apache.camel.support.ServiceSupport.start(ServiceSupport.java:61) ~[camel-core-2.16.0.jar:2.16.0]
	at org.apache.camel.impl.DefaultCamelContext.startService(DefaultCamelContext.java:3219) ~[camel-core-2.16.0.jar:2.16.0]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment>&lt;p&gt;mac&lt;/p&gt;</environment>
        <key id="12957576">CAMEL-9851</key>
            <summary>Zookeeper RoutePolicy failing to create znode</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="davsclaus">Claus Ibsen</assignee>
                                    <reporter username="mtran">Minh Tran</reporter>
                        <labels>
                    </labels>
                <created>Sun, 10 Apr 2016 23:39:40 +0000</created>
                <updated>Sun, 17 Apr 2016 22:59:10 +0000</updated>
                            <resolved>Fri, 15 Apr 2016 06:54:32 +0000</resolved>
                                    <version>2.17.0</version>
                                    <fixVersion>2.16.4</fixVersion>
                    <fixVersion>2.17.1</fixVersion>
                    <fixVersion>2.18.0</fixVersion>
                                    <component>camel-zookeeper</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="15242480" author="davsclaus" created="Fri, 15 Apr 2016 05:43:59 +0000"  >&lt;p&gt;The last stacktrace is with Camel 2.16.0. Can you make sure you use the same version eg 2.17.0&lt;/p&gt;</comment>
                            <comment id="15242492" author="davsclaus" created="Fri, 15 Apr 2016 06:03:58 +0000"  >&lt;p&gt;The other error is because there is no path. We would need to fix that in the consumer.&lt;/p&gt;</comment>
                            <comment id="15242545" author="davsclaus" created="Fri, 15 Apr 2016 06:54:32 +0000"  >&lt;p&gt;Thanks for reporting&lt;/p&gt;</comment>
                            <comment id="15244958" author="mtran" created="Sun, 17 Apr 2016 22:44:58 +0000"  >&lt;p&gt;&lt;del&gt;Just tried the fix in the snapshot and it works, thank you very much!&lt;/del&gt;&lt;/p&gt;

&lt;p&gt;Sorry that was premature, I wasn&apos;t using your fix. When I actually tried to use the snapshot it didn&apos;t work but I think it&apos;s because the Apache Maven snapshot repo is out of date (&lt;a href=&quot;https://repository.apache.org/content/repositories/snapshots/org/apache/camel/apache-camel/2.17-SNAPSHOT/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://repository.apache.org/content/repositories/snapshots/org/apache/camel/apache-camel/2.17-SNAPSHOT/&lt;/a&gt;)&lt;/p&gt;

&lt;p&gt;And I can&apos;t find an updated one. I&apos;ll just test this when it is released. Thanks for your help anyway.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 15 Apr 2016 05:43:59 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            32 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2vwmn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>