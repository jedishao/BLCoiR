<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sat Dec 03 01:53:32 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/CAMEL-3031/CAMEL-3031.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[CAMEL-3031] Auto assigned CamelContext id should be unique in the JVM</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-3031</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;See nabble&lt;br/&gt;
&lt;a href=&quot;http://camel.465427.n5.nabble.com/multiple-camel-contexts-as-viewed-from-JMX-tp2265902p2265902.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://camel.465427.n5.nabble.com/multiple-camel-contexts-as-viewed-from-JMX-tp2265902p2265902.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Route ids are being unique, so we should be able to do that for CamelContext id as well. And we should reject starting an application if an existing CamelContext exists with the same id. This applies to JMX.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12484839">CAMEL-3031</key>
            <summary>Auto assigned CamelContext id should be unique in the JVM</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="davsclaus">Claus Ibsen</assignee>
                                    <reporter username="davsclaus">Claus Ibsen</reporter>
                        <labels>
                    </labels>
                <created>Fri, 6 Aug 2010 05:42:41 +0000</created>
                <updated>Sun, 24 Apr 2011 09:58:08 +0000</updated>
                            <resolved>Sat, 7 Aug 2010 10:20:38 +0000</resolved>
                                                    <fixVersion>2.5.0</fixVersion>
                                    <component>camel-core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                            <comments>
                            <comment id="12946685" author="davsclaus" created="Fri, 6 Aug 2010 08:40:53 +0000"  >&lt;p&gt;I will implement a check which will fail starting a CamelContext if another context has been registered in JMX with the same ObjectName&lt;/p&gt;</comment>
                            <comment id="12948106" author="akarpe" created="Fri, 6 Aug 2010 19:05:12 +0000"  >&lt;p&gt;Hi Claus,&lt;/p&gt;

&lt;p&gt;This is a rather serious issue. I also verified that direct endpoints for camel contexts with the same context id in 2 different bundles cannot see each other. However they can indeed see each other using VM endpoints.&lt;/p&gt;

&lt;p&gt;It seems Camel creates 2 separate camel contexts ignoring the fact that they have the same context id. i would have thought Spring would not allow this to happen and would use an existing bean and not instantiate a fresh one if the id was the same. &lt;/p&gt;

&lt;p&gt;In JMX, however, Camel seems to lists both contexts against the same context id.&lt;/p&gt;

&lt;p&gt;Not sure whether the fix should be that the route should not be instantiated if a context already exists under the same name. I would hae thought Spring beahvior would be to automatically use the existing bean of the given id instead of failing. Also is a bundle the determinant for failure...?&lt;br/&gt;
Would this not be a problem then for applications that use Spring but not OSGi and do want to re-use the camel context...&lt;/p&gt;

&lt;p&gt;Is it not better to see if a context already exists and re-use it... ?&lt;/p&gt;

&lt;p&gt;Regards,&lt;/p&gt;

&lt;p&gt;Ashwin... &lt;/p&gt;</comment>
                            <comment id="12947150" author="akarpe" created="Fri, 6 Aug 2010 19:56:41 +0000"  >&lt;p&gt;Hi Claus,&lt;/p&gt;

&lt;p&gt;Ben and I are working on the same customer project where we ran into this issue. The version of Camel that the customer is using is Camel version 2.2. The deployment is on a FUSE OSGi container version 4.2.0&lt;/p&gt;

&lt;p&gt;Hope this helps.&lt;/p&gt;

&lt;p&gt;Cheers,&lt;/p&gt;

&lt;p&gt;Ashwin...&lt;/p&gt;
</comment>
                            <comment id="12949266" author="davsclaus" created="Sat, 7 Aug 2010 07:05:00 +0000"  >&lt;p&gt;When you define a &amp;lt;camelContext/&amp;gt; in a XML file, you have 2 choices&lt;br/&gt;
a) the id can be explicit given&lt;br/&gt;
b) no id given&lt;/p&gt;

&lt;p&gt;In the former case Camel will use this id as the bean id in Spring ApplicationContext and as well for JMX.&lt;br/&gt;
In the latter Camel will auto assign an unique id to be used in Spring ApplicationContext and as well for JMX.&lt;/p&gt;

&lt;p&gt;There are 2 problems with the current code&lt;/p&gt;

&lt;p&gt;1)&lt;br/&gt;
When registering a CamelContext in JMX, Camel would ignore if an existing CamelContext with the same id was already registered. This means that you would end up with 2 different CamelContext&apos;s merged into the same. This means you cannot manage the 2nd CamelContext, for example to stop it etc as it would not be enlisted. Also when the 1st is unregistered, you would leave mbeans &lt;em&gt;hanging&lt;/em&gt; in there for the 2nd which doensn&apos;t have a CamelContext etc.  Also there are problems with clashes of endpoint uris, error handlers, tracers etc.&lt;/p&gt;

&lt;p&gt;Bottom line we end up with mixed data. &lt;/p&gt;

&lt;p&gt;2)&lt;br/&gt;
In OSGi the auto assigned unique name is &lt;b&gt;not&lt;/b&gt; unique because OSGi causes the atomic counter to be multiple instances so you end up with Camel ids&apos; all being &lt;tt&gt;camel-1&lt;/tt&gt;. This works in non OSGi environments such as WARs etc.&lt;/p&gt;


&lt;p&gt;All these problems can of course be resolved by explicit assigning an unique id for you &amp;lt;camelContext&amp;gt;&apos;s.&lt;/p&gt;


&lt;p&gt;We will also try to enhance the auto assigned unique name in OSGi to include bundle id etc. so it brings more value for you. So if you bundle has given id 147, then the auto assigned id should be &lt;tt&gt;camel-147&lt;/tt&gt; etc.&lt;/p&gt;
</comment>
                            <comment id="12946601" author="davsclaus" created="Sat, 7 Aug 2010 07:08:14 +0000"  >&lt;blockquote&gt;
&lt;p&gt;Is it not better to see if a context already exists and re-use it... ?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;No a CamelContext should really be isolated and live by itself. And this should also be reflected in JMX.&lt;/p&gt;</comment>
                            <comment id="12945889" author="davsclaus" created="Sat, 7 Aug 2010 10:20:38 +0000"  >&lt;p&gt;trunk: 983197.&lt;/p&gt;</comment>
                            <comment id="12946482" author="njiang" created="Wed, 11 Aug 2010 02:57:05 +0000"  >&lt;p&gt;@Claus,&lt;/p&gt;

&lt;p&gt;I just didn&apos;t some test about camelContext name within the OSGi container,  I don&apos;t find the issue of static atomic counter which causes all the camel id end up with camel-1.&lt;br/&gt;
But I agree to add the bundle id in to the camelContext which will help user to find their camel context easily.&lt;/p&gt;
</comment>
                            <comment id="12946559" author="njiang" created="Wed, 11 Aug 2010 03:22:53 +0000"  >&lt;p&gt;I just found there are something wrong with the CamelContextFactoryBean&apos;s createCamelContext.&lt;br/&gt;
It will set the camelcontext id with id name which could be an implicit one, and it will override the OsgiCamelContextNameStratgy which an ExplicitCamelContextNameStratgy.&lt;/p&gt;

&lt;p&gt;So I made some change in the trunk: 984294&lt;/p&gt;</comment>
                            <comment id="13024074" author="davsclaus" created="Sun, 24 Apr 2011 09:58:08 +0000"  >&lt;p&gt;Closing all resolved tickets from 2010 or older&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                            <subtask id="12485251">CAMEL-3034</subtask>
                            <subtask id="12484620">CAMEL-3041</subtask>
                            <subtask id="12484614">CAMEL-3042</subtask>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 6 Aug 2010 19:05:12 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>76369</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 32 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i01s8f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>8343</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>