<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sat Dec 03 04:45:35 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/CAMEL-9567/CAMEL-9567.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[CAMEL-9567] SjmsConsumer does not suspend (on Camel context) stop</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-9567</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;When using SjmsConsumer that consumes JMS messages from broker (e.g. ActiveMQ) and &lt;b&gt;stop Camel Context, the consumer still reads new messages from broker&lt;/b&gt; even if it should only finish processing of already fetched messages. It causes that Context is never stopped if there are still new and new messages in the broker (or before timeout for stop operation occurs).&lt;/p&gt;

&lt;p&gt;When I investigated code, it seems that suspend operation is not implemented (or code does not check isSuspended flag). What I would expect is that consumer unregisters JMS listener on context stop (consumer suspend).&lt;/p&gt;

&lt;p&gt;Here is the sample code I used for testing:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; class Test {

    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void main(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] args) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
       &lt;span class=&quot;code-comment&quot;&gt;// pre-fill JMS Broker with many many messages, e.g. 10.000
&lt;/span&gt;
        RouteBuilder rb = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; RouteBuilder() {
            @Override
            &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void configure() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
                from(&lt;span class=&quot;code-quote&quot;&gt;&quot;sjms:queue:test?consumerCount=5&quot;&lt;/span&gt;)
                        .process(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Processor() {
                            @Override
                            &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void process(Exchange exchange) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
                                &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.sleep(1000); &lt;span class=&quot;code-comment&quot;&gt;// not to consume all messages instantly
&lt;/span&gt;                                &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;Processed message &quot;&lt;/span&gt; + exchange.getExchangeId());
                            }
                        });
            }
        };

        CamelContext context = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; DefaultCamelContext();
        context.getShutdownStrategy().setTimeout(1000); &lt;span class=&quot;code-comment&quot;&gt;// 1000s = big enough timeout so I can be sure it is consumer problem
&lt;/span&gt;        addJmsComponent(context);
        context.addRoutes(rb);

        &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;=====&amp;gt; Starting context&quot;&lt;/span&gt;);
        context.start();
        &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.sleep(5 * 1000); &lt;span class=&quot;code-comment&quot;&gt;// Consume few messages at the beginning
&lt;/span&gt;
        &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;=====&amp;gt; Stopping context&quot;&lt;/span&gt;);
        context.stop();
        &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;=====&amp;gt; Context stopped&quot;&lt;/span&gt;); &lt;span class=&quot;code-comment&quot;&gt;// Will not get here as &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; as there are any messages left in the queue
&lt;/span&gt;    }

    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void addJmsComponent(CamelContext context) {
        ConnectionFactory factory = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ActiveMQConnectionFactory(&lt;span class=&quot;code-quote&quot;&gt;&quot;tcp:&lt;span class=&quot;code-comment&quot;&gt;//localhost:61616&quot;&lt;/span&gt;); // ActiveMQ is easiest &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; testing &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;
&lt;/span&gt;        ConnectionFactoryResource connResource = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ConnectionFactoryResource(5, factory);
        SjmsComponent comp = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SjmsComponent();
        comp.setConnectionResource(connResource);
        context.addComponent(&lt;span class=&quot;code-quote&quot;&gt;&quot;sjms&quot;&lt;/span&gt;, comp);
    }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The original mailing list thread:&lt;br/&gt;
&lt;a href=&quot;http://camel.465427.n5.nabble.com/CamelContext-stop-with-SJMS-consumer-does-not-stop-consuming-messages-from-broker-td5777207.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://camel.465427.n5.nabble.com/CamelContext-stop-with-SJMS-consumer-does-not-stop-consuming-messages-from-broker-td5777207.html&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12936968">CAMEL-9567</key>
            <summary>SjmsConsumer does not suspend (on Camel context) stop</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="davsclaus">Claus Ibsen</assignee>
                                    <reporter username="d1x">Zden&#283;k Obst</reporter>
                        <labels>
                            <label>camel-sjms</label>
                    </labels>
                <created>Fri, 5 Feb 2016 07:21:32 +0000</created>
                <updated>Tue, 16 Feb 2016 08:14:12 +0000</updated>
                            <resolved>Tue, 16 Feb 2016 08:14:12 +0000</resolved>
                                    <version>2.16.2</version>
                                    <fixVersion>2.15.6</fixVersion>
                    <fixVersion>2.16.3</fixVersion>
                    <fixVersion>2.17.0</fixVersion>
                                    <component>camel-sjms</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="15134171" author="onurakdemir" created="Fri, 5 Feb 2016 13:32:12 +0000"  >&lt;p&gt;I started to work on this issue. &lt;/p&gt;</comment>
                            <comment id="15134179" author="davsclaus" created="Fri, 5 Feb 2016 13:39:13 +0000"  >&lt;p&gt;The doSuspend could call the stop logic, but it would be better if we can find a way like camel-jms, to stop the jms listener only, and keep the other bits running.&lt;/p&gt;</comment>
                            <comment id="15136772" author="d1x" created="Mon, 8 Feb 2016 10:03:52 +0000"  >&lt;p&gt;Do you have any rough estimation when this bug may be resolved?&lt;/p&gt;</comment>
                            <comment id="15136833" author="onurakdemir" created="Mon, 8 Feb 2016 11:25:40 +0000"  >&lt;p&gt;Sorry but it is hard to estimate because I try to get familiar with the&lt;br/&gt;
source code. What I know that I will start to work on the issue on Thursday.&lt;/p&gt;



</comment>
                            <comment id="15136844" author="d1x" created="Mon, 8 Feb 2016 11:48:12 +0000"  >&lt;p&gt;Ok, the information when you will start work on it is also useful - thank you &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="15137100" author="davsclaus" created="Mon, 8 Feb 2016 15:48:32 +0000"  >&lt;p&gt;We can a short-term fix for 2.16.x make doSuspend/doResume call the same logic as in doStart/doStop. &lt;/p&gt;

&lt;p&gt;I took a look at the source code and it wasn&apos;t easy to make the JmsListener suspend while keep other stuff running. That make take more work to figure our or maybe the component need some refactoring.&lt;/p&gt;

&lt;p&gt;And also &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-9577&quot; title=&quot;Only support suspension if a component has custom logic&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-9577&quot;&gt;&lt;del&gt;CAMEL-9577&lt;/del&gt;&lt;/a&gt; improves a general issue that we only call the suspend methods if the component has custom suspend code. Otherwise we would stop instead. As it turns out there is only about 20 or so components that has custom suspend logic.&lt;/p&gt;</comment>
                            <comment id="15137152" author="d1x" created="Mon, 8 Feb 2016 16:15:36 +0000"  >&lt;p&gt;Ok thank you very much for the info provided. I will have an eye on 9577 too.&lt;/p&gt;</comment>
                            <comment id="15137341" author="davsclaus" created="Mon, 8 Feb 2016 17:53:35 +0000"  >&lt;p&gt;I made a fix for 2.16 and 2.15&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/camel/commit/88dd249fe0aae965d7c9736e0911082f62efed16&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/apache/camel/commit/88dd249fe0aae965d7c9736e0911082f62efed16&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;From 2.17 onwards its fixed by that other &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-9577&quot; title=&quot;Only support suspension if a component has custom logic&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-9577&quot;&gt;&lt;del&gt;CAMEL-9577&lt;/del&gt;&lt;/a&gt; ticket.&lt;/p&gt;</comment>
                            <comment id="15137528" author="d1x" created="Mon, 8 Feb 2016 19:35:52 +0000"  >&lt;p&gt;Oh nice that was quick, thank you. I suppose it is now available only in SNAPSHOT version.&lt;br/&gt;
Do you have idea when you will release regular version?&lt;/p&gt;</comment>
                            <comment id="15138518" author="davsclaus" created="Tue, 9 Feb 2016 08:21:46 +0000"  >&lt;p&gt;We just released 2.16.2, so would take a month or so for the next. But maybe 2.15.x is released sooner.&lt;/p&gt;

&lt;p&gt;You can always build a local JAR with the patch and use that until there is a release.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12937504">CAMEL-9577</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 5 Feb 2016 13:32:12 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            42 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2sgqf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>