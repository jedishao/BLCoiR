<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sat Dec 03 04:49:48 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/CAMEL-7308/CAMEL-7308.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[CAMEL-7308] Timer component : timer should use StartupListener to be initialized before first fire</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-7308</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-5542&quot; title=&quot;Timer component - Should defer scheduling tasks during startup of CamelContext&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-5542&quot;&gt;&lt;del&gt;CAMEL-5542&lt;/del&gt;&lt;/a&gt; creates a regression for our routes when migrating from ServiceMix 4.4 to ServiceMix 4.5.&lt;br/&gt;
The secondary route in which we use this timer populates a cache, which must be initialized before other primary routes in the bundle can use it, otherwise requests sent to these other routes will generate errors.&lt;br/&gt;
In our ServiceMix installation with all the other bundles, the bundle with the timer can take from 1 second to 30 seconds to start-up, depending on the machine speed and the number of other bundles which are installed/started at the same time. &lt;br/&gt;
It is therefore very difficult to estimate the time to define for the &quot;delay&quot; variable. If set too low, the first fire will be ignored and the other primary routes will generate errors until the timer second fire. If set too high, the other primary routes will generate errors until the timer first fire. &lt;br/&gt;
Normally the timer period is set to refresh the cache every several minutes, which leaves a large window where requests end with an error in case the cache failed to initialize.&lt;br/&gt;
Here is a patch with a StartupListener which effectively reduces the window of errors to a fraction of a second.&lt;br/&gt;
Also, it would help to debug these kind of problems if a &quot;debug&quot; log is added when the first timer fire is ignored.&lt;/p&gt;</description>
                <environment>&lt;p&gt;ServiceMix 4.5.3&lt;/p&gt;</environment>
        <key id="12702123">CAMEL-7308</key>
            <summary>Timer component : timer should use StartupListener to be initialized before first fire</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="davsclaus">Claus Ibsen</assignee>
                                    <reporter username="metatech">metatech</reporter>
                        <labels>
                    </labels>
                <created>Tue, 18 Mar 2014 11:45:46 +0000</created>
                <updated>Mon, 24 Mar 2014 10:42:03 +0000</updated>
                            <resolved>Mon, 24 Mar 2014 10:42:03 +0000</resolved>
                                    <version>2.10.7</version>
                                    <fixVersion>2.12.4</fixVersion>
                    <fixVersion>2.13.1</fixVersion>
                    <fixVersion>2.14.0</fixVersion>
                                    <component>camel-core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="13941582" author="davsclaus" created="Thu, 20 Mar 2014 10:07:42 +0000"  >&lt;p&gt;Thanks for reporting and providing the patch.&lt;/p&gt;

&lt;p&gt;I modified the code a bit to have it work with the unit tests.&lt;/p&gt;</comment>
                            <comment id="13942927" author="metatech" created="Fri, 21 Mar 2014 10:05:02 +0000"  >&lt;p&gt;Hi Claus, thanks for your review.&lt;br/&gt;
Beware that I needed to remove the check for &quot;started&quot; in the &quot;isTaskAllowedToRun&quot; method, because the state is still &quot;starting&quot; at this point.&lt;br/&gt;
It can be seen in the method &quot;start&quot; of class &quot;ServiceSupport&quot; : &lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;firstly &quot;doStart&quot; is called, where the &quot;onCamelContextStarted&quot; is called.&lt;/li&gt;
	&lt;li&gt;secondly, &quot;started.set(true)&quot; is called.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;My observation was that there was a race condition : &lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if the &quot;scheduleAtFixedRate&quot; is very fast to run, the camel context is still in &quot;starting&quot; state.&lt;/li&gt;
	&lt;li&gt;if the &quot;scheduleAtFixedRate&quot; takes a few milliseconds longer to run, the camel context will enter the &quot;started&quot; state before.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Typically, the timer was fired when I was connected with my debugger and not fired without debugger, so I guess the race condition window is really small.&lt;/p&gt;</comment>
                            <comment id="13944907" author="davsclaus" created="Mon, 24 Mar 2014 10:41:58 +0000"  >&lt;p&gt;This works as designed with the startup listener.&lt;/p&gt;

&lt;p&gt;Your design to use a timer route to populate a cache is bad. You should just use a &amp;lt;bean&amp;gt; with a init method to do that.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12605050">CAMEL-5542</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12635286" name="camel_timer_startuplistener.diff" size="2151" author="metatech" created="Tue, 18 Mar 2014 11:46:45 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 20 Mar 2014 10:07:42 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>380463</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 36 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310041" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Patch Info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10042"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1tjxb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>380744</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310080" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Regression</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10091"><![CDATA[Regression]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>