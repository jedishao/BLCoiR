<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sat Dec 03 02:49:26 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/CAMEL-9288/CAMEL-9288.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[CAMEL-9288] Apache Camel Throttler component keeps rejecting trafffic in next slot if current slot threshold is reached and more requests received in current slot</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-9288</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>

&lt;p&gt;I have observed that apache-camel doesn&apos;t throttle the requests as expected when the rejectExecution(see below) is true&lt;/p&gt;

&lt;p&gt;&amp;lt;throttle timePeriodMillis=&quot;10000&quot; rejectExecution=&quot;true&quot;&amp;gt;&lt;br/&gt;
    &amp;lt;constant&amp;gt;4&amp;lt;/constant&amp;gt;&lt;br/&gt;
    &amp;lt;to uri=&quot;mock:result&quot;/&amp;gt;&lt;br/&gt;
&amp;lt;/throttle&amp;gt;&lt;/p&gt;

&lt;p&gt;Following is code snippet from org.apache.camel.processor.Throttle class&lt;/p&gt;

&lt;p&gt;    protected long calculateDelay(Exchange exchange) {&lt;br/&gt;
    ......&lt;br/&gt;
    TimeSlot slot = nextSlot();&lt;br/&gt;
            if (!slot.isActive()) &lt;/p&gt;
{
                long delay = slot.startTime - currentSystemTime();
                return delay;
            }
&lt;p&gt; else &lt;/p&gt;
{
                return 0;
            }
&lt;p&gt;    }&lt;/p&gt;


&lt;p&gt;/*&lt;br/&gt;
 *Determine what the next available time slot is for handling an Exchange&lt;br/&gt;
 */&lt;br/&gt;
protected synchronized TimeSlot nextSlot() {&lt;br/&gt;
    if (slot == null) &lt;/p&gt;
{
        slot = new TimeSlot();
    }
&lt;p&gt;    if (slot.isFull() || !slot.isPast()) &lt;/p&gt;
{
        slot = slot.next();
    }
&lt;p&gt;    slot.assign();&lt;br/&gt;
    return slot;&lt;br/&gt;
}&lt;/p&gt;

&lt;p&gt;As per above snippet whenever a slot is full and a new request arrives, then a new slot beginning after the current slot is created and slot.assign() is invoked to reduce the capacity of this newly created slot to accommodate current request which according to me is faulty as there will be a delay in processing this new request and as per the Throttler code whenever there is a delay and rejectExecution = true a org.apache.camel.processor.ThrottlerRejectedExecutionException is thrown. It&apos;s obvious that even though the Throttler component is rejecting the new request after the threshold is reached still it is reducing the capacity of the next slot which will allow one less request to be processed in the next slot rather than the same number as of previous slot.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12910285">CAMEL-9288</key>
            <summary>Apache Camel Throttler component keeps rejecting trafffic in next slot if current slot threshold is reached and more requests received in current slot</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="3">Duplicate</resolution>
                                        <assignee username="davsclaus">Claus Ibsen</assignee>
                                    <reporter username="Dev Singh">Devendra Pratap Singh</reporter>
                        <labels>
                    </labels>
                <created>Wed, 4 Nov 2015 09:13:43 +0000</created>
                <updated>Thu, 5 Nov 2015 11:53:40 +0000</updated>
                            <resolved>Thu, 5 Nov 2015 11:53:40 +0000</resolved>
                                    <version>2.14.0</version>
                    <version>2.14.1</version>
                    <version>2.14.2</version>
                    <version>2.14.3</version>
                                    <fixVersion>2.16.0</fixVersion>
                                    <component>camel-core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="14991571" author="davsclaus" created="Thu, 5 Nov 2015 11:53:40 +0000"  >&lt;p&gt;See &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-9184&quot; title=&quot;Throttler: Rejected message whe rejectExecution=true&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-9184&quot;&gt;&lt;del&gt;CAMEL-9184&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 5 Nov 2015 11:53:40 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311020" key="com.atlassian.jira.plugin.system.customfieldtypes:url">
                        <customfieldname>External issue URL</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[http://stackoverflow.com/questions/33500956/apparent-bug-in-apache-camel-throttler-component]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 4 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2nxgn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310080" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Regression</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10091"><![CDATA[Regression]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>