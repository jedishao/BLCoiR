<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sat Dec 03 04:19:56 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/CAMEL-8424/CAMEL-8424.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[CAMEL-8424] Transaction being propagated ignoring REQUIRES_NEW when using direct component</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-8424</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;I found that when we are using exactly same propagation policy bean in different routes used together with &quot;direct&quot; component, then TransactionErrorHandler always propagates current transaction even if our policy is &quot;PROPAGATION_REQUIRES_NEW&quot;.&lt;/p&gt;

&lt;p&gt;The failing code is:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; TransactionErrorHandler(CamelContext camelContext, Processor output, CamelLogger logger, 
            Processor redeliveryProcessor, RedeliveryPolicy redeliveryPolicy, ExceptionPolicyStrategy exceptionPolicyStrategy,
            TransactionTemplate transactionTemplate, Predicate retryWhile, ScheduledExecutorService executorService,
            LoggingLevel rollbackLoggingLevel) {

        &lt;span class=&quot;code-keyword&quot;&gt;super&lt;/span&gt;(camelContext, output, logger, redeliveryProcessor, redeliveryPolicy, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, retryWhile, executorService);
        setExceptionPolicy(exceptionPolicyStrategy);
        &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.transactionTemplate = transactionTemplate;
        &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.rollbackLoggingLevel = rollbackLoggingLevel;
        &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.transactionKey = ObjectHelper.getIdentityHashCode(transactionTemplate);
    }

    @Override
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void process(Exchange exchange) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
        &lt;span class=&quot;code-comment&quot;&gt;// we have to run &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; synchronously as Spring Transaction does *not* support
&lt;/span&gt;        &lt;span class=&quot;code-comment&quot;&gt;// using multiple threads to span a transaction
&lt;/span&gt;        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (exchange.getUnitOfWork().isTransactedBy(transactionKey)) {
            &lt;span class=&quot;code-comment&quot;&gt;// already transacted by &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; transaction template
&lt;/span&gt;            &lt;span class=&quot;code-comment&quot;&gt;// so lets just let the error handler process it
&lt;/span&gt;            processByErrorHandler(exchange);
        } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
            &lt;span class=&quot;code-comment&quot;&gt;// not yet wrapped in transaction so lets &lt;span class=&quot;code-keyword&quot;&gt;do&lt;/span&gt; that
&lt;/span&gt;            &lt;span class=&quot;code-comment&quot;&gt;// and then have it invoke the error handler from within that transaction
&lt;/span&gt;            processInTransaction(exchange);
        }
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;So then for each policy there is a hash code created, which then is used to verify whether current route is already transacted by this transaction policy.&lt;br/&gt;
This makes &quot;PROPAGATION_REQUIRES_NEW&quot; ignored when used with &quot;direct&quot; component.&lt;/p&gt;

&lt;p&gt;So for example:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
                from(&lt;span class=&quot;code-quote&quot;&gt;&quot;activemq:queue:start&quot;&lt;/span&gt;).routeId(&lt;span class=&quot;code-quote&quot;&gt;&quot;route1&quot;&lt;/span&gt;)
                        .transacted(&lt;span class=&quot;code-quote&quot;&gt;&quot;PROPAGATION_REQUIRES_NEW&quot;&lt;/span&gt;)
                        .setExchangePattern(ExchangePattern.InOnly)
                        .to(&lt;span class=&quot;code-quote&quot;&gt;&quot;activemq:queue:result1&quot;&lt;/span&gt;)
                        .to(&lt;span class=&quot;code-quote&quot;&gt;&quot;direct:route2&quot;&lt;/span&gt;)
                        .throwException(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; RuntimeException(&lt;span class=&quot;code-quote&quot;&gt;&quot;Expected!&quot;&lt;/span&gt;));

                from(&lt;span class=&quot;code-quote&quot;&gt;&quot;direct:route2&quot;&lt;/span&gt;).routeId(&lt;span class=&quot;code-quote&quot;&gt;&quot;route2&quot;&lt;/span&gt;)
                        .transacted(&lt;span class=&quot;code-quote&quot;&gt;&quot;PROPAGATION_REQUIRES_NEW&quot;&lt;/span&gt;)
                        .setExchangePattern(ExchangePattern.InOnly)
                        .to(&lt;span class=&quot;code-quote&quot;&gt;&quot;activemq:queue:result2&quot;&lt;/span&gt;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The above route suppose to work in 2 different transactions, as our propagation is REQUIRES_NEW for both of them. But due to hash code verification and optimisation, route2 will participate in same transaction as route1 instead of new.&lt;br/&gt;
This is rather buggy.&lt;/p&gt;

&lt;p&gt;Will create pull request in minutes.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12778803">CAMEL-8424</key>
            <summary>Transaction being propagated ignoring REQUIRES_NEW when using direct component</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="davsclaus">Claus Ibsen</assignee>
                                    <reporter username="nannou9">Piotr Klimczak</reporter>
                        <labels>
                    </labels>
                <created>Mon, 2 Mar 2015 17:35:45 +0000</created>
                <updated>Wed, 4 Mar 2015 06:51:36 +0000</updated>
                            <resolved>Mon, 2 Mar 2015 18:32:40 +0000</resolved>
                                    <version>2.10.7</version>
                    <version>2.11.4</version>
                    <version>2.13.3</version>
                    <version>2.14.1</version>
                    <version>2.15.0</version>
                                    <fixVersion>2.13.4</fixVersion>
                    <fixVersion>2.14.2</fixVersion>
                    <fixVersion>2.15.0</fixVersion>
                                    <component>camel-spring</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="14343453" author="githubbot" created="Mon, 2 Mar 2015 17:50:44 +0000"  >&lt;p&gt;GitHub user PiotrKlimczak opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/camel/pull/416&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/apache/camel/pull/416&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-8424&quot; title=&quot;Transaction being propagated ignoring REQUIRES_NEW when using direct component&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-8424&quot;&gt;&lt;del&gt;CAMEL-8424&lt;/del&gt;&lt;/a&gt; Fixed transaction propagated when requires new&lt;/p&gt;



&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/PiotrKlimczak/camel&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/PiotrKlimczak/camel&lt;/a&gt; master&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/camel/pull/416.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/apache/camel/pull/416.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #416&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 7344ff80f7d14523d148d13859746cf5cf5ea0bc&lt;br/&gt;
Author: Piotr Klimczak &amp;lt;klimczakp@quindell.com&amp;gt;&lt;br/&gt;
Date:   2015-03-02T17:49:49Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-8424&quot; title=&quot;Transaction being propagated ignoring REQUIRES_NEW when using direct component&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-8424&quot;&gt;&lt;del&gt;CAMEL-8424&lt;/del&gt;&lt;/a&gt; Fixed transaction propagated when requires new&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="14343480" author="davsclaus" created="Mon, 2 Mar 2015 17:59:00 +0000"  >&lt;p&gt;Thanks for reporting and the PR - just in time for the new 2.15.0&lt;/p&gt;</comment>
                            <comment id="14344852" author="githubbot" created="Tue, 3 Mar 2015 09:59:41 +0000"  >&lt;p&gt;Github user PiotrKlimczak closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/camel/pull/416&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/apache/camel/pull/416&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 2 Mar 2015 17:50:44 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 39 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310041" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Patch Info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10042"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i268zr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>