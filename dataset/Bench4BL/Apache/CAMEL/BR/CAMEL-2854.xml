<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sat Dec 03 02:25:56 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/CAMEL-2854/CAMEL-2854.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[CAMEL-2854] No consumers available on &quot;direct://xyz&quot; endpoint</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-2854</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;The following warning in log4j log shows up with no predictable reason:&lt;/p&gt;

&lt;p&gt;2010-06-24 14:07:01,090  WARN &lt;span class=&quot;error&quot;&gt;&amp;#91;DefaultMessageListenerContainer-7:DirectProducer.java:42&amp;#93;&lt;/span&gt; No consumers available on endpoint: Endpoint&lt;span class=&quot;error&quot;&gt;&amp;#91;direct://UserCancelJobRequest&amp;#93;&lt;/span&gt; to process: Exchange[JmsMessage: RunnerBase&lt;/p&gt;
{locationToRunId=&apos;DV02YcABTE43HTRPATEGCBFk0m0&apos;, jobrun_id=1234, requestOrigId=&apos;null&apos;, secretKey=&apos;null&apos;, replyToQueueOrTopic=&apos;null&apos;, corrolationId=&apos;null&apos;, requestCreationTime=Thu Jun 24 14:07:01 PDT 2010}
&lt;p&gt;]&lt;/p&gt;

&lt;p&gt;The endpoint &lt;span class=&quot;error&quot;&gt;&amp;#91;direct://UserCancelJobRequest&amp;#93;&lt;/span&gt; could be a number of different endpoints in our application and all of them are of &quot;direct:&quot; type.  When this happens, all messages that run through that endpoint will fail, and it will never recover unless the application is restarted.&lt;/p&gt;

&lt;p&gt;Also, if I restart the application and use that route immediately, that warning will not occur and the request will finish successfully.  It seems to happen to routes that have not been used for a while after startup.&lt;/p&gt;

&lt;p&gt;When this happens, I can find the exact Camel endpoint/route/processor in JConsole, and nothing seems to be wrong.  How can a &quot;direct:&quot; endpoint runs out of consumer?  Isn&apos;t the thread that product this warning THE thread to process the message?&lt;/p&gt;

&lt;p&gt;We recently upgraded from 5.2 to 5.3.2 and this starts to show up randomly. It is a show stopper!&lt;/p&gt;

&lt;p&gt;--Michael&lt;/p&gt;</description>
                <environment>&lt;p&gt;ActiveMQ 5.3.2 / Camel 2.2.0&lt;/p&gt;</environment>
        <key id="12486289">CAMEL-2854</key>
            <summary>No consumers available on &quot;direct://xyz&quot; endpoint</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.png">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="davsclaus">Claus Ibsen</assignee>
                                    <reporter username="mwc_tonesoft">Michael Chen</reporter>
                        <labels>
                    </labels>
                <created>Thu, 24 Jun 2010 23:47:08 +0000</created>
                <updated>Sun, 24 Apr 2011 10:01:25 +0000</updated>
                            <resolved>Tue, 29 Jun 2010 09:20:11 +0000</resolved>
                                    <version>2.2.0</version>
                                    <fixVersion>2.4.0</fixVersion>
                                    <component>camel-core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12954730" author="njiang" created="Fri, 25 Jun 2010 09:37:02 +0000"  >&lt;p&gt;What&apos;s your route looks like ?&lt;br/&gt;
Did you do some thing to start or stop the route which has the direct endpoints ?&lt;/p&gt;</comment>
                            <comment id="12955781" author="mwc_tonesoft" created="Fri, 25 Jun 2010 17:03:03 +0000"  >&lt;p&gt;No, we never explicitly start or stop any endpoint. We only rely on the route-builder to setup the routes during startup.&lt;/p&gt;

&lt;p&gt;We do have some cases where the endpoint is &quot;obtained&quot; during run-time and added to the route-slip. Still we never start or stop any endpoint.&lt;/p&gt;

&lt;p&gt;My colleague discovered that in one instance, we hold on to the reference of an endpoint and got the same warning. It turns out Camel context has a little LRUCache that discards older endpoint instances. We fixed that one place, but it still does not explain all other instances of this problem.&lt;/p&gt;</comment>
                            <comment id="12955756" author="hadrian" created="Fri, 25 Jun 2010 21:05:04 +0000"  >&lt;p&gt;Michael, if there is a problem, we&apos;ll fix it, but it&apos;s not clear what you&apos;re doing.&lt;/p&gt;

&lt;p&gt;If you have a route that starts with;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
from(&lt;span class=&quot;code-quote&quot;&gt;&quot;direct:UserCancelJobRequest&quot;&lt;/span&gt;).[...]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;then you will have a consumer for that direct endpoint. So it looks to me that you don&apos;t have such a route and hence no such consumer, yet you try to send messages to such an endpoint from another route using something like:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
from(some-endpoint-probably-jms).[...].to(&lt;span class=&quot;code-quote&quot;&gt;&quot;direct:UserCancelJobRequest&quot;&lt;/span&gt;)[...];
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;My guess though is that you are actually using camel embedded in activemq and your activemq upgrade from 5.2.0 to 5.3.2 caused an upgrade of camel from 1.5.0 to 2.2.0. There are slight changes in camel 2.x, including the dsl syntax, that you should take a look at. I am fairly certain that your route syntax is not totally right with camel 2.2.0. &lt;/p&gt;

&lt;p&gt;I hope this helps. Showing us your route or posting a unit test will allow us understand what&apos;s going on and help you better. If you have concerns about posting things that may be proprietary to your organization you could also ask for help on the &lt;a href=&quot;http://camel.apache.org/irc-room.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;#camel irc channel&lt;/a&gt;.&lt;/p&gt;
</comment>
                            <comment id="12955691" author="mwc_tonesoft" created="Mon, 28 Jun 2010 15:48:31 +0000"  >&lt;p&gt;As I said before, the route DOES WORK &amp;#8211; most of the time. Therefore, there is no issue of spelling or Camel syntax.&lt;/p&gt;

&lt;p&gt;If I can reliably reproduce this problem with a simple unit-test, then I can debug into the Camel code and tell you exactly what this bug is.&lt;/p&gt;

&lt;p&gt;Unfortunately, the &quot;most of the time&quot; part makes it difficult to reproduce. Also, as I mentioned before, when it does NOT work, I can find and confirm that the route DOES exist and DOES have a consumer in JConsole, even though the warning says otherwise.&lt;/p&gt;

&lt;p&gt;Have you look into what I said about Camel&apos;s LRUcache? I hope a second look from folks familiar with the code can come up with some educated guess.&lt;/p&gt;

&lt;p&gt;Thanks&lt;/p&gt;

&lt;p&gt;--Michael&lt;/p&gt;</comment>
                            <comment id="12955033" author="davsclaus" created="Tue, 29 Jun 2010 06:49:02 +0000"  >&lt;p&gt;Michael&lt;/p&gt;

&lt;p&gt;Do you send messages to a lot of different Camel endpoints? For example do you use any of the dynamic EIP patterns such as recipient list or routing slip.&lt;br/&gt;
And when the issue happens, is that after a long period without sending messages to that given endpoint?&lt;/p&gt;

&lt;p&gt;Do you have other direct endpoints at the same time working?&lt;/p&gt;

&lt;p&gt;How many routes do you have in your application? And can you see a lot of endpoints listed in JConsole?&lt;/p&gt;</comment>
                            <comment id="12954478" author="davsclaus" created="Tue, 29 Jun 2010 06:57:54 +0000"  >&lt;p&gt;And can you attach the route which fails?&lt;/p&gt;</comment>
                            <comment id="12954877" author="davsclaus" created="Tue, 29 Jun 2010 07:01:43 +0000"  >&lt;p&gt;And can you attach the route which consumes as well?&lt;/p&gt;

&lt;p&gt;And this route is not stopped in any way? The code will when its stopped, remove itself as consumer on the endpoint, and the reason why the producer then says there are no consumers.&lt;/p&gt;</comment>
                            <comment id="12954351" author="davsclaus" created="Tue, 29 Jun 2010 07:10:40 +0000"  >&lt;p&gt;Okay I have reproduced a litte unit test&lt;/p&gt;</comment>
                            <comment id="12954509" author="davsclaus" created="Tue, 29 Jun 2010 09:20:11 +0000"  >&lt;p&gt;Fixed the issue.&lt;/p&gt;

&lt;p&gt;trunk: 958893.&lt;/p&gt;

&lt;p&gt;A workaround for you would be to use multiple CamelContext&apos;s if possible to reduce the chance of hitting this issue in Camel 2.2.&lt;/p&gt;</comment>
                            <comment id="12955488" author="mwc_tonesoft" created="Tue, 29 Jun 2010 16:31:10 +0000"  >

&lt;p&gt;Yes, we have pervasive use of dynamically constructed routing slip.&lt;/p&gt;




&lt;p&gt;Yes, it seems so. As I mentioned before, if you restart the app and run the&lt;br/&gt;
same route immediately, the problem does NOT occur as before.&lt;/p&gt;



&lt;p&gt;Yes, most of them works, including the ones that have problems most of the&lt;br/&gt;
time.&lt;/p&gt;



&lt;p&gt;We have close to 140 endpoints.&lt;/p&gt;

&lt;p&gt;I see that you created a unit test. May I have that unit test?  Would you&lt;br/&gt;
please also explain the bug in more detail?&lt;/p&gt;

&lt;p&gt;Thank you&lt;/p&gt;

&lt;p&gt;--Michael&lt;/p&gt;</comment>
                            <comment id="12954569" author="davsclaus" created="Tue, 29 Jun 2010 16:37:13 +0000"  >&lt;p&gt;I have put the rev number in the comment so you can find the commit log and the unit test etc.&lt;/p&gt;</comment>
                            <comment id="12954596" author="davsclaus" created="Tue, 29 Jun 2010 16:37:47 +0000"  >&lt;p&gt;See source here&lt;br/&gt;
&lt;a href=&quot;http://svn.apache.org/viewvc/camel/trunk/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewvc/camel/trunk/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12954648" author="davsclaus" created="Tue, 29 Jun 2010 16:38:31 +0000"  >&lt;p&gt;Ah and the Fisheye tab in JIRA also works, just click it to see the code changes.&lt;/p&gt;</comment>
                            <comment id="12955596" author="davsclaus" created="Tue, 29 Jun 2010 16:40:14 +0000"  >&lt;p&gt;The issue was how Camel kept the list of active direct consumers on the endpoint, and not on the component.&lt;br/&gt;
Then if that endpoint was evicted from the LRUCache (due not used in long time) that link to the consumer would be lost.&lt;br/&gt;
And then you hit that &lt;tt&gt;No consumers ...&lt;/tt&gt; warning.&lt;/p&gt;

&lt;p&gt;By keeping it around all the time on the component we can always lookup the active consumers.&lt;/p&gt;

&lt;p&gt;And the warning have been changed into thrown an exception so your app logic can catch it, eg rollback etc.&lt;/p&gt;</comment>
                            <comment id="12955263" author="mwc_tonesoft" created="Tue, 29 Jun 2010 16:44:16 +0000"  >&lt;p&gt;Claus,&lt;/p&gt;

&lt;p&gt;This is not a fix. How did a &quot;direct:&quot; route lose its consumer in the first&lt;br/&gt;
place?  It&apos;s like a Java program cannot call a method it has previously&lt;br/&gt;
called successfully.  The fix should be on that issue. Otherwise, it is&lt;br/&gt;
still a fatal run-time error.&lt;/p&gt;

&lt;p&gt;BTW, I found the unit test in source control.&lt;/p&gt;

&lt;p&gt;--Michael&lt;/p&gt;


</comment>
                            <comment id="12955397" author="mwc_tonesoft" created="Tue, 29 Jun 2010 16:48:07 +0000"  >&lt;p&gt;Claus,&lt;/p&gt;

&lt;p&gt;Revision 958852 you submitted only contains the throwing exception change. I don&apos;t see the &quot;By keeping it around all the time on the component we can always lookup the active consumers&quot; part in the fix.  Do you mean user code has to do that?&lt;/p&gt;

&lt;p&gt;Thanks&lt;/p&gt;

&lt;p&gt;--Michael&lt;/p&gt;</comment>
                            <comment id="12955446" author="davsclaus" created="Tue, 29 Jun 2010 17:02:44 +0000"  >&lt;p&gt;You may not know Camel that well to question the fix.&lt;/p&gt;

&lt;p&gt;The Java compiler will link method invocations at compile time, so its hardcoded in the byte code.&lt;/p&gt;

&lt;p&gt;There is no Camel compiler, so Camel will link the routes at runtime. After all you define the endpoints using String (eg uris).&lt;br/&gt;
So it have to figure out this at runtime. And thus its &lt;b&gt;not hardcoded in the bytecode&lt;/b&gt; and it can in fact loose the &lt;em&gt;link&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;And I would suggest that you take the time to look into the fix, apply the patches on your system and test it before ranting.&lt;/p&gt;</comment>
                            <comment id="12954688" author="davsclaus" created="Tue, 29 Jun 2010 17:04:51 +0000"  >&lt;p&gt;Lowering the priority to critical as&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;the app can run, it &lt;b&gt;unfortunately&lt;/b&gt; have to be restarted to fix the issue on his end.&lt;/li&gt;
	&lt;li&gt;and by not using a lot of dynamic endpoints you wont hit this issue.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;A blocker is something that you can&apos;t work around at all.&lt;/p&gt;</comment>
                            <comment id="12955152" author="mwc_tonesoft" created="Tue, 29 Jun 2010 17:28:08 +0000"  >&lt;p&gt;I have no disrespect towards you.&lt;/p&gt;

&lt;p&gt;Your fix does not prevent the &quot;No consumer...&quot; condition from happening. Agree? You also said,&lt;/p&gt;

&lt;p&gt;  &quot;By keeping it around all the time on the component we can always lookup the active consumers.&quot;&lt;/p&gt;

&lt;p&gt;How do I accomplish that without applying major changes like using multiple Camel context?&lt;/p&gt;

&lt;p&gt;If there is a limit on the total number of endpoints, then it should be documented. If this is related to the LRCcache, then can I increase the cache size?&lt;/p&gt;

&lt;p&gt;Thanks&lt;/p&gt;

&lt;p&gt;--Michael&lt;/p&gt;</comment>
                            <comment id="12955533" author="mwc_tonesoft" created="Tue, 29 Jun 2010 21:07:59 +0000"  >&lt;p&gt;Here how the route is built:&lt;/p&gt;

&lt;p&gt;    from(&quot;direct:UserCancelJobRequest&quot;).process(new Processor() {&lt;br/&gt;
            public void process(Exchange exchange) throws Exception &lt;/p&gt;
{
                ....
            }
&lt;p&gt;        }).&lt;br/&gt;
        to(&quot;direct:JobRunInstanceUpdate&quot;). ...&lt;/p&gt;

&lt;p&gt;We use dynamically constructed routing slip or template to send messages to the &quot;direct:UserCancelJobRequest&quot; endpoint.&lt;/p&gt;

&lt;p&gt;There should always be consumers for this. Otherwise Camel would be to unpredictable to use. That is the real bug that needs to be fixed.&lt;/p&gt;

&lt;p&gt;Thanks&lt;/p&gt;

&lt;p&gt;--Michael&lt;/p&gt;</comment>
                            <comment id="12955747" author="davsclaus" created="Wed, 30 Jun 2010 04:03:43 +0000"  >&lt;p&gt;Yes it fixes the issue.&lt;/p&gt;

&lt;p&gt;See the source code&lt;br/&gt;
&lt;a href=&quot;https://svn.apache.org/repos/asf/camel/trunk/camel-core/src/main/java/org/apache/camel/component/direct/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/repos/asf/camel/trunk/camel-core/src/main/java/org/apache/camel/component/direct/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12955748" author="davsclaus" created="Wed, 30 Jun 2010 04:08:43 +0000"  >&lt;p&gt;The LRUCache cannot be changed.&lt;br/&gt;
The endpoints should be safe to re-create again. And the cache keeps preventing having Camel hooking up memory when end users uses many different endpoints.&lt;br/&gt;
So it keep the last 1000 endpoints around in the cache.&lt;/p&gt;

&lt;p&gt;Its just the direct component which had an issue, storing state on the endpoint. Which should have been stored on the component instead.&lt;br/&gt;
The seda component works this way btw.&lt;/p&gt;
</comment>
                            <comment id="12954557" author="davsclaus" created="Wed, 30 Jun 2010 06:14:35 +0000"  >&lt;p&gt;The unit test is here&lt;br/&gt;
&lt;a href=&quot;https://svn.apache.org/repos/asf/camel/trunk/camel-core/src/test/java/org/apache/camel/component/direct/SendingToAlotOfDifferentDirectEndpointTest.java&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://svn.apache.org/repos/asf/camel/trunk/camel-core/src/test/java/org/apache/camel/component/direct/SendingToAlotOfDifferentDirectEndpointTest.java&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;You can run it on 2.2 and see it should fail. And then on trunk to see it pass.&lt;/p&gt;</comment>
                            <comment id="13024479" author="davsclaus" created="Sun, 24 Apr 2011 10:01:25 +0000"  >&lt;p&gt;Closing all resolved tickets from 2010 or older&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                            <outwardlinks description="depends upon">
                                        <issuelink>
            <issuekey id="12486179">CAMEL-2873</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 25 Jun 2010 09:37:02 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>76411</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 32 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i01r53:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>8166</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>