<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sat Dec 03 03:13:22 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/CAMEL-8667/CAMEL-8667.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[CAMEL-8667] java.lang.NullPointerException CamelSpringTestContextLoader.java:174</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-8667</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;I am getting a NPE with camel spring unit testing.  I am trying to convert &lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/camel/blob/master/components/camel-bindy/src/test/java/org/apache/camel/dataformat/bindy/fixed/unmarshall/simple/trim/BindySimpleFixedLengthUnmarshallTest.java&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/apache/camel/blob/master/components/camel-bindy/src/test/java/org/apache/camel/dataformat/bindy/fixed/unmarshall/simple/trim/BindySimpleFixedLengthUnmarshallTest.java&lt;/a&gt; &lt;/p&gt;

&lt;p&gt;to pure annotations ... and I am getting a NPE ... &lt;/p&gt;

&lt;p&gt;I am using:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
@ContextConfiguration()
@RunWith(SpringJUnit4ClassRunner.class)
@BoostrapWith(CamelTestContextBootstrapper.class)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Here is my stack trace.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Caused by: java.lang.NullPointerException: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; 
at org.apache.camel.test.spring.CamelSpringTestContextLoader.cleanup(CamelSpringTestContextLoader.java:174)
at org.apache.camel.test.spring.CamelSpringTestContextLoader.loadContext(CamelSpringTestContextLoader.java:86) 
at org.springframework.test.context.DefaultCacheAwareContextLoaderDelegate.loadContextInternal(DefaultCacheAwareContextLoaderDelegate.java:68)
at org.springframework.test.context.DefaultCacheAwareContextLoaderDelegate.loadContext(DefaultCacheAwareContextLoaderDelegate.java:86)
at org.springframework.test.context.DefaultTestContext.getApplicationContext(DefaultTestContext.java:72)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The unit test is attached.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12822111">CAMEL-8667</key>
            <summary>java.lang.NullPointerException CamelSpringTestContextLoader.java:174</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="hekonsek">Henryk Konsek</assignee>
                                    <reporter username="chrislovecnm">Chris Love</reporter>
                        <labels>
                    </labels>
                <created>Sat, 18 Apr 2015 23:24:04 +0000</created>
                <updated>Wed, 19 Aug 2015 07:02:20 +0000</updated>
                            <resolved>Wed, 19 Aug 2015 07:02:20 +0000</resolved>
                                    <version>2.15.1</version>
                                    <fixVersion>2.15.3</fixVersion>
                    <fixVersion>2.16.0</fixVersion>
                                    <component>camel-spring</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>7</watches>
                                                                <comments>
                            <comment id="14501641" author="chrislovecnm" created="Sun, 19 Apr 2015 00:20:41 +0000"  >&lt;p&gt;I am tracing this back to&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; CamelSpringTestHelper.getTestClass();  &lt;span class=&quot;code-comment&quot;&gt;// Line 472 CamelSpringTestContextLoader&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Is coming back as a null. &lt;/p&gt;

&lt;p&gt;Here is the testClazz.get() in CamelSpringTestHelper.java:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; ThreadLocal&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;&amp;lt;?&amp;gt;&amp;gt; testClazz = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ThreadLocal&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;&amp;lt;?&amp;gt;&amp;gt;();

&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;&amp;lt;?&amp;gt; getTestClass() {
  &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; testClazz.get(); &lt;span class=&quot;code-comment&quot;&gt;// returning &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
&lt;/span&gt;}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Thanks&lt;/p&gt;

&lt;p&gt;Chris&lt;/p&gt;</comment>
                            <comment id="14501643" author="chrislovecnm" created="Sun, 19 Apr 2015 00:21:58 +0000"  >&lt;p&gt;I have uploaded a copy of the unit test that is throwing a NPE&lt;/p&gt;</comment>
                            <comment id="14501644" author="chrislovecnm" created="Sun, 19 Apr 2015 00:27:06 +0000"  >&lt;p&gt;Missed java version:&lt;/p&gt;

&lt;p&gt;java version &quot;1.8.0_11&quot;&lt;br/&gt;
Java(TM) SE Runtime Environment (build 1.8.0_11-b12)&lt;br/&gt;
Java HotSpot(TM) 64-Bit Server VM (build 25.11-b03, mixed mode)&lt;/p&gt;

&lt;p&gt;And OS:&lt;/p&gt;

&lt;p&gt;Linux 3.16.5-gentoo #2 SMP Mon Dec 1 13:18:03 MST 2014 x86_64 Intel(R) Core(TM) i7-3740QM CPU @ 2.70GHz GenuineIntel GNU/Linux&lt;/p&gt;</comment>
                            <comment id="14501703" author="davsclaus" created="Sun, 19 Apr 2015 06:04:33 +0000"  >&lt;p&gt;Thanks for reporting. &lt;/p&gt;</comment>
                            <comment id="14501704" author="davsclaus" created="Sun, 19 Apr 2015 06:06:02 +0000"  >&lt;p&gt;Chris are you working on a patch?&lt;/p&gt;

&lt;p&gt;We love contributions and anyone is welcome to try to fix this. Seems like a good candidate if you fancy trying to work on the Camel code and provide patches.&lt;br/&gt;
&lt;a href=&quot;http://camel.apache.org/contributing.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://camel.apache.org/contributing.html&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14502367" author="chrislovecnm" created="Mon, 20 Apr 2015 05:14:48 +0000"  >&lt;p&gt;Claus you don&apos;t want me coding threads &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; I will let one of your gurus take a look at it. Thanks for the offer. So much code to write too little time &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="14503191" author="chrislovecnm" created="Mon, 20 Apr 2015 16:58:07 +0000"  >&lt;p&gt;Providing some more information.  I am using a spring boot application, and able to run the unit test by using:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
@RunWith(SpringJUnit4ClassRunner.class)
@SpringApplicationConfiguration(classes = Application.class)
@BootstrapWith(CamelTestContextBootstrapper.class)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;But that starts all of the camel routes, which is not preferable for unit testing.&lt;/p&gt;</comment>
                            <comment id="14504113" author="nkukhar" created="Tue, 21 Apr 2015 01:23:45 +0000"  >&lt;p&gt;Hi Chris,&lt;/p&gt;

&lt;p&gt;Could you please attach to this issue other files that are required to run your test (like DailyWeatherDataBean)?&lt;/p&gt;

</comment>
                            <comment id="14505535" author="chrislovecnm" created="Tue, 21 Apr 2015 19:05:24 +0000"  >&lt;p&gt;I would love to except is it closed source &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; &lt;/p&gt;

&lt;p&gt;One thought would be to migrate &lt;a href=&quot;https://github.com/apache/camel/blob/master/components/camel-bindy/src/test/java/org/apache/camel/dataformat/bindy/fixed/unmarshall/simple/trimfield/BindySimpleFixedLengthUnmarshallTrimFieldTest.java&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/apache/camel/blob/master/components/camel-bindy/src/test/java/org/apache/camel/dataformat/bindy/fixed/unmarshall/simple/trimfield/BindySimpleFixedLengthUnmarshallTrimFieldTest.java&lt;/a&gt; to using annotations.  Basically the same test that I am doing, just a custom pojo.&lt;/p&gt;</comment>
                            <comment id="14505719" author="hekonsek" created="Tue, 21 Apr 2015 20:44:52 +0000"  >&lt;p&gt;if this is Spring Boot related, then let me take it form this point forward. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="14505733" author="chrislovecnm" created="Tue, 21 Apr 2015 20:51:21 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hekonsek&quot; class=&quot;user-hover&quot; rel=&quot;hekonsek&quot;&gt;Henryk Konsek&lt;/a&gt; I am uncertain if it is Spring Boot, but I am trying to use a pure annotation driven unit test inside of a spring boot project.  Only want to load a camel context and spring context ... Not all of Spring Boot, because then I get all of the routes that spring boot sees ... I am probably just trying to create a mess &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/tongue.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;So if I am doing this oddly, please give me more docs on how to do it &apos;correctly&apos; ... but I am pretty sure that I found a NPE as well.&lt;/p&gt;

&lt;p&gt;Guys ... APPRECIATED ... love me some camel coding &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;As I mentioned, the unit test runs when using:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
@RunWith(SpringJUnit4ClassRunner.class)
@SpringApplicationConfiguration(classes = WeatherApplication.class)
@BootstrapWith(CamelTestContextBootstrapper.class)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And refering to the Bindy unit test: &lt;a href=&quot;https://github.com/apache/camel/blob/master/components/camel-bindy/src/test/java/org/apache/camel/dataformat/bindy/fixed/unmarshall/simple/trimfield/BindySimpleFixedLengthUnmarshallTrimFieldTest.java&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/apache/camel/blob/master/components/camel-bindy/src/test/java/org/apache/camel/dataformat/bindy/fixed/unmarshall/simple/trimfield/BindySimpleFixedLengthUnmarshallTrimFieldTest.java&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I externalized the following route builder into a &apos;@Service&apos; that is in another class in /src/test/java &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
 &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; class ContextConfig &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; RouteBuilder {
        BindyFixedLengthDataFormat camelDataFormat = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; BindyFixedLengthDataFormat(&lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.camel.dataformat.bindy.fixed.unmarshall.simple.trimfield&quot;&lt;/span&gt;);

        &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void configure() {
            from(URI_DIRECT_START).unmarshal(camelDataFormat).to(URI_MOCK_RESULT);
        }

    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14619212" author="jordan.armstrong" created="Wed, 8 Jul 2015 19:26:05 +0000"  >&lt;p&gt;I just ran into this issue and found this via google. The issue is with the documentation. The documentation at &lt;a href=&quot;http://camel.apache.org/spring-testing.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;Spring Testing&lt;/a&gt; says to use &lt;tt&gt;@RunWith(SpringJUnit4ClassRunner.class)&lt;/tt&gt;, but it should be &lt;tt&gt;@RunWith(CamelSpringJUnit4ClassRunner.class)&lt;/tt&gt;. When using &lt;tt&gt;SpringJUnit4ClassRunner&lt;/tt&gt; the method &lt;tt&gt;CamelSpringTestHelper.setTestClass&lt;/tt&gt; never gets called.&lt;/p&gt;

&lt;p&gt;For a working example see &lt;a href=&quot;https://github.com/apache/camel/blob/master/components/camel-spring-javaconfig/src/test/java/org/apache/camel/spring/javaconfig/test/CamelSpringDelegatingTestContextLoaderTest.java&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;CamelSpringDelegatingTestContextLoaderTest&lt;/a&gt;. It&apos;s not using the &lt;tt&gt;@Bootstrap&lt;/tt&gt; annotation, instead using the loader param for &lt;tt&gt;@ContextConfiguration&lt;/tt&gt;, but the effect is the same.&lt;/p&gt;</comment>
                            <comment id="14619340" author="jordan.armstrong" created="Wed, 8 Jul 2015 20:46:06 +0000"  >&lt;p&gt;Just a note that not all of the documentation is wrong. Just the section &quot;Plain Spring Test using JUnit 4.1.x Runner with XML Config&quot;. It&apos;s not possible to use the plain Spring test runner with &lt;tt&gt;CamelTestContextBootstrapper&lt;/tt&gt;. Persumably if &lt;tt&gt;CamelSpringTestHelper.setTestClass(testClass);&lt;/tt&gt; was added to the &lt;tt&gt;CamelSpringTestContextLoader.loadContext&lt;/tt&gt; method it might work, although you may run into other issues.&lt;/p&gt;</comment>
                            <comment id="14651798" author="stijn.van.bael" created="Mon, 3 Aug 2015 12:24:11 +0000"  >&lt;p&gt;Ran into the same issue, please correct the docs at &lt;a href=&quot;http://camel.apache.org/spring-testing.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://camel.apache.org/spring-testing.html&lt;/a&gt;, section &quot;Plain Spring Test using JUnit 4.1.x Runner with XML Config&quot;&lt;/p&gt;</comment>
                            <comment id="14693390" author="davidkarlsen@gmail.com" created="Wed, 12 Aug 2015 12:13:31 +0000"  >&lt;p&gt;I fixed it in rev v.39 of that wiki page - wait a bit for the static site pages to be generated and then I think this issue can be closed.&lt;/p&gt;</comment>
                            <comment id="14702615" author="davsclaus" created="Wed, 19 Aug 2015 07:02:20 +0000"  >&lt;p&gt;Thanks David for the wiki page update&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12726411" name="DailyWeatherDataBeanUnmarshallTest.java" size="2845" author="chrislovecnm" created="Sun, 19 Apr 2015 00:21:58 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sun, 19 Apr 2015 06:04:33 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10061"><![CDATA[Novice]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 15 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2dfzb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>