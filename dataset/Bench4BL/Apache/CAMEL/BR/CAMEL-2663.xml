<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sat Dec 03 01:32:26 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/CAMEL-2663/CAMEL-2663.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[CAMEL-2663] DefaultPackageScanClassResolver can&apos;t read entries in an eclipse rcp app because it can&apos;t handle bundleresource - protocol</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-2663</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;scenario:&lt;/p&gt;

&lt;p&gt;I have an eclipse rcp based app and use the apache camel libs within my plugin, i.e. the libs are one classpath of the plugin. I use a route using camel-mail to process some mailqueues.&lt;/p&gt;

&lt;p&gt;CamelContext context = new DefaultCamelContext();&lt;br/&gt;
context.addRoutes(new RouteBuilder() {&lt;br/&gt;
    public void configure()	{&lt;br/&gt;
        from(&quot;imaps://mailserver?username=user&amp;amp;password=password&amp;amp;consumer.delay=5000&amp;amp;delete=false&amp;amp;unseen=true&quot;)&lt;br/&gt;
            .to(&quot;log: new mail&quot;);&lt;br/&gt;
   }});&lt;br/&gt;
   context.start();&lt;/p&gt;

&lt;p&gt;When I start my app all seems to be ok. But in my log I get a lot of error messages regarding the loading of converters. If I ask my context to find a converter f.i. to converty to byte[] form inputstream (as I did see in another mail example reagding attachments) I get null because the context can&apos;t find one.&lt;/p&gt;

&lt;p&gt;I debugged  deeper into the camel code and it seems that the DefaultPackageScanClassResolver can&apos;t load from urls starting with bundleresource like &quot;bundleresource://109.fwk32380043:4/org/apache/camel/component/file/&quot;&lt;/p&gt;

&lt;p&gt;using camel-osgi didn&apos;t worked because all camel libs are loaded as inner libs of my single plugin and not as plugins. (loading as plugins didn&apos;t worked but thats another problem/bug)&lt;/p&gt;


&lt;p&gt;LOG Messages:&lt;/p&gt;

&lt;p&gt;2010-04-21 11:15:34,829 DEBUG org.apache.camel.impl.converter.DefaultTypeConverter loadTypeConverters - Loading type converters ...&lt;br/&gt;
2010-04-21 11:15:34,829 DEBUG org.apache.camel.impl.DefaultPackageScanClassResolver findAnnotated - Searching for annotations of org.apache.camel.Converter in packages: &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.camel.component.file, org.apache.camel.component.bean, org.apache.camel.converter, org.apache.camel.component.mail, org.apache.camel.component.spring.integration.converter&amp;#93;&lt;/span&gt;&lt;br/&gt;
2010-04-21 11:15:34,829 DEBUG org.apache.camel.impl.DefaultPackageScanClassResolver getClassLoaders - The thread context class loader: org.eclipse.core.runtime.internal.adaptor.ContextFinder@1a76eff  is used to load the class&lt;br/&gt;
2010-04-21 11:15:34,829 DEBUG org.apache.camel.impl.DefaultPackageScanClassResolver find - Searching for: annotated with @Converter in package: org/apache/camel/component/file using classloader: org.eclipse.core.runtime.internal.adaptor.ContextFinder&lt;br/&gt;
2010-04-21 11:15:39,954 DEBUG org.apache.camel.impl.DefaultPackageScanClassResolver getResources - Getting resource URL for package: org/apache/camel/component/file with classloader: org.eclipse.core.runtime.internal.adaptor.ContextFinder@1a76eff&lt;br/&gt;
2010-04-21 11:16:44,970 DEBUG org.apache.camel.impl.DefaultPackageScanClassResolver find - URL from classloader: bundleresource://109.fwk32380043:4/org/apache/camel/component/file/&lt;br/&gt;
2010-04-21 11:17:01,642 DEBUG org.apache.camel.impl.DefaultPackageScanClassResolver find - Decoded urlPath: /org/apache/camel/component/file/ with protocol: bundleresource&lt;br/&gt;
2010-04-21 11:23:59,814 DEBUG org.apache.camel.impl.DefaultPackageScanClassResolver find - isLocalFileSystem: false&lt;br/&gt;
2010-04-21 11:24:00,470 DEBUG org.apache.camel.impl.DefaultPackageScanClassResolver find - Scanning for classes in &lt;span class=&quot;error&quot;&gt;&amp;#91;/org/apache/camel/component/file/&amp;#93;&lt;/span&gt; matching criteria: annotated with @Converter&lt;br/&gt;
2010-04-21 11:24:16,079 DEBUG org.apache.camel.impl.DefaultPackageScanClassResolver find - Loading from jar using http/https: /org/apache/camel/component/file/&lt;br/&gt;
2010-04-21 11:24:26,626 DEBUG org.apache.camel.impl.DefaultPackageScanClassResolver find - Cannot read entries in url: bundleresource://109.fwk32380043:4/org/apache/camel/component/file/&lt;br/&gt;
java.net.MalformedURLException: no protocol: /org/apache/camel/component/file/&lt;br/&gt;
	at java.net.URL.&amp;lt;init&amp;gt;(URL.java:567)&lt;br/&gt;
	at java.net.URL.&amp;lt;init&amp;gt;(URL.java:464)&lt;br/&gt;
	at java.net.URL.&amp;lt;init&amp;gt;(URL.java:413)&lt;br/&gt;
	at org.apache.camel.impl.DefaultPackageScanClassResolver.find(DefaultPackageScanClassResolver.java:264)&lt;br/&gt;
	at org.apache.camel.impl.DefaultPackageScanClassResolver.find(DefaultPackageScanClassResolver.java:180)&lt;br/&gt;
	at org.apache.camel.impl.DefaultPackageScanClassResolver.findAnnotated(DefaultPackageScanClassResolver.java:100)&lt;br/&gt;
	at org.apache.camel.impl.converter.AnnotationTypeConverterLoader.load(AnnotationTypeConverterLoader.java:63)&lt;br/&gt;
	at org.apache.camel.impl.converter.DefaultTypeConverter.loadTypeConverters(DefaultTypeConverter.java:361)&lt;br/&gt;
	at org.apache.camel.impl.converter.DefaultTypeConverter.doStart(DefaultTypeConverter.java:384)&lt;br/&gt;
	at org.apache.camel.impl.ServiceSupport.start(ServiceSupport.java:53)&lt;br/&gt;
	at org.apache.camel.util.ServiceHelper.startService(ServiceHelper.java:49)&lt;br/&gt;
	at org.apache.camel.impl.DefaultCamelContext.startServices(DefaultCamelContext.java:1174)&lt;br/&gt;
	at org.apache.camel.impl.DefaultCamelContext.addService(DefaultCamelContext.java:644)&lt;br/&gt;
	at org.apache.camel.impl.DefaultCamelContext.getTypeConverter(DefaultCamelContext.java:691)&lt;br/&gt;
	at org.apache.camel.util.CamelContextHelper.convertTo(CamelContextHelper.java:68)&lt;/p&gt;</description>
                <environment>&lt;p&gt;Windows, Eclipse 3.5.2&lt;/p&gt;</environment>
        <key id="12487328">CAMEL-2663</key>
            <summary>DefaultPackageScanClassResolver can&apos;t read entries in an eclipse rcp app because it can&apos;t handle bundleresource - protocol</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="njiang">Willem Jiang</assignee>
                                    <reporter username="cdittberner">Christoph Dittberner</reporter>
                        <labels>
                    </labels>
                <created>Wed, 21 Apr 2010 10:21:23 +0000</created>
                <updated>Sun, 24 Apr 2011 10:01:04 +0000</updated>
                            <resolved>Fri, 7 May 2010 07:18:32 +0000</resolved>
                                    <version>2.2.0</version>
                                    <fixVersion>2.3.0</fixVersion>
                                    <component>camel-core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12955656" author="cdittberner" created="Thu, 22 Apr 2010 08:49:23 +0000"  >&lt;p&gt;Finally I got it working &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;URLs starting with protocol &quot;bundleresource&quot; have to be converted into a real url using org.eclipse.core.runtime.FileLocator.resolve(url). &lt;/p&gt;

&lt;p&gt;So I made my own EclispePackageScanClassResolver adding the converter-call in find(PackageScanFilter test, String packageName, ClassLoader loader, Set&amp;lt;Class&amp;lt;?&amp;gt;&amp;gt; classes).&lt;/p&gt;

&lt;p&gt;see attached file&lt;/p&gt;</comment>
                            <comment id="12955673" author="davsclaus" created="Thu, 22 Apr 2010 08:52:43 +0000"  >&lt;p&gt;Hi Christoph&lt;/p&gt;

&lt;p&gt;That is great&lt;/p&gt;

&lt;p&gt;See about pluggable class resolvers here&lt;br/&gt;
&lt;a href=&quot;http://camel.apache.org/pluggable-class-resolvers.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://camel.apache.org/pluggable-class-resolvers.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;What we may can do is to add a new camel-eclipsercp component which provides this class resolver.&lt;br/&gt;
What .jar / jars do you need to use?&lt;/p&gt;

&lt;p&gt;And I assume those jars has an open source license, such as Apache or Eclipse based?&lt;br/&gt;
If so we can have it included out of the box at Apache. If not (as in JBoss case) is has to be hosted elsewhere such as camel-extra&lt;br/&gt;
&lt;a href=&quot;http://code.google.com/p/camel-extra/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://code.google.com/p/camel-extra/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Or at github etc.&lt;/p&gt;</comment>
                            <comment id="12955684" author="cdittberner" created="Thu, 22 Apr 2010 08:53:14 +0000"  >&lt;p&gt;Attach this on the DefaultcamelContext like&lt;/p&gt;

&lt;p&gt;DefaultCamelContext camelContext = new DefaultCamelContext();&lt;br/&gt;
camelContext.setPackageScanClassResolver(new EclipsePackageScanClassResolver());&lt;/p&gt;

&lt;p&gt;and apache-camel can be used within an eclipse-plugin.&lt;/p&gt;</comment>
                            <comment id="12955692" author="davsclaus" created="Thu, 22 Apr 2010 09:03:19 +0000"  >&lt;p&gt;Its based on EPL license, which is in B category&lt;br/&gt;
&lt;a href=&quot;http://www.apache.org/legal/3party.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://www.apache.org/legal/3party.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;However the source code where its being used will be minimal and with really very very low change some end user will derive this work without knowing the license implications by Eclipse.&lt;/p&gt;

&lt;p&gt;And the jar is &lt;br/&gt;
&lt;a href=&quot;http://repo1.maven.org/maven2/org/eclipse/equinox/common/3.3.0-v20070426/common-3.3.0-v20070426.pom&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://repo1.maven.org/maven2/org/eclipse/equinox/common/3.3.0-v20070426/common-3.3.0-v20070426.pom&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Which is in central maven repo, so it may be doable.&lt;/p&gt;</comment>
                            <comment id="12955698" author="cdittberner" created="Thu, 22 Apr 2010 09:04:25 +0000"  >&lt;p&gt;A camel-eclipse package sounds very well.&lt;/p&gt;

&lt;p&gt;My plugin depends on &lt;br/&gt;
 org.eclipse.osgi,&lt;br/&gt;
 org.eclipse.equinox.app,&lt;/p&gt;

&lt;p&gt;To use the FileLocator.convert-method I had to depend on  org.eclipse.equinox.common,&lt;/p&gt;

&lt;p&gt;These are the libs I included in my plugin:&lt;br/&gt;
camel-core-2.2.0.jar&lt;br/&gt;
camel-spring-2.2.0.jar&lt;br/&gt;
camel-spring-integration-2.2.0.jar&lt;br/&gt;
commons-management-1.0.jar&lt;br/&gt;
camel-mail-2.2.0.jar&lt;br/&gt;
mail.jar&lt;br/&gt;
spring.jar&lt;/p&gt;

&lt;p&gt;spring.jar is the complete spring-framework-2.5.6 package.&lt;/p&gt;
</comment>
                            <comment id="12955699" author="davsclaus" created="Thu, 22 Apr 2010 09:08:57 +0000"  >&lt;p&gt;We should just use the common jar. And have it defined as &lt;b&gt;provided&lt;/b&gt; in the pom.xml.&lt;/p&gt;

&lt;p&gt;As its expected the runtime have all the needed jars already. So all you add to is this camel-eclipse jar&lt;/p&gt;</comment>
                            <comment id="12955700" author="davsclaus" created="Thu, 22 Apr 2010 09:11:18 +0000"  >&lt;p&gt;And I think we may need to just add a little strategy method on the DefaultPackageScanClassResolver so you can reuse as much code from it.&lt;br/&gt;
As all you do is that if its that bundlelocator type then you use the FileLocator. All the rest looks like its 100% the same.&lt;/p&gt;

&lt;p&gt;Otherwise we end up having to have them in sync, and that will never work. &lt;/p&gt;</comment>
                            <comment id="12955719" author="njiang" created="Thu, 22 Apr 2010 09:33:25 +0000"  >&lt;p&gt;+1 as Claus said. &lt;br/&gt;
We already have lots of PackageScanClassResolvers, it&apos;s time to clean up the duplicate codes &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="12955940" author="njiang" created="Fri, 7 May 2010 07:18:32 +0000"  >&lt;p&gt;Created a camel-eclipse component for this resolver.&lt;/p&gt;</comment>
                            <comment id="13024359" author="davsclaus" created="Sun, 24 Apr 2011 10:01:04 +0000"  >&lt;p&gt;Closing all resolved tickets from 2010 or older&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12463237" name="EclipsePackageScanClassResolver.java" size="8439" author="cdittberner" created="Thu, 22 Apr 2010 08:53:14 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 22 Apr 2010 08:52:43 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>76467</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 32 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i01pyn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>7975</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>