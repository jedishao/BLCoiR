<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sat Dec 03 05:02:33 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/CAMEL-8201/CAMEL-8201.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[CAMEL-8201] NPE with language:ruby and concurrentConsumers </title>
                <link>https://issues.apache.org/jira/browse/CAMEL-8201</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;See &lt;a href=&quot;http://camel.465427.n5.nabble.com/NPE-with-language-ruby-and-concurrentConsumers-td5759703.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://camel.465427.n5.nabble.com/NPE-with-language-ruby-and-concurrentConsumers-td5759703.html&lt;/a&gt; for details.&lt;/p&gt;

&lt;p&gt;By running git bisect, it reports the first bad commit was:&lt;/p&gt;

&lt;p&gt;f66375e91e2755e956c1527752c255aa2d0f8c42 is the first bad commit&lt;br/&gt;
commit f66375e91e2755e956c1527752c255aa2d0f8c42&lt;br/&gt;
Author: Willem Jiang &amp;lt;ningjiang@apache.org&amp;gt;&lt;br/&gt;
Date:   Fri Jul 26 16:46:50 2013 +0800&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-6559&quot; title=&quot;script builder synchronized the operation of evaluateScript&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-6559&quot;&gt;&lt;del&gt;CAMEL-6559&lt;/del&gt;&lt;/a&gt; fixed the script builder synchronized the operation of evaluateScript issue&lt;/p&gt;

&lt;p&gt;:040000 040000 148db9cc9e521c7951be27c1416c7218880d10cf 5f55cbb6798f9a0f8477348708360a7a09a98f5e M	components&lt;/p&gt;</description>
                <environment></environment>
        <key id="12764375">CAMEL-8201</key>
            <summary>NPE with language:ruby and concurrentConsumers </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="muellerc">Christian M&#252;ller</assignee>
                                    <reporter username="muellerc">Christian M&#252;ller</reporter>
                        <labels>
                    </labels>
                <created>Wed, 31 Dec 2014 11:00:32 +0000</created>
                <updated>Sat, 28 Feb 2015 11:31:42 +0000</updated>
                            <resolved>Sat, 28 Feb 2015 09:21:53 +0000</resolved>
                                    <version>2.12.5</version>
                    <version>2.13.3</version>
                    <version>2.14.1</version>
                                    <fixVersion>2.15.0</fixVersion>
                                    <component>camel-script</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="14262104" author="muellerc" created="Wed, 31 Dec 2014 11:02:30 +0000"  >&lt;p&gt;The unit test I was using during the git bisect test.&lt;/p&gt;</comment>
                            <comment id="14262159" author="muellerc" created="Wed, 31 Dec 2014 13:11:52 +0000"  >&lt;p&gt;By updating the route as following:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;        return new RouteBuilder() {
            public void configure() throws Exception {
                getContext().getProperties().put(Exchange.REUSE_SCRIPT_ENGINE, &quot;true&quot;);
                getContext().getProperties().put(Exchange.COMPILE_SCRIPT, &quot;true&quot;);

                from(&quot;seda:jruby?concurrentConsumers=5&quot;)
                    .to(&quot;language:ruby:puts $request.body;result = $request.body?cacheScript=true&quot;)
                    .to(resultEndpoint);
            }
        };
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I could run the test without any errors with the same performance (1500ms). May this is the solution you are looking for.&lt;/p&gt;

&lt;p&gt;However, I will have a look and check why it&apos;s not working if we don&apos;t cache the script...&lt;/p&gt;</comment>
                            <comment id="14262212" author="njiang" created="Wed, 31 Dec 2014 14:38:14 +0000"  >&lt;p&gt;Hi Christian,&lt;/p&gt;

&lt;p&gt;If the cacheScript option is false (default setting), camel language just create a new scriptbuilder per exchange due to &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-7143&quot; title=&quot;camel-groovy - Evaluation returns 1st result only&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-7143&quot;&gt;&lt;del&gt;CAMEL-7143&lt;/del&gt;&lt;/a&gt;, as the scriptbuilder create a new script factory that could introduce the performance and concurrency issues. &lt;/p&gt;

&lt;p&gt;The patch of &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-8188&quot; title=&quot;Support to configure the scripte engine from CamelContext propertes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-8188&quot;&gt;&lt;del&gt;CAMEL-8188&lt;/del&gt;&lt;/a&gt; addressed the issue of &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-8201&quot; title=&quot;NPE with language:ruby and concurrentConsumers &quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-8201&quot;&gt;&lt;del&gt;CAMEL-8201&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Regards,&lt;br/&gt;
Willem&lt;/p&gt;</comment>
                            <comment id="14262215" author="muellerc" created="Wed, 31 Dec 2014 14:45:30 +0000"  >&lt;p&gt;If we don&apos;t use &quot;cacheScript=true&quot;, for each Exchange a new &quot;org.apache.camel.builder.script.ScriptBuilder&quot; with a new &quot;javax.script.ScriptEngine&quot; is created, even if we are using &quot;context.getProperties().put(Exchange.REUSE_SCRIPT_ENGINE, &quot;true&quot;);&quot;&lt;br/&gt;
This is very inefficient.&lt;/p&gt;</comment>
                            <comment id="14262231" author="muellerc" created="Wed, 31 Dec 2014 15:08:06 +0000"  >&lt;p&gt;And if we don&apos;t use &quot;getContext().getProperties().put(Exchange.REUSE_SCRIPT_ENGINE, &quot;true&quot;)&quot; in the route mentioned before, we see exceptions like:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;NoMethodError: undefined method `body&apos; for nil:NilClass
  (root) at &amp;lt;script&amp;gt;:1
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;By using multiple JRuby ScriptEngines in a single JVM, we have to set the system property &quot;org.jruby.embed.localcontext.scope&quot; to &quot;threadsafe&quot; as mentioned here: &lt;a href=&quot;https://kenai.com/projects/jruby-embed/pages/Home&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://kenai.com/projects/jruby-embed/pages/Home&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12763918">CAMEL-8188</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12689669" name="RubyScriptTextTest.java" size="1475" author="muellerc" created="Wed, 31 Dec 2014 11:02:29 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 31 Dec 2014 14:38:14 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 48 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i23vnb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>