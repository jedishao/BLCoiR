<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sat Dec 03 05:22:21 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/CAMEL-7973/CAMEL-7973.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[CAMEL-7973] CircuitBreakerLoadBalancer fails on async processors</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-7973</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;The CircuitBreakerLoadBalancer works fine on direct synchronous processor, but it seems to not behave as expected in case of async processor.&lt;/p&gt;

&lt;p&gt;To reproduce the error, it&apos;s enough to add a .threads(1) before the mock processor in the CircuitBreakerLoadBalancerTest routeBuilder configuration.&lt;/p&gt;

&lt;p&gt;This misbehaviour seems to be related to the use of the AsyncProcessorConverterHelper to force any processor to behave like asynchronous. &lt;/p&gt;

&lt;p&gt;I&apos;m going to propose a patch with the failing test and a proposal of solution.&lt;/p&gt;

&lt;p&gt;EDIT:&lt;/p&gt;

&lt;p&gt;the patch contains the fix also to other unexpected behaviour of the CircuitBreaker.&lt;/p&gt;

&lt;p&gt;The second problem addressed is that, after the opening of the circuit, the RejectedExecutionException raised by the circuit breaker is set in the Exchange, but it doesn&apos;t return. This cause the processor will receive the Exchange even if the circuit is open. In this case also, if the CircuitBreaker is instructed to react only to specific Exception, it will close the circuit after the following request, because the raised exception would be a RejectedExecutionException instead of the one specified in the configuration.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12750785">CAMEL-7973</key>
            <summary>CircuitBreakerLoadBalancer fails on async processors</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="njiang">Willem Jiang</assignee>
                                    <reporter username="Matteo Pavesi">Matteo Pavesi</reporter>
                        <labels>
                    </labels>
                <created>Mon, 27 Oct 2014 15:02:10 +0000</created>
                <updated>Thu, 30 Oct 2014 10:52:06 +0000</updated>
                            <resolved>Thu, 30 Oct 2014 09:09:35 +0000</resolved>
                                    <version>2.14.0</version>
                                    <fixVersion>2.14.1</fixVersion>
                    <fixVersion>2.15.0</fixVersion>
                                    <component>camel-core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="14185291" author="matteo pavesi" created="Mon, 27 Oct 2014 16:10:36 +0000"  >&lt;p&gt;Added patches (based on branch 2.14.x) containing failing test and proposed solution.&lt;/p&gt;</comment>
                            <comment id="14189740" author="davsclaus" created="Thu, 30 Oct 2014 07:24:18 +0000"  >&lt;p&gt;Willem the patch is partly correct, eg the stuff about the exception etc. But calling the processor should be the async with the callback, eg the last part of the patch is not correct. That may need a bit more logic to implement correctly, as you may need to add logic in the callback to do after work in the circuit breaker. I have not yet taken a closer look, but just beware more work is likely needed to fix this properly.&lt;/p&gt;</comment>
                            <comment id="14189791" author="njiang" created="Thu, 30 Oct 2014 08:15:39 +0000"  >&lt;p&gt;Hi,Claus.  &lt;br/&gt;
Yes, we cannot just call the process method there. I&apos;m working on it to add the async processing code &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="14189829" author="njiang" created="Thu, 30 Oct 2014 09:09:35 +0000"  >&lt;p&gt;Applied the patch into camel master ,camel 2.14.x with thanks to Matteo. I also changed the patch by adding callback to check the failed exchange.&lt;/p&gt;</comment>
                            <comment id="14189924" author="matteo pavesi" created="Thu, 30 Oct 2014 10:52:06 +0000"  >&lt;p&gt;Thanks for the interest in this issue and for the quick change. I&apos;ve also learned something from the fix to my patch &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310010">
                    <name>Incorporates</name>
                                                                <inwardlinks description="is part of">
                                        <issuelink>
            <issuekey id="12604834">CAMEL-5539</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12677323" name="0001-CAMEL-7973-added-failing-test-for-circuit-breaker-wi.patch" size="5616" author="Matteo Pavesi" created="Mon, 27 Oct 2014 16:10:36 +0000"/>
                            <attachment id="12677324" name="0002-CAMEL-7973-fix-circuit-breaker-with-async-processors.patch" size="2484" author="Matteo Pavesi" created="Mon, 27 Oct 2014 16:10:36 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 30 Oct 2014 07:24:18 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10062"><![CDATA[Moderate]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 5 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i21m9b:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>