<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sat Dec 03 05:10:08 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/CAMEL-2496/CAMEL-2496.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[CAMEL-2496] StreamCache/Splitter race condition</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-2496</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;Attached patch introduces a test that shows the following symptom:&lt;/p&gt;

&lt;p&gt;org.apache.camel.RuntimeCamelException: java.io.FileNotFoundException: /var/folders/vC/vCA487MkHEeSaIu9LmlkrU+++TI/&lt;del&gt;Tmp&lt;/del&gt;/camel-tmp-627613/cos3755307044377901165.tmp (No such file or directory)&lt;br/&gt;
org.apache.camel.RuntimeCamelException: java.io.FileNotFoundException: /var/folders/vC/vCA487MkHEeSaIu9LmlkrU+++TI/&lt;del&gt;Tmp&lt;/del&gt;/camel-tmp-627613/cos3755307044377901165.tmp (No such file or directory)&lt;br/&gt;
	at org.apache.camel.converter.stream.FileInputStreamCache.reset(FileInputStreamCache.java:52)&lt;br/&gt;
	at org.apache.camel.converter.stream.StreamCacheConverter$StreamSourceCache.reset(StreamCacheConverter.java:126)&lt;br/&gt;
	at org.apache.camel.util.MessageHelper.resetStreamCache(MessageHelper.java:105)&lt;br/&gt;
	at org.apache.camel.builder.xml.XPathBuilder.getDocument(XPathBuilder.java:548)&lt;br/&gt;
	at org.apache.camel.builder.xml.XPathBuilder.evaluateAs(XPathBuilder.java:428)&lt;br/&gt;
	at org.apache.camel.builder.xml.XPathBuilder.evaluate(XPathBuilder.java:118)&lt;br/&gt;
	at org.apache.camel.processor.Splitter.createProcessorExchangePairs(Splitter.java:72)&lt;br/&gt;
	at org.apache.camel.processor.MulticastProcessor.process(MulticastProcessor.java:155)&lt;br/&gt;
	at org.apache.camel.management.InstrumentationProcessor.process(InstrumentationProcessor.java:80)&lt;br/&gt;
	at org.apache.camel.processor.DeadLetterChannel.process(DeadLetterChannel.java:189)&lt;br/&gt;
	at org.apache.camel.processor.DeadLetterChannel.process(DeadLetterChannel.java:133)&lt;br/&gt;
	at org.apache.camel.management.InstrumentationProcessor.process(InstrumentationProcessor.java:68)&lt;br/&gt;
	at org.apache.camel.processor.interceptor.StreamCachingInterceptor.proceed(StreamCachingInterceptor.java:87)&lt;br/&gt;
	at org.apache.camel.processor.interceptor.StreamCachingInterceptor.process(StreamCachingInterceptor.java:82)&lt;br/&gt;
	at org.apache.camel.processor.UnitOfWorkProcessor.process(UnitOfWorkProcessor.java:52)&lt;br/&gt;
	at org.apache.camel.component.seda.SedaConsumer.run(SedaConsumer.java:72)&lt;br/&gt;
	at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)&lt;br/&gt;
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)&lt;br/&gt;
	at java.lang.Thread.run(Thread.java:637)&lt;/p&gt;

&lt;p&gt;I believe it must be a race condition when several threads are passing through the splitter, in the above case I&apos;m using a seda queue with 5 threads.  Am logging this now as I&apos;m not sure what time I&apos;ll have to investigate further this week.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12486755">CAMEL-2496</key>
            <summary>StreamCache/Splitter race condition</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="njiang">Willem Jiang</assignee>
                                    <reporter username="slewis">Stan Lewis</reporter>
                        <labels>
                    </labels>
                <created>Wed, 24 Feb 2010 15:38:16 +0000</created>
                <updated>Sun, 24 Apr 2011 10:00:53 +0000</updated>
                            <resolved>Mon, 7 Jun 2010 01:45:15 +0000</resolved>
                                    <version>2.0-M1</version>
                    <version>1.6.1</version>
                    <version>1.6.2</version>
                    <version>2.0-M2</version>
                    <version>2.0-M3</version>
                    <version>2.0.0</version>
                    <version>2.1.0</version>
                    <version>2.2.0</version>
                    <version>2.3.0</version>
                                    <fixVersion>2.4.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                            <aggregatetimeoriginalestimate seconds="3600">1h</aggregatetimeoriginalestimate>
                                        <aggregatetimeremainingestimate seconds="3600">1h</aggregatetimeremainingestimate>
                                                <comments>
                            <comment id="12955060" author="slewis" created="Wed, 24 Feb 2010 15:39:22 +0000"  >&lt;p&gt;unit test for 1.x branch, still need to check if 2.x trunk shows a similar problem.&lt;/p&gt;</comment>
                            <comment id="12955146" author="davsclaus" created="Mon, 1 Mar 2010 16:03:45 +0000"  >&lt;p&gt;I think we should use the new HawtDB as file based stream cache in the future. &lt;/p&gt;

&lt;p&gt;It got all the bells and whistles to be fast and leverages NIO and memory mapped IO and whatnot.&lt;br/&gt;
But that can be done when we overhaul stream caching in 2.x, once we get the time for that &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="12955670" author="njiang" created="Wed, 21 Apr 2010 07:38:37 +0000"  >&lt;p&gt;After digging the code, I found the FileInputStreamCache is closed when the XPathBuilder.getDocument() is called, and the temp file is deleted, so you get the FileNotFoundException when the XPathBuilder wants to reset the InputStream.&lt;br/&gt;
I can also reproduce this issue in Camel 2.x.&lt;/p&gt;

&lt;p&gt;To work around this issue, we should not use the FileInputStreamCache as it can&apos;t be reset after it is closed, set the camel property CachedOutputStream.THRESHOLD to be &quot;-1&quot; can disable the FileInputStreamCache.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
getContext().getProperties().put(CachedOutputStream.THRESHOLD, &lt;span class=&quot;code-quote&quot;&gt;&quot;-1&quot;&lt;/span&gt;) ;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12955661" author="njiang" created="Wed, 21 Apr 2010 08:18:21 +0000"  >&lt;p&gt;Committed the test case into camel trunk, will revisit it when we have time to rewrite the StreamCache.&lt;/p&gt;</comment>
                            <comment id="12956497" author="scrutinizer" created="Tue, 1 Jun 2010 20:21:08 +0000"  >&lt;p&gt;This looks like the issue I just reported in &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-2776&quot; title=&quot;Cached stream file deletion causing file not found errors&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-2776&quot;&gt;&lt;del&gt;CAMEL-2776&lt;/del&gt;&lt;/a&gt;. It may not be a race condition but a side effect of the cached stream file removal upon close().&lt;/p&gt;</comment>
                            <comment id="12956111" author="njiang" created="Mon, 7 Jun 2010 01:42:04 +0000"  >&lt;p&gt;Now the cached file will not be deleted before the exchange&apos;s routing is finished, so you will not got this kind of error anymore.&lt;br/&gt;
The file will be deleted when the CachedFileInputStream which is built on this file is close and routing is finished.&lt;/p&gt;

&lt;p&gt;You can find more information in &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-2776&quot; title=&quot;Cached stream file deletion causing file not found errors&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-2776&quot;&gt;&lt;del&gt;CAMEL-2776&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="13024293" author="davsclaus" created="Sun, 24 Apr 2011 10:00:53 +0000"  >&lt;p&gt;Closing all resolved tickets from 2010 or older&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12463152" name="test-case.txt" size="3554" author="slewis" created="Wed, 24 Feb 2010 15:39:22 +0000"/>
                    </attachments>
                <subtasks>
                            <subtask id="12486762">CAMEL-2776</subtask>
                            <subtask id="12487289">CAMEL-2636</subtask>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 1 Mar 2010 16:03:45 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>76505</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 32 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i01oxr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>7809</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>