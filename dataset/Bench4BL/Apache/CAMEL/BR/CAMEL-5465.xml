<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun Dec 04 00:42:37 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/CAMEL-5465/CAMEL-5465.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[CAMEL-5465] JMS Reply Manager is shared across producers for the same endpoint</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-5465</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;When handling synchronous invocations, both JMS reply managers &lt;tt&gt;TemporaryQueueReplyManager&lt;/tt&gt; and &lt;tt&gt;PersistentQueueReplyManager&lt;/tt&gt; remove the correlation too late.&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;ReplyManager.handleReplyMessage&lt;/tt&gt; handles the reply triggering the continuation of the remaining route logic, which may as well contain yet another JMS invocation to exactly the same destination, e.g.:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&amp;lt;route&amp;gt;
  &amp;lt;from uri=&lt;span class=&quot;code-quote&quot;&gt;&quot;direct:hello&quot;&lt;/span&gt; /&amp;gt;
  &amp;lt;inOut uri=&lt;span class=&quot;code-quote&quot;&gt;&quot;activemq:queue:test&quot;&lt;/span&gt; /&amp;gt;
  &amp;lt;inOut uri=&lt;span class=&quot;code-quote&quot;&gt;&quot;activemq:queue:test&quot;&lt;/span&gt; /&amp;gt;
&amp;lt;/route&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;As a result, the correlation is not removed from the CorrelationMap until the asynchronous dispatch to the second endpoint has finished and the stack unwinds.&lt;/p&gt;

&lt;p&gt;What&apos;s worse is that, due to Camel&apos;s re-use of endpoints, both producers are represented as exactly the same Endpoint instance, sharing &lt;b&gt;the same ReplyManager and CorrelationMap&lt;/b&gt;.&lt;/p&gt;

&lt;p&gt;So during the dispatch to the second endpoint, the correlation is overwritten in the CorrelationMap but, immediately after, the first endpoint removes the correlation anyway!&lt;/p&gt;

&lt;p&gt;Since correlation ID are dragged on (see &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-5390&quot; title=&quot;Option to assign unique correlation ID to JMS messages&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-5390&quot;&gt;&lt;del&gt;CAMEL-5390&lt;/del&gt;&lt;/a&gt;), the route will fail, providing a bad out-of-box experience for such a simple use case.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12600034">CAMEL-5465</key>
            <summary>JMS Reply Manager is shared across producers for the same endpoint</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="3">Duplicate</resolution>
                                        <assignee username="raulvk">Ra&#250;l Kripalani</assignee>
                                    <reporter username="raulvk">Ra&#250;l Kripalani</reporter>
                        <labels>
                    </labels>
                <created>Tue, 24 Jul 2012 17:00:30 +0000</created>
                <updated>Thu, 9 Aug 2012 16:10:12 +0000</updated>
                            <resolved>Thu, 9 Aug 2012 16:09:01 +0000</resolved>
                                    <version>2.8.6</version>
                    <version>2.9.2</version>
                                    <fixVersion>2.9.3</fixVersion>
                    <fixVersion>2.10.0</fixVersion>
                                    <component>camel-activemq</component>
                    <component>camel-jms</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="13431939" author="raulvk" created="Thu, 9 Aug 2012 16:08:50 +0000"  >&lt;p&gt;Was able to trace this back to &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-5309&quot; title=&quot;Replies with Incorrect CorrelationIDs Received After Reinstantiating a Route with ActiveMQ Endpoint and Exclusive Reply Queue&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-5309&quot;&gt;&lt;del&gt;CAMEL-5309&lt;/del&gt;&lt;/a&gt;. I was unable to reproduce in latest versions (trunk, 2.10 and 2.9.3), but the problem is still present in branch 2.8.x. The fix in &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-5309&quot; title=&quot;Replies with Incorrect CorrelationIDs Received After Reinstantiating a Route with ActiveMQ Endpoint and Exclusive Reply Queue&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-5309&quot;&gt;&lt;del&gt;CAMEL-5309&lt;/del&gt;&lt;/a&gt; creates one Reply Manager per JMS producer, whereas previously there was only one reply manager shared across all producers with the same endpoint definition (the reply manager was scoped to the endpoint). That was indeed the root cause of the issue.&lt;/p&gt;

&lt;p&gt;Since there will be no more 2.8.x releases, there&apos;s no point retrofitting for 2.8.x.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310050">
                    <name>Regression</name>
                                                                <inwardlinks description="is broken by">
                                        <issuelink>
            <issuekey id="12558157">CAMEL-5309</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>241337</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 17 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i02793:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>10776</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>