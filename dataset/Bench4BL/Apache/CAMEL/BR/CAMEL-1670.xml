<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sat Dec 03 02:01:02 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/CAMEL-1670/CAMEL-1670.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[CAMEL-1670] thread() and File Components</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-1670</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;I just experimented with adding calls to thread(10) to my route to make it multithreaded.  This definitely speeds up by route, but it keeps throwing java.nio.channels.OverlappingFileLockException  errors and leaving lock files behind it.  The start of my route looks like&lt;/p&gt;



&lt;p&gt;from(&quot;file:&lt;br class=&quot;atl-forced-newline&quot; /&gt;startDirectory?move=endDirectory&quot;)&lt;br/&gt;
.threads(10)&lt;br/&gt;
.bean(&quot;myBean&quot;, &quot;myMethod&quot;)&lt;/p&gt;

&lt;p&gt;Afterwards, my route ran successfully but an OverlappingFileLockException was thrown for every file that was read and all the lock files were left in my source directory.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Microsoft Windows XP&lt;/p&gt;</environment>
        <key id="12486548">CAMEL-1670</key>
            <summary>thread() and File Components</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="davsclaus">Claus Ibsen</assignee>
                                    <reporter username="joegottman">Joe Gottman</reporter>
                        <labels>
                    </labels>
                <created>Thu, 4 Jun 2009 22:57:47 +0000</created>
                <updated>Sat, 21 Nov 2009 11:58:02 +0000</updated>
                            <resolved>Mon, 8 Jun 2009 07:04:03 +0000</resolved>
                                    <version>2.0-M1</version>
                                    <fixVersion>2.0-M2</fixVersion>
                                    <component>camel-core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12952456" author="davsclaus" created="Fri, 5 Jun 2009 06:03:53 +0000"  >&lt;p&gt;Hi Joe&lt;/p&gt;

&lt;p&gt;I assume its the &lt;b&gt;trunk&lt;/b&gt; you try? As 2.0m1 is 2 months old.&lt;/p&gt;

&lt;p&gt;Could you try different combinations of the &lt;b&gt;readLock&lt;/b&gt; on the file endpoint.&lt;br/&gt;
See this wiki page for possible values:&lt;br/&gt;
&lt;a href=&quot;http://camel.apache.org/file2.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://camel.apache.org/file2.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;And also try with &lt;b&gt;noop=true&lt;/b&gt; instead of &lt;b&gt;move=endDirectory&lt;/b&gt; to avoid the last move operation.&lt;/p&gt;

&lt;p&gt;All in all to help pin point where Windows have a problem with lock files.&lt;/p&gt;

&lt;p&gt;And could you paste the stacktrace.&lt;/p&gt;</comment>
                            <comment id="12952468" author="davsclaus" created="Sat, 6 Jun 2009 06:08:10 +0000"  >&lt;p&gt;From Joe:&lt;/p&gt;

&lt;p&gt;OK.  My process reads a file, does some work on it, writes it to output,&lt;br/&gt;
then saves the results to a database.  If the same file is processed twice&lt;br/&gt;
there is a database error.&lt;/p&gt;

&lt;p&gt;I used the same route and data with readLock equal to markerFile, fileLock,&lt;br/&gt;
and rename.  In each case, all the data made it to the database as expected.&lt;br/&gt;
With markerFile, an OverlappingFileLockException  was thrown for each file,&lt;br/&gt;
each file was moved, and there was a marker file left behind for each file.&lt;/p&gt;

&lt;p&gt;With fileLock, nothing ever got moved, so my process was stuck trying and&lt;br/&gt;
failing to process the same files over and over again (since an error was&lt;br/&gt;
thrown when the same file was saved to the database twice).&lt;/p&gt;

&lt;p&gt;With rename, everything got moved, but the second time a file was accessed a&lt;br/&gt;
database file was thrown and the file completely disappeared.  If I let my&lt;br/&gt;
process continue long enough all the output files went away.&lt;/p&gt;

&lt;p&gt;  I&apos;m pretty sure what&apos;s happening is a race condition between the one&lt;br/&gt;
Camel thread moving a file and another one reading it again.  You need to&lt;br/&gt;
hold you lock until Windows is finished moving the file.&lt;/p&gt;</comment>
                            <comment id="12952477" author="davsclaus" created="Sat, 6 Jun 2009 06:11:50 +0000"  >&lt;p&gt;Joe, thanks for the report.&lt;/p&gt;

&lt;p&gt;Could you &lt;b&gt;please&lt;/b&gt; paste the stacktrace.&lt;/p&gt;

&lt;p&gt;And you could much likely remedy this issue by instructing the threads to wait for the task to complete.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
.threads(10). waitForTaskToComplete(Always)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12952478" author="davsclaus" created="Sat, 6 Jun 2009 11:50:21 +0000"  >&lt;p&gt;&amp;gt; OK. My process reads a file, does some work on it, writes it to output,&lt;br/&gt;
&amp;gt; then saves the results to a database. If the same file is processed twice&lt;br/&gt;
&amp;gt; there is a database error.&lt;/p&gt;

&lt;p&gt;Can you show the route that does this? What do you mean writes it to output? Which output?&lt;/p&gt;

&lt;p&gt;We have server farms that tests Camel on all sorts of platforms, and of course also incl. windows and we have never had the exception you say you have.&lt;br/&gt;
But we need more accurate information to be able to construct an unit test that resembles what you do to be able to reproduce the issue on Windows.&lt;/p&gt;

&lt;p&gt;So please help provide the details.&lt;/p&gt;</comment>
                            <comment id="12952476" author="davsclaus" created="Sat, 6 Jun 2009 12:05:51 +0000"  >&lt;p&gt;How do you create the files to be used during testing?&lt;/p&gt;

&lt;p&gt;I just remembered that you cannot on some platforms in the same JVM write a file and obtains exclusive locks on the file.&lt;br/&gt;
So basically what is needed is to test by having some other system produce the files for unit testing. Eg create another JVM that drops in continuously new files.&lt;/p&gt;

</comment>
                            <comment id="12952469" author="davsclaus" created="Sat, 6 Jun 2009 13:15:16 +0000"  >&lt;p&gt;I got it reproduced now.&lt;/p&gt;

&lt;p&gt;Will look into it this weekend.&lt;/p&gt;</comment>
                            <comment id="12952473" author="davsclaus" created="Sun, 7 Jun 2009 08:21:16 +0000"  >&lt;p&gt;This is a first cut for a fix. It resolves the issue for the markerFile lock (the default one).&lt;/p&gt;

&lt;p&gt;But we are considering a more generic solution for registering in progress exchanges. For instance there is a ticket about idempotent consumer EIP pattern that could also benefit from this.&lt;/p&gt;

&lt;p&gt;trunk: 782345.&lt;/p&gt;</comment>
                            <comment id="12952490" author="davsclaus" created="Mon, 8 Jun 2009 07:04:02 +0000"  >&lt;p&gt;Now fixed for all lock types etc.&lt;/p&gt;

&lt;p&gt;Thanks for reporting Joe.&lt;/p&gt;

&lt;p&gt;trunk: 782544.&lt;/p&gt;</comment>
                            <comment id="12952496" author="davsclaus" created="Mon, 8 Jun 2009 08:48:52 +0000"  >&lt;p&gt;And the camel-ftp component fixed as well: 782560.&lt;/p&gt;</comment>
                            <comment id="12953744" author="davsclaus" created="Sat, 21 Nov 2009 11:58:02 +0000"  >&lt;p&gt;Closing all 2.0M2 tickets&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 5 Jun 2009 06:03:53 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>76779</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 2 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i01juf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6984</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>