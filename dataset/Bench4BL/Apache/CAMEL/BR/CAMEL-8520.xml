<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sat Dec 03 04:48:48 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/CAMEL-8520/CAMEL-8520.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[CAMEL-8520] Camel XMPP doesn&apos;t use a DNS resolver to look at SRV records</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-8520</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;Camel XMPP doesn&apos;t use a DNS resolver to look at SRV records, whereas in 2.14.1 it did.&lt;/p&gt;

&lt;p&gt;In 2.15.0, ConnectionConfiguration calls &lt;tt&gt;DNSUtil.resolveXMPPDomain(serviceName)&lt;/tt&gt; which runs this code:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-style: solid;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;border-bottom-style: solid;&quot;&gt;&lt;b&gt;DNSUtil.java&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; List&amp;lt;HostAddress&amp;gt; resolveXMPPDomain(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; domain) {
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (dnsResolver == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
            List&amp;lt;HostAddress&amp;gt; addresses = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ArrayList&amp;lt;HostAddress&amp;gt;(1);
            addresses.add(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HostAddress(domain, 5222));
            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; addresses;
        }
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; resolveDomain(domain, &apos;c&apos;);
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;dnsResolver is never initialised, so it returns the service name, in my case &apos;jabberzac.org&apos;, instead of the actual XMPP server from the SRV Record, &apos;xmpp.jabberzac.org&apos;, which then causes a timeout.&lt;/p&gt;

&lt;p&gt;The dnsResolver is meant to be instantiated in init(), which is meant to be called by SmackConfiguration, but never is.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-style: solid;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;border-bottom-style: solid;&quot;&gt;&lt;b&gt;DNSUtil.java&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    /**
     * Initializes DNSUtil. This method is automatically called by SmackConfiguration, you don&apos;t
     * have to call it manually.
     */
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void init() {
        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] RESOLVERS = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] { &lt;span class=&quot;code-quote&quot;&gt;&quot;javax.JavaxResolver&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;minidns.MiniDnsResolver&quot;&lt;/span&gt;,
                        &lt;span class=&quot;code-quote&quot;&gt;&quot;dnsjava.DNSJavaResolver&quot;&lt;/span&gt; };
        &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; resolver :RESOLVERS) {
            DNSResolver availableResolver = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
            &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; resolverFull = &lt;span class=&quot;code-quote&quot;&gt;&quot;org.jivesoftware.smack.util.dns&quot;&lt;/span&gt; + resolver;
            &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
                &lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;&amp;lt;?&amp;gt; resolverClass = &lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;.forName(resolverFull);
                Method getInstanceMethod = resolverClass.getMethod(&lt;span class=&quot;code-quote&quot;&gt;&quot;getInstance&quot;&lt;/span&gt;);
                availableResolver = (DNSResolver) getInstanceMethod.invoke(&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;);
                &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (availableResolver != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
                    setDNSResolver(availableResolver);
                    &lt;span class=&quot;code-keyword&quot;&gt;break&lt;/span&gt;;
                }
            }
            &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (ClassNotFoundException|NoSuchMethodException|SecurityException|IllegalAccessException|IllegalArgumentException|InvocationTargetException e) {
                LOGGER.log(Level.FINE, &lt;span class=&quot;code-quote&quot;&gt;&quot;Exception on init&quot;&lt;/span&gt;, e);
            }
        }
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;2.14.1 doesn&apos;t seem to have this problem as DNSUtil class in 2.14.1 doesn&apos;t have an init() function which is meant to be &apos;automatically called&apos;, it just has a static code block:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; {
        &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
            Hashtable env = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Hashtable();
            env.put(&lt;span class=&quot;code-quote&quot;&gt;&quot;java.naming.factory.initial&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;com.sun.jndi.dns.DnsContextFactory&quot;&lt;/span&gt;);
            context = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; InitialDirContext(env);
        }
        &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (Exception e) {
            &lt;span class=&quot;code-comment&quot;&gt;// Ignore.
&lt;/span&gt;        }
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12783447">CAMEL-8520</key>
            <summary>Camel XMPP doesn&apos;t use a DNS resolver to look at SRV records</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="davsclaus">Claus Ibsen</assignee>
                                    <reporter username="bharris">Ben Harris</reporter>
                        <labels>
                    </labels>
                <created>Fri, 20 Mar 2015 00:38:17 +0000</created>
                <updated>Fri, 20 Mar 2015 06:52:48 +0000</updated>
                            <resolved>Fri, 20 Mar 2015 06:52:48 +0000</resolved>
                                    <version>2.15.0</version>
                                    <fixVersion>2.15.1</fixVersion>
                    <fixVersion>2.16.0</fixVersion>
                                    <component>camel-xmpp</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="14370837" author="davsclaus" created="Fri, 20 Mar 2015 06:31:27 +0000"  >&lt;p&gt;I dont think its a Camel problem. The init code is called when I run an unit test. But it seems those DNS classes that it attempts to load are not in the classpath. So you may need to add some JARs to include the resolver classes.&lt;/p&gt;</comment>
                            <comment id="14370841" author="davsclaus" created="Fri, 20 Mar 2015 06:32:32 +0000"  >&lt;p&gt;Now using static code blocks and static configuration classes as how smack is done is of course a very bad idea - but that is how they decided to code their library - nothing we can do here.&lt;/p&gt;</comment>
                            <comment id="14370845" author="bharris" created="Fri, 20 Mar 2015 06:36:11 +0000"  >&lt;p&gt;If they are in &lt;tt&gt;org.jivesoftware.smack.util.dns&lt;/tt&gt; shouldn&apos;t they be part of camel-xmpp&apos;s smack dependencies?&lt;/p&gt;

&lt;p&gt;see: &lt;a href=&quot;https://www.igniterealtime.org/builds/smack/docs/latest/javadoc/org/jivesoftware/smack/util/dns/dnsjava/DNSJavaResolver.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://www.igniterealtime.org/builds/smack/docs/latest/javadoc/org/jivesoftware/smack/util/dns/dnsjava/DNSJavaResolver.html&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14370847" author="davsclaus" created="Fri, 20 Mar 2015 06:36:21 +0000"  >&lt;p&gt;And they have a bug in the code loading the resolvers&lt;/p&gt;

&lt;p&gt;This is the resolved name in the java code:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
org.jivesoftware.smack.util.dnsdnsjava.DNSJavaResolver
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Notice the a dot is missing&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
org.jivesoftware.smack.util.dns.dnsjava.DNSJavaResolver
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14370849" author="bharris" created="Fri, 20 Mar 2015 06:38:17 +0000"  >&lt;p&gt;Right. Over to Smack then...&lt;/p&gt;</comment>
                            <comment id="14370850" author="davsclaus" created="Fri, 20 Mar 2015 06:38:32 +0000"  >&lt;p&gt;Ah which seems to be fixed in 4.0.7&lt;/p&gt;</comment>
                            <comment id="14370856" author="davsclaus" created="Fri, 20 Mar 2015 06:45:08 +0000"  >&lt;p&gt;You need to add the DNS dependency you want - they have 3 different implementations.&lt;/p&gt;</comment>
                            <comment id="14370861" author="davsclaus" created="Fri, 20 Mar 2015 06:52:48 +0000"  >&lt;p&gt;Upgraded to 4.0.7&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 20 Mar 2015 06:31:27 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 37 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i270jb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>