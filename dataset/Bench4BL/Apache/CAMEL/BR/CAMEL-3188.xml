<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sat Dec 03 02:27:13 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/CAMEL-3188/CAMEL-3188.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[CAMEL-3188] Concurrent consumers on seda endpoint can cause content routing to mismatch</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-3188</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;When consuming concurrently from a seda endpoint, when the route contains a content router based on the header, it will randomly route through the wrong choice.&lt;/p&gt;

&lt;p&gt;In my specific case, I was consuming from an activemq queue, which would receive messages with a header that would then determine which route it would follow. It would randomly send messages down the wrong path. When I turned on tracing, it would behave itself. It also behaved itself when I limited it to only a single consumer. I was, however, able to duplicate it with the unit test below. Due to the concurrency issue, the test can occasionally pass, but run it a couple times and it should fail. It&apos;ll either receive 2 messages when it should have only gotten 1, or it will get no messages when it should have gotten 1.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-style: solid;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;border-bottom-style: solid;&quot;&gt;&lt;b&gt;ConcurrencyTest.java&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.camel.EndpointInject;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.camel.Produce;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.camel.ProducerTemplate;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.camel.builder.RouteBuilder;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.camel.component.mock.MockEndpoint;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.camel.test.CamelTestSupport;

&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; class ConcurrencyTest &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; CamelTestSupport {

	@EndpointInject(uri = &lt;span class=&quot;code-quote&quot;&gt;&quot;mock:result&quot;&lt;/span&gt;)
	&lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; MockEndpoint resultEndpoint;
	
	@EndpointInject(uri = &lt;span class=&quot;code-quote&quot;&gt;&quot;mock:otherResult&quot;&lt;/span&gt;)
	&lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; MockEndpoint otherResultEndpoint;

	@Produce(uri = &lt;span class=&quot;code-quote&quot;&gt;&quot;seda:start&quot;&lt;/span&gt;)
	&lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; ProducerTemplate template;

	&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testSendMatchingMessage() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
		&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; expectedBody = &lt;span class=&quot;code-quote&quot;&gt;&quot;&amp;lt;matched/&amp;gt;&quot;&lt;/span&gt;;
		
		resultEndpoint.expectedBodiesReceived(expectedBody);
		otherResultEndpoint.expectedBodiesReceived(expectedBody);

		template.sendBodyAndHeader(expectedBody, &lt;span class=&quot;code-quote&quot;&gt;&quot;myDirection&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;send&quot;&lt;/span&gt;);
		template.sendBodyAndHeader(expectedBody, &lt;span class=&quot;code-quote&quot;&gt;&quot;myDirection&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;received&quot;&lt;/span&gt;);

		resultEndpoint.assertIsSatisfied();
	}

	@Override
    &lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; RouteBuilder createRouteBuilder() {
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; RouteBuilder() {
            &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void configure() {
                from(&lt;span class=&quot;code-quote&quot;&gt;&quot;seda:start?concurrentConsumers=10&quot;&lt;/span&gt;)
&lt;span class=&quot;code-comment&quot;&gt;//                from(&lt;span class=&quot;code-quote&quot;&gt;&quot;seda:start?concurrentConsumers=1&quot;&lt;/span&gt;)
&lt;/span&gt;                	.choice()
                		.when(header(&lt;span class=&quot;code-quote&quot;&gt;&quot;myDirection&quot;&lt;/span&gt;).isEqualTo(&lt;span class=&quot;code-quote&quot;&gt;&quot;send&quot;&lt;/span&gt;)).to(&lt;span class=&quot;code-quote&quot;&gt;&quot;mock:result&quot;&lt;/span&gt;)
                		.when(header(&lt;span class=&quot;code-quote&quot;&gt;&quot;myDirection&quot;&lt;/span&gt;).isEqualTo(&lt;span class=&quot;code-quote&quot;&gt;&quot;received&quot;&lt;/span&gt;)).to(&lt;span class=&quot;code-quote&quot;&gt;&quot;mock:otherResult&quot;&lt;/span&gt;);
            }
        };
    }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment>&lt;p&gt;Mac OS X 10.6.4&lt;br/&gt;
Java(TM) SE Runtime Environment (build 1.6.0_20-b02-279-10M3065)&lt;/p&gt;</environment>
        <key id="12487844">CAMEL-3188</key>
            <summary>Concurrent consumers on seda endpoint can cause content routing to mismatch</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="davsclaus">Claus Ibsen</assignee>
                                    <reporter username="bfeaver">Brian Feaver</reporter>
                        <labels>
                    </labels>
                <created>Fri, 1 Oct 2010 20:21:02 +0000</created>
                <updated>Sun, 24 Apr 2011 09:57:06 +0000</updated>
                            <resolved>Sat, 2 Oct 2010 15:16:43 +0000</resolved>
                                    <version>2.3.0</version>
                    <version>2.4.0</version>
                                    <fixVersion>2.5.0</fixVersion>
                                    <component>camel-core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12957030" author="davsclaus" created="Sat, 2 Oct 2010 10:40:16 +0000"  >&lt;p&gt;The problem actually seems to be the isEqualTo predicate.&lt;/p&gt;

&lt;p&gt;The CBR is okay.&lt;/p&gt;</comment>
                            <comment id="12957042" author="davsclaus" created="Sat, 2 Oct 2010 11:49:15 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-2651&quot; title=&quot;Mock endpoint - Should throw more detailed assertion errors when using predicates&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-2651&quot;&gt;&lt;del&gt;CAMEL-2651&lt;/del&gt;&lt;/a&gt; is the culprit.&lt;/p&gt;</comment>
                            <comment id="12957041" author="davsclaus" created="Sat, 2 Oct 2010 15:16:43 +0000"  >&lt;p&gt;trunk: 1003810.&lt;/p&gt;</comment>
                            <comment id="13023668" author="davsclaus" created="Sun, 24 Apr 2011 09:57:06 +0000"  >&lt;p&gt;Closing all resolved tickets from 2010 or older&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sat, 2 Oct 2010 10:40:16 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>76321</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 32 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i01t7b:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>8500</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>