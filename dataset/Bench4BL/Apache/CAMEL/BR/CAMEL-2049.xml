<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sat Dec 03 04:04:47 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/CAMEL-2049/CAMEL-2049.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[CAMEL-2049] Improper configuration of MINA connector and acceptor instances; Better producer</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-2049</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;A sample scenario where both MINA producer(s) and consumer(s) are used in the same route (e.g. some kind of dispatching or proxying):&lt;/p&gt;

&lt;p&gt;from(&quot;mina:tcp://localhost:8888?lazySessionCreation=true&amp;amp;sync=true&quot;)&lt;br/&gt;
    .to(&quot;mina:tcp://localhost:7777?lazySessionCreation=true&amp;amp;sync=true&quot;);&lt;/p&gt;

&lt;p&gt;from(&quot;mina:tcp://localhost:7777?lazySessionCreation=true&amp;amp;sync=true&quot;)&lt;br/&gt;
    .process(/&lt;b&gt;prepare answer&lt;/b&gt;/);&lt;/p&gt;

&lt;p&gt;Due to improper configuration of MINA acceptor and connector instances in MinaComponent#createSocketEndpoint(), no more than 15 incoming threads can be served at port 8888 &amp;#8211; the producer becomes unable to open an outgoing session.  This is actually an issue of MINA, not of Camel &amp;#8211; a test application written using &quot;raw&quot; MINA shows the same behaviour.&lt;/p&gt;

&lt;p&gt;A solution is to apply configuration rules described, e.g., at &lt;a href=&quot;http://mina.apache.org/configuring-thread-model.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://mina.apache.org/configuring-thread-model.html&lt;/a&gt;, as done in the attached patch.&lt;/p&gt;

&lt;p&gt;Moreover, the standard Camel-MINA producer is not thread-safe &amp;#8211; actually a well-known point.  A second attached file contains a thread pool-based reentrant version, which can be efficiently used for TCP endpoints with both parameters &apos;lazySessionCreation&apos; and &apos;sync&apos; set to true.&lt;/p&gt;
</description>
                <environment>&lt;p&gt;Windows XP&lt;/p&gt;</environment>
        <key id="12487178">CAMEL-2049</key>
            <summary>Improper configuration of MINA connector and acceptor instances; Better producer</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="davsclaus">Claus Ibsen</assignee>
                                    <reporter username="rnd">Dmytro Rud</reporter>
                        <labels>
                    </labels>
                <created>Thu, 1 Oct 2009 09:00:11 +0000</created>
                <updated>Sun, 7 Feb 2010 09:56:23 +0000</updated>
                            <resolved>Thu, 8 Oct 2009 06:23:36 +0000</resolved>
                                    <version>1.6.0</version>
                                    <fixVersion>1.6.2</fixVersion>
                    <fixVersion>2.0.0</fixVersion>
                    <fixVersion>2.1.0</fixVersion>
                                    <component>camel-mina</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12953384" author="rnd" created="Thu, 1 Oct 2009 09:03:42 +0000"  >&lt;p&gt;MINA component patch and thread-save producer&lt;/p&gt;</comment>
                            <comment id="12953404" author="davsclaus" created="Sat, 3 Oct 2009 08:07:59 +0000"  >&lt;p&gt;Thanks for these patches.&lt;/p&gt;

&lt;p&gt;I was hoping that the Mina project much sooner have been able to release Apache Mina 2.0, which they unfortunately haven&apos;t.&lt;br/&gt;
So we are still using the older Mina 1.1.x.&lt;/p&gt;

&lt;p&gt;Anyway I think you patches looks according to the recommended documentation at Mina itself so I will get them into the codebase.&lt;/p&gt;</comment>
                            <comment id="12953419" author="davsclaus" created="Sat, 3 Oct 2009 08:45:59 +0000"  >&lt;p&gt;trunk: 821272, 823031.&lt;/p&gt;

&lt;p&gt;1.x: 821276, 823056.&lt;/p&gt;</comment>
                            <comment id="12953403" author="davsclaus" created="Sat, 3 Oct 2009 08:56:52 +0000"  >&lt;p&gt;In Camel 2.0 the MinaProducer is now pooled which resolves the thread safe issue there as only one instance is using it at any given time.&lt;/p&gt;</comment>
                            <comment id="12953402" author="davsclaus" created="Sat, 3 Oct 2009 08:59:56 +0000"  >&lt;p&gt;I am a bit inclined to patch Camel 1.x with your socket producer as then we got different solution in 1.x vs. 2.0 (pooled)&lt;/p&gt;

&lt;p&gt;Any thoughts?&lt;/p&gt;</comment>
                            <comment id="12953401" author="davsclaus" created="Sat, 3 Oct 2009 09:01:00 +0000"  >&lt;p&gt;And for the future it would be great if you also provide unit tests that surfaces the bug and which we can use to ensure the patch fixes &quot;something&quot;.&lt;/p&gt;</comment>
                            <comment id="12953391" author="rnd" created="Sat, 3 Oct 2009 20:11:33 +0000"  >&lt;p&gt;&amp;gt; I am a bit inclined to patch Camel 1.x with your socket producer&lt;br/&gt;
&amp;gt; as then we got different solution in 1.x vs. 2.0 (pooled)&lt;br/&gt;
&amp;gt; Any thoughts?&lt;/p&gt;

&lt;p&gt;If there is no way to make the 1.x producer pooled as well, it would be IMHO better to have different solutions in 1.x vs. 2.0 than to have an uniform solution which works in 2.0 only...&lt;/p&gt;
</comment>
                            <comment id="12945883" author="davsclaus" created="Sun, 4 Oct 2009 08:52:59 +0000"  >&lt;p&gt;Dmytro&lt;/p&gt;

&lt;p&gt;Do you mind creating a new patch with the updated code from the 1.x branch which uses your thread safe producer.&lt;br/&gt;
Then it would be much easier for me to commit it to the 1.x codebase.&lt;/p&gt;

&lt;p&gt;Then we have a solution with concurrent mina producers for both 1.x and 2.0&lt;/p&gt;

&lt;p&gt;Backporting the pooling is &lt;b&gt;way&lt;/b&gt; to much work.&lt;/p&gt;</comment>
                            <comment id="12950230" author="rnd" created="Sun, 4 Oct 2009 15:00:20 +0000"  >&lt;p&gt;Claus,&lt;/p&gt;

&lt;p&gt;I would like to introduce a new URL parameter for MINA TCP endpoints to specify the count of producer threads (parameter &quot;threadsCount&quot; of MinaSocketProducer&apos;s constructor).  For example,&lt;br/&gt;
...&lt;br/&gt;
.to(&quot;mina:tcp://somehost:8888?sync=true&amp;amp;lazySessionCreation=true&amp;amp;poolSize=16&quot;)&lt;/p&gt;

&lt;p&gt;Do you agree?  Or would you rather prefer this parameter to be hard-coded?  What default value should it have?&lt;/p&gt;

&lt;p&gt;And the second question: How should I handle the lazySessionCreation parameter?  Currently I tend to assume that session creation is always lazy.&lt;/p&gt;</comment>
                            <comment id="12950291" author="davsclaus" created="Mon, 5 Oct 2009 04:41:50 +0000"  >&lt;p&gt;Q1:&lt;br/&gt;
As it is going to be a custom solution for camel 1.x I would prefer it to be a hardcoded value. But I also think it make sense to configure it as well different users have different needs. So okay to add such an option but name it &lt;b&gt;producerPoolSize&lt;/b&gt; to indicate its producer &lt;b&gt;only&lt;/b&gt;.&lt;/p&gt;

&lt;p&gt;Q2:&lt;br/&gt;
Yeah I think its fine in this case to let this new producer always being lazy. So the &lt;tt&gt;lazySessionCreation&lt;/tt&gt; no longer apply to this new producer. &lt;/p&gt;</comment>
                            <comment id="12951344" author="rnd" created="Tue, 6 Oct 2009 13:45:16 +0000"  >&lt;p&gt;The new patch is attached.&lt;/p&gt;</comment>
                            <comment id="12951436" author="rnd" created="Tue, 6 Oct 2009 15:52:27 +0000"  >&lt;p&gt;BTW, the statement &lt;tt&gt;acceptorConfig.setThreadModel(ThreadModel.MANUAL);&lt;/tt&gt; from &lt;em&gt;MinaComponent.patch&lt;/em&gt; seems to be absent in both 1.x and 2.0 branches. Today&apos;s &lt;em&gt;2009-10-06.patch&lt;/em&gt; introduces it again, but this patch is intended for 1.x only. Claus, could you please add the aforementioned line in 2.0 too? &lt;/p&gt;</comment>
                            <comment id="12952184" author="davsclaus" created="Thu, 8 Oct 2009 06:20:38 +0000"  >&lt;p&gt;I have fixed the missing setThreadModel in 2.0&lt;/p&gt;

&lt;p&gt;I have also applied your patch to 1.x. Thanks a lot.&lt;br/&gt;
1.x: 823060.&lt;/p&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12462860" name="2009-10-06.patch" size="15162" author="rnd" created="Tue, 6 Oct 2009 13:45:16 +0000"/>
                            <attachment id="12463039" name="MinaComponent.patch" size="3184" author="rnd" created="Thu, 1 Oct 2009 09:03:42 +0000"/>
                            <attachment id="12463041" name="MinaSocketProducer.java" size="7536" author="rnd" created="Thu, 1 Oct 2009 09:03:42 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sat, 3 Oct 2009 08:07:59 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>76655</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 9 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310041" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Patch Info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10042"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i01m6n:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>7363</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>