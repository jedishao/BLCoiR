<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sat Dec 03 03:40:12 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/CAMEL-2942/CAMEL-2942.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[CAMEL-2942] CamelHttpTransportServlet.destroy causes java.lang.IllegalArgumentException: Cannot find the deployed servlet</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-2942</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;CamelHttpTransportServlet.destroy removes the servlet from a static map named CAMEL_SERVLET_MAP prior to stopping its associated Spring application context.  If that context defines a route using a servletEndpoint, the route is shutdown AFTER the servlet is removed from the map.  The shutdown code then looks for the servlet in the map by calling CamelHttpTransportServlet.getCamelServlet.  The servlet can&apos;t be found, and the ensuing exception is logged (copied below).&lt;/p&gt;

&lt;p&gt;It seems to me that CamelHttpTransportServlet.destroy should be defined like this:&lt;/p&gt;

&lt;p&gt;    public void destroy() {&lt;br/&gt;
        // Removal was here&lt;br/&gt;
        if (applicationContext != null) &lt;/p&gt;
{
            applicationContext.stop();
        }
&lt;p&gt;        // Moved the removal to here&lt;br/&gt;
        CAMEL_SERVLET_MAP.remove(servletName);&lt;br/&gt;
    }&lt;/p&gt;

&lt;p&gt;so that the servlet is removed from the map after the context is stopped.&lt;/p&gt;

&lt;p&gt;I know for sure that removal of the servlet from the map before the context is stopped causes this problem when my route is shutdown.  I DON&apos;T know for sure that my overall configuration is correct, though I think it is valid.&lt;/p&gt;

&lt;p&gt;If the above change is not obviously correct, or if there are further questions, please let me know, and I&apos;ll work up a sample that demonstrates the problem to help answer any questions.&lt;/p&gt;

&lt;p&gt;&amp;#8211;&lt;/p&gt;

&lt;p&gt;2010-07-13 09:06:23,918 &lt;span class=&quot;error&quot;&gt;&amp;#91;Camel Thread 0 - ShutdownTask&amp;#93;&lt;/span&gt; WARN  org.apache.camel.impl.DefaultShutdownStrategy at org.apache.camel.impl.DefaultShutdownStrategy.shutdownNow(DefaultShutdownStrategy.java:219)&lt;br/&gt;
         Error occurred while shutting down route: Consumer&lt;span class=&quot;error&quot;&gt;&amp;#91;/relay&amp;#93;&lt;/span&gt;. This exception will be ignored.&lt;br/&gt;
java.lang.IllegalArgumentException: Cannot find the deployed servlet, please configure the ServletComponent or configure a org.apache.camel.component.servlet.CamelHttpTransportServlet servlet in web.xml &lt;br/&gt;
	at org.apache.camel.component.servlet.ServletComponent.getCamelServlet(ServletComponent.java:55)&lt;br/&gt;
	at org.apache.camel.component.servlet.ServletComponent.disconnect(ServletComponent.java:116)&lt;br/&gt;
	at org.apache.camel.component.http.HttpEndpoint.disconnect(HttpEndpoint.java:152)&lt;br/&gt;
	at org.apache.camel.component.http.HttpConsumer.doStop(HttpConsumer.java:56)&lt;br/&gt;
	at org.apache.camel.impl.ServiceSupport.stop(ServiceSupport.java:86)&lt;br/&gt;
	at org.apache.camel.impl.ServiceSupport.stop(ServiceSupport.java:107)&lt;br/&gt;
	at org.apache.camel.util.ServiceHelper.stopService(ServiceHelper.java:100)&lt;br/&gt;
	at org.apache.camel.impl.DefaultShutdownStrategy.shutdownNow(DefaultShutdownStrategy.java:217)&lt;br/&gt;
	at org.apache.camel.impl.DefaultShutdownStrategy$ShutdownTask.run(DefaultShutdownStrategy.java:413)&lt;br/&gt;
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:441)&lt;br/&gt;
	at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:303)&lt;br/&gt;
	at java.util.concurrent.FutureTask.run(FutureTask.java:138)&lt;br/&gt;
	at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)&lt;br/&gt;
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)&lt;br/&gt;
	at java.lang.Thread.run(Thread.java:637)&lt;/p&gt;
</description>
                <environment></environment>
        <key id="12485961">CAMEL-2942</key>
            <summary>CamelHttpTransportServlet.destroy causes java.lang.IllegalArgumentException: Cannot find the deployed servlet</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="njiang">Willem Jiang</assignee>
                                    <reporter username="bstiles@bstiles.net">Brian Stiles</reporter>
                        <labels>
                    </labels>
                <created>Tue, 13 Jul 2010 17:18:30 +0000</created>
                <updated>Sun, 24 Apr 2011 09:57:05 +0000</updated>
                            <resolved>Wed, 14 Jul 2010 01:41:34 +0000</resolved>
                                    <version>2.3.0</version>
                                    <fixVersion>2.5.0</fixVersion>
                                    <component>camel-servlet</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12955636" author="njiang" created="Wed, 14 Jul 2010 01:31:47 +0000"  >&lt;p&gt;Yeah, we need to remove the the ServletMap after the application context is stopped.&lt;br/&gt;
Thanks for pointing that out, I will commit the fix shortly.&lt;/p&gt;</comment>
                            <comment id="12951176" author="bstiles@bstiles.net" created="Wed, 14 Jul 2010 01:40:22 +0000"  >&lt;p&gt;Fantastic.  Thanks for the quick response!&lt;/p&gt;</comment>
                            <comment id="12951131" author="njiang" created="Wed, 14 Jul 2010 01:41:34 +0000"  >&lt;p&gt;Committed the patch with thanks to Brian.&lt;/p&gt;</comment>
                            <comment id="13023656" author="davsclaus" created="Sun, 24 Apr 2011 09:57:05 +0000"  >&lt;p&gt;Closing all resolved tickets from 2010 or older&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 14 Jul 2010 01:31:47 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>76393</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 32 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i01ron:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>8254</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>