<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sat Dec 03 05:17:12 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/CAMEL-3277/CAMEL-3277.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[CAMEL-3277] Threading issue which lets converter loading abort</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-3277</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;The type converter loading is not threadsafe and fails sometimes. That will end up with around 17 type converters loaded only which will probably let your camel routes fail with conversion errors like:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;07:04:31,112 | ERROR | qtp25205731-2783 | DefaultErrorHandler | rg.apache.camel.processor.Logger 248 | 68 - org.apache.camel.camel-core - 2.4.0.fuse-00-00 | Failed delivery for exchangeId: 53e23457-5551-4487-9fc4-87dd33687f0b. Exhausted after delivery attempt: 1 caught: java.lang.ClassCastException: org.apache.camel.converter.stream.InputStreamCache cannot be cast to org.w3c.dom.Node
java.lang.ClassCastException: org.apache.camel.converter.stream.InputStreamCache cannot be cast to org.w3c.dom.Node
at com.sun.org.apache.xpath.internal.jaxp.XPathExpressionImpl.eval(XPathExpressionImpl.java:116)[:1.6.0_17]
at com.sun.org.apache.xpath.internal.jaxp.XPathExpressionImpl.eval(XPathExpressionImpl.java:98)[:1.6.0_17]
at com.sun.org.apache.xpath.internal.jaxp.XPathExpressionImpl.evaluate(XPathExpressionImpl.java:180)[:1.6.0_17]
at org.apache.camel.builder.xml.XPathBuilder.doInEvaluateAs(XPathBuilder.java:598)[68:org.apache.camel.camel-core:2.4.0.fuse-00-00]
at org.apache.camel.builder.xml.XPathBuilder.evaluateAs(XPathBuilder.java:570)[68:org.apache.camel.camel-core:2.4.0.fuse-00-00]
at org.apache.camel.builder.xml.XPathBuilder.matches(XPathBuilder.java:122)[68:org.apache.camel.camel-core:2.4.0.fuse-00-00]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Tracking the issue down showed that several type converter loaders share the same registry object and fail to load all converters every once a while. That can be fixed by making the load method synchronized...see attached patch.&lt;/p&gt;</description>
                <environment>&lt;p&gt;SMX 4&lt;/p&gt;</environment>
        <key id="12487595">CAMEL-3277</key>
            <summary>Threading issue which lets converter loading abort</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="davsclaus">Claus Ibsen</assignee>
                                    <reporter username="lhein">Lars Heinemann</reporter>
                        <labels>
                    </labels>
                <created>Mon, 25 Oct 2010 19:46:50 +0000</created>
                <updated>Mon, 23 May 2011 22:17:15 +0000</updated>
                            <resolved>Tue, 26 Oct 2010 06:42:29 +0000</resolved>
                                    <version>2.4.0</version>
                                    <fixVersion>2.6.0</fixVersion>
                                    <component>camel-core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="12957210" author="lhein" created="Mon, 25 Oct 2010 19:47:23 +0000"  >&lt;p&gt;attached patch&lt;/p&gt;</comment>
                            <comment id="12957246" author="davsclaus" created="Tue, 26 Oct 2010 06:42:29 +0000"  >&lt;p&gt;trunk: 1027380.&lt;/p&gt;

&lt;p&gt;Thanks Lars for the patch.&lt;/p&gt;</comment>
                            <comment id="13023830" author="davsclaus" created="Sun, 24 Apr 2011 09:57:31 +0000"  >&lt;p&gt;Closing all resolved tickets from 2010 or older&lt;/p&gt;</comment>
                            <comment id="13037628" author="fracca" created="Sun, 22 May 2011 17:03:20 +0000"  >&lt;p&gt;Managed to reproduce this issue with Camel 2.7.0&lt;/p&gt;

&lt;p&gt;A simple HTTP request followed by an XPath expression in a bean.&lt;/p&gt;


&lt;p&gt;public class PricesParser {&lt;/p&gt;

&lt;p&gt;    public static void main(String args[]) throws Exception {&lt;br/&gt;
        // create CamelContext&lt;br/&gt;
        CamelContext context = new DefaultCamelContext();&lt;/p&gt;

&lt;p&gt;        // add our route to the CamelContext&lt;br/&gt;
        context.addRoutes(new RouteBuilder() {&lt;br/&gt;
            public void configure() &lt;/p&gt;
{

        from(&quot;http://url&quot;).bean(new MyBean()).to(&quot;file:target/prices&quot;);

        // start the route and let it do its work
        context.start();
        Thread.sleep(3000);

        // stop the CamelContext
        context.stop();
}

&lt;p&gt;public static class MyBean {&lt;br/&gt;
	public String parse(@XPath(&quot;//div&lt;span class=&quot;error&quot;&gt;&amp;#91;@id=&amp;#39;prices&amp;#39;&amp;#93;&lt;/span&gt;&quot;) String prices)  &lt;/p&gt;
{
		return prices;
	}
&lt;p&gt;}&lt;/p&gt;

&lt;p&gt;However, all converters seem to have loaded:&lt;/p&gt;

&lt;p&gt;.........&lt;/p&gt;


&lt;p&gt;[                          main] AnnotationTypeConverterLoader  INFO  Found 4 packages with 15 @Converter classes to load&lt;br/&gt;
[                          main] DefaultTypeConverter           INFO  Loaded 157 type converters in 0.515 seconds&lt;/p&gt;

&lt;p&gt;main] DefaultCamelContext            INFO  Route: route1 started and consuming from: Endpoint&lt;a href=&quot;http://url&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://url&lt;/a&gt;&lt;br/&gt;
[                          main] DefaultCamelContext            INFO  Total 1 routes, of which 1 is started.&lt;br/&gt;
[                          main] DefaultCamelContext            INFO  Apache Camel 2.7.0 (CamelContext: camel-1) started in 1.914 seconds&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;url&amp;#93;&lt;/span&gt; route1                         INFO  before&lt;br/&gt;
[                          main] DefaultCamelContext            INFO  Apache Camel 2.7.0 (CamelContext:camel-1) is shutting down&lt;br/&gt;
[                          main] DefaultShutdownStrategy        INFO  Starting to graceful shutdown 1 routes (timeout 300 seconds)&lt;br/&gt;
[                          main] DefaultExecutorServiceStrategy DEBUG Created new single thread pool for source: org.apache.camel.impl.DefaultShutdownStrategy@64c5e2cf with name: ShutdownTask. -&amp;gt; java.util.concurrent.Executors$FinalizableDelegatedExecutorService@95d0a50&lt;br/&gt;
&lt;a href=&quot;#1 - ShutdownTask&quot;&gt;el-1) thread #1 - ShutdownTask&lt;/a&gt; DefaultShutdownStrategy        DEBUG There are 1 routes to shutdown&lt;br/&gt;
&lt;a href=&quot;#1 - ShutdownTask&quot;&gt;el-1) thread #1 - ShutdownTask&lt;/a&gt; DefaultShutdownStrategy        DEBUG Suspend complete for: Consumer&lt;a href=&quot;http://url&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://url&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;#1 - ShutdownTask&quot;&gt;el-1) thread #1 - ShutdownTask&lt;/a&gt; DefaultShutdownStrategy        INFO  Route: route1 suspended and shutdown deferred, was consuming from: Endpoint&lt;a href=&quot;http://url&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://url&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Unit tests that don&apos;t read from that http url seem to work fine.&lt;/p&gt;

&lt;p&gt;Should i open a new jira for this?&lt;/p&gt;</comment>
                            <comment id="13037692" author="njiang" created="Mon, 23 May 2011 01:30:50 +0000"  >&lt;p&gt;@Fernando&lt;br/&gt;
Did you send the request to the &lt;a href=&quot;http://uri&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://uri&lt;/a&gt; ?&lt;br/&gt;
I don&apos;t find any stack trace in the log file that you showed us.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12463389" name="patch.diff" size="581" author="lhein" created="Mon, 25 Oct 2010 19:47:23 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 26 Oct 2010 06:42:29 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>76299</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 28 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310041" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Patch Info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10042"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i01tr3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>8589</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>