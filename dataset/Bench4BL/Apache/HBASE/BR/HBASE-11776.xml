<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sat Dec 03 16:14:52 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-11776/HBASE-11776.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-11776] All RegionServers crash when compact when setting TTL</title>
                <link>https://issues.apache.org/jira/browse/HBASE-11776</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;As We create the table with TTL in columnFamily, When files was selected to compact and the files&apos;s KVs all expired, after this, it generate a file just contains some meta-info such as trail,but without kvs(size:564bytes). (and the storeFile.getReader().getMaxTimestamp() = -1)&lt;/p&gt;

&lt;p&gt;And then We put the data to this table so fast, so memStore will flush to storefile, and cause the compact task,unexpected thing happens: the storefiles&apos;s count keeps on increasing all the time.&lt;/p&gt;

&lt;p&gt;seeing the debug log : &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-style: solid;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;border-bottom-style: solid;&quot;&gt;&lt;b&gt;hbase-regionServer.log&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2014-08-17 15:41:02,689 DEBUG [regionserver60020-smallCompactions-1408258247722] regionserver.CompactSplitThread: CompactSplitThread Status: compaction_queue=(0:1), split_queue=0, merge_queue=0
2014-08-17 15:41:02,689 DEBUG [regionserver60020-smallCompactions-1408258247722] compactions.RatioBasedCompactionPolicy: Selecting compaction from 9 store files, 0 compacting, 9 eligible, 10 blocking
2014-08-17 15:41:02,689 INFO  [regionserver60020-smallCompactions-1408258247722] compactions.RatioBasedCompactionPolicy: Deleting the expired store file by compaction: hdfs:&lt;span class=&quot;code-comment&quot;&gt;//hbase:9000/hbase/data/&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/top_subchannel_2/0b47596c0bff1a60cf749cf1101eb642/s/c6392d54411a46cbb19350d706a298be whose maxTimeStamp is -1 &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; the max expired timestamp is 1408257662689
&lt;/span&gt;2014-08-17 15:41:02,689 DEBUG [regionserver60020-smallCompactions-1408258247722] regionserver.HStore: 0b47596c0bff1a60cf749cf1101eb642 - s: Initiating minor compaction
2014-08-17 15:41:02,689 INFO  [regionserver60020-smallCompactions-1408258247722] regionserver.HRegion: Starting compaction on s in region top_subchannel_2,,1407982287422.0b47596c0bff1a60cf749cf1101eb642.
2014-08-17 15:41:02,689 INFO  [regionserver60020-smallCompactions-1408258247722] regionserver.HStore: Starting compaction of 1 file(s) in s of top_subchannel_2,,1407982287422.0b47596c0bff1a60cf749cf1101eb642. into tmpdir=hdfs:&lt;span class=&quot;code-comment&quot;&gt;//hbase:9000/hbase/data/&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/top_subchannel_2/0b47596c0bff1a60cf749cf1101eb642/.tmp, totalSize=564
&lt;/span&gt;2014-08-17 15:41:02,689 DEBUG [regionserver60020-smallCompactions-1408258247722] compactions.Compactor: Compacting hdfs:&lt;span class=&quot;code-comment&quot;&gt;//hbase:9000/hbase/data/&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/top_subchannel_2/0b47596c0bff1a60cf749cf1101eb642/s/c6392d54411a46cbb19350d706a298be, keycount=0, bloomtype=NONE, size=564, encoding=FAST_DIFF, seqNum=45561
&lt;/span&gt;2014-08-17 15:41:02,711 INFO  [regionserver60020-smallCompactions-1408258247722] regionserver.StoreFile: HFile Bloom filter type &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; f2e60ae4574a4d6eb89745d43582e9b4: NONE, but ROW specified in column family configuration
2014-08-17 15:41:02,713 DEBUG [regionserver60020-smallCompactions-1408258247722] regionserver.HRegionFileSystem: Committing store file hdfs:&lt;span class=&quot;code-comment&quot;&gt;//hbase:9000/hbase/data/&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/top_subchannel_2/0b47596c0bff1a60cf749cf1101eb642/.tmp/f2e60ae4574a4d6eb89745d43582e9b4 as hdfs://hbase:9000/hbase/data/&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/top_subchannel_2/0b47596c0bff1a60cf749cf1101eb642/s/f2e60ae4574a4d6eb89745d43582e9b4
&lt;/span&gt;2014-08-17 15:41:02,726 INFO  [regionserver60020-smallCompactions-1408258247722] regionserver.StoreFile: HFile Bloom filter type &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; f2e60ae4574a4d6eb89745d43582e9b4: NONE, but ROW specified in column family configuration
2014-08-17 15:41:02,727 DEBUG [regionserver60020-smallCompactions-1408258247722] regionserver.HStore: Removing store files after compaction...
2014-08-17 15:41:02,731 DEBUG [regionserver60020-smallCompactions-1408258247722] backup.HFileArchiver: Finished archiving from class org.apache.hadoop.hbase.backup.HFileArchiver$FileableStoreFile, file:hdfs:&lt;span class=&quot;code-comment&quot;&gt;//hbase:9000/hbase/data/&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/top_subchannel_2/0b47596c0bff1a60cf749cf1101eb642/s/c6392d54411a46cbb19350d706a298be, to hdfs://hbase:9000/hbase/archive/data/&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/top_subchannel_2/0b47596c0bff1a60cf749cf1101eb642/s/c6392d54411a46cbb19350d706a298be
&lt;/span&gt;2014-08-17 15:41:02,731 INFO  [regionserver60020-smallCompactions-1408258247722] regionserver.HStore: Completed compaction of 1 file(s) in s of top_subchannel_2,,1407982287422.0b47596c0bff1a60cf749cf1101eb642. into f2e60ae4574a4d6eb89745d43582e9b4(size=564), total size &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; store is 25.8 M. This selection was in queue &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; 0sec, and took 0sec to execute.
2014-08-17 15:41:02,731 INFO  [regionserver60020-smallCompactions-1408258247722] regionserver.CompactSplitThread: Completed compaction: Request = regionName=top_subchannel_2,,1407982287422.0b47596c0bff1a60cf749cf1101eb642., storeName=s, fileCount=1, fileSize=564, priority=2, time=10316710063714; duration=0sec
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Because of the &quot;empty storefile&quot; MaxTimestamp is -1,it have priority to compact first. it will be deleted,but generate a copy of it. though the compact task done,but the count didn&apos;t decrease. &lt;/p&gt;

&lt;p&gt;when the count of storefiles more than 10, so we got CompactPriority = -1, the CompactThread will require recursive enqueues again and again very soon.&lt;br/&gt;
Terrible things happen: the debug log increasing so fast,the flusherThread blocking,and the &quot;empty storefile&quot; generate and remove again and again. and we are keeping on puting data to the table, and the client get a lot of RegionTooBusyException.After a while, the regionServer crash because the MemStoreFlusher is die. so the region was assigning to other regionServer. As doing the same things, also, the regionServer crashed,then all the regionserver crashed....&lt;/p&gt;

&lt;p&gt;I think this is a bug for ttl&amp;amp;compact,so we need to generate the store file without keyvalues after the compcat done?&lt;/p&gt;</description>
                <environment>&lt;p&gt;ubuntu 12.04&lt;br/&gt;
jdk1.7.0_06&lt;/p&gt;</environment>
        <key id="12734940">HBASE-11776</key>
            <summary>All RegionServers crash when compact when setting TTL</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.png">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="3">Duplicate</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="bdifn">wuchengzhi</reporter>
                        <labels>
                    </labels>
                <created>Tue, 19 Aug 2014 03:48:39 +0000</created>
                <updated>Tue, 19 Aug 2014 06:33:46 +0000</updated>
                            <resolved>Tue, 19 Aug 2014 06:33:46 +0000</resolved>
                                    <version>0.96.1.1</version>
                                                    <component>Compaction</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                    <timeoriginalestimate seconds="259200">72h</timeoriginalestimate>
                            <timeestimate seconds="259200">72h</timeestimate>
                                        <comments>
                            <comment id="14101821" author="yuzhihong@gmail.com" created="Tue, 19 Aug 2014 04:05:54 +0000"  >&lt;p&gt;Can you take a look at &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-10141&quot; title=&quot;instead of putting expired store files thru compaction, just archive them&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-10141&quot;&gt;&lt;del&gt;HBASE-10141&lt;/del&gt;&lt;/a&gt; ?&lt;/p&gt;</comment>
                            <comment id="14101854" author="anoop.hbase" created="Tue, 19 Aug 2014 05:04:38 +0000"  >&lt;p&gt;Same issue as in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-9648&quot; title=&quot;collection one expired storefile causes it to be replaced by another expired storefile&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-9648&quot;&gt;HBASE-9648&lt;/a&gt;??&lt;/p&gt;</comment>
                            <comment id="14101922" author="bdifn" created="Tue, 19 Aug 2014 06:27:24 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ted_yu&quot; class=&quot;user-hover&quot; rel=&quot;ted_yu&quot;&gt;Ted Yu&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=anoop.hbase&quot; class=&quot;user-hover&quot; rel=&quot;anoop.hbase&quot;&gt;Anoop Sam John&lt;/a&gt;&lt;br/&gt;
yet, it&apos;s the same problems,i just testing in 0.98.5 right now,it seems have fixed.&lt;/p&gt;</comment>
                            <comment id="14101923" author="bdifn" created="Tue, 19 Aug 2014 06:33:46 +0000"  >&lt;p&gt;duplicate issue&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                            <outwardlinks description="blocks">
                                        <issuelink>
            <issuekey id="12670327">HBASE-9648</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12684309">HBASE-10141</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 19 Aug 2014 04:05:54 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>412880</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 15 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1z0xr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>412866</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>