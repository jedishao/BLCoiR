<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 02 19:16:34 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-236/HBASE-236.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-236] NPE on failed open of region</title>
                <link>https://issues.apache.org/jira/browse/HBASE-236</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;From Bryan Duxbury supplied log:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;   1044 2007-12-15 04:37:56,052 INFO org.apache.hadoop.hbase.HRegionServer: MSG_REGION_OPEN : spider_pages,7_202623541,1197662034823
   1045 2007-12-15 04:37:56,060 ERROR org.apache.hadoop.hbase.HRegionServer: error opening region spider_pages,7_202623541,1197662034823
   1046 java.io.EOFException
   1047     at java.io.DataInputStream.readByte(DataInputStream.java:250)
   1048     at org.apache.hadoop.hbase.HStoreFile.loadInfo(HStoreFile.java:594)
   1049     at org.apache.hadoop.hbase.HStore.&amp;lt;init&amp;gt;(HStore.java:613)
   1050     at org.apache.hadoop.hbase.HRegion.&amp;lt;init&amp;gt;(HRegion.java:287)
   1051     at org.apache.hadoop.hbase.HRegionServer.openRegion(HRegionServer.java:1182)
   1052     at org.apache.hadoop.hbase.HRegionServer$Worker.run(HRegionServer.java:1133)
   1053     at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:619)
   1054 2007-12-15 04:37:56,061 FATAL org.apache.hadoop.hbase.HRegionServer: Unhandled exception                                                                                                                                                                                                                               1055 java.lang.NullPointerException
   1056     at org.apache.hadoop.hbase.HRegionServer.reportClose(HRegionServer.java:1066)
   1057     at org.apache.hadoop.hbase.HRegionServer.openRegion(HRegionServer.java:1188)
   1058     at org.apache.hadoop.hbase.HRegionServer$Worker.run(HRegionServer.java:1133)
   1059     at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:619)
   1060 2007-12-15 04:37:56,061 INFO org.apache.hadoop.hbase.HRegionServer: worker thread exiting
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I see same exception when we try to deploy same region on another server; the info file must be horked (Seems like something we could recover from reading through looking for highest sequence number; would be expensive but alternative is lost region).&lt;/p&gt;</description>
                <environment></environment>
        <key id="12384805">HBASE-236</key>
            <summary>NPE on failed open of region</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jimk">Jim Kellerman</assignee>
                                    <reporter username="stack">stack</reporter>
                        <labels>
                    </labels>
                <created>Mon, 17 Dec 2007 20:09:53 +0000</created>
                <updated>Fri, 22 Aug 2008 21:13:06 +0000</updated>
                            <resolved>Mon, 14 Apr 2008 16:44:14 +0000</resolved>
                                    <version>0.2.0</version>
                                    <fixVersion>0.2.0</fixVersion>
                                    <component>regionserver</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12552588" author="bryanduxbury" created="Tue, 18 Dec 2007 00:31:57 +0000"  >&lt;p&gt;Since there&apos;s data loss potential here, this seems like it should be higher priority.&lt;/p&gt;</comment>
                            <comment id="12565484" author="bryanduxbury" created="Mon, 4 Feb 2008 19:24:47 +0000"  >&lt;p&gt;Has this issue come up again? If not, we should close the issue.&lt;/p&gt;</comment>
                            <comment id="12565487" author="jimk" created="Mon, 4 Feb 2008 19:30:52 +0000"  >&lt;p&gt;I think this could still happen if a region server crashes in the middle of a cache flush (which could leave a zero length MapFile or info file.&lt;/p&gt;

&lt;p&gt;We could put some defensive measures in HStore to prevent the problem, and if HLog does not guard against zero length files it should as well.&lt;/p&gt;

&lt;p&gt;Finally, hbase-fsck (or whatever we call it) should check for zero length files.&lt;/p&gt;</comment>
                            <comment id="12570035" author="bryanduxbury" created="Mon, 18 Feb 2008 22:51:23 +0000"  >&lt;p&gt;Let&apos;s add the suggested zero-length checks where appropriate. Jim, do you want to tackle this one?&lt;/p&gt;</comment>
                            <comment id="12570059" author="jimk" created="Tue, 19 Feb 2008 00:08:44 +0000"  >&lt;p&gt;I thought that the worker thread would no longer exit in trunk. Are you running trunk or an older version?&lt;/p&gt;</comment>
                            <comment id="12570064" author="bryanduxbury" created="Tue, 19 Feb 2008 00:33:06 +0000"  >&lt;p&gt;I haven&apos;t seen this problem recently. I was responding to Jim&apos;s above comment regarding other situations when this could occur.&lt;/p&gt;</comment>
                            <comment id="12571821" author="jimk" created="Sun, 24 Feb 2008 01:19:23 +0000"  >&lt;p&gt;The worker thread will no longer exit.&lt;/p&gt;

&lt;p&gt;However, we still need to deal with bad files.&lt;/p&gt;

&lt;p&gt;HLog can handle zero length log files in splitLog. &lt;/p&gt;

&lt;p&gt;HStoreFile still needs to be made more robust. There are up to 3 files in each HStoreFile:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;the mapFile&lt;/li&gt;
	&lt;li&gt;the infoFile&lt;/li&gt;
	&lt;li&gt;bloomFilter file (optional)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;For this immediate problem, HStore.loadHStoreFiles should throw an error if one of these files does not exist or is zero length (ignoring the bloomFilter file if the column is not configured with one). This would be caught by the worker thread, which would mark the region offline in the meta (so the master won&apos;t try to reassign it) and the region server should tell the master about the bad region. The master (and/or) region server needs to notify the user (How? People complain about stuff like this only being in the logs. In the web ui? On stdout?)&lt;/p&gt;

&lt;p&gt;Moving forward, the user should be directed to run HBase-fsck (or whatever it will be called).&lt;/p&gt;

&lt;p&gt;Additionally, if we are going to create our own &apos;mapFile&apos; format, why not combine all of these into a single file? Seems kind of silly to have those little info files around, and there is no reason that a bloom filter couldn&apos;t be stored in the same file as well.&lt;/p&gt;</comment>
                            <comment id="12571826" author="bryanduxbury" created="Sun, 24 Feb 2008 02:01:14 +0000"  >&lt;p&gt;One problem with these busted regions just getting permanently offlined is that there will be holes in the table. We should consider updating the start and end keys for the two regions on either side so this won&apos;t be a problem.&lt;/p&gt;

&lt;p&gt;I agree that the custom mapfile implementation could encompass all of these little external files. More, there will probably be a mandatory bloom filter in the new mapfile.&lt;/p&gt;</comment>
                            <comment id="12571835" author="jimk" created="Sun, 24 Feb 2008 02:26:03 +0000"  >&lt;p&gt;I don&apos;t envision regions being permanently offline if HBase-fsck can fix them.&lt;/p&gt;</comment>
                            <comment id="12571865" author="stack" created="Sun, 24 Feb 2008 06:00:52 +0000"  >&lt;p&gt;+1 on combing info and bloom filter all into one file (I&apos;d imagine info and bloom filter might be done as metadata on a SequenceFile).  Should we also add index (BigTable adds them to end of the file).  Will help w/ the too-many-open files issue.&lt;/p&gt;</comment>
                            <comment id="12571866" author="bryanduxbury" created="Sun, 24 Feb 2008 06:05:57 +0000"  >&lt;p&gt;Let&apos;s spend some more time planning for the custom mapfile, and integrate these last few comments in the design. If only someone had drafted a provisional new store file interface spec...&lt;/p&gt;</comment>
                            <comment id="12576386" author="jimk" created="Fri, 7 Mar 2008 21:48:04 +0000"  >&lt;p&gt;Unmarking this as a blocker for 0.1.0. In 0.1.0, any exception that occurs during region open is caught, and the region is marked off-line.&lt;/p&gt;

&lt;p&gt;More extensive recovery should be slated for 0.2.0&lt;/p&gt;</comment>
                            <comment id="12588640" author="jimk" created="Mon, 14 Apr 2008 16:31:22 +0000"  >&lt;p&gt;hbase-fsck (or whatever we call it)&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;should check for zero length files.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Since we no longer offline broken regions, as long as hbase-fsck can fix them, then it is no longer a part of &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-236&quot; title=&quot;NPE on failed open of region&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-236&quot;&gt;&lt;del&gt;HBASE-236&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;
</comment>
                            <comment id="12588641" author="jimk" created="Mon, 14 Apr 2008 16:33:49 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-61&quot; title=&quot;[hbase] Create an HBase-specific MapFile implementation&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-61&quot;&gt;&lt;del&gt;HBASE-61&lt;/del&gt;&lt;/a&gt; will address the new MapFile format discussed in this issue.&lt;/p&gt;</comment>
                            <comment id="12588645" author="jimk" created="Mon, 14 Apr 2008 16:40:25 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-433&quot; title=&quot;region server should deleted restore log after successfull restore&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-433&quot;&gt;&lt;del&gt;HBASE-433&lt;/del&gt;&lt;/a&gt; addressed HLog issues processing zero length files&lt;/p&gt;</comment>
                            <comment id="12588646" author="jimk" created="Mon, 14 Apr 2008 16:42:06 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-11&quot; title=&quot;[hbase] Unexpected exits corrupt DFS&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-11&quot;&gt;&lt;del&gt;HBASE-11&lt;/del&gt;&lt;/a&gt; will address EOFExceptions while replaying logs.&lt;/p&gt;</comment>
                            <comment id="12588648" author="jimk" created="Mon, 14 Apr 2008 16:44:13 +0000"  >&lt;p&gt;Since all the remaining issues associated with this bug are (or will be) addressed by other Jiras resolving this issue.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310010">
                    <name>Incorporates</name>
                                                                <inwardlinks description="is part of">
                                        <issuelink>
            <issuekey id="12388282">HBASE-433</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12387516">HBASE-11</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12384791">HBASE-7</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12386229">HBASE-61</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 18 Dec 2007 00:31:57 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>25020</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 34 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0h5qf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>98191</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>