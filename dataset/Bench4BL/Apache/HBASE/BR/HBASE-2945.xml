<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sat Dec 03 16:42:01 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-2945/HBASE-2945.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-2945] stop using string for block name in LRU block cache/hfile</title>
                <link>https://issues.apache.org/jira/browse/HBASE-2945</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;all my profiling runs indicate there is a large number of string/char[] objects and string manipulation is taking a long time in profiling runs.  These come from the LRU block cache, block id.  Also we should support the eviction of blocks belonging to particular hfiles, and the current code doesn&apos;t help with that right now.&lt;/p&gt;

&lt;p&gt;Let&apos;s do something better.  Whatever that might be.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12472991">HBASE-2945</key>
            <summary>stop using string for block name in LRU block cache/hfile</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="3">Duplicate</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="ryanobjc">ryan rawson</reporter>
                        <labels>
                    </labels>
                <created>Wed, 1 Sep 2010 01:26:48 +0000</created>
                <updated>Thu, 26 Jul 2012 22:22:58 +0000</updated>
                            <resolved>Thu, 26 Jul 2012 22:22:58 +0000</resolved>
                                    <version>0.89.20100621</version>
                                                    <component>Performance</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="12904867" author="streamy" created="Wed, 1 Sep 2010 01:43:36 +0000"  >&lt;p&gt;The LRU is currently backed by a ConcurrentHashMap and I don&apos;t think there&apos;s a way to use byte[] on that, so would require a biggish change.&lt;/p&gt;

&lt;p&gt;I thought there was a jira about evicting blocks when the files they came from got closed but I can&apos;t find it.  I think it&apos;s an interesting direction, just not sure if it will really be a big win, after all this is what LRUs are for.  Might help with GC by removing references to cached blocks as soon as possible and en masse.&lt;/p&gt;

&lt;p&gt;I think if we are going to do a revamp of the block cache we should come up with a good set of benchmarks to run.  Shouldn&apos;t be too bad to run it standalone and be able to measure the impact of different things as it shows up in profiling and as it relates to GC and performance.&lt;/p&gt;</comment>
                            <comment id="12904873" author="streamy" created="Wed, 1 Sep 2010 02:08:54 +0000"  >&lt;p&gt;Also, we should review the high/low watermark values.  I made those up rather arbitrarily.  With the current defaults, what I&apos;ve seen in practice is under heady read load there are very frequent evictions (ever few seconds) but each is only evicting a small amount of memory (10% of total block cache size).  Considering the evictions are non-blocking and do seem to keep up regardless, would evicting 2-3X as much each time yield better or worse GC performance?  Ideal behavior, performance/gc aside, I think would be to have as little evicted each time as possible.&lt;/p&gt;

&lt;p&gt;More discussion about changing the block cache lru is over on &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2663&quot; title=&quot;LRU cache makes needless datastructure copies during eviction&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2663&quot;&gt;&lt;del&gt;HBASE-2663&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="12905038" author="stack" created="Wed, 1 Sep 2010 14:46:54 +0000"  >&lt;blockquote&gt;&lt;p&gt;The LRU is currently backed by a ConcurrentHashMap and I don&apos;t think there&apos;s a way to use byte[] on that...&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes, we&apos;d need to make a class to wrap byte array and used memcmp for comparator.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I think if we are going to do a revamp of the block cache we should come up with a good set of benchmarks to run.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;+1&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Also, we should review the high/low watermark values. I made those up rather arbitrarily.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;And they should evolve with the loading if possible.  If read-only loading, give over more of heap to block cache.  Revive a soft references cache?  I couldn&apos;t make it work w/o OOME&apos;ing before but that was a good while back.&lt;/p&gt;


</comment>
                            <comment id="12905084" author="streamy" created="Wed, 1 Sep 2010 16:39:23 +0000"  >&lt;blockquote&gt;&lt;p&gt;And they should evolve with the loading if possible. If read-only loading, give over more of heap to block cache.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;More heap to block cache would be a different config parameter than the watermarks, but completely agree as well.  I think once we make the jump to a more complex picture of &quot;load&quot;, we can think about using that information for heap allocation within the RS.&lt;/p&gt;

&lt;p&gt;For the watermarks, we are currently triggering an eviction at like 85% full and draining to 75% (of the block caches total heap).  So if we give default of 20% to block cache, in practice we&apos;ll usually only fill to 85% of that 20% (~17%).  The MemStore has a high watermark of 40% of total heap and low of 35%.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Revive a soft references cache? &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;That&apos;s a big -1 from me.  This would take us back to before HeapSize days and watermarks above would go away (we lose the ability to control this stuff).  And all testing we did way back showed lots of undesirable behavior from soft refs.&lt;/p&gt;</comment>
                            <comment id="13423507" author="lhofhansl" created="Thu, 26 Jul 2012 22:22:58 +0000"  >&lt;p&gt;This is a duplication of &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5001&quot; title=&quot;Improve the performance of block cache keys&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5001&quot;&gt;&lt;del&gt;HBASE-5001&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12466141">HBASE-2663</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 1 Sep 2010 01:43:36 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>26551</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 19 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0hjz3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>100498</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>