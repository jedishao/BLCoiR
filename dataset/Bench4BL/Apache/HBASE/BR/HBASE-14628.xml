<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Thu Dec 01 22:56:02 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-14628/HBASE-14628.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-14628] [0.98] Save object creation for scanning with block encodings</title>
                <link>https://issues.apache.org/jira/browse/HBASE-14628</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;I noticed that (at least in 0.98 - master is entirely different) we create ByteBuffer just to create a byte[], which is then used to create a KeyValue.&lt;/p&gt;

&lt;p&gt;We can save the creation of the ByteBuffer and hence save allocating an extra object for each KV we find by creating the byte[] directly.&lt;/p&gt;

&lt;p&gt;In a Phoenix count&amp;#40;*) query that saved from 10% of runtime.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12905430">HBASE-14628</key>
            <summary>[0.98] Save object creation for scanning with block encodings</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="lhofhansl">Lars Hofhansl</assignee>
                                    <reporter username="lhofhansl">Lars Hofhansl</reporter>
                        <labels>
                    </labels>
                <created>Fri, 16 Oct 2015 07:11:43 +0000</created>
                <updated>Fri, 20 Nov 2015 11:52:51 +0000</updated>
                            <resolved>Tue, 20 Oct 2015 20:56:50 +0000</resolved>
                                                    <fixVersion>0.98.16</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>8</watches>
                                                                                                            <comments>
                            <comment id="14960575" author="anoop.hbase" created="Fri, 16 Oct 2015 12:15:53 +0000"  >&lt;p&gt;In master we have avoided many of such cases from read path.&lt;/p&gt;</comment>
                            <comment id="14960858" author="stack" created="Fri, 16 Oct 2015 15:10:50 +0000"  >&lt;p&gt;Put up a patch &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=larsh&quot; class=&quot;user-hover&quot; rel=&quot;larsh&quot;&gt;larsh&lt;/a&gt; so can see where you are digging...&lt;/p&gt;</comment>
                            <comment id="14961732" author="lhofhansl" created="Sat, 17 Oct 2015 04:28:34 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=anoop.hbase&quot; class=&quot;user-hover&quot; rel=&quot;anoop.hbase&quot;&gt;Anoop Sam John&lt;/a&gt;&lt;br/&gt;
Master still creates a ByteBuffer on the way before it creates the Cell. For offheap that&apos;s unavoidable, but it still does for onheap if I am not mistaken. Lemme take another look, I agree it looks better there.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=stack&quot; class=&quot;user-hover&quot; rel=&quot;stack&quot;&gt;stack&lt;/a&gt; I have a patch, but it fails one of the interesting tests, will post as soon as I have that fixed.&lt;/p&gt;</comment>
                            <comment id="14961752" author="lhofhansl" created="Sat, 17 Oct 2015 05:18:31 +0000"  >&lt;p&gt;Found the problem. Here&apos;s a 0.98 patch.&lt;br/&gt;
The actual macro win is 5% (not the 10% I promised above).&lt;/p&gt;

&lt;p&gt;Readability is roughly equal, I feel. Have a look and let me whether it&apos;s worth the change.&lt;/p&gt;</comment>
                            <comment id="14961763" author="ram_krish" created="Sat, 17 Oct 2015 06:03:29 +0000"  >&lt;p&gt;I think that BB creation can be avoided here in case of 0.98 because anyway all are going to be byte[] and so from the KVBuffer we can direclty copy to the new byte[] that we create for forming the individual KVs.&lt;/p&gt;</comment>
                            <comment id="14962162" author="lhofhansl" created="Sun, 18 Oct 2015 03:09:43 +0000"  >&lt;p&gt;Yep, only useful in 0.98. Worth committing? 1.0 and later do a shallow copy of the seeker state... I could try to backport that, but 0.98 might not be ready for this in other aspects.&lt;/p&gt;</comment>
                            <comment id="14962645" author="apurtell" created="Sun, 18 Oct 2015 21:58:48 +0000"  >&lt;p&gt;+1&lt;/p&gt;

&lt;p&gt;I&apos;ll take a 5% improvement in 0.98&lt;/p&gt;</comment>
                            <comment id="14962692" author="lhofhansl" created="Sun, 18 Oct 2015 23:46:11 +0000"  >&lt;p&gt;Thanks will commit later tonight.&lt;/p&gt;</comment>
                            <comment id="14962817" author="anoop.hbase" created="Mon, 19 Oct 2015 04:23:32 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="14962818" author="ram_krish" created="Mon, 19 Oct 2015 04:23:41 +0000"  >&lt;p&gt;+1 on the change. &lt;/p&gt;</comment>
                            <comment id="14962839" author="lhofhansl" created="Mon, 19 Oct 2015 05:02:36 +0000"  >&lt;p&gt;Patch needed a fix to the EncodedSeeker interface as well (since I wanted to remove the unneeded getKeyValueBuffer method - I had already fixed all tests not to use it any more).&lt;/p&gt;

&lt;p&gt;Will do a few more tests and then commit if everything looks good.&lt;/p&gt;

&lt;p&gt;The part of removing getKeyValueBuffer should be forward ported to 1.0+ I think.&lt;/p&gt;</comment>
                            <comment id="14962844" author="lhofhansl" created="Mon, 19 Oct 2015 05:09:59 +0000"  >&lt;p&gt;The DataBlockEncoder interface is marked private, so I should be able to simply remove the method from the DataBlockEncoder.EncodedSeeker interface. Any concerns with that? If so, I can add the method and its implementations back (but I&apos;d rather not).&lt;/p&gt;</comment>
                            <comment id="14964499" author="lhofhansl" created="Tue, 20 Oct 2015 04:30:58 +0000"  >&lt;p&gt;Tested the perf improvement again. Found it to be between 6% and 10% really.&lt;br/&gt;
Since the ByteBuffer is created for every KV read (regardless of whether it is returned or even used in a filter) we save a &lt;em&gt;lot&lt;/em&gt; of objects during scans.&lt;/p&gt;

&lt;p&gt;Would like to commit this. Can I get a +1 for v2?&lt;/p&gt;</comment>
                            <comment id="14964523" author="anoop.hbase" created="Tue, 20 Oct 2015 04:59:39 +0000"  >&lt;p&gt;Nice. +1&lt;/p&gt;

&lt;p&gt;Removal of API from DBE interface - We need to do it in branch-1 + also.. Another jira.   Also at that time can we avoid APIs like getValueShallowCopy etc? Do we really need them? No I think.&lt;/p&gt;</comment>
                            <comment id="14964561" author="ram_krish" created="Tue, 20 Oct 2015 05:37:46 +0000"  >&lt;p&gt;I think we can even remove this test case TestEncodedSeekers. I don&apos;t think that is really testing the actual DBE flow. I remember one such test.  May be already it got refactored i am not sure. +1 on patch.&lt;/p&gt;</comment>
                            <comment id="14965338" author="apurtell" created="Tue, 20 Oct 2015 16:24:17 +0000"  >&lt;blockquote&gt;&lt;p&gt;The DataBlockEncoder interface is marked private, so I should be able to simply remove the method from the DataBlockEncoder.EncodedSeeker interface.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;+1, that&apos;s why we have the annotations &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; &lt;/p&gt;</comment>
                            <comment id="14965720" author="lhofhansl" created="Tue, 20 Oct 2015 20:46:38 +0000"  >&lt;p&gt;Filed sub task (&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-14657&quot; title=&quot;Remove unneeded API from EncodedSeeker&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-14657&quot;&gt;&lt;del&gt;HBASE-14657&lt;/del&gt;&lt;/a&gt;) to remove the API from EncodedSeeker in 1.0+&lt;/p&gt;</comment>
                            <comment id="14965745" author="lhofhansl" created="Tue, 20 Oct 2015 20:56:31 +0000"  >&lt;p&gt;And agreed on removing getValueShallowCopy. Return a ByteBuffer from any method leaks internal implementation that we should avoid (even in in internal interface).&lt;/p&gt;</comment>
                            <comment id="14965746" author="lhofhansl" created="Tue, 20 Oct 2015 20:56:50 +0000"  >&lt;p&gt;Committed to 0.98. Thanks for looking.&lt;/p&gt;</comment>
                            <comment id="14965890" author="lhofhansl" created="Tue, 20 Oct 2015 22:28:47 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=giacomotaylor&quot; class=&quot;user-hover&quot; rel=&quot;giacomotaylor&quot;&gt;James Taylor&lt;/a&gt;, FYI. Shaves another 5-10% of many Phoenix queries that traverse a lot of KVs.&lt;/p&gt;</comment>
                            <comment id="14966122" author="hudson" created="Wed, 21 Oct 2015 02:18:00 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-0.98 #1164 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.98/1164/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.98/1164/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-14628&quot; title=&quot;[0.98] Save object creation for scanning with block encodings&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-14628&quot;&gt;&lt;del&gt;HBASE-14628&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;0.98&amp;#93;&lt;/span&gt; Save object creation for scanning with block (larsh: rev d5867a4d95ba2c795b411bf0537551f476653c49)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-prefix-tree/src/main/java/org/apache/hadoop/hbase/codec/prefixtree/PrefixTreeSeeker.java&lt;/li&gt;
	&lt;li&gt;hbase-common/src/main/java/org/apache/hadoop/hbase/io/encoding/BufferedDataBlockEncoder.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/io/encoding/TestDataBlockEncoders.java&lt;/li&gt;
	&lt;li&gt;hbase-common/src/main/java/org/apache/hadoop/hbase/io/encoding/DataBlockEncoder.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14966154" author="hudson" created="Wed, 21 Oct 2015 02:50:05 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-0.98-on-Hadoop-1.1 #1117 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.98-on-Hadoop-1.1/1117/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.98-on-Hadoop-1.1/1117/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-14628&quot; title=&quot;[0.98] Save object creation for scanning with block encodings&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-14628&quot;&gt;&lt;del&gt;HBASE-14628&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;0.98&amp;#93;&lt;/span&gt; Save object creation for scanning with block (larsh: rev d5867a4d95ba2c795b411bf0537551f476653c49)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/io/encoding/TestDataBlockEncoders.java&lt;/li&gt;
	&lt;li&gt;hbase-common/src/main/java/org/apache/hadoop/hbase/io/encoding/DataBlockEncoder.java&lt;/li&gt;
	&lt;li&gt;hbase-prefix-tree/src/main/java/org/apache/hadoop/hbase/codec/prefixtree/PrefixTreeSeeker.java&lt;/li&gt;
	&lt;li&gt;hbase-common/src/main/java/org/apache/hadoop/hbase/io/encoding/BufferedDataBlockEncoder.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14969980" author="jamestaylor" created="Thu, 22 Oct 2015 21:55:47 +0000"  >&lt;p&gt;Awesome, thanks, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lhofhansl&quot; class=&quot;user-hover&quot; rel=&quot;lhofhansl&quot;&gt;Lars Hofhansl&lt;/a&gt;!&lt;/p&gt;</comment>
                            <comment id="15015847" author="lars_francke" created="Fri, 20 Nov 2015 11:52:51 +0000"  >&lt;p&gt;This issue was closed as part of a bulk closing operation on 2015-11-20. All issues that have been resolved and where all fixVersions have been released have been closed (following discussions on the mailing list).&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12767291" name="14628-0.98-v2.txt" size="8336" author="lhofhansl" created="Mon, 19 Oct 2015 05:02:36 +0000"/>
                            <attachment id="12767193" name="14628-0.98.txt" size="6675" author="lhofhansl" created="Sat, 17 Oct 2015 05:18:31 +0000"/>
                    </attachments>
                <subtasks>
                            <subtask id="12906358">HBASE-14657</subtask>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 16 Oct 2015 12:15:53 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 1 week, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2n3o7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>