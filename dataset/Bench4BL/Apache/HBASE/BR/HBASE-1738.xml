<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 02 20:23:46 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-1738/HBASE-1738.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-1738] Scanner doesnt reset when a snapshot is created, could miss new updates into the &apos;kvset&apos; (active part)</title>
                <link>https://issues.apache.org/jira/browse/HBASE-1738</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;when a Scanner is created, it creates 2 MemStoreScanners on the kvset and the snapshot (internal names of Memstore)... if the snapshot is originally empty, it only creates the 1, for kvset.  When the snapshot is created, the outstanding Scanners now have a pointer to the tree that is now the snapshot, but no pointer to the kvset.&lt;/p&gt;

&lt;p&gt;When the flush completes, the scanner will reset the memstore scanners and &apos;see&apos; the new values again.&lt;/p&gt;

&lt;p&gt;If there is a large delay between snapshot and finalization of the flush, there can be a large period of time a scanner doesnt see &apos;new&apos; values that are being inserted. the canonical &apos;bad&apos; case where this can do things is the META scanner, and we end up with double assignment.&lt;/p&gt;

&lt;p&gt;The snapshot is really lightweight, it only takes out a small lock in memstore, so im not sure there is an easy mechanism to hook to without building out a bit more code or restructuring the memstore scanner.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12432103">HBASE-1738</key>
            <summary>Scanner doesnt reset when a snapshot is created, could miss new updates into the &apos;kvset&apos; (active part)</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="stack">stack</assignee>
                                    <reporter username="ryanobjc">ryan rawson</reporter>
                        <labels>
                    </labels>
                <created>Mon, 3 Aug 2009 23:15:40 +0000</created>
                <updated>Sun, 13 Sep 2009 22:24:53 +0000</updated>
                            <resolved>Mon, 17 Aug 2009 22:22:04 +0000</resolved>
                                    <version>0.20.0</version>
                                    <fixVersion>0.20.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12740384" author="stack" created="Fri, 7 Aug 2009 03:37:34 +0000"  >&lt;p&gt;I notice that the MemStoreScanner keeps in its result data member all KVs ever seen.  There is no clear as it crosses rows.  The internal index just keeps incrementing over the life of the MemStoreScanner.&lt;/p&gt;</comment>
                            <comment id="12740419" author="stack" created="Fri, 7 Aug 2009 05:54:22 +0000"  >&lt;p&gt;Not fully there yet.  Test failing.  Will check in morning.&lt;/p&gt;

&lt;p&gt;This patch sets up a MemStoreScanner that goes against the kvset and snapshot always.  They can change under it.  It takes out a MemStore read lock while its caching the row so snapshot ain&apos;t cleared while reading row.  Fixes fact that we were keeping around every KV ever read by the scanner.&lt;/p&gt;</comment>
                            <comment id="12742698" author="stack" created="Thu, 13 Aug 2009 03:50:36 +0000"  >&lt;p&gt;Moving to 0.20.0.  Bad bug and patch is almost there.&lt;/p&gt;</comment>
                            <comment id="12743508" author="stack" created="Sat, 15 Aug 2009 00:56:45 +0000"  >&lt;p&gt;I think I need to fix the small hole here... in 0.20.0 after all.. thinking on it.&lt;/p&gt;</comment>
                            <comment id="12744181" author="stack" created="Mon, 17 Aug 2009 20:15:34 +0000"  >&lt;p&gt;Here is v3:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
M src/test/org/apache/hadoop/hbase/regionserver/TestMemStore.java
  Reset memstore scanners at end of each full scan.
  Reenable part of test that was broken because we weren&apos;t getting
  all values.
M src/java/org/apache/hadoop/hbase/regionserver/MemStore.java
  Have MemStoreScanners become Observers on MemStore.  If MemStore
  snapshots or clears snapshots, have Scanners update themselves.
  Changes MemStore to have a single scanner &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; both kvset and &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt;
  snapshot rather than one &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; each.  Now we meld the results from
  both in the one scanner.
  New &lt;span class=&quot;code-keyword&quot;&gt;inner&lt;/span&gt; FirstOnRow class that is updated atomically.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12744211" author="streamy" created="Mon, 17 Aug 2009 21:26:49 +0000"  >&lt;p&gt;Same v3 patch but fixes heapsize stuff.  Adds update to deep overhead as well.&lt;/p&gt;</comment>
                            <comment id="12744223" author="streamy" created="Mon, 17 Aug 2009 21:47:11 +0000"  >&lt;p&gt;+1 for commit after confirmation that tests pass from stack&lt;/p&gt;</comment>
                            <comment id="12744235" author="stack" created="Mon, 17 Aug 2009 22:22:04 +0000"  >&lt;p&gt;Thanks for the help Jon.&lt;/p&gt;

&lt;p&gt;Committed branch and trunk.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12416606" name="1738-v2.patch" size="10554" author="stack" created="Fri, 14 Aug 2009 20:39:04 +0000"/>
                            <attachment id="12416802" name="1738-v3-withheapsizefix.patch" size="14640" author="streamy" created="Mon, 17 Aug 2009 21:26:49 +0000"/>
                            <attachment id="12416795" name="1738-v3.patch" size="11098" author="stack" created="Mon, 17 Aug 2009 20:15:34 +0000"/>
                            <attachment id="12415819" name="1738.patch" size="8627" author="stack" created="Fri, 7 Aug 2009 05:54:22 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 7 Aug 2009 03:37:34 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>25949</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 16 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0hezr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>99691</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>