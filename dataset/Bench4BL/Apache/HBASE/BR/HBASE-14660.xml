<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Thu Dec 01 21:01:46 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-14660/HBASE-14660.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-14660] AssertionError found when using offheap BucketCache with assertion enabled</title>
                <link>https://issues.apache.org/jira/browse/HBASE-14660</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;During perf verification of &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-14463&quot; title=&quot;Severe performance downgrade when parallel reading a single key from BucketCache&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-14463&quot;&gt;&lt;del&gt;HBASE-14463&lt;/del&gt;&lt;/a&gt;, found offheap BucketCache not working with assertion enabled in hbase-env.sh:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;export HBASE_OPTS=&quot;-ea -XX:+HeapDumpOnOutOfMemoryError -XX:+UseConcMarkSweepGC&quot;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And the error when running PE tool is like:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;15/10/21 16:06:34 INFO client.AsyncProcess: #10, table=TestTable, attempt=10/21 failed=20ops, last exception: java.io.IOException: java.io.IOException
        at org.apache.hadoop.hbase.ipc.RpcServer.call(RpcServer.java:2181)
        at org.apache.hadoop.hbase.ipc.CallRunner.run(CallRunner.java:106)
        at org.apache.hadoop.hbase.ipc.RpcExecutor.consumerLoop(RpcExecutor.java:130)
        at org.apache.hadoop.hbase.ipc.RpcExecutor$1.run(RpcExecutor.java:107)
        at java.lang.Thread.run(Thread.java:744)
Caused by: java.lang.AssertionError
        at org.apache.hadoop.hbase.OffheapKeyValue.&amp;lt;init&amp;gt;(OffheapKeyValue.java:52)
        at org.apache.hadoop.hbase.io.hfile.HFileReaderImpl$HFileScannerImpl$ShareableMemoryOffheapKeyValue.&amp;lt;init&amp;gt;(HFileReaderImpl.java:1003)
        at org.apache.hadoop.hbase.io.hfile.HFileReaderImpl$HFileScannerImpl.getCell(HFileReaderImpl.java:949)
        at org.apache.hadoop.hbase.regionserver.StoreFileScanner.reseek(StoreFileScanner.java:201)
        at org.apache.hadoop.hbase.regionserver.NonLazyKeyValueScanner.doRealSeek(NonLazyKeyValueScanner.java:55)
        at org.apache.hadoop.hbase.regionserver.KeyValueHeap.generalizedSeek(KeyValueHeap.java:323)
        at org.apache.hadoop.hbase.regionserver.KeyValueHeap.requestSeek(KeyValueHeap.java:279)
        at org.apache.hadoop.hbase.regionserver.StoreScanner.reseek(StoreScanner.java:825)
        at org.apache.hadoop.hbase.regionserver.StoreScanner.seekAsDirection(StoreScanner.java:813)
        at org.apache.hadoop.hbase.regionserver.StoreScanner.next(StoreScanner.java:641)
        at org.apache.hadoop.hbase.regionserver.KeyValueHeap.next(KeyValueHeap.java:153)
        at org.apache.hadoop.hbase.regionserver.HRegion$RegionScannerImpl.populateResult(HRegion.java:5649)
        at org.apache.hadoop.hbase.regionserver.HRegion$RegionScannerImpl.nextInternal(HRegion.java:5795)
        at org.apache.hadoop.hbase.regionserver.HRegion$RegionScannerImpl.nextRaw(HRegion.java:5568)
        at org.apache.hadoop.hbase.regionserver.HRegion$RegionScannerImpl.next(HRegion.java:5544)
        at org.apache.hadoop.hbase.regionserver.HRegion$RegionScannerImpl.next(HRegion.java:5530)
        at org.apache.hadoop.hbase.regionserver.RSRpcServices.get(RSRpcServices.java:2044)
        at org.apache.hadoop.hbase.regionserver.RSRpcServices.doNonAtomicRegionMutation(RSRpcServices.java:663)
        at org.apache.hadoop.hbase.regionserver.RSRpcServices.multi(RSRpcServices.java:2156)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ram_krish&quot; class=&quot;user-hover&quot; rel=&quot;ram_krish&quot;&gt;ramkrishna.s.vasudevan&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=anoop.hbase&quot; class=&quot;user-hover&quot; rel=&quot;anoop.hbase&quot;&gt;Anoop Sam John&lt;/a&gt;, mind to take a look?&lt;/p&gt;</description>
                <environment></environment>
        <key id="12906457">HBASE-14660</key>
            <summary>AssertionError found when using offheap BucketCache with assertion enabled</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ram_krish">ramkrishna.s.vasudevan</assignee>
                                    <reporter username="carp84">Yu Li</reporter>
                        <labels>
                    </labels>
                <created>Wed, 21 Oct 2015 08:17:04 +0000</created>
                <updated>Wed, 28 Oct 2015 12:40:33 +0000</updated>
                            <resolved>Wed, 28 Oct 2015 09:52:28 +0000</resolved>
                                    <version>2.0.0</version>
                                    <fixVersion>2.0.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                <comments>
                            <comment id="14966423" author="ram_krish" created="Wed, 21 Oct 2015 08:21:36 +0000"  >&lt;p&gt;Let me take a look now. Thanks for filing this.&lt;/p&gt;</comment>
                            <comment id="14966461" author="ram_krish" created="Wed, 21 Oct 2015 08:48:44 +0000"  >&lt;p&gt;I think I got the reason for this.  The getCell() could have created a cell that is spread across multi buffers. So the asSubByteBuffer would have created a copy of the cell into a new BB. That BB will not be a direct heap. That is reason for the assertion failure.&lt;/p&gt;</comment>
                            <comment id="14966507" author="ram_krish" created="Wed, 21 Oct 2015 09:12:44 +0000"  >&lt;p&gt;Could you try this &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=carp84&quot; class=&quot;user-hover&quot; rel=&quot;carp84&quot;&gt;Yu Li&lt;/a&gt;?&lt;/p&gt;</comment>
                            <comment id="14966517" author="carp84" created="Wed, 21 Oct 2015 09:17:58 +0000"  >&lt;p&gt;Really quick reaction! Sure, let me give it a try.&lt;/p&gt;</comment>
                            <comment id="14966528" author="carp84" created="Wed, 21 Oct 2015 09:31:08 +0000"  >&lt;p&gt;Confirmed AssertionError disappears with the patch, thanks for the quick fix &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ram_krish&quot; class=&quot;user-hover&quot; rel=&quot;ram_krish&quot;&gt;ramkrishna.s.vasudevan&lt;/a&gt;!&lt;/p&gt;

&lt;p&gt;btw, we find it necessary to enable assertion in product env since some core logic still depends on it, but there&apos;s a gap in UT (assertion disabled). Maybe we should also get this fixed?&lt;/p&gt;</comment>
                            <comment id="14966543" author="ram_krish" created="Wed, 21 Oct 2015 09:39:51 +0000"  >&lt;p&gt;This would be the better patch. The assumption in the last patch the &apos;buf&apos; if it is not direct then we can assume it to be NON_SHARED type may not be true always when in case of Onheap bucket cache. &lt;/p&gt;</comment>
                            <comment id="14966546" author="ram_krish" created="Wed, 21 Oct 2015 09:40:36 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=carp84&quot; class=&quot;user-hover&quot; rel=&quot;carp84&quot;&gt;Yu Li&lt;/a&gt; for confirming. In your case for offheap bucket cache the first patch itself will work fine. &lt;/p&gt;</comment>
                            <comment id="14966658" author="anoop.hbase" created="Wed, 21 Oct 2015 11:26:55 +0000"  >&lt;p&gt;+1 for V2 patch..  Thanks Ram and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=carp84&quot; class=&quot;user-hover&quot; rel=&quot;carp84&quot;&gt;Yu Li&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14966765" author="hadoopqa" created="Wed, 21 Oct 2015 12:57:00 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12767762/HBASE-14660_1.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12767762/HBASE-14660_1.patch&lt;/a&gt;&lt;br/&gt;
  against master branch at commit 6e3b7af0efced7351163a5011a44bfc18851fce0.&lt;br/&gt;
  ATTACHMENT ID: 12767762&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 tests included&lt;/font&gt;.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop versions&lt;/font&gt;. The patch compiles with all supported hadoop versions (2.4.0 2.4.1 2.5.0 2.5.1 2.5.2 2.6.0 2.6.1 2.7.0 2.7.1)&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 protoc&lt;/font&gt;.  The applied patch does not increase the total number of protoc compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 checkstyle&lt;/font&gt;.  The applied patch does not increase the total number of checkstyle errors&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any  new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn post-site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 core tests&lt;/font&gt;.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/16139//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/16139//testReport/&lt;/a&gt;&lt;br/&gt;
Release Findbugs (version 2.0.3) 	warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/16139//artifact/patchprocess/newFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/16139//artifact/patchprocess/newFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Checkstyle Errors: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/16139//artifact/patchprocess/checkstyle-aggregate.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/16139//artifact/patchprocess/checkstyle-aggregate.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;  Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/16139//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/16139//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14967427" author="stack" created="Wed, 21 Oct 2015 16:47:32 +0000"  >&lt;p&gt;Patch looks good. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=anoop.hbase&quot; class=&quot;user-hover&quot; rel=&quot;anoop.hbase&quot;&gt;Anoop Sam John&lt;/a&gt; just added a method for this check, this.curBlock.getMemoryType() == MemoryType.SHARED, isShared or something on curBlock. Use it on commit?&lt;/p&gt;</comment>
                            <comment id="14968851" author="ram_krish" created="Thu, 22 Oct 2015 09:23:07 +0000"  >&lt;p&gt;Updated patch using the usesSharedMemory() method added newly. Will commit this unless objections.&lt;/p&gt;</comment>
                            <comment id="14969052" author="hadoopqa" created="Thu, 22 Oct 2015 12:20:19 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12768002/HBASE-14660_2.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12768002/HBASE-14660_2.patch&lt;/a&gt;&lt;br/&gt;
  against master branch at commit ac2cfbaa58e231541021e0c736be0572b460f8c7.&lt;br/&gt;
  ATTACHMENT ID: 12768002&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 tests included&lt;/font&gt;.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop versions&lt;/font&gt;. The patch compiles with all supported hadoop versions (2.4.0 2.4.1 2.5.0 2.5.1 2.5.2 2.6.0 2.6.1 2.7.0 2.7.1)&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 protoc&lt;/font&gt;.  The applied patch does not increase the total number of protoc compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;                &lt;font color=&quot;red&quot;&gt;-1 checkstyle&lt;/font&gt;.  The applied patch generated 1748 checkstyle errors (more than the master&apos;s current 1747 errors).&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any  new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 site&lt;/font&gt;.  The patch appears to cause mvn post-site goal to fail.&lt;/p&gt;

&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core tests&lt;/font&gt;.  The patch failed these unit tests:&lt;/p&gt;


&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/16171//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/16171//testReport/&lt;/a&gt;&lt;br/&gt;
Release Findbugs (version 2.0.3) 	warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/16171//artifact/patchprocess/newFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/16171//artifact/patchprocess/newFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Checkstyle Errors: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/16171//artifact/patchprocess/checkstyle-aggregate.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/16171//artifact/patchprocess/checkstyle-aggregate.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;                Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/16171//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/16171//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14970450" author="stack" created="Fri, 23 Oct 2015 05:09:02 +0000"  >&lt;p&gt;This is too much information....&lt;/p&gt;

&lt;p&gt;956	          if (this.curBlock.usesSharedMemory()) {&lt;br/&gt;
957	            if (currTagsLen &amp;gt; 0) &lt;/p&gt;
{
958	              ret = new ShareableMemoryKeyValue(buf.array(), buf.arrayOffset() + buf.position(),
959	                  cellBufSize, seqId);
960	            }
&lt;p&gt; else &lt;/p&gt;
{
961	              ret = new ShareableMemoryNoTagsKeyValue(buf.array(),
962	                  buf.arrayOffset() + buf.position(), cellBufSize, seqId);
963	            }
&lt;p&gt;964	          } else {&lt;br/&gt;
965	            if (currTagsLen &amp;gt; 0) &lt;/p&gt;
{
966	              ret = new SizeCachedKeyValue(buf.array(), buf.arrayOffset() + buf.position(),
967	                  cellBufSize, seqId);
968	            }
&lt;p&gt; else &lt;/p&gt;
{
969	              ret = new SizeCachedNoTagsKeyValue(buf.array(), buf.arrayOffset() + buf.position(),
970	                  cellBufSize, seqId);
971	            }
&lt;p&gt;972	          }&lt;/p&gt;


&lt;p&gt;Can we hide it? This kind of decision tree is going to be repeated throughout codebase?&lt;/p&gt;
</comment>
                            <comment id="14970452" author="stack" created="Fri, 23 Oct 2015 05:09:41 +0000"  >&lt;p&gt;Retry&lt;/p&gt;</comment>
                            <comment id="14970466" author="anoop.hbase" created="Fri, 23 Oct 2015 05:22:27 +0000"  >&lt;blockquote&gt;&lt;p&gt;This kind of decision tree is going to be repeated throughout codebase?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;No this is only in here.  In case of DBEs we will have different Cell impls.&lt;/p&gt;</comment>
                            <comment id="14970479" author="stack" created="Fri, 23 Oct 2015 05:34:57 +0000"  >&lt;p&gt;Ok. How we know the right choices are being made? There is no verifying test.&lt;/p&gt;</comment>
                            <comment id="14970497" author="anoop.hbase" created="Fri, 23 Oct 2015 05:58:19 +0000"  >&lt;p&gt;+1 for adding a UT to assert the correct Cell impl is being made based on the block backing data.&lt;/p&gt;</comment>
                            <comment id="14970516" author="ram_krish" created="Fri, 23 Oct 2015 06:16:43 +0000"  >&lt;p&gt;I am off today. Let me resubmit with a test. Sent from mobile.&lt;/p&gt;</comment>
                            <comment id="14970645" author="hadoopqa" created="Fri, 23 Oct 2015 08:26:01 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12768221/HBASE-14660_2.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12768221/HBASE-14660_2.patch&lt;/a&gt;&lt;br/&gt;
  against master branch at commit eb4f9b8b32cf0551088a342cfa9b46b20593ac27.&lt;br/&gt;
  ATTACHMENT ID: 12768221&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 tests included&lt;/font&gt;.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop versions&lt;/font&gt;. The patch compiles with all supported hadoop versions (2.4.0 2.4.1 2.5.0 2.5.1 2.5.2 2.6.0 2.6.1 2.7.0 2.7.1)&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 protoc&lt;/font&gt;.  The applied patch does not increase the total number of protoc compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;                &lt;font color=&quot;red&quot;&gt;-1 checkstyle&lt;/font&gt;.  The applied patch generated 1733 checkstyle errors (more than the master&apos;s current 1732 errors).&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any  new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn post-site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core tests&lt;/font&gt;.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.client.TestBlockEvictionFromClient&lt;br/&gt;
                  org.apache.hadoop.hbase.regionserver.TestWALLockup&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/16194//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/16194//testReport/&lt;/a&gt;&lt;br/&gt;
Release Findbugs (version 2.0.3) 	warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/16194//artifact/patchprocess/newFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/16194//artifact/patchprocess/newFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Checkstyle Errors: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/16194//artifact/patchprocess/checkstyle-aggregate.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/16194//artifact/patchprocess/checkstyle-aggregate.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;                Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/16194//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/16194//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14973940" author="ram_krish" created="Mon, 26 Oct 2015 09:42:42 +0000"  >&lt;p&gt;Updated patch with test case.  &lt;/p&gt;</comment>
                            <comment id="14974160" author="hadoopqa" created="Mon, 26 Oct 2015 12:56:46 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12768684/HBASE-14660_3.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12768684/HBASE-14660_3.patch&lt;/a&gt;&lt;br/&gt;
  against master branch at commit 8a2cef3315516501627c7a30bdcf989b12a32303.&lt;br/&gt;
  ATTACHMENT ID: 12768684&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 7 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop versions&lt;/font&gt;. The patch compiles with all supported hadoop versions (2.4.0 2.4.1 2.5.0 2.5.1 2.5.2 2.6.0 2.6.1 2.7.0 2.7.1)&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 protoc&lt;/font&gt;.  The applied patch does not increase the total number of protoc compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;                &lt;font color=&quot;red&quot;&gt;-1 checkstyle&lt;/font&gt;.  The applied patch generated 1733 checkstyle errors (more than the master&apos;s current 1732 errors).&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any  new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn post-site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 core tests&lt;/font&gt;.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/16227//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/16227//testReport/&lt;/a&gt;&lt;br/&gt;
Release Findbugs (version 2.0.3) 	warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/16227//artifact/patchprocess/newFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/16227//artifact/patchprocess/newFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Checkstyle Errors: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/16227//artifact/patchprocess/checkstyle-aggregate.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/16227//artifact/patchprocess/checkstyle-aggregate.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;                Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/16227//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/16227//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14975702" author="ram_krish" created="Tue, 27 Oct 2015 04:20:29 +0000"  >&lt;blockquote&gt;&lt;p&gt;-1 checkstyle. The applied patch generated 1733 checkstyle errors (more than the master&apos;s current 1732 errors).&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;This is due to an unused import which I forgot to remove. I can do that on commit.  Any more reviews? &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=saint.ack%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;saint.ack@gmail.com&quot;&gt;Stack&lt;/a&gt;?&lt;/p&gt;</comment>
                            <comment id="14977768" author="ram_krish" created="Wed, 28 Oct 2015 05:33:52 +0000"  >&lt;p&gt;Can I get some +1s to commit this?&lt;/p&gt;</comment>
                            <comment id="14977902" author="anoop.hbase" created="Wed, 28 Oct 2015 07:39:38 +0000"  >&lt;p&gt;Looks good.&lt;br/&gt;
But one Q on the test. Do we really need start BC and do it like an FT?  Can we have a simple UT? If the HFileScaner having a single method to convert the BB into a Cell impl, we could have just added UT for this method with diff cases.  That should be sufficient?&lt;/p&gt;</comment>
                            <comment id="14977931" author="ram_krish" created="Wed, 28 Oct 2015 07:56:10 +0000"  >&lt;blockquote&gt;&lt;p&gt;If the HFileScaner having a single method to convert the BB into a Cell impl, we could have just added UT for this method with diff cases. That should be sufficient?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I specifically wanted this way like FT just because to cover all the cases and be sure of creating a SHARED or NONSHARED KV for all cases of bucket cache and LRU cache. Also we don&apos;t have such a test case with us and this test does not spin a cluster anyway.&lt;/p&gt;</comment>
                            <comment id="14978010" author="anoop.hbase" created="Wed, 28 Oct 2015 09:09:20 +0000"  >&lt;p&gt;I just asked.  FT is always better and specifically if it is not having much of overhead.  We have less overhead as we dont spin a cluster up.&lt;br/&gt;
+1&lt;/p&gt;</comment>
                            <comment id="14978073" author="ram_krish" created="Wed, 28 Oct 2015 09:44:44 +0000"  >&lt;p&gt;Thanks for the review. Will commit it after removing the unused import. &lt;/p&gt;</comment>
                            <comment id="14978093" author="ram_krish" created="Wed, 28 Oct 2015 09:52:08 +0000"  >&lt;p&gt;This is what was committed. Thanks for all the reviews.&lt;/p&gt;</comment>
                            <comment id="14978348" author="hudson" created="Wed, 28 Oct 2015 12:40:33 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-TRUNK #6973 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/6973/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/6973/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-14660&quot; title=&quot;AssertionError found when using offheap BucketCache with assertion enabled&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-14660&quot;&gt;&lt;del&gt;HBASE-14660&lt;/del&gt;&lt;/a&gt; AssertionError found when using offheap BucketCache with (ramkrishna: rev 51538c5ff89dd7ee8e32ef4895d10bfc58045b17)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/io/hfile/TestScannerFromBucketCache.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/io/hfile/HFileReaderImpl.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/io/hfile/TestSeekTo.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12767757" name="HBASE-14660.patch" size="1880" author="ram_krish" created="Wed, 21 Oct 2015 09:12:44 +0000"/>
                            <attachment id="12767762" name="HBASE-14660_1.patch" size="2205" author="ram_krish" created="Wed, 21 Oct 2015 09:39:51 +0000"/>
                            <attachment id="12768221" name="HBASE-14660_2.patch" size="3218" author="stack" created="Fri, 23 Oct 2015 05:09:41 +0000"/>
                            <attachment id="12768002" name="HBASE-14660_2.patch" size="3218" author="ram_krish" created="Thu, 22 Oct 2015 09:23:07 +0000"/>
                            <attachment id="12768684" name="HBASE-14660_3.patch" size="19580" author="ram_krish" created="Mon, 26 Oct 2015 09:42:42 +0000"/>
                            <attachment id="12769241" name="HBASE-14660_4.patch" size="20070" author="ram_krish" created="Wed, 28 Oct 2015 09:52:08 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 21 Oct 2015 08:21:36 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 5 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2n9vz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>