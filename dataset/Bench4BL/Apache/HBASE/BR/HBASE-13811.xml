<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Thu Dec 01 21:16:09 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-13811/HBASE-13811.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-13811] Splitting WALs, we are filtering out too many edits -&gt; DATALOSS</title>
                <link>https://issues.apache.org/jira/browse/HBASE-13811</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;I&apos;ve been running ITBLLs against branch-1 around &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13616&quot; title=&quot;Move ServerShutdownHandler to Pv2&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13616&quot;&gt;&lt;del&gt;HBASE-13616&lt;/del&gt;&lt;/a&gt; (move of ServerShutdownHandler to pv2). I have come across an instance of dataloss. My patch for &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13616&quot; title=&quot;Move ServerShutdownHandler to Pv2&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13616&quot;&gt;&lt;del&gt;HBASE-13616&lt;/del&gt;&lt;/a&gt; was in place so can only think it the cause (but cannot see how). When we split the logs, we are skipping legit edits. Digging.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12833919">HBASE-13811</key>
            <summary>Splitting WALs, we are filtering out too many edits -&gt; DATALOSS</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.png">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="stack">stack</assignee>
                                    <reporter username="stack">stack</reporter>
                        <labels>
                    </labels>
                <created>Sat, 30 May 2015 00:17:16 +0000</created>
                <updated>Tue, 9 Jun 2015 22:03:18 +0000</updated>
                            <resolved>Mon, 8 Jun 2015 20:50:51 +0000</resolved>
                                    <version>2.0.0</version>
                    <version>1.1.0</version>
                    <version>1.2.0</version>
                                    <fixVersion>2.0.0</fixVersion>
                    <fixVersion>1.2.0</fixVersion>
                    <fixVersion>1.1.1</fixVersion>
                                    <component>wal</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>16</watches>
                                                                <comments>
                            <comment id="14569443" author="stack" created="Tue, 2 Jun 2015 17:16:31 +0000"  >&lt;p&gt;This has taken me a while. Issue is accounting of per-store sequenceids added by the flush-by-column-family feature. This is enabled in branch-1, which is what I am testing.&lt;/p&gt;

&lt;p&gt;Issue happens if RS crashes when in the middle of a flush. What I am seeing is that on split of the WALs subsequent to the crash, we are skipping in essence a whole hfile of edits &amp;#8211; the hfile that would have been written out by the crash-curtailed flush.&lt;/p&gt;

&lt;p&gt;Happens, of course, only when a bit of scale involved... so chaos monkey has chance to bring on the condition (happens about 1 in 3 runs).&lt;/p&gt;

&lt;p&gt;After a couple of false trails, I now suspect this bit of code in FSHLog:&lt;/p&gt;

&lt;p&gt;    private void updateOldestUnflushedSequenceIds(byte[] encodedRegionName,&lt;br/&gt;
        Set&amp;lt;byte[]&amp;gt; familyNameSet, Long lRegionSequenceId) {&lt;br/&gt;
      ConcurrentMap&amp;lt;byte[], Long&amp;gt; m =&lt;br/&gt;
        getOrCreateOldestUnflushedStoreSequenceIdsOfRegion(encodedRegionName);&lt;br/&gt;
      for (byte[] familyName : familyNameSet) &lt;/p&gt;
{
        m.putIfAbsent(familyName, lRegionSequenceId);
      }
&lt;p&gt;    }&lt;/p&gt;

&lt;p&gt;When we go to flush, we REMOVE from the map of oldest outstanding sequenceids, all reference to those we are about to flush &amp;#8211; we move them to a new map which is used when the flush completes doing cleanup...&lt;/p&gt;

&lt;p&gt;If the above code block runs &amp;#8211; it is called on each append to WAL &amp;#8211; and it finds an empty map for oldest sequence ids, it will add the current sequenceid... which will likely be far in excess of what the actual oldest sequence id is.&lt;/p&gt;

&lt;p&gt;If the heartbeat runs to report these new sequenceids to the master just before we crash, then master will have these advanced seqids and they will be used when split WAL runs.&lt;/p&gt;

&lt;p&gt;Let me prove above is for sure the problem.&lt;/p&gt;

</comment>
                            <comment id="14569599" author="stack" created="Tue, 2 Jun 2015 19:16:33 +0000"  >&lt;p&gt;Confirmed the above thesis. When we start to flush, we remove current oldest sequence ids and park them in another data structure (See FSHLog#startCacheFlush). We then let appends go on while the flush is happening. Appends, if they find the oldest sequence ids empty, will add current id as the oldest sequence id (See FSHLog#updateOldestUnflushedSequenceIds pasted above). The report to the master always reads the oldests sequence ids data structure. It does not look to see if an ongoing flush going on. It used the below from FSHLog:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; getEarliestMemstoreSeqNum(&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[] encodedRegionName,
      &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[] familyName) {
    ConcurrentMap&amp;lt;&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[], &lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt;&amp;gt; oldestUnflushedStoreSequenceIdsOfRegion =
        &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.oldestUnflushedStoreSequenceIds.get(encodedRegionName);
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (oldestUnflushedStoreSequenceIdsOfRegion != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
      &lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt; result = oldestUnflushedStoreSequenceIdsOfRegion.get(familyName);
      &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; result != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; ? result.longValue() : HConstants.NO_SEQNUM;
    } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
      &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; HConstants.NO_SEQNUM;
    }
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;One fix would be to have the report to master consider ongoing flushes but let me see if can simplify this at all....&lt;/p&gt;</comment>
                            <comment id="14569956" author="stack" created="Tue, 2 Jun 2015 23:13:34 +0000"  >&lt;p&gt;Mostly logging changes so we output less but with more density including detail like sequence id at critical junctures so it easier debugging these issues going forward. Patch includes a change log.  Fix is in FSHLog getEarliestMemstoreSeqNum methods; look in the Map of currently flushing sequence ids first and then if none found here, look in the oldest sequence id map.&lt;/p&gt;

&lt;p&gt;Trying this patch against hadoopqa to see if I&apos;ve broke anything. Trying on a cluster. Need to add a test for this particular case still.&lt;/p&gt;</comment>
                            <comment id="14569963" author="stack" created="Tue, 2 Jun 2015 23:16:54 +0000"  >&lt;p&gt;Added &lt;a href=&quot;https://reviews.apache.org/r/34963/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/34963/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14569982" author="hadoopqa" created="Tue, 2 Jun 2015 23:31:31 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12737038/13811.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12737038/13811.txt&lt;/a&gt;&lt;br/&gt;
  against master branch at commit b7c0ac7cd7bebf78e5b6ce14179223fbb653e4c7.&lt;br/&gt;
  ATTACHMENT ID: 12737038&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 tests included&lt;/font&gt;.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 patch&lt;/font&gt;.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14262//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14262//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14570013" author="apache9" created="Tue, 2 Jun 2015 23:59:01 +0000"  >&lt;p&gt;My fault, haven&apos;t seen hbase jira these days...Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=stack&quot; class=&quot;user-hover&quot; rel=&quot;stack&quot;&gt;stack&lt;/a&gt; for digging.&lt;/p&gt;

&lt;p&gt;+1 on the change in getEarliestMemstoreSeqNum  but I think we should add a unit test for it?&lt;/p&gt;</comment>
                            <comment id="14570110" author="stack" created="Wed, 3 Jun 2015 01:35:14 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Apache9&quot; class=&quot;user-hover&quot; rel=&quot;Apache9&quot;&gt;Duo Zhang&lt;/a&gt; Thanks for taking a look. Yeah, unit test coming.  Playing at moment to see if I can shove all this distributed sequenceid accounting mess into a single class... be back....&lt;/p&gt;</comment>
                            <comment id="14570113" author="stack" created="Wed, 3 Jun 2015 01:36:34 +0000"  >&lt;p&gt;Patch is actually for branch-1 at moment (that is what I am testing against). Add the branch-1 suffix.&lt;/p&gt;</comment>
                            <comment id="14570198" author="apache9" created="Wed, 3 Jun 2015 03:01:28 +0000"  >&lt;p&gt;Write a testcase. It fails for me with&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;java.lang.AssertionError: actual array was null
	at org.apache.hadoop.hbase.regionserver.TestSplitWalDataLoss.test(TestSplitWalDataLoss.java:153)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I think the fix should also be applied to branch-1.1 since it will cause data loss even if we turn off flush per CF(but no issues if you turn on DLR...). &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ndimiduk&quot; class=&quot;user-hover&quot; rel=&quot;ndimiduk&quot;&gt;Nick Dimiduk&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14570236" author="hadoopqa" created="Wed, 3 Jun 2015 04:01:02 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12737061/13811.branch-1.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12737061/13811.branch-1.txt&lt;/a&gt;&lt;br/&gt;
  against branch-1 branch at commit de01553bc480a13b5a9a3c788ca065724522ddae.&lt;br/&gt;
  ATTACHMENT ID: 12737061&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 tests included&lt;/font&gt;.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop versions&lt;/font&gt;. The patch compiles with all supported hadoop versions (2.4.1 2.5.2 2.6.0)&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 protoc&lt;/font&gt;.  The applied patch does not increase the total number of protoc compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 checkstyle&lt;/font&gt;.  The applied patch does not increase the total number of checkstyle errors&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any  new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core tests&lt;/font&gt;.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.master.TestGetLastFlushedSequenceId&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14263//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14263//testReport/&lt;/a&gt;&lt;br/&gt;
Release Findbugs (version 2.0.3) 	warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14263//artifact/patchprocess/newFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14263//artifact/patchprocess/newFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Checkstyle Errors: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14263//artifact/patchprocess/checkstyle-aggregate.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14263//artifact/patchprocess/checkstyle-aggregate.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;  Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14263//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14263//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14570258" author="stack" created="Wed, 3 Jun 2015 04:21:41 +0000"  >&lt;p&gt;Thanks for the nice test &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Apache9&quot; class=&quot;user-hover&quot; rel=&quot;Apache9&quot;&gt;Duo Zhang&lt;/a&gt;. With my patch in place, it seems to run for ever. That seems to be by design (smile). Let me try and address.&lt;/p&gt;

&lt;p&gt;Failure looks related. Looking too...&lt;/p&gt;</comment>
                            <comment id="14570273" author="apache9" created="Wed, 3 Jun 2015 04:48:27 +0000"  >&lt;p&gt;Yeah, with the patch in place&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
	    &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (;;) {
	      RegionStoreSequenceIds ids =
	          testUtil.getMiniHBaseCluster().getMaster().getServerManager()
	              .getLastFlushedSequenceId(region.getRegionInfo().getEncodedNameAsBytes());
	      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (ids.getStoreSequenceId(0).getSequenceId() &amp;gt; oldestSeqIdOfStore) {
	        &lt;span class=&quot;code-keyword&quot;&gt;break&lt;/span&gt;;
	      }
	      &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.sleep(100);
	    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This will not happen so the testcase does not quit...Let me see...&lt;/p&gt;</comment>
                            <comment id="14570289" author="apache9" created="Wed, 3 Jun 2015 05:11:06 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=stack&quot; class=&quot;user-hover&quot; rel=&quot;stack&quot;&gt;stack&lt;/a&gt; Try this one? Just make a RegionServerReport manually instead of waiting the regionserver thread to do it for us.&lt;/p&gt;

&lt;p&gt; I modified getEarliestMemstoreSeqNum and it passed locally.&lt;/p&gt;</comment>
                            <comment id="14570310" author="hadoopqa" created="Wed, 3 Jun 2015 05:45:11 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12737073/HBASE-13811.testcase.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12737073/HBASE-13811.testcase.patch&lt;/a&gt;&lt;br/&gt;
  against master branch at commit 722fd17069a302f4de12c22212d54d80bed81aed.&lt;br/&gt;
  ATTACHMENT ID: 12737073&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 4 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop versions&lt;/font&gt;. The patch compiles with all supported hadoop versions (2.4.1 2.5.2 2.6.0)&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 protoc&lt;/font&gt;.  The applied patch does not increase the total number of protoc compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 checkstyle&lt;/font&gt;.  The applied patch does not increase the total number of checkstyle errors&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any  new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core tests&lt;/font&gt;.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.TestRegionRebalancing&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14265//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14265//testReport/&lt;/a&gt;&lt;br/&gt;
Release Findbugs (version 2.0.3) 	warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14265//artifact/patchprocess/newFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14265//artifact/patchprocess/newFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Checkstyle Errors: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14265//artifact/patchprocess/checkstyle-aggregate.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14265//artifact/patchprocess/checkstyle-aggregate.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;  Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14265//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14265//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14570430" author="hadoopqa" created="Wed, 3 Jun 2015 07:38:37 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12737087/HBASE-13811-v1.testcase.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12737087/HBASE-13811-v1.testcase.patch&lt;/a&gt;&lt;br/&gt;
  against master branch at commit 722fd17069a302f4de12c22212d54d80bed81aed.&lt;br/&gt;
  ATTACHMENT ID: 12737087&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 4 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop versions&lt;/font&gt;. The patch compiles with all supported hadoop versions (2.4.1 2.5.2 2.6.0)&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 protoc&lt;/font&gt;.  The applied patch does not increase the total number of protoc compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 checkstyle&lt;/font&gt;.  The applied patch does not increase the total number of checkstyle errors&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any  new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core tests&lt;/font&gt;.  The patch failed these unit tests:&lt;/p&gt;


&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14266//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14266//testReport/&lt;/a&gt;&lt;br/&gt;
Release Findbugs (version 2.0.3) 	warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14266//artifact/patchprocess/newFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14266//artifact/patchprocess/newFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Checkstyle Errors: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14266//artifact/patchprocess/checkstyle-aggregate.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14266//artifact/patchprocess/checkstyle-aggregate.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;  Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14266//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14266//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14571848" author="stack" created="Wed, 3 Jun 2015 23:52:04 +0000"  >&lt;p&gt;Refactored moving all to do with sequenceid accounting into own package protected class. Added then tests for the sequenceid accounting.&lt;/p&gt;

&lt;p&gt;Added &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Apache9&quot; class=&quot;user-hover&quot; rel=&quot;Apache9&quot;&gt;Duo Zhang&lt;/a&gt; test to the patch too.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Apache9&quot; class=&quot;user-hover&quot; rel=&quot;Apache9&quot;&gt;Duo Zhang&lt;/a&gt; I changed TestGetLastFlushedSequenceId. The supposition that the region flushed id would be greater than the store flush id didn&apos;t make sense to me &amp;#8211; perhaps I am missing something. Made more sense that they would be equal after a flush. See what you think.&lt;/p&gt;</comment>
                            <comment id="14571850" author="stack" created="Wed, 3 Jun 2015 23:53:24 +0000"  >&lt;p&gt;Updated &lt;a href=&quot;https://reviews.apache.org/r/34963/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/34963/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14571866" author="stack" created="Thu, 4 Jun 2015 00:02:57 +0000"  >&lt;p&gt;The TestSplitWalDataLoss hangs for me when I run on cmdline but passes in IDE. Lets see how it does here.  I can make a simpler fix to backport to branch-1.1 in case anyone wants to try per-cf-flush.  Testing this latest patch on cluster to see how it does.&lt;/p&gt;</comment>
                            <comment id="14571917" author="apache9" created="Thu, 4 Jun 2015 00:46:34 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
flushOpSeqId = getNextSequenceId(wal);
flushedSeqId = getFlushedSequenceId(encodedRegionName, flushOpSeqId);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I think the problem is here...&lt;br/&gt;
Before the patch, getFlushedSequenceId will return flushOpSeqId because getEarliestMemstoreSeqNum will return HConstants.NO_SEQNUM. But now we modify getEarliestMemstoreSeqNum, it will also consider the sequenceIds recorded in flushingSequenceIds so it will not return HConstants.NO_SEQNUM even if we decided to flush all stores. This may cause we replay unnecessary edits I think.&lt;/p&gt;

&lt;p&gt;So the problem is here we only want to consider the sequenceIds in lowestUnflushedSequenceIds, so maybe a new method?&lt;/p&gt;

&lt;p&gt;Thanks. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=stack&quot; class=&quot;user-hover&quot; rel=&quot;stack&quot;&gt;stack&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14571993" author="stack" created="Thu, 4 Jun 2015 02:26:11 +0000"  >&lt;p&gt;If I make this change:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
diff --git a/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java b/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java
index dc3f4b5..4496a59 100644
--- a/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java
+++ b/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java
@@ -2157,7 +2157,7 @@ &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; class HRegion &lt;span class=&quot;code-keyword&quot;&gt;implements&lt;/span&gt; HeapSize, PropagatingConfigurationObserver, Regi
               myseqid);
           }
           flushOpSeqId = getNextSequenceId(wal);
-          flushedSeqId = getFlushedSequenceId(encodedRegionName, flushOpSeqId);
+          flushedSeqId = flushOpSeqId;&lt;span class=&quot;code-comment&quot;&gt;// getFlushedSequenceId(encodedRegionName, flushOpSeqId);
&lt;/span&gt;         } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
           &lt;span class=&quot;code-comment&quot;&gt;// use the provided sequence Id as WAL is not being used &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; flush.
&lt;/span&gt;           flushedSeqId = flushOpSeqId = myseqid;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The test in its old form passes.&lt;/p&gt;

&lt;p&gt;Let me think about it:&lt;/p&gt;

&lt;p&gt;+ Relying on the flushid seems wrong but that is how it used to be.&lt;br/&gt;
+ It seems more true reporting the one-before the current oldest edit in memstore as the place to restart the replay&lt;/p&gt;

&lt;p&gt;Let me look more.&lt;/p&gt;

&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Apache9&quot; class=&quot;user-hover&quot; rel=&quot;Apache9&quot;&gt;Duo Zhang&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14572051" author="apache9" created="Thu, 4 Jun 2015 03:33:52 +0000"  >&lt;p&gt;If we flush all data in memstore, then use the flushid is reasonable? The flushedSeqId is calculated at the preparing stage of a flush, and actually assigned to region.maxFlushedSeqId after we successfully commit the flush. We will not report it to master before the actual assign happen, so I think it is safe?&lt;/p&gt;</comment>
                            <comment id="14572256" author="stack" created="Thu, 4 Jun 2015 06:30:18 +0000"  >&lt;p&gt;It is also the sequence id that is persisted to the WAL associated with this flush; this tie would be helpful when debugging.&lt;/p&gt;</comment>
                            <comment id="14572271" author="stack" created="Thu, 4 Jun 2015 06:45:24 +0000"  >&lt;p&gt;I just set it to the flush sequenceid. This is what it would be before this patch only we&apos;d go through some machinations to get there; lets cut to the chase. I restored the test to do as it used to since it now passes. See what you think &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Apache9&quot; class=&quot;user-hover&quot; rel=&quot;Apache9&quot;&gt;Duo Zhang&lt;/a&gt; (and thanks for helping on this stuff).&lt;/p&gt;

&lt;p&gt;On side note, have been testing on cluster and it has passed three runs; usually it would fail one. Trying at 10x scale to see what happens.&lt;/p&gt;</comment>
                            <comment id="14572299" author="hadoopqa" created="Thu, 4 Jun 2015 07:12:56 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12737413/13811.branch-1.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12737413/13811.branch-1.txt&lt;/a&gt;&lt;br/&gt;
  against branch-1 branch at commit bb62d5b2e8db1677568723bb8d0d8ea4fd2c6f46.&lt;br/&gt;
  ATTACHMENT ID: 12737413&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 10 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop versions&lt;/font&gt;. The patch compiles with all supported hadoop versions (2.4.1 2.5.2 2.6.0)&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 protoc&lt;/font&gt;.  The applied patch does not increase the total number of protoc compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;                &lt;font color=&quot;red&quot;&gt;-1 checkstyle&lt;/font&gt;.  The applied patch generated 3812 checkstyle errors (more than the master&apos;s current 3811 errors).&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 findbugs&lt;/font&gt;.  The patch appears to cause Findbugs (version 2.0.3) to fail.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core tests&lt;/font&gt;.  The patch failed these unit tests:&lt;/p&gt;


&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14282//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14282//testReport/&lt;/a&gt;&lt;br/&gt;
Checkstyle Errors: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14282//artifact/patchprocess/checkstyle-aggregate.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14282//artifact/patchprocess/checkstyle-aggregate.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;                Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14282//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14282//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14572345" author="hadoopqa" created="Thu, 4 Jun 2015 08:13:23 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12737482/13811.v2.branch-1.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12737482/13811.v2.branch-1.txt&lt;/a&gt;&lt;br/&gt;
  against branch-1 branch at commit bb62d5b2e8db1677568723bb8d0d8ea4fd2c6f46.&lt;br/&gt;
  ATTACHMENT ID: 12737482&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 10 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop versions&lt;/font&gt;. The patch compiles with all supported hadoop versions (2.4.1 2.5.2 2.6.0)&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 protoc&lt;/font&gt;.  The applied patch does not increase the total number of protoc compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;                &lt;font color=&quot;red&quot;&gt;-1 checkstyle&lt;/font&gt;.  The applied patch generated 3812 checkstyle errors (more than the master&apos;s current 3811 errors).&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any  new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core tests&lt;/font&gt;.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.regionserver.TestColumnSeeking&lt;br/&gt;
                  org.apache.hadoop.hbase.filter.TestMultipleColumnPrefixFilter&lt;br/&gt;
                  org.apache.hadoop.hbase.regionserver.TestResettingCounters&lt;br/&gt;
                  org.apache.hadoop.hbase.regionserver.TestSplitTransaction&lt;br/&gt;
                  org.apache.hadoop.hbase.regionserver.TestWideScanner&lt;br/&gt;
                  org.apache.hadoop.hbase.filter.TestColumnPrefixFilter&lt;br/&gt;
                  org.apache.hadoop.hbase.regionserver.TestStoreFileRefresherChore&lt;br/&gt;
                  org.apache.hadoop.hbase.regionserver.TestBlocksScanned&lt;br/&gt;
                  org.apache.hadoop.hbase.coprocessor.TestCoprocessorInterface&lt;br/&gt;
                  org.apache.hadoop.hbase.regionserver.TestScanner&lt;br/&gt;
                  org.apache.hadoop.hbase.filter.TestFilter&lt;/p&gt;

&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core zombie tests&lt;/font&gt;.  There are 1 zombie test(s): 	at org.apache.hadoop.hbase.http.TestHttpServerLifecycle.testStartedServerIsAlive(TestHttpServerLifecycle.java:69)&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14284//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14284//testReport/&lt;/a&gt;&lt;br/&gt;
Release Findbugs (version 2.0.3) 	warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14284//artifact/patchprocess/newFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14284//artifact/patchprocess/newFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Checkstyle Errors: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14284//artifact/patchprocess/checkstyle-aggregate.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14284//artifact/patchprocess/checkstyle-aggregate.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;                Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14284//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14284//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14572388" author="apache9" created="Thu, 4 Jun 2015 08:48:37 +0000"  >&lt;blockquote&gt;
&lt;p&gt;I just set it to the flush sequenceid&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I think this would fail TestPerColumnFamilyFlush.testLogReplayWithDistributedLogSplit?&lt;/p&gt;

&lt;p&gt;The logic here should be&lt;/p&gt;

&lt;p&gt;1. If we flush all stores or the unflushed stores are all empty, then just use flushOpSeqId.&lt;br/&gt;
2. Else, find the lowest seqId of the edits in unflushed stores and then minus 1.&lt;/p&gt;

&lt;p&gt;The original version of getEarliestMemstoreSeqNum can just fit into the logic, but it will cause data loss as described above. So I think we still need the original version of getEarliestMemstoreSeqNum, but we can rename it to more suitable name? Maybe calcFlushedSeqId? Thanks.&lt;/p&gt;</comment>
                            <comment id="14573170" author="stack" created="Thu, 4 Jun 2015 17:12:02 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Apache9&quot; class=&quot;user-hover&quot; rel=&quot;Apache9&quot;&gt;Duo Zhang&lt;/a&gt; That helped. Thinking on it, I was a little confused on what is needed here.&lt;/p&gt;

&lt;p&gt;Rather than add a new method that does what the old getEarliestMemstoreSeqNum did, I changed getEarliestMemstoreSeqNum to be how the old version worked. My new version was incorrect taking into consideration sequenceids of ongoing flushes now we are doing per column-family flushes.&lt;/p&gt;

&lt;p&gt;getEarliestMemstoreSeqNum(regionname) is asking for the earliest &apos;region&apos; sequenceid. It is called from two places, at flush time and at close. At flush time, there will be no sequenceid returned UNLESS we are flushing a subset of column families. In this case, we do not want to use the region flush sequence id but what comes out of getEarliestMemstoreSeqNum for the region (minus one); the region may have edits older than those being flushed in the current family.&lt;/p&gt;

&lt;p&gt;getEarliestMemstoreSeqNum(regionname, familyName) on the other hand is scoped to the column family so it needs to work on a different scale, on the column family scale without regard for oldest in the region.&lt;/p&gt;

&lt;p&gt;I did some trivial fixup to fix the checkstyle warning.&lt;/p&gt;</comment>
                            <comment id="14573320" author="stack" created="Thu, 4 Jun 2015 18:22:41 +0000"  >&lt;p&gt;Here is a doc. I started on how to debug ITBLL issues. Talks tooling and how tracked these last two items: &lt;a href=&quot;https://docs.google.com/document/d/14Tvu5yWYNBDFkh8xCqLkU9tlyNWhJv3GjDGOkqZU1eE/edit?usp=sharing&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://docs.google.com/document/d/14Tvu5yWYNBDFkh8xCqLkU9tlyNWhJv3GjDGOkqZU1eE/edit?usp=sharing&lt;/a&gt; Suggestions on how to get to faster turnaround or what to add appreciated.&lt;/p&gt;</comment>
                            <comment id="14573330" author="hadoopqa" created="Thu, 4 Jun 2015 18:27:20 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12737630/13811.v3.branch-1.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12737630/13811.v3.branch-1.txt&lt;/a&gt;&lt;br/&gt;
  against branch-1 branch at commit bb62d5b2e8db1677568723bb8d0d8ea4fd2c6f46.&lt;br/&gt;
  ATTACHMENT ID: 12737630&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 10 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop versions&lt;/font&gt;. The patch compiles with all supported hadoop versions (2.4.1 2.5.2 2.6.0)&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 protoc&lt;/font&gt;.  The applied patch does not increase the total number of protoc compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 checkstyle&lt;/font&gt;.  The applied patch does not increase the total number of checkstyle errors&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any  new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core tests&lt;/font&gt;.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.coprocessor.TestCoprocessorInterface&lt;br/&gt;
                  org.apache.hadoop.hbase.filter.TestFilter&lt;br/&gt;
                  org.apache.hadoop.hbase.regionserver.TestWideScanner&lt;br/&gt;
                  org.apache.hadoop.hbase.regionserver.TestColumnSeeking&lt;br/&gt;
                  org.apache.hadoop.hbase.filter.TestColumnPrefixFilter&lt;br/&gt;
                  org.apache.hadoop.hbase.regionserver.TestScanner&lt;br/&gt;
                  org.apache.hadoop.hbase.regionserver.TestSplitTransaction&lt;br/&gt;
                  org.apache.hadoop.hbase.filter.TestMultipleColumnPrefixFilter&lt;br/&gt;
                  org.apache.hadoop.hbase.regionserver.TestBlocksScanned&lt;br/&gt;
                  org.apache.hadoop.hbase.regionserver.TestResettingCounters&lt;br/&gt;
                  org.apache.hadoop.hbase.regionserver.wal.TestSequenceIdAccounting&lt;br/&gt;
                  org.apache.hadoop.hbase.regionserver.TestStoreFileRefresherChore&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14286//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14286//testReport/&lt;/a&gt;&lt;br/&gt;
Release Findbugs (version 2.0.3) 	warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14286//artifact/patchprocess/newFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14286//artifact/patchprocess/newFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Checkstyle Errors: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14286//artifact/patchprocess/checkstyle-aggregate.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14286//artifact/patchprocess/checkstyle-aggregate.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;  Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14286//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14286//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14573388" author="stack" created="Thu, 4 Jun 2015 18:55:00 +0000"  >&lt;p&gt;Fix legit NPEs&lt;/p&gt;</comment>
                            <comment id="14573409" author="hadoopqa" created="Thu, 4 Jun 2015 19:09:00 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12737655/13811.v4.branch-1.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12737655/13811.v4.branch-1.txt&lt;/a&gt;&lt;br/&gt;
  against branch-1 branch at commit bb62d5b2e8db1677568723bb8d0d8ea4fd2c6f46.&lt;br/&gt;
  ATTACHMENT ID: 12737655&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 147 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 patch&lt;/font&gt;.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14288//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14288//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14573416" author="stack" created="Thu, 4 Jun 2015 19:15:17 +0000"  >&lt;p&gt;Upload right patch.&lt;/p&gt;</comment>
                            <comment id="14573516" author="hadoopqa" created="Thu, 4 Jun 2015 20:27:26 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12737661/13811.v5.branch-1.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12737661/13811.v5.branch-1.txt&lt;/a&gt;&lt;br/&gt;
  against branch-1 branch at commit bb62d5b2e8db1677568723bb8d0d8ea4fd2c6f46.&lt;br/&gt;
  ATTACHMENT ID: 12737661&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 10 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop versions&lt;/font&gt;. The patch compiles with all supported hadoop versions (2.4.1 2.5.2 2.6.0)&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 protoc&lt;/font&gt;.  The applied patch does not increase the total number of protoc compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 checkstyle&lt;/font&gt;.  The applied patch does not increase the total number of checkstyle errors&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any  new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core tests&lt;/font&gt;.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.regionserver.wal.TestSequenceIdAccounting&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14289//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14289//testReport/&lt;/a&gt;&lt;br/&gt;
Release Findbugs (version 2.0.3) 	warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14289//artifact/patchprocess/newFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14289//artifact/patchprocess/newFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Checkstyle Errors: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14289//artifact/patchprocess/checkstyle-aggregate.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14289//artifact/patchprocess/checkstyle-aggregate.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;  Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14289//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14289//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14573599" author="stack" created="Thu, 4 Jun 2015 21:17:04 +0000"  >&lt;p&gt;Adjust test to suit new getEarliest for region workings.&lt;/p&gt;</comment>
                            <comment id="14573764" author="hadoopqa" created="Thu, 4 Jun 2015 23:14:48 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12737698/13811.v6.branch-1.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12737698/13811.v6.branch-1.txt&lt;/a&gt;&lt;br/&gt;
  against branch-1 branch at commit bb62d5b2e8db1677568723bb8d0d8ea4fd2c6f46.&lt;br/&gt;
  ATTACHMENT ID: 12737698&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 10 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop versions&lt;/font&gt;. The patch compiles with all supported hadoop versions (2.4.1 2.5.2 2.6.0)&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 protoc&lt;/font&gt;.  The applied patch does not increase the total number of protoc compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 checkstyle&lt;/font&gt;.  The applied patch does not increase the total number of checkstyle errors&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any  new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core tests&lt;/font&gt;.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.io.hfile.TestLazyDataBlockDecompression&lt;br/&gt;
                  org.apache.hadoop.hbase.io.hfile.TestReseekTo&lt;br/&gt;
                  org.apache.hadoop.hbase.io.hfile.TestSeekTo&lt;br/&gt;
                  org.apache.hadoop.hbase.io.hfile.TestHFileInlineToRootChunkConversion&lt;br/&gt;
                  org.apache.hadoop.hbase.io.hfile.TestPrefetch&lt;br/&gt;
                  org.apache.hadoop.hbase.procedure.TestProcedureManager&lt;br/&gt;
                  org.apache.hadoop.hbase.io.encoding.TestPrefixTree&lt;br/&gt;
                  org.apache.hadoop.hbase.io.hfile.TestHFileEncryption&lt;br/&gt;
                  org.apache.hadoop.hbase.ipc.TestCallRunner&lt;br/&gt;
                  org.apache.hadoop.hbase.executor.TestExecutorService&lt;br/&gt;
                  org.apache.hadoop.hbase.wal.TestWALMethods&lt;br/&gt;
                  org.apache.hadoop.hbase.zookeeper.TestZooKeeperMainServer&lt;br/&gt;
                  org.apache.hadoop.hbase.io.hfile.TestScannerSelectionUsingKeyRange&lt;br/&gt;
                  org.apache.hadoop.hbase.io.hfile.TestHFile&lt;br/&gt;
                  org.apache.hadoop.hbase.ipc.TestSimpleRpcScheduler&lt;br/&gt;
                  org.apache.hadoop.hbase.io.TestHalfStoreFileReader&lt;/p&gt;

&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core zombie tests&lt;/font&gt;.  There are 3 zombie test(s): 	at org.apache.hadoop.hbase.ipc.AbstractTestIPC.testRTEDuringConnectionSetup(AbstractTestIPC.java:240)&lt;br/&gt;
	at org.apache.hadoop.hbase.ipc.AbstractTestIPC.testRpcScheduler(AbstractTestIPC.java:258)&lt;br/&gt;
	at org.apache.hadoop.hbase.security.TestSecureRPC.testRpcCallWithEnabledKerberosSaslAuth(TestSecureRPC.java:159)&lt;br/&gt;
	at org.apache.hadoop.hbase.security.TestSecureRPC.testRpc(TestSecureRPC.java:99)&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14292//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14292//testReport/&lt;/a&gt;&lt;br/&gt;
Release Findbugs (version 2.0.3) 	warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14292//artifact/patchprocess/newFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14292//artifact/patchprocess/newFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Checkstyle Errors: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14292//artifact/patchprocess/checkstyle-aggregate.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14292//artifact/patchprocess/checkstyle-aggregate.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;  Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14292//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14292//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14573824" author="stack" created="Thu, 4 Jun 2015 23:44:38 +0000"  >&lt;p&gt;Retry. Tests  pass locally. Something seems to have gone wonky on builds.&lt;/p&gt;</comment>
                            <comment id="14573900" author="apache9" created="Fri, 5 Jun 2015 01:11:55 +0000"  >&lt;blockquote&gt;
&lt;p&gt;Rather than add a new method that does what the old getEarliestMemstoreSeqNum did, I changed getEarliestMemstoreSeqNum to be how the old version worked.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Fine, I think it will work. But I still feel a little nervous to have two methods which have same name but different behaviors...&lt;/p&gt;

&lt;p&gt;And I remember that, when implmenting &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-10201&quot; title=&quot;Port &amp;#39;Make flush decisions per column family&amp;#39; to trunk&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-10201&quot;&gt;&lt;del&gt;HBASE-10201&lt;/del&gt;&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-12405&quot; title=&quot;WAL accounting by Store&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-12405&quot;&gt;&lt;del&gt;HBASE-12405&lt;/del&gt;&lt;/a&gt;, actually I wanted to return the flushedSeqId when calling startCacheFlush first. But there are two problems. First is getNextSequenceId method is in HRegion, not in FSHLog, so a simple solution is return NO_SEQ_NUM when flushing all stores and let HRegion call getNextSequenceId. But here comes the second problem, startCacheFlush may fail which means we can not start a flush, so there are three types of return values, &apos;sequenceId&apos;, &apos;choose a sequenceId by yourself&apos;, &apos;give up flushing!&apos;. I think it is ugly to have a &apos;-2&apos; or a null java.lang.Long to indicate a &apos;give up flushing&apos; at that time so I gave up...&lt;/p&gt;

&lt;p&gt;Maybe we could consider this solution again? getEarliestMemstoreSeqNum can be used everywhere but startCacheFlush is restricted in the flushing scope I think.&lt;/p&gt;

&lt;p&gt;Thanks.&lt;/p&gt;</comment>
                            <comment id="14573951" author="hadoopqa" created="Fri, 5 Jun 2015 02:20:49 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12737737/13811.v6.branch-1.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12737737/13811.v6.branch-1.txt&lt;/a&gt;&lt;br/&gt;
  against branch-1 branch at commit 67c463f63e3c48efd9e1281166b707a3a806a2ad.&lt;br/&gt;
  ATTACHMENT ID: 12737737&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 10 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop versions&lt;/font&gt;. The patch compiles with all supported hadoop versions (2.4.1 2.5.2 2.6.0)&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 protoc&lt;/font&gt;.  The applied patch does not increase the total number of protoc compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 checkstyle&lt;/font&gt;.  The applied patch does not increase the total number of checkstyle errors&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any  new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core tests&lt;/font&gt;.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.regionserver.TestHRegion&lt;br/&gt;
                  org.apache.hadoop.hbase.regionserver.TestSplitWalDataLoss&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14295//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14295//testReport/&lt;/a&gt;&lt;br/&gt;
Release Findbugs (version 2.0.3) 	warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14295//artifact/patchprocess/newFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14295//artifact/patchprocess/newFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Checkstyle Errors: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14295//artifact/patchprocess/checkstyle-aggregate.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14295//artifact/patchprocess/checkstyle-aggregate.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;  Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14295//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14295//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14574080" author="stack" created="Fri, 5 Jun 2015 07:44:03 +0000"  >&lt;p&gt;Fix the failing unit tests.&lt;/p&gt;</comment>
                            <comment id="14574087" author="stack" created="Fri, 5 Jun 2015 07:50:26 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Apache9&quot; class=&quot;user-hover&quot; rel=&quot;Apache9&quot;&gt;Duo Zhang&lt;/a&gt; JIRA was down so it took a while to respond....&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;Fine, I think it will work. But I still feel a little nervous to have two methods which have same name but different behaviors...&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Makes sense. In this v7 patch, I made the two overloaded methods work the same and changed what happens in HRegion when we prepare to flush.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;And I remember that, when implmenting &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-10201&quot; title=&quot;Port &amp;#39;Make flush decisions per column family&amp;#39; to trunk&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-10201&quot;&gt;&lt;del&gt;HBASE-10201&lt;/del&gt;&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-12405&quot; title=&quot;WAL accounting by Store&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-12405&quot;&gt;&lt;del&gt;HBASE-12405&lt;/del&gt;&lt;/a&gt;, actually I wanted to return the flushedSeqId when calling startCacheFlush first. But there are two problems. First is getNextSequenceId method is in HRegion, not in FSHLog, so a simple solution is return NO_SEQ_NUM when flushing all stores and let HRegion call getNextSequenceId. &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes. That is how it &apos;works&apos; in patch v6 but it is hard to read. We can actually tell when we are flushing if we should do all of the region, right? If the passed in families are null or equal in number to region stores, we are doing a full region flush so we should use the flush sequence id, the result of the getNextSequenceId call. Otherwise, we want the getEarliest for the region because are doing a column family only flush...&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;But here comes the second problem, startCacheFlush may fail which means we can not start a flush, so there are three types of return values, &apos;sequenceId&apos;, &apos;choose a sequenceId by yourself&apos;, &apos;give up flushing!&apos;. I think it is ugly to have a &apos;-2&apos; or a null java.lang.Long to indicate a &apos;give up flushing&apos; at that time so I gave up...&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Pardon me, I don&apos;t see the problem here? Your nice TestSplitWalDataLoss test was failing for me earlier because I was not doing the abort accounting properly; the &apos;restore&apos; of old sequenceids. Abort of the flush will &apos;restore&apos; the old sequenceids. The region flush id won&apos;t be updated. This is ok?&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Maybe we could consider this solution again? getEarliestMemstoreSeqNum can be used everywhere but startCacheFlush is restricted in the flushing scope I think.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I&apos;d like to purge getEarliestMemstoreSeqNum or narrow its usage if possible.  What do you mean by &apos;startCacheFlush is restricted&apos;.&lt;/p&gt;

&lt;p&gt;Thanks Duo&lt;/p&gt;</comment>
                            <comment id="14574227" author="apache9" created="Fri, 5 Jun 2015 09:53:58 +0000"  >&lt;blockquote&gt;
&lt;p&gt;Pardon me, I don&apos;t see the problem here?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Not a big problem... The only thing is I do not like java.lang.Long...I can prepare a patch to explain how to implement it.&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;What do you mean by &apos;startCacheFlush is restricted&apos;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;&apos;startCacheFlush&apos; is a exact name which tell us what it will do and I think people will only call it when they want to flush a region, so it is less hurt to change its behavior. &apos;getEarliestMemstoreSeqNum&apos;  is a more general name, people can use it everywhere when they want to get the value.&lt;/p&gt;</comment>
                            <comment id="14574274" author="hadoopqa" created="Fri, 5 Jun 2015 10:27:15 +0000"  >&lt;p&gt;&lt;font color=&quot;green&quot;&gt;+1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12737860/13811.v7.branch-1.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12737860/13811.v7.branch-1.txt&lt;/a&gt;&lt;br/&gt;
  against branch-1 branch at commit 67c463f63e3c48efd9e1281166b707a3a806a2ad.&lt;br/&gt;
  ATTACHMENT ID: 12737860&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 13 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop versions&lt;/font&gt;. The patch compiles with all supported hadoop versions (2.4.1 2.5.2 2.6.0)&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 protoc&lt;/font&gt;.  The applied patch does not increase the total number of protoc compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 checkstyle&lt;/font&gt;.  The applied patch does not increase the total number of checkstyle errors&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any  new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 core tests&lt;/font&gt;.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14299//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14299//testReport/&lt;/a&gt;&lt;br/&gt;
Release Findbugs (version 2.0.3) 	warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14299//artifact/patchprocess/newFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14299//artifact/patchprocess/newFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Checkstyle Errors: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14299//artifact/patchprocess/checkstyle-aggregate.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14299//artifact/patchprocess/checkstyle-aggregate.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;  Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14299//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14299//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14574304" author="apache9" created="Fri, 5 Jun 2015 10:56:49 +0000"  >&lt;p&gt;Implement flushedSeqId calculation inside startCacheFlush.&lt;/p&gt;</comment>
                            <comment id="14574311" author="apache9" created="Fri, 5 Jun 2015 11:01:42 +0000"  >&lt;blockquote&gt;
&lt;p&gt;We can actually tell when we are flushing if we should do all of the region, right? If the passed in families are null or equal in number to region stores, we are doing a full region flush so we should use the flush sequence id, the result of the getNextSequenceId call. Otherwise, we want the getEarliest for the region because are doing a column family only flush...&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;If the stores which we do not flush are all empty, then we should still use the flush sequence id returned by getNextSequenceId(getEarliest should return NO_SEQ_NUM in this case).&lt;/p&gt;</comment>
                            <comment id="14574483" author="hadoopqa" created="Fri, 5 Jun 2015 13:33:27 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12737911/startCacheFlush.diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12737911/startCacheFlush.diff&lt;/a&gt;&lt;br/&gt;
  against master branch at commit 67c463f63e3c48efd9e1281166b707a3a806a2ad.&lt;br/&gt;
  ATTACHMENT ID: 12737911&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 tests included&lt;/font&gt;.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop versions&lt;/font&gt;. The patch compiles with all supported hadoop versions (2.4.1 2.5.2 2.6.0)&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 protoc&lt;/font&gt;.  The applied patch does not increase the total number of protoc compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;                &lt;font color=&quot;red&quot;&gt;-1 checkstyle&lt;/font&gt;.  The applied patch generated 1921 checkstyle errors (more than the master&apos;s current 1920 errors).&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any  new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 core tests&lt;/font&gt;.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14302//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14302//testReport/&lt;/a&gt;&lt;br/&gt;
Release Findbugs (version 2.0.3) 	warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14302//artifact/patchprocess/newFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14302//artifact/patchprocess/newFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Checkstyle Errors: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14302//artifact/patchprocess/checkstyle-aggregate.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14302//artifact/patchprocess/checkstyle-aggregate.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;                Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14302//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14302//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14574643" author="stack" created="Fri, 5 Jun 2015 15:10:00 +0000"  >&lt;p&gt;Ok. Let me integrate your patch. &lt;/p&gt;</comment>
                            <comment id="14575084" author="stack" created="Fri, 5 Jun 2015 19:41:28 +0000"  >&lt;p&gt;Integrated your suggestion &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Apache9&quot; class=&quot;user-hover&quot; rel=&quot;Apache9&quot;&gt;Duo Zhang&lt;/a&gt; of having the startCacheFlush do the sequence id calculation.  I then went further and removed the last use of getEarliest for region (in close &amp;#8211; seemed like we were going long way around getting closed region sequence id) and then deprecated the method altogether; its operation is subtle and shouldn&apos;t be exposed as public method.&lt;/p&gt;

&lt;p&gt;Added tests for startCacheFlush&apos;s new operation.&lt;/p&gt;

&lt;p&gt;Let me try this on cluster.&lt;/p&gt;
</comment>
                            <comment id="14575109" author="hadoopqa" created="Fri, 5 Jun 2015 19:59:40 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12738020/13811.v8.branch-1.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12738020/13811.v8.branch-1.txt&lt;/a&gt;&lt;br/&gt;
  against branch-1 branch at commit 67c463f63e3c48efd9e1281166b707a3a806a2ad.&lt;br/&gt;
  ATTACHMENT ID: 12738020&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 16 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 javac&lt;/font&gt;.  The patch appears to cause mvn compile goal to fail with Hadoop version 2.4.1.&lt;/p&gt;

&lt;p&gt;    Compilation errors resume:&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;ERROR&amp;#93;&lt;/span&gt; COMPILATION ERROR : &lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;ERROR&amp;#93;&lt;/span&gt; /home/jenkins/jenkins-slave/workspace/PreCommit-HBASE-Build/hbase-server/src/main/java/org/apache/hadoop/hbase/wal/DisabledWALProvider.java:&lt;span class=&quot;error&quot;&gt;&amp;#91;85,17&amp;#93;&lt;/span&gt; error: DisabledWAL is not abstract and does not override abstract method startCacheFlush(byte[],Set&amp;lt;byte[]&amp;gt;) in WAL&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;ERROR&amp;#93;&lt;/span&gt; /home/jenkins/jenkins-slave/workspace/PreCommit-HBASE-Build/hbase-server/src/main/java/org/apache/hadoop/hbase/wal/DisabledWALProvider.java:&lt;span class=&quot;error&quot;&gt;&amp;#91;190,19&amp;#93;&lt;/span&gt; error: startCacheFlush(byte[],Set&amp;lt;byte[]&amp;gt;) in DisabledWAL cannot implement startCacheFlush(byte[],Set&amp;lt;byte[]&amp;gt;) in WAL&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;ERROR&amp;#93;&lt;/span&gt;   return type boolean is not compatible with Long&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;ERROR&amp;#93;&lt;/span&gt; Failed to execute goal org.apache.maven.plugins:maven-compiler-plugin:2.5.1:compile (default-compile) on project hbase-server: Compilation failure: Compilation failure:&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;ERROR&amp;#93;&lt;/span&gt; /home/jenkins/jenkins-slave/workspace/PreCommit-HBASE-Build/hbase-server/src/main/java/org/apache/hadoop/hbase/wal/DisabledWALProvider.java:&lt;span class=&quot;error&quot;&gt;&amp;#91;85,17&amp;#93;&lt;/span&gt; error: DisabledWAL is not abstract and does not override abstract method startCacheFlush(byte[],Set&amp;lt;byte[]&amp;gt;) in WAL&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;ERROR&amp;#93;&lt;/span&gt; /home/jenkins/jenkins-slave/workspace/PreCommit-HBASE-Build/hbase-server/src/main/java/org/apache/hadoop/hbase/wal/DisabledWALProvider.java:&lt;span class=&quot;error&quot;&gt;&amp;#91;190,19&amp;#93;&lt;/span&gt; error: startCacheFlush(byte[],Set&amp;lt;byte[]&amp;gt;) in DisabledWAL cannot implement startCacheFlush(byte[],Set&amp;lt;byte[]&amp;gt;) in WAL&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;ERROR&amp;#93;&lt;/span&gt; return type boolean is not compatible with Long&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;ERROR&amp;#93;&lt;/span&gt; /home/jenkins/jenkins-slave/workspace/PreCommit-HBASE-Build/hbase-server/src/main/java/org/apache/hadoop/hbase/wal/DisabledWALProvider.java:&lt;span class=&quot;error&quot;&gt;&amp;#91;189,4&amp;#93;&lt;/span&gt; error: method does not override or implement a method from a supertype&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;ERROR&amp;#93;&lt;/span&gt; -&amp;gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;Help 1&amp;#93;&lt;/span&gt;&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;ERROR&amp;#93;&lt;/span&gt; &lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;ERROR&amp;#93;&lt;/span&gt; To see the full stack trace of the errors, re-run Maven with the -e switch.&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;ERROR&amp;#93;&lt;/span&gt; Re-run Maven using the -X switch to enable full debug logging.&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;ERROR&amp;#93;&lt;/span&gt; &lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;ERROR&amp;#93;&lt;/span&gt; For more information about the errors and possible solutions, please read the following articles:&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;ERROR&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;Help 1&amp;#93;&lt;/span&gt; &lt;a href=&quot;http://cwiki.apache.org/confluence/display/MAVEN/MojoFailureException&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://cwiki.apache.org/confluence/display/MAVEN/MojoFailureException&lt;/a&gt;&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;ERROR&amp;#93;&lt;/span&gt; &lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;ERROR&amp;#93;&lt;/span&gt; After correcting the problems, you can resume the build with the command&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;ERROR&amp;#93;&lt;/span&gt;   mvn &amp;lt;goals&amp;gt; -rf :hbase-server&lt;/p&gt;


&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14308//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14308//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14575112" author="stack" created="Fri, 5 Jun 2015 20:03:02 +0000"  >&lt;p&gt;Missed a change.&lt;/p&gt;</comment>
                            <comment id="14575373" author="hadoopqa" created="Fri, 5 Jun 2015 22:45:39 +0000"  >&lt;p&gt;&lt;font color=&quot;green&quot;&gt;+1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12738033/13811.v9.branch-1.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12738033/13811.v9.branch-1.txt&lt;/a&gt;&lt;br/&gt;
  against branch-1 branch at commit 67c463f63e3c48efd9e1281166b707a3a806a2ad.&lt;br/&gt;
  ATTACHMENT ID: 12738033&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 16 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop versions&lt;/font&gt;. The patch compiles with all supported hadoop versions (2.4.1 2.5.2 2.6.0)&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 protoc&lt;/font&gt;.  The applied patch does not increase the total number of protoc compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 checkstyle&lt;/font&gt;.  The applied patch does not increase the total number of checkstyle errors&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any  new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 core tests&lt;/font&gt;.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14309//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14309//testReport/&lt;/a&gt;&lt;br/&gt;
Release Findbugs (version 2.0.3) 	warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14309//artifact/patchprocess/newFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14309//artifact/patchprocess/newFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Checkstyle Errors: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14309//artifact/patchprocess/checkstyle-aggregate.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14309//artifact/patchprocess/checkstyle-aggregate.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;  Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14309//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14309//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14575377" author="stack" created="Fri, 5 Jun 2015 22:48:19 +0000"  >&lt;p&gt;Updated rb. Looking for a +1. Running on cluster. So far so good but sometimes takes a few runs for issue to show.  Will report back.&lt;/p&gt;</comment>
                            <comment id="14575398" author="apache9" created="Fri, 5 Jun 2015 23:28:11 +0000"  >&lt;p&gt;+1 on the latest version. Hope it can pass ITBLL.&lt;/p&gt;</comment>
                            <comment id="14575438" author="stack" created="Sat, 6 Jun 2015 00:16:09 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Apache9&quot; class=&quot;user-hover&quot; rel=&quot;Apache9&quot;&gt;Duo Zhang&lt;/a&gt; It passed runs that failed before. Let me do an overnighter before commit.&lt;/p&gt;</comment>
                            <comment id="14576577" author="stack" created="Mon, 8 Jun 2015 03:59:36 +0000"  >&lt;p&gt;Over w/e, I did a few small runs and we passed (when we&apos;d usually fail) but then tried to go big and we failed both. So, we seem to be better but we are not out of the woods yet. Let me do a few small runs again to confirm we are &apos;better&apos; with this patch and if that the case, will commit and move on to debug of fails at larger scale.&lt;/p&gt;</comment>
                            <comment id="14576586" author="enis" created="Mon, 8 Jun 2015 04:14:13 +0000"  >&lt;p&gt;Yeah, my analysis and patch at &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13853&quot; title=&quot;ITBLL improvements after HBASE-13811&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13853&quot;&gt;&lt;del&gt;HBASE-13853&lt;/del&gt;&lt;/a&gt; is similar. Wish I saw this earlier. My b. I skimmed through the patch, like the new class. Much cleaner. &lt;/p&gt;

&lt;p&gt;What do you guys think about &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13853?focusedCommentId=14576578&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14576578?&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-13853?focusedCommentId=14576578&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14576578?&lt;/a&gt; &lt;/p&gt;</comment>
                            <comment id="14577296" author="apache9" created="Mon, 8 Jun 2015 14:56:31 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=enis&quot; class=&quot;user-hover&quot; rel=&quot;enis&quot;&gt;Enis Soztutar&lt;/a&gt; patch for 1.1.&lt;/p&gt;</comment>
                            <comment id="14577327" author="busbey" created="Mon, 8 Jun 2015 15:15:42 +0000"  >&lt;p&gt;Could this be the cause of recent failures for TestDistributedLogSplitting in pre-commit tests?&lt;/p&gt;</comment>
                            <comment id="14577517" author="stack" created="Mon, 8 Jun 2015 17:37:18 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=busbey&quot; class=&quot;user-hover&quot; rel=&quot;busbey&quot;&gt;Sean Busbey&lt;/a&gt; How recent? This change has been in place a good while. Perhaps. Tends to happen for me when I run a while and not always.&lt;/p&gt;

&lt;p&gt;Let me commit this patch (especially after &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Apache9&quot; class=&quot;user-hover&quot; rel=&quot;Apache9&quot;&gt;Duo Zhang&lt;/a&gt; did up a branch-1.1 version). It makes things better. There is still work to do in here though &amp;#8211; at larger scales I failed on w/e. Will do further fixes in a follow-on issue.&lt;/p&gt;</comment>
                            <comment id="14577525" author="hadoopqa" created="Mon, 8 Jun 2015 17:42:38 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12738367/HBASE-13811-branch-1.1.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12738367/HBASE-13811-branch-1.1.patch&lt;/a&gt;&lt;br/&gt;
  against branch-1.1 branch at commit 9f43a3bea6a996a93f3c960801a0200b52419b34.&lt;br/&gt;
  ATTACHMENT ID: 12738367&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 4 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop versions&lt;/font&gt;. The patch compiles with all supported hadoop versions (2.4.1 2.5.2 2.6.0)&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 protoc&lt;/font&gt;.  The applied patch does not increase the total number of protoc compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 checkstyle&lt;/font&gt;.  The applied patch does not increase the total number of checkstyle errors&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any  new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 core tests&lt;/font&gt;.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core zombie tests&lt;/font&gt;.  There are 1 zombie test(s): 	at org.apache.hadoop.hbase.procedure2.TestProcedureRecovery.testMultiStepRollbackRecovery(TestProcedureRecovery.java:281)&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14328//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14328//testReport/&lt;/a&gt;&lt;br/&gt;
Release Findbugs (version 2.0.3) 	warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14328//artifact/patchprocess/newFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14328//artifact/patchprocess/newFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Checkstyle Errors: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14328//artifact/patchprocess/checkstyle-aggregate.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14328//artifact/patchprocess/checkstyle-aggregate.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;  Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14328//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14328//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14577538" author="busbey" created="Mon, 8 Jun 2015 17:49:09 +0000"  >&lt;p&gt;I only noticed in the last couple of days, unfortunately. I haven&apos;t dug back to see how far it went bad. I&apos;m bisecting still (using 5 repeats to look for flakey).&lt;/p&gt;</comment>
                            <comment id="14577556" author="stack" created="Mon, 8 Jun 2015 18:01:41 +0000"  >&lt;p&gt;k &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=busbey&quot; class=&quot;user-hover&quot; rel=&quot;busbey&quot;&gt;Sean Busbey&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I committed to master and branch-1. Waiting for &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ndimiduk&quot; class=&quot;user-hover&quot; rel=&quot;ndimiduk&quot;&gt;Nick Dimiduk&lt;/a&gt; blessing to commit on branch-1.1. Will resolve then.&lt;/p&gt;

&lt;p&gt;Will go now and research cause of failure at larger scales... 2.5B+.&lt;/p&gt;</comment>
                            <comment id="14577569" author="stack" created="Mon, 8 Jun 2015 18:08:30 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Apache9&quot; class=&quot;user-hover&quot; rel=&quot;Apache9&quot;&gt;Duo Zhang&lt;/a&gt; Nice job extracting the core changes so backport to branch-1.1 is not so fat.&lt;/p&gt;</comment>
                            <comment id="14577657" author="enis" created="Mon, 8 Jun 2015 19:05:17 +0000"  >&lt;p&gt;+1 for the branch-1.1 patch. It is still a bit fragile with, but seems ok. I&apos;ll be running the ITBLL tests with this as well with ~1B scale. &lt;/p&gt;</comment>
                            <comment id="14577708" author="enis" created="Mon, 8 Jun 2015 19:38:41 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=saint.ack%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;saint.ack@gmail.com&quot;&gt;Stack&lt;/a&gt; remove this in WALSplitter ? &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
          LOG.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;CHANGE REMOVE &quot;&lt;/span&gt; + Bytes.toString(family) + &lt;span class=&quot;code-quote&quot;&gt;&quot;, max=&quot;&lt;/span&gt; + maxSeqId);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14577741" author="hudson" created="Mon, 8 Jun 2015 19:56:39 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-1.2 #137 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-1.2/137/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-1.2/137/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13811&quot; title=&quot;Splitting WALs, we are filtering out too many edits -&amp;gt; DATALOSS&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13811&quot;&gt;&lt;del&gt;HBASE-13811&lt;/del&gt;&lt;/a&gt; Splitting WALs, we are filtering out too many edits -&amp;gt; DATALOSS (stack: rev 2baf3bfc9fbe50327dc09389efdffe8c6e71af5f)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/wal/SequenceIdAccounting.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/ipc/TestCallRunner.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/TestHRegion.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/coordination/ZKSplitLogManagerCoordination.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/wal/TestFSHLog.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/wal/DisabledWALProvider.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/master/RegionStates.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/Region.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/master/TestGetLastFlushedSequenceId.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/FlushLargeStoresPolicy.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/wal/WAL.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/master/ServerManager.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/wal/TestSequenceIdAccounting.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/wal/WALSplitter.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HStore.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/wal/FSHLog.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/TestSplitWalDataLoss.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14577745" author="stack" created="Mon, 8 Jun 2015 19:58:04 +0000"  >&lt;p&gt;An addendum added post commit to branch-1 and master (Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=enis&quot; class=&quot;user-hover&quot; rel=&quot;enis&quot;&gt;Enis Soztutar&lt;/a&gt;)&lt;/p&gt;</comment>
                            <comment id="14577760" author="hudson" created="Mon, 8 Jun 2015 20:12:57 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-TRUNK #6551 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/6551/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/6551/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13811&quot; title=&quot;Splitting WALs, we are filtering out too many edits -&amp;gt; DATALOSS&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13811&quot;&gt;&lt;del&gt;HBASE-13811&lt;/del&gt;&lt;/a&gt; Splitting WALs, we are filtering out too many edits -&amp;gt; DATALOSS (stack: rev 5c16b34e32256b2ca4667f1bd98a8bf7a8489a15)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/ipc/TestCallRunner.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/TestHRegion.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/master/RegionStates.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/wal/WAL.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/master/TestGetLastFlushedSequenceId.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/wal/WALSplitter.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/wal/DisabledWALProvider.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/FlushLargeStoresPolicy.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/TestSplitWalDataLoss.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/wal/TestFSHLog.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HStore.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/wal/TestSequenceIdAccounting.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/coordination/ZKSplitLogManagerCoordination.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/wal/SequenceIdAccounting.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/wal/FSHLog.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/master/ServerManager.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/Region.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14577786" author="hadoopqa" created="Mon, 8 Jun 2015 20:31:23 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12738425/13811.addendum.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12738425/13811.addendum.txt&lt;/a&gt;&lt;br/&gt;
  against master branch at commit c19bc6d6e0dee4b60f45350ab7561fd15cfead7d.&lt;br/&gt;
  ATTACHMENT ID: 12738425&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 tests included&lt;/font&gt;.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 patch&lt;/font&gt;.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14336//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14336//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14577791" author="busbey" created="Mon, 8 Jun 2015 20:35:24 +0000"  >&lt;p&gt;git bisect claims the flakey status of TestDistributedLogSplit is from 59a6e031fb20c8455d897b4ee2526b61224af961 (&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13661&quot; title=&quot;Correct binary compatibility issues discovered in 1.1.0RC0&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13661&quot;&gt;&lt;del&gt;HBASE-13661&lt;/del&gt;&lt;/a&gt;) but nothing in that change looks like an obvious source of the problem. Maybe need to up from 5 retries to 10.&lt;/p&gt;</comment>
                            <comment id="14577831" author="stack" created="Mon, 8 Jun 2015 20:48:46 +0000"  >&lt;p&gt;Applied the branch-1.1 patch from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Apache9&quot; class=&quot;user-hover&quot; rel=&quot;Apache9&quot;&gt;Duo Zhang&lt;/a&gt; (let me know if you&apos;d like me revert &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ndimiduk&quot; class=&quot;user-hover&quot; rel=&quot;ndimiduk&quot;&gt;Nick Dimiduk&lt;/a&gt;)&lt;/p&gt;

&lt;p&gt;In summary, applied v9 for branch-1 to branch-1. Then forwarded ported this commit to master branch. I then applied addendum to branch-1 and master.  Finally, applied the branch-1.1 patch (which is a subset of what is on branch-1 and master).&lt;/p&gt;</comment>
                            <comment id="14577834" author="stack" created="Mon, 8 Jun 2015 20:50:51 +0000"  >&lt;p&gt;Resolving. There is still dataloss going on but have to run at larger scales: ITBLL 2.5B in my test runs. Will open new issue to do the subsequent hole-plugging.&lt;/p&gt;</comment>
                            <comment id="14577836" author="ndimiduk" created="Mon, 8 Jun 2015 20:51:36 +0000"  >&lt;p&gt;No objections from me. Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=stack&quot; class=&quot;user-hover&quot; rel=&quot;stack&quot;&gt;stack&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Apache9&quot; class=&quot;user-hover&quot; rel=&quot;Apache9&quot;&gt;Duo Zhang&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="14577849" author="hudson" created="Mon, 8 Jun 2015 21:03:06 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-1.0 #951 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-1.0/951/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-1.0/951/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13853&quot; title=&quot;ITBLL improvements after HBASE-13811&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13853&quot;&gt;&lt;del&gt;HBASE-13853&lt;/del&gt;&lt;/a&gt; ITBLL improvements after &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13811&quot; title=&quot;Splitting WALs, we are filtering out too many edits -&amp;gt; DATALOSS&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13811&quot;&gt;&lt;del&gt;HBASE-13811&lt;/del&gt;&lt;/a&gt; (enis: rev 8079ec504b5202d0d1b9196e8d47038d2246b41a)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-it/src/test/java/org/apache/hadoop/hbase/test/IntegrationTestBigLinkedList.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/io/hfile/HFilePrettyPrinter.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/wal/WALSplitter.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14577962" author="hudson" created="Mon, 8 Jun 2015 22:25:26 +0000"  >&lt;p&gt;SUCCESS: Integrated in HBase-1.1 #529 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-1.1/529/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-1.1/529/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13853&quot; title=&quot;ITBLL improvements after HBASE-13811&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13853&quot;&gt;&lt;del&gt;HBASE-13853&lt;/del&gt;&lt;/a&gt; ITBLL improvements after &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13811&quot; title=&quot;Splitting WALs, we are filtering out too many edits -&amp;gt; DATALOSS&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13811&quot;&gt;&lt;del&gt;HBASE-13811&lt;/del&gt;&lt;/a&gt; (enis: rev 0f88746827290de350fe64188ff5c8e28cc130fb)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/io/hfile/HFilePrettyPrinter.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/wal/WALSplitter.java&lt;/li&gt;
	&lt;li&gt;hbase-it/src/test/java/org/apache/hadoop/hbase/test/IntegrationTestBigLinkedList.java&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13853&quot; title=&quot;ITBLL improvements after HBASE-13811&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13853&quot;&gt;&lt;del&gt;HBASE-13853&lt;/del&gt;&lt;/a&gt; ITBLL improvements after &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13811&quot; title=&quot;Splitting WALs, we are filtering out too many edits -&amp;gt; DATALOSS&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13811&quot;&gt;&lt;del&gt;HBASE-13811&lt;/del&gt;&lt;/a&gt; (ADDENDUM to fix logging) (enis: rev 978c503d9b4e85a4014a41df847876ca15e316f5)&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/wal/WALSplitter.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14577970" author="hudson" created="Mon, 8 Jun 2015 22:30:07 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-1.2 #138 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-1.2/138/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-1.2/138/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13853&quot; title=&quot;ITBLL improvements after HBASE-13811&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13853&quot;&gt;&lt;del&gt;HBASE-13853&lt;/del&gt;&lt;/a&gt; ITBLL improvements after &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13811&quot; title=&quot;Splitting WALs, we are filtering out too many edits -&amp;gt; DATALOSS&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13811&quot;&gt;&lt;del&gt;HBASE-13811&lt;/del&gt;&lt;/a&gt; (enis: rev 26458b41ceab6bc4f524b355833020bdf7d8c529)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/wal/WALSplitter.java&lt;/li&gt;
	&lt;li&gt;hbase-it/src/test/java/org/apache/hadoop/hbase/test/IntegrationTestBigLinkedList.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/io/hfile/HFilePrettyPrinter.java&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13853&quot; title=&quot;ITBLL improvements after HBASE-13811&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13853&quot;&gt;&lt;del&gt;HBASE-13853&lt;/del&gt;&lt;/a&gt; ITBLL improvements after &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13811&quot; title=&quot;Splitting WALs, we are filtering out too many edits -&amp;gt; DATALOSS&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13811&quot;&gt;&lt;del&gt;HBASE-13811&lt;/del&gt;&lt;/a&gt; (ADDENDUM to fix logging) (enis: rev cd71d37cb3799257239683e572c93bd183025e6e)&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/wal/WALSplitter.java&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13811&quot; title=&quot;Splitting WALs, we are filtering out too many edits -&amp;gt; DATALOSS&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13811&quot;&gt;&lt;del&gt;HBASE-13811&lt;/del&gt;&lt;/a&gt; Splitting WALs, we are filtering out too many edits -&amp;gt; DATALOSS; ADDENDUM (stack: rev 3dfccbd4248185e49933ef591071622f02b820a1)&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/wal/WALSplitter.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14577981" author="hudson" created="Mon, 8 Jun 2015 22:36:05 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-TRUNK #6552 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/6552/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/6552/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13853&quot; title=&quot;ITBLL improvements after HBASE-13811&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13853&quot;&gt;&lt;del&gt;HBASE-13853&lt;/del&gt;&lt;/a&gt; ITBLL improvements after &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13811&quot; title=&quot;Splitting WALs, we are filtering out too many edits -&amp;gt; DATALOSS&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13811&quot;&gt;&lt;del&gt;HBASE-13811&lt;/del&gt;&lt;/a&gt; (enis: rev fe5712f9b4ba9c031042d861a41592183775f98a)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/wal/WALSplitter.java&lt;/li&gt;
	&lt;li&gt;hbase-it/src/test/java/org/apache/hadoop/hbase/test/IntegrationTestBigLinkedList.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/io/hfile/HFilePrettyPrinter.java&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13853&quot; title=&quot;ITBLL improvements after HBASE-13811&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13853&quot;&gt;&lt;del&gt;HBASE-13853&lt;/del&gt;&lt;/a&gt; ITBLL improvements after &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13811&quot; title=&quot;Splitting WALs, we are filtering out too many edits -&amp;gt; DATALOSS&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13811&quot;&gt;&lt;del&gt;HBASE-13811&lt;/del&gt;&lt;/a&gt; (ADDENDUM to fix logging) (enis: rev 5f92b91e60c6217e668be596d99065de1a0e276e)&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/wal/WALSplitter.java&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13811&quot; title=&quot;Splitting WALs, we are filtering out too many edits -&amp;gt; DATALOSS&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13811&quot;&gt;&lt;del&gt;HBASE-13811&lt;/del&gt;&lt;/a&gt; Splitting WALs, we are filtering out too many edits -&amp;gt; DATALOSS; ADDENDUM (stack: rev c19bc6d6e0dee4b60f45350ab7561fd15cfead7d)&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/wal/WALSplitter.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14578009" author="hudson" created="Mon, 8 Jun 2015 22:53:28 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-1.0 #952 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-1.0/952/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-1.0/952/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13853&quot; title=&quot;ITBLL improvements after HBASE-13811&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13853&quot;&gt;&lt;del&gt;HBASE-13853&lt;/del&gt;&lt;/a&gt; ITBLL improvements after &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13811&quot; title=&quot;Splitting WALs, we are filtering out too many edits -&amp;gt; DATALOSS&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13811&quot;&gt;&lt;del&gt;HBASE-13811&lt;/del&gt;&lt;/a&gt; (ADDENDUM to fix logging) (enis: rev 0ec677bb73f2a334021bce29c2c82e218b08ce17)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/wal/WALSplitter.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14578138" author="hudson" created="Tue, 9 Jun 2015 00:48:27 +0000"  >&lt;p&gt;SUCCESS: Integrated in HBase-1.1 #530 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-1.1/530/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-1.1/530/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13811&quot; title=&quot;Splitting WALs, we are filtering out too many edits -&amp;gt; DATALOSS&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13811&quot;&gt;&lt;del&gt;HBASE-13811&lt;/del&gt;&lt;/a&gt; Splitting WALs, we are filtering out too many edits -&amp;gt; DATALOSS (stack: rev 5dd4c9832d0cc70a2121a6250060a2b5cf7d4312)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/wal/WAL.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/TestSplitWalDataLoss.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/wal/DisabledWALProvider.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/wal/FSHLog.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14579623" author="enis" created="Tue, 9 Jun 2015 21:50:23 +0000"  >&lt;blockquote&gt;&lt;p&gt;Resolving. There is still dataloss going on but have to run at larger scales: ITBLL 2.5B in my test runs. Will open new issue to do the subsequent hole-plugging.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Apache9&quot; class=&quot;user-hover&quot; rel=&quot;Apache9&quot;&gt;Duo Zhang&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=saint.ack%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;saint.ack@gmail.com&quot;&gt;Stack&lt;/a&gt; I was able to reproduce the failures on my rig with 1.25B rows. The number of missing rows is much lower around ~80K. &lt;/p&gt;

&lt;p&gt;The root cause this time seems to be different, and not related to the WAL edits filtering. It is due to procedure based flush interrupting the flush request in case the procedure is cancelled from an exception elsewhere. This leaves the memstore snapshot intact without aborting the server. The next flush, then flushes the previous memstore with the current seqId (as opposed to seqId from the memstore snapshot). This creates an hfile with larger seqId than what its contents are. Previous behavior in 0.98 and 1.0 (I believe) is that after flush prepare and interruption / exception will cause RS abort. &lt;/p&gt;

&lt;p&gt;I&apos;ll create yet another issue for this since it is also different than this and &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13853&quot; title=&quot;ITBLL improvements after HBASE-13811&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13853&quot;&gt;&lt;del&gt;HBASE-13853&lt;/del&gt;&lt;/a&gt;. &lt;/p&gt;</comment>
                            <comment id="14579640" author="enis" created="Tue, 9 Jun 2015 22:03:18 +0000"  >&lt;p&gt;Opened &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13877&quot; title=&quot;Interrupt to flush from TableFlushProcedure causes dataloss in ITBLL&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13877&quot;&gt;&lt;del&gt;HBASE-13877&lt;/del&gt;&lt;/a&gt;. &lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12836055">HBASE-13853</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12836673">HBASE-13877</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12738425" name="13811.addendum.txt" size="929" author="stack" created="Mon, 8 Jun 2015 19:58:04 +0000"/>
                            <attachment id="12737413" name="13811.branch-1.txt" size="89377" author="stack" created="Wed, 3 Jun 2015 23:52:04 +0000"/>
                            <attachment id="12737061" name="13811.branch-1.txt" size="43421" author="stack" created="Wed, 3 Jun 2015 01:36:34 +0000"/>
                            <attachment id="12737038" name="13811.txt" size="43421" author="stack" created="Tue, 2 Jun 2015 23:13:34 +0000"/>
                            <attachment id="12737482" name="13811.v2.branch-1.txt" size="86666" author="stack" created="Thu, 4 Jun 2015 06:45:24 +0000"/>
                            <attachment id="12737630" name="13811.v3.branch-1.txt" size="92584" author="stack" created="Thu, 4 Jun 2015 17:13:23 +0000"/>
                            <attachment id="12737629" name="13811.v3.branch-1.txt" size="92584" author="stack" created="Thu, 4 Jun 2015 17:12:02 +0000"/>
                            <attachment id="12737655" name="13811.v4.branch-1.txt" size="845375" author="stack" created="Thu, 4 Jun 2015 18:55:00 +0000"/>
                            <attachment id="12737661" name="13811.v5.branch-1.txt" size="92679" author="stack" created="Thu, 4 Jun 2015 19:15:17 +0000"/>
                            <attachment id="12737737" name="13811.v6.branch-1.txt" size="92991" author="stack" created="Thu, 4 Jun 2015 23:44:38 +0000"/>
                            <attachment id="12737698" name="13811.v6.branch-1.txt" size="92991" author="stack" created="Thu, 4 Jun 2015 21:17:04 +0000"/>
                            <attachment id="12737860" name="13811.v7.branch-1.txt" size="96304" author="stack" created="Fri, 5 Jun 2015 07:44:03 +0000"/>
                            <attachment id="12738020" name="13811.v8.branch-1.txt" size="107553" author="stack" created="Fri, 5 Jun 2015 19:41:28 +0000"/>
                            <attachment id="12738033" name="13811.v9.branch-1.txt" size="109429" author="stack" created="Fri, 5 Jun 2015 20:03:02 +0000"/>
                            <attachment id="12738367" name="HBASE-13811-branch-1.1.patch" size="23560" author="Apache9" created="Mon, 8 Jun 2015 14:56:31 +0000"/>
                            <attachment id="12737087" name="HBASE-13811-v1.testcase.patch" size="6923" author="Apache9" created="Wed, 3 Jun 2015 05:11:06 +0000"/>
                            <attachment id="12737073" name="HBASE-13811.testcase.patch" size="7200" author="Apache9" created="Wed, 3 Jun 2015 03:01:28 +0000"/>
                            <attachment id="12737911" name="startCacheFlush.diff" size="6230" author="Apache9" created="Fri, 5 Jun 2015 10:56:49 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>18.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 2 Jun 2015 23:31:31 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 25 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2fein:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>