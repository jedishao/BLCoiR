<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 02 20:32:27 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-209/HBASE-209.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-209] [hbase] HLog generates incorrect file name when splitting a log, race  condition also contributes</title>
                <link>https://issues.apache.org/jira/browse/HBASE-209</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;In Hadoop-Nightly #277 TestRegionServerExit failed with a timeout.&lt;/p&gt;

&lt;p&gt;The reason for this was a race in the Master in which checkAssigned (run from either the root or meta scanner)  will immediately try to split the log and then assign a region which has invalid server info.&lt;/p&gt;

&lt;p&gt;The scenario went something like this:&lt;/p&gt;

&lt;p&gt;1. region server aborted&lt;br/&gt;
2. root region was written on optional cache flush&lt;br/&gt;
lease timed out on aborted server which removes it from serversToServerInfo and queues a PendingServerShutdown operation&lt;br/&gt;
3. root scanner runs and finds server info incorrect (it is in the root region but the server is not in serversToServerInfo&lt;br/&gt;
4. checkAssigned starts splitting the log but because the log name is incorrect it can&apos;t finish&lt;br/&gt;
5. PendingServerShutdown fires and really gums up the works.&lt;/p&gt;

&lt;p&gt;So there are two problems:&lt;/p&gt;

&lt;p&gt;1. HLog.splitLog needs to generate the correct log file name.&lt;br/&gt;
2. PendingServerShutdown and/or leaseExpired need to cooperate with checkAssigned so that there are not two concurrent attempts to recover the log.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12380791">HBASE-209</key>
            <summary>[hbase] HLog generates incorrect file name when splitting a log, race  condition also contributes</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="jimk">Jim Kellerman</reporter>
                        <labels>
                    </labels>
                <created>Fri, 19 Oct 2007 16:52:48 +0000</created>
                <updated>Fri, 22 Aug 2008 21:34:55 +0000</updated>
                            <resolved>Sat, 20 Oct 2007 14:16:50 +0000</resolved>
                                                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12536396" author="jimk" created="Sat, 20 Oct 2007 03:20:06 +0000"  >&lt;p&gt;This patch addresses both &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-209&quot; title=&quot;[hbase] HLog generates incorrect file name when splitting a log, race  condition also contributes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-209&quot;&gt;&lt;del&gt;HADOOP-2079&lt;/del&gt;&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-112&quot; title=&quot;A table with row keys containing colon fails to split regions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-112&quot;&gt;&lt;del&gt;HADOOP-2056&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Changes:&lt;/p&gt;

&lt;p&gt;Because row keys are essentially unbounded in length and can potentially file name unfriendly characters, the start key is now SHA1 encoded and inserted into the file name as a long decimal number. This is better than using Base64 encoding of the row key because the Base64 encoding is longer than the row key and can consequently cause the file name to be too long. This approach assures that file names will be unique and still be short enough for modern file systems. HRegionInfo now supports this encoding method and since SHA1 encoding is not reversable, the decode method has been removed.&lt;/p&gt;

&lt;p&gt;HStore uses both the raw region name and the encoded region name.&lt;/p&gt;

&lt;p&gt;Use new static method HRegionInfo.encodeRegionName: HLog, HMaster, HRegion&lt;/p&gt;

&lt;p&gt;HMaster avoids race conditions on log splitting by only doing them in PendingServerShutdown if the server&apos;s lease expires while the master is running. If the master is just starting up, then the root and meta scanners invoke log splitting if they find stale server data.&lt;/p&gt;

&lt;p&gt;HStoreFile now uses ArrayList and List instead of Vector and Collection&lt;/p&gt;
</comment>
                            <comment id="12536405" author="hadoopqa" created="Sat, 20 Oct 2007 07:01:32 +0000"  >&lt;p&gt;+1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
&lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12368061/patch.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12368061/patch.txt&lt;/a&gt;&lt;br/&gt;
against trunk revision r586264.&lt;/p&gt;

&lt;p&gt;    @author +1.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    javadoc +1.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    javac +1.  The applied patch does not generate any new compiler warnings.&lt;/p&gt;

&lt;p&gt;    findbugs +1.  The patch does not introduce any new Findbugs warnings.&lt;/p&gt;

&lt;p&gt;    core tests +1.  The patch passed core unit tests.&lt;/p&gt;

&lt;p&gt;    contrib tests +1.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://lucene.zones.apache.org:8080/hudson/job/Hadoop-Patch/974/testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://lucene.zones.apache.org:8080/hudson/job/Hadoop-Patch/974/testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;http://lucene.zones.apache.org:8080/hudson/job/Hadoop-Patch/974/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://lucene.zones.apache.org:8080/hudson/job/Hadoop-Patch/974/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Checkstyle results: &lt;a href=&quot;http://lucene.zones.apache.org:8080/hudson/job/Hadoop-Patch/974/artifact/trunk/build/test/checkstyle-errors.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://lucene.zones.apache.org:8080/hudson/job/Hadoop-Patch/974/artifact/trunk/build/test/checkstyle-errors.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://lucene.zones.apache.org:8080/hudson/job/Hadoop-Patch/974/console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://lucene.zones.apache.org:8080/hudson/job/Hadoop-Patch/974/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="12536427" author="hudson" created="Sat, 20 Oct 2007 12:09:55 +0000"  >&lt;p&gt;Integrated in Hadoop-Nightly #278 (See &lt;a href=&quot;http://lucene.zones.apache.org:8080/hudson/job/Hadoop-Nightly/278/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://lucene.zones.apache.org:8080/hudson/job/Hadoop-Nightly/278/&lt;/a&gt;)&lt;/p&gt;</comment>
                            <comment id="12536433" author="jimk" created="Sat, 20 Oct 2007 14:16:50 +0000"  >&lt;p&gt;This issue was mostly about the incorrect HLog name generation and the race condition in the master in splitting the HLog when a region server dies. That part has been fixed. Resolving this issue.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12382733">HBASE-206</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12368061" name="patch.txt" size="24953" author="jimk" created="Sat, 20 Oct 2007 03:20:06 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sat, 20 Oct 2007 07:01:32 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>24993</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 7 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0h5fz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>98144</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>