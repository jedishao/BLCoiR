<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sat Dec 03 16:24:29 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-2225/HBASE-2225.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-2225] Enable compression in HBase Export</title>
                <link>https://issues.apache.org/jira/browse/HBASE-2225</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;org.apache.hadoop.hbase.mapreduce.Export should set compression codec&lt;/p&gt;

&lt;p&gt;In createSubmittableJob(), the following should be added:&lt;br/&gt;
    FileOutputFormat.setCompressOutput(job, true);&lt;br/&gt;
    FileOutputFormat.setOutputCompressorClass(job, org.apache.hadoop.io.compress.GzipCodec.class);&lt;/p&gt;

&lt;p&gt;From my experiment, 10% to 50% reduction in Export output has been observed.&lt;/p&gt;

&lt;p&gt;SequenceFileInputFormat used by the Import tool is able to detect GzipCodec - there is no change for Import class.&lt;/p&gt;</description>
                <environment>&lt;p&gt;OS agnostic&lt;/p&gt;</environment>
        <key id="12456228">HBASE-2225</key>
            <summary>Enable compression in HBase Export</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="3">Duplicate</resolution>
                                        <assignee username="kannanm">Kannan Muthukkaruppan</assignee>
                                    <reporter username="ted_yu">Ted Yu</reporter>
                        <labels>
                    </labels>
                <created>Sat, 13 Feb 2010 15:46:04 +0000</created>
                <updated>Fri, 20 Nov 2015 13:01:18 +0000</updated>
                            <resolved>Thu, 28 Oct 2010 23:45:17 +0000</resolved>
                                    <version>0.20.1</version>
                                    <fixVersion>0.90.0</fixVersion>
                                    <component>util</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                    <timeoriginalestimate seconds="1800">0.5h</timeoriginalestimate>
                            <timeestimate seconds="1800">0.5h</timeestimate>
                                        <comments>
                            <comment id="12833421" author="stack" created="Sat, 13 Feb 2010 17:59:58 +0000"  >&lt;p&gt;I think this should be an option.  How about adding it as a command-line flag or something to the export job?&lt;/p&gt;</comment>
                            <comment id="12833434" author="larsgeorge" created="Sat, 13 Feb 2010 18:45:55 +0000"  >&lt;p&gt;+1&lt;/p&gt;

&lt;p&gt;I have done the same in the past and can confirm the implicit support by the InputFormat. I added it like this&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-comment&quot;&gt;// set output stream compression
&lt;/span&gt;    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (params.get(CONF_COMPRESS) != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
      job.set(&lt;span class=&quot;code-quote&quot;&gt;&quot;mapred.output.compress&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;);
      job.set(&lt;span class=&quot;code-quote&quot;&gt;&quot;mapred.output.compression.codec&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.hadoop.io.compress.GzipCodec&quot;&lt;/span&gt;);
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;where CONF_COMPRESS is a simple command line switch. This is mapred code so Ted&apos;s code is more current and can be used as is.&lt;/p&gt;

&lt;p&gt;Ted, you want to make a patch? If not I can add it as well. Let me know.&lt;/p&gt;</comment>
                            <comment id="12833453" author="ted_yu" created="Sat, 13 Feb 2010 20:59:43 +0000"  >&lt;p&gt;Using command line switch is fine.&lt;br/&gt;
I think we can make this feature more versatile by naming the switch no_compression_export. Meaning by default, GzipCodec is used for Export.&lt;/p&gt;

&lt;p&gt;We detect compression mode of the table first. If the table is compressed, we don&apos;t apply GzipCodec. Otherwise we apply GzipCodec unless no_compression_export is specified.&lt;/p&gt;

&lt;p&gt;Since SequenceFileInputFormat is able to handle GzipCodec, this won&apos;t cause regression for the Import class.&lt;/p&gt;</comment>
                            <comment id="12833458" author="ted_yu" created="Sat, 13 Feb 2010 21:39:40 +0000"  >&lt;p&gt;Little more detail: we iterate through HColumnDescriptor&apos;s of the table (HTableDescriptor.getFamilies()). If all column families are compressed, we don&apos;t use GzipCodec for Export.&lt;/p&gt;</comment>
                            <comment id="12833576" author="ted_yu" created="Sun, 14 Feb 2010 14:58:35 +0000"  >&lt;p&gt;Here is the code I use:&lt;br/&gt;
	// determine if GzipCodec should be used&lt;br/&gt;
	HBaseAdmin admin = new HBaseAdmin((HBaseConfiguration)conf);&lt;br/&gt;
	HTableDescriptor tableDesc = admin.getTableDescriptor(tableName.getBytes());&lt;br/&gt;
	Collection&amp;lt;HColumnDescriptor&amp;gt; families = tableDesc.getFamilies();&lt;br/&gt;
	boolean compressed = true;&lt;br/&gt;
	for (HColumnDescriptor col : families)&lt;br/&gt;
	{&lt;br/&gt;
		Compression.Algorithm algo = col.getCompressionType();&lt;br/&gt;
		if (algo == Compression.Algorithm.NONE)&lt;/p&gt;
		{
			compressed = false;
		}
&lt;p&gt;	}&lt;br/&gt;
	if (!compressed)&lt;/p&gt;
	{
		FileOutputFormat.setCompressOutput(job, true);
		FileOutputFormat.setOutputCompressorClass(job, org.apache.hadoop.io.compress.GzipCodec.class);
	}</comment>
                            <comment id="12833602" author="apurtell" created="Sun, 14 Feb 2010 18:11:46 +0000"  >&lt;p&gt;Need a test for LZO also then?&lt;/p&gt;</comment>
                            <comment id="12833617" author="ted_yu" created="Sun, 14 Feb 2010 20:08:43 +0000"  >&lt;p&gt;If LZO compression is 10% bigger than that of GZ, it may be fine not to compress again with GZ for export.&lt;br/&gt;
I think command line switch comes into play when table is LZO compressed - it&apos;s up to the user of Export to decide.&lt;/p&gt;</comment>
                            <comment id="12833678" author="stack" created="Mon, 15 Feb 2010 05:00:41 +0000"  >&lt;p&gt;.bq We detect compression mode of the table first. If the table is compressed, we don&apos;t apply GzipCodec. Otherwise we apply GzipCodec unless no_compression_export is specified.&lt;/p&gt;

&lt;p&gt;Isn&apos;t the fact that the table is compressed orthogonal to whether or not the export should be compressed?&lt;/p&gt;

&lt;p&gt;I&apos;d say, no compression should be the default.  Thats how its been working up to this.&lt;/p&gt;

&lt;p&gt;I&apos;m good with the compression being gzip since as Lars and Ted say, its native to sequencefiles.&lt;/p&gt;</comment>
                            <comment id="12833685" author="ted_yu" created="Mon, 15 Feb 2010 05:34:28 +0000"  >&lt;p&gt;Let&apos;s implement using my initial suggestion which Lars and Stack concurred.&lt;/p&gt;</comment>
                            <comment id="12834680" author="larsgeorge" created="Wed, 17 Feb 2010 08:09:16 +0000"  >&lt;p&gt;Agreed. I think what Ted meant (and Andrew also touched) is that if a table has compression enabled then it would make sense to use it for backups too. So that small tables for example are stored as is. Ted, since the backup reads the KeyValue records compression is not part of the equation anymore, i.e. the MapReduce job doing the backup does not know if the table was compressed or not. I&apos;ll implement the command line switch and attach a patch today.&lt;/p&gt;</comment>
                            <comment id="12834760" author="larsgeorge" created="Wed, 17 Feb 2010 13:39:20 +0000"  >&lt;p&gt;Patch adds command line switch to enable compression as well as fixing a small typo in info line logged at startup.&lt;/p&gt;</comment>
                            <comment id="12834958" author="larsgeorge" created="Wed, 17 Feb 2010 19:43:55 +0000"  >&lt;p&gt;Trying to test this now and getting&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
java.lang.IllegalArgumentException: SequenceFile doesn&apos;t work with GzipCodec without &lt;span class=&quot;code-keyword&quot;&gt;native&lt;/span&gt;-hadoop code!
        at org.apache.hadoop.io.SequenceFile.createWriter(SequenceFile.java:379)
        at org.apache.hadoop.io.SequenceFile.createWriter(SequenceFile.java:347)
        at org.apache.hadoop.io.SequenceFile.createWriter(SequenceFile.java:420)
        at org.apache.hadoop.mapreduce.lib.output.SequenceFileOutputFormat.getSequenceWriter(SequenceFileOutputFormat.java:60)
        at org.apache.hadoop.mapreduce.lib.output.SequenceFileOutputFormat.getRecordWriter(SequenceFileOutputFormat.java:71)
        at org.apache.hadoop.mapred.MapTask$NewDirectOutputCollector.&amp;lt;init&amp;gt;(MapTask.java:509)
        at org.apache.hadoop.mapred.MapTask.runNewMapper(MapTask.java:619)
        at org.apache.hadoop.mapred.MapTask.run(MapTask.java:323)
        at org.apache.hadoop.mapred.LocalJobRunner$Job.run(LocalJobRunner.java:257)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Is that a change in Hadoop? This used to work before I am sure. Comments? I will look into it.&lt;/p&gt;</comment>
                            <comment id="12834967" author="larsgeorge" created="Wed, 17 Feb 2010 19:58:48 +0000"  >&lt;p&gt;Looks like that is the same check in Hadoop 0.20.1, so it must be due to my local setup. Ted, care to test the change? Otherwise I tested it with various command line arguments and it works as expected.&lt;/p&gt;</comment>
                            <comment id="12835013" author="ted_yu" created="Wed, 17 Feb 2010 21:54:29 +0000"  >&lt;p&gt;We use hadoop-0.20.1 and hbase-0.20.1&lt;br/&gt;
Would this combination count ?&lt;/p&gt;




</comment>
                            <comment id="12838494" author="ted_yu" created="Thu, 25 Feb 2010 19:32:39 +0000"  >&lt;p&gt;Would it be useful if we add the ability to filter records using selected row key values ?&lt;/p&gt;

&lt;p&gt;Thanks&lt;/p&gt;</comment>
                            <comment id="12861267" author="larsgeorge" created="Tue, 27 Apr 2010 07:05:12 +0000"  >&lt;p&gt;Patch v2 includes using JOpt-Simple to gather various command line parameters for the Export. It also adds in parts &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2434&quot; title=&quot;Add scanner caching option to Export and write buffer option for Import&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2434&quot;&gt;&lt;del&gt;HBASE-2434&lt;/del&gt;&lt;/a&gt; namely the setCaching() option. It also adds a secondary option to specify time ranges.&lt;/p&gt;

&lt;p&gt;What I need here is an OK that JOpt-Simple is the way to go and I used it proper. Note that I did not go down the &quot;double braces&quot; initializer, mainly because even if you specify a &quot;ofType(Class)&quot; JOpt will still return an &quot;Object&quot; only. Furthermore it does &lt;b&gt;not&lt;/b&gt; - unlike other packages of the same kind - handle options with long and short option as the same that way. Only if you use an OptionSpec class you will get the proper types back since it uses generics and also combines options with long and short names.&lt;/p&gt;

&lt;p&gt;Output is now:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;$java org.apache.hadoop.hbase.mapreduce.Export

Option                                  Description                            
------                                  -----------                            
-?, -h, --help                          Show this help                         
-c, --caching &amp;lt;Integer&amp;gt;                 Number of rows for caching             
-e, --endtime &amp;lt;Long&amp;gt;                    End time as long value                 
--enddate &amp;lt;yyyyMMddHHmm&amp;gt;                End date (alternative to --endtime)    
-n, --versions &amp;lt;Integer&amp;gt;                Maximum versions                       
-o, --outputdir                         Output directory                       
-s, --starttime &amp;lt;Long&amp;gt;                  Start time as long value               
--startdate &amp;lt;yyyyMMddHHmm&amp;gt;              Start date (alternative to --starttime)
-t, --tablename                         Table name                             
-z, --compress                          Enable compression of output files     
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Note: Another grief I have is that it also has the sorting of options when using &quot;-h&quot; for example hardcoded. That is also the case for commons-cli. Not sure what that is about but I would rather sort options the way I add them in the code as they belong to each other. Ah well.&lt;/p&gt;</comment>
                            <comment id="12861268" author="larsgeorge" created="Tue, 27 Apr 2010 07:06:12 +0000"  >&lt;p&gt;Ted,&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Would it be useful if we add the ability to filter records using selected row key values ?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Please add another issue for that if not already done.&lt;/p&gt;</comment>
                            <comment id="12861358" author="ted_yu" created="Tue, 27 Apr 2010 10:57:47 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2495&quot; title=&quot;Allow record filtering with selected row key values in HBase Export&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2495&quot;&gt;&lt;del&gt;HBASE-2495&lt;/del&gt;&lt;/a&gt; has been logged for record filtering.&lt;/p&gt;</comment>
                            <comment id="12863047" author="stack" created="Sat, 1 May 2010 20:06:37 +0000"  >&lt;p&gt;Patch looks good to me Lars.  You were going to upload another though going by irc conversation?&lt;/p&gt;</comment>
                            <comment id="12925991" author="kannanm" created="Thu, 28 Oct 2010 23:35:40 +0000"  >&lt;p&gt;See &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3166&quot; title=&quot;HBase exporter should compress output files by default (or at least allow this as an option)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3166&quot;&gt;&lt;del&gt;HBASE-3166&lt;/del&gt;&lt;/a&gt; &amp;amp; &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3167&quot; title=&quot;HBase Export: Add ability to export specific Column Family; Turn Block Cache off during export; improve usage doc&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3167&quot;&gt;&lt;del&gt;HBASE-3167&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;We ran into this need too; and it turned out that via the use of -D options this is already possible.&lt;/p&gt;</comment>
                            <comment id="12926000" author="stack" created="Thu, 28 Oct 2010 23:45:17 +0000"  >&lt;p&gt;Closing as &apos;duplicate&apos;, superceded by the application of &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3167&quot; title=&quot;HBase Export: Add ability to export specific Column Family; Turn Block Cache off during export; improve usage doc&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3167&quot;&gt;&lt;del&gt;HBASE-3167&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="15017766" author="lars_francke" created="Fri, 20 Nov 2015 13:01:18 +0000"  >&lt;p&gt;This issue was closed as part of a bulk closing operation on 2015-11-20. All issues that have been resolved and where all fixVersions have been released have been closed (following discussions on the mailing list).&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12478624">HBASE-3166</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                                                <inwardlinks description="is depended upon by">
                                        <issuelink>
            <issuekey id="12461751">HBASE-2434</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12436100" name="HBASE-2225-trunk.patch" size="3028" author="larsgeorge" created="Wed, 17 Feb 2010 13:39:20 +0000"/>
                            <attachment id="12442929" name="HBASE-2225-v2-trunk.patch" size="8730" author="larsgeorge" created="Tue, 27 Apr 2010 07:05:12 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sat, 13 Feb 2010 17:59:58 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>32468</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 2 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0hguf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>99991</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310192" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Release Note</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>HBase Export tool now uses GzipCodec to compress its output.</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>