<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sat Dec 03 16:04:26 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-10060/HBASE-10060.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-10060] Unsynchronized scanning</title>
                <link>https://issues.apache.org/jira/browse/HBASE-10060</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-10015&quot; title=&quot;Replace intrinsic locking with explicit locks in StoreScanner&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-10015&quot;&gt;&lt;del&gt;HBASE-10015&lt;/del&gt;&lt;/a&gt; has some lengthy discussion. The solution there ended up replacing synchronized with ReentrantLock, which - somewhat surprisingly - yielded a non-trivial improvement for tall tables.&lt;br/&gt;
The goal should be to avoid locking in StoreScanner at all. StoreScanner is only accessed by a single thread &lt;b&gt;except&lt;/b&gt; when we have a concurrent flush or a compaction, which is rare (we&apos;d acquire and release the lock millions of times per second, and compact/flush a few time an hour at the most).&lt;/p&gt;</description>
                <environment></environment>
        <key id="12681977">HBASE-10060</key>
            <summary>Unsynchronized scanning</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="3">Duplicate</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="lhofhansl">Lars Hofhansl</reporter>
                        <labels>
                    </labels>
                <created>Sun, 1 Dec 2013 00:57:33 +0000</created>
                <updated>Thu, 9 Apr 2015 05:46:17 +0000</updated>
                            <resolved>Thu, 9 Apr 2015 05:46:17 +0000</resolved>
                                                                        <due></due>
                            <votes>0</votes>
                                    <watches>9</watches>
                                                                <comments>
                            <comment id="13835918" author="lhofhansl" created="Sun, 1 Dec 2013 01:03:38 +0000"  >&lt;p&gt;A possible solution is delegate the locks to the outside.&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;During a compaction or flush we&apos;d lock the StoreScanner object for the duration of the compaction/flush. When we call updateReaders we&apos;d attempts to lock the StoreScanner, and thus delay the update of the readers until after the compaction has finished.&lt;/li&gt;
	&lt;li&gt;For a &quot;normal&quot; scan we&apos;d delegate the locking to the enclosing RegionScannerImpl.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;That way there is no repeating lock/unlock during frequent calls to StoreScanner.peek/next/seek/etc.&lt;/p&gt;

&lt;p&gt;It would also force delay updating the readers until it&apos;s safe to do so without any complicating reference counting logic.&lt;/p&gt;</comment>
                            <comment id="13835920" author="lhofhansl" created="Sun, 1 Dec 2013 01:05:55 +0000"  >&lt;p&gt;For 0.94 this should pull in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-9949&quot; title=&quot;Fix the race condition between Compaction and StoreScanner.init&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-9949&quot;&gt;&lt;del&gt;HBASE-9949&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="13835924" author="stack" created="Sun, 1 Dec 2013 02:17:56 +0000"  >&lt;blockquote&gt;&lt;p&gt;During a compaction or flush we&apos;d lock the StoreScanner object for the duration of the compaction/flush&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Trying to understand.  No forward progress on scan during a flush or compaction? We&apos;d have to find all outstanding storescanners and lock them all?  THanks.&lt;/p&gt;</comment>
                            <comment id="13835930" author="lhofhansl" created="Sun, 1 Dec 2013 02:47:42 +0000"  >&lt;p&gt;The the other way round, no forward progress on replacing the readers until all compaction/scanning over any involved readers is done. Need to think about deadlocks.&lt;/p&gt;</comment>
                            <comment id="13835936" author="lhofhansl" created="Sun, 1 Dec 2013 03:20:26 +0000"  >&lt;p&gt;So to be specific we use the RegionScannerImpl, which already takes a lock for &quot;normal&quot; scans. For compactions/flushes we lock the scanner for the entire operation ahead of time. For this to work we need part of &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-9949&quot; title=&quot;Fix the race condition between Compaction and StoreScanner.init&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-9949&quot;&gt;&lt;del&gt;HBASE-9949&lt;/del&gt;&lt;/a&gt; in 0.96 and 0.94 (the part where we also call updateReaders StoreScanner on behalf on compactions and flushes). Then we can use the lock on StoreScanner.updateReader to delay replacing the readers.&lt;br/&gt;
Might be easiest to just explain with a patch &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13835960" author="lhofhansl" created="Sun, 1 Dec 2013 05:01:52 +0000"  >&lt;p&gt;Sample trunk patch. Please have a look (not too dissimilar to one of the attempts on &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-10015&quot; title=&quot;Replace intrinsic locking with explicit locks in StoreScanner&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-10015&quot;&gt;&lt;del&gt;HBASE-10015&lt;/del&gt;&lt;/a&gt;, but deals with the compactions/flushes as well).&lt;/p&gt;

&lt;p&gt;Uses RegionScannerImpl as lock delegate when available, otherwise the called must hold a lock on the StoreScanner instance.&lt;/p&gt;

&lt;p&gt;This notably makes the code a bit more error prone, and it breaks the abstraction of StoreScanner a bit.&lt;/p&gt;

&lt;p&gt;Maybe the lock delegation could be abstracted a bit nicer.&lt;/p&gt;</comment>
                            <comment id="13835961" author="lhofhansl" created="Sun, 1 Dec 2013 05:07:09 +0000"  >&lt;p&gt;Makes TestAtomicOperation fail, though. Will have a look later.&lt;/p&gt;</comment>
                            <comment id="13835974" author="lhofhansl" created="Sun, 1 Dec 2013 07:04:08 +0000"  >&lt;p&gt;Turns out, this is now a race between a compaction or flush that finishes and a partially created RegionScannerImpl object. Tricky.&lt;/p&gt;</comment>
                            <comment id="13835975" author="lhofhansl" created="Sun, 1 Dec 2013 07:10:14 +0000"  >&lt;p&gt;This fixed TestAtomicOperation, by always initializing syncObject, even when it is later overwritten with the resp RegionScannerImpl in the normal scanner case.&lt;br/&gt;
This is correct, because when it matters, we always sync on the RegionScannerImpl methods.&lt;/p&gt;

&lt;p&gt;Works, but is a bit fragile.&lt;/p&gt;</comment>
                            <comment id="13835984" author="hadoopqa" created="Sun, 1 Dec 2013 09:03:59 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12616464/10060-trunk-v2.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12616464/10060-trunk-v2.txt&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop1.0&lt;/font&gt;.  The patch compiles against the hadoop 1.0 profile.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop2.0&lt;/font&gt;.  The patch compiles against the hadoop 2.0 profile.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 site&lt;/font&gt;.  The patch appears to cause mvn site goal to fail.&lt;/p&gt;

&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core tests&lt;/font&gt;.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.regionserver.TestStoreScanner&lt;br/&gt;
                  org.apache.hadoop.hbase.regionserver.TestMemStore&lt;br/&gt;
                  org.apache.hadoop.hbase.regionserver.TestHRegionBusyWait&lt;br/&gt;
                  org.apache.hadoop.hbase.regionserver.TestStore&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/8035//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/8035//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/8035//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/8035//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/8035//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/8035//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/8035//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/8035//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/8035//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/8035//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/8035//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/8035//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/8035//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/8035//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/8035//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/8035//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/8035//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-thrift.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/8035//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-thrift.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/8035//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/8035//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/8035//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/8035//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14485997" author="jonathan.lawlor" created="Wed, 8 Apr 2015 20:50:08 +0000"  >&lt;p&gt;Hey &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lhofhansl&quot; class=&quot;user-hover&quot; rel=&quot;lhofhansl&quot;&gt;Lars Hofhansl&lt;/a&gt; is this one the same as &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13082&quot; title=&quot;Coarsen StoreScanner locks to RegionScanner&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13082&quot;&gt;&lt;del&gt;HBASE-13082&lt;/del&gt;&lt;/a&gt;? Should we mark this one as a duplicate of &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13082&quot; title=&quot;Coarsen StoreScanner locks to RegionScanner&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13082&quot;&gt;&lt;del&gt;HBASE-13082&lt;/del&gt;&lt;/a&gt;?&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12776620">HBASE-13082</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12616464" name="10060-trunk-v2.txt" size="15161" author="lhofhansl" created="Sun, 1 Dec 2013 07:10:14 +0000"/>
                            <attachment id="12616460" name="10060-trunk.txt" size="14658" author="lhofhansl" created="Sun, 1 Dec 2013 05:01:52 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sun, 1 Dec 2013 02:17:56 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>361236</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 34 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1q9qv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>361535</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>