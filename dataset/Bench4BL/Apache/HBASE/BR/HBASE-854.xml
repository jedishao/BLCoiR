<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 02 20:06:16 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-854/HBASE-854.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-854] hbase-841 broke build on hudson?</title>
                <link>https://issues.apache.org/jira/browse/HBASE-854</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Jim, you want to take a look at it?&lt;/p&gt;

&lt;p&gt;841 changed interfaces.  Changed interfaces can make for odd issues like the hangs exhibited up on hudson (stuff is failing for me on my laptop since about the commit 841... timeouts.  I don&apos;t have same issue on branch).&lt;/p&gt;</description>
                <environment></environment>
        <key id="12403341">HBASE-854</key>
            <summary>hbase-841 broke build on hudson?</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.png">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jimk">Jim Kellerman</assignee>
                                    <reporter username="stack">stack</reporter>
                        <labels>
                    </labels>
                <created>Fri, 29 Aug 2008 05:07:35 +0000</created>
                <updated>Sun, 13 Sep 2009 22:33:29 +0000</updated>
                            <resolved>Sat, 30 Aug 2008 01:33:25 +0000</resolved>
                                                    <fixVersion>0.18.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12627064" author="jimk" created="Fri, 29 Aug 2008 18:38:00 +0000"  >&lt;p&gt;I ran all tests locally. The ones that failed: TestCompaction, TestHRegion, TestSplit, TestMergeTool, TestMigrate all failed due to a change introduced by the patch for &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-826&quot; title=&quot;delete table followed by recreation results in honked table&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-826&quot;&gt;&lt;del&gt;HBASE-826&lt;/del&gt;&lt;/a&gt;. The offending line is in HStore.compact:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    List&amp;lt;MapFile.Reader&amp;gt; copy = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ArrayList&amp;lt;MapFile.Reader&amp;gt;(pReaders.size());
    Collections.copy(copy, pReaders);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Couldn&apos;t the same effect be accomplished by the following single line?&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    List&amp;lt;MapFile.Reader&amp;gt; copy = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ArrayList&amp;lt;MapFile.Reader&amp;gt;(pReaders);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12627072" author="jimk" created="Fri, 29 Aug 2008 19:03:43 +0000"  >&lt;p&gt;After making the change suggested in the previous comment, all tests pass locally for me.&lt;/p&gt;</comment>
                            <comment id="12627076" author="jdcryans" created="Fri, 29 Aug 2008 19:14:50 +0000"  >&lt;p&gt;Fixes what Jim said.&lt;/p&gt;</comment>
                            <comment id="12627078" author="stack" created="Fri, 29 Aug 2008 19:21:14 +0000"  >&lt;p&gt;I commited fix for broke build made by last nights 824.  Can you figure why hudson was failing before last nights commit?&lt;/p&gt;</comment>
                            <comment id="12627096" author="jimk" created="Fri, 29 Aug 2008 20:24:49 +0000"  >&lt;p&gt;This is very strange. The failures only occur on the second test case in a Junit test in which we spin up multiple HBase and Hadoop clusters. But it doesn&apos;t always fail - that&apos;s the baffling part. The following exception causes the region server to abort, and because the client application cannot connect, the test times out. &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    [junit] 2008-08-26 21:24:50,536 FATAL [RegionServer:0] regionserver.HRegionServer(424): Unhandled exception. Aborting...
    [junit] java.io.IOException: Call failed on local exception
    [junit] 	at org.apache.hadoop.ipc.Client.call(Client.java:718)
    [junit] 	at org.apache.hadoop.hbase.ipc.HbaseRPC$Invoker.invoke(HbaseRPC.java:230)
    [junit] 	at $Proxy8.getProtocolVersion(Unknown Source)
    [junit] 	at org.apache.hadoop.hbase.ipc.HbaseRPC.getProxy(HbaseRPC.java:340)
    [junit] 	at org.apache.hadoop.hbase.ipc.HbaseRPC.getProxy(HbaseRPC.java:327)
    [junit] 	at org.apache.hadoop.hbase.ipc.HbaseRPC.getProxy(HbaseRPC.java:364)
    [junit] 	at org.apache.hadoop.hbase.ipc.HbaseRPC.waitForProxy(HbaseRPC.java:302)
    [junit] 	at org.apache.hadoop.hbase.regionserver.HRegionServer.reportForDuty(HRegionServer.java:706)
    [junit] 	at org.apache.hadoop.hbase.regionserver.HRegionServer.run(HRegionServer.java:291)
    [junit] 	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:619)
    [junit] Caused by: java.io.EOFException
    [junit] 	at java.io.DataInputStream.readInt(DataInputStream.java:375)
    [junit] 	at org.apache.hadoop.ipc.Client$Connection.receiveResponse(Client.java:499)
    [junit] 	at org.apache.hadoop.ipc.Client$Connection.run(Client.java:441)
    [junit] 2008-08-26 21:24:50,538 DEBUG [RegionServer:0] hbase.RegionHistorian(316): Offlined
    [junit] Exception in thread &lt;span class=&quot;code-quote&quot;&gt;&quot;RegionServer:0&quot;&lt;/span&gt; java.lang.NullPointerException
    [junit] 	at org.apache.hadoop.hbase.regionserver.HRegionServer.run(HRegionServer.java:450)
    [junit] 	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:619)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Now it could be related to the fact that the client cache is static in HbaseRPC:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; ClientCache CLIENTS=&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ClientCache();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;But why don&apos;t all tests that have multiple test cases fail all the time on the second cluster spin up?&lt;/p&gt;</comment>
                            <comment id="12627098" author="jimk" created="Fri, 29 Aug 2008 20:26:14 +0000"  >&lt;p&gt;Additionally, it is not the same tests that are always failing. There are a couple that seem to fail consistently, but the others come and go.&lt;/p&gt;</comment>
                            <comment id="12627105" author="jdcryans" created="Fri, 29 Aug 2008 20:53:08 +0000"  >&lt;p&gt;Seeing this in a MR job, maybe it&apos;s related: &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2008-08-29 16:36:23,889 WARN org.apache.hadoop.dfs.DFSClient: Exception &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; reading from blk_-9140073437812220967_8876 of /hbase/amsterdam_jdcryans/entities/1505737152/attribute/mapfiles/5985603615951759331/data from 192.168.1.99:56010: java.io.IOException: Premeture EOF from inputStream
        at org.apache.hadoop.io.IOUtils.readFully(IOUtils.java:102)
        at org.apache.hadoop.dfs.DFSClient$BlockReader.readChunk(DFSClient.java:996)
        at org.apache.hadoop.fs.FSInputChecker.readChecksumChunk(FSInputChecker.java:236)
        at org.apache.hadoop.fs.FSInputChecker.fill(FSInputChecker.java:178)
        at org.apache.hadoop.fs.FSInputChecker.read1(FSInputChecker.java:195)
        at org.apache.hadoop.fs.FSInputChecker.read(FSInputChecker.java:159)
        at org.apache.hadoop.dfs.DFSClient$BlockReader.read(DFSClient.java:858)
        at org.apache.hadoop.dfs.DFSClient$DFSInputStream.readBuffer(DFSClient.java:1384)
        at org.apache.hadoop.dfs.DFSClient$DFSInputStream.read(DFSClient.java:1420)
        at java.io.DataInputStream.readFully(DataInputStream.java:178)
        at org.apache.hadoop.io.DataOutputBuffer$Buffer.write(DataOutputBuffer.java:64)
        at org.apache.hadoop.io.DataOutputBuffer.write(DataOutputBuffer.java:102)
        at org.apache.hadoop.io.SequenceFile$Reader.next(SequenceFile.java:1930)
        at org.apache.hadoop.io.SequenceFile$Reader.next(SequenceFile.java:1830)
        at org.apache.hadoop.io.SequenceFile$Reader.next(SequenceFile.java:1876)
        at org.apache.hadoop.io.MapFile$Reader.next(MapFile.java:516)
        at org.apache.hadoop.hbase.regionserver.HStore.getKeys(HStore.java:1375)
        at org.apache.hadoop.hbase.regionserver.HRegion.deleteAll(HRegion.java:1531)
        at org.apache.hadoop.hbase.regionserver.HRegionServer.deleteAll(HRegionServer.java:1276)
        at sun.reflect.GeneratedMethodAccessor10.invoke(Unknown Source)
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
        at java.lang.reflect.Method.invoke(Method.java:597)
        at org.apache.hadoop.hbase.ipc.HbaseRPC$Server.call(HbaseRPC.java:473)
        at org.apache.hadoop.ipc.Server$Handler.run(Server.java:888)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12627118" author="stack" created="Fri, 29 Aug 2008 21:38:49 +0000"  >&lt;p&gt;J-D: Look at the data file in hdfs.  Is it empty?&lt;/p&gt;</comment>
                            <comment id="12627168" author="jimk" created="Sat, 30 Aug 2008 00:15:29 +0000"  >&lt;p&gt;For whatever reason, IPC proxies are not being shut down reliably and consequently test cases that run multiple tests may experience this problem because the proxy cache is static and does not get shut down properly.&lt;br/&gt;
This occurs in HConnectionManager, and in HRegionServer. Further, the RPC version number for HRegionInterface was not incremented when we changed the IPC, so old applications could potentially do &quot;bad things&quot; when talking to a server implementing the new interface.&lt;/p&gt;

&lt;p&gt;We need to ensure that HRegionServer and HConnectionManager call HbaseRPC.stopProxy, for each open connection when the processes are exiting.&lt;/p&gt;</comment>
                            <comment id="12627172" author="stack" created="Sat, 30 Aug 2008 00:35:58 +0000"  >&lt;p&gt;Our HRI version is:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
   * Upped to 3 when we went from Text to &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt; arrays &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; row and column names.
   */
  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; versionID = 3L;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It should be &amp;gt; than this?&lt;/p&gt;

&lt;p&gt;Why you think it started happening?  We had a good run up on hudson w/o this issue (Or looking, maybe we didn&apos;t &amp;#8211; lots of failures.. but at least some were for reasons like my forgetting to add a class to a patch).&lt;/p&gt;</comment>
                            <comment id="12627173" author="stack" created="Sat, 30 Aug 2008 00:36:38 +0000"  >&lt;p&gt;Oh, I think compaction test is broken now too; compactions work differently now.  Will talk to Billy.  See if can get him to fix it.&lt;/p&gt;</comment>
                            <comment id="12627180" author="apurtell" created="Sat, 30 Aug 2008 01:08:14 +0000"  >&lt;p&gt;Attached new patch for this issue. &lt;/p&gt;</comment>
                            <comment id="12627181" author="jimk" created="Sat, 30 Aug 2008 01:33:25 +0000"  >&lt;p&gt;All tests pass both on Linux and Windows after this patch. Thanks for the contribution Andrew!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12389223" name="854.patch" size="2629" author="apurtell" created="Sat, 30 Aug 2008 01:07:34 +0000"/>
                            <attachment id="12389186" name="hbase-854.patch" size="740" author="jdcryans" created="Fri, 29 Aug 2008 19:14:50 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 29 Aug 2008 18:38:00 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>25436</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 14 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0h9uv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>98859</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>