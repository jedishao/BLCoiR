<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 02 20:24:14 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-1562/HBASE-1562.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-1562] How to handle the setting of 32 bit versus 64 bit machines</title>
                <link>https://issues.apache.org/jira/browse/HBASE-1562</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;After adding the tests to verify the correctness of the HeapSize calculations the question of where to set the type of machines that are in the cluster arose.&lt;br/&gt;
I would think that most people are using 64 bit machines but we still need to support the use of 32 bit. So the way I see it we can solve this problem in two ways,&lt;br/&gt;
we can either have a settable parameter the the user sets when starting up the cluster or we can try to figure it out ourselves. I think that the second solution would&lt;br/&gt;
be the best, to make it as easy as possible on the user. &lt;br/&gt;
That means that we need to add extra sizes to HeapSize and maybe even to Bytes.&lt;/p&gt;

&lt;p&gt;Thoughts, comments?&lt;/p&gt;</description>
                <environment></environment>
        <key id="12428588">HBASE-1562</key>
            <summary>How to handle the setting of 32 bit versus 64 bit machines</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="erikholstad@gmail.com">Erik Holstad</assignee>
                                    <reporter username="erikholstad@gmail.com">Erik Holstad</reporter>
                        <labels>
                    </labels>
                <created>Mon, 22 Jun 2009 16:51:37 +0000</created>
                <updated>Sun, 13 Sep 2009 22:24:46 +0000</updated>
                            <resolved>Wed, 24 Jun 2009 20:03:33 +0000</resolved>
                                    <version>0.20.0</version>
                                    <fixVersion>0.20.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12722681" author="stack" created="Mon, 22 Jun 2009 17:06:50 +0000"  >&lt;p&gt;Ask the JVM.  It knows (see the head of log where we print out JVM info.  Maybe way to ask it explicitly in a non-vendor-specific way).&lt;/p&gt;</comment>
                            <comment id="12722683" author="stack" created="Mon, 22 Jun 2009 17:09:17 +0000"  >&lt;p&gt;Hudson looks like its 64bit solaris:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Last login: Fri Mar 20 11:52:10 2009 from 63.203.238.117
Sun Microsystems Inc.   SunOS 5.10      Generic January 2005
-bash-3.00$ isainfo -kv
64-bit amd64 kernel modules
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12722699" author="apurtell" created="Mon, 22 Jun 2009 17:33:12 +0000"  >&lt;p&gt;I am seeing HeapSize/ClassSize related failures on a 64 bit platform also, in TestHFile:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;2009-06-22 17:31:59,860 DEBUG [main] util.ClassSize(147): Primitives 8, arrays 3
, references(inlcuding 16, for object overhead) 3, refSize 4, size 72
------------- ---------------- ---------------

Testcase: testTFileFeatures took 0.359 sec
Testcase: testMetaBlocks took 0.088 sec
Testcase: testNullMetaBlocks took 0.05 sec
Testcase: testCompressionOrdinance took 0.027 sec
Testcase: testComparator took 0.046 sec
Testcase: testHeapSizeForBlockIndex took 0.245 sec
        FAILED
expected:&amp;lt;72&amp;gt; but was:&amp;lt;128&amp;gt;
junit.framework.AssertionFailedError: expected:&amp;lt;72&amp;gt; but was:&amp;lt;128&amp;gt;
        at org.apache.hadoop.hbase.io.hfile.TestHFile.testHeapSizeForBlockIndex(TestHFile.java:273)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12722712" author="erikholstad@gmail.com" created="Mon, 22 Jun 2009 17:51:17 +0000"  >&lt;p&gt;@Stack will play with the System.getProperties(); to see what I can dig out, looks ok, but need to test on 32 bit machine.&lt;/p&gt;

&lt;p&gt;@Purtell looking at the refSize value it looks like this is a 32 bit machine, so might be need to add some extra checks to the way the arc is figured out. &lt;/p&gt;</comment>
                            <comment id="12722715" author="apurtell" created="Mon, 22 Jun 2009 17:55:40 +0000"  >&lt;p&gt;@Holstad: Then your refsizes are wrong:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;% uname -a
Linux BOA01.trendmicro.com 2.6.18-128.1.6.el5.centos.plusxen #1 SMP Thu Apr 2 13
:32:02 EDT 2009 x86_64 x86_64 x86_64 GNU/Linux

% java -version
java version &quot;1.6.0_13&quot;
Java(TM) SE Runtime Environment (build 1.6.0_13-b03)
Java HotSpot(TM) 64-Bit Server VM (build 11.3-b02, mixed mode)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12722723" author="stack" created="Mon, 22 Jun 2009 18:01:54 +0000"  >&lt;p&gt;Related, @Holstad, from a pointer posted over in hbase-1554 by Nitay, &quot;However, if you&apos;d like to write code which is platform specific (shame on you),  the system property sun.arch.data.model has the value &quot;32&quot;, &quot;64&quot;, or &quot;unknown&quot;.  &quot;  Also, do you want to relate that issue to this one?&lt;/p&gt;</comment>
                            <comment id="12722729" author="erikholstad@gmail.com" created="Mon, 22 Jun 2009 18:08:30 +0000"  >&lt;p&gt;@Purtell&lt;br/&gt;
Can you put this in some testcode and see what you get?&lt;/p&gt;

&lt;p&gt;Properties sysProps = System.getProperties();&lt;br/&gt;
System.out.println(&quot;arc &quot; + sysProps.getProperty(&quot;sun.arch.data.model&quot;));&lt;/p&gt;

&lt;p&gt;@Stack, haha yeah that is a great pointer. The reason that we are seeing some of these problems are the code taken from Derby used to decide the arc size, but&lt;br/&gt;
we can make this much better if we don&apos;t need to run gc and try to figure it out that way, just want to see what result Andrew gets.&lt;/p&gt;
</comment>
                            <comment id="12722747" author="apurtell" created="Mon, 22 Jun 2009 18:33:25 +0000"  >&lt;p&gt;@Holstad: &lt;tt&gt;arc 64&lt;/tt&gt;&lt;/p&gt;</comment>
                            <comment id="12722752" author="erikholstad@gmail.com" created="Mon, 22 Jun 2009 18:39:22 +0000"  >&lt;p&gt;@Purtell thanks, will use use that way to determine the arc structure instead of the old one from Derby.&lt;/p&gt;

&lt;p&gt;Since we are going to not only have one set of Sizes to deal with but two, we cannot longer keep them in HeapSize, so I propose that they are moved into ClassSize and are&lt;br/&gt;
calculated after first finding out the arc size.&lt;/p&gt;</comment>
                            <comment id="12723654" author="erikholstad@gmail.com" created="Wed, 24 Jun 2009 17:50:57 +0000"  >&lt;p&gt;Tested this in 32 and 64 bit JVM and it passes in both. Might have to sit down with Jon to make better test for the blockcache after hi is ready and with Ryan and look at Blockindex, since it is kinda hard to test as it is right now.&lt;/p&gt;</comment>
                            <comment id="12723676" author="erikholstad@gmail.com" created="Wed, 24 Jun 2009 18:42:36 +0000"  >&lt;p&gt;Readded empty line.&lt;/p&gt;</comment>
                            <comment id="12723698" author="stack" created="Wed, 24 Jun 2009 19:28:25 +0000"  >&lt;p&gt;Erik:&lt;/p&gt;

&lt;p&gt;As written, does this all work?&lt;/p&gt;

&lt;p&gt;I see that ClassSize only sets its DEFINEs for things like REFERENCE and INTEGER if you call reload.  Otherwise they are 0.  Reload won&apos;t be called on static loading of ClassSize so I&apos;d expect that when you do somethign like this in HLogKey &amp;#8211; ClassSize.ARRAY &amp;#8211; that its going to get the 0 value, not the calculated value suited from 32bit or 64bit jvm.   Would suggest you move the bulk of the reload method into a static at head of ClassSize as in:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; {
  +    Properties sysProps = &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.getProperties();
+    &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; arcModel = sysProps.getProperty(&lt;span class=&quot;code-quote&quot;&gt;&quot;sun.arch.data.model&quot;&lt;/span&gt;);
+    
+    &lt;span class=&quot;code-comment&quot;&gt;//Default value is set to 8, covering the &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; when arcModel is unknown
&lt;/span&gt;+    REFERENCE = 8;
+    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (arcModel.equals(THIRTY_TWO)) {
+      REFERENCE = 4;
     }
+    
+    ARRAY = 3 * REFERENCE;
 
-    refSize = ( 4 &amp;gt; sz) ? 4 : sz;
-    minObjectSize = 4*refSize;
+    ARRAYLIST = align(OBJECT + REFERENCE + Bytes.SIZEOF_INT + 
+        align(Bytes.SIZEOF_INT));
+    
+    BYTE_BUFFER = align(OBJECT + REFERENCE + Bytes.SIZEOF_INT + 
+        3 * Bytes.SIZEOF_BOOLEAN + 4 * Bytes.SIZEOF_INT + Bytes.SIZEOF_LONG); 
+    
+    INTEGER = align(OBJECT + Bytes.SIZEOF_INT);
+    
+    MAP_ENTRY = align(OBJECT + 5 * REFERENCE + Bytes.SIZEOF_BOOLEAN);
+    
+    OBJECT = 2 * REFERENCE;
+    
+    TREEMAP = align(OBJECT + 2 * Bytes.SIZEOF_INT + (5+2) * REFERENCE + 
+        ClassSize.align(OBJECT + Bytes.SIZEOF_INT));
+    
+    STRING = align(OBJECT + REFERENCE + 3 * Bytes.SIZEOF_INT);
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12723702" author="streamy" created="Wed, 24 Jun 2009 19:48:10 +0000"  >&lt;p&gt;Erik is out of the office for the afternoon, so I&apos;m filling in to get this patch in (holding up block cache development)....&lt;/p&gt;

&lt;p&gt;As stack suggested, patch changes from requiring instantiation or a call to reload() to static {}&lt;/p&gt;

&lt;p&gt;Otherwise, I reviewed erik&apos;s patch and looks good.  Tests pass.&lt;/p&gt;</comment>
                            <comment id="12723714" author="stack" created="Wed, 24 Jun 2009 20:03:33 +0000"  >&lt;p&gt;Looks good.  Committed.  Thanks Erik (and Jon).&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12428436">HBASE-1554</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12411676" name="HBASE-1562-v1.patch" size="25680" author="erikholstad@gmail.com" created="Wed, 24 Jun 2009 17:50:57 +0000"/>
                            <attachment id="12411684" name="HBASE-1562-v2.patch" size="25097" author="erikholstad@gmail.com" created="Wed, 24 Jun 2009 18:42:36 +0000"/>
                            <attachment id="12411689" name="HBASE-1562-v3.patch" size="25615" author="streamy" created="Wed, 24 Jun 2009 19:48:10 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 22 Jun 2009 17:06:50 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>25828</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 24 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0hdzr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>99529</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>