<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 02 19:07:11 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-1636/HBASE-1636.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-1636] disable and drop of table is flakey still</title>
                <link>https://issues.apache.org/jira/browse/HBASE-1636</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Just now, cheddar up on IRC had table of 2k regions.  A disable and drop gave him 2k rows in meta of historian info.  He couldn&apos;t progress.  Had to make below script for him:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
meta = HTable.&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt;(&lt;span class=&quot;code-quote&quot;&gt;&quot;.META.&quot;&lt;/span&gt;)
historian = &lt;span class=&quot;code-quote&quot;&gt;&quot;historian:&quot;&lt;/span&gt;
scanner = meta.getScanner([historian].to_java(java.lang.&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;))
&lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; (result = scanner.next())
      meta.deleteAll(result.getRow())
end
exit 0
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This flakey disable/enable/drop is frustrating users.  Need to fix.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12429981">HBASE-1636</key>
            <summary>disable and drop of table is flakey still</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jdcryans">Jean-Daniel Cryans</assignee>
                                    <reporter username="stack">stack</reporter>
                        <labels>
                    </labels>
                <created>Thu, 9 Jul 2009 20:57:44 +0000</created>
                <updated>Fri, 12 Oct 2012 06:14:17 +0000</updated>
                            <resolved>Mon, 4 Jan 2010 19:11:49 +0000</resolved>
                                                    <fixVersion>0.20.3</fixVersion>
                    <fixVersion>0.90.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                            <comments>
                            <comment id="12729423" author="streamy" created="Thu, 9 Jul 2009 21:33:06 +0000"  >&lt;p&gt;As long as all these operations are asynchronous and rely on polling/intervals, it&apos;s going to be clunky to deal with.&lt;/p&gt;

&lt;p&gt;We aren&apos;t doing anything wacky when we disable like compacting or anything, right?&lt;/p&gt;

&lt;p&gt;We need a &quot;fool-proof&quot; method of determining that a table is fully disabled.  Perhaps we should build a list of the regions, disable the table, and then hold until we verify each region is offlined.&lt;/p&gt;

&lt;p&gt;Once properly disabled, should be able to quickly delete the table and all corresponding rows in META.&lt;/p&gt;</comment>
                            <comment id="12754633" author="stack" created="Sat, 12 Sep 2009 22:56:47 +0000"  >&lt;p&gt;I just did a delete of a 1500 region table.  All was cleared from .META. and from hdfs but I notice that some regions are still carrying deleted table regions.&lt;/p&gt;</comment>
                            <comment id="12790376" author="bassam" created="Mon, 14 Dec 2009 21:19:17 +0000"  >&lt;p&gt;I just ran into an interesting case after disabling a table and dropping it. Stack asked me to add a comment here and send the logs. Here are the steps I did to the best of my knowledge:&lt;/p&gt;

&lt;p&gt;1) Created a table &quot;fragment&quot; that has 250M rows in it spread over 3 region servers.&lt;br/&gt;
2) Started the rowcounter program and aborted it with CTRL-C (I did not do a hadoop kill)&lt;br/&gt;
3) In the hbase shell  I ran &quot;disable fragment&quot; which failed with a timeout&lt;br/&gt;
4) The fragment table was left enabled but all regions were disabled (128 regions over 3 RS)&lt;br/&gt;
5) I manually enable a the first region using hbase shell&lt;br/&gt;
6) Disabled the table again which succeeded&lt;br/&gt;
7) Dropped the table which succeeded.&lt;br/&gt;
8) Created a new table with the same name which succeeded.&lt;br/&gt;
9) Dropped the table.&lt;/p&gt;

&lt;p&gt;There are still 8 regions being hosted by the 3 region servers, however the master does not know about any of these regions.&lt;/p&gt;

&lt;p&gt;Here is a scan of the .META.:&lt;/p&gt;

&lt;p&gt;hbase(main):001:0&amp;gt; scan &apos;.META.&apos;&lt;br/&gt;
ROW                          COLUMN+CELL&lt;br/&gt;
0 row(s) in 0.0640 seconds&lt;/p&gt;

&lt;p&gt;And the master seems to assign regions to the RS servers:&lt;/p&gt;

&lt;p&gt;2009-12-14 13:02:30,630 INFO org.apache.hadoop.hbase.master.RegionManager: Assigning region fragment,\xB1\xF5U6\xCD\xAC\xB5\x2B\x05\xB3\x9D3\xEF\xD8\x83\xD6x\x88\x3F\xAE,1260740563365 to ip-10-212-66-112.ec2.internal,60020,1260824549509&lt;/p&gt;

&lt;p&gt;Logs attached.&lt;/p&gt;</comment>
                            <comment id="12790384" author="bassam" created="Mon, 14 Dec 2009 21:31:17 +0000"  >&lt;p&gt;One more data point. Restarting the master seems to have resolved the issue. The zombie regions seem to have gone away. I wonder if the old .META. information is cached in memory somewhere. Are they?&lt;/p&gt;</comment>
                            <comment id="12793454" author="jdcryans" created="Tue, 22 Dec 2009 01:17:37 +0000"  >&lt;p&gt;I&apos;m able to manufacture duplicate assignment messages with this unit test added to TestAdmin:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;

@BeforeClass
  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void setUpBeforeClass() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
    TEST_UTIL.getConfiguration().setInt(&lt;span class=&quot;code-quote&quot;&gt;&quot;hbase.regionserver.msginterval&quot;&lt;/span&gt;, 250);
    TEST_UTIL.getConfiguration().setInt(&lt;span class=&quot;code-quote&quot;&gt;&quot;hbase.client.pause&quot;&lt;/span&gt;, 250);
    TEST_UTIL.startMiniCluster(3);
  }
...
  @Test
  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testHundredsOfTable() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException{
    &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; times = 125;
    HColumnDescriptor fam1 = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HColumnDescriptor(&lt;span class=&quot;code-quote&quot;&gt;&quot;fam1&quot;&lt;/span&gt;);
    fam1.setCompressionType(Compression.Algorithm.GZ);
    HColumnDescriptor fam2 = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HColumnDescriptor(&lt;span class=&quot;code-quote&quot;&gt;&quot;fam2&quot;&lt;/span&gt;);
    fam2.setCompressionType(Compression.Algorithm.GZ);
    HColumnDescriptor fam3 = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HColumnDescriptor(&lt;span class=&quot;code-quote&quot;&gt;&quot;fam3&quot;&lt;/span&gt;);
    fam3.setCompressionType(Compression.Algorithm.GZ);

    &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt;(&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i = 0; i &amp;lt; times; i++) {
      HTableDescriptor htd = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HTableDescriptor(&lt;span class=&quot;code-quote&quot;&gt;&quot;table&quot;&lt;/span&gt;+i);
      htd.addFamily(fam1);
      htd.addFamily(fam2);
      htd.addFamily(fam3);
      &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.admin.createTable(htd);
    }

    &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt;(&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i = 0; i &amp;lt; times; i++) {
      &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.admin.disableTable(&lt;span class=&quot;code-quote&quot;&gt;&quot;table&quot;&lt;/span&gt;+i);
      &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.admin.deleteTable(&lt;span class=&quot;code-quote&quot;&gt;&quot;table&quot;&lt;/span&gt;+i);
    }

    &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt;(&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i = 0; i &amp;lt; times; i++) {
      HTableDescriptor htd = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HTableDescriptor(&lt;span class=&quot;code-quote&quot;&gt;&quot;table&quot;&lt;/span&gt;+i);
      htd.addFamily(fam1);
      htd.addFamily(fam2);
      htd.addFamily(fam3);
      &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.admin.createTable(htd);
    }
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It often fails on disabling.&lt;/p&gt;</comment>
                            <comment id="12794849" author="jdcryans" created="Mon, 28 Dec 2009 18:24:06 +0000"  >&lt;p&gt;I committed a lot of changes in the sub-cases under this one, I&apos;ll leave it open until we stabilize branch and will close it upon the release of 0.20.3&lt;/p&gt;</comment>
                            <comment id="12796292" author="jdcryans" created="Mon, 4 Jan 2010 19:11:49 +0000"  >&lt;p&gt;Closing the issue, I didn&apos;t see any problem using this fixes enclosed in the sub-tasks.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                                                <inwardlinks description="is blocked by">
                                        <issuelink>
            <issuekey id="12431925">HBASE-1730</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12427958" name="hbase-hbase-master-ip-10-212-65-235.log" size="1720465" author="bassam" created="Mon, 14 Dec 2009 21:22:12 +0000"/>
                            <attachment id="12427959" name="hbase-hbase-regionserver-ip-10-212-66-112.log" size="923181" author="bassam" created="Mon, 14 Dec 2009 21:22:12 +0000"/>
                    </attachments>
                <subtasks>
                            <subtask id="12443959">HBASE-2064</subtask>
                            <subtask id="12443960">HBASE-2065</subtask>
                            <subtask id="12444001">HBASE-2067</subtask>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 9 Jul 2009 21:33:06 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>25879</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 48 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i08t1r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>49306</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>