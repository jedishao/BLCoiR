<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sat Dec 03 17:12:21 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-2341/HBASE-2341.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-2341] Suite of test scripts that a.) load a cluster with a verifiable dataset and b.) do random kills of regionserver+datanodes in small cluster</title>
                <link>https://issues.apache.org/jira/browse/HBASE-2341</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;We just filed hbase-2340 but discussion up on irc has it that we need something more hardcore than pussy-footing inside a single jvm as hdfs-2340 does.  The point was made (tlipcon) that its hard to ensure real recovery working if all is in the one JVM.&lt;/p&gt;

&lt;p&gt;So, this issue is about scripts that can:&lt;/p&gt;

&lt;p&gt;+ load a cluster with a dataset that we can &apos;verify&apos; as in we can tell if it has holes in it, if data has been lost.&lt;br/&gt;
+ script that does random kill of a random node on some random occasion&lt;br/&gt;
+ Script that can check cluster for data loss&lt;/p&gt;

&lt;p&gt;All above should work while cluster is under load.&lt;/p&gt;

&lt;p&gt;The above would not sit under junit.&lt;/p&gt;

&lt;p&gt;This looks like a suite that we&apos;d want to run up in ec2 using Andrew&apos;s scripts and our donated aws credits.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
16:12 &amp;lt; tlipcon&amp;gt; here&apos;s my goal: we have a 5 node cluster in the back room. I want to run hbase on that at near full load &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; a week straight &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; some process goes around screwing with it
16:12 &amp;lt; tlipcon&amp;gt; then I want to verify that I didn&apos;t lose a single edit over that week
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12459454">HBASE-2341</key>
            <summary>Suite of test scripts that a.) load a cluster with a verifiable dataset and b.) do random kills of regionserver+datanodes in small cluster</summary>
                <type id="3" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/task.png">Task</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="3">Duplicate</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="stack">stack</reporter>
                        <labels>
                            <label>moved_from_0_20_5</label>
                    </labels>
                <created>Wed, 17 Mar 2010 23:25:26 +0000</created>
                <updated>Wed, 16 Jul 2014 20:45:12 +0000</updated>
                            <resolved>Wed, 16 Jul 2014 20:45:12 +0000</resolved>
                                                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="12846671" author="tlipcon" created="Wed, 17 Mar 2010 23:34:01 +0000"  >&lt;p&gt;Thanks for filing, Stack, and sorry for the confusion around th epurpose of &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2340&quot; title=&quot;Add end-to-end test of sync/flush&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2340&quot;&gt;&lt;del&gt;HBASE-2340&lt;/del&gt;&lt;/a&gt;. I put a couple implementation ideas in comments in that ticket:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2340?focusedCommentId=12846623&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels%3Acomment-tabpanel#action_12846623&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-2340?focusedCommentId=12846623&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels%3Acomment-tabpanel#action_12846623&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2340?focusedCommentId=12846634&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels%3Acomment-tabpanel#action_12846634&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-2340?focusedCommentId=12846634&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels%3Acomment-tabpanel#action_12846634&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12846692" author="apurtell" created="Thu, 18 Mar 2010 00:16:29 +0000"  >&lt;p&gt;Timely. I just put together a first cut of scripted PE up on EC2 using our EC2 scripts. Requires scripts from current head of trunk or 0.20 branch. Fix up the attached script to choose one of the public AMIs. &lt;/p&gt;

&lt;p&gt;But what I want to do is take this bash recipe which works well enough (but is not totally robust) and convert it into a web service that allows one to&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Select a base AMI (with HBase public AMIs as default) and instance types&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Upload replacement Hadoop or HBase jars, additional jars for lib/&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Upload additional files, i.e. test scripts&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Execute something on the command line&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Each test gets its own transient cluster. All output and logs are collected from the cluster just before it is terminated and made available on an ongoing basis for posterity. &lt;/p&gt;

&lt;p&gt;Given what I&apos;ve been working with recently and am most familiar with, I&apos;d implement it as a servlet: can use the jars provided by AWS with their command line tools directly, jsch, etc. &lt;/p&gt;</comment>
                            <comment id="12846694" author="tlipcon" created="Thu, 18 Mar 2010 00:28:57 +0000"  >&lt;p&gt;Having an EC2 harness for this to quickly bring it up on &quot;cloud&quot; hardware would be sweet. Really excited by that idea.&lt;/p&gt;

&lt;p&gt;Can we do that work in a separate JIRA though? Keep this to generating the test scripts themselves, and another JIRA to deploy and run the tests in an EC2 cluster?&lt;/p&gt;</comment>
                            <comment id="12846696" author="apurtell" created="Thu, 18 Mar 2010 00:35:32 +0000"  >&lt;p&gt;I opened &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2343&quot; title=&quot;[EC2] Test harness&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2343&quot;&gt;&lt;del&gt;HBASE-2343&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12847896" author="tlipcon" created="Sun, 21 Mar 2010 07:54:41 +0000"  >&lt;p&gt;Here&apos;s a bit of a hacked together end-to-end verifiable write test. To run:&lt;/p&gt;

&lt;p&gt;a) A few times, perhaps on a few machines:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  bin/hbase org.apache.hadoop.hbase.VerifiableEditor writer &amp;amp;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;these will run until you ctrl-C them, and write little files into /dev/shm&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;b) Once you&apos;ve ctrl-Ced the writers, something like:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
 &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; x in /dev/shm/hbase-verifiableeditor-* ; &lt;span class=&quot;code-keyword&quot;&gt;do&lt;/span&gt; ./bin/hbase org.apache.hadoop.hbase.VerifiableEditor verify $x || touch $x.wasbad ; done
ls -l /dev/shm/*wasbad
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Of course, you can insert various nasty things between (a) and (b) here. I also configured my cluster with 1MB memstores and 4MB split threshold to keep things exciting.&lt;/p&gt;</comment>
                            <comment id="12848025" author="tlipcon" created="Mon, 22 Mar 2010 03:20:22 +0000"  >&lt;p&gt;Updated version of the editor test that does verification in parallel threads.&lt;/p&gt;</comment>
                            <comment id="12848469" author="stack" created="Tue, 23 Mar 2010 00:27:35 +0000"  >&lt;p&gt;VE script looks good to me.&lt;/p&gt;</comment>
                            <comment id="12848472" author="tlipcon" created="Tue, 23 Mar 2010 00:33:28 +0000"  >&lt;p&gt;I still want to write a gremlin script that will do nasty things on a cluster to go along with this.&lt;br/&gt;
Then we can run the two together for a week or so to be really confident that stuff works.&lt;/p&gt;</comment>
                            <comment id="12848555" author="tlipcon" created="Tue, 23 Mar 2010 06:03:33 +0000"  >&lt;p&gt;Cosmin suggests that we instrument the code with a coverage tool while running a long-running cluster test.&lt;br/&gt;
We can then identify edge cases / dark corners better (and write tests to exercise them)&lt;/p&gt;</comment>
                            <comment id="12854274" author="karthik.ranga" created="Wed, 7 Apr 2010 00:20:33 +0000"  >&lt;p&gt;This is a manual test that tries to kill region servers and data nodes, restarts them and verifies the data load. I was running on a 3 RS cluster, and was not able to get to the point that verifies if the read verification works ok.&lt;/p&gt;

&lt;p&gt;The patch will add the source code to the following location in the HBase source:&lt;br/&gt;
src/test/org/apache/hadoop/hbase/manual&lt;/p&gt;

&lt;p&gt;usage:&lt;br/&gt;
HBaseTest   &lt;br/&gt;
  -zk &amp;lt;Zookeeper node&amp;gt;  &lt;br/&gt;
  -load &amp;lt;num keys&amp;gt;:&amp;lt;average cols per key&amp;gt;:&amp;lt;avg data size&amp;gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;:&amp;lt;num threads = 20&amp;gt;&amp;#93;&lt;/span&gt;  &lt;br/&gt;
  -read &amp;lt;start key&amp;gt;:&amp;lt;end key&amp;gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;:&amp;lt;verify percent = 0&amp;gt;:&amp;lt;num threads = 20&amp;gt;&amp;#93;&lt;/span&gt;  &lt;br/&gt;
  -kill &amp;lt;HBase root path&amp;gt;:&amp;lt;HDFS root path&amp;gt;:&amp;lt;minutes between kills&amp;gt;:&amp;lt;RS kill %&amp;gt;:&amp;lt;#keys to verify&amp;gt;&lt;/p&gt;</comment>
                            <comment id="12854280" author="karthik.ranga" created="Wed, 7 Apr 2010 00:37:18 +0000"  >&lt;p&gt;Fix wrong imports.&lt;/p&gt;</comment>
                            <comment id="12854822" author="tlipcon" created="Thu, 8 Apr 2010 05:47:32 +0000"  >&lt;p&gt;I&apos;ve started work on some python based fault injections here: &lt;a href=&quot;http://github.com/toddlipcon/gremlins&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://github.com/toddlipcon/gremlins&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The work is very preliminary, and I plan on continuing to develop it over the next couple of weeks, but would be happy to have other people contribute.&lt;/p&gt;

&lt;p&gt;Once it&apos;s reached a more thorough state we could look at including it right in the HBase source, though it&apos;s generally useful so I plan to keep it on github as well.&lt;/p&gt;</comment>
                            <comment id="12866842" author="stack" created="Wed, 12 May 2010 23:48:57 +0000"  >&lt;p&gt;Bulk move of 0.20.5 issues into 0.21.0 after vote that we merge branch into TRUNK up on list.&lt;/p&gt;</comment>
                            <comment id="12875499" author="apurtell" created="Fri, 4 Jun 2010 06:19:10 +0000"  >&lt;p&gt;Good to have but moving out of next release. &lt;/p&gt;</comment>
                            <comment id="14064061" author="stack" created="Wed, 16 Jul 2014 20:45:12 +0000"  >&lt;p&gt;The integration test suite does this.  Resolving as done/duplicate&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12459465">HBASE-2343</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12440981" name="HBASE-2341-0.20.3.patch" size="44877" author="karthik.ranga" created="Wed, 7 Apr 2010 00:37:18 +0000"/>
                            <attachment id="12439429" name="VerifiableEditor.java" size="10612" author="tlipcon" created="Mon, 22 Mar 2010 03:20:22 +0000"/>
                            <attachment id="12439400" name="VerifiableEditor.java" size="9562" author="tlipcon" created="Sun, 21 Mar 2010 07:54:41 +0000"/>
                            <attachment id="12439102" name="count-slaves.rb" size="175" author="apurtell" created="Thu, 18 Mar 2010 00:16:29 +0000"/>
                            <attachment id="12439101" name="test.sh" size="3570" author="apurtell" created="Thu, 18 Mar 2010 00:16:29 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 17 Mar 2010 23:34:01 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>32529</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 20 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0hhbz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>100070</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>