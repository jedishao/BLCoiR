<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sat Dec 03 16:51:50 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-11833/HBASE-11833.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-11833] Hbase does not closing a closed socket resulting in thousand of CLOSE_WAIT sockets</title>
                <link>https://issues.apache.org/jira/browse/HBASE-11833</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;HBase dose not close a dead connection with the datanode.&lt;br/&gt;
This resulting in over 30K+ CLOSE_WAIT and at some point HBase can not connect to the datanode because too many mapped sockets from one host to another on the same port:50010. &lt;br/&gt;
After I restart all RSs,  the count of CLOSE_WAIT will increase always.&lt;br/&gt;
$ netstat -an|grep CLOSE_WAIT|wc -l&lt;br/&gt;
2545&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;netstat -nap|grep CLOSE_WAIT|grep 6569|wc -l&lt;br/&gt;
2545&lt;/li&gt;
	&lt;li&gt;ps -ef|grep 6569&lt;br/&gt;
hbase     6569  6556 21 Aug25 ?        09:52:33 /opt/jdk1.6.0_25/bin/java -Dproc_regionserver -XX:OnOutOfMemoryError=kill -9 %p -Xmx1000m -XX:+UseConcMarkSweepGC &lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;I aslo have reviewed these issues:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-9393&quot; title=&quot;Hbase does not closing a closed socket resulting in many CLOSE_WAIT &quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-9393&quot;&gt;HBASE-9393&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HDFS-5671&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;HDFS-5671&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HDFS-1836&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;HDFS-1836&lt;/a&gt;&lt;br/&gt;
I found HBase 0.98/Hadoop 2.4.0 I uesed which source codes are not different from these patches.&lt;br/&gt;
But I donot understand why HBase 0.98/Hadoop 2.4.0 also have this isssue. Please check. Thanks a lot.&lt;/p&gt;</description>
                <environment>&lt;p&gt;RHEL 6.3 -HDP 2.1 -6 RegionServers/Datanode -18T per node -3108Regions&lt;/p&gt;</environment>
        <key id="12736997">HBASE-11833</key>
            <summary>Hbase does not closing a closed socket resulting in thousand of CLOSE_WAIT sockets</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="3">Duplicate</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="stevenxu">steven xu</reporter>
                        <labels>
                    </labels>
                <created>Wed, 27 Aug 2014 03:02:30 +0000</created>
                <updated>Thu, 28 Aug 2014 21:28:34 +0000</updated>
                            <resolved>Wed, 27 Aug 2014 20:06:40 +0000</resolved>
                                    <version>0.98.0</version>
                                                    <component>regionserver</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                <comments>
                            <comment id="14111775" author="lhofhansl" created="Wed, 27 Aug 2014 03:25:08 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=stevenxu&quot; class=&quot;user-hover&quot; rel=&quot;stevenxu&quot;&gt;steven xu&lt;/a&gt;, did you ask about this on the mailing lists? You&apos;ll generally get better answers there.&lt;/p&gt;</comment>
                            <comment id="14111782" author="lhofhansl" created="Wed, 27 Aug 2014 03:34:01 +0000"  >&lt;p&gt;See also the comments towards the end here: &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-9393&quot; title=&quot;Hbase does not closing a closed socket resulting in many CLOSE_WAIT &quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-9393&quot;&gt;HBASE-9393&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="14112753" author="apurtell" created="Wed, 27 Aug 2014 20:06:40 +0000"  >&lt;p&gt;Closing as dup of &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-9393&quot; title=&quot;Hbase does not closing a closed socket resulting in many CLOSE_WAIT &quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-9393&quot;&gt;HBASE-9393&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14113563" author="stevenxu" created="Thu, 28 Aug 2014 09:03:49 +0000"  >&lt;p&gt;Guys, before create this issue, I have read the &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-9393&quot; title=&quot;Hbase does not closing a closed socket resulting in many CLOSE_WAIT &quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-9393&quot;&gt;HBASE-9393&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/HDFS-5671&quot; title=&quot;Fix socket leak in DFSInputStream#getBlockReader&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HDFS-5671&quot;&gt;&lt;del&gt;HDFS-5671&lt;/del&gt;&lt;/a&gt;. I found the patch code of these two Issues have added into Hadoop 2.4.0 tag in class BlockReaderFactory.getRemoteBlockReaderFromTcp().  So the &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-9393&quot; title=&quot;Hbase does not closing a closed socket resulting in many CLOSE_WAIT &quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-9393&quot;&gt;HBASE-9393&lt;/a&gt; patch donot solve my problem. Another bug maybe lead my problem, so I created a new issue. Please check also. &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-style: solid;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;border-bottom-style: solid;&quot;&gt;&lt;b&gt;Bar.java&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-comment&quot;&gt;// Some comments here
&lt;/span&gt;  &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; BlockReader getRemoteBlockReaderFromTcp() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (LOG.isTraceEnabled()) {
      LOG.trace(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; + &lt;span class=&quot;code-quote&quot;&gt;&quot;: trying to create a remote block reader from a &quot;&lt;/span&gt; +
          &lt;span class=&quot;code-quote&quot;&gt;&quot;TCP socket&quot;&lt;/span&gt;);
    }
    BlockReader blockReader = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
    &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;) {
      BlockReaderPeer curPeer = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
      Peer peer = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
      &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
        curPeer = nextTcpPeer();
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (curPeer == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) &lt;span class=&quot;code-keyword&quot;&gt;break&lt;/span&gt;;
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (curPeer.fromCache) remainingCacheTries--;
        peer = curPeer.peer;
        blockReader = getRemoteBlockReader(peer);
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; blockReader;
      } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (IOException ioe) {
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (isSecurityException(ioe)) {
          &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (LOG.isTraceEnabled()) {
            LOG.trace(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; + &lt;span class=&quot;code-quote&quot;&gt;&quot;: got security exception &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; constructing &quot;&lt;/span&gt; +
                &lt;span class=&quot;code-quote&quot;&gt;&quot;a remote block reader from &quot;&lt;/span&gt; + peer, ioe);
          }
          &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; ioe;
        }
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; ((curPeer != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) &amp;amp;&amp;amp; curPeer.fromCache) {
          &lt;span class=&quot;code-comment&quot;&gt;// Handle an I/O error we got when using a cached peer.  These are
&lt;/span&gt;          &lt;span class=&quot;code-comment&quot;&gt;// considered less serious, because the underlying socket may be
&lt;/span&gt;          &lt;span class=&quot;code-comment&quot;&gt;// stale.
&lt;/span&gt;          &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (LOG.isDebugEnabled()) {
            LOG.debug(&lt;span class=&quot;code-quote&quot;&gt;&quot;Closed potentially stale remote peer &quot;&lt;/span&gt; + peer, ioe);
          }
        } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
          &lt;span class=&quot;code-comment&quot;&gt;// Handle an I/O error we got when using a newly created peer.
&lt;/span&gt;          LOG.warn(&lt;span class=&quot;code-quote&quot;&gt;&quot;I/O error constructing remote block reader.&quot;&lt;/span&gt;, ioe);
          &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; ioe;
        }
      } &lt;span class=&quot;code-keyword&quot;&gt;finally&lt;/span&gt; {
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (blockReader == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
          IOUtils.cleanup(LOG, peer);
        }
      }
    }
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14114382" author="apurtell" created="Thu, 28 Aug 2014 21:28:34 +0000"  >&lt;p&gt;Rather than paste HDFS code here &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=stevenxu&quot; class=&quot;user-hover&quot; rel=&quot;stevenxu&quot;&gt;steven xu&lt;/a&gt; consider commenting on or filing a new HDFS JIRA.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 27 Aug 2014 03:25:08 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 14 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1zdhz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>