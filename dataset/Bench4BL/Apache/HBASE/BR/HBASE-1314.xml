<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 02 19:01:38 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-1314/HBASE-1314.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-1314] master sees HRS znode expire and splits log while the HRS is still running and accepting edits</title>
                <link>https://issues.apache.org/jira/browse/HBASE-1314</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;ZK session expiration related problem. HRS loses its ephemeral node while it is still up and running and accepting edits. Master sees it go away and starts splitting its logs while edits are still being written. After this, all reconstruction logs have to be manually removed from the region directories or the regions will never deploy (CRC errors). I think on HDFS edits would be lost, not corrupted. (I am using a HBase root on local file system.) &lt;/p&gt;

&lt;p&gt;HRS ZK session expires, causing its znode to go away:&lt;/p&gt;

&lt;p&gt;2009-04-07 03:50:39,953 INFO org.apache.hadoop.hbase.master.ServerManager: localhost.localdomain_1239068648333_60020 znode expired&lt;br/&gt;
2009-04-07 03:50:40,565 DEBUG org.apache.hadoop.hbase.master.HMaster: Processing todo: ProcessServerShutdown of localhost.localdomain_1239068648333_60020&lt;br/&gt;
2009-04-07 03:50:40,637 INFO org.apache.hadoop.hbase.master.RegionServerOperation: process shutdown of server localhost.localdomain_1239068648333_60020: logSplit: false, rootRescanned: false, numberOfMetaRegions: 1, onlineMetaRegions.size(): 1&lt;/p&gt;

&lt;p&gt;But here we have the HRS still reporting in, triggering a LeaseStillHeldException:&lt;/p&gt;

&lt;p&gt;2009-04-07 03:50:40,826 INFO org.apache.hadoop.ipc.HBaseServer: IPC Server handler 2 on 60000, call regionServerReport(address: 127.0.0.1:60020, startcode: 1239068648333, load: (requests=14, regions=7, usedHeap=582, maxHeap=888), [Lorg.apache.hadoop.hbase.HMsg;@6da21389, [Lorg.apache.hadoop.hbase.HRegionInfo;@2bb0bf9a) from 127.0.0.1:39238: error: org.apache.hadoop.hbase.Leases$LeaseStillHeldException&lt;br/&gt;
org.apache.hadoop.hbase.Leases$LeaseStillHeldException&lt;br/&gt;
        at org.apache.hadoop.hbase.master.ServerManager.regionServerReport(ServerManager.java:198)&lt;br/&gt;
        at org.apache.hadoop.hbase.master.HMaster.regionServerReport(HMaster.java:601)&lt;br/&gt;
        at sun.reflect.GeneratedMethodAccessor2.invoke(Unknown Source)&lt;br/&gt;
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
        at java.lang.reflect.Method.invoke(Method.java:597)&lt;br/&gt;
        at org.apache.hadoop.hbase.ipc.HBaseRPC$Server.call(HBaseRPC.java:632)&lt;br/&gt;
        at org.apache.hadoop.hbase.ipc.HBaseServer$Handler.run(HBaseServer.java:909)&lt;/p&gt;

&lt;p&gt;And log splitting starts anyway:&lt;/p&gt;

&lt;p&gt;2009-04-07 03:50:41,139 INFO org.apache.hadoop.hbase.regionserver.HLog: Splitting 3 log(s) in &lt;a href=&quot;file:/data/hbase/log_localhost.localdomain_1239068648333_60020&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;file:/data/hbase/log_localhost.localdomain_1239068648333_60020&lt;/a&gt;&lt;br/&gt;
2009-04-07 03:50:41,139 DEBUG org.apache.hadoop.hbase.regionserver.HLog: Splitting 1 of 3: &lt;a href=&quot;file:/data/hbase/log_localhost.localdomain_1239068648333_60020/hlog.dat.1239075060711&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;file:/data/hbase/log_localhost.localdomain_1239068648333_60020/hlog.dat.1239075060711&lt;/a&gt;&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;...&amp;#93;&lt;/span&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12422196">HBASE-1314</key>
            <summary>master sees HRS znode expire and splits log while the HRS is still running and accepting edits</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="3">Duplicate</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="apurtell">Andrew Purtell</reporter>
                        <labels>
                    </labels>
                <created>Tue, 7 Apr 2009 04:48:27 +0000</created>
                <updated>Sun, 13 Sep 2009 22:24:31 +0000</updated>
                            <resolved>Tue, 9 Jun 2009 23:01:53 +0000</resolved>
                                    <version>0.20.0</version>
                                    <fixVersion>0.20.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12696403" author="apurtell" created="Tue, 7 Apr 2009 04:54:52 +0000"  >&lt;p&gt;Ephemeral znode expiration should not immediately trigger recovery action.&lt;/p&gt;

&lt;p&gt;If the process is not dead but instead only its ZK session has expired, then we can expect it will reinitialize its ZK wrapper and replace the ephemeral nodes. &lt;/p&gt;

&lt;p&gt;Any process (such as master here for this issue) watching the ephemeral node should wait to see if it reappears for some configurable interval rather than immediately taking action. Once the interval has elapsed, then the process can be considered dead. &lt;/p&gt;</comment>
                            <comment id="12696720" author="nitay" created="Tue, 7 Apr 2009 20:15:14 +0000"  >&lt;p&gt;Good catch. Yes, I agree we need some better handling for these cases.&lt;/p&gt;</comment>
                            <comment id="12707556" author="jimk" created="Fri, 8 May 2009 23:29:12 +0000"  >&lt;p&gt;Or increase the timeout interval. In 0.19, the master waits a full 2 minutes before declaring a region server to be dead (with a comment that the lease timeout interval may have to be increased on heavily loaded clusters (but this is due to lease renewal piggybacking on regionServerReport)).&lt;/p&gt;

&lt;p&gt;I&apos;m not really up-to-date on how the ZK stuff works, but it seems to me that renewing the lease should happen in a separate thread with a small sleep interval to keep other work from interfering with lease renewal.&lt;/p&gt;

&lt;p&gt;How does the region server renew its lease anyway?&lt;/p&gt;</comment>
                            <comment id="12707563" author="ryanobjc" created="Fri, 8 May 2009 23:47:46 +0000"  >&lt;p&gt;We need to tighten this a bit, and add some extra checks.  My website can&apos;t wait 2 minutes, so it would be better to be a bit more robust about the master checking, perhaps by trying to talk to the last known port of the regionserver and making sure we can surf ZK session expires.  With a little bit of probing we can probably come with a better medium between a long lease and taking immediate action.&lt;/p&gt;</comment>
                            <comment id="12707567" author="apurtell" created="Fri, 8 May 2009 23:55:46 +0000"  >&lt;p&gt;Getting back to the issue at hand, the problem here is the master takes some recovery action even though the regionserver is actually still up and serving requests. Waiting two minutes to clobber its log won&apos;t make a difference, the log will be just as corrupt. &lt;/p&gt;</comment>
                            <comment id="12707571" author="ryanobjc" created="Sat, 9 May 2009 00:14:51 +0000"  >&lt;p&gt;that&apos;s what I was saying - instead of taking immediate action, probe the HRS to see if it&apos;s still up and taking requests, and if it&apos;s the same one as we thought was before.  That way we can detect barfed network problems instead of taking an inappropriate recovery action.&lt;/p&gt;</comment>
                            <comment id="12707573" author="jimk" created="Sat, 9 May 2009 00:16:13 +0000"  >&lt;p&gt;&amp;gt; Jim Kellerman added a comment - 08/May/09 04:29 PM&lt;br/&gt;
&amp;gt;&lt;br/&gt;
&amp;gt; How does the region server renew its lease anyway?&lt;/p&gt;

&lt;p&gt;Never mind. I RTFM&apos;ed&lt;/p&gt;</comment>
                            <comment id="12717344" author="streamy" created="Mon, 8 Jun 2009 17:58:09 +0000"  >&lt;p&gt;Current status of this issue?  Has not been discussed in a month, need to resolve or punt from 0.20.0&lt;/p&gt;</comment>
                            <comment id="12717856" author="jdcryans" created="Tue, 9 Jun 2009 23:01:53 +0000"  >&lt;p&gt;Resolving as duplicate, will be fixed in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-1439&quot; title=&quot;race between master and regionserver after missed heartbeat&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-1439&quot;&gt;&lt;del&gt;HBASE-1439&lt;/del&gt;&lt;/a&gt; as discussed during HBase dev meeting.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12422270">HBASE-1315</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12425851">HBASE-1439</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 7 Apr 2009 20:15:14 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>25683</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 26 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0hcjj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>99294</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>