<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 02 19:32:59 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-1243/HBASE-1243.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-1243] oldlogfile.dat is screwed, so is it&apos;s region</title>
                <link>https://issues.apache.org/jira/browse/HBASE-1243</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Getting this when a node dies (happens frequently lately):&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;2009-03-05 04:15:03,251 INFO org.apache.hadoop.hbase.master.RegionManager: assigning region web_pages,http:&lt;span class=&quot;code-comment&quot;&gt;//fortcollins.gaymonkey.com/,1235836722125 to server 192.168.1.106:62020
&lt;/span&gt;2009-03-05 04:15:15,263 INFO org.apache.hadoop.hbase.master.ServerManager: Received MSG_REPORT_CLOSE: web_pages,http:&lt;span class=&quot;code-comment&quot;&gt;//fortcollins.gaymonkey.com/,1235836722125: java.io.IOException: Could not obtain block: blk_5568212401457404905_251597 file=/hbase/amsterdam_factory/web_pages/1263377107/oldlogfile.log
&lt;/span&gt;        at org.apache.hadoop.hdfs.DFSClient$DFSInputStream.chooseDataNode(DFSClient.java:1708)
        at org.apache.hadoop.hdfs.DFSClient$DFSInputStream.blockSeekTo(DFSClient.java:1536)
        at org.apache.hadoop.hdfs.DFSClient$DFSInputStream.read(DFSClient.java:1663)
        at java.io.DataInputStream.readFully(DataInputStream.java:178)
        at java.io.DataInputStream.readFully(DataInputStream.java:152)
        at org.apache.hadoop.hbase.io.SequenceFile$Reader.init(SequenceFile.java:1464)
        at org.apache.hadoop.hbase.io.SequenceFile$Reader.&amp;lt;init&amp;gt;(SequenceFile.java:1442)
        at org.apache.hadoop.hbase.io.SequenceFile$Reader.&amp;lt;init&amp;gt;(SequenceFile.java:1431)
        at org.apache.hadoop.hbase.io.SequenceFile$Reader.&amp;lt;init&amp;gt;(SequenceFile.java:1426)
        at org.apache.hadoop.hbase.regionserver.HStore.doReconstructionLog(HStore.java:342)
        at org.apache.hadoop.hbase.regionserver.HStore.runReconstructionLog(HStore.java:297)
        at org.apache.hadoop.hbase.regionserver.HStore.&amp;lt;init&amp;gt;(HStore.java:237)
        at org.apache.hadoop.hbase.regionserver.HRegion.instantiateHStore(HRegion.java:1764)
        at org.apache.hadoop.hbase.regionserver.HRegion.initialize(HRegion.java:276)
        at org.apache.hadoop.hbase.regionserver.HRegionServer.instantiateRegion(HRegionServer.java:1367)
        at org.apache.hadoop.hbase.regionserver.HRegionServer.openRegion(HRegionServer.java:1338)
        at org.apache.hadoop.hbase.regionserver.HRegionServer$Worker.run(HRegionServer.java:1253)
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:619)
 from 192.168.1.106:62020
2009-03-05 04:15:18,266 INFO org.apache.hadoop.hbase.master.RegionManager: assigning region web_pages,http:&lt;span class=&quot;code-comment&quot;&gt;//fortcollins.gaymonkey.com/,1235836722125 to server 192.168.1.106:62020
&lt;/span&gt;2009-03-05 04:15:30,150 INFO org.apache.hadoop.hbase.master.BaseScanner: RegionManager.metaScanner scanning meta region {regionname: .META.,,1, startKey: &amp;lt;&amp;gt;, server: 192.168.1.106:62020}
2009-03-05 04:15:30,276 INFO org.apache.hadoop.hbase.master.ServerManager: Received MSG_REPORT_CLOSE: web_pages,http:&lt;span class=&quot;code-comment&quot;&gt;//fortcollins.gaymonkey.com/,1235836722125: java.io.IOException: Could not obtain block: blk_5568212401457404905_251597 file=/hbase/amsterdam_factory/web_pages/1263377107/oldlogfile.log
&lt;/span&gt;...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It does not recover, I have to manually delete the file.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12416266">HBASE-1243</key>
            <summary>oldlogfile.dat is screwed, so is it&apos;s region</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.png">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="jdcryans">Jean-Daniel Cryans</reporter>
                        <labels>
                    </labels>
                <created>Fri, 6 Mar 2009 00:29:15 +0000</created>
                <updated>Sun, 13 Sep 2009 22:32:20 +0000</updated>
                            <resolved>Fri, 6 Mar 2009 21:30:53 +0000</resolved>
                                    <version>0.19.0</version>
                                    <fixVersion>0.19.1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12679506" author="stack" created="Fri, 6 Mar 2009 06:05:44 +0000"  >&lt;p&gt;You said the file had zero-length in hdfs?&lt;/p&gt;

&lt;p&gt;Here is code from HStore playing the reconstruction log:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-comment&quot;&gt;// Check its not empty.
&lt;/span&gt;    FileStatus[] stats = fs.listStatus(reconstructionLog);
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (stats == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; || stats.length == 0) {
      LOG.warn(&lt;span class=&quot;code-quote&quot;&gt;&quot;Passed reconstruction log &quot;&lt;/span&gt; + reconstructionLog + &lt;span class=&quot;code-quote&quot;&gt;&quot; is zero-length&quot;&lt;/span&gt;);
      &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt;;
    }
    &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; maxSeqIdInLog = -1;
    TreeMap&amp;lt;HStoreKey, &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt; []&amp;gt; reconstructedCache =
      &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; TreeMap&amp;lt;HStoreKey, &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt; []&amp;gt;(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HStoreKey.HStoreKeyWritableComparator(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.info));

    SequenceFile.Reader logReader = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SequenceFile.Reader(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.fs,
        reconstructionLog, &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.conf);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;So, the check above is not working or something else is up.  What you think we should do J-D?  Catch the exception, flag it, and soldier on?  I&apos;m on for that. Big dirty warning in the log and keep going.&lt;/p&gt;


</comment>
                            <comment id="12679722" author="stack" created="Fri, 6 Mar 2009 21:05:28 +0000"  >&lt;p&gt;Hows this for a patch j-d?&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Index: src/java/org/apache/hadoop/hbase/regionserver/HStore.java
===================================================================
--- src/java/org/apache/hadoop/hbase/regionserver/HStore.java   (revision 751066)
+++ src/java/org/apache/hadoop/hbase/regionserver/HStore.java   (working copy)
@@ -339,8 +339,14 @@
     TreeMap&amp;lt;HStoreKey, &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt; []&amp;gt; reconstructedCache =
       &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; TreeMap&amp;lt;HStoreKey, &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt; []&amp;gt;(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HStoreKey.HStoreKeyWritableComparator(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.info));
       
-    SequenceFile.Reader logReader = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SequenceFile.Reader(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.fs,
-        reconstructionLog, &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.conf);
+    SequenceFile.Reader logReader = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
+    &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
+      logReader = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SequenceFile.Reader(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.fs, reconstructionLog, &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.conf);
+    } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (IOException e) {
+      LOG.warn(&lt;span class=&quot;code-quote&quot;&gt;&quot;Failed opening reconstruction log though check &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;-size passed. &quot;&lt;/span&gt; +
+        &lt;span class=&quot;code-quote&quot;&gt;&quot;POSSIBLE DATA LOSS!! Soldiering on&quot;&lt;/span&gt;, e);
+      &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt;;
+    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12679725" author="jdcryans" created="Fri, 6 Mar 2009 21:13:08 +0000"  >&lt;p&gt;Patch is good, but shouldn&apos;t we delete the file?&lt;/p&gt;</comment>
                            <comment id="12679728" author="stack" created="Fri, 6 Mar 2009 21:21:19 +0000"  >&lt;p&gt;I took a look. If no exception, it gets deleted higher up (its confusing &amp;#8211; logs used to be run in HRegion, not in HStore).&lt;/p&gt;</comment>
                            <comment id="12679729" author="jdcryans" created="Fri, 6 Mar 2009 21:23:11 +0000"  >&lt;p&gt;+1 then.&lt;/p&gt;</comment>
                            <comment id="12679732" author="stack" created="Fri, 6 Mar 2009 21:30:53 +0000"  >&lt;p&gt;Committed branch and trunk.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 6 Mar 2009 06:05:44 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>25642</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 39 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0hc5z:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>99233</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>