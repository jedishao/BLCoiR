<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sat Dec 03 15:44:00 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-12531/HBASE-12531.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-12531] bug in cachedataonwrite</title>
                <link>https://issues.apache.org/jira/browse/HBASE-12531</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;when configuring &lt;font color=&quot;red&quot;&gt;hbase.rs.cacheblocksonwrite&lt;/font&gt; as true on a region server ,or setting  cacheDataOnWrite as true on a column family in a table ,we flush the header bytes,ondisk bytebuffer and checksum bytes to disk,but only store the header and uncompressedBytesWithoutHeader to the block cache .&lt;/p&gt;

&lt;p&gt;so if we read a block from block cache which cached on write ,the method &lt;font color=&quot;red&quot;&gt; getBufferWithoutHeader&lt;/font&gt;of&lt;font color=&quot;red&quot;&gt; org.apache.hadoop.hbase.io.hfile.HFileBlock&lt;/font&gt; will cut off the head and checksum bytes,even if the checksum was never written ,and then we get a IllegalArgumentException thrown by ByteBuffer cause there is not enough bytes to read or skip at the end of the ByteBuffer.&lt;/p&gt;

&lt;p&gt;I fixed this problem but I don&apos;t know how to commit a patch ,so I paste my code here :&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-style: solid;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;border-bottom-style: solid;&quot;&gt;&lt;b&gt;org.apache.hadoop.hbase.io.hfile.HFileBlock.java&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; ByteBuffer getBufferWithoutHeader() {
		&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; length,lengthWithoutHeader=buf.limit()-headerSize(),lengthWithoutHeaderAndCheckSum=lengthWithoutHeader - totalChecksumBytes();

        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;(lengthWithoutHeader==uncompressedSizeWithoutHeader){ &lt;span class=&quot;code-comment&quot;&gt;// NO check sum tail
&lt;/span&gt;            length=lengthWithoutHeader;
        } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;(lengthWithoutHeaderAndCheckSum==uncompressedSizeWithoutHeader){ &lt;span class=&quot;code-comment&quot;&gt;// has check sum tail
&lt;/span&gt;            length=lengthWithoutHeaderAndCheckSum;
        } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
            &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; IllegalArgumentException(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.toString()+&lt;span class=&quot;code-quote&quot;&gt;&quot;,&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; block may be crashed&quot;&lt;/span&gt;);
        }
        ByteBuffer buffer =ByteBuffer.wrap(buf.array(),
                    buf.arrayOffset() + headerSize(),length)&lt;span class=&quot;code-comment&quot;&gt;//length
&lt;/span&gt;                    .slice();
           
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; buffer;
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12756307">HBASE-12531</key>
            <summary>bug in cachedataonwrite</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="3">Duplicate</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="dennislee">dennislee </reporter>
                        <labels>
                    </labels>
                <created>Wed, 19 Nov 2014 04:38:19 +0000</created>
                <updated>Sun, 28 Dec 2014 04:41:49 +0000</updated>
                            <resolved>Sun, 28 Dec 2014 04:40:46 +0000</resolved>
                                    <version>0.98.6.1</version>
                                                    <component>regionserver</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                <comments>
                            <comment id="14217419" author="yuzhihong@gmail.com" created="Wed, 19 Nov 2014 04:50:58 +0000"  >&lt;p&gt;You can &apos;git clone&apos; master branch, make modification to HFileBlock.java and generate patch from the root of your workspace.&lt;/p&gt;

&lt;p&gt;See &lt;a href=&quot;https://wiki.apache.org/hadoop/Hbase/HowToContribute&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://wiki.apache.org/hadoop/Hbase/HowToContribute&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14217432" author="dennislee" created="Wed, 19 Nov 2014 05:18:34 +0000"  >&lt;p&gt;OK ,thx ,I&apos;ll looking to it&lt;/p&gt;</comment>
                            <comment id="14259556" author="lhofhansl" created="Sun, 28 Dec 2014 03:06:23 +0000"  >&lt;p&gt;If this is true cache on write would be 100% broken. If that is the case this is a critical issue, no?&lt;/p&gt;</comment>
                            <comment id="14259563" author="stack" created="Sun, 28 Dec 2014 04:26:45 +0000"  >&lt;p&gt;Dup of &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-12270&quot; title=&quot;A bug in the bucket cache, with cache blocks on write enabled&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-12270&quot;&gt;&lt;del&gt;HBASE-12270&lt;/del&gt;&lt;/a&gt;? (though &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dennislee&quot; class=&quot;user-hover&quot; rel=&quot;dennislee&quot;&gt;dennislee &lt;/a&gt; seems to have figured it out...)&lt;/p&gt;</comment>
                            <comment id="14259565" author="apurtell" created="Sun, 28 Dec 2014 04:41:49 +0000"  >&lt;p&gt;It is a dup. Let&apos;s close this one because the other is further along and has a patch. &lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12748323">HBASE-12270</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 19 Nov 2014 04:50:58 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 48 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i22jh3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>