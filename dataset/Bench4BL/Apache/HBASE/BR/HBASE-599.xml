<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 02 20:04:27 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-599/HBASE-599.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-599] CME iterating return from ServerManager.getMarkedToClose</title>
                <link>https://issues.apache.org/jira/browse/HBASE-599</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Below is a note from list from David Alves&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;	I&apos;m seeing some CMEs in the logs they occurred &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; I still had bad
dfs.replication settings between hadoop and hbase but still thought you
should know.

Trace:
2008-04-21 13:20:46,443 WARN
org.apache.hadoop.hbase.regionserver.HRegionServer: Processing message
(Retry: 0)
java.io.IOException: java.io.IOException:
java.util.ConcurrentModificationException
	at java.util.HashMap$HashIterator.nextEntry(HashMap.java:793)
	at java.util.HashMap$ValueIterator.next(HashMap.java:822)
	at
org.apache.hadoop.hbase.master.ServerManager.processMsgs(ServerManager.java:350)
	at
org.apache.hadoop.hbase.master.ServerManager.processRegionServerAllsWell(ServerManager.java:299)
	at
org.apache.hadoop.hbase.master.ServerManager.regionServerReport(ServerManager.java:217)
	at
org.apache.hadoop.hbase.master.HMaster.regionServerReport(HMaster.java:560)
	at sun.reflect.GeneratedMethodAccessor2.invoke(Unknown Source)
	at
sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
	at java.lang.reflect.Method.invoke(Method.java:597)
	at org.apache.hadoop.hbase.ipc.HbaseRPC$Server.call(HbaseRPC.java:413)
	at org.apache.hadoop.ipc.Server$Handler.run(Server.java:896)

	at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native
Method)
	at
sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:39)
	at
sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:27)
	at java.lang.reflect.Constructor.newInstance(Constructor.java:513)
	at
org.apache.hadoop.hbase.RemoteExceptionHandler.decodeRemoteException(RemoteExceptionHandler.java:82)
	at
org.apache.hadoop.hbase.RemoteExceptionHandler.checkIOException(RemoteExceptionHandler.java:48)
	at
org.apache.hadoop.hbase.regionserver.HRegionServer.run(HRegionServer.java:388)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:619)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Looking at it, the fix would seem to be cloning the Map we give out but the clone needs to be done inside a synchronize of the Map being cloned so some more extensive synchronizing needs to be added to the ServerManager class.  Looking too, it seems like regionsToClose is not protected everywhere (maybe I&apos;m not reading it right).&lt;/p&gt;

&lt;p&gt;Bryan, you&apos;d probably be best handlng this issue.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12394489">HBASE-599</key>
            <summary>CME iterating return from ServerManager.getMarkedToClose</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.png">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jimk">Jim Kellerman</assignee>
                                    <reporter username="stack">stack</reporter>
                        <labels>
                    </labels>
                <created>Tue, 22 Apr 2008 00:16:53 +0000</created>
                <updated>Fri, 22 Aug 2008 21:13:14 +0000</updated>
                            <resolved>Wed, 7 May 2008 18:34:33 +0000</resolved>
                                                    <fixVersion>0.2.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="12591822" author="stack" created="Wed, 23 Apr 2008 22:16:36 +0000"  >&lt;p&gt;Fix for 0.2.0.  Lots of possibilities for CMEs in SM it seems.&lt;/p&gt;</comment>
                            <comment id="12592208" author="bryanduxbury" created="Fri, 25 Apr 2008 00:08:59 +0000"  >&lt;p&gt;This is really bad. &lt;/p&gt;</comment>
                            <comment id="12592213" author="jimk" created="Fri, 25 Apr 2008 00:18:06 +0000"  >&lt;p&gt;Do you have a test case you can submit? I have a patch but no way to test it.&lt;/p&gt;

&lt;p&gt;&amp;#8212;&lt;br/&gt;
Jim Kellerman, Senior Engineer; Powerset&lt;/p&gt;


&lt;p&gt;sian.jira.plugin.system.issuetabpanels:all-tabpanel ]&lt;/p&gt;

&lt;p&gt;No virus found in this outgoing message.&lt;br/&gt;
Checked by AVG.&lt;br/&gt;
Version: 7.5.524 / Virus Database: 269.23.4/1395 - Release Date: 4/24/2008 7:24 AM&lt;/p&gt;
</comment>
                            <comment id="12594394" author="jimk" created="Mon, 5 May 2008 23:17:47 +0000"  >&lt;p&gt;The patch for this issue will provide enough synchronization to stop the CME&apos;s. However the ultimate solution for this issue should be a part of &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-543&quot; title=&quot;A region&amp;#39;s state is kept in several places in the master opening the possibility for race conditions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-543&quot;&gt;&lt;del&gt;HBASE-543&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12594993" author="jimk" created="Wed, 7 May 2008 18:34:32 +0000"  >&lt;p&gt;Committed with patch for &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-478&quot; title=&quot;offlining of table does not run reliably&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-478&quot;&gt;&lt;del&gt;HBASE-478&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310010">
                    <name>Incorporates</name>
                                                                <inwardlinks description="is part of">
                                        <issuelink>
            <issuekey id="12389927">HBASE-478</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12392212">HBASE-543</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 25 Apr 2008 00:08:59 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>25286</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 31 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0h8an:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>98606</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>