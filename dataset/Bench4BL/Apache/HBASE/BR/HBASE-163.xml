<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 02 20:31:00 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-163/HBASE-163.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-163] Support updates across region splits and compactions</title>
                <link>https://issues.apache.org/jira/browse/HBASE-163</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Running an extended serial write test (EvaluationClient), a test that runs long enough it triggers compactions and splits, hbase falls over.  In the former case, client gets locked out.  In the latter, the client times out.&lt;/p&gt;

&lt;p&gt;During compactions, hbase should be able to continue to take writes/updates.  During splits, the client will have to recalibrate so writes go instead into the new splits but again, other than a pause, writes shouldn&apos;t be dropped.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12370563">HBASE-163</key>
            <summary>Support updates across region splits and compactions</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="stack">stack</reporter>
                        <labels>
                    </labels>
                <created>Thu, 31 May 2007 00:02:58 +0000</created>
                <updated>Mon, 4 Feb 2008 18:40:56 +0000</updated>
                            <resolved>Mon, 4 Jun 2007 17:15:06 +0000</resolved>
                                                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12501089" author="stack" created="Mon, 4 Jun 2007 04:18:33 +0000"  >&lt;p&gt;Fix for updates failing across compactions and region splits.&lt;/p&gt;

&lt;p&gt;Commit message:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-163&quot; title=&quot;Support updates across region splits and compactions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-163&quot;&gt;&lt;del&gt;HADOOP-1445&lt;/del&gt;&lt;/a&gt; &quot;Support updates across region splits and compactions&quot;.&lt;/p&gt;

&lt;p&gt;High-level:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;numRetries wasn&apos;t set in HBaseRegion so we&apos;d never update table after a split.&lt;/li&gt;
	&lt;li&gt;Scanners were failing to go past first deleted value&lt;/li&gt;
	&lt;li&gt;Large compactions were failing because remote held unnecessary write lock&lt;br/&gt;
while compaction was going on (long compactions caused client timeout).&lt;/li&gt;
	&lt;li&gt;Region shutdown is now two stage: makes it so outstanding transactions&lt;br/&gt;
can finish up but new requests to open a transaction are rejects&lt;br/&gt;
(NotServingRegionException &amp;#8211; perhaps should be a message in place of&lt;br/&gt;
exception).&lt;/li&gt;
	&lt;li&gt;Client retries are now just one variable rather than split over two.&lt;/li&gt;
	&lt;li&gt;clientTimeout was happening even when success finding server in&lt;br/&gt;
scanOneMetaRegion making it timesouts happen even on successful updates&lt;/li&gt;
	&lt;li&gt;Looking for wrong exception to trigger retries: was&lt;br/&gt;
NotServingRegionException when should have been a RemoteException bearing&lt;br/&gt;
a NSRE. &lt;/li&gt;
	&lt;li&gt;Moved to use org.apache.hadoop.io.retry for remote retries.&lt;/li&gt;
	&lt;li&gt;Removed bunch of eclipse  &apos;synthetic accessor&apos; warnings by making items&lt;br/&gt;
default access rather than private.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Upshot is that now EvaluationClient sequentialWrite runs to completion (~20&lt;br/&gt;
minutes of continuous writing across multiple compactions and region splits).&lt;/p&gt;

&lt;p&gt;Detail:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;src/contrib/hbase/conf/hbase-default.xml&lt;br/&gt;
    (hbase.client.timeout.length): Default should be 30 seconds, not 10.&lt;br/&gt;
    (hbase.client.timeout.number): Removed. Instead have just one retry,&lt;br/&gt;
    hbase.client.retries.number, rather than two.&lt;br/&gt;
    (hbase.client.retries.number): Upped default from 2 to 4.&lt;br/&gt;
    (hbase.regionserver.lease.period): Upped from 30 seconds to 180.&lt;br/&gt;
    (hbase.regionserver.maxlogentries, hbase.hregion.maxunflushed,&lt;br/&gt;
    hbase.hregion.max.filesize): Added.&lt;/li&gt;
	&lt;li&gt;src/contrib/hbase/src/test/org/apache/hadoop/hbase/MiniHBaseCluster.java&lt;br/&gt;
    Removed try/catch around regionservers.stop (no longer necessary).&lt;/li&gt;
	&lt;li&gt;src/contrib/hbase/src/test/org/apache/hadoop/hbase/EvaluationClient.java&lt;br/&gt;
    Fix accidental commit where ONE_HUNDRED_MB was actually 1MB.&lt;br/&gt;
    Generally change name of &apos;range&apos; variable to &apos;i&apos;.&lt;br/&gt;
    Add more help to usage.&lt;/li&gt;
	&lt;li&gt;src/contrib/hbase/src/test/org/apache/hadoop/hbase/TestScanner2.java&lt;br/&gt;
    Added. Tests scans where a row has been deleted.&lt;/li&gt;
	&lt;li&gt;src/contrib/hbase/src/test/org/apache/hadoop/hbase/TestCompare.java&lt;br/&gt;
    Added.  Test compare of HBase types.&lt;/li&gt;
	&lt;li&gt;src/contrib/hbase/src/test/org/apache/hadoop/hbase/TestScanner.java&lt;br/&gt;
    Javadoc.&lt;/li&gt;
	&lt;li&gt;src/contrib/hbase/src/test/org/apache/hadoop/hbase/TestHRegion.java&lt;br/&gt;
    Name of region row lock method changed from obtainLock to&lt;br/&gt;
    obtainRowLock.  Closing of a region became two-stepped.&lt;br/&gt;
    Implement listeners.&lt;/li&gt;
	&lt;li&gt;src/contrib/hbase/src/java/org/apache/hadoop/hbase/HStore.java&lt;br/&gt;
    Javadoc. Replace verbose &apos;for&apos; setup w/ terse 1.5 foreach.&lt;br/&gt;
    Removed odd try/catch surround of empty space.&lt;/li&gt;
	&lt;li&gt;src/contrib/hbase/src/java/org/apache/hadoop/hbase/HMerge.java&lt;br/&gt;
    Read max file size from configuration.&lt;/li&gt;
	&lt;li&gt;src/contrib/hbase/src/java/org/apache/hadoop/hbase/Leases.java&lt;br/&gt;
    Line lengths.  Make &amp;lt; 80.&lt;/li&gt;
	&lt;li&gt;src/contrib/hbase/src/java/org/apache/hadoop/hbase/RegionNotFoundException.java&lt;/li&gt;
	&lt;li&gt;src/contrib/hbase/src/java/org/apache/hadoop/hbase/WrongRegionException.java&lt;br/&gt;
    Added.&lt;/li&gt;
	&lt;li&gt;src/contrib/hbase/src/java/org/apache/hadoop/hbase/HRegionServer.java&lt;br/&gt;
    Make imports specific.&lt;br/&gt;
    Change a bunch of data members from private to default access&lt;br/&gt;
    (Eclipse promise performance improvements when doesn&apos;t have to&lt;br/&gt;
    create &apos;synthetic accessors&apos; when member or method is private)&lt;br/&gt;
    Renamed regions as onlineRegions.  Added notion of retiringRegions&lt;br/&gt;
    to support completion of outstanding transactions (new ones are&lt;br/&gt;
    rejected).&lt;br/&gt;
    (UpdateMetaInteface): Added.  Needed by org.apache.hadoop.io.retry&lt;br/&gt;
    used to cover splits (in case rety necessary).&lt;br/&gt;
    (SplitOrCompactChecker): Refactored.  Broke most of the run method&lt;br/&gt;
    out into a new split method.&lt;br/&gt;
    Refactored how split works.  Moved actual addRegion/deleteRegions&lt;br/&gt;
    out to HRegion as utility methods (Jim just before this commit&lt;br/&gt;
    did similar &amp;#8211; this builds on his work and moves even more utility&lt;br/&gt;
    to HRegion.  Useful building test cases).&lt;br/&gt;
    Changed logging at end of all threads so if exits, log level is at&lt;br/&gt;
    INFO, rather than DEBUG, so we notice thread exit (Did for flusher,&lt;br/&gt;
    splitter, logroller threads).&lt;br/&gt;
    (stop): Remove unthrown IOE.&lt;br/&gt;
    (get): Refactored.  Removed test for result != null so we could&lt;br/&gt;
    throw either result or null.&lt;br/&gt;
    (next): If all columns in a row are deleted values, get another&lt;br/&gt;
    row (previous we would return the a row with no values and scanner&lt;br/&gt;
    would shut down &amp;#8211; making it so we never crossed-out a row&lt;br/&gt;
    with deleted values).&lt;br/&gt;
    (getRegion): Added an override with flag as to whether to look&lt;br/&gt;
    in retiring list of regions.&lt;br/&gt;
    Added logging of expired scanner leases.&lt;/li&gt;
	&lt;li&gt;src/contrib/hbase/src/java/org/apache/hadoop/hbase/HConstants.java&lt;br/&gt;
    Renamed DESIRED_MAX_FILE_SIZE as DEFAULT_MAX_FILE_SIZE.&lt;/li&gt;
	&lt;li&gt;src/contrib/hbase/src/java/org/apache/hadoop/hbase/HClient.java&lt;br/&gt;
    Renamed TableInfo data structure as RegionLocation.  More descriptive.&lt;br/&gt;
    Added RegionLocation#toString.&lt;br/&gt;
    Removed numTimeouts. Use numRetries everywhere for retries instead.&lt;br/&gt;
    Renamed clientTimeout as pause.&lt;br/&gt;
    Log enabled, disabled, delete of tables.&lt;br/&gt;
    (startUpdate): Refactored to use org.apache.hadoop.io.retry.&lt;br/&gt;
    (printCreateTableUsage, printDeleteTableUsage): Added.&lt;/li&gt;
	&lt;li&gt;src/contrib/hbase/src/java/org/apache/hadoop/hbase/HMaster.java&lt;br/&gt;
    Moved HRegion utility methods &amp;#8211; getRegionInfo, getServerName,&lt;br/&gt;
    and getStartCode &amp;#8211; to HRegion.&lt;br/&gt;
    Added catch handler for new UnknownScannerException to META scanners.&lt;br/&gt;
    Use new HRegion.createRegion utility.&lt;/li&gt;
	&lt;li&gt;src/contrib/hbase/src/java/org/apache/hadoop/hbase/HRegionInfo.java&lt;br/&gt;
    (comparableTo): Replace w/ implementation that sorts regions with&lt;br/&gt;
    lower startKeys before those of higher startKeys.&lt;/li&gt;
	&lt;li&gt;src/contrib/hbase/src/java/org/apache/hadoop/hbase/HMemcache.java&lt;br/&gt;
    Line-lengths, iterators and javadoc.&lt;/li&gt;
	&lt;li&gt;src/contrib/hbase/src/java/org/apache/hadoop/hbase/HAbstractScanner.java&lt;br/&gt;
    Changed access to default from private for members accessed out of&lt;br/&gt;
    inner classes.&lt;/li&gt;
	&lt;li&gt;src/contrib/hbase/src/java/org/apache/hadoop/hbase/UnknownScannerException.java&lt;br/&gt;
    Added.&lt;/li&gt;
	&lt;li&gt;src/contrib/hbase/src/java/org/apache/hadoop/hbase/HRegion.java&lt;br/&gt;
    During compaction, don&apos;t need a write lock for the duration &amp;#8211; just&lt;br/&gt;
    need to block flushing to disk.  Use the WriteState structure to put up&lt;br/&gt;
    this guard rather than the broader write lock (write lock was stopping&lt;br/&gt;
    updates coming in &amp;#8211; they&apos;d timeout if compaction was taking too long).&lt;br/&gt;
    Make max size of region configurable.&lt;br/&gt;
    Replaced iterators with terser foreach version.&lt;br/&gt;
    (obtainLock, releaseLock): Renamed as obtainRowLock, releaseRowLock.&lt;br/&gt;
    (waitOnRowLocks): Added.&lt;br/&gt;
    (createHRegion, addRegionToMETA, removeRegionFromMETA,&lt;br/&gt;
    getServerName, getStartCode): Added.&lt;/li&gt;
	&lt;li&gt;src/contrib/hbase/src/java/org/apache/hadoop/hbase/RegionUnavailableListener.java&lt;br/&gt;
    Changed move of region to unavailable to be a two-stepped process.&lt;br/&gt;
    (regionIsUnavailable): Removed.&lt;br/&gt;
    (closing, closed): Added.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="12501101" author="hadoopqa" created="Mon, 4 Jun 2007 06:00:17 +0000"  >&lt;p&gt;-1, new javadoc warnings&lt;/p&gt;

&lt;p&gt;The javadoc tool appears to have generated warning messages when testing the latest attachment &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12358798/hadoop1445.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12358798/hadoop1445.patch&lt;/a&gt; against trunk revision r543862.&lt;/p&gt;

&lt;p&gt;Test results:   &lt;a href=&quot;http://lucene.zones.apache.org:8080/hudson/job/Hadoop-Patch/241/testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://lucene.zones.apache.org:8080/hudson/job/Hadoop-Patch/241/testReport/&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://lucene.zones.apache.org:8080/hudson/job/Hadoop-Patch/241/console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://lucene.zones.apache.org:8080/hudson/job/Hadoop-Patch/241/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Please note that this message is automatically generated and may represent a problem with the automation system and not the patch.&lt;/p&gt;</comment>
                            <comment id="12501251" author="stack" created="Mon, 4 Jun 2007 15:55:13 +0000"  >&lt;p&gt;Version 2. Fixes javadoc warnings.&lt;/p&gt;</comment>
                            <comment id="12501252" author="stack" created="Mon, 4 Jun 2007 15:56:57 +0000"  >&lt;p&gt;v2 w/o tilde&lt;/p&gt;</comment>
                            <comment id="12501253" author="stack" created="Mon, 4 Jun 2007 15:58:51 +0000"  >&lt;p&gt;Pass patch via hudson build&lt;/p&gt;</comment>
                            <comment id="12501265" author="hadoopqa" created="Mon, 4 Jun 2007 16:52:57 +0000"  >&lt;p&gt;+1&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12358876/hadoop1445-v2.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12358876/hadoop1445-v2.patch&lt;/a&gt; applied and successfully tested against trunk revision r543862.&lt;/p&gt;

&lt;p&gt;Test results:   &lt;a href=&quot;http://lucene.zones.apache.org:8080/hudson/job/Hadoop-Patch/242/testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://lucene.zones.apache.org:8080/hudson/job/Hadoop-Patch/242/testReport/&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://lucene.zones.apache.org:8080/hudson/job/Hadoop-Patch/242/console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://lucene.zones.apache.org:8080/hudson/job/Hadoop-Patch/242/console&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12501278" author="jimk" created="Mon, 4 Jun 2007 17:15:06 +0000"  >&lt;p&gt;I just committed this. Thanks Michael.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12358876" name="hadoop1445-v2.patch" size="164791" author="stack" created="Mon, 4 Jun 2007 15:58:18 +0000"/>
                            <attachment id="12358874" name="hadoop1445-v2.patch~" size="165667" author="stack" created="Mon, 4 Jun 2007 15:55:12 +0000"/>
                            <attachment id="12358875" name="hadoop1445.patch" size="164974" author="stack" created="Mon, 4 Jun 2007 15:56:57 +0000"/>
                            <attachment id="12358798" name="hadoop1445.patch" size="164974" author="stack" created="Mon, 4 Jun 2007 04:18:33 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 4 Jun 2007 06:00:17 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>24947</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 27 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0h4zz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>98072</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>