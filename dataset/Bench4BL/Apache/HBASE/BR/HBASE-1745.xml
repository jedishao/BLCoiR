<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 02 20:20:28 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-1745/HBASE-1745.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-1745] [tools] Tool to kick region out of inTransistion</title>
                <link>https://issues.apache.org/jira/browse/HBASE-1745</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;It seems fairly easy getting a region stuck &quot;inTransitions&quot; (See recent filings of mine).  Also, with addition to ClusterStatus of intransitions content, you can see this state now when you do analysis.  I want to roll RC2.  0.20.0 still has issues and we even know now what the worst of them are but the fixes can wait till 0.20.1.  Meantime, I need a means of bumping stuff that is stuck from the intransistions....  for 0.20.0 release in case we trip over this scenario for then we can effect a repair at least.  Otherwise, requires restart of cluster.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12432199">HBASE-1745</key>
            <summary>[tools] Tool to kick region out of inTransistion</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="stack">stack</assignee>
                                    <reporter username="stack">stack</reporter>
                        <labels>
                    </labels>
                <created>Tue, 4 Aug 2009 20:27:51 +0000</created>
                <updated>Sun, 13 Sep 2009 22:24:54 +0000</updated>
                            <resolved>Tue, 4 Aug 2009 20:37:27 +0000</resolved>
                                                    <fixVersion>0.20.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12739142" author="ryanobjc" created="Tue, 4 Aug 2009 20:34:11 +0000"  >&lt;p&gt;another option is to kill and restart the master, and let the cluster inspection take over.&lt;/p&gt;</comment>
                            <comment id="12739143" author="stack" created="Tue, 4 Aug 2009 20:34:47 +0000"  >&lt;p&gt;Here is minimally invasive change.  Do close_region on the problematic region.  Add clearing from intransition if its present.  Also if no servername in the .META. info, return... rather than NPE:&lt;/p&gt;

{code
Index: src/java/org/apache/hadoop/hbase/master/HMaster.java
===================================================================
--- src/java/org/apache/hadoop/hbase/master/HMaster.java        (revision 800936)
+++ src/java/org/apache/hadoop/hbase/master/HMaster.java        (working copy)
@@ -1025,6 +1025,11 @@
         servername = 
           Bytes.toString(rr.getValue(CATALOG_FAMILY, SERVER_QUALIFIER));
       }
&lt;p&gt;+      // Take region out of the intransistions in case it got stuck there doing&lt;br/&gt;
+      // an open or whatever.&lt;br/&gt;
+      this.regionManager.clearFromInTransition(regionname);&lt;br/&gt;
+      // If servername is still null, then none, exit.&lt;br/&gt;
+      if (servername == null) break;&lt;br/&gt;
       // Need to make up a HServerInfo &apos;servername&apos; for that is how&lt;br/&gt;
       // items are keyed in regionmanager Maps.&lt;br/&gt;
       HServerAddress addr = new HServerAddress(servername);&lt;br/&gt;
Index: src/java/org/apache/hadoop/hbase/master/RegionManager.java&lt;br/&gt;
===================================================================&lt;br/&gt;
&amp;#8212; src/java/org/apache/hadoop/hbase/master/RegionManager.java  (revision 800936)&lt;br/&gt;
+++ src/java/org/apache/hadoop/hbase/master/RegionManager.java  (working copy)&lt;br/&gt;
@@ -1436,6 +1436,26 @@&lt;br/&gt;
     return result;&lt;br/&gt;
   }&lt;/p&gt;

&lt;p&gt;+  /**&lt;br/&gt;
+   * @param regionname Name to clear from regions in transistion.&lt;br/&gt;
+   * @return True if we removed an element for the passed regionname.&lt;br/&gt;
+   */&lt;br/&gt;
+  boolean clearFromInTransition(final byte [] regionname) {&lt;br/&gt;
+    boolean result = false;&lt;br/&gt;
+    synchronized (this.regionsInTransition) {&lt;br/&gt;
+      if (this.regionsInTransition.isEmpty()) return result;&lt;br/&gt;
+      for (Map.Entry&amp;lt;String, RegionState&amp;gt; e: this.regionsInTransition.entrySet()) {&lt;br/&gt;
+        if (Bytes.equals(regionname, e.getValue().getRegionName())) &lt;/p&gt;
{
+          this.regionsInTransition.remove(e.getKey());
+          LOG.debug(&quot;Removed &quot; + e.getKey() + &quot;, &quot; + e.getValue());
+          result = true;
+          break;
+        }
&lt;p&gt;+      }&lt;br/&gt;
+    }&lt;br/&gt;
+    return result;&lt;br/&gt;
+  }&lt;br/&gt;
+&lt;br/&gt;
   /*&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;State of a Region as it transitions from closed to open, etc.  See&lt;/li&gt;
	&lt;li&gt;note on regionsInTransition data member above for listing of state
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="12739144" author="stack" created="Tue, 4 Aug 2009 20:37:27 +0000"  >&lt;p&gt;Applied 0.20.0 branch and trunk&lt;/p&gt;</comment>
                            <comment id="12739149" author="stack" created="Tue, 4 Aug 2009 20:41:01 +0000"  >&lt;p&gt;@ryan Yes.  Didn&apos;t think of that one.  It would work too.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 4 Aug 2009 20:34:11 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>25954</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 18 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0hf13:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>99697</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>