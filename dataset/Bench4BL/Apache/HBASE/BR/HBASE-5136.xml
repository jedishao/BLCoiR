<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sat Dec 03 17:01:14 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-5136/HBASE-5136.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-5136] Redundant MonitoredTask instances in case of distributed log splitting retry</title>
                <link>https://issues.apache.org/jira/browse/HBASE-5136</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;In case of log splitting retry, the following code would be executed multiple times:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; splitLogDistributed(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; List&amp;lt;Path&amp;gt; logDirs) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
    MonitoredTask status = TaskMonitor.get().createStatus(
          &lt;span class=&quot;code-quote&quot;&gt;&quot;Doing distributed log split in &quot;&lt;/span&gt; + logDirs);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;leading to multiple MonitoredTask instances.&lt;/p&gt;

&lt;p&gt;User may get confused by multiple distributed log splitting entries for the same region server on master UI&lt;/p&gt;</description>
                <environment></environment>
        <key id="12537520">HBASE-5136</key>
            <summary>Redundant MonitoredTask instances in case of distributed log splitting retry</summary>
                <type id="3" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/task.png">Task</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="3">Duplicate</resolution>
                                        <assignee username="zhihyu@ebaysf.com">Ted Yu</assignee>
                                    <reporter username="zhihyu@ebaysf.com">Ted Yu</reporter>
                        <labels>
                    </labels>
                <created>Fri, 6 Jan 2012 15:03:46 +0000</created>
                <updated>Thu, 25 Oct 2012 22:19:56 +0000</updated>
                            <resolved>Thu, 25 Oct 2012 22:19:56 +0000</resolved>
                                                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                <comments>
                            <comment id="13181618" author="zhihyu@ebaysf.com" created="Fri, 6 Jan 2012 21:27:51 +0000"  >&lt;p&gt;Can SplitLogManager maintain mapping from hash of logDirs to MonitoredTask ?&lt;br/&gt;
If hash of logDirs isn&apos;t found in this mapping, we create MonitoredTask.&lt;/p&gt;

&lt;p&gt;@Prakash:&lt;br/&gt;
What do you think ?&lt;/p&gt;</comment>
                            <comment id="13181686" author="zhihyu@ebaysf.com" created="Fri, 6 Jan 2012 23:25:28 +0000"  >&lt;p&gt;Patch v1 is based on the assumption that the list of dead region servers for distributed log splitting stays the same across retries.&lt;/p&gt;</comment>
                            <comment id="13181721" author="hadoopqa" created="Sat, 7 Jan 2012 00:16:48 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12509744/5136.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12509744/5136.txt&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    -1 tests included.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    -1 javadoc.  The javadoc tool appears to have generated -151 warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 79 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;     -1 core tests.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.mapreduce.TestImportTsv&lt;br/&gt;
                  org.apache.hadoop.hbase.mapred.TestTableMapReduce&lt;br/&gt;
                  org.apache.hadoop.hbase.mapreduce.TestHFileOutputFormat&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/692//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/692//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/692//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/692//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/692//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/692//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13181777" author="khemani" created="Sat, 7 Jan 2012 02:05:24 +0000"  >&lt;p&gt;it will be lot simpler to do status.cleanup() in the finally block in splitLogDistributed()&lt;/p&gt;</comment>
                            <comment id="13181779" author="zhihyu@ebaysf.com" created="Sat, 7 Jan 2012 02:22:49 +0000"  >&lt;p&gt;Thanks for the review, Prakash.&lt;/p&gt;

&lt;p&gt;So the suggestion is to add finally block to splitLogDistributed().&lt;br/&gt;
Here is the implementation for cleanup() where stateTime would be set to current time:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void cleanup() {
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (state == State.RUNNING) {
      setState(State.ABORTED);
    }
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;TaskMonitor hardcodes expiration timeout as 60 seconds:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; EXPIRATION_TIME = 60*1000;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The suggested approach would produce partially confusing result because there might be multiple MonitoredTask instances for the same logDirs within 60 second period.&lt;/p&gt;

&lt;p&gt;Please correct me if my interpretation of the task monitoring is wrong.&lt;/p&gt;</comment>
                            <comment id="13183090" author="zhihyu@ebaysf.com" created="Tue, 10 Jan 2012 05:32:13 +0000"  >&lt;p&gt;@Prakash:&lt;br/&gt;
Can you kindly provide your opinion ?&lt;/p&gt;</comment>
                            <comment id="13184377" author="zhihyu@ebaysf.com" created="Wed, 11 Jan 2012 20:49:34 +0000"  >&lt;p&gt;Can someone review the patch ?&lt;/p&gt;

&lt;p&gt;Thanks&lt;/p&gt;</comment>
                            <comment id="13184477" author="jdcryans" created="Wed, 11 Jan 2012 22:49:02 +0000"  >&lt;blockquote&gt;&lt;p&gt;The suggested approach would produce partially confusing result because there might be multiple MonitoredTask instances for the same logDirs within 60 second period.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;But it would say that it&apos;s aborted right? I actually prefer that.&lt;/p&gt;</comment>
                            <comment id="13184507" author="zhihyu@ebaysf.com" created="Wed, 11 Jan 2012 23:10:54 +0000"  >&lt;p&gt;Then this JIRA depends on &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5174&quot; title=&quot;Coalesce aborted tasks in the TaskMonitor&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5174&quot;&gt;&lt;del&gt;HBASE-5174&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
Please comment on my proposal there.&lt;/p&gt;

&lt;p&gt;The patch in this JIRA is just specialized version of my proposal for &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5174&quot; title=&quot;Coalesce aborted tasks in the TaskMonitor&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5174&quot;&gt;&lt;del&gt;HBASE-5174&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="13185688" author="jxiang" created="Fri, 13 Jan 2012 17:33:30 +0000"  >&lt;p&gt;Instead of reuse the same status object, can we abort the original one?&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    waitForSplittingCompletion(batch, status);
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (batch.done != batch.installed) {
      batch.isDead = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
      tot_mgr_log_split_batch_err.incrementAndGet();
      LOG.warn(&lt;span class=&quot;code-quote&quot;&gt;&quot;error &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; splitting logs in &quot;&lt;/span&gt; + logDirs +
      &lt;span class=&quot;code-quote&quot;&gt;&quot; installed = &quot;&lt;/span&gt; + batch.installed + &lt;span class=&quot;code-quote&quot;&gt;&quot; but only &quot;&lt;/span&gt; + batch.done + &lt;span class=&quot;code-quote&quot;&gt;&quot; done&quot;&lt;/span&gt;);
=&amp;gt; update the status message and abort it here
      &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; IOException(&lt;span class=&quot;code-quote&quot;&gt;&quot;error or interrupt &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; splitting logs in &quot;&lt;/span&gt;
          + logDirs + &lt;span class=&quot;code-quote&quot;&gt;&quot; Task = &quot;&lt;/span&gt; + batch);
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13185693" author="zhihyu@ebaysf.com" created="Fri, 13 Jan 2012 17:42:43 +0000"  >&lt;p&gt;This is similar to Prakash&apos;s suggestion.&lt;br/&gt;
In some situation, several (aborted) tasks for the same server would be shown on master UI at the same time since it takes 1 minute to clean up task display.&lt;/p&gt;</comment>
                            <comment id="13409728" author="jxiang" created="Mon, 9 Jul 2012 18:58:37 +0000"  >&lt;p&gt;Posted a patch to abort the task status if log splitting failed.&lt;/p&gt;

&lt;p&gt;Let &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5174&quot; title=&quot;Coalesce aborted tasks in the TaskMonitor&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5174&quot;&gt;&lt;del&gt;HBASE-5174&lt;/del&gt;&lt;/a&gt; to handle the duplicated status entry.&lt;/p&gt;</comment>
                            <comment id="13409769" author="jxiang" created="Mon, 9 Jul 2012 19:32:32 +0000"  >&lt;p&gt;Let me create a different related issue.&lt;/p&gt;</comment>
                            <comment id="13484496" author="sershe" created="Thu, 25 Oct 2012 21:27:18 +0000"  >&lt;p&gt;Hi. Should this be ok to commit?&lt;/p&gt;</comment>
                            <comment id="13484518" author="yuzhihong@gmail.com" created="Thu, 25 Oct 2012 21:53:56 +0000"  >&lt;p&gt;For Jimmy&apos;s patch:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+    &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt; logDirsHash = logDirs.hashCode();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;What if there is hash collision between two log directories ?&lt;/p&gt;</comment>
                            <comment id="13484537" author="jxiang" created="Thu, 25 Oct 2012 22:13:52 +0000"  >&lt;p&gt;@Ted, were you referring to 5136.txt?  That&apos;s your patch.  My patch is 5136-trunk.patch, which is already committed in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6357&quot; title=&quot;Failed distributed log splitting stuck on master web UI&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6357&quot;&gt;&lt;del&gt;HBASE-6357&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
I think we can close this one as a duplicate.&lt;/p&gt;</comment>
                            <comment id="13484540" author="yuzhihong@gmail.com" created="Thu, 25 Oct 2012 22:19:56 +0000"  >&lt;p&gt;Manage Attachments dialog reverses the order of the two patches, compared to the order on JIRA page &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12535956">HBASE-5081</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12598078">HBASE-6357</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12535715" name="5136-trunk.patch" size="1041" author="jxiang" created="Mon, 9 Jul 2012 18:56:28 +0000"/>
                            <attachment id="12509744" name="5136.txt" size="2476" author="zhihyu@ebaysf.com" created="Fri, 6 Jan 2012 23:33:30 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sat, 7 Jan 2012 00:16:48 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>223026</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 6 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0agfr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>58936</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>