<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sat Dec 03 16:43:48 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-6048/HBASE-6048.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-6048] Table Scan is failing if offheap cache enabled</title>
                <link>https://issues.apache.org/jira/browse/HBASE-6048</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Table Scan is failing if offheap cache enabled.&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;2012-05-18 20:03:38,446 DEBUG org.apache.hadoop.hbase.io.hfile.HFileWriterV2: Initialized with CacheConfig:enabled [cacheDataOnRead=true] [cacheDataOnWrite=false] [cacheIndexesOnWrite=false] [cacheBloomsOnWrite=false] [cacheEvictOnClose=false] [cacheCompressed=false]
2012-05-18 20:03:38,446 INFO org.apache.hadoop.hbase.regionserver.StoreFile: Delete Family Bloom filter type for hdfs://10.18.40.217:9000/hbase/ufdr/1d4656fd417a07c9171a38b8f4d08510/.tmp/03742024b28f443bb63cfc338d4ca422: CompoundBloomFilterWriter
2012-05-18 20:04:25,576 DEBUG org.apache.hadoop.hbase.io.hfile.LruBlockCache: Block cache LRU eviction started; Attempting to free 120.57 MB of total=1020.57 MB
2012-05-18 20:04:25,655 DEBUG org.apache.hadoop.hbase.io.hfile.LruBlockCache: Block cache LRU eviction completed; freed=120.82 MB, total=907.89 MB, single=1012.11 MB, multi=6.12 MB, memory=0 KB
2012-05-18 20:04:25,733 ERROR org.apache.hadoop.hbase.regionserver.HRegionServer: Failed openScanner
java.lang.IllegalStateException: Schema metrics requested before table/CF name initialization: {&quot;tableName&quot;:&quot;null&quot;,&quot;cfName&quot;:&quot;null&quot;}
	at org.apache.hadoop.hbase.regionserver.metrics.SchemaConfigured.getSchemaMetrics(SchemaConfigured.java:182)
	at org.apache.hadoop.hbase.io.hfile.LruBlockCache.updateSizeMetrics(LruBlockCache.java:310)
	at org.apache.hadoop.hbase.io.hfile.LruBlockCache.cacheBlock(LruBlockCache.java:274)
	at org.apache.hadoop.hbase.io.hfile.LruBlockCache.cacheBlock(LruBlockCache.java:293)
	at org.apache.hadoop.hbase.io.hfile.DoubleBlockCache.getBlock(DoubleBlockCache.java:102)
	at org.apache.hadoop.hbase.io.hfile.HFileReaderV2.readBlock(HFileReaderV2.java:296)
	at org.apache.hadoop.hbase.io.hfile.HFileBlockIndex$BlockIndexReader.seekToDataBlock(HFileBlockIndex.java:213)
	at org.apache.hadoop.hbase.io.hfile.HFileReaderV2$AbstractScannerV2.seekTo(HFileReaderV2.java:455)
	at org.apache.hadoop.hbase.io.hfile.HFileReaderV2$AbstractScannerV2.seekTo(HFileReaderV2.java:475)
	at org.apache.hadoop.hbase.regionserver.StoreFileScanner.seekAtOrAfter(StoreFileScanner.java:226)
	at org.apache.hadoop.hbase.regionserver.StoreFileScanner.seek(StoreFileScanner.java:145)
	at org.apache.hadoop.hbase.regionserver.StoreScanner.&amp;lt;init&amp;gt;(StoreScanner.java:130)
	at org.apache.hadoop.hbase.regionserver.Store.getScanner(Store.java:2001)
	at org.apache.hadoop.hbase.regionserver.HRegion$RegionScannerImpl.&amp;lt;init&amp;gt;(HRegion.java:3274)
	at org.apache.hadoop.hbase.regionserver.HRegion.instantiateRegionScanner(HRegion.java:1604)
	at org.apache.hadoop.hbase.regionserver.HRegion.getScanner(HRegion.java:1596)
	at org.apache.hadoop.hbase.regionserver.HRegion.getScanner(HRegion.java:1572)
	at org.apache.hadoop.hbase.regionserver.HRegionServer.openScanner(HRegionServer.java:2310)
	at sun.reflect.GeneratedMethodAccessor45.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
	at java.lang.reflect.Method.invoke(Method.java:597)
	at org.apache.hadoop.hbase.ipc.WritableRpcEngine$Server.call(WritableRpcEngine.java:364)
	at org.apache.hadoop.hbase.ipc.HBaseServer$Handler.run(HBaseServer.java:1376)
2012-05-18 20:04:25,828 ERROR org.apache.hadoop.hbase.regionserver.HRegionServer: Failed openScanner
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12556397">HBASE-6048</key>
            <summary>Table Scan is failing if offheap cache enabled</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="3">Duplicate</resolution>
                                        <assignee username="ram_krish">ramkrishna.s.vasudevan</assignee>
                                    <reporter username="gopinathan.av">Gopinathan A</reporter>
                        <labels>
                    </labels>
                <created>Fri, 18 May 2012 14:01:38 +0000</created>
                <updated>Tue, 30 Dec 2014 04:40:22 +0000</updated>
                            <resolved>Tue, 30 Dec 2014 04:40:22 +0000</resolved>
                                    <version>0.94.0</version>
                                                        <due></due>
                            <votes>0</votes>
                                    <watches>11</watches>
                                                                <comments>
                            <comment id="13278817" author="ram_krish" created="Fri, 18 May 2012 14:05:58 +0000"  >&lt;p&gt;Also we get the following trace also while scanning&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2012-05-18 10:38:29,709 ERROR org.apache.hadoop.hbase.io.hfile.HFileReaderV2: Current pos = 655578; currKeyLen = 38; currValLen = 800; block limit = 655578; HFile name = 5325593bcaba4a8ba6f61f026abb82a9; currBlock currBlockOffset = 222963500
2012-05-18 10:38:29,709 ERROR org.apache.hadoop.hbase.regionserver.HRegionServer: 
java.lang.IllegalArgumentException
	at java.nio.Buffer.position(Buffer.java:218)
	at org.apache.hadoop.hbase.io.hfile.HFileReaderV2$ScannerV2.next(HFileReaderV2.java:630)
	at org.apache.hadoop.hbase.regionserver.StoreFileScanner.next(StoreFileScanner.java:130)
	at org.apache.hadoop.hbase.regionserver.KeyValueHeap.next(KeyValueHeap.java:95)
	at org.apache.hadoop.hbase.regionserver.StoreScanner.next(StoreScanner.java:406)
	at org.apache.hadoop.hbase.regionserver.KeyValueHeap.next(KeyValueHeap.java:127)
	at org.apache.hadoop.hbase.regionserver.HRegion$RegionScannerImpl.nextInternal(HRegion.java:3354)
	at org.apache.hadoop.hbase.regionserver.HRegion$RegionScannerImpl.next(HRegion.java:3310)
	at org.apache.hadoop.hbase.regionserver.HRegion$RegionScannerImpl.next(HRegion.java:3327)
	at org.apache.hadoop.hbase.regionserver.HRegionServer.next(HRegionServer.java:2393)
	at sun.reflect.GeneratedMethodAccessor27.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
	at java.lang.reflect.Method.invoke(Method.java:597)
	at org.apache.hadoop.hbase.ipc.WritableRpcEngine$Server.call(WritableRpcEngine.java:364)
	at org.apache.hadoop.hbase.ipc.HBaseServer$Handler.run(HBaseServer.java:1376)

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13279052" author="stack" created="Fri, 18 May 2012 18:29:10 +0000"  >&lt;p&gt;I don&apos;t think this critical.  Off-heap cache needs more work for it to be made useable.  Until that is done my guess is that few use this feature.  This feature is experimental still (How do we make this more clear)?&lt;/p&gt;</comment>
                            <comment id="13279062" author="ram_krish" created="Fri, 18 May 2012 18:35:07 +0000"  >&lt;p&gt;My intention behind marking critical was though we have claimed it to be an experimental feature on enabling it if scan fails then i thought its good to have a closer look.&lt;br/&gt;
I will lower the priority of it.  May be i will spend some time in finding out the root cause of it and based on that we can come up with some information to say that this feature is experimental and so and so things could be the possible problems that one could run into.&lt;/p&gt;</comment>
                            <comment id="13493773" author="zjushch" created="Fri, 9 Nov 2012 06:48:14 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ram_krish&quot; class=&quot;user-hover&quot; rel=&quot;ram_krish&quot;&gt;ramkrishna.s.vasudevan&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;We also catch this problem and created &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7136&quot; title=&quot;SchemaMetrics make SlabCache unavailable&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7136&quot;&gt;&lt;del&gt;HBASE-7136&lt;/del&gt;&lt;/a&gt;, but I don&apos;t found the schemaMetrics in Trunk, so close it&lt;/p&gt;</comment>
                            <comment id="13493780" author="ram_krish" created="Fri, 9 Nov 2012 06:59:28 +0000"  >&lt;p&gt;for 0.94 we need to fix this then right ? Actually we did not focus on this much as offheapcache was an experimental feature.&lt;/p&gt;</comment>
                            <comment id="13493784" author="zjushch" created="Fri, 9 Nov 2012 07:03:14 +0000"  >&lt;p&gt;Yes, 0.94 has this problem~~~&lt;/p&gt;</comment>
                            <comment id="13880714" author="ram_krish" created="Fri, 24 Jan 2014 04:48:55 +0000"  >&lt;p&gt;I think we need to fix this.&lt;br/&gt;
See the mail thread&lt;br/&gt;
&lt;a href=&quot;http://mail-archives.apache.org/mod_mbox/hbase-user/201401.mbox/%3C52DECFD2.4040600@gmail.com%3E&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://mail-archives.apache.org/mod_mbox/hbase-user/201401.mbox/%3C52DECFD2.4040600@gmail.com%3E&lt;/a&gt;&lt;br/&gt;
As per the user the off heap cache though being experimental was getting used by them in 0.92 and did not see it was broken.  but in 0.94 it seems to be broken.&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=zjushch&quot; class=&quot;user-hover&quot; rel=&quot;zjushch&quot;&gt;chunhui shen&lt;/a&gt;&lt;br/&gt;
Do you have a fix for this by any chance?  I think it is worth solving for users like Dean.&lt;br/&gt;
Thoughts?&lt;/p&gt;</comment>
                            <comment id="13880731" author="zjushch" created="Fri, 24 Jan 2014 05:26:48 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ram_krish&quot; class=&quot;user-hover&quot; rel=&quot;ram_krish&quot;&gt;ramkrishna.s.vasudevan&lt;/a&gt;&lt;br/&gt;
HFileBlock is deserialized in offheap cache, but didn&apos;t pass the SchemaMetrics to the deserialized HFileBlock. Thus, throws the exception.&lt;/p&gt;

&lt;p&gt;Upload a simple patch applied our intern branch to fix this problem .&lt;/p&gt;</comment>
                            <comment id="13880737" author="stack" created="Fri, 24 Jan 2014 05:45:52 +0000"  >&lt;p&gt;Good one lads.  Can we get the mailing list gentleman to try out &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=zjushch&quot; class=&quot;user-hover&quot; rel=&quot;zjushch&quot;&gt;chunhui shen&lt;/a&gt;&apos;s patch?&lt;/p&gt;</comment>
                            <comment id="13880738" author="yuzhihong@gmail.com" created="Fri, 24 Jan 2014 05:47:15 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+    &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.tableName = tableName != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; ? tableName.intern() : tableName;
+    &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.cfName = cfName != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; ? cfName.intern() : cfName;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Call to intern() is not needed. See &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-10089&quot; title=&quot;Metrics intern table names cause eventual permgen OOM in 0.94&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-10089&quot;&gt;&lt;del&gt;HBASE-10089&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13880755" author="ram_krish" created="Fri, 24 Jan 2014 06:18:36 +0000"  >&lt;p&gt;We could ask the gentleman to try this out.  What scenario does this occur?   Sorry i looked into it long back.  Not sure on what was observed that time.&lt;/p&gt;</comment>
                            <comment id="13880766" author="lhofhansl" created="Fri, 24 Jan 2014 06:32:54 +0000"  >&lt;p&gt;I believe there are other race conditions in the off heap cache (assuming this is the DoubleBlockCache).&lt;br/&gt;
Forget the details atm, but I clearly remember we added some synchronization fixes an discussed removing the DoubleBlockCache because it never worked correctly.&lt;br/&gt;
I think at least &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5898&quot; title=&quot;Consider double-checked locking for block cache lock&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5898&quot;&gt;&lt;del&gt;HBASE-5898&lt;/del&gt;&lt;/a&gt; is broken as we do not access the DoubleBlockCache under a lock at all times.&lt;/p&gt;</comment>
                            <comment id="13881209" author="ndimiduk" created="Fri, 24 Jan 2014 17:58:21 +0000"  >&lt;p&gt;FYI, I&apos;m &lt;b&gt;not&lt;/b&gt; seeing this issue with a build of 0.96.1.1/Hadoop2. Testing using PerfEval scan tests.&lt;/p&gt;</comment>
                            <comment id="13882058" author="stack" created="Sat, 25 Jan 2014 21:31:00 +0000"  >&lt;p&gt;I have just enabled this and ditto do not see the issue in head of hbase and hadoop2.  Am looking more to add some evidence that it should be removed in favor of bucket cache direction.&lt;/p&gt;</comment>
                            <comment id="13882139" author="zjushch" created="Sun, 26 Jan 2014 01:53:12 +0000"  >&lt;p&gt;0.96 won&apos;t have this issue since SchemaMetrics is not existed.&lt;/p&gt;</comment>
                            <comment id="14260786" author="ram_krish" created="Tue, 30 Dec 2014 04:40:22 +0000"  >&lt;p&gt;Duplicate. Chunhui&apos;s fix has solved this already.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12624993" name="hbase-6048-94.patch" size="2234" author="zjushch" created="Fri, 24 Jan 2014 05:27:06 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 18 May 2012 14:05:58 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>241811</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 48 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i02daf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>11754</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>