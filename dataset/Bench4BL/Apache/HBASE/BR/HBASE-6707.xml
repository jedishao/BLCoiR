<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sat Dec 03 18:12:10 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-6707/HBASE-6707.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-6707] TEST org.apache.hadoop.hbase.backup.example.TestZooKeeperTableArchiveClient.testMultipleTables flaps</title>
                <link>https://issues.apache.org/jira/browse/HBASE-6707</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;&lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/3293/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/3293/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Error Message&lt;/p&gt;

&lt;p&gt;Archived HFiles (hdfs://localhost:59986/user/jenkins/hbase/.archive/otherTable/01ced3b55d7220a9c460273a4a57b198/fam) should have gotten deleted, but didn&apos;t, remaining files:&lt;span class=&quot;error&quot;&gt;&amp;#91;hdfs://localhost:59986/user/jenkins/hbase/.archive/otherTable/01ced3b55d7220a9c460273a4a57b198/fam/fc872572a1f5443eb55b6e2567cfeb1c&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;Stacktrace&lt;/p&gt;

&lt;p&gt;java.lang.AssertionError: Archived HFiles (hdfs://localhost:59986/user/jenkins/hbase/.archive/otherTable/01ced3b55d7220a9c460273a4a57b198/fam) should have gotten deleted, but didn&apos;t, remaining files:&lt;span class=&quot;error&quot;&gt;&amp;#91;hdfs://localhost:59986/user/jenkins/hbase/.archive/otherTable/01ced3b55d7220a9c460273a4a57b198/fam/fc872572a1f5443eb55b6e2567cfeb1c&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.junit.Assert.fail(Assert.java:93)&lt;br/&gt;
	at org.junit.Assert.assertTrue(Assert.java:43)&lt;br/&gt;
	at org.junit.Assert.assertNull(Assert.java:551)&lt;br/&gt;
	at org.apache.hadoop.hbase.backup.example.TestZooKeeperTableArchiveClient.testMultipleTables(TestZooKeeperTableArchiveClient.java:291)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)&lt;br/&gt;
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;/p&gt;</description>
                <environment></environment>
        <key id="12605795">HBASE-6707</key>
            <summary>TEST org.apache.hadoop.hbase.backup.example.TestZooKeeperTableArchiveClient.testMultipleTables flaps</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.png">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jesse_yates">Jesse Yates</assignee>
                                    <reporter username="sameerv">Sameer Vaishampayan</reporter>
                        <labels>
                    </labels>
                <created>Fri, 31 Aug 2012 21:18:25 +0000</created>
                <updated>Mon, 23 Sep 2013 18:31:04 +0000</updated>
                            <resolved>Tue, 4 Dec 2012 01:25:42 +0000</resolved>
                                                    <fixVersion>0.95.0</fixVersion>
                                    <component>test</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                <comments>
                            <comment id="13446389" author="yuzhihong@gmail.com" created="Fri, 31 Aug 2012 21:21:29 +0000"  >&lt;p&gt;Seems to be dup of &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6690&quot; title=&quot;TestZooKeeperTableArchiveClient.testMultipleTables is flapping&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6690&quot;&gt;&lt;del&gt;HBASE-6690&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13447873" author="jesse_yates" created="Tue, 4 Sep 2012 18:08:23 +0000"  >&lt;p&gt;@Ted marked 6690 as a dup of this since this stayed open &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Here&apos;s the link to the overall history (definitely flapping):&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;&lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/3293/testReport/junit/org.apache.hadoop.hbase.backup.example/TestZooKeeperTableArchiveClient/testMultipleTables/history/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/3293/testReport/junit/org.apache.hadoop.hbase.backup.example/TestZooKeeperTableArchiveClient/testMultipleTables/history/&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;And the most recent failure:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;&lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/3299/testReport/org.apache.hadoop.hbase.backup.example/TestZooKeeperTableArchiveClient/testMultipleTables/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/3299/testReport/org.apache.hadoop.hbase.backup.example/TestZooKeeperTableArchiveClient/testMultipleTables/&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13449315" author="jesse_yates" created="Thu, 6 Sep 2012 00:44:49 +0000"  >&lt;p&gt;Attaching patch. Dramatically simplified the test to ensure the same code path is reused between each test as much as seemed reasonable. &lt;/p&gt;

&lt;p&gt;Ran consecutively 20x on my local machine without seeing a failure. Also, seemed to be a bit faster than the original test, so that&apos;s nice.&lt;/p&gt;</comment>
                            <comment id="13450309" author="stack" created="Fri, 7 Sep 2012 03:45:10 +0000"  >&lt;p&gt;Committed to trunk after trying it locally.  Thanks for the patch Jesse.&lt;/p&gt;</comment>
                            <comment id="13450352" author="hudson" created="Fri, 7 Sep 2012 05:16:13 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK #3312 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/3312/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/3312/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6707&quot; title=&quot;TEST org.apache.hadoop.hbase.backup.example.TestZooKeeperTableArchiveClient.testMultipleTables flaps&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6707&quot;&gt;&lt;del&gt;HBASE-6707&lt;/del&gt;&lt;/a&gt; TEST org.apache.hadoop.hbase.backup.example.TestZooKeeperTableArchiveClient.testMultipleTables flaps (Revision 1381852)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
stack : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/backup/example/LongTermArchivingHFileCleaner.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/master/cleaner/CleanerChore.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/backup/example/TestZooKeeperTableArchiveClient.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13450358" author="stack" created="Fri, 7 Sep 2012 05:25:17 +0000"  >&lt;p&gt;I reverted the patch.  This fail of the trunk build prompted by this commit is suspicious given its a fail in TestZooKeeperTableArchiveClient: &lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://builds.apache.org/view/G-L/view/HBase/job/HBase-TRUNK/3312/testReport/junit/org.apache.hadoop.hbase.backup.example/TestZooKeeperTableArchiveClient/testArchivingOnSingleTable/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/view/G-L/view/HBase/job/HBase-TRUNK/3312/testReport/junit/org.apache.hadoop.hbase.backup.example/TestZooKeeperTableArchiveClient/testArchivingOnSingleTable/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;What you think Jesse?  Related to your change or another failure mode not yet handled?&lt;/p&gt;</comment>
                            <comment id="13450362" author="stack" created="Fri, 7 Sep 2012 05:27:45 +0000"  >&lt;p&gt;See if hadoopqa will run it now.&lt;/p&gt;</comment>
                            <comment id="13450365" author="jesse_yates" created="Fri, 7 Sep 2012 05:30:53 +0000"  >&lt;p&gt;Looks like a missed failure mode. Taking a look... thanks stack!&lt;/p&gt;</comment>
                            <comment id="13450367" author="stack" created="Fri, 7 Sep 2012 05:32:06 +0000"  >&lt;p&gt;Thanks for taking a look J.&lt;/p&gt;</comment>
                            <comment id="13450424" author="hudson" created="Fri, 7 Sep 2012 06:52:12 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK #3313 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/3313/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/3313/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6707&quot; title=&quot;TEST org.apache.hadoop.hbase.backup.example.TestZooKeeperTableArchiveClient.testMultipleTables flaps&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6707&quot;&gt;&lt;del&gt;HBASE-6707&lt;/del&gt;&lt;/a&gt; TEST org.apache.hadoop.hbase.backup.example.TestZooKeeperTableArchiveClient.testMultipleTables flaps; REVERT (Revision 1381877)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
stack : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/backup/example/LongTermArchivingHFileCleaner.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/master/cleaner/CleanerChore.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/backup/example/TestZooKeeperTableArchiveClient.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13450538" author="hudson" created="Fri, 7 Sep 2012 11:41:37 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK-on-Hadoop-2.0.0 #164 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK-on-Hadoop-2.0.0/164/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK-on-Hadoop-2.0.0/164/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6707&quot; title=&quot;TEST org.apache.hadoop.hbase.backup.example.TestZooKeeperTableArchiveClient.testMultipleTables flaps&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6707&quot;&gt;&lt;del&gt;HBASE-6707&lt;/del&gt;&lt;/a&gt; TEST org.apache.hadoop.hbase.backup.example.TestZooKeeperTableArchiveClient.testMultipleTables flaps; REVERT (Revision 1381877)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6707&quot; title=&quot;TEST org.apache.hadoop.hbase.backup.example.TestZooKeeperTableArchiveClient.testMultipleTables flaps&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6707&quot;&gt;&lt;del&gt;HBASE-6707&lt;/del&gt;&lt;/a&gt; TEST org.apache.hadoop.hbase.backup.example.TestZooKeeperTableArchiveClient.testMultipleTables flaps (Revision 1381852)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
stack : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/backup/example/LongTermArchivingHFileCleaner.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/master/cleaner/CleanerChore.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/backup/example/TestZooKeeperTableArchiveClient.java&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;stack : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/backup/example/LongTermArchivingHFileCleaner.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/master/cleaner/CleanerChore.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/backup/example/TestZooKeeperTableArchiveClient.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13451032" author="jesse_yates" created="Fri, 7 Sep 2012 21:54:09 +0000"  >&lt;p&gt;New version - this time we ignore it if we can&apos;t compact the files and just make sure there are some files that have been archived. &lt;/p&gt;

&lt;p&gt;I was trying both in the original and the previously attached patch to ensure that we had enough files before trying the compaction, but its just easier to try-and-fail than be defensive about it (though slightly more brittle, its unlikely to change anytime soon...and much simpler to reason about code-wise).&lt;/p&gt;</comment>
                            <comment id="13451036" author="jesse_yates" created="Fri, 7 Sep 2012 21:56:54 +0000"  >&lt;p&gt;Also ran it 10x locally (and another 10x before rebasing onto trunk) without issue, though that clearly doesn&apos;t mean all that much.&lt;/p&gt;</comment>
                            <comment id="13451119" author="hadoopqa" created="Fri, 7 Sep 2012 23:10:23 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12544304/hbase-6707-v1.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12544304/hbase-6707-v1.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 hadoop2.0.  The patch compiles against the hadoop 2.0 profile.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    -1 javac.  The patch appears to cause mvn compile goal to fail.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to cause Findbugs (version 1.3.9) to fail.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;     -1 core tests.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.io.hfile.TestForceCacheImportantBlocks&lt;br/&gt;
                  org.apache.hadoop.hbase.master.TestSplitLogManager&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2820//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2820//testReport/&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2820//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2820//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13456696" author="stack" created="Sun, 16 Sep 2012 22:32:07 +0000"  >&lt;p&gt;In it goes again.  Thanks for the patch Jesse (I tried it locally and it passed).&lt;/p&gt;</comment>
                            <comment id="13456867" author="hudson" created="Mon, 17 Sep 2012 07:58:17 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK-on-Hadoop-2.0.0 #177 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK-on-Hadoop-2.0.0/177/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK-on-Hadoop-2.0.0/177/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6707&quot; title=&quot;TEST org.apache.hadoop.hbase.backup.example.TestZooKeeperTableArchiveClient.testMultipleTables flaps&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6707&quot;&gt;&lt;del&gt;HBASE-6707&lt;/del&gt;&lt;/a&gt; TEST org.apache.hadoop.hbase.backup.example.TestZooKeeperTableArchiveClient.testMultipleTables flaps (Revision 1385388)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
stack : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/backup/example/LongTermArchivingHFileCleaner.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/master/cleaner/CleanerChore.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/backup/example/TestZooKeeperTableArchiveClient.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13456872" author="hudson" created="Mon, 17 Sep 2012 08:15:07 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK #3340 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/3340/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/3340/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6707&quot; title=&quot;TEST org.apache.hadoop.hbase.backup.example.TestZooKeeperTableArchiveClient.testMultipleTables flaps&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6707&quot;&gt;&lt;del&gt;HBASE-6707&lt;/del&gt;&lt;/a&gt; TEST org.apache.hadoop.hbase.backup.example.TestZooKeeperTableArchiveClient.testMultipleTables flaps (Revision 1385388)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
stack : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/backup/example/LongTermArchivingHFileCleaner.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/master/cleaner/CleanerChore.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/backup/example/TestZooKeeperTableArchiveClient.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13457189" author="stack" created="Mon, 17 Sep 2012 17:48:52 +0000"  >&lt;p&gt;Reopening again.  I reverted the patch because I got this fail on trunk build: &lt;a href=&quot;https://builds.apache.org/view/G-L/view/HBase/job/HBase-TRUNK/3342/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/view/G-L/view/HBase/job/HBase-TRUNK/3342/&lt;/a&gt;  If you get a chance, take a looksee mighty Jesse.  Thanks.&lt;/p&gt;</comment>
                            <comment id="13457202" author="jesse_yates" created="Mon, 17 Sep 2012 18:14:59 +0000"  >&lt;p&gt;@stack yeah, I&apos;ll take a look. This is getting really frustrating :-/&lt;/p&gt;</comment>
                            <comment id="13457219" author="stack" created="Mon, 17 Sep 2012 18:50:57 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jesse_yates&quot; class=&quot;user-hover&quot; rel=&quot;jesse_yates&quot;&gt;Jesse Yates&lt;/a&gt; Deep breaths.&lt;/p&gt;</comment>
                            <comment id="13457259" author="hudson" created="Mon, 17 Sep 2012 19:49:19 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK #3343 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/3343/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/3343/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6707&quot; title=&quot;TEST org.apache.hadoop.hbase.backup.example.TestZooKeeperTableArchiveClient.testMultipleTables flaps&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6707&quot;&gt;&lt;del&gt;HBASE-6707&lt;/del&gt;&lt;/a&gt; TEST org.apache.hadoop.hbase.backup.example.TestZooKeeperTableArchiveClient.testMultipleTables flaps; REVERT AGAIN (Revision 1386748)&lt;/p&gt;

&lt;p&gt;     Result = SUCCESS&lt;br/&gt;
stack : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/backup/example/LongTermArchivingHFileCleaner.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/master/cleaner/CleanerChore.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/backup/example/TestZooKeeperTableArchiveClient.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13457475" author="hudson" created="Mon, 17 Sep 2012 23:39:16 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK-on-Hadoop-2.0.0 #178 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK-on-Hadoop-2.0.0/178/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK-on-Hadoop-2.0.0/178/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6707&quot; title=&quot;TEST org.apache.hadoop.hbase.backup.example.TestZooKeeperTableArchiveClient.testMultipleTables flaps&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6707&quot;&gt;&lt;del&gt;HBASE-6707&lt;/del&gt;&lt;/a&gt; TEST org.apache.hadoop.hbase.backup.example.TestZooKeeperTableArchiveClient.testMultipleTables flaps; REVERT AGAIN (Revision 1386748)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
stack : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/backup/example/LongTermArchivingHFileCleaner.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/master/cleaner/CleanerChore.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/backup/example/TestZooKeeperTableArchiveClient.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13465288" author="jesse_yates" created="Fri, 28 Sep 2012 02:10:39 +0000"  >&lt;p&gt;Attaching a completely reworked version. &lt;/p&gt;

&lt;p&gt;I got sick of having to deal with all the uncertainty in how the region was doing things (compactions and flushes never seemed to be exactly right, causing the flapping).  Instead, I ended up mocking out basically all the important parts around the HRegion and using those to actually run an HRegion independently of anything else, with full support of flushes and compactions (though no splitting). I&apos;m a lot more sure that this won&apos;t flap.&lt;/p&gt;

&lt;p&gt;This is a bit on the larger side, so it might warrant an spin on RB, but I&apos;ll leave that up to reviewers. &lt;/p&gt;

&lt;p&gt;Oh, and the changed test passed 20x locally (not that that means much with this test, but still pretty good).&lt;/p&gt;</comment>
                            <comment id="13465308" author="stack" created="Fri, 28 Sep 2012 03:30:15 +0000"  >&lt;p&gt;Pull MockRegionServer up to top level in test now its used by master package and top-level package.  It was in master package because that was only place it was needed until now.&lt;/p&gt;

&lt;p&gt;I will hold my nose when I commit stuff like this:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+  /**
+   * Exposed &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; testing!
+   */
+  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; CompactSplitThread getCompactSplitThread() {
+    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.compactSplitThread;
+  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Rather than comment out, remove:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
-    UTIL.createTable(TABLE_NAME, TEST_FAM);
+    &lt;span class=&quot;code-comment&quot;&gt;// UTIL.createTable(TABLE_NAME, TEST_FAM);&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;That mocked hregion looks like it could be generally useful.  Nice.&lt;/p&gt;

&lt;p&gt;Good on you Jesse.&lt;/p&gt;
</comment>
                            <comment id="13465775" author="yuzhihong@gmail.com" created="Fri, 28 Sep 2012 17:43:03 +0000"  >&lt;p&gt;Nice effort, Jesse.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;compactions and flushes never seemed to be exactly right, causing the flapping&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Can you be more specific about the above ? If you spot incorrect behavior, we&apos;d better fix it &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13465933" author="jesse_yates" created="Fri, 28 Sep 2012 21:53:00 +0000"  >&lt;p&gt;A far more conservative patch than the last one. &lt;/p&gt;

&lt;p&gt;Thanks Ted for calling me out on mocking out ALL THE THINGS. Definitely a more brittle approach (the logic was that the core compaction/split stuff doesn&apos;t change all that often &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; to just get a couple region to pump out a few hfiles and compactions.&lt;/p&gt;

&lt;p&gt;This new version just creates a simple HRegion, 2x writes a single key to create an hfile via flushing and does a compaction to force hfile archiving. Then it does the real checking with the LongTermHFileArchiver.&lt;/p&gt;

&lt;p&gt;This is technically a smaller scope than the original test, but its ok because (1) it tests real hfiles that follow the standard archival path, (2) uses a real HFileCleaner to run the cleaner.&lt;/p&gt;

&lt;p&gt;As long as the HFileCleaner and the rest of the system works correctly (which is why we have other tests), then this test is sufficient to cover the validity of the example classes.&lt;/p&gt;

&lt;p&gt;Seem reasonable?&lt;/p&gt;</comment>
                            <comment id="13465937" author="jesse_yates" created="Fri, 28 Sep 2012 21:55:36 +0000"  >&lt;blockquote&gt;&lt;p&gt;compactions and flushes never seemed to be exactly right, causing the flapping&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Meant there that you can end up with a race condition where you load and flush the region, then try and trigger a compaction via the Store interface which then fails because it doesn&apos;t have enough store files because the region compacted them away from under you. The problem was the &apos;correct&apos; way to orchestrate a region and compactions wasn&apos;t obvious - just took a bit more poking around beyond the obvious methods.&lt;/p&gt;</comment>
                            <comment id="13465946" author="yuzhihong@gmail.com" created="Fri, 28 Sep 2012 22:13:32 +0000"  >&lt;p&gt;Thanks for the quick turn around, Jesse.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;The problem was the &apos;correct&apos; way to orchestrate a region and compactions wasn&apos;t obvious&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;This is important for future test cases. Mind logging a JIRA ?&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;2x writes a single key to create an hfile via flushing and does a compaction to force hfile archiving&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I think writing rows with different row keys is desirable. The closer the test case is to real usage, the higher confidence we have for this feature.&lt;/p&gt;

&lt;p&gt;Putting up patch on review board would facilitate review comments.&lt;/p&gt;</comment>
                            <comment id="13465947" author="jesse_yates" created="Fri, 28 Sep 2012 22:13:57 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=stack&quot; class=&quot;user-hover&quot; rel=&quot;stack&quot;&gt;stack&lt;/a&gt; bq. I will hold my nose when I commit stuff like this:&lt;/p&gt;

&lt;p&gt;Wouldn&apos;t be necessary if we roll in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5456&quot; title=&quot;Introduce PowerMock into our unit tests to reduce unnecessary method exposure&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5456&quot;&gt;HBASE-5456&lt;/a&gt; &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13465959" author="jesse_yates" created="Fri, 28 Sep 2012 22:27:06 +0000"  >&lt;blockquote&gt;&lt;p&gt;I think writing rows with different row keys is desirable. The closer the test case is to real usage, the higher confidence we have for this feature.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Why? The real use case here is to not delete hfiles based on the zookeeper initiated update the the cleaner.  Seems like it covers it. I&apos;d argue that it even covers the case even if I didn&apos;t use an hregion, but just put files in the archive in the right directories - this way is just gravy (and little future proofing).&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;Putting up patch on review board would facilitate review comments.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Added review here: &lt;a href=&quot;https://reviews.apache.org/r/7344/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/7344/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13465960" author="jesse_yates" created="Fri, 28 Sep 2012 22:27:37 +0000"  >&lt;blockquote&gt;&lt;p&gt;This is important for future test cases. Mind logging a JIRA ?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;What are you thinking for this? More information in the book or updating the javadocs?&lt;/p&gt;</comment>
                            <comment id="13466025" author="yuzhihong@gmail.com" created="Fri, 28 Sep 2012 23:50:55 +0000"  >&lt;p&gt;Updating javadocs or enriching hbase book would be good for the &apos;correct&apos; way to orchestrate a region and compactions.&lt;/p&gt;</comment>
                            <comment id="13466901" author="yuzhihong@gmail.com" created="Mon, 1 Oct 2012 16:09:39 +0000"  >&lt;p&gt;Now there seems to be another dimension to consider: TestZooKeeperTableArchiveClient is failing in trunk (maybe due to switch to jdk 1.7)&lt;br/&gt;
How would we know that the fix really works after it gets checked in ?&lt;/p&gt;</comment>
                            <comment id="13466972" author="jesse_yates" created="Mon, 1 Oct 2012 17:23:33 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tedyu%40apache.org&quot; class=&quot;user-hover&quot; rel=&quot;tedyu@apache.org&quot;&gt;Ted Yu&lt;/a&gt; why would that change anything? It was already flaky, so we know the fix works when the test passes...?&lt;/p&gt;</comment>
                            <comment id="13466981" author="yuzhihong@gmail.com" created="Mon, 1 Oct 2012 17:28:49 +0000"  >&lt;blockquote&gt;&lt;p&gt;so we know the fix works when the test passes&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;TestZooKeeperTableArchiveClient has been failing in trunk builds 3397 and 3398, but not in build #3396 where jdk 1.6 was used.&lt;/p&gt;</comment>
                            <comment id="13466996" author="jesse_yates" created="Mon, 1 Oct 2012 17:40:56 +0000"  >&lt;p&gt;Yeah, but the test didn&apos;t always passing so we try to fix it, and then if it flaps try fixing it again. The nature of flappers is such that you can&apos; be sure that it will always pass anyways (see the above comments on this thread), so its more of a wait and see. However, if the test is always failing and then we fix it such that its not, that&apos;s a net win.&lt;/p&gt;</comment>
                            <comment id="13467001" author="yuzhihong@gmail.com" created="Mon, 1 Oct 2012 17:44:57 +0000"  >&lt;blockquote&gt;&lt;p&gt;if the test is always failing and then we fix it such that its not, that&apos;s a net win.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I am still trying to install jdk 1.7 on my MacBook.&lt;br/&gt;
It would be nice to confirm that this fix makes TestZooKeeperTableArchiveClient pass on jdk 1.7 reliably, before integration.&lt;/p&gt;

&lt;p&gt;Thanks&lt;/p&gt;</comment>
                            <comment id="13467004" author="jesse_yates" created="Mon, 1 Oct 2012 17:46:42 +0000"  >&lt;blockquote&gt;&lt;p&gt;It would be nice to confirm that this fix makes TestZooKeeperTableArchiveClient pass on jdk 1.7 reliably, before integration.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;+1 Wouldn&apos;t HadoopQA ensure that?&lt;/p&gt;</comment>
                            <comment id="13467008" author="yuzhihong@gmail.com" created="Mon, 1 Oct 2012 17:52:50 +0000"  >&lt;p&gt;It&apos;s open to discussion.&lt;br/&gt;
If QA run returns with 196 test failures (the current number of failures on trunk), how do we interpret the test results ?&lt;/p&gt;</comment>
                            <comment id="13467100" author="stack" created="Mon, 1 Oct 2012 18:59:49 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jesse_yates&quot; class=&quot;user-hover&quot; rel=&quot;jesse_yates&quot;&gt;Jesse Yates&lt;/a&gt; Mind updating patch for trunk?  It seems to have rotted.  I want to commit it because flakey TestZooKeeperTableArchiveClient is messing up clean unit test build on jdk7.  Thanks boss.&lt;/p&gt;</comment>
                            <comment id="13467314" author="yuzhihong@gmail.com" created="Mon, 1 Oct 2012 23:34:02 +0000"  >&lt;p&gt;As of build #3400, there were 198 test failures.&lt;br/&gt;
TestZooKeeperTableArchiveClient has been failing in the last 4 builds.&lt;/p&gt;</comment>
                            <comment id="13467334" author="jesse_yates" created="Mon, 1 Oct 2012 23:43:30 +0000"  >&lt;p&gt;Attaching new version with Ted&apos;s comments addressed on trunk. Ran 10x locally without issue.&lt;/p&gt;</comment>
                            <comment id="13467343" author="yuzhihong@gmail.com" created="Mon, 1 Oct 2012 23:55:30 +0000"  >&lt;p&gt;Thanks for the quick response, Jesse.&lt;br/&gt;
My laptop is in Corp IT department.&lt;/p&gt;

&lt;p&gt;I will go over latest patch tomorrow.&lt;/p&gt;</comment>
                            <comment id="13467349" author="jesse_yates" created="Tue, 2 Oct 2012 00:13:25 +0000"  >&lt;p&gt;that was 10x with jdk6 - looks like all the failures on jenkins are due to connection loss issues due to ZK in the mini-cluster setup. Getting the same issue locally and for other tests that also use ZK.&lt;/p&gt;</comment>
                            <comment id="13467375" author="yuzhihong@gmail.com" created="Tue, 2 Oct 2012 00:57:41 +0000"  >&lt;blockquote&gt;&lt;p&gt;Getting the same issue locally and for other tests that also use ZK.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Isn&apos;t the above a blocker for this JIRA in terms of passing trunk build ?&lt;/p&gt;</comment>
                            <comment id="13467377" author="jesse_yates" created="Tue, 2 Oct 2012 00:59:51 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tedyu%40apache.org&quot; class=&quot;user-hover&quot; rel=&quot;tedyu@apache.org&quot;&gt;Ted Yu&lt;/a&gt; yup. I&apos;m looking into it now... do you know of another jira for that issue?&lt;/p&gt;</comment>
                            <comment id="13467436" author="stack" created="Tue, 2 Oct 2012 03:23:57 +0000"  >&lt;blockquote&gt;&lt;p&gt;Isn&apos;t the above a blocker for this JIRA in terms of passing trunk build ?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Nope.  The zk failures seem to be related to jdk7.&lt;/p&gt;

&lt;p&gt;I&apos;ll take a look at those.  Don&apos;t worry Jesse.&lt;/p&gt;</comment>
                            <comment id="13467452" author="stack" created="Tue, 2 Oct 2012 03:42:46 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jesse_yates&quot; class=&quot;user-hover&quot; rel=&quot;jesse_yates&quot;&gt;Jesse Yates&lt;/a&gt; This test is jinxed.  Ran v4 here on linux:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Running org.apache.hadoop.hbase.backup.example.TestZooKeeperTableArchiveClient



Tests run: 3, Failures: 1, Errors: 0, Skipped: 0, Time elapsed: 412.066 sec &amp;lt;&amp;lt;&amp;lt; FAILURE!

Results :

Failed tests:   testMultipleTables(org.apache.hadoop.hbase.backup.example.TestZooKeeperTableArchiveClient): Archived HFiles (hdfs:&lt;span class=&quot;code-comment&quot;&gt;//localhost:39252/user/stack/hbase/.archive/otherTable/3d3f71c42883a0da891ee06abd92422f/fam) should have gotten deleted, but didn&apos;t, remaining files:[hdfs://localhost:39252/user/stack/hbase/.archive/otherTable/3d3f71c42883a0da891ee06abd92422f/fam/6d6af62bad2d453fb389ac55a92bd9d1, hdfs://localhost:39252/user/stack/hbase/.archive/otherTable/3d3f71c42883a0da891ee06abd92422f/fam/6e1c742116e04935835898773d817e8d, hdfs://localhost:39252/user/stack/hbase/.archive/otherTable/3d3f71c42883a0da891ee06abd92422f/fam/7250d611f0474075af64b06892526c43, hdfs://localhost:39252/user/stack/hbase/.archive/otherTable/3d3f71c42883a0da891ee06abd92422f/fam/766fe140ea944257ad6986a1ec98fe5f, hdfs://localhost:39252/user/stack/hbase/.archive/otherTable/3d3f71c42883a0da891ee06abd92422f/fam/78b4db0bc6bc4196bde9ba6e2af9d5c6, hdfs://localhost:39252/user/stack/hbase/.archive/otherTable/3d3f71c42883a0da891ee06abd92422f/fam/7db62f8705824a0eb92321228f90099b, hdfs://localhost:39252/user/stack/hbase/.archive/otherTable/3d3f71c42883a0da891ee06abd92422f/fam/8555f37b352042bc95430bae2ad1e4f1, hdfs://localhost:39252/user/stack/hbase/.archive/otherTable/3d3f71c42883a0da891ee06abd92422f/fam/86017a9d5e854963805cf6a538e958e9, hdfs://localhost:39252/user/stack/hbase/.archive/otherTable/3d3f71c42883a0da891ee06abd92422f/fam/86468e76f1004f418a71e2377b0daa92, hdfs://localhost:39252/user/stack/hbase/.archive/otherTable/3d3f71c42883a0da891ee06abd92422f/fam/8757d514111347a9bab1c62cbdeeda7c, hdfs://localhost:39252/user/stack/hbase/.archive/otherTable/3d3f71c42883a0da891ee06abd92422f/fam/8d0adef159bb4a919344bbc711e7b072, hdfs://localhost:39252/user/stack/hbase/.archive/otherTable/3d3f71c42883a0da891ee06abd92422f/fam/90112e511a58407d984e5eb82a895aff, hdfs://localhost:39252/user/stack/hbase/.archive/otherTable/3d3f71c42883a0da891ee06abd92422f/fam/90fc97bd0ae448d88835d4c0f478d561, hdfs://localhost:39252/user/stack/hbase/.archive/otherTable/3d3f71c42883a0da891ee06abd92422f/fam/962e398c7f3549dcbf2b11544bff2244, hdfs://localhost:39252/user/stack/hbase/.archive/otherTable/3d3f71c42883a0da891ee06abd92422f/fam/98c79c1bab9d40c3bb57cf5b107446d5, hdfs://localhost:39252/user/stack/hbase/.archive/otherTable/3d3f71c42883a0da891ee06abd92422f/fam/9b40e32e48de4cb7ab16177839dd355a, hdfs://localhost:39252/user/stack/hbase/.archive/otherTable/3d3f71c42883a0da891ee06abd92422f/fam/9ca1e31e01554a8c9b8b58adb5a99046, hdfs://localhost:39252/user/stack/hbase/.archive/otherTable/3d3f71c42883a0da891ee06abd92422f/fam/9e0b166d8fed4026a1dcbde892f31587, hdfs://localhost:39252/user/stack/hbase/.archive/otherTable/3d3f71c42883a0da891ee06abd92422f/fam/a08c7abcb5d2422e9d6a7426165ab604, hdfs://localhost:39252/user/stack/hbase/.archive/otherTable/3d3f71c42883a0da891ee06abd92422f/fam/a1a16ee6f1444f0a93f2df91f4becab2, hdfs://localhost:39252/user/stack/hbase/.archive/otherTable/3d3f71c42883a0da891ee06abd92422f/fam/a48ea330d5c44fa1b0191ed87da184c7, hdfs://localhost:39252/user/stack/hbase/.archive/otherTable/3d3f71c42883a0da891ee06abd92422f/fam/a8c1a75b93244e6f8cc5730b7d2445c6, hdfs://localhost:39252/user/stack/hbase/.archive/otherTable/3d3f71c42883a0da891ee06abd92422f/fam/ad791e416d134068b511c1c0501c7bd5, hdfs://localhost:39252/user/stack/hbase/.archive/otherTable/3d3f71c42883a0da891ee06abd92422f/fam/ae26c632b8004a7aa93df6f727bb183e, hdfs://localhost:39252/user/stack/hbase/.archive/otherTable/3d3f71c42883a0da891ee06abd92422f/fam/b5a3bf0023ef486c9d2289cdfde0e5e3, hdfs://localhost:39252/user/stack/hbase/.archive/otherTable/3d3f71c42883a0da891ee06abd92422f/fam/b8ab2f1aa34c4214b484ec6bff012d5b, hdfs://localhost:39252/user/stack/hbase/.archive/otherTable/3d3f71c42883a0da891ee06abd92422f/fam/ba1b5ab89f95497f8bb4bf33a0f59a10, hdfs://localhost:39252/user/stack/hbase/.archive/otherTable/3d3f71c42883a0da891ee06abd92422f/fam/bce5552f319442a6b27499eff22622b0, hdfs://localhost:39252/user/stack/hbase/.archive/otherTable/3d3f71c42883a0da891ee06abd92422f/fam/bdc657c0faea4fbbb79af222981b1fb2, hdfs://localhost:39252/user/stack/hbase/.archive/otherTable/3d3f71c42883a0da891ee06abd92422f/fam/bf8071d03fc945eb98f75c1e613b2aef, hdfs://localhost:39252/user/stack/hbase/.archive/otherTable/3d3f71c42883a0da891ee06abd92422f/fam/c26b96112d27407c88b709238117a5ee, hdfs://localhost:39252/user/stack/hbase/.archive/otherTable/3d3f71c42883a0da891ee06abd92422f/fam/c415ddc0bc6e4c8b973d5771d3c35117, hdfs://localhost:39252/user/stack/hbase/.archive/otherTable/3d3f71c42883a0da891ee06abd92422f/fam/c75a0900ae424c70af2e700bb2d72efd, hdfs://localhost:39252/user/stack/hbase/.archive/otherTable/3d3f71c42883a0da891ee06abd92422f/fam/c7cd4713af164dde9d5165dc9a409577, hdfs://localhost:39252/user/stack/hbase/.archive/otherTable/3d3f71c42883a0da891ee06abd92422f/fam/c9ad36722fd546c3b528c1d083cc3e46, hdfs://localhost:39252/user/stack/hbase/.archive/otherTable/3d3f71c42883a0da891ee06abd92422f/fam/ccdfdd36cd1e46c6b18506c63cab9b7d, hdfs://localhost:39252/user/stack/hbase/.archive/otherTable/3d3f71c42883a0da891ee06abd92422f/fam/d10c25325df54e008d22ff8147c5acda, hdfs://localhost:39252/user/stack/hbase/.archive/otherTable/3d3f71c42883a0da891ee06abd92422f/fam/d1f465564c4941d89e2cdf070957000e, hdfs://localhost:39252/user/stack/hbase/.archive/otherTable/3d3f71c42883a0da891ee06abd92422f/fam/d3361a1edac94717b75282916eb934e4, hdfs://localhost:39252/user/stack/hbase/.archive/otherTable/3d3f71c42883a0da891ee06abd92422f/fam/d3c09b7e7a7b420bb741e5e970127b98, hdfs://localhost:39252/user/stack/hbase/.archive/otherTable/3d3f71c42883a0da891ee06abd92422f/fam/d843419369a94546bfcb9be971cf1e01, hdfs://localhost:39252/user/stack/hbase/.archive/otherTable/3d3f71c42883a0da891ee06abd92422f/fam/db5f4b6b3fae4f07ba40b9d078f5e2d8, hdfs://localhost:39252/user/stack/hbase/.archive/otherTable/3d3f71c42883a0da891ee06abd92422f/fam/dba3f13c5f2a429a990860153453b93d, hdfs://localhost:39252/user/stack/hbase/.archive/otherTable/3d3f71c42883a0da891ee06abd92422f/fam/dc10994b7f7042889ed8b00160e3e0ad, hdfs://localhost:39252/user/stack/hbase/.archive/otherTable/3d3f71c42883a0da891ee06abd92422f/fam/dcd46e2ba90745caa4a07e824067259a, hdfs://localhost:39252/user/stack/hbase/.archive/otherTable/3d3f71c42883a0da891ee06abd92422f/fam/e807aecb4103472da0ffc4722822ac04, hdfs://localhost:39252/user/stack/hbase/.archive/otherTable/3d3f71c42883a0da891ee06abd92422f/fam/ef7f6a46612c4188a4a3acf0e3cd5abe, hdfs://localhost:39252/user/stack/hbase/.archive/otherTable/3d3f71c42883a0da891ee06abd92422f/fam/fcbd1f87a1ab465598a840c9f71b5e16]
&lt;/span&gt;
Tests run: 3, Failures: 1, Errors: 0, Skipped: 0


And ....




-------------------------------------------------------
Running org.apache.hadoop.hbase.backup.example.TestZooKeeperTableArchiveClient







Tests run: 3, Failures: 0, Errors: 1, Skipped: 0, Time elapsed: 316.773 sec &amp;lt;&amp;lt;&amp;lt; FAILURE!

Results :

Tests in error: 
  testMultipleTables(org.apache.hadoop.hbase.backup.example.TestZooKeeperTableArchiveClient): otherTable,,1349149111188.263ba836fbabdb1c12c43f7a2fe6f856. is closing

Tests run: 3, Failures: 0, Errors: 1, Skipped: 0
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
</comment>
                            <comment id="13467909" author="jesse_yates" created="Tue, 2 Oct 2012 17:59:28 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=stack&quot; class=&quot;user-hover&quot; rel=&quot;stack&quot;&gt;stack&lt;/a&gt; are you sure you ran v4? I can&apos;t seem to find where that output would even occur in the patch...&lt;/p&gt;</comment>
                            <comment id="13467921" author="yuzhihong@gmail.com" created="Tue, 2 Oct 2012 18:10:57 +0000"  >&lt;p&gt;@Jesse:&lt;br/&gt;
Do you mind updating review request on review board so that I can see the changes between the two patches ?&lt;/p&gt;

&lt;p&gt;Thanks&lt;/p&gt;</comment>
                            <comment id="13467927" author="jesse_yates" created="Tue, 2 Oct 2012 18:13:39 +0000"  >&lt;p&gt;@Ted - done. review can be found here: &lt;a href=&quot;https://reviews.apache.org/r/7344/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/7344/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13467939" author="stack" created="Tue, 2 Oct 2012 18:25:05 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jesse_yates&quot; class=&quot;user-hover&quot; rel=&quot;jesse_yates&quot;&gt;Jesse Yates&lt;/a&gt; I must have done something wrong.  Sorry about that.  Seems fine running it in a loop here locally.  Waiting on Ted&apos;s review before committing.&lt;/p&gt;</comment>
                            <comment id="13468033" author="yuzhihong@gmail.com" created="Tue, 2 Oct 2012 20:14:55 +0000"  >&lt;p&gt;The gist of this JIRA is about making sure that HFiles for table not configured to endure table drop should be deleted.&lt;br/&gt;
I had a question w.r.t. the above which I noted on review board.&lt;/p&gt;</comment>
                            <comment id="13468042" author="yuzhihong@gmail.com" created="Tue, 2 Oct 2012 20:28:08 +0000"  >&lt;p&gt;I am sorry Jesse: &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5699&quot; title=&quot;Run with &amp;gt; 1 WAL in HRegionServer&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5699&quot;&gt;&lt;del&gt;HBASE-5699&lt;/del&gt;&lt;/a&gt; has gone in and patch v4 is stale now.&lt;/p&gt;

&lt;p&gt;Once you provide rebased patch, I will run the test and confirm that the fix works.&lt;/p&gt;

&lt;p&gt;Thanks for your patience.&lt;/p&gt;</comment>
                            <comment id="13468043" author="jesse_yates" created="Tue, 2 Oct 2012 20:33:03 +0000"  >&lt;p&gt;@Ted - which jira? That one&apos;s still open... I want to make sure my changes make sense.&lt;/p&gt;</comment>
                            <comment id="13468047" author="yuzhihong@gmail.com" created="Tue, 2 Oct 2012 20:38:48 +0000"  >&lt;p&gt;Pardon me. Looks like Stack entered wrong JIRA:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
r1393126 | stack | 2012-10-02 12:29:19 -0700 (Tue, 02 Oct 2012) | 1 line

HBASE-5699 Refactor HLog into an &lt;span class=&quot;code-keyword&quot;&gt;interface&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;What he integrated was &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5937&quot; title=&quot;Refactor HLog into an interface.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5937&quot;&gt;&lt;del&gt;HBASE-5937&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13468063" author="jesse_yates" created="Tue, 2 Oct 2012 20:53:42 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tedyu%40apache.org&quot; class=&quot;user-hover&quot; rel=&quot;tedyu@apache.org&quot;&gt;Ted Yu&lt;/a&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=stack&quot; class=&quot;user-hover&quot; rel=&quot;stack&quot;&gt;stack&lt;/a&gt; looks like stack accidentally rolled in the latest version of this patch with &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5937&quot; title=&quot;Refactor HLog into an interface.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5937&quot;&gt;&lt;del&gt;HBASE-5937&lt;/del&gt;&lt;/a&gt;. So feel free to test it Ted&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/help_16.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; since its in. We can always revert if not good. Only thing missing from the patch to trunk is removal of CheckedArchivingHFileCleaner.java&lt;/p&gt;</comment>
                            <comment id="13468136" author="stack" created="Tue, 2 Oct 2012 22:40:08 +0000"  >&lt;p&gt;I backed out hbase-6707 bits that made it in as part of an overcommit on &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5937&quot; title=&quot;Refactor HLog into an interface.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5937&quot;&gt;&lt;del&gt;HBASE-5937&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="13468139" author="stack" created="Tue, 2 Oct 2012 22:40:47 +0000"  >&lt;p&gt;Let me just commit this.  I tested it locally already so you don&apos;t have to Ted.&lt;/p&gt;</comment>
                            <comment id="13468140" author="stack" created="Tue, 2 Oct 2012 22:42:33 +0000"  >&lt;p&gt;Committed patch to trunk.  Thanks for the patch Jesse.  If we have to back it out again, I&apos;ll come looking for you.&lt;/p&gt;</comment>
                            <comment id="13468146" author="stack" created="Tue, 2 Oct 2012 22:49:46 +0000"  >&lt;blockquote&gt;&lt;p&gt;Committed patch to trunk....&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Ted, it looked to me like Jesse answered your question up in RB.&lt;/p&gt;</comment>
                            <comment id="13468176" author="hudson" created="Tue, 2 Oct 2012 23:29:57 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK #3409 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/3409/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/3409/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6707&quot; title=&quot;TEST org.apache.hadoop.hbase.backup.example.TestZooKeeperTableArchiveClient.testMultipleTables flaps&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6707&quot;&gt;&lt;del&gt;HBASE-6707&lt;/del&gt;&lt;/a&gt; TEST org.apache.hadoop.hbase.backup.example.TestZooKeeperTableArchiveClient.testMultipleTables flaps (Revision 1393222)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5937&quot; title=&quot;Refactor HLog into an interface.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5937&quot;&gt;&lt;del&gt;HBASE-5937&lt;/del&gt;&lt;/a&gt; Refactor HLog into an interface; REMOVE &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6707&quot; title=&quot;TEST org.apache.hadoop.hbase.backup.example.TestZooKeeperTableArchiveClient.testMultipleTables flaps&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6707&quot;&gt;&lt;del&gt;HBASE-6707&lt;/del&gt;&lt;/a&gt; POLLUTION/OVERCOMMIT (Revision 1393221)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
stack : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/backup/example/LongTermArchivingHFileCleaner.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/master/cleaner/CleanerChore.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/master/cleaner/HFileCleaner.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/util/HFileArchiveUtil.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/backup/example/TestZooKeeperTableArchiveClient.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/CheckedArchivingHFileCleaner.java&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;stack : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/backup/example/LongTermArchivingHFileCleaner.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/master/cleaner/CleanerChore.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/master/cleaner/HFileCleaner.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/util/HFileArchiveUtil.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/backup/example/TestZooKeeperTableArchiveClient.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13468181" author="hudson" created="Tue, 2 Oct 2012 23:33:42 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK-on-Hadoop-2.0.0 #204 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK-on-Hadoop-2.0.0/204/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK-on-Hadoop-2.0.0/204/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6707&quot; title=&quot;TEST org.apache.hadoop.hbase.backup.example.TestZooKeeperTableArchiveClient.testMultipleTables flaps&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6707&quot;&gt;&lt;del&gt;HBASE-6707&lt;/del&gt;&lt;/a&gt; TEST org.apache.hadoop.hbase.backup.example.TestZooKeeperTableArchiveClient.testMultipleTables flaps (Revision 1393222)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5937&quot; title=&quot;Refactor HLog into an interface.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5937&quot;&gt;&lt;del&gt;HBASE-5937&lt;/del&gt;&lt;/a&gt; Refactor HLog into an interface; REMOVE &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6707&quot; title=&quot;TEST org.apache.hadoop.hbase.backup.example.TestZooKeeperTableArchiveClient.testMultipleTables flaps&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6707&quot;&gt;&lt;del&gt;HBASE-6707&lt;/del&gt;&lt;/a&gt; POLLUTION/OVERCOMMIT (Revision 1393221)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
stack : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/backup/example/LongTermArchivingHFileCleaner.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/master/cleaner/CleanerChore.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/master/cleaner/HFileCleaner.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/util/HFileArchiveUtil.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/backup/example/TestZooKeeperTableArchiveClient.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/CheckedArchivingHFileCleaner.java&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;stack : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/backup/example/LongTermArchivingHFileCleaner.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/master/cleaner/CleanerChore.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/master/cleaner/HFileCleaner.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/util/HFileArchiveUtil.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/backup/example/TestZooKeeperTableArchiveClient.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13469038" author="jesse_yates" created="Thu, 4 Oct 2012 00:44:55 +0000"  >&lt;p&gt;nope, flapping again. Looks like we are getting closer. See errors in builds #2997 (&lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2997/testReport/org.apache.hadoop.hbase.backup.example/TestZooKeeperTableArchiveClient/testMultipleTables/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2997/testReport/org.apache.hadoop.hbase.backup.example/TestZooKeeperTableArchiveClient/testMultipleTables/&lt;/a&gt;) and #2995 (&lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2995/testReport/org.apache.hadoop.hbase.backup.example/TestZooKeeperTableArchiveClient/testMultipleTables/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2995/testReport/org.apache.hadoop.hbase.backup.example/TestZooKeeperTableArchiveClient/testMultipleTables/&lt;/a&gt;). I think we can fix it with an addendum though - give me a little bit (done today though).&lt;/p&gt;</comment>
                            <comment id="13469048" author="jesse_yates" created="Thu, 4 Oct 2012 01:04:14 +0000"  >&lt;p&gt;I miss counted the number of files looked at in the archiver, allowing the test to progress when it hasn&apos;t actually seen all the files, allowing the expected to get out of sync with the cleaner. Working on patch.&lt;/p&gt;</comment>
                            <comment id="13469057" author="jesse_yates" created="Thu, 4 Oct 2012 01:21:46 +0000"  >&lt;p&gt;Attaching addendum to:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;fix count of files to check via the cleaner (which correlates to when we continue the test and run checks on existing files)&lt;/li&gt;
	&lt;li&gt;adding more debug output&lt;/li&gt;
	&lt;li&gt;cleaning up impl of the longtermarchiver&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13469072" author="yuzhihong@gmail.com" created="Thu, 4 Oct 2012 01:46:44 +0000"  >&lt;p&gt;Reopen so that we can run addendum through QA.&lt;/p&gt;</comment>
                            <comment id="13469073" author="jesse_yates" created="Thu, 4 Oct 2012 01:47:22 +0000"  >&lt;p&gt;Ran patch 20x locally without seeing any weird output or failures.&lt;/p&gt;</comment>
                            <comment id="13469084" author="yuzhihong@gmail.com" created="Thu, 4 Oct 2012 02:03:50 +0000"  >&lt;p&gt;Can you clarify whether you were using jdk 1.6 or jdk 1.7 ?&lt;br/&gt;
I think both jdk should be used: 1.6 is used by Hadoop QA, 1.7 is used by trunk build.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+      &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; its a directory, then it can be deleted
&lt;/span&gt;+      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!fs.isFile(file)) &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
...
-      &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; its a directory with stuff in it, don&apos;t delete&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The above change deviates from original assumption. Please explain why a directory can be deleted regardless of whether it has files under it.&lt;/p&gt;</comment>
                            <comment id="13469094" author="stack" created="Thu, 4 Oct 2012 02:25:31 +0000"  >&lt;blockquote&gt;&lt;p&gt;I think both jdk should be used: 1.6 is used by Hadoop QA, 1.7 is used by trunk build.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;No.  What are you trying to do?  Stop all forward motion on the project by making up arbitrary rules for devs to follow?  If it passes hadoopqa, that is enough up to this. If you want hadoopqa to do both jdk6 and jdk7, that is another matter (and how about providing a patch).  Don&apos;t be putting friction on fellas.&lt;/p&gt;</comment>
                            <comment id="13469110" author="hadoopqa" created="Thu, 4 Oct 2012 03:09:48 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12547654/hbase-6707-v4-addendum.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12547654/hbase-6707-v4-addendum.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop2.0&lt;/font&gt;.  The patch compiles against the hadoop 2.0 profile.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 javadoc&lt;/font&gt;.  The javadoc tool appears to have generated 83 warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 findbugs&lt;/font&gt;.  The patch appears to introduce 5 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core tests&lt;/font&gt;.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.client.TestFromClientSideWithCoprocessor&lt;br/&gt;
                  org.apache.hadoop.hbase.master.TestSplitLogManager&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/3001//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/3001//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/3001//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/3001//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/3001//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/3001//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/3001//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/3001//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/3001//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/3001//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/3001//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/3001//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/3001//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/3001//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13469159" author="yuzhihong@gmail.com" created="Thu, 4 Oct 2012 05:13:06 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+    CountDownLatch finished = setupCleanerWatching(delegate, cleaners, files.size() + 3);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Why the addition of 3 above ?&lt;/p&gt;</comment>
                            <comment id="13469183" author="jesse_yates" created="Thu, 4 Oct 2012 06:13:05 +0000"  >&lt;blockquote&gt;&lt;p&gt;If it passes hadoopqa, that is enough up to this. &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I think that&apos;s reasonable. If we want to support both 1.6 and 1.7 that should be part of the official test process. Wanna file a ticket Ted?&lt;/p&gt;</comment>
                            <comment id="13469194" author="jesse_yates" created="Thu, 4 Oct 2012 06:50:26 +0000"  >&lt;blockquote&gt;&lt;p&gt;Why the addition of 3 above ?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;So it checks each of the directories on the way down - tablename/region/family - hence the plus three. &lt;/p&gt;

&lt;p&gt;The way CleanerChore works is that it looks at the main directory, and then if it has files under it, attempts to see if those files are deleteable. If they aren&apos;t deletable, it skips checking the directory and continues on to the next directory to check. If all the files are deletable, then if checks to see if the directory is deletable.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;The above change deviates from original assumption. Please explain why a directory can be deleted regardless of whether it has files under it.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Therefore, we can always consider directories deletable because there is nothing special about a directory, but only the files under the directory. Perhaps that was a flaw in the design, but we should file another ticket to change that behavior such that we only check for files and delete directories when there are no files for that directory.&lt;/p&gt;

&lt;p&gt;Further note, for the original quote, that we need only have +3 for the non-archived table&apos;s directories, but not an extra +3 (which would make a total of +6) for the archived table because we don&apos;t attempt to delete the directory containing hfiles that are retained.&lt;/p&gt;</comment>
                            <comment id="13469227" author="yuzhihong@gmail.com" created="Thu, 4 Oct 2012 08:53:10 +0000"  >&lt;blockquote&gt;&lt;p&gt;If we want to support both 1.6 and 1.7 that should be part of the official test process. Wanna file a ticket Ted?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Done. I logged &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6944&quot; title=&quot;Enhance test-patch.sh to run against both jdk 1.6 and jdk 1.7&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6944&quot;&gt;&lt;del&gt;HBASE-6944&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Perhaps that was a flaw in the design, but we should file another ticket to change that behavior such that we only check for files and delete directories when there are no files for that directory.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Want to file a ticket Jesse ?&lt;/p&gt;</comment>
                            <comment id="13469597" author="jesse_yates" created="Thu, 4 Oct 2012 18:53:27 +0000"  >&lt;blockquote&gt;&lt;p&gt;only check for files and delete directories when there are no files for that directory.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Done - &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6949&quot; title=&quot;Automatically delete empty directories in CleanerChore&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6949&quot;&gt;&lt;del&gt;HBASE-6949&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Are we happy with the latest addendum?&lt;/p&gt;</comment>
                            <comment id="13469645" author="zhihyu@ebaysf.com" created="Thu, 4 Oct 2012 20:15:29 +0000"  >&lt;p&gt;I think this hunk is not needed:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
@@ -50,16 +50,14 @@ &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; class LongTermArchivingHFileCleaner &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; BaseHFileCleanerDelegate {
   @Override
   &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; isFileDeletable(Path file) {
     &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
+      &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; its a directory, then it can be deleted
&lt;/span&gt;+      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!fs.isFile(file)) &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;

+      &lt;span class=&quot;code-comment&quot;&gt;// check to see &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;
&lt;/span&gt;       FileStatus[] deleteStatus = FSUtils.listStatus(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.fs, file, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;);
       &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; the file doesn&apos;t exist, then it can be deleted (but should never
&lt;/span&gt;       &lt;span class=&quot;code-comment&quot;&gt;// happen since deleted files shouldn&apos;t get passed in)
&lt;/span&gt;       &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (deleteStatus == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
-      &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; its a directory with stuff in it, don&apos;t delete
&lt;/span&gt;-      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (deleteStatus.length &amp;gt; 1) &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
-
-      &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; its an empty directory, we can definitely delete
&lt;/span&gt;-      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (deleteStatus[0].isDir()) &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;

       &lt;span class=&quot;code-comment&quot;&gt;// otherwise, we need to check the file&apos;s table and see its being archived
&lt;/span&gt;       Path family = file.getParent();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I placed breakpoint on the following line in the debugger:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!fs.isFile(file)) &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;file turned out to be empty every time when it was a directory.&lt;/p&gt;

&lt;p&gt;Without the above hunk, test still passed in a loop (on jdk 1.7).&lt;/p&gt;</comment>
                            <comment id="13469665" author="jesse_yates" created="Thu, 4 Oct 2012 20:40:29 +0000"  >&lt;blockquote&gt;&lt;p&gt;file turned out to be empty every time when it was a directory.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;What do you mean by this? What are you proposing the method should look like? The intention was to always delete directories (which can later be removed by &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6949&quot; title=&quot;Automatically delete empty directories in CleanerChore&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6949&quot;&gt;&lt;del&gt;HBASE-6949&lt;/del&gt;&lt;/a&gt;), but that it does need to check if the table for those hfiles is being archived.&lt;/p&gt;</comment>
                            <comment id="13469675" author="zhihyu@ebaysf.com" created="Thu, 4 Oct 2012 20:50:20 +0000"  >&lt;p&gt;If the first hunk is needed by &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6949&quot; title=&quot;Automatically delete empty directories in CleanerChore&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6949&quot;&gt;&lt;del&gt;HBASE-6949&lt;/del&gt;&lt;/a&gt;, it can go into that patch.&lt;/p&gt;

&lt;p&gt;I tried the addendum with and without the first hunk and the test failed on jdk 1.6 at the same spot:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
testMultipleTables(org.apache.hadoop.hbase.backup.example.TestZooKeeperTableArchiveClient)  Time elapsed: 1.207 sec  &amp;lt;&amp;lt;&amp;lt; ERROR!
java.lang.NullPointerException
  at org.apache.hadoop.hbase.backup.example.TestZooKeeperTableArchiveClient.testMultipleTables(TestZooKeeperTableArchiveClient.java:259)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I can provide test output if you need it.&lt;/p&gt;</comment>
                            <comment id="13469683" author="jesse_yates" created="Thu, 4 Oct 2012 20:55:18 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tedyu%40apache.org&quot; class=&quot;user-hover&quot; rel=&quot;tedyu@apache.org&quot;&gt;Ted Yu&lt;/a&gt; what do you mean by first and second hunk? Can you please provide the code? Thanks!&lt;/p&gt;</comment>
                            <comment id="13469691" author="zhihyu@ebaysf.com" created="Thu, 4 Oct 2012 21:01:32 +0000"  >&lt;p&gt;The first hunk is from line 5 to line 24 in the addendum.&lt;/p&gt;

&lt;p&gt;I didn&apos;t mention second hunk.&lt;/p&gt;</comment>
                            <comment id="13469706" author="zhihyu@ebaysf.com" created="Thu, 4 Oct 2012 21:11:23 +0000"  >&lt;p&gt;6707-v4-addendum.txt is my version of addendum.&lt;/p&gt;</comment>
                            <comment id="13469724" author="jesse_yates" created="Thu, 4 Oct 2012 21:23:21 +0000"  >&lt;blockquote&gt;&lt;p&gt;If the first hunk is needed by &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6949&quot; title=&quot;Automatically delete empty directories in CleanerChore&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6949&quot;&gt;&lt;del&gt;HBASE-6949&lt;/del&gt;&lt;/a&gt;, it can go into that patch.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;That can be removed in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6949&quot; title=&quot;Automatically delete empty directories in CleanerChore&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6949&quot;&gt;&lt;del&gt;HBASE-6949&lt;/del&gt;&lt;/a&gt; - it just depends on which order things are applied.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I didn&apos;t mention second hunk.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Oops.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I tried the addendum with and without the first hunk and the test failed on jdk 1.6 at the same spot:&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I&apos;m trying the test on jdk 1.6 with the first hunk applied (and not) and its working fine. &lt;/p&gt;

&lt;p&gt;Your comment above would imply that the test isn&apos;t working either way, so your patch would then not be correct, unless I&apos;m missing something? &lt;/p&gt;

</comment>
                            <comment id="13469727" author="zhihyu@ebaysf.com" created="Thu, 4 Oct 2012 21:28:46 +0000"  >&lt;p&gt;My addendum fixes NullPointerException.&lt;br/&gt;
But it failed again on jdk 1.6 with:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
testMultipleTables(org.apache.hadoop.hbase.backup.example.TestZooKeeperTableArchiveClient)  Time elapsed: 1.186 sec  &amp;lt;&amp;lt;&amp;lt; FAILURE!
java.lang.AssertionError: Not all archived files &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; the primary table were retained. expected:&amp;lt;2&amp;gt; but was:&amp;lt;0&amp;gt;
  at org.junit.Assert.fail(Assert.java:93)
  at org.junit.Assert.failNotEquals(Assert.java:647)
  at org.junit.Assert.assertEquals(Assert.java:128)
  at org.junit.Assert.assertEquals(Assert.java:472)
  at org.apache.hadoop.hbase.backup.example.TestZooKeeperTableArchiveClient.testMultipleTables(TestZooKeeperTableArchiveClient.java:266)&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;On jdk 1.7 I didn&apos;t see test failure.&lt;/p&gt;</comment>
                            <comment id="13469737" author="zhihyu@ebaysf.com" created="Thu, 4 Oct 2012 21:33:27 +0000"  >&lt;p&gt;I tried with the first hunk applied (and not) on jdk 1.6, same error.&lt;br/&gt;
The test output is for the test run without first hunk.&lt;/p&gt;</comment>
                            <comment id="13469744" author="hadoopqa" created="Thu, 4 Oct 2012 21:38:42 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12547830/testZooKeeperTableArchiveClient-output.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12547830/testZooKeeperTableArchiveClient-output.txt&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 149 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 patch&lt;/font&gt;.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/3007//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/3007//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13469752" author="hadoopqa" created="Thu, 4 Oct 2012 21:43:52 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12547825/6707-v4-addendum.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12547825/6707-v4-addendum.txt&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop2.0&lt;/font&gt;.  The patch compiles against the hadoop 2.0 profile.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 javadoc&lt;/font&gt;.  The javadoc tool appears to have generated 81 warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 findbugs&lt;/font&gt;.  The patch appears to introduce 5 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core tests&lt;/font&gt;.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.regionserver.TestColumnSeeking&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/3006//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/3006//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/3006//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/3006//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/3006//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/3006//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/3006//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/3006//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/3006//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/3006//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/3006//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/3006//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/3006//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/3006//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13469820" author="jesse_yates" created="Thu, 4 Oct 2012 23:15:08 +0000"  >&lt;p&gt;Hmmm, I think part of this complexity is due to how the cleaner chore is handling directories. We should consider doing  &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6949&quot; title=&quot;Automatically delete empty directories in CleanerChore&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6949&quot;&gt;&lt;del&gt;HBASE-6949&lt;/del&gt;&lt;/a&gt; before the addendum. Then the LongTermHFileArchiver becomes really simple and easy to verify.&lt;/p&gt;

&lt;p&gt;I&apos;m surprised that the Ted&apos;s addendum fixed the failure - the chore already handles deleting directories so the logic should always preserve the directory, Line 224  - CleanerChore:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
(!&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.fs.delete(filePath, &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;)) 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;even if it has files in it. &lt;/p&gt;</comment>
                            <comment id="13484364" author="jesse_yates" created="Thu, 25 Oct 2012 18:45:27 +0000"  >&lt;p&gt;With the recent changes to trunk (&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6949&quot; title=&quot;Automatically delete empty directories in CleanerChore&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6949&quot;&gt;&lt;del&gt;HBASE-6949&lt;/del&gt;&lt;/a&gt;) my earlier addendum (v4-addenum.patch) has become correct since the cleaner the always removes directories now. The extra check is a precaution, but (1) should never be used and (2) doesn&apos;t affect correctness even if it somehow does get passed.&lt;/p&gt;</comment>
                            <comment id="13485180" author="stack" created="Fri, 26 Oct 2012 20:28:59 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jesse_yates&quot; class=&quot;user-hover&quot; rel=&quot;jesse_yates&quot;&gt;Jesse Yates&lt;/a&gt; So what to do here now Jesse to resolve the issue?&lt;/p&gt;</comment>
                            <comment id="13485687" author="jesse_yates" created="Sun, 28 Oct 2012 18:54:34 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=stack&quot; class=&quot;user-hover&quot; rel=&quot;stack&quot;&gt;stack&lt;/a&gt; i&apos;d say commit v4-addendum.patch. &lt;/p&gt;</comment>
                            <comment id="13485724" author="stack" created="Sun, 28 Oct 2012 21:50:00 +0000"  >&lt;p&gt;Committed v4.  Lets see how it does.&lt;/p&gt;</comment>
                            <comment id="13485739" author="hudson" created="Sun, 28 Oct 2012 23:06:09 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK #3494 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/3494/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/3494/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6707&quot; title=&quot;TEST org.apache.hadoop.hbase.backup.example.TestZooKeeperTableArchiveClient.testMultipleTables flaps&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6707&quot;&gt;&lt;del&gt;HBASE-6707&lt;/del&gt;&lt;/a&gt; TEST org.apache.hadoop.hbase.backup.example.TestZooKeeperTableArchiveClient.testMultipleTables flaps; ADDENDUM v4 (Revision 1403098)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
stack : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/backup/example/LongTermArchivingHFileCleaner.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13485757" author="hudson" created="Mon, 29 Oct 2012 00:10:43 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK-on-Hadoop-2.0.0 #243 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK-on-Hadoop-2.0.0/243/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK-on-Hadoop-2.0.0/243/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6707&quot; title=&quot;TEST org.apache.hadoop.hbase.backup.example.TestZooKeeperTableArchiveClient.testMultipleTables flaps&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6707&quot;&gt;&lt;del&gt;HBASE-6707&lt;/del&gt;&lt;/a&gt; TEST org.apache.hadoop.hbase.backup.example.TestZooKeeperTableArchiveClient.testMultipleTables flaps; ADDENDUM v4 (Revision 1403098)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
stack : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/backup/example/LongTermArchivingHFileCleaner.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13485760" author="jesse_yates" created="Mon, 29 Oct 2012 00:12:49 +0000"  >&lt;p&gt;Well, at least it didn&apos;t fail immediately. (cross-fingers and knocks on wood).&lt;/p&gt;</comment>
                            <comment id="13486500" author="hudson" created="Mon, 29 Oct 2012 23:35:33 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK #3496 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/3496/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/3496/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6707&quot; title=&quot;TEST org.apache.hadoop.hbase.backup.example.TestZooKeeperTableArchiveClient.testMultipleTables flaps&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6707&quot;&gt;&lt;del&gt;HBASE-6707&lt;/del&gt;&lt;/a&gt; TEST org.apache.hadoop.hbase.backup.example.TestZooKeeperTableArchiveClient.testMultipleTables flaps; ADDENDUM v4 &amp;#8211; I FORGOT THIS BIT (Revision 1403539)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
stack : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/backup/example/TestZooKeeperTableArchiveClient.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13486578" author="hudson" created="Tue, 30 Oct 2012 01:12:26 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK-on-Hadoop-2.0.0 #244 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK-on-Hadoop-2.0.0/244/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK-on-Hadoop-2.0.0/244/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6707&quot; title=&quot;TEST org.apache.hadoop.hbase.backup.example.TestZooKeeperTableArchiveClient.testMultipleTables flaps&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6707&quot;&gt;&lt;del&gt;HBASE-6707&lt;/del&gt;&lt;/a&gt; TEST org.apache.hadoop.hbase.backup.example.TestZooKeeperTableArchiveClient.testMultipleTables flaps; ADDENDUM v4 &amp;#8211; I FORGOT THIS BIT (Revision 1403539)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
stack : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/backup/example/TestZooKeeperTableArchiveClient.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13509412" author="jesse_yates" created="Tue, 4 Dec 2012 01:25:42 +0000"  >&lt;p&gt;Stack committed this to trunk and the backport was also successful on its own ticket.&lt;/p&gt;</comment>
                            <comment id="13775241" author="stack" created="Mon, 23 Sep 2013 18:31:04 +0000"  >&lt;p&gt;Marking closed.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12605443">HBASE-6690</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12607749">HBASE-6796</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12547825" name="6707-v4-addendum.txt" size="3178" author="zhihyu@ebaysf.com" created="Thu, 4 Oct 2012 21:11:23 +0000"/>
                            <attachment id="12543952" name="hbase-6707-v0.patch" size="22273" author="jesse_yates" created="Thu, 6 Sep 2012 00:44:49 +0000"/>
                            <attachment id="12544304" name="hbase-6707-v1.patch" size="22457" author="jesse_yates" created="Fri, 7 Sep 2012 21:54:09 +0000"/>
                            <attachment id="12546945" name="hbase-6707-v2.patch" size="43347" author="jesse_yates" created="Fri, 28 Sep 2012 02:10:39 +0000"/>
                            <attachment id="12547054" name="hbase-6707-v3.patch" size="31067" author="jesse_yates" created="Fri, 28 Sep 2012 21:53:00 +0000"/>
                            <attachment id="12547654" name="hbase-6707-v4-addendum.patch" size="4364" author="jesse_yates" created="Thu, 4 Oct 2012 01:21:46 +0000"/>
                            <attachment id="12547314" name="hbase-6707-v4.patch" size="30788" author="jesse_yates" created="Mon, 1 Oct 2012 23:43:30 +0000"/>
                            <attachment id="12547830" name="testZooKeeperTableArchiveClient-output.txt" size="80185" author="zhihyu@ebaysf.com" created="Thu, 4 Oct 2012 21:33:27 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>8.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 31 Aug 2012 21:21:29 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>239538</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 10 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i00r1z:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2315</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310230" key="com.atlassian.jira.plugin.system.customfieldtypes:textfield">
                        <customfieldname>Tags</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>flapper test cleanup</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>