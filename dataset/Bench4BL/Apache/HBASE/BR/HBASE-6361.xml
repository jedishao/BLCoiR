<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sat Dec 03 15:42:46 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-6361/HBASE-6361.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-6361] Change the compaction queue to a round robin scheduler</title>
                <link>https://issues.apache.org/jira/browse/HBASE-6361</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Currently the compaction requests are submitted to the minor/major compaction queue of a region-server from every column-family/region belonging to it. The requests are processed from the queue in FIFO order (First in First out). We want to make a lazy scheduler in place of the current queue-based one. The idea of lazy scheduling is that, it is always better to make a decision (compaction selection) later if the decision is relevant later only. Presently, when the queue gets bottle-necked, there is a delay between compaction selection of a request and its execution. Rather than that, we can postpone the compaction selection until the queue is empty when we will have more information and choices (new flush files will have arrived by then) to make a better decision.&lt;/p&gt;

&lt;p&gt;Removing the queue, we propose to implement a round-robin scheduler. All the column families in their regions will be visited in sequence periodically. In each visit, if the column family generates a valid compaction request, the request is executed before moving to the next one. We do not plan to change the current compaction algorithm for now. We expect that it will automatically make a better decision when doing just-in-time selection due to the new change. How do we know that? Let us consider an example.&lt;/p&gt;

&lt;p&gt;Suppose there is a short term bottleneck in the queue so that it is blocked for a period of time. (Let the min-files for compaction = 4). For an active column-family, when new flushes are written, new compaction requests, each of size 4, will be added to the queue continuously until the queue starts processing them.&lt;/p&gt;

&lt;p&gt;Now consider a round-robin scheduler. The effect of a bottle-neck due to the IO rate of compaction results in a longer latency to visit the same column family again. When the same active column family is visited following a long delay, suppose 16 new flush files have been written there. The compaction selection algorithm will select one compaction request of size 16, as opposed to 4 compaction requests of size 4 that would have been generated in the previous case.&lt;/p&gt;

&lt;p&gt;A compaction request with 16 flush files is more IOPs-efficient than the same set of files being compacted 4 at a time. This is because both consume the same total amount of reads and writes while producing a file of size 16 compared to 4 files of size 4. So, in the second case, we obtained a free compaction 4*4-&amp;gt;16 without paying for it. In case of the queue, those smaller 4 sized files would have consumed more IOPs to become bigger later.&lt;/p&gt;

&lt;p&gt;On my simulator, I did some experiments on how a bottle-neck of the queue affects the compaction selections in the current system. It appears that, a filled up queue actually makes all future compaction selections less and less efficient in terms of IOPs, resulting in a runway positive feedback loop which can potentially explode the compaction queue. (This was also observed in production recently). The main effect of this change should be to deal with bursty loads. When a bottleneck occurs, the compaction selection will become more IOPs-efficient rather than less efficient, resulting in negative feedback and restoration to stability more easily. As for monitoring, the compaction queue size will not be present as a metric. However, the number of files in each compaction will indicate if a bottleneck has occurred.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12598117">HBASE-6361</key>
            <summary>Change the compaction queue to a round robin scheduler</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="3">Duplicate</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="akashnil07">Akashnil</reporter>
                        <labels>
                    </labels>
                <created>Tue, 10 Jul 2012 00:55:58 +0000</created>
                <updated>Wed, 11 Jul 2012 18:11:29 +0000</updated>
                            <resolved>Wed, 11 Jul 2012 18:11:29 +0000</resolved>
                                                                        <due></due>
                            <votes>0</votes>
                                    <watches>19</watches>
                                                                <comments>
                            <comment id="13410696" author="mcorgan" created="Tue, 10 Jul 2012 18:52:45 +0000"  >&lt;p&gt;adding link to &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5479&quot; title=&quot;Postpone CompactionSelection to compaction execution time&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5479&quot;&gt;&lt;del&gt;HBASE-5479&lt;/del&gt;&lt;/a&gt; since i think this is the same problem.  Keith Turner from Accumulo project describes how they time compaction file selection.&lt;/p&gt;</comment>
                            <comment id="13411797" author="mikhail" created="Wed, 11 Jul 2012 18:11:29 +0000"  >&lt;p&gt;This is a duplicate of &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5479&quot; title=&quot;Postpone CompactionSelection to compaction execution time&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5479&quot;&gt;&lt;del&gt;HBASE-5479&lt;/del&gt;&lt;/a&gt;. Confirmed with Akashnil that it&apos;s OK to close this.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12544149">HBASE-5479</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 10 Jul 2012 18:52:45 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>256593</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 21 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0huvj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>102264</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>