<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 02 18:53:21 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-868/HBASE-868.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-868] Incrementing binary rows cause strange behavior once table splits</title>
                <link>https://issues.apache.org/jira/browse/HBASE-868</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;We&apos;re now using incrementing binary row keys and to this point had only been doing small tests with them, never having actually had a table split.&lt;/p&gt;

&lt;p&gt;I&apos;m still working through the logs but it seems that there&apos;s a problem somewhere with startKey and endKeys.&lt;/p&gt;

&lt;p&gt;Binary in general is not well supported (inconsistent in display in the logs, very odd rendering in the web ui, hard to interpret in the shell, etc..)  Once we figure out these serious bugs we will spend some time trying to clean that up.  But right now this makes things even harder to debug.&lt;/p&gt;

&lt;p&gt;The actual symptoms are that my import eventually started to throw (in the client and on the region server):&lt;/p&gt;

&lt;p&gt;org.apache.hadoop.hbase.regionserver.WrongRegionException: org.apache.hadoop.hbase.regionserver.WrongRegionException: Requested row out of range for HRegion sources,,1220546297947, startKey=&apos;&apos;, getEndKey()=&apos;&lt;br/&gt;
&#239;&#191;&#189;&apos;, row=&apos;c&#239;&#191;&#189;&apos;&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.HRegion.checkRow(HRegion.java:1775)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.HRegion.obtainRowLock(HRegion.java:1831)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.HRegion.batchUpdate(HRegion.java:1387)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.HRegionServer.batchUpdate(HRegionServer.java:1145)&lt;br/&gt;
        at sun.reflect.GeneratedMethodAccessor5.invoke(Unknown Source)&lt;br/&gt;
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)&lt;br/&gt;
        at java.lang.reflect.Method.invoke(Method.java:616)&lt;br/&gt;
        at org.apache.hadoop.hbase.ipc.HbaseRPC$Server.call(HbaseRPC.java:473)&lt;br/&gt;
        at org.apache.hadoop.ipc.Server$Handler.run(Server.java:888)&lt;/p&gt;


&lt;p&gt;There are 3 regionservers, but this error only happens on one of them (while the other two always continue normally, allowing updates to this same table).&lt;/p&gt;

&lt;p&gt;The regionserver that this happens on is special for two reasons, one it is hosting the META table.  And secondly it also hosts the first region in the table, startkey = &apos;&apos;.  I&apos;m unsure which is the cause, I have a clue leading to both.&lt;/p&gt;

&lt;p&gt;After about 15 minutes, the regionserver sees:&lt;/p&gt;

&lt;p&gt;2008-09-04 09:52:57,948 DEBUG org.apache.hadoop.hbase.regionserver.HRegion: Started memcache flush for region .META.,,1. Current region memcache size 24.5k&lt;br/&gt;
2008-09-04 09:52:58,003 DEBUG org.apache.hadoop.hbase.regionserver.HStore: Added /hbase/.META./1028785192/historian/mapfiles/8699673838203663799 with 106 entries, sequence id 25341510, data size 8.9k, file size 10.6k&lt;br/&gt;
2008-09-04 09:52:58,050 DEBUG org.apache.hadoop.hbase.regionserver.HStore: Added /hbase/.META./1028785192/info/mapfiles/1791564557665476834 with 96 entries, sequence id 25341510, data size 14.2k, file size 15.8k&lt;br/&gt;
2008-09-04 09:52:58,050 DEBUG org.apache.hadoop.hbase.regionserver.HRegion: Finished memcache flush for region .META.,,1 in 102ms, sequence id=25341510, compaction requested=true&lt;br/&gt;
2008-09-04 09:52:58,050 DEBUG org.apache.hadoop.hbase.regionserver.CompactSplitThread: Compaction requested for region: .META.,,1&lt;br/&gt;
2008-09-04 09:52:58,051 INFO org.apache.hadoop.hbase.regionserver.HRegion: starting compaction on region .META.,,1&lt;br/&gt;
2008-09-04 09:52:58,055 DEBUG org.apache.hadoop.hbase.regionserver.HStore: Compaction size of 1028785192/historian: 41.9k; Skipped 1 files , size: 21957&lt;br/&gt;
2008-09-04 09:52:58,088 DEBUG org.apache.hadoop.hbase.regionserver.HStore: started compaction of 2 files into /hbase/.META./compaction.dir/1028785192/historian/mapfiles/6948796056606699674&lt;br/&gt;
2008-09-04 09:52:58,128 DEBUG org.apache.hadoop.hbase.regionserver.HStore: moving /hbase/.META./compaction.dir/1028785192/historian/mapfiles/6948796056606699674 to /hbase/.META./1028785192/historian/mapfiles/75733875840914142&lt;br/&gt;
2008-09-04 09:52:58,175 DEBUG org.apache.hadoop.hbase.regionserver.HStore: Completed compaction of 1028785192/historian store size is 41.1k; time since last major compaction: 5426 seconds&lt;br/&gt;
2008-09-04 09:52:58,179 DEBUG org.apache.hadoop.hbase.regionserver.HStore: Compaction size of 1028785192/info: 61.9k; Skipped 0 files , size: 0&lt;br/&gt;
2008-09-04 09:52:58,192 DEBUG org.apache.hadoop.hbase.regionserver.HStore: started compaction of 3 files into /hbase/.META./compaction.dir/1028785192/info/mapfiles/7781013568996125923&lt;br/&gt;
2008-09-04 09:52:58,260 DEBUG org.apache.hadoop.hbase.regionserver.HStore: moving /hbase/.META./compaction.dir/1028785192/info/mapfiles/7781013568996125923 to /hbase/.META./1028785192/info/mapfiles/2187291308709057119&lt;br/&gt;
2008-09-04 09:52:58,290 DEBUG org.apache.hadoop.hbase.regionserver.HStore: Completed compaction of 1028785192/info store size is 61.0k; time since last major compaction: 32534 seconds&lt;br/&gt;
2008-09-04 09:52:58,296 INFO org.apache.hadoop.hbase.regionserver.HRegion: compaction completed on region .META.,,1 in 0sec&lt;br/&gt;
2008-09-04 09:53:09,620 INFO org.apache.hadoop.hbase.regionserver.HRegionServer: Scanner -2085474968086468199 lease expired&lt;br/&gt;
2008-09-04 09:54:35,449 INFO org.apache.hadoop.hbase.regionserver.LogRoller: Rolling hlog. Number of entries: 30009&lt;/p&gt;


&lt;p&gt;Following this, insertion continues normally.  This leads me to believe there&apos;s an issue with the META table memcache, but oddly the other regions of this table on other regionservers continue on fine.&lt;/p&gt;

&lt;p&gt;As for the hosting the first region of the table on this region server, it seems to be consistent that I get the row out of range errors when looking for a region with startkey = &apos;&apos;, although there are 5 other regions on this RS.&lt;/p&gt;

&lt;p&gt;Will attach full logs from master and three RS.  Also a couple screenshots showing weird behavior in listing the regions in the table.&lt;/p&gt;</description>
                <environment>&lt;p&gt;4 nodes: 1 master/namenode, 3 regionserver/datanodes&lt;/p&gt;</environment>
        <key id="12403692">HBASE-868</key>
            <summary>Incrementing binary rows cause strange behavior once table splits</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.png">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="streamy">Jonathan Gray</assignee>
                                    <reporter username="streamy">Jonathan Gray</reporter>
                        <labels>
                    </labels>
                <created>Thu, 4 Sep 2008 17:08:45 +0000</created>
                <updated>Sat, 13 Sep 2008 23:22:48 +0000</updated>
                            <resolved>Mon, 8 Sep 2008 17:17:22 +0000</resolved>
                                    <version>0.2.1</version>
                    <version>0.18.0</version>
                                    <fixVersion>0.2.1</fixVersion>
                    <fixVersion>0.18.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12628402" author="streamy" created="Thu, 4 Sep 2008 17:48:22 +0000"  >&lt;p&gt;This is the region hosting META, the first region in the sources table, and the one that throws the exceptions row not in region.&lt;/p&gt;</comment>
                            <comment id="12628409" author="jdcryans" created="Thu, 4 Sep 2008 17:55:40 +0000"  >&lt;p&gt;I left those three Bytes.compareTo in Memcache thinking it was not going to cause problems. Well maybe it is. Let&apos;s see with Jonathan.&lt;/p&gt;</comment>
                            <comment id="12628415" author="streamy" created="Thu, 4 Sep 2008 18:06:37 +0000"  >&lt;p&gt;Shows odd behavior in web ui&lt;/p&gt;</comment>
                            <comment id="12628542" author="streamy" created="Fri, 5 Sep 2008 04:00:14 +0000"  >&lt;p&gt;One note, I accidentally brought up a clean hdfs on hbase 0.2.1 rc1 and including all the patches I made with JD today.  First insert to a table immediately caused:&lt;/p&gt;

&lt;p&gt;Exception in thread &quot;main&quot; java.io.IOException: java.io.IOException: java.io.IOException: java.lang.                                                                                               NegativeArraySizeException&lt;br/&gt;
        at org.apache.hadoop.hbase.HStoreKey.stripStartKeyMeta(HStoreKey.java:532)&lt;br/&gt;
        at org.apache.hadoop.hbase.HStoreKey.compareTwoRowKeys(HStoreKey.java:494)&lt;/p&gt;


&lt;p&gt;This does not happen on 0.2.1 rc1 without our patches.  I&apos;m to do plenty of inserting of whatever until I reach a split.  Once it finishes splitting, the next request immediately starts receiving:&lt;/p&gt;

&lt;p&gt; org.apache.hadoop.hbase.regionserver.WrongRegionException: Requested row out of range&lt;/p&gt;</comment>
                            <comment id="12628828" author="streamy" created="Sat, 6 Sep 2008 03:22:09 +0000"  >&lt;p&gt;Using this patch, I don&apos;t see any of the added debug output anywhere.&lt;/p&gt;

&lt;p&gt;Here is where it breaks.  During the first memcache flush of META, Flusher says Replay of hlog required and then DroppedSnapshot/Key out of order exceptions:&lt;/p&gt;

&lt;p&gt;2008-09-05 19:09:12,202 INFO org.apache.hadoop.hbase.regionserver.LogRoller: Rolling hlog. Number of entries: 30001&lt;br/&gt;
2008-09-05 19:09:12,215 DEBUG org.apache.hadoop.hbase.regionserver.HLog: Closing current log writer /hbase/log_72.34.249.110_1220665441919_60020/hlog.dat.1220666931124&lt;br/&gt;
2008-09-05 19:09:12,218 INFO org.apache.hadoop.hbase.regionserver.HLog: New log writer created at /hbase/log_72.34.249.110_1220665441919_60020/hlog.dat.1220666952215&lt;br/&gt;
2008-09-05 19:14:02,219 INFO org.apache.hadoop.hbase.regionserver.LogRoller: Rolling hlog. Number of entries: 14234&lt;br/&gt;
2008-09-05 19:14:02,230 DEBUG org.apache.hadoop.hbase.regionserver.HLog: Closing current log writer /hbase/log_72.34.249.110_1220665441919_60020/hlog.dat.1220666941412&lt;br/&gt;
2008-09-05 19:14:02,233 INFO org.apache.hadoop.hbase.regionserver.HLog: New log writer created at /hbase/log_72.34.249.110_1220665441919_60020/hlog.dat.1220667242230&lt;br/&gt;
2008-09-05 19:14:22,342 DEBUG org.apache.hadoop.hbase.regionserver.HRegion: Started memcache flush for region .META.,,1. Current region memcache size 23.6k&lt;br/&gt;
2008-09-05 19:14:22,362 INFO org.apache.hadoop.util.NativeCodeLoader: Loaded the native-hadoop library&lt;br/&gt;
2008-09-05 19:14:22,363 INFO org.apache.hadoop.io.compress.zlib.ZlibFactory: Successfully loaded &amp;amp; initialized native-zlib library&lt;br/&gt;
2008-09-05 19:14:22,364 INFO org.apache.hadoop.io.compress.CodecPool: Got brand-new compressor&lt;br/&gt;
2008-09-05 19:14:22,392 FATAL org.apache.hadoop.hbase.regionserver.Flusher: Replay of hlog required. Forcing server restart&lt;br/&gt;
org.apache.hadoop.hbase.DroppedSnapshotException: region: .META.,,1&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.HRegion.internalFlushcache(HRegion.java:1081)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.HRegion.flushcache(HRegion.java:979)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.Flusher.flushRegion(Flusher.java:174)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.Flusher.run(Flusher.java:91)&lt;br/&gt;
Caused by: java.io.IOException: key out of order: items,1220665885921/historian:assignment/1220665888554 after items,,1220665885921/historian:split/1220665886459&lt;br/&gt;
        at org.apache.hadoop.io.MapFile$Writer.checkKey(MapFile.java:205)&lt;br/&gt;
        at org.apache.hadoop.io.MapFile$Writer.append(MapFile.java:191)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.HStoreFile$BloomFilterMapFile$Writer.append(HStoreFile.java:846)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.HStore.internalFlushCache(HStore.java:625)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.HStore.flushCache(HStore.java:578)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.HRegion.internalFlushcache(HRegion.java:1068)&lt;br/&gt;
        ... 3 more&lt;br/&gt;
2008-09-05 19:14:22,393 INFO org.apache.hadoop.hbase.regionserver.Flusher: regionserver/0:0:0:0:0:0:0:0:60020.cacheFlusher exiting&lt;br/&gt;
2008-09-05 19:14:24,583 DEBUG org.apache.hadoop.hbase.RegionHistorian: Offlined&lt;br/&gt;
2008-09-05 19:14:24,583 INFO org.apache.hadoop.ipc.Server: Stopping server on 60020&lt;br/&gt;
2008-09-05 19:14:24,583 INFO org.apache.hadoop.ipc.Server: IPC Server handler 0 on 60020: exiting&lt;br/&gt;
2008-09-05 19:14:24,584 INFO org.apache.hadoop.ipc.Server: IPC Server handler 2 on 60020: exiting&lt;br/&gt;
2008-09-05 19:14:24,584 INFO org.apache.hadoop.ipc.Server: Stopping IPC Server listener on 60020&lt;br/&gt;
2008-09-05 19:14:24,584 INFO org.apache.hadoop.hbase.regionserver.HRegionServer: Stopping infoServer&lt;br/&gt;
2008-09-05 19:14:24,584 INFO org.mortbay.util.ThreadedServer: Stopping Acceptor ServerSocket&lt;span class=&quot;error&quot;&gt;&amp;#91;addr=0.0.0.0/0.0.0.0,port=0,localport=60030&amp;#93;&lt;/span&gt;&lt;br/&gt;
2008-09-05 19:14:24,584 INFO org.apache.hadoop.ipc.Server: IPC Server handler 1 on 60020: exiting&lt;br/&gt;
2008-09-05 19:14:24,584 INFO org.apache.hadoop.ipc.Server: IPC Server handler 6 on 60020: exiting&lt;br/&gt;
2008-09-05 19:14:24,584 INFO org.apache.hadoop.ipc.Server: IPC Server handler 3 on 60020: exiting&lt;br/&gt;
2008-09-05 19:14:24,585 INFO org.apache.hadoop.ipc.Server: IPC Server handler 4 on 60020: exiting&lt;br/&gt;
2008-09-05 19:14:24,585 INFO org.apache.hadoop.ipc.Server: IPC Server handler 5 on 60020: exiting&lt;br/&gt;
2008-09-05 19:14:24,585 INFO org.apache.hadoop.ipc.Server: IPC Server handler 8 on 60020: exiting&lt;br/&gt;
2008-09-05 19:14:24,585 INFO org.apache.hadoop.ipc.Server: IPC Server handler 9 on 60020: exiting&lt;br/&gt;
2008-09-05 19:14:24,585 INFO org.apache.hadoop.ipc.Server: Stopping IPC Server Responder&lt;br/&gt;
2008-09-05 19:14:24,587 INFO org.apache.hadoop.ipc.Server: IPC Server handler 7 on 60020: exiting&lt;br/&gt;
2008-09-05 19:14:24,587 INFO org.mortbay.http.SocketListener: Stopped SocketListener on 0.0.0.0:60030&lt;br/&gt;
2008-09-05 19:14:25,254 INFO org.mortbay.util.Container: Stopped HttpContext&lt;span class=&quot;error&quot;&gt;&amp;#91;/static,/static&amp;#93;&lt;/span&gt;&lt;br/&gt;
2008-09-05 19:14:25,762 INFO org.mortbay.util.Container: Stopped HttpContext&lt;span class=&quot;error&quot;&gt;&amp;#91;/logs,/logs&amp;#93;&lt;/span&gt;&lt;br/&gt;
2008-09-05 19:14:25,763 INFO org.mortbay.util.Container: Stopped org.mortbay.jetty.servlet.WebApplicationHandler@6b754699&lt;br/&gt;
2008-09-05 19:14:26,418 INFO org.mortbay.util.Container: Stopped WebApplicationContext&lt;span class=&quot;error&quot;&gt;&amp;#91;/,/&amp;#93;&lt;/span&gt;&lt;br/&gt;
2008-09-05 19:14:26,418 INFO org.mortbay.util.Container: Stopped org.mortbay.jetty.Server@177ba38f&lt;br/&gt;
2008-09-05 19:14:26,419 DEBUG org.apache.hadoop.hbase.regionserver.HLog: closing log writer in hdfs://web1:9000/hbase/log_72.34.249.110_1220665441919_60020&lt;br/&gt;
2008-09-05 19:14:26,419 INFO org.apache.hadoop.hbase.regionserver.LogRoller: LogRoller exiting.&lt;br/&gt;
2008-09-05 19:14:26,419 INFO org.apache.hadoop.hbase.regionserver.CompactSplitThread: regionserver/0:0:0:0:0:0:0:0:60020.compactor exiting&lt;br/&gt;
2008-09-05 19:14:26,432 INFO org.apache.hadoop.hbase.regionserver.HRegionServer: On abort, closed hlog&lt;br/&gt;
2008-09-05 19:14:26,433 DEBUG org.apache.hadoop.hbase.regionserver.HRegionServer: closing region .META.,,1&lt;br/&gt;
2008-09-05 19:14:26,433 DEBUG org.apache.hadoop.hbase.regionserver.HRegion: Compactions and cache flushes disabled for region .META.,,1&lt;br/&gt;
2008-09-05 19:14:26,433 DEBUG org.apache.hadoop.hbase.regionserver.HRegion: Scanners disabled for region .META.,,1&lt;br/&gt;
2008-09-05 19:14:26,433 DEBUG org.apache.hadoop.hbase.regionserver.HRegion: No more active scanners for region .META.,,1&lt;br/&gt;
2008-09-05 19:14:26,433 DEBUG org.apache.hadoop.hbase.regionserver.HRegion: Updates disabled for region .META.,,1&lt;br/&gt;
2008-09-05 19:14:26,433 DEBUG org.apache.hadoop.hbase.regionserver.HRegion: No more row locks outstanding on region .META.,,1&lt;br/&gt;
2008-09-05 19:14:26,433 DEBUG org.apache.hadoop.hbase.regionserver.HStore: closed 1028785192/historian&lt;br/&gt;
2008-09-05 19:14:26,433 DEBUG org.apache.hadoop.hbase.regionserver.HStore: closed 1028785192/info&lt;br/&gt;
2008-09-05 19:14:26,433 INFO org.apache.hadoop.hbase.regionserver.HRegion: closed .META.,,1&lt;br/&gt;
...&lt;br/&gt;
2008-09-05 19:14:26,435 INFO org.apache.hadoop.hbase.regionserver.HRegionServer: aborting server at: 72.34.249.110:60020&lt;br/&gt;
2008-09-05 19:14:30,719 INFO org.apache.hadoop.hbase.regionserver.HRegionServer: worker thread exiting&lt;br/&gt;
2008-09-05 19:14:30,719 INFO org.apache.hadoop.hbase.regionserver.HRegionServer: regionserver/0:0:0:0:0:0:0:0:60020 exiting&lt;br/&gt;
2008-09-05 19:14:32,341 INFO org.apache.hadoop.hbase.Leases: regionserver/0:0:0:0:0:0:0:0:60020.leaseChecker closing leases&lt;br/&gt;
2008-09-05 19:14:32,341 INFO org.apache.hadoop.hbase.Leases: regionserver/0:0:0:0:0:0:0:0:60020.leaseChecker closed leases&lt;br/&gt;
2008-09-05 19:14:32,342 INFO org.apache.hadoop.hbase.regionserver.HRegionServer: Starting shutdown thread.&lt;br/&gt;
2008-09-05 19:14:32,342 INFO org.apache.hadoop.hbase.regionserver.HRegionServer: Shutdown thread complete&lt;/p&gt;
</comment>
                            <comment id="12628908" author="streamy" created="Sat, 6 Sep 2008 20:32:00 +0000"  >&lt;p&gt;Comparator is called now, thanks JD.&lt;/p&gt;

&lt;p&gt;Current issue with this patch is that following first split, META table eventually loses all references to the new split regions.&lt;/p&gt;</comment>
                            <comment id="12628929" author="streamy" created="Sun, 7 Sep 2008 01:24:33 +0000"  >&lt;p&gt;This patch contains a ton more switches of Bytes.compare and Bytes.equals to HStoreKey.compareTwoRowKeys and HStoreKey.equalsTwoRowKeys&lt;/p&gt;

&lt;p&gt;That fixes a great deal of the issues...&lt;/p&gt;

&lt;p&gt;Right now, we can successfully get past the first split.  After the second split, the first region gets lost from the META table.  Often the historian family will exist but the info is gone completely.&lt;/p&gt;

&lt;p&gt;There is also a lot of debug output in this spread across Memcache + HScanner, SFS, and a few other places.  This is attempting to figure out when we do our scans if we are missing something.&lt;/p&gt;

&lt;p&gt;JD and I originally thought that the row for the first region was still in META but for some reason scanner was missing it.  Looking at it now with the debug output, it seems that it sees old META rows with the splitA splitB info in them, and then a start row META row for the split table, but only historian info.  That may have been throwing us off.&lt;/p&gt;

&lt;p&gt;I&apos;m a bit stumped at this point as to whether the scanner is messed up or somehow when we remove the &quot;mother&quot; region we might be deleting too much, or something else all together.&lt;/p&gt;</comment>
                            <comment id="12628931" author="jimk" created="Sun, 7 Sep 2008 02:03:54 +0000"  >&lt;p&gt;Jonathan,&lt;/p&gt;

&lt;p&gt;WRT to the DroppedSnapshotException, can you confirm that you have hadoop-0.17.2.1 in the libs directory and that you are using 0.17.2.1 for Hadoop?&lt;/p&gt;

&lt;p&gt;I noted that some native libraries were loaded in your log above. If you just have hadoop-0.17.2, be advised that the native libs are incorrect.&lt;/p&gt;

&lt;p&gt;If you are using 0.17.2.1, then this is just a red herring.&lt;/p&gt;</comment>
                            <comment id="12629004" author="streamy" created="Sun, 7 Sep 2008 20:04:10 +0000"  >&lt;p&gt;Jim, this is actually running off of 0.18.&lt;/p&gt;

&lt;p&gt;We&apos;re not seeing the dropped snapshot anymore, so not sure if that is relevant anymore.&lt;/p&gt;</comment>
                            <comment id="12629013" author="stack" created="Sun, 7 Sep 2008 22:06:30 +0000"  >&lt;p&gt;I was able to reproduce the jgray failures by doing this in PE:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Index: src/test/org/apache/hadoop/hbase/PerformanceEvaluation.java
===================================================================
--- src/test/org/apache/hadoop/hbase/PerformanceEvaluation.java (revision 692728)
+++ src/test/org/apache/hadoop/hbase/PerformanceEvaluation.java (working copy)
@@ -481,7 +481,8 @@
     &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt; [] b = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[10];
     &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; d = &lt;span class=&quot;code-object&quot;&gt;Math&lt;/span&gt;.abs(number);
     &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i = b.length - 1; i &amp;gt;= 0; i--) {
-      b[i] = (&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;)((d % 10) + &apos;0&apos;);
+      &lt;span class=&quot;code-comment&quot;&gt;// b[i] = (&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;)((d % 10) + &apos;0&apos;);
&lt;/span&gt;+      b[i] = (&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;)((d % 10));
       d /= 10;
     }
     &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; b;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;We need to add a unit test with binary keys... as part of &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-859&quot; title=&quot;HStoreKey needs a reworking&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-859&quot;&gt;&lt;del&gt;HBASE-859&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12629018" author="streamy" created="Sun, 7 Sep 2008 22:48:23 +0000"  >&lt;p&gt;Patch appears to fix all issues.  Will confirm.&lt;/p&gt;</comment>
                            <comment id="12629020" author="stack" created="Sun, 7 Sep 2008 23:38:49 +0000"  >&lt;p&gt;Reviewed the patch.&lt;/p&gt;

&lt;p&gt;I added javadoc here:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+  &lt;span class=&quot;code-comment&quot;&gt;// WritableComparator that takes account of meta keys.
&lt;/span&gt;+  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; class HStoreKeyWritableComparator &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; WritableComparator {
+    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; HRegionInfo hri;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;... and removed the creation of new objects done in the below:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Index: src/java/org/apache/hadoop/hbase/master/MetaRegion.java
===================================================================
--- src/java/org/apache/hadoop/hbase/master/MetaRegion.java (revision 692702)
+++ src/java/org/apache/hadoop/hbase/master/MetaRegion.java (working copy)
@@ -20,7 +20,10 @@
 &lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt; org.apache.hadoop.hbase.master;

 &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.hadoop.hbase.HConstants;
+&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.hadoop.hbase.HRegionInfo;
+&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.hadoop.hbase.HTableDescriptor;
 &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.hadoop.hbase.HServerAddress;
+&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.hadoop.hbase.HStoreKey;
 &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.hadoop.hbase.util.Bytes;


@@ -90,7 +93,9 @@
   &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; compareTo(MetaRegion other) {
     &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; result = Bytes.compareTo(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.regionName, other.getRegionName());
     &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;(result == 0) {
-      result = Bytes.compareTo(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.startKey, other.getStartKey());
+      HRegionInfo hri = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HRegionInfo(HTableDescriptor.META_TABLEDESC, 
+          HConstants.EMPTY_END_ROW, HConstants.EMPTY_END_ROW);
+      result = HStoreKey.compareTwoRowKeys(hri, &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.startKey, other.getStartKey());
       &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (result == 0) {
         &lt;span class=&quot;code-comment&quot;&gt;// Might be on different host?
&lt;/span&gt;         result = &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.server.compareTo(other.server);
Index: src/java/org/apache/hadoop/hbase/client/MetaScanner.java
===================================================================
--- src/java/org/apache/hadoop/hbase/client/MetaScanner.java    (revision 692702)
+++ src/java/org/apache/hadoop/hbase/client/MetaScanner.java    (working copy)
@@ -5,6 +5,7 @@
 &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.hadoop.hbase.HBaseConfiguration;
 &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.hadoop.hbase.HConstants;
 &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.hadoop.hbase.HRegionInfo;
+&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.hadoop.hbase.HStoreKey;
 &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.hadoop.hbase.io.RowResult;
 &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.hadoop.hbase.util.Bytes;

@@ -47,6 +48,7 @@
           HRegionInfo.createRegionName(tableName, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, ZEROES);

     &lt;span class=&quot;code-comment&quot;&gt;// Scan over each meta region
&lt;/span&gt;+    HRegionInfo hri;
     &lt;span class=&quot;code-keyword&quot;&gt;do&lt;/span&gt; {
       ScannerCallable callable = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ScannerCallable(connection,
         META_TABLE_NAME, COLUMN_FAMILY_ARRAY, startRow, LATEST_TIMESTAMP, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;);
@@ -62,12 +64,13 @@
         } &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt;(visitor.processRow(r));
         &lt;span class=&quot;code-comment&quot;&gt;// Advance the startRow to the end key of the current region
&lt;/span&gt;         startRow = callable.getHRegionInfo().getEndKey();
+        hri = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HRegionInfo(callable.getHRegionInfo());
       } &lt;span class=&quot;code-keyword&quot;&gt;finally&lt;/span&gt; {
         &lt;span class=&quot;code-comment&quot;&gt;// Close scanner
&lt;/span&gt;         callable.setClose();
         connection.getRegionServerWithRetries(callable);
       }
-    } &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; (Bytes.compareTo(startRow, LAST_ROW) != 0);
+    } &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; (HStoreKey.compareTwoRowKeys(hri, startRow, LAST_ROW) != 0);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Otherwise, the patch looks fine.&lt;/p&gt;

&lt;p&gt;This kinda change looks unnecessary in SFS but I&apos;m afraid to change it since the patch works:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
-      keys[i] = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HStoreKey();
+      keys[i] = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HStoreKey(HConstants.EMPTY_BYTE_ARRAY, &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.store.getHRegionInfo());
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I&apos;m running unit tests now.  I&apos;ll then run the amended PE test to ensure binary keys work.&lt;/p&gt;</comment>
                            <comment id="12629025" author="stack" created="Mon, 8 Sep 2008 00:15:35 +0000"  >&lt;p&gt;Committed branch and trunk.&lt;/p&gt;

&lt;p&gt;Thanks Jon Gray and J-D for marathon weekend debugging session that produced this patch.&lt;/p&gt;

&lt;p&gt;Passes all unit tests.&lt;/p&gt;

&lt;p&gt;I also amended PE with binary keys.  Below is scan of table with binary keys.  Notice that there are more than one.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2008-09-07 16:58:31,982 DEBUG org.apache.hadoop.hbase.regionserver.HRegion: Started memcache flush &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; region TestTabl,1220831867463. Current region memcache size 64.0m
2008-09-07 16:58:32,600 INFO org.apache.hadoop.hbase.master.BaseScanner: RegionManager.metaScanner scanning meta region {regionname: .META.,,1, startKey: &amp;lt;&amp;gt;, server: 127.0.0.1:61450}
2008-09-07 16:58:32,604 DEBUG org.apache.hadoop.hbase.master.BaseScanner: RegionManager.metaScanner REGION =&amp;gt; {NAME =&amp;gt; &apos;TestTable,,1220831633849&apos;, STARTKEY =&amp;gt; &apos;&apos;, ENDKEY =&amp;gt; &apos;          &apos;, ENCODED =&amp;gt; 377629314, TABLE =&amp;gt; {{NAME =&amp;gt; &apos;TestTable&apos;, IS_ROOT =&amp;gt; &apos;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&apos;, IS_META =&amp;gt; &apos;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&apos;, FAMILIES =&amp;gt; [{NAME =&amp;gt; &apos;info&apos;, BLOOMFILTER =&amp;gt; &apos;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&apos;, IN_MEMORY =&amp;gt; &apos;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&apos;, VERSIONS =&amp;gt; &apos;3&apos;, BLOCKCACHE =&amp;gt; &apos;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&apos;, LENGTH =&amp;gt; &apos;2147483647&apos;, TTL =&amp;gt; &apos;-1&apos;, COMPRESSION =&amp;gt; &apos;NONE&apos;}]}}}, SERVER =&amp;gt; &apos;127.0.0.1:61450&apos;, STARTCODE =&amp;gt; 1220831422560
2008-09-07 16:58:32,605 DEBUG org.apache.hadoop.hbase.master.BaseScanner: RegionManager.metaScanner REGION =&amp;gt; {NAME =&amp;gt; &apos;TestTable,              ,1220831723306&apos;, STARTKEY =&amp;gt; &apos;          &apos;, ENDKEY =&amp;gt; &apos;  &apos;, ENCODED =&amp;gt; 1215868091, TABLE =&amp;gt; {{NAME =&amp;gt; &apos;TestTable&apos;, IS_ROOT =&amp;gt; &apos;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&apos;, IS_META =&amp;gt; &apos;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&apos;, FAMILIES =&amp;gt; [{NAME =&amp;gt; &apos;info&apos;, BLOOMFILTER =&amp;gt; &apos;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&apos;, IN_MEMORY =&amp;gt; &apos;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&apos;, VERSIONS =&amp;gt; &apos;3&apos;, BLOCKCACHE =&amp;gt; &apos;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&apos;, LENGTH =&amp;gt; &apos;2147483647&apos;, TTL =&amp;gt; &apos;-1&apos;, COMPRESSION =&amp;gt; &apos;NONE&apos;}]}}}, SERVER =&amp;gt; &apos;127.0.0.1:61450&apos;, STARTCODE =&amp;gt; 1220831422560
2008-09-07 16:58:32,606 DEBUG org.apache.hadoop.hbase.master.BaseScanner: RegionManager.metaScanner REGION =&amp;gt; {NAME =&amp;gt; &apos;TestTable,      ,1220831779573&apos;, STARTKEY =&amp;gt; &apos;  &apos;, ENDKEY =&amp;gt; &apos;, ENCODED =&amp;gt; 2091937218, TABLE =&amp;gt; {{NAME =&amp;gt; &apos;TestTable&apos;, IS_ROOT =&amp;gt; &apos;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&apos;, IS_META =&amp;gt; &apos;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&apos;, FAMILIES =&amp;gt; [{NAME =&amp;gt; &apos;info&apos;, BLOOMFILTER =&amp;gt; &apos;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&apos;, IN_MEMORY =&amp;gt; &apos;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&apos;, VERSIONS =&amp;gt; &apos;3&apos;, BLOCKCACHE =&amp;gt; &apos;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&apos;, LENGTH =&amp;gt; &apos;2147483647&apos;, TTL =&amp;gt; &apos;-1&apos;, COMPRESSION =&amp;gt; &apos;NONE&apos;}]}}}, SERVER =&amp;gt; &apos;127.0.0.1:61450&apos;, STARTCODE =&amp;gt; 1220831422560
2008-09-07 16:58:32,607 DEBUG org.apache.hadoop.hbase.master.BaseScanner: RegionManager.metaScanner REGION =&amp;gt; {NAME =&amp;gt; &apos;TestTable,1220831779573&apos;, STARTKEY =&amp;gt; &apos;, ENDKEY =&amp;gt; &apos;&apos;, ENCODED =&amp;gt; 1789154425, OFFLINE =&amp;gt; &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;, SPLIT =&amp;gt; &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;, TABLE =&amp;gt; {{NAME =&amp;gt; &apos;TestTable&apos;, IS_ROOT =&amp;gt; &apos;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&apos;, IS_META =&amp;gt; &apos;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&apos;, FAMILIES =&amp;gt; [{NAME =&amp;gt; &apos;info&apos;, BLOOMFILTER =&amp;gt; &apos;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&apos;, IN_MEMORY =&amp;gt; &apos;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&apos;, VERSIONS =&amp;gt; &apos;3&apos;, BLOCKCACHE =&amp;gt; &apos;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&apos;, LENGTH =&amp;gt; &apos;2147483647&apos;, TTL =&amp;gt; &apos;-1&apos;, COMPRESSION =&amp;gt; &apos;NONE&apos;}]}}}, SERVER =&amp;gt; &apos;127.0.0.1:61450&apos;, STARTCODE =&amp;gt; 1220831422560
2008-09-07 16:58:32,607 DEBUG org.apache.hadoop.hbase.master.BaseScanner: RegionManager.metaScanner REGION =&amp;gt; {NAME =&amp;gt; &apos;TestTable,1220831867463&apos;, STARTKEY =&amp;gt; &apos;, ENDKEY =&amp;gt;&apos;, ENCODED =&amp;gt; 1298791821, TABLE =&amp;gt; {{NAME =&amp;gt; &apos;TestTable&apos;, IS_ROOT =&amp;gt; &apos;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&apos;, IS_META =&amp;gt; &apos;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&apos;, FAMILIES =&amp;gt; [{NAME =&amp;gt; &apos;info&apos;, BLOOMFILTER =&amp;gt; &apos;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&apos;, IN_MEMORY =&amp;gt; &apos;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&apos;, VERSIONS =&amp;gt; &apos;3&apos;, BLOCKCACHE =&amp;gt; &apos;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&apos;, LENGTH =&amp;gt; &apos;2147483647&apos;, TTL =&amp;gt; &apos;-1&apos;, COMPRESSION =&amp;gt; &apos;NONE&apos;}]}}}, SERVER =&amp;gt; &apos;127.0.0.1:61450&apos;, STARTCODE =&amp;gt; 1220831422560
2008-09-07 16:58:32,608 DEBUG org.apache.hadoop.hbase.master.BaseScanner: RegionManager.metaScanner REGION =&amp;gt; {NAME =&amp;gt; &apos;TestTabl,1220831867463&apos;, STARTKEY =&amp;gt;&apos;, ENDKEY =&amp;gt; &apos;&apos;, ENCODED =&amp;gt; 639105844, TABLE =&amp;gt; {{NAME =&amp;gt; &apos;TestTable&apos;, IS_ROOT =&amp;gt; &apos;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&apos;, IS_META =&amp;gt; &apos;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&apos;, FAMILIES =&amp;gt; [{NAME =&amp;gt; &apos;info&apos;, BLOOMFILTER =&amp;gt; &apos;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&apos;, IN_MEMORY =&amp;gt; &apos;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&apos;, VERSIONS =&amp;gt; &apos;3&apos;, BLOCKCACHE =&amp;gt; &apos;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&apos;, LENGTH =&amp;gt; &apos;2147483647&apos;, TTL =&amp;gt; &apos;-1&apos;, COMPRESSION =&amp;gt; &apos;NONE&apos;}]}}}, SERVER =&amp;gt; &apos;127.0.0.1:61450&apos;, STARTCODE =&amp;gt; 1220831422560
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12629026" author="streamy" created="Mon, 8 Sep 2008 00:19:21 +0000"  >&lt;p&gt;Thanks again to JD and stack for their help over the past four days, you guys definitely went above and beyond to help get this bug squashed.  Much appreciated.&lt;/p&gt;</comment>
                            <comment id="12629031" author="streamy" created="Mon, 8 Sep 2008 01:13:07 +0000"  >&lt;p&gt;There&apos;s still something broken here.  It&apos;s not related to the splitting and all that, that still appears to be fixed.&lt;/p&gt;

&lt;p&gt;Now there is an issue with obtaining HTable reference to the same table in question.  Exception is:&lt;/p&gt;

&lt;p&gt;org.apache.hadoop.hbase.TableNotFoundException: items&lt;br/&gt;
        at org.apache.hadoop.hbase.client.HConnectionManager$TableServers.locateRegionInMeta(HConnectionManager.java:508)&lt;br/&gt;
        at org.apache.hadoop.hbase.client.HConnectionManager$TableServers.locateRegion(HConnectionManager.java:460)&lt;br/&gt;
        at org.apache.hadoop.hbase.client.HConnectionManager$TableServers.locateRegion(HConnectionManager.java:420)&lt;br/&gt;
        at org.apache.hadoop.hbase.client.HTable.&amp;lt;init&amp;gt;(HTable.java:130)&lt;br/&gt;
        at HBaseRef.&amp;lt;init&amp;gt;(HBaseRef.java:29)&lt;br/&gt;
        at Import.&amp;lt;init&amp;gt;(Import.java:20)&lt;br/&gt;
        at Import.main(Import.java:26)&lt;/p&gt;

&lt;p&gt;Will post more info as I discover it.&lt;/p&gt;</comment>
                            <comment id="12629032" author="streamy" created="Mon, 8 Sep 2008 01:28:54 +0000"  >&lt;p&gt;Needs another one-line patch to fix HCM.  Patch is actually in HStore.&lt;/p&gt;</comment>
                            <comment id="12629045" author="streamy" created="Mon, 8 Sep 2008 02:04:49 +0000"  >&lt;p&gt;This does fix it.  But eventually it broke again with the same error.&lt;/p&gt;

&lt;p&gt;There are quite a few references around the code for a synchronizedSortedMap/TreeMap instantiation that may also need to be passed the HSK comparator.&lt;/p&gt;</comment>
                            <comment id="12629047" author="jimk" created="Mon, 8 Sep 2008 02:12:02 +0000"  >&lt;p&gt;Doesn&apos;t HSK.compareTo do the &quot;right thing&quot;? If not, why can&apos;t it?&lt;/p&gt;</comment>
                            <comment id="12629049" author="streamy" created="Mon, 8 Sep 2008 02:16:07 +0000"  >&lt;p&gt;It does do the right thing.  The issue is that it&apos;s not always being used.&lt;/p&gt;

&lt;p&gt;We have almost certainly changed every Bytes.compareTo/Bytes.equals to HSK.compareTwoRowKeys/HSK.equalsTwoRowKeys necessary&lt;/p&gt;

&lt;p&gt;The issue now is that many things use a SortedMap/TreeMap to iterate through results.  When those are instantiated, if it will be used with row keys, they must be passed the HSK comparator that was added with this patch.&lt;/p&gt;</comment>
                            <comment id="12629050" author="streamy" created="Mon, 8 Sep 2008 02:24:16 +0000"  >&lt;p&gt;Could issue be in BloomFilterMapFile.Reader and/or HbaseMapWirtable (which it extends)?&lt;/p&gt;

&lt;p&gt;HMW implementes a SortedMap&amp;lt;byte[],V&amp;gt; which is the culprit before.  We have nothing pointing it to our custom comparator.&lt;/p&gt;</comment>
                            <comment id="12629216" author="streamy" created="Mon, 8 Sep 2008 17:17:22 +0000"  >&lt;p&gt;Already fixed, remaining issue in 877&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310010">
                    <name>Incorporates</name>
                                                                <inwardlinks description="is part of">
                                        <issuelink>
            <issuekey id="12403869">HBASE-877</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12389609" name="hbase-868-0.2-v2.patch" size="22452" author="streamy" created="Sat, 6 Sep 2008 03:22:58 +0000"/>
                            <attachment id="12389621" name="hbase-868-0.2-v3.patch" size="22492" author="streamy" created="Sat, 6 Sep 2008 20:32:00 +0000"/>
                            <attachment id="12389625" name="hbase-868-0.2-v4.patch" size="50429" author="streamy" created="Sun, 7 Sep 2008 01:24:33 +0000"/>
                            <attachment id="12389647" name="hbase-868-0.2-v5-fix.patch" size="902" author="streamy" created="Mon, 8 Sep 2008 01:29:50 +0000"/>
                            <attachment id="12389645" name="hbase-868-0.2-v5.patch" size="48040" author="streamy" created="Sun, 7 Sep 2008 22:48:23 +0000"/>
                            <attachment id="12389524" name="hbase-868-branch-0.2.patch" size="1222" author="jdcryans" created="Thu, 4 Sep 2008 17:55:40 +0000"/>
                            <attachment id="12389523" name="hbase-hbase-regionserver-web3.streamy.com.log" size="1052495" author="streamy" created="Thu, 4 Sep 2008 17:48:22 +0000"/>
                            <attachment id="12389526" name="master_regionsinsources.png" size="7232" author="streamy" created="Thu, 4 Sep 2008 18:06:37 +0000"/>
                            <attachment id="12389527" name="regionserver_regionlist.png" size="24614" author="streamy" created="Thu, 4 Sep 2008 18:06:37 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 4 Sep 2008 17:55:40 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>25448</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 13 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0h9xz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>98873</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>