<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sat Dec 03 16:51:35 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-11902/HBASE-11902.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-11902] RegionServer was blocked while aborting</title>
                <link>https://issues.apache.org/jira/browse/HBASE-11902</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Generally, regionserver automatically aborts when isHealth() returns false. But it sometimes got blocked while aborting. I saved the jstack and logs, and found out that it was caused by datanodes failures. The &quot;regionserver60020&quot; thread was blocked while closing WAL. &lt;br/&gt;
This issue doesn&apos;t happen so frequently, but if it happens, it always leads to huge amount of requests failure. The only way to do is KILL -9.&lt;br/&gt;
I think it&apos;s a bug, but I haven&apos;t found a decent solution. Does anyone have the same problem?&lt;/p&gt;</description>
                <environment>&lt;p&gt;hbase-0.98.4, hadoop-2.3.0-cdh5.1, jdk1.7&lt;/p&gt;</environment>
        <key id="12739312">HBASE-11902</key>
            <summary>RegionServer was blocked while aborting</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="3">Duplicate</resolution>
                                        <assignee username="tianq">Qiang Tian</assignee>
                                    <reporter username="victorunique">Victor Xu</reporter>
                        <labels>
                    </labels>
                <created>Fri, 5 Sep 2014 02:58:24 +0000</created>
                <updated>Fri, 14 Aug 2015 21:45:57 +0000</updated>
                            <resolved>Fri, 14 Aug 2015 21:45:57 +0000</resolved>
                                    <version>0.98.4</version>
                                                    <component>regionserver</component>
                    <component>wal</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>10</watches>
                                                                <comments>
                            <comment id="14122324" author="victorunique" created="Fri, 5 Sep 2014 03:00:08 +0000"  >&lt;p&gt;Upload the hbase log file. You can find the details by searching &quot;STOPPED: One or more threads are no longer alive&quot;&lt;/p&gt;</comment>
                            <comment id="14122325" author="victorunique" created="Fri, 5 Sep 2014 03:00:56 +0000"  >&lt;p&gt;Upload the jstack output. Search for &apos;regionserver60020&apos; for more details.&lt;/p&gt;</comment>
                            <comment id="14122467" author="stack" created="Fri, 5 Sep 2014 05:36:23 +0000"  >&lt;p&gt;You mean here:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-quote&quot;&gt;&quot;regionserver60020&quot;&lt;/span&gt; prio=10 tid=0x00007f85011ca800 nid=0x74d0 in &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;.wait() [0x000000004405f000]
   java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.State: WAITING (on object monitor)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;.wait(Native Method)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;.wait(&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;.java:503)
	at org.apache.hadoop.hbase.util.DrainBarrier.stopAndDrainOps(DrainBarrier.java:115)
	- locked &amp;lt;0x00000002bb325248&amp;gt; (a org.apache.hadoop.hbase.util.DrainBarrier)
	at org.apache.hadoop.hbase.util.DrainBarrier.stopAndDrainOps(DrainBarrier.java:85)
	at org.apache.hadoop.hbase.regionserver.wal.FSHLog.close(FSHLog.java:923)
	at org.apache.hadoop.hbase.regionserver.HRegionServer.closeWAL(HRegionServer.java:1208)
	at org.apache.hadoop.hbase.regionserver.HRegionServer.run(HRegionServer.java:1001)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:744)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Doesn&apos;t seem to be an HDFS issue, just waiting on flushes to complete.  You see issues flushing Victor (I&apos;ve not looked at log).&lt;/p&gt;
</comment>
                            <comment id="14122682" author="victorunique" created="Fri, 5 Sep 2014 08:45:57 +0000"  >&lt;p&gt;Yes, stack. The rs main thread is waiting at org.apache.hadoop.hbase.util.DrainBarrier.stopAndDrainOps, but the main cause of the aborting is DataNodes. You can find the details in the log:&lt;br/&gt;
2014-09-03 13:38:03,789 FATAL org.apache.hadoop.hbase.regionserver.wal.FSHLog: Error while AsyncSyncer sync, request close of hlog &lt;br/&gt;
java.io.IOException: All datanodes 10.246.2.103:50010 are bad. Aborting...&lt;br/&gt;
	at org.apache.hadoop.hdfs.DFSOutputStream$DataStreamer.setupPipelineForAppendOrRecovery(DFSOutputStream.java:1127)&lt;br/&gt;
	at org.apache.hadoop.hdfs.DFSOutputStream$DataStreamer.processDatanodeError(DFSOutputStream.java:924)&lt;br/&gt;
	at org.apache.hadoop.hdfs.DFSOutputStream$DataStreamer.run(DFSOutputStream.java:486)&lt;br/&gt;
2014-09-03 13:38:03,799 ERROR org.apache.hadoop.hbase.regionserver.MemStoreFlusher: Cache flush failed for region page_content_queue,00166,1408946731655.8671b8a0f82565f88eb2ab8a5b53e84c.&lt;br/&gt;
java.io.IOException: All datanodes 10.246.2.103:50010 are bad. Aborting...&lt;br/&gt;
	at org.apache.hadoop.hdfs.DFSOutputStream$DataStreamer.setupPipelineForAppendOrRecovery(DFSOutputStream.java:1127)&lt;br/&gt;
	at org.apache.hadoop.hdfs.DFSOutputStream$DataStreamer.processDatanodeError(DFSOutputStream.java:924)&lt;br/&gt;
	at org.apache.hadoop.hdfs.DFSOutputStream$DataStreamer.run(DFSOutputStream.java:486)&lt;br/&gt;
2014-09-03 13:38:03,801 ERROR org.apache.hadoop.hbase.regionserver.wal.ProtobufLogWriter: Got IOException while writing trailer&lt;br/&gt;
java.io.IOException: All datanodes 10.246.2.103:50010 are bad. Aborting...&lt;br/&gt;
	at org.apache.hadoop.hdfs.DFSOutputStream$DataStreamer.setupPipelineForAppendOrRecovery(DFSOutputStream.java:1127)&lt;br/&gt;
	at org.apache.hadoop.hdfs.DFSOutputStream$DataStreamer.processDatanodeError(DFSOutputStream.java:924)&lt;br/&gt;
	at org.apache.hadoop.hdfs.DFSOutputStream$DataStreamer.run(DFSOutputStream.java:486)&lt;br/&gt;
2014-09-03 13:38:03,802 ERROR org.apache.hadoop.hbase.regionserver.wal.FSHLog: Failed close of HLog writer&lt;br/&gt;
java.io.IOException: All datanodes 10.246.2.103:50010 are bad. Aborting...&lt;br/&gt;
	at org.apache.hadoop.hdfs.DFSOutputStream$DataStreamer.setupPipelineForAppendOrRecovery(DFSOutputStream.java:1127)&lt;br/&gt;
	at org.apache.hadoop.hdfs.DFSOutputStream$DataStreamer.processDatanodeError(DFSOutputStream.java:924)&lt;br/&gt;
	at org.apache.hadoop.hdfs.DFSOutputStream$DataStreamer.run(DFSOutputStream.java:486)&lt;br/&gt;
2014-09-03 13:38:03,802 WARN org.apache.hadoop.hbase.regionserver.wal.FSHLog: Riding over HLog close failure! error count=1&lt;br/&gt;
2014-09-03 13:38:03,804 INFO org.apache.hadoop.hbase.regionserver.wal.FSHLog: Rolled WAL /hbase/WALs/hadoop461.cm6.tbsite.net,60020,1409003284950/hadoop461.cm6.tbsite.net%2C60020%2C1409003284950.1409722420708 with entries=32565, filesize=118.6 M; new WAL /hbase/WALs/hadoop461.cm6.tbsite.net,60020,1409003284950/hadoop461.cm6.tbsite.net%2C60020%2C1409003284950.1409722683780&lt;br/&gt;
2014-09-03 13:38:03,804 DEBUG org.apache.hadoop.hbase.regionserver.wal.FSHLog: log file is ready for archiving hdfs://hadoopnnvip.cm6:9000/hbase/WALs/hadoop461.cm6.tbsite.net,60020,1409003284950/hadoop461.cm6.tbsite.net%2C60020%2C1409003284950.1409707475254&lt;br/&gt;
2014-09-03 13:38:03,804 DEBUG org.apache.hadoop.hbase.regionserver.wal.FSHLog: log file is ready for archiving hdfs://hadoopnnvip.cm6:9000/hbase/WALs/hadoop461.cm6.tbsite.net,60020,1409003284950/hadoop461.cm6.tbsite.net%2C60020%2C1409003284950.1409707722202&lt;br/&gt;
2014-09-03 13:38:03,804 DEBUG org.apache.hadoop.hbase.regionserver.wal.FSHLog: log file is ready for archiving hdfs://hadoopnnvip.cm6:9000/hbase/WALs/hadoop461.cm6.tbsite.net,60020,1409003284950/hadoop461.cm6.tbsite.net%2C60020%2C1409003284950.1409707946159&lt;br/&gt;
2014-09-03 13:38:03,804 DEBUG org.apache.hadoop.hbase.regionserver.wal.FSHLog: log file is ready for archiving hdfs://hadoopnnvip.cm6:9000/hbase/WALs/hadoop461.cm6.tbsite.net,60020,1409003284950/hadoop461.cm6.tbsite.net%2C60020%2C1409003284950.1409708155788&lt;br/&gt;
2014-09-03 13:38:03,839 DEBUG org.apache.hadoop.hbase.regionserver.HRegion: Flush requested on page_content_queue,00166,1408946731655.8671b8a0f82565f88eb2ab8a5b53e84c.&lt;br/&gt;
2014-09-03 13:38:03,839 DEBUG org.apache.hadoop.hbase.regionserver.HRegion: Started memstore flush for page_content_queue,00166,1408946731655.8671b8a0f82565f88eb2ab8a5b53e84c., current region memstore size 218.5 M&lt;br/&gt;
2014-09-03 13:38:03,887 DEBUG org.apache.hadoop.hbase.regionserver.HRegion: Flush requested on page_content_queue,00166,1408946731655.8671b8a0f82565f88eb2ab8a5b53e84c.&lt;br/&gt;
2014-09-03 13:38:03,887 DEBUG org.apache.hadoop.hbase.regionserver.HRegion: Started memstore flush for page_content_queue,00166,1408946731655.8671b8a0f82565f88eb2ab8a5b53e84c., current region memstore size 218.5 M&lt;br/&gt;
2014-09-03 13:38:03,897 DEBUG org.apache.hadoop.hbase.regionserver.HRegion: Flush requested on page_content_queue,00166,1408946731655.8671b8a0f82565f88eb2ab8a5b53e84c.&lt;br/&gt;
2014-09-03 13:38:04,699 INFO org.apache.hadoop.hbase.regionserver.HRegionServer: STOPPED: One or more threads are no longer alive &amp;#8211; stop&lt;br/&gt;
2014-09-03 13:38:04,699 INFO org.apache.hadoop.ipc.RpcServer: Stopping server on 60020&lt;/p&gt;</comment>
                            <comment id="14223976" author="tianq" created="Tue, 25 Nov 2014 02:58:27 +0000"  >&lt;p&gt;from the stacktrace, DrainBarrier.stopAndDrainOps is waiting, so DrainBarrier#endOp does not notify it.&lt;/p&gt;

&lt;p&gt;looking at class DrainBarrier, it is expected that beginOp and endOp are called in pair. the initial value of &lt;tt&gt;valueAndFlags&lt;/tt&gt; is 2, incremented by 2 in beginOp; decremented by 2 in endOp.&lt;/p&gt;

&lt;p&gt;in stopAndDrainOps, if getValue(oldValAndFlags) == 1, means oldValAndFlags=2, all ops are completed in pair, otherwise, it needs to wait the last endOp to notify it:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (getValue(oldValAndFlags) == 1) &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt;; &lt;span class=&quot;code-comment&quot;&gt;// There were no operations outstanding.
&lt;/span&gt;    &lt;span class=&quot;code-keyword&quot;&gt;synchronized&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;) { &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.wait(); }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;so the problem could be the beginOp/endOp is not called in pair, the hole looks to be here:&lt;/p&gt;

&lt;p&gt;HRegion#internalFlushcache&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-comment&quot;&gt;// sync unflushed WAL changes when deferred log sync is enabled
&lt;/span&gt;    &lt;span class=&quot;code-comment&quot;&gt;// see HBASE-8208 &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; details
&lt;/span&gt;    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (wal != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; !shouldSyncLog()) {
      wal.sync();
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt; 

&lt;p&gt;at that point, wal.startCacheFlush-&amp;gt;closeBarrier.beginOp is called, but completeCacheFlush-&amp;gt;closeBarrier.endOp() is not protected by a try block..so if WAL/HDFS layer throws exception, the endOp will not be called.&lt;/p&gt;

&lt;p&gt;related info in log:&lt;/p&gt;


&lt;blockquote&gt;
&lt;p&gt;2014-09-03 13:38:03,789 ERROR org.apache.hadoop.hbase.regionserver.wal.FSHLog: Error while AsyncWriter write, request close of hlog&amp;lt;&lt;br/&gt;
java.io.IOException: All datanodes 10.246.2.103:50010 are bad. Aborting...&lt;br/&gt;
  at org.apache.hadoop.hdfs.DFSOutputStream$DataStreamer.setupPipelineForAppendOrRecovery(DFSOutputStream.java:1127)&lt;br/&gt;
  at org.apache.hadoop.hdfs.DFSOutputStream$DataStreamer.processDatanodeError(DFSOutputStream.java:924)&lt;br/&gt;
  at org.apache.hadoop.hdfs.DFSOutputStream$DataStreamer.run(DFSOutputStream.java:486)&lt;br/&gt;
2014-09-03 13:38:03,789 FATAL org.apache.hadoop.hbase.regionserver.wal.FSHLog: Error while AsyncSyncer sync, request close of hlog&amp;lt;&lt;br/&gt;
java.io.IOException: All datanodes 10.246.2.103:50010 are bad. Aborting...&lt;br/&gt;
  at org.apache.hadoop.hdfs.DFSOutputStream$DataStreamer.setupPipelineForAppendOrRecovery(DFSOutputStream.java:1127)&lt;br/&gt;
  at org.apache.hadoop.hdfs.DFSOutputStream$DataStreamer.processDatanodeError(DFSOutputStream.java:924)&lt;br/&gt;
  at org.apache.hadoop.hdfs.DFSOutputStream$DataStreamer.run(DFSOutputStream.java:486)&lt;br/&gt;
2014-09-03 13:38:03,799 ERROR org.apache.hadoop.hbase.regionserver.MemStoreFlusher: Cache flush failed for region page_content_queue,00166,1408946731655.8671b8a0f82565f88eb2ab8a5b53e84c.  //&amp;lt;==========MemStoreFlusher#flushRegion&lt;br/&gt;
java.io.IOException: All datanodes 10.246.2.103:50010 are bad. Aborting...&lt;/p&gt;&lt;/blockquote&gt;


&lt;p&gt;the exception thrown to caller should be here:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
FSHLog#syncer:

    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (txid &amp;lt;= &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.failedTxid.get()) {
        &lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; asyncIOE != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; :
          &lt;span class=&quot;code-quote&quot;&gt;&quot;current txid is among(under) failed txids, but asyncIOE is &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;!&quot;&lt;/span&gt;;
        &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; asyncIOE;
    }

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;the master branch can catch the hdfs exception, but it just ignore it, which looks incorrect:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (wal != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
        &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
          wal.sync(); &lt;span class=&quot;code-comment&quot;&gt;// ensure that flush marker is sync&apos;ed
&lt;/span&gt;        } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (IOException ioe) {
          LOG.warn(&lt;span class=&quot;code-quote&quot;&gt;&quot;Unexpected exception &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; wal.sync(), ignoring. Exception: &quot;&lt;/span&gt;
              + StringUtils.stringifyException(ioe));
        }
      }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Personally the exeception should not be ignored since it is severe hdfs error.&lt;/p&gt;</comment>
                            <comment id="14223989" author="tianq" created="Tue, 25 Nov 2014 03:16:26 +0000"  >&lt;p&gt;proposed fix for 0.98:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
--- hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java
+++ hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java
@@ -1760,7 +1760,13 @@ &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; class HRegion &lt;span class=&quot;code-keyword&quot;&gt;implements&lt;/span&gt; HeapSize { &lt;span class=&quot;code-comment&quot;&gt;// , Writable{
&lt;/span&gt;     &lt;span class=&quot;code-comment&quot;&gt;// sync unflushed WAL changes when deferred log sync is enabled
&lt;/span&gt;     &lt;span class=&quot;code-comment&quot;&gt;// see HBASE-8208 &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; details
&lt;/span&gt;     &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (wal != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; !shouldSyncLog()) {
-      wal.sync();
+      &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
+        wal.sync();
+      } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (IOException e) {
+         wal.abortCacheFlush(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.getRegionInfo().getEncodedNameAsBytes());
+         LOG.warn(&lt;span class=&quot;code-quote&quot;&gt;&quot;Unexpected exception &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; wal.sync(), re-&lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt;&quot;&lt;/span&gt;);
+         &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; e;
+      }
     }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;the master branch code writes ABORT_FLUSH log before we call wal.abortCacheFlush. so it is also needed if wal.sync aborts?&lt;/p&gt;

&lt;p&gt;also I am thinking about if we could make error injection test for such kind of failure which could mostly happen in real env but would not happen in UT?&lt;/p&gt;</comment>
                            <comment id="14223996" author="tianq" created="Tue, 25 Nov 2014 03:27:46 +0000"  >&lt;blockquote&gt;&lt;p&gt;the master branch code writes ABORT_FLUSH log before we call wal.abortCacheFlush. so it is also needed if wal.sync aborts?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;the wal write will fail in this case since it is severe HDFS failure..&lt;/p&gt;</comment>
                            <comment id="14224070" author="hadoopqa" created="Tue, 25 Nov 2014 05:12:32 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12683469/hbase11902-master.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12683469/hbase11902-master.patch&lt;/a&gt;&lt;br/&gt;
  against master branch at commit e83082a88816684714d8a563967046e582f9b8c7.&lt;br/&gt;
  ATTACHMENT ID: 12683469&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 tests included&lt;/font&gt;.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 checkstyle&lt;/font&gt;.  The applied patch does not increase the total number of checkstyle errors&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core tests&lt;/font&gt;.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.regionserver.wal.TestLogRolling&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11821//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11821//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11821//artifact/patchprocess/newPatchFindbugsWarningshbase-rest.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11821//artifact/patchprocess/newPatchFindbugsWarningshbase-rest.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11821//artifact/patchprocess/newPatchFindbugsWarningshbase-client.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11821//artifact/patchprocess/newPatchFindbugsWarningshbase-client.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11821//artifact/patchprocess/newPatchFindbugsWarningshbase-examples.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11821//artifact/patchprocess/newPatchFindbugsWarningshbase-examples.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11821//artifact/patchprocess/newPatchFindbugsWarningshbase-protocol.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11821//artifact/patchprocess/newPatchFindbugsWarningshbase-protocol.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11821//artifact/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11821//artifact/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11821//artifact/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11821//artifact/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11821//artifact/patchprocess/newPatchFindbugsWarningshbase-thrift.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11821//artifact/patchprocess/newPatchFindbugsWarningshbase-thrift.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11821//artifact/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11821//artifact/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11821//artifact/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11821//artifact/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11821//artifact/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11821//artifact/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11821//artifact/patchprocess/newPatchFindbugsWarningshbase-annotations.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11821//artifact/patchprocess/newPatchFindbugsWarningshbase-annotations.html&lt;/a&gt;&lt;br/&gt;
Checkstyle Errors: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11821//artifact/patchprocess/checkstyle-aggregate.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11821//artifact/patchprocess/checkstyle-aggregate.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;  Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11821//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11821//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14225962" author="tianq" created="Wed, 26 Nov 2014 09:47:22 +0000"  >&lt;p&gt;the TestLogRolling creates a similar error scenario with this case. &lt;/p&gt;

&lt;p&gt;the testcase failure is because of below code:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
      &lt;span class=&quot;code-comment&quot;&gt;// verify the written rows are there
&lt;/span&gt;      assertTrue(loggedRows.contains(&lt;span class=&quot;code-quote&quot;&gt;&quot;row1002&quot;&lt;/span&gt;));
      assertTrue(loggedRows.contains(&lt;span class=&quot;code-quote&quot;&gt;&quot;row1003&quot;&lt;/span&gt;));
      assertTrue(loggedRows.contains(&lt;span class=&quot;code-quote&quot;&gt;&quot;row1004&quot;&lt;/span&gt;));
      assertTrue(loggedRows.contains(&lt;span class=&quot;code-quote&quot;&gt;&quot;row1005&quot;&lt;/span&gt;));
      &lt;span class=&quot;code-comment&quot;&gt;// flush all regions
&lt;/span&gt;      List&amp;lt;HRegion&amp;gt; regions = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ArrayList&amp;lt;HRegion&amp;gt;(server.getOnlineRegionsLocalContext());
      &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (HRegion r: regions) {
        r.flushcache();                        &lt;span class=&quot;code-comment&quot;&gt;// &amp;lt;===the re-throwed exception will end the testcase
&lt;/span&gt;      }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;adding a try/catch for flushcache call make it pass.&lt;/p&gt;</comment>
                            <comment id="14227216" author="tianq" created="Thu, 27 Nov 2014 03:33:24 +0000"  >&lt;p&gt;There is much difference in WAL between master and 0.98 such as thread model, error handling. RS is aborted in case of HDFS failure in 0.98, but master branch ignores it and the write&amp;amp;sync thread continues..  make the patch simpler.&lt;/p&gt;

</comment>
                            <comment id="14227272" author="hadoopqa" created="Thu, 27 Nov 2014 05:21:21 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12683991/hbase11902-master_v2.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12683991/hbase11902-master_v2.patch&lt;/a&gt;&lt;br/&gt;
  against master branch at commit f0d95e7f11403d67b4fc3f1fd4ef048047b6842a.&lt;br/&gt;
  ATTACHMENT ID: 12683991&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 tests included&lt;/font&gt;.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 checkstyle&lt;/font&gt;.  The applied patch does not increase the total number of checkstyle errors&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core tests&lt;/font&gt;.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.regionserver.wal.TestLogRolling&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11851//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11851//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11851//artifact/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11851//artifact/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11851//artifact/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11851//artifact/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11851//artifact/patchprocess/newPatchFindbugsWarningshbase-examples.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11851//artifact/patchprocess/newPatchFindbugsWarningshbase-examples.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11851//artifact/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11851//artifact/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11851//artifact/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11851//artifact/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11851//artifact/patchprocess/newPatchFindbugsWarningshbase-rest.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11851//artifact/patchprocess/newPatchFindbugsWarningshbase-rest.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11851//artifact/patchprocess/newPatchFindbugsWarningshbase-protocol.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11851//artifact/patchprocess/newPatchFindbugsWarningshbase-protocol.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11851//artifact/patchprocess/newPatchFindbugsWarningshbase-client.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11851//artifact/patchprocess/newPatchFindbugsWarningshbase-client.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11851//artifact/patchprocess/newPatchFindbugsWarningshbase-thrift.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11851//artifact/patchprocess/newPatchFindbugsWarningshbase-thrift.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11851//artifact/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11851//artifact/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11851//artifact/patchprocess/newPatchFindbugsWarningshbase-annotations.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11851//artifact/patchprocess/newPatchFindbugsWarningshbase-annotations.html&lt;/a&gt;&lt;br/&gt;
Checkstyle Errors: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11851//artifact/patchprocess/checkstyle-aggregate.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11851//artifact/patchprocess/checkstyle-aggregate.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;  Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11851//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11851//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14227322" author="tianq" created="Thu, 27 Nov 2014 06:49:22 +0000"  >&lt;p&gt;ok. the latest failure is because, in the testcase, only WAL write fails, if we hide the exception( just decrement the counter) and continues, the data flush will succeed, so completeCacheFlush call decrement it again!.&lt;br/&gt;
to preserve the counter semantics, simple is the best &amp;#8212; return right away.(the original patch)&lt;/p&gt;</comment>
                            <comment id="14227440" author="tianq" created="Thu, 27 Nov 2014 09:37:21 +0000"  >&lt;p&gt;Local run passed.&lt;br/&gt;
based on &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-8208&quot; title=&quot;In some situations data is not replicated to slaves when deferredLogSync is enabled&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-8208&quot;&gt;&lt;del&gt;HBASE-8208&lt;/del&gt;&lt;/a&gt;(that is why wal.sync is introduced in memstore flush), we also need to fail the flush when getting HDFS failure.&lt;/p&gt;
</comment>
                            <comment id="14227542" author="hadoopqa" created="Thu, 27 Nov 2014 11:30:24 +0000"  >&lt;p&gt;&lt;font color=&quot;green&quot;&gt;+1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12684027/hbase11902-master_v3.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12684027/hbase11902-master_v3.patch&lt;/a&gt;&lt;br/&gt;
  against master branch at commit aa0bd50fd40d8090c5a98cbde063621eadd988f8.&lt;br/&gt;
  ATTACHMENT ID: 12684027&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 checkstyle&lt;/font&gt;.  The applied patch does not increase the total number of checkstyle errors&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 core tests&lt;/font&gt;.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11852//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11852//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11852//artifact/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11852//artifact/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11852//artifact/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11852//artifact/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11852//artifact/patchprocess/newPatchFindbugsWarningshbase-examples.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11852//artifact/patchprocess/newPatchFindbugsWarningshbase-examples.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11852//artifact/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11852//artifact/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11852//artifact/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11852//artifact/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11852//artifact/patchprocess/newPatchFindbugsWarningshbase-rest.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11852//artifact/patchprocess/newPatchFindbugsWarningshbase-rest.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11852//artifact/patchprocess/newPatchFindbugsWarningshbase-protocol.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11852//artifact/patchprocess/newPatchFindbugsWarningshbase-protocol.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11852//artifact/patchprocess/newPatchFindbugsWarningshbase-client.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11852//artifact/patchprocess/newPatchFindbugsWarningshbase-client.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11852//artifact/patchprocess/newPatchFindbugsWarningshbase-thrift.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11852//artifact/patchprocess/newPatchFindbugsWarningshbase-thrift.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11852//artifact/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11852//artifact/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11852//artifact/patchprocess/newPatchFindbugsWarningshbase-annotations.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11852//artifact/patchprocess/newPatchFindbugsWarningshbase-annotations.html&lt;/a&gt;&lt;br/&gt;
Checkstyle Errors: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11852//artifact/patchprocess/checkstyle-aggregate.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11852//artifact/patchprocess/checkstyle-aggregate.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;  Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11852//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11852//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14227976" author="victorunique" created="Thu, 27 Nov 2014 21:53:52 +0000"  >&lt;p&gt;Thanks, Qiang Tian. I guess you&apos;re right. I&apos;ll use this patch in my cluster and see if this problem happens again.&lt;/p&gt;</comment>
                            <comment id="14695194" author="ikeda" created="Thu, 13 Aug 2015 13:08:53 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (getValue(oldValAndFlags) == 1) &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt;; &lt;span class=&quot;code-comment&quot;&gt;// There were no operations outstanding.
&lt;/span&gt;    &lt;span class=&quot;code-keyword&quot;&gt;synchronized&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;) { &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.wait(); }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If DrainBarrier#endOp calls notifyAll just before the synchronized block, this may wait forever.&lt;br/&gt;
(BTW, some of tests for DrainBarrier are also required to fix because they catch AssertionError thrown by JUnit.)&lt;/p&gt;</comment>
                            <comment id="14696562" author="ikeda" created="Fri, 14 Aug 2015 06:34:10 +0000"  >&lt;p&gt;This &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-11902&quot; title=&quot;RegionServer was blocked while aborting&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-11902&quot;&gt;&lt;del&gt;HBASE-11902&lt;/del&gt;&lt;/a&gt; seems duplicate with &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13592&quot; title=&quot;RegionServer sometimes gets stuck during shutdown in case of cache flush failures&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13592&quot;&gt;&lt;del&gt;HBASE-13592&lt;/del&gt;&lt;/a&gt;, which has been resolved. &lt;br/&gt;
I have created a new issue &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-14222&quot; title=&quot;Improve DrainBarrier&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-14222&quot;&gt;HBASE-14222&lt;/a&gt; about DrainBarrier.&lt;/p&gt;</comment>
                            <comment id="14697821" author="stack" created="Fri, 14 Aug 2015 21:45:57 +0000"  >&lt;p&gt;Resolving as duplicate of &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13592&quot; title=&quot;RegionServer sometimes gets stuck during shutdown in case of cache flush failures&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13592&quot;&gt;&lt;del&gt;HBASE-13592&lt;/del&gt;&lt;/a&gt; as per &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ikeda&quot; class=&quot;user-hover&quot; rel=&quot;ikeda&quot;&gt;Hiroshi Ikeda&lt;/a&gt; recommendation (same stack trace stuck in same place). Thanks.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12666645" name="hbase-hadoop-regionserver-hadoop461.cm6.log" size="1790259" author="victorunique" created="Fri, 5 Sep 2014 03:00:08 +0000"/>
                            <attachment id="12683469" name="hbase11902-master.patch" size="1043" author="tianq" created="Tue, 25 Nov 2014 03:27:46 +0000"/>
                            <attachment id="12683991" name="hbase11902-master_v2.patch" size="800" author="tianq" created="Thu, 27 Nov 2014 03:33:24 +0000"/>
                            <attachment id="12684027" name="hbase11902-master_v3.patch" size="2051" author="tianq" created="Thu, 27 Nov 2014 09:37:21 +0000"/>
                            <attachment id="12666646" name="jstack_hadoop461.cm6.log" size="78452" author="victorunique" created="Fri, 5 Sep 2014 03:00:56 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 5 Sep 2014 05:36:23 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 16 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1zplb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>