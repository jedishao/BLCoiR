<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Thu Dec 01 22:02:34 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-13703/HBASE-13703.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-13703] ReplicateContext should not be a member of ReplicationSource</title>
                <link>https://issues.apache.org/jira/browse/HBASE-13703</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;The ReplicateContext object is created once per ReplicationSource and then reused when we have something to ship to the sinks.&lt;/p&gt;

&lt;p&gt;This is a misguided optimization. ReplicateContext is very lightweight (definitely compared to the all the work and copying the ReplicationSource is doing) and, crucially, it prevent the the entries array from being collected after it was successfully copied to the sink, wasting potentially a lot of heap.&lt;br/&gt;
The entries array itself holds reference to WAL entries on the heap, that now also cannot be collected.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12830525">HBASE-13703</key>
            <summary>ReplicateContext should not be a member of ReplicationSource</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="lhofhansl">Lars Hofhansl</assignee>
                                    <reporter username="lhofhansl">Lars Hofhansl</reporter>
                        <labels>
                    </labels>
                <created>Sun, 17 May 2015 20:09:09 +0000</created>
                <updated>Mon, 31 Aug 2015 22:39:34 +0000</updated>
                            <resolved>Fri, 22 May 2015 05:10:58 +0000</resolved>
                                                    <fixVersion>2.0.0</fixVersion>
                    <fixVersion>0.98.13</fixVersion>
                    <fixVersion>1.0.2</fixVersion>
                    <fixVersion>1.2.0</fixVersion>
                    <fixVersion>1.1.1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                <comments>
                            <comment id="14547325" author="lhofhansl" created="Sun, 17 May 2015 20:18:17 +0000"  >&lt;p&gt;Trivial patch. Just removes the replicateContext members, and creates the object where it is needed.&lt;br/&gt;
Please have a quick look. Is this needed as a member to better allow for custom replication implementations? (I don&apos;t think so, but would be cool if somebody could chime in).&lt;/p&gt;</comment>
                            <comment id="14547539" author="stack" created="Mon, 18 May 2015 05:15:34 +0000"  >&lt;p&gt;Makes sense to me.&lt;/p&gt;</comment>
                            <comment id="14547540" author="stack" created="Mon, 18 May 2015 05:16:04 +0000"  >&lt;p&gt;So we create one of these every time we ship an edit?&lt;/p&gt;</comment>
                            <comment id="14547553" author="lhofhansl" created="Mon, 18 May 2015 05:35:29 +0000"  >&lt;p&gt;Every time we ship a &lt;em&gt;chunk&lt;/em&gt; of edits to the sinks. That is after we:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;the made the &lt;tt&gt;entries&lt;/tt&gt; ArrayList&lt;/li&gt;
	&lt;li&gt;read through the WALs, added them all as references to &lt;tt&gt;entries&lt;/tt&gt;&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;In ReplicationEndpoint we then:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;copied all &lt;tt&gt;entries&lt;/tt&gt; to a new WAL.Entry[]&lt;/li&gt;
	&lt;li&gt;ship the WAL.Entry[] to the sinks&lt;/li&gt;
	&lt;li&gt;applied the edits to the sink&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;So that one object won&apos;t be a problem. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;But what will likely be a problem is the fact that all the WAL entries we read and added to the &lt;tt&gt;entries&lt;/tt&gt; array now cannot be GC&apos;d until we replicate something successfully the next time.&lt;/p&gt;

&lt;p&gt;We could achieve the same by calling &lt;tt&gt;replicateContext.setEntries(null);&lt;/tt&gt; in a finally block, after we successfully replicated. But frankly avoiding the allocation here looks like a premature optimization.&lt;/p&gt;</comment>
                            <comment id="14547558" author="ram_krish" created="Mon, 18 May 2015 05:37:52 +0000"  >&lt;p&gt;LGTM. The ReplicationContext is anyway passed to the ReplicationEndpoint and also the ReplicationSourceInterface does not try to create Replicationcontext as a member variable in the init() params.&lt;/p&gt;

&lt;p&gt;Also ReplicationContext object does not need any state variable from the ReplicatonSource where it is getting created (for now).  Even VisibilityReplicationEndpoint just tries to use the ReplicationContext that is passed to it via the replicate(ReplicationContext) API.  &lt;/p&gt;</comment>
                            <comment id="14548152" author="stack" created="Mon, 18 May 2015 15:19:22 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="14555584" author="lhofhansl" created="Fri, 22 May 2015 05:10:47 +0000"  >&lt;p&gt;Pushed to all branches (0.98, branch-1.0, branch-1.1, branch-1, master). Not sure what branch-1.1.0 is for (didn&apos;t push it there).&lt;/p&gt;</comment>
                            <comment id="14555659" author="hudson" created="Fri, 22 May 2015 06:26:29 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-1.2 #98 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-1.2/98/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-1.2/98/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13703&quot; title=&quot;ReplicateContext should not be a member of ReplicationSource&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13703&quot;&gt;&lt;del&gt;HBASE-13703&lt;/del&gt;&lt;/a&gt; ReplicateContext should not be a member of ReplicationSource. (larsh: rev e5df9bb2e2303d3b182ba80ee31e7fa155aa29fc)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/replication/ReplicationEndpoint.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSource.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14555694" author="hudson" created="Fri, 22 May 2015 06:54:27 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-1.0 #927 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-1.0/927/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-1.0/927/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13703&quot; title=&quot;ReplicateContext should not be a member of ReplicationSource&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13703&quot;&gt;&lt;del&gt;HBASE-13703&lt;/del&gt;&lt;/a&gt; ReplicateContext should not be a member of ReplicationSource. (larsh: rev fb09dead1d464d972adf14c018ad8edbc2aa5c2d)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/replication/ReplicationEndpoint.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSource.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14555754" author="hudson" created="Fri, 22 May 2015 07:31:06 +0000"  >&lt;p&gt;SUCCESS: Integrated in HBase-TRUNK #6508 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/6508/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/6508/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13703&quot; title=&quot;ReplicateContext should not be a member of ReplicationSource&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13703&quot;&gt;&lt;del&gt;HBASE-13703&lt;/del&gt;&lt;/a&gt; ReplicateContext should not be a member of ReplicationSource. (larsh: rev f8893e0012031a8c623d9da3839e757006878396)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/replication/ReplicationEndpoint.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSource.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14555763" author="hudson" created="Fri, 22 May 2015 07:37:54 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-1.1 #500 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-1.1/500/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-1.1/500/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13703&quot; title=&quot;ReplicateContext should not be a member of ReplicationSource&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13703&quot;&gt;&lt;del&gt;HBASE-13703&lt;/del&gt;&lt;/a&gt; ReplicateContext should not be a member of ReplicationSource. (larsh: rev 47c0105d65d3f1ec8ea5fdb0998f7c2965c09fa7)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSource.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/replication/ReplicationEndpoint.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14555855" author="hudson" created="Fri, 22 May 2015 08:58:02 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-0.98 #998 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.98/998/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.98/998/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13703&quot; title=&quot;ReplicateContext should not be a member of ReplicationSource&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13703&quot;&gt;&lt;del&gt;HBASE-13703&lt;/del&gt;&lt;/a&gt; ReplicateContext should not be a member of ReplicationSource. (larsh: rev 036c684e161fdfa1f4f7a612a412b0d894b91c64)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/replication/ReplicationEndpoint.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSource.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14555939" author="hudson" created="Fri, 22 May 2015 10:16:23 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-0.98-on-Hadoop-1.1 #949 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.98-on-Hadoop-1.1/949/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.98-on-Hadoop-1.1/949/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13703&quot; title=&quot;ReplicateContext should not be a member of ReplicationSource&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13703&quot;&gt;&lt;del&gt;HBASE-13703&lt;/del&gt;&lt;/a&gt; ReplicateContext should not be a member of ReplicationSource. (larsh: rev 036c684e161fdfa1f4f7a612a412b0d894b91c64)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/replication/ReplicationEndpoint.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSource.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14724194" author="enis" created="Mon, 31 Aug 2015 22:39:34 +0000"  >&lt;p&gt;Closing this issue after 1.0.2 release.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12733409" name="13703.txt" size="2482" author="lhofhansl" created="Sun, 17 May 2015 20:18:17 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 18 May 2015 05:15:34 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 13 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2eudr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>