<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 02 19:18:34 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-1513/HBASE-1513.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-1513] Compactions too slow</title>
                <link>https://issues.apache.org/jira/browse/HBASE-1513</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt; know there was some changes to compaction a few days back I just got back &lt;br/&gt;
to where I could run imports with the new client api&lt;br/&gt;
and noticing that compactions are vary slow I meand 100x+ slower then they &lt;br/&gt;
used to be I thought one of the servers compaction thread had died&lt;br/&gt;
but after retesting and ruleing that out. &lt;br/&gt;
I tested with and without compression and with and with out &lt;br/&gt;
blockcache and all are running about the same&lt;/p&gt;

&lt;p&gt;I got one small compaction to complete it took 1977 secs to compact 48.56MB&lt;br/&gt;
thats about 25kb sec&lt;/p&gt;</description>
                <environment></environment>
        <key id="12427779">HBASE-1513</key>
            <summary>Compactions too slow</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.png">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ryanobjc">ryan rawson</assignee>
                                    <reporter username="viper799">Billy Pearson</reporter>
                        <labels>
                    </labels>
                <created>Fri, 12 Jun 2009 19:42:57 +0000</created>
                <updated>Sun, 13 Sep 2009 22:24:42 +0000</updated>
                            <resolved>Mon, 15 Jun 2009 05:46:50 +0000</resolved>
                                    <version>0.20.0</version>
                                    <fixVersion>0.20.0</fixVersion>
                                    <component>regionserver</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12718956" author="stack" created="Fri, 12 Jun 2009 19:55:54 +0000"  >&lt;p&gt;Yes... something is going on.  Thanks for filing issue Billy.&lt;/p&gt;</comment>
                            <comment id="12719098" author="ryanobjc" created="Sat, 13 Jun 2009 08:55:25 +0000"  >&lt;p&gt;looks like the logic to do the minor compaction is too expensive during minor compactions.&lt;/p&gt;

&lt;p&gt;So I changed the minor compaction to offer an ability to just quickly iterate through a set of files.  It&apos;s REALLY fast now!&lt;/p&gt;</comment>
                            <comment id="12719100" author="ryanobjc" created="Sat, 13 Jun 2009 08:57:26 +0000"  >&lt;p&gt;minor compactor previously was too complex and did too much logic.  new one kicks ass.&lt;/p&gt;

&lt;p&gt;major compactions will be slow however (of course).&lt;/p&gt;</comment>
                            <comment id="12719122" author="viper799" created="Sat, 13 Jun 2009 14:18:43 +0000"  >&lt;p&gt;testing minor compaction &lt;br/&gt;
is major compaction going to be at the speed I seen above?&lt;br/&gt;
if so we still going to have major problems when you start talking about 256mb regions&lt;br/&gt;
256*1024/25kb/sec = 2.9 hours per region&lt;br/&gt;
that means running only major compactions we will only be able to major compact 8 regions a day not good for someone with 100 or so regions per server.&lt;/p&gt;

&lt;p&gt;Billy&lt;/p&gt;</comment>
                            <comment id="12719124" author="viper799" created="Sat, 13 Jun 2009 14:22:56 +0000"  >&lt;p&gt;+1 on minor compaction&lt;br/&gt;
1mins, 17sec for 103.3MB compaction = 1.34mb/s&lt;/p&gt;

&lt;p&gt;What has changed to slow down the old way of compaction all the logic test should be the same or similar? &lt;/p&gt;</comment>
                            <comment id="12719155" author="erikholstad@gmail.com" created="Sat, 13 Jun 2009 16:35:07 +0000"  >&lt;p&gt;@Ryan&lt;br/&gt;
What does the new minor compaction do and what does it not do? I.e what did you remove?&lt;/p&gt;</comment>
                            <comment id="12719194" author="ryanobjc" created="Sat, 13 Jun 2009 22:48:34 +0000"  >&lt;p&gt;the previous patch removed delete tracking, which was bad, and this one adds it back in.&lt;/p&gt;

&lt;p&gt;On my cluster I can compact 70mb in 7s.&lt;/p&gt;

&lt;p&gt;There may be a follow up bug &apos;major compaction too slow&apos;.&lt;/p&gt;</comment>
                            <comment id="12719206" author="viper799" created="Sat, 13 Jun 2009 23:34:36 +0000"  >&lt;p&gt;second patch will not apply to trunk&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
patching file src/java/org/apache/hadoop/hbase/regionserver/Store.java
Hunk #1 FAILED at 829.
1 out of 1 hunk FAILED -- saving rejects to file src/java/org/apache/hadoop/hbase/regionserver/Store.java.rej
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;My compaction was with compression so might be much faster without.&lt;/p&gt;</comment>
                            <comment id="12719288" author="streamy" created="Sun, 14 Jun 2009 15:42:24 +0000"  >&lt;p&gt;Billy, the codepath is very new for compactions in 0.20, not the same at all.  However, it should be able to be faster with the new stuff rather than slower we just need to spend more time optimizing.&lt;/p&gt;

&lt;p&gt;Opened &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-1521&quot; title=&quot;Optimize codepath for minor compactions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-1521&quot;&gt;&lt;del&gt;HBASE-1521&lt;/del&gt;&lt;/a&gt; for further optimizations (marked for 0.20.1 for now), this issue really about &quot;fixing&quot; slowness introduced.&lt;/p&gt;</comment>
                            <comment id="12719339" author="ryanobjc" created="Sun, 14 Jun 2009 21:52:54 +0000"  >&lt;p&gt;this one should apply correctly&lt;/p&gt;</comment>
                            <comment id="12719345" author="ryanobjc" created="Sun, 14 Jun 2009 22:18:21 +0000"  >&lt;p&gt;this one has the try/finally&lt;/p&gt;</comment>
                            <comment id="12719370" author="stack" created="Mon, 15 Jun 2009 02:22:54 +0000"  >&lt;p&gt;+1 on v4 (after some back and forth with Ryan on IRC)&lt;/p&gt;</comment>
                            <comment id="12720523" author="ryanobjc" created="Wed, 17 Jun 2009 06:52:19 +0000"  >&lt;p&gt;im seeing major compact speeds at about 10+ minutes per region.  the situation is not as dire as indicated, but we could probably be faster.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12410553" name="HBASE-1513-v2.patch" size="16001" author="ryanobjc" created="Sat, 13 Jun 2009 22:48:34 +0000"/>
                            <attachment id="12410605" name="HBASE-1513-v3.patch" size="15969" author="ryanobjc" created="Sun, 14 Jun 2009 21:52:54 +0000"/>
                            <attachment id="12410607" name="HBASE-1513-v4.patch" size="16321" author="ryanobjc" created="Sun, 14 Jun 2009 22:18:21 +0000"/>
                            <attachment id="12410536" name="HBASE-1513.patch" size="3059" author="ryanobjc" created="Sat, 13 Jun 2009 08:55:25 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 12 Jun 2009 19:55:54 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>25796</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 25 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0hdov:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>99480</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>