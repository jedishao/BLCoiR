<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 02 19:49:36 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-1500/HBASE-1500.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-1500] KeyValue$KeyComparator array overrun</title>
                <link>https://issues.apache.org/jira/browse/HBASE-1500</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
09/06/08 22:58:47 INFO zookeeper.ZooKeeper: Initiating client connection, host=B
OA03:2181,BOA02:2181,BOA01:2181,BOA04:2181 sessionTimeout=10000 watcher=org.apac
he.hadoop.hbase.zookeeper.WatcherWrapper@518bf072
09/06/08 22:58:47 INFO zookeeper.ClientCnxn: zookeeper.disableAutoWatchReset is
&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
09/06/08 22:58:47 INFO zookeeper.ClientCnxn: Attempting connection to server BOA
04/172.20.3.231:2181
09/06/08 22:58:47 INFO zookeeper.ClientCnxn: Priming connection to java.nio.chan
nels.SocketChannel[connected local=/172.20.3.232:40296 remote=BOA04/172.20.3.231
:2181]
09/06/08 22:58:47 INFO zookeeper.ClientCnxn: Server connection successful
09/06/08 22:58:47 WARN mapred.JobClient: Use GenericOptionsParser &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; parsing th
e arguments. Applications should implement Tool &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; the same.
09/06/08 22:58:47 WARN mapred.JobClient: No job jar file set.  User classes may
not be found. See JobConf(&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;) or JobConf#setJar(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;).
09/06/08 22:58:47 INFO zookeeper.ZooKeeper: Initiating client connection, host=B
OA03:2181,BOA02:2181,BOA01:2181,BOA04:2181 sessionTimeout=10000 watcher=org.apac
he.hadoop.hbase.zookeeper.WatcherWrapper@362f0d54
09/06/08 22:58:47 INFO zookeeper.ClientCnxn: Attempting connection to server BOA
03/172.20.3.230:2181
09/06/08 22:58:47 INFO zookeeper.ClientCnxn: Priming connection to java.nio.chan
nels.SocketChannel[connected local=/172.20.3.232:42792 remote=BOA03/172.20.3.230
:2181]
09/06/08 22:58:47 INFO zookeeper.ClientCnxn: Server connection successful
09/06/08 22:58:48 INFO mapred.TableInputFormatBase: split: 0-&amp;gt;BOA04.trendmicro.c
om:,01e33c601a7a9dd0ddb5c8427438f2f1
Exception in thread &lt;span class=&quot;code-quote&quot;&gt;&quot;main&quot;&lt;/span&gt; java.lang.ArrayIndexOutOfBoundsException: 32
        at org.apache.hadoop.hbase.util.Bytes.compareTo(Bytes.java:798)
        at org.apache.hadoop.hbase.KeyValue$KeyComparator.compareRows(KeyValue.j
ava:1760)
        at org.apache.hadoop.hbase.KeyValue$KeyComparator.compare(KeyValue.java:
1696)
        at org.apache.hadoop.hbase.KeyValue$KeyComparator.compare(KeyValue.java:
1755)
        at org.apache.hadoop.hbase.KeyValue$KeyComparator.compare(KeyValue.java:
1687)
        at org.apache.hadoop.hbase.client.HConnectionManager$TableServers.getCac
hedLocation(HConnectionManager.java:697)
        at org.apache.hadoop.hbase.client.HConnectionManager$TableServers.locate
RegionInMeta(HConnectionManager.java:541)
        at org.apache.hadoop.hbase.client.HConnectionManager$TableServers.locate
Region(HConnectionManager.java:525)
        at org.apache.hadoop.hbase.client.HConnectionManager$TableServers.locate
Region(HConnectionManager.java:488)
        at org.apache.hadoop.hbase.client.HConnectionManager$TableServers.getReg
ionLocation(HConnectionManager.java:342)
        at org.apache.hadoop.hbase.client.HTable.getRegionLocation(HTable.java:1
91)
        at org.apache.hadoop.hbase.mapred.TableInputFormatBase.getSplits(TableIn
putFormatBase.java:296)
        at org.apache.hadoop.mapred.JobClient.submitJob(JobClient.java:742)
        at org.apache.hadoop.mapred.JobClient.runJob(JobClient.java:1026)
        at net.iridiant.crawler.mapred.DocumentParser.main(Unknown Source)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12427414">HBASE-1500</key>
            <summary>KeyValue$KeyComparator array overrun</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.png">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ryanobjc">ryan rawson</assignee>
                                    <reporter username="apurtell">Andrew Purtell</reporter>
                        <labels>
                    </labels>
                <created>Mon, 8 Jun 2009 23:00:50 +0000</created>
                <updated>Sun, 13 Sep 2009 22:24:42 +0000</updated>
                            <resolved>Mon, 15 Jun 2009 05:48:04 +0000</resolved>
                                    <version>0.20.0</version>
                                    <fixVersion>0.20.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12718183" author="larsgeorge" created="Wed, 10 Jun 2009 20:16:58 +0000"  >&lt;p&gt;It looks like it happens here from the above&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; compare(&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[] left, &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; loffset, &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; llength, &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[] right,
        &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; roffset, &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; rlength) {
      &lt;span class=&quot;code-comment&quot;&gt;// Compare row
&lt;/span&gt;      &lt;span class=&quot;code-object&quot;&gt;short&lt;/span&gt; lrowlength = Bytes.toShort(left, loffset);
      &lt;span class=&quot;code-object&quot;&gt;short&lt;/span&gt; rrowlength = Bytes.toShort(right, roffset);
      &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; compare = compareRows(left, loffset + Bytes.SIZEOF_SHORT,
          lrowlength,
          right, roffset + Bytes.SIZEOF_SHORT, rrowlength);
      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (compare != 0) {
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; compare;
      }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It reads the lengths from the key byte array assuming they are correct and then applies those lengths to the compareRow() call, which then fails.&lt;/p&gt;

&lt;p&gt;This indicates a borked length from a key array? Could you instrument the code above and log the lrowlength, rrowlength and the the real left.length and right.length?&lt;/p&gt;

&lt;p&gt;If that mismatches, the question is why?&lt;/p&gt;</comment>
                            <comment id="12718307" author="apurtell" created="Thu, 11 Jun 2009 05:41:40 +0000"  >&lt;p&gt;This is pretty basic breakage. I inserted a few 1000 rows of data keyed with MD5 sums, then tried to run a count from the shell:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
count &apos;content&apos;
09/06/10 22:36:15 DEBUG client.HConnectionManager$TableServers: Cache hit &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; ro
w &amp;lt;&amp;gt; in tableName content: location server 192.168.56.1:39961, location region n
ame content,,1244694091453
09/06/10 22:36:15 DEBUG client.HConnectionManager$TableServers: Cache hit &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; ro
w &amp;lt;&amp;gt; in tableName .META.: location server 192.168.56.1:39961, location region na
me .META.,,1
09/06/10 22:36:15 DEBUG client.HTable$ClientScanner: Creating scanner over conte
nt starting at key &apos;&apos;
09/06/10 22:36:15 DEBUG client.HTable$ClientScanner: Advancing internal scanner
to startKey at &apos;&apos;
09/06/10 22:36:15 DEBUG client.HConnectionManager$TableServers: Cache hit &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; ro
w &amp;lt;&amp;gt; in tableName content: location server 192.168.56.1:39961, location region n
ame content,,1244694091453
09/06/10 22:36:17 DEBUG client.HConnectionManager$TableServers: address: 192.168
.56.1:39961, regioninfo: REGION =&amp;gt; {NAME =&amp;gt; &apos;content,,1244698495875&apos;, STARTKEY =
&amp;gt; &apos;&apos;, ENDKEY =&amp;gt; &apos;7f47a51d4f7a8c882288d86a4c5cdc3d&apos;, ENCODED =&amp;gt; 1221125875, TABLE
 =&amp;gt; {{NAME =&amp;gt; &apos;content&apos;, FAMILIES =&amp;gt; [{NAME =&amp;gt; &apos;content&apos;, VERSIONS =&amp;gt; &apos;1&apos;, COMPR
ESSION =&amp;gt; &apos;GZ&apos;, TTL =&amp;gt; &apos;2147483647&apos;, BLOCKSIZE =&amp;gt; &apos;65536&apos;, IN_MEMORY =&amp;gt; &apos;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&apos;,
 BLOCKCACHE =&amp;gt; &apos;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&apos;}, {NAME =&amp;gt; &apos;info&apos;, VERSIONS =&amp;gt; &apos;1&apos;, COMPRESSION =&amp;gt; &apos;NONE&apos;
, TTL =&amp;gt; &apos;2147483647&apos;, BLOCKSIZE =&amp;gt; &apos;65536&apos;, IN_MEMORY =&amp;gt; &apos;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&apos;, BLOCKCACHE =&amp;gt;
 &apos;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&apos;}, {NAME =&amp;gt; &apos;url&apos;, VERSIONS =&amp;gt; &apos;1&apos;, COMPRESSION =&amp;gt; &apos;NONE&apos;, TTL =&amp;gt; &apos;21474
83647&apos;, BLOCKSIZE =&amp;gt; &apos;65536&apos;, IN_MEMORY =&amp;gt; &apos;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&apos;, BLOCKCACHE =&amp;gt; &apos;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&apos;}]}}
Current count: 1000, row: 0a917eadf27f4917f1a823f085d1e4bd

Current count: 2000, row: 156d46ad656a85f47e4e8d50c23167e9

Current count: 3000, row: 1fef03d4744e5252dee5f44c36f74a00

Current count: 4000, row: 2a8376e2718993eab5a7aa3cfc769e42

Current count: 5000, row: 34e566f2cd7eb35ea2d7ce6bc2312638

Current count: 6000, row: 3f68045f0aae18f432e0de665909f202

Current count: 7000, row: 49c514099448cfd9609445b37f5b161f

Current count: 8000, row: 5476db74043ccf5e40cb7974e7c07c83

Current count: 9000, row: 5f3998658a477b7cbf806f4082643f2a

Current count: 10000, row: 69fd32fcf76f64116602def18248938b

Current count: 11000, row: 74be3000056b58b8b487c5243aadf02b

Current count: 12000, row: 7ef67ca4c45a28d90847288300f05d4a

Current count: 13000, row: 89783606fa73bcbf10a7b850bfa57877

Current count: 14000, row: 945c830a5eecd63e948e736deada42f3

Current count: 15000, row: 9f41e1454905fd7416f89aa4380a65e1

Current count: 16000, row: aa54517d0450127c90e4dd4631eaa010

Current count: 17000, row: b57b55373bf1302135dcefb044a58528

Current count: 18000, row: c06d66ca04ab273cc96f050ded843160

Current count: 19000, row: cb36f29c8d12098e25f007d7f658f495

Current count: 20000, row: d59d9e495fd2f983b302e67d94aa5962

Current count: 21000, row: e10430e1fda5ad363c72bb5ab7e7f8dd

Current count: 22000, row: ec1d2d9cc89cd8ec67ffa1db1f3a7474

Current count: 23000, row: f73d7cb9759f556b94aad178e6a6e0d5

09/06/10 22:37:24 DEBUG client.HTable$ClientScanner: Advancing forward from regi
on REGION =&amp;gt; {NAME =&amp;gt; &apos;content,,1244698495875&apos;, STARTKEY =&amp;gt; &apos;&apos;, ENDKEY =&amp;gt; &apos;7f47a
51d4f7a8c882288d86a4c5cdc3d&apos;, ENCODED =&amp;gt; 1221125875, TABLE =&amp;gt; {{NAME =&amp;gt; &apos;content
&apos;, FAMILIES =&amp;gt; [{NAME =&amp;gt; &apos;content&apos;, VERSIONS =&amp;gt; &apos;1&apos;, COMPRESSION =&amp;gt; &apos;GZ&apos;, TTL =&amp;gt;
 &apos;2147483647&apos;, BLOCKSIZE =&amp;gt; &apos;65536&apos;, IN_MEMORY =&amp;gt; &apos;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&apos;, BLOCKCACHE =&amp;gt; &apos;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&apos;
}, {NAME =&amp;gt; &apos;info&apos;, VERSIONS =&amp;gt; &apos;1&apos;, COMPRESSION =&amp;gt; &apos;NONE&apos;, TTL =&amp;gt; &apos;2147483647&apos;,
 BLOCKSIZE =&amp;gt; &apos;65536&apos;, IN_MEMORY =&amp;gt; &apos;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&apos;, BLOCKCACHE =&amp;gt; &apos;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&apos;}, {NAME =&amp;gt; &apos;u
rl&apos;, VERSIONS =&amp;gt; &apos;1&apos;, COMPRESSION =&amp;gt; &apos;NONE&apos;, TTL =&amp;gt; &apos;2147483647&apos;, BLOCKSIZE =&amp;gt; &apos;
65536&apos;, IN_MEMORY =&amp;gt; &apos;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&apos;, BLOCKCACHE =&amp;gt; &apos;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&apos;}]}}
09/06/10 22:37:24 DEBUG client.HTable$ClientScanner: Advancing internal scanner
to startKey at &apos;7f47a51d4f7a8c882288d86a4c5cdc3d&apos;
NativeException: java.lang.RuntimeException: org.apache.hadoop.hbase.client.Retr
iesExhaustedException: Trying to contact region server &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; region , row &apos;7f
47a51d4f7a8c882288d86a4c5cdc3d&apos;, but failed after 5 attempts.
Exceptions:
java.lang.ArrayIndexOutOfBoundsException: 32
java.lang.ArrayIndexOutOfBoundsException: 32
java.lang.ArrayIndexOutOfBoundsException: 32
java.lang.ArrayIndexOutOfBoundsException: 32
java.lang.ArrayIndexOutOfBoundsException: 32
        from org/apache/hadoop/hbase/client/HTable.java:2002:in `hasNext&apos;
        from sun.reflect.GeneratedMethodAccessor2:-1:in `invoke&apos;
        from sun/reflect/DelegatingMethodAccessorImpl.java:25:in `invoke&apos;
        from java/lang/reflect/Method.java:597:in `invoke&apos;
        from org/jruby/javasupport/JavaMethod.java:298:in `invokeWithExceptionHandling&apos;
        from org/jruby/javasupport/JavaMethod.java:259:in `invoke&apos;
        from org/jruby/java/invokers/InstanceMethodInvoker.java:36:in `call&apos;
        from org/jruby/runtime/callsite/CachingCallSite.java:70:in `call&apos;
        from org/jruby/ast/CallNoArgNode.java:61:in `interpret&apos;
        from org/jruby/ast/WhileNode.java:127:in `interpret&apos;
        from org/jruby/ast/NewlineNode.java:104:in `interpret&apos;
        from org/jruby/ast/BlockNode.java:71:in `interpret&apos;
        from org/jruby/internal/runtime/methods/InterpretedMethod.java:163:in `call&apos;
        from org/jruby/internal/runtime/methods/DefaultMethod.java:144:in `call&apos;
        from org/jruby/runtime/callsite/CachingCallSite.java:110:in `call&apos;
        from C_3a_/cygwin/opt/HBASE_minus_7e_1_dot_3/bin/hirb.rb:369:in `method_
_25$RUBY$count&apos;
... 106 levels...
        from C_3a_/cygwin/opt/HBASE_minus_7e_1_dot_3/bin/hirb#start:-1:in `call&apos;
        from org/jruby/internal/runtime/methods/DynamicMethod.java:226:in `call&apos;
        from org/jruby/internal/runtime/methods/CompiledMethod.java:211:in `call&apos;
        from org/jruby/internal/runtime/methods/CompiledMethod.java:71:in `call&apos;
        from org/jruby/runtime/callsite/CachingCallSite.java:253:in `cacheAndCall&apos;
        from org/jruby/runtime/callsite/CachingCallSite.java:72:in `call&apos;
        from C_3a_/cygwin/opt/HBASE_minus_7e_1_dot_3/bin/hirb.rb:450:in `__file__&apos;
        from C_3a_/cygwin/opt/HBASE_minus_7e_1_dot_3/bin/hirb.rb:-1:in `load&apos;
        from org/jruby/Ruby.java:577:in `runScript&apos;
        from org/jruby/Ruby.java:480:in `runNormally&apos;
        from org/jruby/Ruby.java:354:in `runFromMain&apos;
        from org/jruby/Main.java:229:in `run&apos;
        from org/jruby/Main.java:110:in `run&apos;
        from org/jruby/Main.java:94:in `main&apos;
        from C:\cygwin\opt\HBASE-~1.3\/bin/hirb.rb:369:in `count&apos;
        from (hbase):4
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12718312" author="apurtell" created="Thu, 11 Jun 2009 06:10:30 +0000"  >&lt;p&gt;Complete log from initialization through first split through failed count attached. Test environment runs master and regionserver in single process, uses local filesystem, is fed by a Heritrix instance. &lt;/p&gt;</comment>
                            <comment id="12718644" author="apurtell" created="Thu, 11 Jun 2009 21:26:50 +0000"  >&lt;p&gt;To reproduce, run the attached script using the latest trunk.&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;./bin/hbase shell test.rb&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;Wait for the split to finish. Then, try a count:&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;./bin/hbase shell&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;hbase&amp;gt; count &apos;test&apos;&lt;/tt&gt;&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
count &apos;test&apos;

09/06/11 14:23:32 DEBUG client.HConnectionManager$TableServers: address: 192.168
.56.1:22720, regioninfo: REGION =&amp;gt; {NAME =&amp;gt; &apos;test,,1244755386281&apos;, STARTKEY =&amp;gt; &apos;
&apos;, ENDKEY =&amp;gt; &apos;7fd99653bf71ea6c747d34db7846c708&apos;, ENCODED =&amp;gt; 1840196805, TABLE =&amp;gt;
 {{NAME =&amp;gt; &apos;test&apos;, FAMILIES =&amp;gt; [{NAME =&amp;gt; &apos;content&apos;, VERSIONS =&amp;gt; &apos;3&apos;, COMPRESSION
 =&amp;gt; &apos;NONE&apos;, TTL =&amp;gt; &apos;2147483647&apos;, BLOCKSIZE =&amp;gt; &apos;65536&apos;, IN_MEMORY =&amp;gt; &apos;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&apos;, BLO
CKCACHE =&amp;gt; &apos;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&apos;}, {NAME =&amp;gt; &apos;info&apos;, VERSIONS =&amp;gt; &apos;3&apos;, COMPRESSION =&amp;gt; &apos;NONE&apos;, TT
L =&amp;gt; &apos;2147483647&apos;, BLOCKSIZE =&amp;gt; &apos;65536&apos;, IN_MEMORY =&amp;gt; &apos;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&apos;, BLOCKCACHE =&amp;gt; &apos;fa
lse&apos;}]}}
09/06/11 14:23:32 DEBUG client.HConnectionManager$TableServers: Cache hit &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; ro
w &amp;lt;&amp;gt; in tableName .META.: location server 192.168.56.1:22720, location region na
me .META.,,1
09/06/11 14:23:32 DEBUG client.HTable$ClientScanner: Creating scanner over test
starting at key &apos;&apos;
09/06/11 14:23:32 DEBUG client.HTable$ClientScanner: Advancing internal scanner
to startKey at &apos;&apos;
09/06/11 14:23:32 DEBUG client.HConnectionManager$TableServers: Cache hit &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; ro
w &amp;lt;&amp;gt; in tableName test: location server 192.168.56.1:22720, location region name
 test,,1244755386281
Current count: 1000, row: ffe83c9f18ab2f057cd6435f04228377

09/06/11 14:23:33 DEBUG client.HTable$ClientScanner: Advancing forward from regi
on REGION =&amp;gt; {NAME =&amp;gt; &apos;test,,1244755386281&apos;, STARTKEY =&amp;gt; &apos;&apos;, ENDKEY =&amp;gt; &apos;7fd99653
bf71ea6c747d34db7846c708&apos;, ENCODED =&amp;gt; 1840196805, TABLE =&amp;gt; {{NAME =&amp;gt; &apos;test&apos;, FAM
ILIES =&amp;gt; [{NAME =&amp;gt; &apos;content&apos;, VERSIONS =&amp;gt; &apos;3&apos;, COMPRESSION =&amp;gt; &apos;NONE&apos;, TTL =&amp;gt; &apos;21
47483647&apos;, BLOCKSIZE =&amp;gt; &apos;65536&apos;, IN_MEMORY =&amp;gt; &apos;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&apos;, BLOCKCACHE =&amp;gt; &apos;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&apos;}, {
NAME =&amp;gt; &apos;info&apos;, VERSIONS =&amp;gt; &apos;3&apos;, COMPRESSION =&amp;gt; &apos;NONE&apos;, TTL =&amp;gt; &apos;2147483647&apos;, BLO
CKSIZE =&amp;gt; &apos;65536&apos;, IN_MEMORY =&amp;gt; &apos;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&apos;, BLOCKCACHE =&amp;gt; &apos;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&apos;}]}}
09/06/11 14:23:33 DEBUG client.HTable$ClientScanner: Advancing internal scanner
to startKey at &apos;7fd99653bf71ea6c747d34db7846c708&apos;
NativeException: java.lang.RuntimeException: org.apache.hadoop.hbase.client.Retr
iesExhaustedException: Trying to contact region server &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; region , row &apos;7f
d99653bf71ea6c747d34db7846c708&apos;, but failed after 5 attempts.
Exceptions:
java.lang.ArrayIndexOutOfBoundsException: 32
java.lang.ArrayIndexOutOfBoundsException: 32
java.lang.ArrayIndexOutOfBoundsException: 32
java.lang.ArrayIndexOutOfBoundsException: 32
java.lang.ArrayIndexOutOfBoundsException: 32
        from org/apache/hadoop/hbase/client/HTable.java:2002:in `hasNext&apos;
        from sun.reflect.GeneratedMethodAccessor2:-1:in `invoke&apos;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Probably the script does a bit more than is strictly necessary to reproduce. &lt;/p&gt;

&lt;p&gt;Attached also is the master+regionserver log at DEBUG level from the test. &lt;/p&gt;</comment>
                            <comment id="12718746" author="larsgeorge" created="Fri, 12 Jun 2009 07:11:53 +0000"  >&lt;p&gt;Just asking Andrew, since you lost me here a bit, the initial issue with the comparator and the first log dump, what has that do with the later client based issues? When I check you first set of logs there were hardly any issues (in terms of exceptions) in it. How does this all fit together? Sorry for being thick.&lt;/p&gt;</comment>
                            <comment id="12718949" author="apurtell" created="Fri, 12 Jun 2009 19:22:35 +0000"  >&lt;p&gt;Some detail I added up on IRC:&lt;/p&gt;

&lt;p&gt;&amp;lt;apurtell&amp;gt;	i was wondering if it was just me...&lt;br/&gt;
&amp;lt;apurtell&amp;gt;	yeah would be great if someone else can confirm the repro works for them...&lt;br/&gt;
&amp;lt;apurtell&amp;gt;	what&apos;s odd is the shell&apos;s count of all the rows comes back before it even tries to advance the scanner to the next split. some kind of META sort problem, parent region coming back before daughter? i&apos;d like to dig in but this code is all new to me&lt;br/&gt;
&amp;lt;apurtell&amp;gt;	in the repro case, the split is triggered and confirmed, so there is more than one region...&lt;br/&gt;
&amp;lt;apurtell&amp;gt;	this is the same basic problem as with TableSplit, iterating over META is going off the rails, giving bad results, triggering the out of bounds exception&lt;br/&gt;
&amp;lt;apurtell&amp;gt;	at least this is what it looks like to me&lt;br/&gt;
&amp;lt;apurtell&amp;gt;	started immediately after commit of 1304&lt;br/&gt;
&amp;lt;apurtell&amp;gt;	noticed it first while testing stargate scanners, scanners hang/crash/fail on tables with more than one region&lt;/p&gt;
</comment>
                            <comment id="12719173" author="apurtell" created="Sat, 13 Jun 2009 18:58:06 +0000"  >&lt;p&gt;Testing with patch for &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-1495&quot; title=&quot;IllegalArgumentException in halfhfilereader#next&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-1495&quot;&gt;&lt;del&gt;HBASE-1495&lt;/del&gt;&lt;/a&gt; changes the behavior of the test case some. The iteration of regions seems in order now, but the AIOBE remains.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Version: 0.20.0-dev, r784310, Sat Jun 13 18:51:23 UTC 2009
hbase(main):001:0&amp;gt; count &apos;test&apos;
09/06/13 18:54:14 INFO zookeeper.ZooKeeperWrapper: Quorum servers: localhost:2181
NativeException: java.lang.RuntimeException: org.apache.hadoop.hbase.client.
RetriesExhaustedException: Trying to contact region server &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; region , row
&apos;86d6531b7fd76860445f8ffd1a0461fc&apos;, but failed after 5 attempts.
Exceptions:
java.lang.ArrayIndexOutOfBoundsException: 32
java.lang.ArrayIndexOutOfBoundsException: 32
java.lang.ArrayIndexOutOfBoundsException: 32
java.lang.ArrayIndexOutOfBoundsException: 32
java.lang.ArrayIndexOutOfBoundsException: 32
        from org/apache/hadoop/hbase/client/HTable.java:2000:in `hasNext&apos;
        from sun.reflect.GeneratedMethodAccessor2:-1:in `invoke&apos;
        from sun/reflect/DelegatingMethodAccessorImpl.java:25:in `invoke&apos;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12719228" author="ryanobjc" created="Sun, 14 Jun 2009 07:44:44 +0000"  >&lt;p&gt;this might be related to &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-1503&quot; title=&quot;hbase-1304 dropped updating list of store files on flush&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-1503&quot;&gt;&lt;del&gt;HBASE-1503&lt;/del&gt;&lt;/a&gt; - the hfile might be going bad during a compaction and or split.&lt;/p&gt;

&lt;p&gt;I saw this on a concurrent insert/count on my own cluster.&lt;/p&gt;

&lt;p&gt;Either the data is bad (hmm) or the hfile is having a problem?&lt;/p&gt;</comment>
                            <comment id="12719229" author="ryanobjc" created="Sun, 14 Jun 2009 07:48:26 +0000"  >&lt;p&gt;the regionserver logs say something like so:&lt;/p&gt;

&lt;p&gt;2009-06-14 00:44:43,751 ERROR org.apache.hadoop.hbase.regionserver.HRegionServer: java.lang.NullPointerException&lt;br/&gt;
2009-06-14 00:44:43,752 INFO org.apache.hadoop.ipc.HBaseServer: IPC Server handler 2 on 60021, call next(-1247002001233657007, 30) from 10.10.20.13:36528: error: java.io.IOExc&lt;br/&gt;
eption: java.lang.NullPointerException&lt;br/&gt;
java.io.IOException: java.lang.NullPointerException&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.HRegionServer.convertThrowableToIOE(HRegionServer.java:832)        at org.apache.hadoop.hbase.regionserver.HRegionServer.convertThrowableToIOE(HRegionServer.java:822)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.HRegionServer.next(HRegionServer.java:1889)&lt;br/&gt;
        at sun.reflect.GeneratedMethodAccessor5.invoke(Unknown Source)&lt;br/&gt;
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
        at java.lang.reflect.Method.invoke(Method.java:597)&lt;br/&gt;
        at org.apache.hadoop.hbase.ipc.HBaseRPC$Server.call(HBaseRPC.java:643)&lt;br/&gt;
        at org.apache.hadoop.hbase.ipc.HBaseServer$Handler.run(HBaseServer.java:913)&lt;br/&gt;
Caused by: java.lang.NullPointerException&lt;br/&gt;
        at org.apache.hadoop.hbase.io.hfile.BoundedRangeFileInputStream.read(BoundedRangeFileInputStream.java:97)&lt;br/&gt;
        at org.apache.hadoop.hbase.io.hfile.BoundedRangeFileInputStream.read(BoundedRangeFileInputStream.java:85)&lt;br/&gt;
        at org.apache.hadoop.hbase.io.hfile.BoundedRangeFileInputStream.read(BoundedRangeFileInputStream.java:78)&lt;br/&gt;
        at org.apache.hadoop.io.compress.BlockDecompressorStream.rawReadInt(BlockDecompressorStream.java:120)&lt;br/&gt;
        at org.apache.hadoop.io.compress.BlockDecompressorStream.decompress(BlockDecompressorStream.java:66)&lt;br/&gt;
        at org.apache.hadoop.io.compress.DecompressorStream.read(DecompressorStream.java:74)&lt;br/&gt;
        at java.io.BufferedInputStream.read1(BufferedInputStream.java:256)&lt;br/&gt;
        at java.io.BufferedInputStream.read(BufferedInputStream.java:317)&lt;br/&gt;
        at org.apache.hadoop.io.IOUtils.readFully(IOUtils.java:100)        at org.apache.hadoop.hbase.io.hfile.HFile$Reader.decompress(HFile.java:951)&lt;br/&gt;
        at org.apache.hadoop.hbase.io.hfile.HFile$Reader.readBlock(HFile.java:907)&lt;br/&gt;
        at org.apache.hadoop.hbase.io.hfile.HFile$Reader$Scanner.next(HFile.java:1082)        at org.apache.hadoop.hbase.regionserver.StoreFileScanner.next(StoreFileScanner.java:56)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.KeyValueHeap.next(KeyValueHeap.java:79)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.StoreScanner.next(StoreScanner.java:140)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.KeyValueHeap.next(KeyValueHeap.java:106)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.HRegion$RegionScanner.next(HRegion.java:1716)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.HRegionServer.next(HRegionServer.java:1878)&lt;br/&gt;
        ... 5 more&lt;br/&gt;
2009-06-14 00:44:45,757 ERROR org.apache.hadoop.hbase.regionserver.HRegionServer: java.lang.IllegalArgumentException&lt;br/&gt;
2009-06-14 00:44:45,758 INFO org.apache.hadoop.ipc.HBaseServer: IPC Server handler 5 on 60021, call next(-1247002001233657007, 30) from 10.10.20.13:36528: error: java.io.IOExc&lt;br/&gt;
eption: java.lang.IllegalArgumentException&lt;br/&gt;
java.io.IOException: java.lang.IllegalArgumentException&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.HRegionServer.convertThrowableToIOE(HRegionServer.java:832)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.HRegionServer.convertThrowableToIOE(HRegionServer.java:822)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.HRegionServer.next(HRegionServer.java:1889)&lt;br/&gt;
        at sun.reflect.GeneratedMethodAccessor5.invoke(Unknown Source)&lt;br/&gt;
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
        at java.lang.reflect.Method.invoke(Method.java:597)        at org.apache.hadoop.hbase.ipc.HBaseRPC$Server.call(HBaseRPC.java:643)&lt;br/&gt;
        at org.apache.hadoop.hbase.ipc.HBaseServer$Handler.run(HBaseServer.java:913)&lt;br/&gt;
Caused by: java.lang.IllegalArgumentException&lt;br/&gt;
        at java.nio.Buffer.position(Buffer.java:218)        at org.apache.hadoop.hbase.io.hfile.HFile$Reader$Scanner.next(HFile.java:1073)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.StoreFileScanner.next(StoreFileScanner.java:56)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.KeyValueHeap.next(KeyValueHeap.java:79)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.StoreScanner.next(StoreScanner.java:140)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.KeyValueHeap.next(KeyValueHeap.java:106)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.HRegion$RegionScanner.next(HRegion.java:1716)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.HRegionServer.next(HRegionServer.java:1878)&lt;br/&gt;
        ... 5 more&lt;br/&gt;
2009-06-14 00:44:47,762 ERROR org.apache.hadoop.hbase.regionserver.HRegionServer: java.lang.NegativeArraySizeException&lt;br/&gt;
2009-06-14 00:44:47,763 INFO org.apache.hadoop.ipc.HBaseServer: IPC Server handler 4 on 60021, call next(-1247002001233657007, 30) from 10.10.20.13:36528: error: java.io.IOException: java.lang.NegativeArraySizeException&lt;br/&gt;
java.io.IOException: java.lang.NegativeArraySizeException&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.HRegionServer.convertThrowableToIOE(HRegionServer.java:832)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.HRegionServer.convertThrowableToIOE(HRegionServer.java:822)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.HRegionServer.next(HRegionServer.java:1889)&lt;br/&gt;
        at sun.reflect.GeneratedMethodAccessor5.invoke(Unknown Source)&lt;br/&gt;
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
        at java.lang.reflect.Method.invoke(Method.java:597)&lt;br/&gt;
        at org.apache.hadoop.hbase.ipc.HBaseRPC$Server.call(HBaseRPC.java:643)&lt;br/&gt;
        at org.apache.hadoop.hbase.ipc.HBaseServer$Handler.run(HBaseServer.java:913)&lt;br/&gt;
Caused by: java.lang.NegativeArraySizeException&lt;br/&gt;
        at org.apache.hadoop.hbase.KeyValue.getRow(KeyValue.java:890)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.HRegion$RegionScanner.next(HRegion.java:1708)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.HRegionServer.next(HRegionServer.java:1878)&lt;br/&gt;
        ... 5 more&lt;/p&gt;

&lt;p&gt;then we get the negative array size exceptions from then on out.  very strange.&lt;/p&gt;

&lt;p&gt;this seems very related to 1503.  I wonder how we can fix up hfile to be less errorful.&lt;/p&gt;</comment>
                            <comment id="12719240" author="ryanobjc" created="Sun, 14 Jun 2009 08:47:09 +0000"  >&lt;p&gt;i see this on my laptop.  looks like the scanner is returning a null item in an array at some point which needless to say isnt handy.&lt;/p&gt;</comment>
                            <comment id="12719241" author="ryanobjc" created="Sun, 14 Jun 2009 10:04:28 +0000"  >&lt;p&gt;here&apos;s a fix to the problem.  I verified it fixes it.&lt;/p&gt;

&lt;p&gt;Thanks for the great bug report apurtell, complete with single-machine repro test case!&lt;/p&gt;

&lt;p&gt;Enjoy the fix.&lt;/p&gt;</comment>
                            <comment id="12719296" author="apurtell" created="Sun, 14 Jun 2009 16:30:30 +0000"  >&lt;p&gt;+1 confirmed fix. &lt;/p&gt;</comment>
                            <comment id="12719373" author="stack" created="Mon, 15 Jun 2009 02:29:42 +0000"  >&lt;p&gt;+1&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
02:27 &amp;lt; St^Ack&amp;gt; why 1500 change getComparator?
02:27 &amp;lt; dj_ryan&amp;gt; heh
02:27 &amp;lt; dj_ryan&amp;gt; it fixes 1500
02:27 &amp;lt; dj_ryan&amp;gt; here&apos;s why
02:27 &amp;lt; dj_ryan&amp;gt; the old code
02:27 &amp;lt; dj_ryan&amp;gt; was treating the rowkey
02:27 &amp;lt; dj_ryan&amp;gt; as a _full_ KeyValue key
02:27 &amp;lt; dj_ryan&amp;gt; and was decoding ints
02:27 &amp;lt; dj_ryan&amp;gt; to figure out the length of thw row part
02:27 &amp;lt; dj_ryan&amp;gt; but we just wanted to compare the row portion
02:28 &amp;lt; St^Ack&amp;gt; oh
02:28 &amp;lt; St^Ack&amp;gt; bad
02:29 &amp;lt; dj_ryan&amp;gt; yes
02:29 &amp;lt; dj_ryan&amp;gt; very very bad

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12410566" name="HBASE-1500.patch" size="2084" author="ryanobjc" created="Sun, 14 Jun 2009 10:04:27 +0000"/>
                            <attachment id="12410361" name="hbase.log.gz" size="671898" author="apurtell" created="Thu, 11 Jun 2009 06:10:30 +0000"/>
                            <attachment id="12410431" name="test.log.gz" size="6697" author="apurtell" created="Thu, 11 Jun 2009 21:26:50 +0000"/>
                            <attachment id="12410430" name="test.rb" size="1229" author="apurtell" created="Thu, 11 Jun 2009 21:26:50 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 10 Jun 2009 20:16:58 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>25791</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 25 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0hdmf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>99469</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>