<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Thu Dec 01 22:29:43 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-14178/HBASE-14178.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-14178] regionserver blocks because of waiting for offsetLock</title>
                <link>https://issues.apache.org/jira/browse/HBASE-14178</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;My regionserver blocks, and all client rpc timeout. &lt;/p&gt;

&lt;p&gt;I print the regionserver&apos;s jstack,  it seems a lot of threads were blocked for waiting offsetLock, detail infomation belows:&lt;/p&gt;

&lt;p&gt;PS:  my table&apos;s block cache is off&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-quote&quot;&gt;&quot;B.DefaultRpcServer.handler=2,queue=2,port=60020&quot;&lt;/span&gt; #82 daemon prio=5 os_prio=0 tid=0x0000000001827000 nid=0x2cdc in &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;.wait() [0x00007f3831b72000]
   java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.State: WAITING (on object monitor)
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;.wait(Native Method)
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;.wait(&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;.java:502)
        at org.apache.hadoop.hbase.util.IdLock.getLockEntry(IdLock.java:79)
        - locked &amp;lt;0x0000000773af7c18&amp;gt; (a org.apache.hadoop.hbase.util.IdLock$Entry)
        at org.apache.hadoop.hbase.io.hfile.HFileReaderV2.readBlock(HFileReaderV2.java:352)
        at org.apache.hadoop.hbase.io.hfile.HFileBlockIndex$BlockIndexReader.loadDataBlockWithScanInfo(HFileBlockIndex.java:253)
        at org.apache.hadoop.hbase.io.hfile.HFileReaderV2$AbstractScannerV2.seekTo(HFileReaderV2.java:524)
        at org.apache.hadoop.hbase.io.hfile.HFileReaderV2$AbstractScannerV2.reseekTo(HFileReaderV2.java:572)
        at org.apache.hadoop.hbase.regionserver.StoreFileScanner.reseekAtOrAfter(StoreFileScanner.java:257)
        at org.apache.hadoop.hbase.regionserver.StoreFileScanner.reseek(StoreFileScanner.java:173)
        at org.apache.hadoop.hbase.regionserver.NonLazyKeyValueScanner.doRealSeek(NonLazyKeyValueScanner.java:55)
        at org.apache.hadoop.hbase.regionserver.KeyValueHeap.generalizedSeek(KeyValueHeap.java:313)
        at org.apache.hadoop.hbase.regionserver.KeyValueHeap.requestSeek(KeyValueHeap.java:269)
        at org.apache.hadoop.hbase.regionserver.StoreScanner.reseek(StoreScanner.java:695)
        at org.apache.hadoop.hbase.regionserver.StoreScanner.seekAsDirection(StoreScanner.java:683)
        at org.apache.hadoop.hbase.regionserver.StoreScanner.next(StoreScanner.java:533)
        at org.apache.hadoop.hbase.regionserver.KeyValueHeap.next(KeyValueHeap.java:140)
        at org.apache.hadoop.hbase.regionserver.HRegion$RegionScannerImpl.populateResult(HRegion.java:3889)
        at org.apache.hadoop.hbase.regionserver.HRegion$RegionScannerImpl.nextInternal(HRegion.java:3969)
        at org.apache.hadoop.hbase.regionserver.HRegion$RegionScannerImpl.nextRaw(HRegion.java:3847)
        at org.apache.hadoop.hbase.regionserver.HRegion$RegionScannerImpl.next(HRegion.java:3820)
        - locked &amp;lt;0x00000005e5c55ad0&amp;gt; (a org.apache.hadoop.hbase.regionserver.HRegion$RegionScannerImpl)
        at org.apache.hadoop.hbase.regionserver.HRegion$RegionScannerImpl.next(HRegion.java:3807)
        at org.apache.hadoop.hbase.regionserver.HRegion.get(HRegion.java:4779)
        at org.apache.hadoop.hbase.regionserver.HRegion.get(HRegion.java:4753)
        at org.apache.hadoop.hbase.regionserver.HRegionServer.get(HRegionServer.java:2916)
        at org.apache.hadoop.hbase.protobuf.generated.ClientProtos$ClientService$2.callBlockingMethod(ClientProtos.java:29583)
        at org.apache.hadoop.hbase.ipc.RpcServer.call(RpcServer.java:2027)
        at org.apache.hadoop.hbase.ipc.CallRunner.run(CallRunner.java:108)
        at org.apache.hadoop.hbase.ipc.RpcExecutor.consumerLoop(RpcExecutor.java:114)
        at org.apache.hadoop.hbase.ipc.RpcExecutor$1.run(RpcExecutor.java:94)
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745)

   Locked ownable synchronizers:
        - &amp;lt;0x00000005e5c55c08&amp;gt; (a java.util.concurrent.locks.ReentrantLock$NonfairSync)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
</description>
                <environment></environment>
        <key id="12850819">HBASE-14178</key>
            <summary>regionserver blocks because of waiting for offsetLock</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="chenheng">Heng Chen</assignee>
                                    <reporter username="chenheng">Heng Chen</reporter>
                        <labels>
                    </labels>
                <created>Sun, 2 Aug 2015 07:51:58 +0000</created>
                <updated>Mon, 31 Aug 2015 22:39:42 +0000</updated>
                            <resolved>Thu, 6 Aug 2015 09:22:39 +0000</resolved>
                                    <version>0.98.6</version>
                                    <fixVersion>2.0.0</fixVersion>
                    <fixVersion>0.98.14</fixVersion>
                    <fixVersion>1.0.2</fixVersion>
                    <fixVersion>1.2.0</fixVersion>
                    <fixVersion>1.1.2</fixVersion>
                                    <component>regionserver</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>10</watches>
                                                                <comments>
                            <comment id="14650632" author="chenheng" created="Sun, 2 Aug 2015 07:54:41 +0000"  >&lt;p&gt;This is the whole jstack &lt;/p&gt;</comment>
                            <comment id="14650634" author="chenheng" created="Sun, 2 Aug 2015 07:58:58 +0000"  >&lt;p&gt;And when hbase client timeout begin,  i found some WARN in  regionserver&apos;s log like below:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2015-08-02 11:22:31,091 WARN  [B.DefaultRpcServer.handler=10,queue=1,port=60020] ipc.RpcServer: RpcServer.respondercallId: 2003001 service: ClientService methodName: Multi size: 606 connection: 10.11.11.151:39022: output error
2015-08-02 11:22:31,092 WARN  [B.DefaultRpcServer.handler=10,queue=1,port=60020] ipc.RpcServer: B.DefaultRpcServer.handler=10,queue=1,port=60020: caught a ClosedChannelException, &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; means that the server was processing a request but the client went away. The error message was: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
2015-08-02 11:22:39,728 DEBUG [LruStats #0] hfile.LruBlockCache: Total=2.98 GB, free=160.88 MB, max=3.14 GB, blocks=3373164288, accesses=72835847, hits=45919402, hitRatio=63.05%, , cachingAccesses=67264519, cachingHits=45352036, cachingHitsRatio=67.42%, evictions=289532, evicted=1080418, evictedPerRun=3.7316012382507324
2015-08-02 11:24:19,922 WARN  [B.DefaultRpcServer.handler=0,queue=0,port=60020] ipc.RpcServer: RpcServer.respondercallId: 2005736 service: ClientService methodName: Multi size: 606 connection: 10.11.11.152:2419: output error
2015-08-02 11:24:19,924 WARN  [B.DefaultRpcServer.handler=0,queue=0,port=60020] ipc.RpcServer: B.DefaultRpcServer.handler=0,queue=0,port=60020: caught: java.io.IOException: Connection reset by peer
        at sun.nio.ch.FileDispatcherImpl.writev0(Native Method)
        at sun.nio.ch.SocketDispatcher.writev(SocketDispatcher.java:51)
        at sun.nio.ch.IOUtil.write(IOUtil.java:148)
        at sun.nio.ch.SocketChannelImpl.write(SocketChannelImpl.java:503)
        at org.apache.hadoop.hbase.ipc.BufferChain.write(BufferChain.java:106)
        at org.apache.hadoop.hbase.ipc.RpcServer.channelWrite(RpcServer.java:2224)
        at org.apache.hadoop.hbase.ipc.RpcServer$Responder.processResponse(RpcServer.java:1012)
        at org.apache.hadoop.hbase.ipc.RpcServer$Responder.doRespond(RpcServer.java:1089)
        at org.apache.hadoop.hbase.ipc.RpcServer$Call.sendResponseIfReady(RpcServer.java:503)
        at org.apache.hadoop.hbase.ipc.CallRunner.run(CallRunner.java:130)
        at org.apache.hadoop.hbase.ipc.RpcExecutor.consumerLoop(RpcExecutor.java:114)
        at org.apache.hadoop.hbase.ipc.RpcExecutor$1.run(RpcExecutor.java:94)
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745)

2015-08-02 11:25:09,832 WARN  [RpcServer.reader=2,port=60020] ipc.RpcServer: RpcServer.listener,port=60020: count of bytes read: 0
java.io.IOException: Connection reset by peer
        at sun.nio.ch.FileDispatcherImpl.read0(Native Method)
        at sun.nio.ch.SocketDispatcher.read(SocketDispatcher.java:39)
        at sun.nio.ch.IOUtil.readIntoNativeBuffer(IOUtil.java:223)
        at sun.nio.ch.IOUtil.read(IOUtil.java:197)
        at sun.nio.ch.SocketChannelImpl.read(SocketChannelImpl.java:379)
        at org.apache.hadoop.hbase.ipc.RpcServer.channelRead(RpcServer.java:2244)
        at org.apache.hadoop.hbase.ipc.RpcServer$Connection.readAndProcess(RpcServer.java:1423)
        at org.apache.hadoop.hbase.ipc.RpcServer$Listener.doRead(RpcServer.java:798)
        at org.apache.hadoop.hbase.ipc.RpcServer$Listener$Reader.doRunLoop(RpcServer.java:589)
        at org.apache.hadoop.hbase.ipc.RpcServer$Listener$Reader.run(RpcServer.java:564)
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745)

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14650637" author="chenheng" created="Sun, 2 Aug 2015 08:19:25 +0000"  >&lt;p&gt;I check the code,  and found that every time call readBlock,  it will acqurie offsetLock no matter the blockcache is on or off. &lt;br/&gt;
I think it is a bug.  Only the blockcache on,  it is necessary to recheck the cache.   I will submit a patch&lt;/p&gt;</comment>
                            <comment id="14650639" author="chenheng" created="Sun, 2 Aug 2015 08:21:14 +0000"  >&lt;p&gt;This is a patch&lt;/p&gt;</comment>
                            <comment id="14650647" author="hadoopqa" created="Sun, 2 Aug 2015 08:30:45 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12748347/1.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12748347/1.patch&lt;/a&gt;&lt;br/&gt;
  against master branch at commit 4b6598e394bae67b54d6f741dd262afe03b2c133.&lt;br/&gt;
  ATTACHMENT ID: 12748347&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 tests included&lt;/font&gt;.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 patch&lt;/font&gt;.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14955//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14955//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14650710" author="chenheng" created="Sun, 2 Aug 2015 11:33:54 +0000"  >&lt;p&gt;After check the code, i think the RS was blocked due to &lt;br/&gt;
If some clients get some large row simultaneously, if the table&apos;s block cache is closed,  all get request will try to acquire the offsetLock &lt;br/&gt;
and only one lock successfully, the others will wait before lock is released. All the handlers will be exhausted, and RS will be blocked!&lt;/p&gt;</comment>
                            <comment id="14650726" author="chenheng" created="Sun, 2 Aug 2015 12:16:24 +0000"  >&lt;p&gt;rename the patch&lt;/p&gt;</comment>
                            <comment id="14650729" author="apache9" created="Sun, 2 Aug 2015 12:34:41 +0000"  >&lt;p&gt;I think the problem here is we only allow one thread read a HFileBlock at the same time even if we disable the BlockCache.&lt;br/&gt;
If BlockCache is enabled, this is useful since other threads can get the block directly from BlockCache after one thread successfully read the block and put it into BlockCache.&lt;br/&gt;
This is a needless overhead if we disable BlockCache although I think one should always turn on BlockCache if there are many requests to the same HFileBlock. We should just read the HFileBlock from HDFS.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=chenheng&quot; class=&quot;user-hover&quot; rel=&quot;chenheng&quot;&gt;Heng Chen&lt;/a&gt;, could you please prepare a patch for master first? Thanks.&lt;/p&gt;</comment>
                            <comment id="14651047" author="hadoopqa" created="Sun, 2 Aug 2015 15:18:59 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12748356/HBASE-14178-0.98.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12748356/HBASE-14178-0.98.patch&lt;/a&gt;&lt;br/&gt;
  against 0.98 branch at commit 4b6598e394bae67b54d6f741dd262afe03b2c133.&lt;br/&gt;
  ATTACHMENT ID: 12748356&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 tests included&lt;/font&gt;.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop versions&lt;/font&gt;. The patch compiles with all supported hadoop versions (2.4.0 2.4.1 2.5.0 2.5.1 2.5.2 2.6.0 2.7.0)&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 protoc&lt;/font&gt;.  The applied patch does not increase the total number of protoc compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 javadoc&lt;/font&gt;.  The javadoc tool appears to have generated 21 warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 checkstyle&lt;/font&gt;.  The applied patch does not increase the total number of checkstyle errors&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any  new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn post-site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 core tests&lt;/font&gt;.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14957//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14957//testReport/&lt;/a&gt;&lt;br/&gt;
Release Findbugs (version 2.0.3) 	warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14957//artifact/patchprocess/newFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14957//artifact/patchprocess/newFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Checkstyle Errors: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14957//artifact/patchprocess/checkstyle-aggregate.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14957//artifact/patchprocess/checkstyle-aggregate.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;  Javadoc warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14957//artifact/patchprocess/patchJavadocWarnings.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14957//artifact/patchprocess/patchJavadocWarnings.txt&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14957//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14957//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14651335" author="chenheng" created="Mon, 3 Aug 2015 01:40:28 +0000"  >&lt;p&gt;Add patch for master&lt;/p&gt;</comment>
                            <comment id="14651356" author="chenheng" created="Mon, 3 Aug 2015 03:19:22 +0000"  >&lt;p&gt;when read block read cache, it needs:&lt;br/&gt;
1. blockCache is open&lt;br/&gt;
2. the table&apos;s column family&apos;s blockCache is open&lt;br/&gt;
3. read request cache is true&lt;/p&gt;

&lt;p&gt;So I modify the &apos;IF condition&apos; to read cache&lt;/p&gt;</comment>
                            <comment id="14651412" author="hadoopqa" created="Mon, 3 Aug 2015 04:33:00 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12748380/HBASE-14178.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12748380/HBASE-14178.patch&lt;/a&gt;&lt;br/&gt;
  against master branch at commit 4b6598e394bae67b54d6f741dd262afe03b2c133.&lt;br/&gt;
  ATTACHMENT ID: 12748380&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 tests included&lt;/font&gt;.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop versions&lt;/font&gt;. The patch compiles with all supported hadoop versions (2.4.0 2.4.1 2.5.0 2.5.1 2.5.2 2.6.0 2.7.0)&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 protoc&lt;/font&gt;.  The applied patch does not increase the total number of protoc compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 checkstyle&lt;/font&gt;.  The applied patch does not increase the total number of checkstyle errors&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any  new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn post-site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 core tests&lt;/font&gt;.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14958//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14958//testReport/&lt;/a&gt;&lt;br/&gt;
Release Findbugs (version 2.0.3) 	warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14958//artifact/patchprocess/newFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14958//artifact/patchprocess/newFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Checkstyle Errors: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14958//artifact/patchprocess/checkstyle-aggregate.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14958//artifact/patchprocess/checkstyle-aggregate.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;  Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14958//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14958//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14651415" author="anoop.hbase" created="Mon, 3 Aug 2015 04:41:20 +0000"  >&lt;p&gt;Just moving the below if check inside the if block if (cacheConf.isBlockCacheEnabled())   Will do the work no?&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
 &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!useLock) {
          &lt;span class=&quot;code-comment&quot;&gt;// check cache again with lock
&lt;/span&gt;          useLock = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
          &lt;span class=&quot;code-keyword&quot;&gt;continue&lt;/span&gt;;
        }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;When the block cache is enabled, we should check for the requested block in it. (This current scan may or may not be saying the block should be cached after read)&lt;/p&gt;</comment>
                            <comment id="14651416" author="chenheng" created="Mon, 3 Aug 2015 04:45:53 +0000"  >&lt;p&gt;sorry, I forget one import thing that if the block catetory is index or bloom, we should skip check the table column family&apos;s cache and request&apos;s cache configuration&lt;/p&gt;

&lt;p&gt;i update the patch, now the logic to read cache is:&lt;/p&gt;

&lt;p&gt;1. blockCache is open&lt;br/&gt;
2. if expectedBlockType is null&lt;br/&gt;
           just read cache&lt;br/&gt;
     else&lt;br/&gt;
           2.1 the request cache is open&lt;br/&gt;
           2.2 table&apos;s column family cache is open&lt;br/&gt;
           2.3 check the blockType.category&lt;/p&gt;</comment>
                            <comment id="14651419" author="anoop.hbase" created="Mon, 3 Aug 2015 04:48:55 +0000"  >&lt;p&gt;The outer if check  if (cacheConf.isBlockCacheEnabled())  should include the table CF block cache enabled flag also then.&lt;/p&gt;</comment>
                            <comment id="14651429" author="chenheng" created="Mon, 3 Aug 2015 05:00:57 +0000"  >&lt;blockquote&gt;
&lt;p&gt;Just moving the below if check inside the if block if (cacheConf.isBlockCacheEnabled()) Will do the work no?&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
 &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!useLock) {
          &lt;span class=&quot;code-comment&quot;&gt;// check cache again with lock
&lt;/span&gt;          useLock = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
          &lt;span class=&quot;code-keyword&quot;&gt;continue&lt;/span&gt;;
        }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;When the block cache is enabled, we should check for the requested block in it. (This current scan may or may not be saying the block should be cached after read)&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;thanks for your reply!&lt;/p&gt;

&lt;p&gt;just move the if block &quot; if (!useLock)&quot; into if (cacheConf.isBlockCacheEnabled())  will not solve the problem&#65281;&lt;br/&gt;
because if the blockCache be enabled, but the table&apos;s family cache is closed,  it still acquire the lock.  So i update the &apos;if&apos; condition of read cache, and submit the patch v2 already. &lt;/p&gt;

</comment>
                            <comment id="14651472" author="anoop.hbase" created="Mon, 3 Aug 2015 05:51:51 +0000"  >&lt;blockquote&gt;&lt;p&gt;just move the if block &quot; if (!useLock)&quot; into if (cacheConf.isBlockCacheEnabled()) will not solve the problem&#65281;&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;because if the blockCache be enabled, but the table&apos;s family cache is closed, it still acquire the lock.&lt;br/&gt;
Agree.  That is why I said&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;The outer if check if (cacheConf.isBlockCacheEnabled()) should include the table CF block cache enabled flag also then.&lt;/p&gt;&lt;/blockquote&gt;</comment>
                            <comment id="14651549" author="hadoopqa" created="Mon, 3 Aug 2015 07:29:15 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12748389/HBASE-14178_v2.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12748389/HBASE-14178_v2.patch&lt;/a&gt;&lt;br/&gt;
  against master branch at commit 4b6598e394bae67b54d6f741dd262afe03b2c133.&lt;br/&gt;
  ATTACHMENT ID: 12748389&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 tests included&lt;/font&gt;.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop versions&lt;/font&gt;. The patch compiles with all supported hadoop versions (2.4.0 2.4.1 2.5.0 2.5.1 2.5.2 2.6.0 2.7.0)&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 protoc&lt;/font&gt;.  The applied patch does not increase the total number of protoc compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 checkstyle&lt;/font&gt;.  The applied patch does not increase the total number of checkstyle errors&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any  new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn post-site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core tests&lt;/font&gt;.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.client.TestFromClientSide&lt;br/&gt;
                  org.apache.hadoop.hbase.client.TestFromClientSideWithCoprocessor&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14960//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14960//testReport/&lt;/a&gt;&lt;br/&gt;
Release Findbugs (version 2.0.3) 	warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14960//artifact/patchprocess/newFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14960//artifact/patchprocess/newFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Checkstyle Errors: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14960//artifact/patchprocess/checkstyle-aggregate.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14960//artifact/patchprocess/checkstyle-aggregate.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;  Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14960//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14960//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14651619" author="chenheng" created="Mon, 3 Aug 2015 09:03:23 +0000"  >&lt;p&gt;Testcase failed calculate hitCount of cacheStats after regionServer do Compaction&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
      &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;Compacting&quot;&lt;/span&gt;);
      assertEquals(2, store.getStorefilesCount());
      store.triggerMajorCompaction();
      region.compact(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;);
      waitForStoreFileCount(store, 1, 10000); &lt;span class=&quot;code-comment&quot;&gt;// wait 10 seconds max
&lt;/span&gt;      assertEquals(1, store.getStorefilesCount());
      expectedBlockCount -= 2; &lt;span class=&quot;code-comment&quot;&gt;// evicted two blocks, cached none
&lt;/span&gt;      assertEquals(expectedBlockCount, cache.getBlockCount());
      expectedBlockHits += 2;
      assertEquals(expectedBlockMiss, cache.getStats().getMissCount());
      assertEquals(expectedBlockHits, cache.getStats().getHitCount());     {color:red} &lt;span class=&quot;code-comment&quot;&gt;//Failed here,  cache.getStats().getHitCount() &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; 2, but expectedBlockHits equals 4 {color}&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I check the code of compaction,  and found that the compaction will use scanner with no blockcache flag, and I will check this flag before read block from BlockCache&lt;br/&gt;
So as new logic, the hitcount will be two after compaction.  And I think during compaction, scan request will not use blockcache.&lt;/p&gt;

&lt;p&gt;So i think the expectedBlockHits should be two in testcase&lt;/p&gt;








</comment>
                            <comment id="14651645" author="chenheng" created="Mon, 3 Aug 2015 09:27:53 +0000"  >&lt;p&gt;Update patch,   modify TestFromClientSide.testCacheOnWriteEvictOnClose:&lt;br/&gt;
After compaction, we don&apos;t modify the expectedBlockHits&lt;/p&gt;</comment>
                            <comment id="14651691" author="anoop.hbase" created="Mon, 3 Aug 2015 09:57:16 +0000"  >&lt;p&gt;This means when the current scan comes in which says cache read blocks as false, we wont even consult block for reading that?  IMO that is wrong. When block is available, we should try read from that. Agree.. when the table CF is set to be not to cache data from that CF at all, there is no point in looking into the cache. So in cases of BC is disabled as well as the read CF is set to be cache block = false, no need to obtain lock at all.  But the code change seems not just this much..&lt;/p&gt;

&lt;p&gt;So IMO there can be 2 changes in code&lt;br/&gt;
1. Move the below piece of code inside the check  if (cacheConf.isBlockCacheEnabled())&lt;/p&gt;
    &lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!useLock) {
          &lt;span class=&quot;code-comment&quot;&gt;// check cache again with lock
&lt;/span&gt;          useLock = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
          &lt;span class=&quot;code-keyword&quot;&gt;continue&lt;/span&gt;;
        }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;2. The outer if check , (ie.  if (cacheConf.isBlockCacheEnabled()) ) itself should be changed to include the check for the CF level cache setting.  (HCD#setBlockCacheEnabled)&lt;/p&gt;</comment>
                            <comment id="14651750" author="chenheng" created="Mon, 3 Aug 2015 11:17:52 +0000"  >&lt;blockquote&gt;
&lt;p&gt;This means when the current scan comes in which says cache read blocks as false, we wont even consult block for reading that? IMO that is wrong. When block is available, we should try read from that. Agree.. when the table CF is set to be not to cache data from that CF at all, there is no point in looking into the cache. So in cases of BC is disabled as well as the read CF is set to be cache block = false, no need to obtain lock at all. But the code change seems not just this much..&lt;br/&gt;
So IMO there can be 2 changes in code&lt;br/&gt;
1. Move the below piece of code inside the check if (cacheConf.isBlockCacheEnabled())&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!useLock) {
          &lt;span class=&quot;code-comment&quot;&gt;// check cache again with lock
&lt;/span&gt;          useLock = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
          &lt;span class=&quot;code-keyword&quot;&gt;continue&lt;/span&gt;;
        }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;2. The outer if check , (ie. if (cacheConf.isBlockCacheEnabled()) ) itself should be changed to include the check for the CF level cache setting. (HCD#setBlockCacheEnabled)&lt;br/&gt;
Reply&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Thanks for your reply!  I agree with you!  I has thought that the &quot;cacheBlock&quot; in request means the client could skip the blockCache to read HFileBlock from hdfs directly. I am wrong!&lt;br/&gt;
I will not check the cacheBlock before read in BC.&lt;/p&gt;</comment>
                            <comment id="14651811" author="hadoopqa" created="Mon, 3 Aug 2015 12:42:53 +0000"  >&lt;p&gt;&lt;font color=&quot;green&quot;&gt;+1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12748421/HBASE-14178_v3.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12748421/HBASE-14178_v3.patch&lt;/a&gt;&lt;br/&gt;
  against master branch at commit 4b6598e394bae67b54d6f741dd262afe03b2c133.&lt;br/&gt;
  ATTACHMENT ID: 12748421&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop versions&lt;/font&gt;. The patch compiles with all supported hadoop versions (2.4.0 2.4.1 2.5.0 2.5.1 2.5.2 2.6.0 2.7.0)&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 protoc&lt;/font&gt;.  The applied patch does not increase the total number of protoc compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 checkstyle&lt;/font&gt;.  The applied patch does not increase the total number of checkstyle errors&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any  new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn post-site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 core tests&lt;/font&gt;.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14961//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14961//testReport/&lt;/a&gt;&lt;br/&gt;
Release Findbugs (version 2.0.3) 	warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14961//artifact/patchprocess/newFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14961//artifact/patchprocess/newFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Checkstyle Errors: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14961//artifact/patchprocess/checkstyle-aggregate.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14961//artifact/patchprocess/checkstyle-aggregate.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;  Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14961//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14961//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14651944" author="hadoopqa" created="Mon, 3 Aug 2015 14:53:04 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12748436/HBASE-14178_v4.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12748436/HBASE-14178_v4.patch&lt;/a&gt;&lt;br/&gt;
  against master branch at commit 4b6598e394bae67b54d6f741dd262afe03b2c133.&lt;br/&gt;
  ATTACHMENT ID: 12748436&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 tests included&lt;/font&gt;.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop versions&lt;/font&gt;. The patch compiles with all supported hadoop versions (2.4.0 2.4.1 2.5.0 2.5.1 2.5.2 2.6.0 2.7.0)&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 protoc&lt;/font&gt;.  The applied patch does not increase the total number of protoc compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 checkstyle&lt;/font&gt;.  The applied patch does not increase the total number of checkstyle errors&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any  new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn post-site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 core tests&lt;/font&gt;.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core zombie tests&lt;/font&gt;.  There are 2 zombie test(s): 	at org.apache.hadoop.mapred.TestMRIntermediateDataEncryption.testMultipleReducers(TestMRIntermediateDataEncryption.java:70)&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14962//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14962//testReport/&lt;/a&gt;&lt;br/&gt;
Release Findbugs (version 2.0.3) 	warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14962//artifact/patchprocess/newFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14962//artifact/patchprocess/newFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Checkstyle Errors: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14962//artifact/patchprocess/checkstyle-aggregate.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14962//artifact/patchprocess/checkstyle-aggregate.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;  Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14962//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14962//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14651976" author="anoop.hbase" created="Mon, 3 Aug 2015 15:19:49 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; shouldCacheBlockOnRead(BlockCategory category) {
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; isBlockCacheEnabled()
        &amp;amp;&amp;amp; (cacheDataOnRead ||
            category == BlockCategory.INDEX ||
            category == BlockCategory.BLOOM ||
            (prefetchOnOpen &amp;amp;&amp;amp;
                (category != BlockCategory.META &amp;amp;&amp;amp;
                 category != BlockCategory.UNKNOWN)));
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;You can see the call to cacheConf.shouldCacheBlockOnRead(expectedBlockType.getCategory()) checks wrt whether the read request says the block to be cached after this read.  It is not telling abt the CF level setting of whether data to be cached at all or not.   We have to make that info available here in HFileReader.  And when we read the index or meta blocks we have to consult BC.(which u do already)&lt;/p&gt;</comment>
                            <comment id="14652053" author="chenheng" created="Mon, 3 Aug 2015 16:19:15 +0000"  >&lt;blockquote&gt;
&lt;p&gt;You can see the call to cacheConf.shouldCacheBlockOnRead(expectedBlockType.getCategory()) checks wrt whether the read request says the block to be cached after this read. It is not telling abt the CF level setting of whether data to be cached at all or not.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;cacheDataOnRead  represents for CF Level cache setting. You can see cacheDataOnRead is initialized in CacheConfig constructor &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  CacheConfig(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; BlockCache blockCache,
      &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; cacheDataOnRead, &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; inMemory,
      &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; cacheDataOnWrite, &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; cacheIndexesOnWrite,
      &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; cacheBloomsOnWrite, &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; evictOnClose,
      &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; cacheDataCompressed, &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; prefetchOnOpen,
      &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; cacheDataInL1) {
    &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.blockCache = blockCache;
    &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.cacheDataOnRead = cacheDataOnRead;
    &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.inMemory = inMemory;
    &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.cacheDataOnWrite = cacheDataOnWrite;
    &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.cacheIndexesOnWrite = cacheIndexesOnWrite;
    &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.cacheBloomsOnWrite = cacheBloomsOnWrite;
    &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.evictOnClose = evictOnClose;
    &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.cacheDataCompressed = cacheDataCompressed;
    &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.prefetchOnOpen = prefetchOnOpen;
    &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.cacheDataInL1 = cacheDataInL1;
    LOG.info(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;);
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And this constructor is called by another constructor &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; CacheConfig(Configuration conf, HColumnDescriptor family) {
    &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;(CacheConfig.instantiateBlockCache(conf),
        family.isBlockCacheEnabled(),
        family.isInMemory(),
        &lt;span class=&quot;code-comment&quot;&gt;// For the following flags we enable them regardless of per-schema settings
&lt;/span&gt;        &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; they are enabled in the global configuration.
&lt;/span&gt;        conf.getBoolean(CACHE_BLOCKS_ON_WRITE_KEY,
            DEFAULT_CACHE_DATA_ON_WRITE) || family.isCacheDataOnWrite(),
        conf.getBoolean(CACHE_INDEX_BLOCKS_ON_WRITE_KEY,
            DEFAULT_CACHE_INDEXES_ON_WRITE) || family.isCacheIndexesOnWrite(),
        conf.getBoolean(CACHE_BLOOM_BLOCKS_ON_WRITE_KEY,
            DEFAULT_CACHE_BLOOMS_ON_WRITE) || family.isCacheBloomsOnWrite(),
        conf.getBoolean(EVICT_BLOCKS_ON_CLOSE_KEY,
            DEFAULT_EVICT_ON_CLOSE) || family.isEvictBlocksOnClose(),
        conf.getBoolean(CACHE_DATA_BLOCKS_COMPRESSED_KEY, DEFAULT_CACHE_DATA_COMPRESSED),
        conf.getBoolean(PREFETCH_BLOCKS_ON_OPEN_KEY,
            DEFAULT_PREFETCH_ON_OPEN) || family.isPrefetchBlocksOnOpen(),
        conf.getBoolean(HColumnDescriptor.CACHE_DATA_IN_L1,
            HColumnDescriptor.DEFAULT_CACHE_DATA_IN_L1) || family.isCacheDataInL1()
     );
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
</comment>
                            <comment id="14653021" author="chenheng" created="Tue, 4 Aug 2015 03:39:56 +0000"  >&lt;p&gt;upload patch for branch 0.98&lt;/p&gt;</comment>
                            <comment id="14653184" author="hadoopqa" created="Tue, 4 Aug 2015 07:10:01 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12748601/HBASE-14178-0.98.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12748601/HBASE-14178-0.98.patch&lt;/a&gt;&lt;br/&gt;
  against 0.98 branch at commit 931e77d4507e1650c452cefadda450e0bf3f0528.&lt;br/&gt;
  ATTACHMENT ID: 12748601&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 tests included&lt;/font&gt;.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop versions&lt;/font&gt;. The patch compiles with all supported hadoop versions (2.4.0 2.4.1 2.5.0 2.5.1 2.5.2 2.6.0 2.7.0)&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 protoc&lt;/font&gt;.  The applied patch does not increase the total number of protoc compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 javadoc&lt;/font&gt;.  The javadoc tool appears to have generated 21 warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 checkstyle&lt;/font&gt;.  The applied patch does not increase the total number of checkstyle errors&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any  new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn post-site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 core tests&lt;/font&gt;.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14965//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14965//testReport/&lt;/a&gt;&lt;br/&gt;
Release Findbugs (version 2.0.3) 	warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14965//artifact/patchprocess/newFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14965//artifact/patchprocess/newFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Checkstyle Errors: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14965//artifact/patchprocess/checkstyle-aggregate.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14965//artifact/patchprocess/checkstyle-aggregate.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;  Javadoc warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14965//artifact/patchprocess/patchJavadocWarnings.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14965//artifact/patchprocess/patchJavadocWarnings.txt&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14965//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14965//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14653201" author="apache9" created="Tue, 4 Aug 2015 07:30:29 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=anoopsamjohn&quot; class=&quot;user-hover&quot; rel=&quot;anoopsamjohn&quot;&gt;Anoop Sam John&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;CacheConfig&lt;/tt&gt; is a bit confusing I think. &lt;tt&gt;family.isBlockCacheEnabled&lt;/tt&gt; is only equal to &lt;tt&gt;cacheDataOnRead&lt;/tt&gt;, and we still have chance to put data into &lt;tt&gt;BlockCache&lt;/tt&gt; if we set &lt;tt&gt;cacheDataOnWrite&lt;/tt&gt; or &lt;tt&gt;prefetchOnOpen&lt;/tt&gt; to &lt;tt&gt;true&lt;/tt&gt; even if we set  &lt;tt&gt;cacheDataOnRead&lt;/tt&gt; to &lt;tt&gt;false&lt;/tt&gt;?&lt;/p&gt;

&lt;p&gt;So I suggest here we make a new method called &lt;tt&gt;shouldReadBlockFromCache&lt;/tt&gt;, and check all the possibility that we may put a block into &lt;tt&gt;BlockCache&lt;/tt&gt;?&lt;/p&gt;

&lt;p&gt;Thanks.&lt;/p&gt;</comment>
                            <comment id="14653334" author="anoop.hbase" created="Tue, 4 Aug 2015 09:11:31 +0000"  >&lt;p&gt;I see.. I didnt not check much like how this variable is getting initialized in CacheConfig..  Ya we better do some cleanup there. So much confusing stuff.&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;and we still have chance to put data into BlockCache if we set cacheDataOnWrite or prefetchOnOpen to true even if we set cacheDataOnRead to false?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I did not test it.  Nice to test with some UTs.  If at CF level we set like never cache the data from this CF into BC, we should NOT cache it at all.  Whatever be value of cacheDataOnWrite or prefetchOnOpen.  If we are not doing so, then those are bugs to be addressed.&lt;/p&gt;</comment>
                            <comment id="14653341" author="anoop.hbase" created="Tue, 4 Aug 2015 09:14:01 +0000"  >&lt;blockquote&gt;&lt;p&gt;So I suggest here we make a new method called shouldReadBlockFromCache, and check all the possibility that we may put a block into BlockCache&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Ideally, when the BC is enabled and CF level there is no setting like NOT to cache data into BC, we should try read it from the BC. Also even if the CF level setting is there and we are not reading back Data blocks, then also we have to consult BC.  Still it will be much cleaner to do ur suggestion of adding the new method to CacheConfig. It will look much cleaner.&lt;/p&gt;</comment>
                            <comment id="14653391" author="chenheng" created="Tue, 4 Aug 2015 10:05:00 +0000"  >&lt;blockquote&gt;
&lt;p&gt;Ideally, when the BC is enabled and CF level there is no setting like NOT to cache data into BC, we should try read it from the BC. Also even if the CF level setting is there and we are not reading back Data blocks, then also we have to consult BC. Still it will be much cleaner to do ur suggestion of adding the new method to CacheConfig. It will look much cleaner.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I agree with both of you, I will write a function named shouldReadBlockFromCache in CacheConfig to check all the situations we should read from BC.&lt;/p&gt;

&lt;p&gt;But there is one problem.  we acquire lock to ensure next request could read block from BC.  &lt;br/&gt;
If cacheDataOnRead is false but cacheDataOnWrite is true, as we discuss, we still read from BC, and acquire the lock.&lt;br/&gt;
But after read block from hdfs, we use another condition to decide whether we should cache the block, &lt;br/&gt;
and it will not cache the block when cacheDataOnRead is false and cacheDataOnWrite is true&#12290; &lt;br/&gt;
In this situation, the lock is useless.&lt;/p&gt;

&lt;p&gt;So i think we will use another &apos;If&apos; to check whether we should acquire the lock. Do you think so?&lt;/p&gt;


</comment>
                            <comment id="14653415" author="apache9" created="Tue, 4 Aug 2015 10:22:56 +0000"  >&lt;p&gt;Yes, the problem here is the lock, not when to read from cache...So if we can make sure the block will not be put into cache after we fetch it from HDFS, then we can bypass the locking step.&lt;/p&gt;</comment>
                            <comment id="14653433" author="chenheng" created="Tue, 4 Aug 2015 10:38:17 +0000"  >&lt;p&gt;Upload patch &lt;br/&gt;
changes blow:&lt;br/&gt;
1.  add function to check all situations we should read BC&lt;br/&gt;
2.  add function to check if we should acquire the lock&lt;/p&gt;</comment>
                            <comment id="14653551" author="hadoopqa" created="Tue, 4 Aug 2015 12:30:14 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12748640/HBASE-14178_v5.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12748640/HBASE-14178_v5.patch&lt;/a&gt;&lt;br/&gt;
  against master branch at commit 931e77d4507e1650c452cefadda450e0bf3f0528.&lt;br/&gt;
  ATTACHMENT ID: 12748640&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 tests included&lt;/font&gt;.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop versions&lt;/font&gt;. The patch compiles with all supported hadoop versions (2.4.0 2.4.1 2.5.0 2.5.1 2.5.2 2.6.0 2.7.0)&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 protoc&lt;/font&gt;.  The applied patch does not increase the total number of protoc compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 checkstyle&lt;/font&gt;.  The applied patch does not increase the total number of checkstyle errors&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any  new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn post-site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core tests&lt;/font&gt;.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.client.TestMultiParallel&lt;br/&gt;
                  org.apache.hadoop.hbase.trace.TestHTraceHooks&lt;br/&gt;
                  org.apache.hadoop.hbase.client.TestScannersFromClientSide&lt;br/&gt;
                  org.apache.hadoop.hbase.TestLocalHBaseCluster&lt;br/&gt;
                  org.apache.hadoop.hbase.TestMetaTableAccessor&lt;br/&gt;
                  org.apache.hadoop.hbase.snapshot.TestRestoreFlushSnapshotFromClient&lt;br/&gt;
                  org.apache.hadoop.hbase.client.TestScannerTimeout&lt;br/&gt;
                  org.apache.hadoop.hbase.client.TestRestoreSnapshotFromClientWithRegionReplicas&lt;br/&gt;
                  org.apache.hadoop.hbase.client.TestMetaWithReplicas&lt;br/&gt;
                  org.apache.hadoop.hbase.namespace.TestNamespaceAuditor&lt;br/&gt;
                  org.apache.hadoop.hbase.client.TestHCM&lt;br/&gt;
                  org.apache.hadoop.hbase.snapshot.TestMobRestoreFlushSnapshotFromClient&lt;br/&gt;
                  org.apache.hadoop.hbase.backup.TestHFileArchiving&lt;br/&gt;
                  org.apache.hadoop.hbase.client.TestSnapshotFromClientWithRegionReplicas&lt;br/&gt;
                  org.apache.hadoop.hbase.client.TestClientPushback&lt;br/&gt;
                  org.apache.hadoop.hbase.TestIOFencing&lt;br/&gt;
                  org.apache.hadoop.hbase.client.TestClientTimeouts&lt;br/&gt;
                  org.apache.hadoop.hbase.client.TestMobSnapshotFromClient&lt;br/&gt;
                  org.apache.hadoop.hbase.snapshot.TestFlushSnapshotFromClient&lt;br/&gt;
                  org.apache.hadoop.hbase.client.TestCloneSnapshotFromClient&lt;br/&gt;
                  org.apache.hadoop.hbase.TestMultiVersions&lt;/p&gt;

&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core zombie tests&lt;/font&gt;.  There are 7 zombie test(s): 	at org.apache.hadoop.hbase.namespace.TestNamespaceAuditor.testRegionMerge(TestNamespaceAuditor.java:316)&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14966//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14966//testReport/&lt;/a&gt;&lt;br/&gt;
Release Findbugs (version 2.0.3) 	warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14966//artifact/patchprocess/newFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14966//artifact/patchprocess/newFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Checkstyle Errors: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14966//artifact/patchprocess/checkstyle-aggregate.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14966//artifact/patchprocess/checkstyle-aggregate.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;  Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14966//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14966//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14653586" author="chenheng" created="Tue, 4 Aug 2015 12:58:50 +0000"  >&lt;p&gt;changes:&lt;/p&gt;

&lt;p&gt;1. modify some comments&lt;/p&gt;</comment>
                            <comment id="14653814" author="hadoopqa" created="Tue, 4 Aug 2015 15:40:35 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12748653/HBASE-14178_v6.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12748653/HBASE-14178_v6.patch&lt;/a&gt;&lt;br/&gt;
  against master branch at commit 931e77d4507e1650c452cefadda450e0bf3f0528.&lt;br/&gt;
  ATTACHMENT ID: 12748653&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 tests included&lt;/font&gt;.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop versions&lt;/font&gt;. The patch compiles with all supported hadoop versions (2.4.0 2.4.1 2.5.0 2.5.1 2.5.2 2.6.0 2.7.0)&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 protoc&lt;/font&gt;.  The applied patch does not increase the total number of protoc compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 checkstyle&lt;/font&gt;.  The applied patch does not increase the total number of checkstyle errors&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any  new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn post-site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core tests&lt;/font&gt;.  The patch failed these unit tests:&lt;/p&gt;


&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core zombie tests&lt;/font&gt;.  There are 3 zombie test(s): 	at org.apache.hadoop.hbase.client.TestReplicasClient.testSmallScanWithReplicas(TestReplicasClient.java:606)&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14967//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14967//testReport/&lt;/a&gt;&lt;br/&gt;
Release Findbugs (version 2.0.3) 	warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14967//artifact/patchprocess/newFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14967//artifact/patchprocess/newFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Checkstyle Errors: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14967//artifact/patchprocess/checkstyle-aggregate.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14967//artifact/patchprocess/checkstyle-aggregate.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;  Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14967//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14967//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14653873" author="yuzhihong@gmail.com" created="Tue, 4 Aug 2015 16:06:42 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
450	    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (blockType == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
451	      &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
452	    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Should false be returned in above condition ?&lt;/p&gt;</comment>
                            <comment id="14654605" author="chenheng" created="Wed, 5 Aug 2015 00:57:55 +0000"  >&lt;blockquote&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
450	    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (blockType == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
451	      &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
452	    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Should false be returned in above condition ?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;The code in shouldReadBlockFromCache is used to check whether we should read from BC.&lt;br/&gt;
When blockType is null, we don&apos;t know the blockType.category is Index, bloom or data, So we&lt;br/&gt;
just read from BC when BC is enabled. &lt;/p&gt;
</comment>
                            <comment id="14654607" author="apache9" created="Wed, 5 Aug 2015 01:01:19 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tedyu&quot; class=&quot;user-hover&quot; rel=&quot;tedyu&quot;&gt;Ted Yu&lt;/a&gt; If &lt;tt&gt;blockType&lt;/tt&gt; is &lt;tt&gt;null&lt;/tt&gt; then we can not determine if we could cache the block until we actually read it from HDFS. So I think it is appropriate to return false here? We should always acquire the lock unless we can make sure the block will not be cached.&lt;/p&gt;

&lt;p&gt;Thanks.&lt;/p&gt;</comment>
                            <comment id="14654613" author="apache9" created="Wed, 5 Aug 2015 01:05:04 +0000"  >&lt;p&gt;Oh, I looked into wrong ling number...&lt;/p&gt;

&lt;p&gt;It is the same reason, if &lt;tt&gt;blockType&lt;/tt&gt; is &lt;tt&gt;null&lt;/tt&gt;, the safe way is to read it from &lt;tt&gt;BlockCache&lt;/tt&gt; first. Maybe it is an &lt;tt&gt;INDEX&lt;/tt&gt; or &lt;tt&gt;BLOOM&lt;/tt&gt; block.&lt;/p&gt;

&lt;p&gt;Thanks.&lt;/p&gt;</comment>
                            <comment id="14654771" author="yuzhihong@gmail.com" created="Wed, 5 Aug 2015 03:59:33 +0000"  >&lt;p&gt;Can we get a successful QA run ?&lt;/p&gt;

&lt;p&gt;Thanks&lt;/p&gt;</comment>
                            <comment id="14654777" author="apache9" created="Wed, 5 Aug 2015 04:08:46 +0000"  >&lt;p&gt;Retry.&lt;/p&gt;</comment>
                            <comment id="14654987" author="hadoopqa" created="Wed, 5 Aug 2015 08:10:18 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12748782/HBASE-14178_v6.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12748782/HBASE-14178_v6.patch&lt;/a&gt;&lt;br/&gt;
  against master branch at commit 18c9bb8b54a5bb101f793e555272cbc74b8288cb.&lt;br/&gt;
  ATTACHMENT ID: 12748782&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 tests included&lt;/font&gt;.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop versions&lt;/font&gt;. The patch compiles with all supported hadoop versions (2.4.0 2.4.1 2.5.0 2.5.1 2.5.2 2.6.0 2.7.0)&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 protoc&lt;/font&gt;.  The applied patch does not increase the total number of protoc compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 checkstyle&lt;/font&gt;.  The applied patch does not increase the total number of checkstyle errors&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any  new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn post-site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core tests&lt;/font&gt;.  The patch failed these unit tests:&lt;/p&gt;


&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14981//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14981//testReport/&lt;/a&gt;&lt;br/&gt;
Release Findbugs (version 2.0.3) 	warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14981//artifact/patchprocess/newFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14981//artifact/patchprocess/newFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Checkstyle Errors: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14981//artifact/patchprocess/checkstyle-aggregate.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14981//artifact/patchprocess/checkstyle-aggregate.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;  Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14981//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14981//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14655004" author="apache9" created="Wed, 5 Aug 2015 08:28:35 +0000"  >&lt;p&gt;A flaky test(TestFastFail) failed in pre-commit. Retry.&lt;/p&gt;</comment>
                            <comment id="14655211" author="apache9" created="Wed, 5 Aug 2015 11:17:46 +0000"  >&lt;p&gt;Retry.&lt;/p&gt;</comment>
                            <comment id="14658266" author="hadoopqa" created="Wed, 5 Aug 2015 14:16:38 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12748841/HBASE-14178_v6.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12748841/HBASE-14178_v6.patch&lt;/a&gt;&lt;br/&gt;
  against master branch at commit 18c9bb8b54a5bb101f793e555272cbc74b8288cb.&lt;br/&gt;
  ATTACHMENT ID: 12748841&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 tests included&lt;/font&gt;.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop versions&lt;/font&gt;. The patch compiles with all supported hadoop versions (2.4.0 2.4.1 2.5.0 2.5.1 2.5.2 2.6.0 2.7.0)&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 protoc&lt;/font&gt;.  The applied patch does not increase the total number of protoc compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 checkstyle&lt;/font&gt;.  The applied patch does not increase the total number of checkstyle errors&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any  new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn post-site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 core tests&lt;/font&gt;.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14983//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14983//testReport/&lt;/a&gt;&lt;br/&gt;
Release Findbugs (version 2.0.3) 	warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14983//artifact/patchprocess/newFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14983//artifact/patchprocess/newFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Checkstyle Errors: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14983//artifact/patchprocess/checkstyle-aggregate.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14983//artifact/patchprocess/checkstyle-aggregate.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;  Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14983//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14983//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14658282" author="yuzhihong@gmail.com" created="Wed, 5 Aug 2015 14:25:17 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="14659274" author="apache9" created="Thu, 6 Aug 2015 00:48:29 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=anoopsamjohn&quot; class=&quot;user-hover&quot; rel=&quot;anoopsamjohn&quot;&gt;Anoop Sam John&lt;/a&gt; Any concerns of patch v6? Thanks.&lt;/p&gt;</comment>
                            <comment id="14659494" author="anoop.hbase" created="Thu, 6 Aug 2015 05:01:39 +0000"  >&lt;p&gt;Why we need different condition for reading from the cache with and with out lock?  with out lock we do at first , as an optimistic approach.  If block is not there by then, we are doing one more round of check for a possible another concurrent thread doing the caching of this block.  So we use lock then. So am not sure whether to read from cache why it has to have different condition.   Looks like the patch tend to make an impression that we will read from cache &lt;b&gt;with lock&lt;/b&gt; in order to cache that block into the BC.  But it is not the case.   Sorry if I missed some other discussion parts in above comments&lt;/p&gt;</comment>
                            <comment id="14659524" author="apache9" created="Thu, 6 Aug 2015 05:40:05 +0000"  >&lt;p&gt;Yes, we doing more round of check with lock because maybe another thread has already cache the block for us. Things happen here is we disable BC for the given family, so it is impossible that another thread will do the work for us, so we just read from HDFS and bypass the second checking BC round.&lt;/p&gt;

&lt;p&gt;And as I mentioned above, there are lots of configurations for BC, and &lt;tt&gt;family.isBlockCacheEnabled()&lt;/tt&gt; is treated as &lt;tt&gt;cacheDataOnRead&lt;/tt&gt; (You can see the code pasted by &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=chenheng&quot; class=&quot;user-hover&quot; rel=&quot;chenheng&quot;&gt;Heng Chen&lt;/a&gt;, maybe it is a mistake but it is not important for this issue I think, we could open another issue for it). So the safe way to determine if we need the second &apos;read BC with lock&apos; round is to check if we will put the block back to BC after we read it from HDFS. This is why we introduce a &lt;tt&gt;shouldLockOnCacheMiss&lt;/tt&gt; method here. Maybe we cound change the name to &lt;tt&gt;shouldReadAgainWithLockOnCacheMiss&lt;/tt&gt;?&lt;/p&gt;

&lt;p&gt;Thanks.&lt;/p&gt;</comment>
                            <comment id="14659553" author="chenheng" created="Thu, 6 Aug 2015 06:18:07 +0000"  >&lt;blockquote&gt;
&lt;p&gt;Why we need different condition for reading from the cache with and with out lock? with out lock we do at first , as an optimistic approach. If block is not there by then, we are doing one more round of check for a possible another concurrent thread doing the caching of this block. So we use lock then. So am not sure whether to read from cache why it has to have different condition. Looks like the patch tend to make an impression that we will read from cache with lock in order to cache that block into the BC. But it is not the case. Sorry if I missed some other discussion parts in above comments&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Thanks for your reply!&lt;/p&gt;

&lt;p&gt;The lock purpose is to improve the perf when other thread read same block.  If we make sure the block is not in BC,  there is no need to lock. So in &lt;tt&gt;shouldLockOnCacheMiss&lt;/tt&gt; , we will check if the block will be cached after read from hdfs.&lt;/p&gt;
</comment>
                            <comment id="14659558" author="ram_krish" created="Thu, 6 Aug 2015 06:23:02 +0000"  >&lt;p&gt;Reading thro the comments and the current code in CacheConfig, I think&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
 &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (cacheDataOnWrite) {
448	      &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
449	    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;These conditions may really be not needed. As you are saying isBlockCacheEnabled() wouild mean cacheDataOnRead is also true.  (I think this setting is going to be implemented per family only).&lt;/p&gt;</comment>
                            <comment id="14659560" author="anoop.hbase" created="Thu, 6 Aug 2015 06:26:43 +0000"  >&lt;p&gt;I see.. I get you now..  Basically we need it as 2 new methods in CacheConfig so as to accommodate some of the issues in today&apos;s impl.  Like we discussed, when the CF level BC usage is explicitly disabled, we should honour that. In such a case whatever be the value of cache on write or prefetch option, we should not cache those data blocks..   Here in this patch, we try to stick with the current behaviour. FIne..  We can correct them as part of another jira. &lt;br/&gt;
+1&lt;br/&gt;
Just add a TODO with some comments as we discussed here in these new methods and well as old methods in CacheConfig. Which we need change as part of the above fix.&lt;/p&gt;</comment>
                            <comment id="14659574" author="apache9" created="Thu, 6 Aug 2015 06:44:15 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ram_krish&quot; class=&quot;user-hover&quot; rel=&quot;ram_krish&quot;&gt;ramkrishna.s.vasudevan&lt;/a&gt; A bit strange but now, &lt;tt&gt;family.isBlockCacheEnabled&lt;/tt&gt; only means &lt;tt&gt;cacheDataOnRead&lt;/tt&gt; ... &lt;tt&gt;cacheDataOnWrite&lt;/tt&gt; and some other configurations such as &lt;tt&gt;prefetchOnOpen&lt;/tt&gt; are separated which means you can set them to &lt;tt&gt;true&lt;/tt&gt; and will take effect even if you explicitly call &lt;tt&gt;family.setBlockCacheEnabled(false)&lt;/tt&gt;. So theoretically even if you disable BC at family level, it is still possible that we could find the block in BC...&lt;/p&gt;</comment>
                            <comment id="14659576" author="ram_krish" created="Thu, 6 Aug 2015 06:48:08 +0000"  >&lt;p&gt;Okie. Agree for a TODO. +1 for adding a comment regarding this. +1.&lt;/p&gt;</comment>
                            <comment id="14659590" author="chenheng" created="Thu, 6 Aug 2015 07:04:25 +0000"  >&lt;p&gt;changes:&lt;br/&gt;
1. Add Todo comments for shouldReadBlockFromCache&lt;/p&gt;</comment>
                            <comment id="14659614" author="apache9" created="Thu, 6 Aug 2015 07:22:50 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=anoopsamjohn&quot; class=&quot;user-hover&quot; rel=&quot;anoopsamjohn&quot;&gt;Anoop Sam John&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ram_krish&quot; class=&quot;user-hover&quot; rel=&quot;ram_krish&quot;&gt;ramkrishna.s.vasudevan&lt;/a&gt; Any concerns on patch v7 then? Thanks.&lt;/p&gt;</comment>
                            <comment id="14659647" author="anoop.hbase" created="Thu, 6 Aug 2015 07:51:37 +0000"  >&lt;p&gt;+1&lt;br/&gt;
Pls raise a Jira to track the TODO item in this.  Would be great to see a patch there as well &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Nice work.&lt;/p&gt;</comment>
                            <comment id="14659681" author="apache9" created="Thu, 6 Aug 2015 08:30:52 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=chenheng&quot; class=&quot;user-hover&quot; rel=&quot;chenheng&quot;&gt;Heng Chen&lt;/a&gt; Could you please also prepare patch for branches other than master and 0.98? Thanks.&lt;/p&gt;</comment>
                            <comment id="14659700" author="chenheng" created="Thu, 6 Aug 2015 08:57:16 +0000"  >&lt;p&gt;upload patch for 0.98, branch-1, master&lt;/p&gt;</comment>
                            <comment id="14659713" author="chenheng" created="Thu, 6 Aug 2015 09:07:18 +0000"  >&lt;p&gt;Thanks for &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Apache9&quot; class=&quot;user-hover&quot; rel=&quot;Apache9&quot;&gt;Duo Zhang&lt;/a&gt; , &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=anoopsamjohn&quot; class=&quot;user-hover&quot; rel=&quot;anoopsamjohn&quot;&gt;Anoop Sam John&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ram_krish&quot; class=&quot;user-hover&quot; rel=&quot;ram_krish&quot;&gt;ramkrishna.s.vasudevan&lt;/a&gt; review,  as we discuss, i create a new issue 14189 &lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-14189&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-14189&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14659724" author="chenheng" created="Thu, 6 Aug 2015 09:16:57 +0000"  >&lt;p&gt;reupload patch for 0.98, branch-1,   the last patch is incorrect....&lt;/p&gt;</comment>
                            <comment id="14659728" author="apache9" created="Thu, 6 Aug 2015 09:22:39 +0000"  >&lt;p&gt;Pushed to all branches.&lt;/p&gt;

&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=chenheng&quot; class=&quot;user-hover&quot; rel=&quot;chenheng&quot;&gt;Heng Chen&lt;/a&gt; for the patch(and the quick turn around at last although I have done some revert commits...).&lt;/p&gt;

&lt;p&gt;Thanks all guys who helped review the patch.&lt;/p&gt;</comment>
                            <comment id="14659798" author="hudson" created="Thu, 6 Aug 2015 10:18:21 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-1.3 #91 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-1.3/91/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-1.3/91/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-14178&quot; title=&quot;regionserver blocks because of waiting for offsetLock&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-14178&quot;&gt;&lt;del&gt;HBASE-14178&lt;/del&gt;&lt;/a&gt; regionserver blocks because of waiting for offsetLock (zhangduo: rev fe9de40e6c16b6e030a89a759fa278f0e27722aa)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/io/hfile/HFileReaderV2.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/io/hfile/CacheConfig.java&lt;br/&gt;
Revert &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-14178&quot; title=&quot;regionserver blocks because of waiting for offsetLock&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-14178&quot;&gt;&lt;del&gt;HBASE-14178&lt;/del&gt;&lt;/a&gt; regionserver blocks because of waiting for offsetLock&quot; (zhangduo: rev 4623c843c137888d606578ed1bc579272a5ab2c2)&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/io/hfile/HFileReaderV2.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/io/hfile/CacheConfig.java&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-14178&quot; title=&quot;regionserver blocks because of waiting for offsetLock&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-14178&quot;&gt;&lt;del&gt;HBASE-14178&lt;/del&gt;&lt;/a&gt; regionserver blocks because of waiting for offsetLock (zhangduo: rev 5c0c389b7a1b32a045e4bc1557b96a56291ab2ab)&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/io/hfile/HFileReaderV2.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/io/hfile/CacheConfig.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14659802" author="hadoopqa" created="Thu, 6 Aug 2015 10:21:33 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12749008/HBASE-14178_v7.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12749008/HBASE-14178_v7.patch&lt;/a&gt;&lt;br/&gt;
  against master branch at commit 5d2708f628d4718f6267e9da6c8cbafeda66f4fb.&lt;br/&gt;
  ATTACHMENT ID: 12749008&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 tests included&lt;/font&gt;.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop versions&lt;/font&gt;. The patch compiles with all supported hadoop versions (2.4.0 2.4.1 2.5.0 2.5.1 2.5.2 2.6.0 2.7.0)&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 protoc&lt;/font&gt;.  The applied patch does not increase the total number of protoc compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 checkstyle&lt;/font&gt;.  The applied patch does not increase the total number of checkstyle errors&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any  new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn post-site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 core tests&lt;/font&gt;.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core zombie tests&lt;/font&gt;.  There are 1 zombie test(s): 	at org.apache.hadoop.hbase.procedure2.store.TestProcedureStoreTracker.testRandLoad(TestProcedureStoreTracker.java:186)&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14990//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14990//testReport/&lt;/a&gt;&lt;br/&gt;
Release Findbugs (version 2.0.3) 	warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14990//artifact/patchprocess/newFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14990//artifact/patchprocess/newFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Checkstyle Errors: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14990//artifact/patchprocess/checkstyle-aggregate.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14990//artifact/patchprocess/checkstyle-aggregate.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;  Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14990//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14990//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14659803" author="hudson" created="Thu, 6 Aug 2015 10:22:31 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-TRUNK #6700 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/6700/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/6700/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-14178&quot; title=&quot;regionserver blocks because of waiting for offsetLock&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-14178&quot;&gt;&lt;del&gt;HBASE-14178&lt;/del&gt;&lt;/a&gt; regionserver blocks because of waiting for offsetLock (zhangduo: rev 75a6cb2be6ae95654561213a247aa7ba62505072)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/io/hfile/HFileReaderImpl.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/io/hfile/CacheConfig.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14659831" author="hudson" created="Thu, 6 Aug 2015 11:04:42 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-1.0 #1002 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-1.0/1002/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-1.0/1002/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-14178&quot; title=&quot;regionserver blocks because of waiting for offsetLock&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-14178&quot;&gt;&lt;del&gt;HBASE-14178&lt;/del&gt;&lt;/a&gt; regionserver blocks because of waiting for offsetLock (zhangduo: rev 949092004379c7f2e8f08896c90b59d3a9272fbb)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/io/hfile/CacheConfig.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/io/hfile/HFileReaderV2.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14659861" author="hudson" created="Thu, 6 Aug 2015 11:35:19 +0000"  >&lt;p&gt;SUCCESS: Integrated in HBase-1.1 #599 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-1.1/599/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-1.1/599/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-14178&quot; title=&quot;regionserver blocks because of waiting for offsetLock&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-14178&quot;&gt;&lt;del&gt;HBASE-14178&lt;/del&gt;&lt;/a&gt; regionserver blocks because of waiting for offsetLock (zhangduo: rev ade125a4ce7825735ee99da4999ec290509d92c8)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/io/hfile/CacheConfig.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/io/hfile/HFileReaderV2.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14659872" author="hadoopqa" created="Thu, 6 Aug 2015 11:43:36 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12749022/HBASE-14178-branch-1_v8.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12749022/HBASE-14178-branch-1_v8.patch&lt;/a&gt;&lt;br/&gt;
  against branch-1 branch at commit 5d2708f628d4718f6267e9da6c8cbafeda66f4fb.&lt;br/&gt;
  ATTACHMENT ID: 12749022&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 tests included&lt;/font&gt;.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop versions&lt;/font&gt;. The patch compiles with all supported hadoop versions (2.4.0 2.4.1 2.5.0 2.5.1 2.5.2 2.6.0 2.7.0)&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 protoc&lt;/font&gt;.  The applied patch does not increase the total number of protoc compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 checkstyle&lt;/font&gt;.  The applied patch does not increase the total number of checkstyle errors&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any  new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn post-site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 core tests&lt;/font&gt;.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14991//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14991//testReport/&lt;/a&gt;&lt;br/&gt;
Release Findbugs (version 2.0.3) 	warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14991//artifact/patchprocess/newFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14991//artifact/patchprocess/newFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Checkstyle Errors: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14991//artifact/patchprocess/checkstyle-aggregate.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14991//artifact/patchprocess/checkstyle-aggregate.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;  Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14991//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14991//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14659940" author="hudson" created="Thu, 6 Aug 2015 12:35:23 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-1.2 #93 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-1.2/93/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-1.2/93/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-14178&quot; title=&quot;regionserver blocks because of waiting for offsetLock&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-14178&quot;&gt;&lt;del&gt;HBASE-14178&lt;/del&gt;&lt;/a&gt; regionserver blocks because of waiting for offsetLock (zhangduo: rev 922c3ba554eeb13c2390cdd1140b26006bb8a7e9)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/io/hfile/CacheConfig.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/io/hfile/HFileReaderV2.java&lt;br/&gt;
Revert &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-14178&quot; title=&quot;regionserver blocks because of waiting for offsetLock&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-14178&quot;&gt;&lt;del&gt;HBASE-14178&lt;/del&gt;&lt;/a&gt; regionserver blocks because of waiting for offsetLock&quot; (zhangduo: rev a4092444e6eba39e7523c118e80b3fb726485984)&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/io/hfile/HFileReaderV2.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/io/hfile/CacheConfig.java&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-14178&quot; title=&quot;regionserver blocks because of waiting for offsetLock&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-14178&quot;&gt;&lt;del&gt;HBASE-14178&lt;/del&gt;&lt;/a&gt; regionserver blocks because of waiting for offsetLock (zhangduo: rev 7a45596b40e9a6a011a7854d684fc69013b83e73)&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/io/hfile/HFileReaderV2.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/io/hfile/CacheConfig.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14660066" author="hudson" created="Thu, 6 Aug 2015 14:16:46 +0000"  >&lt;p&gt;SUCCESS: Integrated in HBase-0.98 #1068 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.98/1068/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.98/1068/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-14178&quot; title=&quot;regionserver blocks because of waiting for offsetLock&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-14178&quot;&gt;&lt;del&gt;HBASE-14178&lt;/del&gt;&lt;/a&gt; regionserver blocks because of waiting for offsetLock (zhangduo: rev 0dfd2cea4a6be3d98bbf5b0ef9769a584dd1986c)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/io/hfile/HFileReaderV2.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/io/hfile/CacheConfig.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14660158" author="hudson" created="Thu, 6 Aug 2015 15:21:44 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-1.2-IT #76 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-1.2-IT/76/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-1.2-IT/76/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-14178&quot; title=&quot;regionserver blocks because of waiting for offsetLock&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-14178&quot;&gt;&lt;del&gt;HBASE-14178&lt;/del&gt;&lt;/a&gt; regionserver blocks because of waiting for offsetLock (zhangduo: rev 922c3ba554eeb13c2390cdd1140b26006bb8a7e9)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/io/hfile/HFileReaderV2.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/io/hfile/CacheConfig.java&lt;br/&gt;
Revert &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-14178&quot; title=&quot;regionserver blocks because of waiting for offsetLock&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-14178&quot;&gt;&lt;del&gt;HBASE-14178&lt;/del&gt;&lt;/a&gt; regionserver blocks because of waiting for offsetLock&quot; (zhangduo: rev a4092444e6eba39e7523c118e80b3fb726485984)&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/io/hfile/HFileReaderV2.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/io/hfile/CacheConfig.java&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-14178&quot; title=&quot;regionserver blocks because of waiting for offsetLock&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-14178&quot;&gt;&lt;del&gt;HBASE-14178&lt;/del&gt;&lt;/a&gt; regionserver blocks because of waiting for offsetLock (zhangduo: rev 7a45596b40e9a6a011a7854d684fc69013b83e73)&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/io/hfile/HFileReaderV2.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/io/hfile/CacheConfig.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14660178" author="hudson" created="Thu, 6 Aug 2015 15:39:53 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-0.98-on-Hadoop-1.1 #1021 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.98-on-Hadoop-1.1/1021/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.98-on-Hadoop-1.1/1021/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-14178&quot; title=&quot;regionserver blocks because of waiting for offsetLock&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-14178&quot;&gt;&lt;del&gt;HBASE-14178&lt;/del&gt;&lt;/a&gt; regionserver blocks because of waiting for offsetLock (zhangduo: rev 0dfd2cea4a6be3d98bbf5b0ef9769a584dd1986c)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/io/hfile/CacheConfig.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/io/hfile/HFileReaderV2.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14660181" author="hudson" created="Thu, 6 Aug 2015 15:44:04 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-1.3-IT #73 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-1.3-IT/73/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-1.3-IT/73/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-14178&quot; title=&quot;regionserver blocks because of waiting for offsetLock&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-14178&quot;&gt;&lt;del&gt;HBASE-14178&lt;/del&gt;&lt;/a&gt; regionserver blocks because of waiting for offsetLock (zhangduo: rev fe9de40e6c16b6e030a89a759fa278f0e27722aa)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/io/hfile/HFileReaderV2.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/io/hfile/CacheConfig.java&lt;br/&gt;
Revert &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-14178&quot; title=&quot;regionserver blocks because of waiting for offsetLock&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-14178&quot;&gt;&lt;del&gt;HBASE-14178&lt;/del&gt;&lt;/a&gt; regionserver blocks because of waiting for offsetLock&quot; (zhangduo: rev 4623c843c137888d606578ed1bc579272a5ab2c2)&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/io/hfile/CacheConfig.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/io/hfile/HFileReaderV2.java&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-14178&quot; title=&quot;regionserver blocks because of waiting for offsetLock&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-14178&quot;&gt;&lt;del&gt;HBASE-14178&lt;/del&gt;&lt;/a&gt; regionserver blocks because of waiting for offsetLock (zhangduo: rev 5c0c389b7a1b32a045e4bc1557b96a56291ab2ab)&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/io/hfile/HFileReaderV2.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/io/hfile/CacheConfig.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14724242" author="enis" created="Mon, 31 Aug 2015 22:39:42 +0000"  >&lt;p&gt;Closing this issue after 1.0.2 release.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12748601" name="HBASE-14178-0.98.patch" size="1994" author="chenheng" created="Tue, 4 Aug 2015 03:39:56 +0000"/>
                            <attachment id="12749024" name="HBASE-14178-0.98_v8.patch" size="4147" author="chenheng" created="Thu, 6 Aug 2015 09:12:25 +0000"/>
                            <attachment id="12749027" name="HBASE-14178-branch_1_v8.patch" size="4169" author="chenheng" created="Thu, 6 Aug 2015 09:15:22 +0000"/>
                            <attachment id="12748380" name="HBASE-14178.patch" size="1804" author="chenheng" created="Mon, 3 Aug 2015 01:40:28 +0000"/>
                            <attachment id="12748386" name="HBASE-14178_v1.patch" size="2008" author="chenheng" created="Mon, 3 Aug 2015 03:19:22 +0000"/>
                            <attachment id="12748389" name="HBASE-14178_v2.patch" size="2488" author="chenheng" created="Mon, 3 Aug 2015 04:47:37 +0000"/>
                            <attachment id="12748421" name="HBASE-14178_v3.patch" size="3401" author="chenheng" created="Mon, 3 Aug 2015 09:27:53 +0000"/>
                            <attachment id="12748436" name="HBASE-14178_v4.patch" size="2406" author="chenheng" created="Mon, 3 Aug 2015 11:24:54 +0000"/>
                            <attachment id="12748640" name="HBASE-14178_v5.patch" size="3389" author="chenheng" created="Tue, 4 Aug 2015 10:38:17 +0000"/>
                            <attachment id="12748841" name="HBASE-14178_v6.patch" size="3396" author="Apache9" created="Wed, 5 Aug 2015 11:17:46 +0000"/>
                            <attachment id="12749008" name="HBASE-14178_v7.patch" size="3747" author="chenheng" created="Thu, 6 Aug 2015 07:12:26 +0000"/>
                            <attachment id="12749020" name="HBASE-14178_v8.patch" size="4208" author="chenheng" created="Thu, 6 Aug 2015 08:57:16 +0000"/>
                            <attachment id="12748346" name="jstack" size="168992" author="chenheng" created="Sun, 2 Aug 2015 07:54:41 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>13.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sun, 2 Aug 2015 08:30:45 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 13 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2i7wf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>