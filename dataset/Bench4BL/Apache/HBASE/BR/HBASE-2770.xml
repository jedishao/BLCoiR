<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sat Dec 03 16:59:17 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-2770/HBASE-2770.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-2770] Major compactions from shell may not major compact all families</title>
                <link>https://issues.apache.org/jira/browse/HBASE-2770</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;As part of a data center migration, I initiated a major_compaction request on all tables from the shell.  A few hours later, all the region servers in the cluster appeared to have completed the compactions and all compactionQueue metrics were back to 0.  However, some column families of some regions had not actually done a major compaction.&lt;/p&gt;

&lt;p&gt;Digging through logs and code, it looks like the following happened.  The shell makes a major compaction request which sets HRegion.forceMajorCompaction to true for every region.  Periodically, the HRegionServer.MajorCompactionChecker checks to see if a major compaction is needed in any family&apos;s store.  If so, calls CompactSplitThread.compactionRequested which ends up setting the region forceMajorCompaction to false, even if it is already in the compaction queue and set to true.  Then, when that region comes off the queue to be compacted, each family/store separately checks for whether it should do a major compaction, so some families may not do so.&lt;/p&gt;

&lt;p&gt;(This is not good if, for example, you&apos;re doing a DistCp of the hbase dir and later on the cluster decides to do a compaction on those files and deletes ones the DistCp job is looking for, causing it to fail.)&lt;/p&gt;</description>
                <environment></environment>
        <key id="12467631">HBASE-2770</key>
            <summary>Major compactions from shell may not major compact all families</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.png">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="3">Duplicate</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="davelatham">Dave Latham</reporter>
                        <labels>
                    </labels>
                <created>Tue, 22 Jun 2010 22:03:24 +0000</created>
                <updated>Fri, 20 Nov 2015 12:42:32 +0000</updated>
                            <resolved>Tue, 5 Jul 2011 17:19:35 +0000</resolved>
                                    <version>0.20.4</version>
                                    <fixVersion>0.92.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="12881813" author="stack" created="Wed, 23 Jun 2010 18:29:38 +0000"  >&lt;p&gt;Upping priority.  Marking for 0.21 as well as 0.20.6.  While in here, lets get rid of logging every time we schedule a compaction that has already been scheduled.&lt;/p&gt;</comment>
                            <comment id="12887954" author="stack" created="Tue, 13 Jul 2010 19:41:28 +0000"  >&lt;p&gt;@Dave This needs to be in 0.20.6?&lt;/p&gt;</comment>
                            <comment id="12887962" author="davelatham" created="Tue, 13 Jul 2010 19:47:03 +0000"  >&lt;p&gt;It was definitely a headache for us during our data center migration, but I&apos;ve got no immediate need for it if you&apos;re wanting to get 0.20.6 out and this is blocking the way.&lt;/p&gt;

&lt;p&gt;You can put a cluster into read-only mode and make sure that hbase doesn&apos;t touch the store files while copying them away by setting hbase.hregion.majorcompaction to a very high value to workaround this issue.&lt;/p&gt;</comment>
                            <comment id="12887965" author="stack" created="Tue, 13 Jul 2010 19:49:14 +0000"  >&lt;p&gt;Thanks for the fast comeback Dave.&lt;/p&gt;</comment>
                            <comment id="12918175" author="streamy" created="Tue, 5 Oct 2010 20:55:39 +0000"  >&lt;p&gt;Punting to 0.92 for now.  The bigger compaction/flush improvements should happen in that version.&lt;/p&gt;</comment>
                            <comment id="12927965" author="nspiegelberg" created="Wed, 3 Nov 2010 19:25:24 +0000"  >&lt;p&gt;Note that the compaction priority refactoring in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3160&quot; title=&quot;Compactions: Use more intelligent priorities for PriorityCompactionQueue&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3160&quot;&gt;&lt;del&gt;HBASE-3160&lt;/del&gt;&lt;/a&gt; fixed the case of this occurring in 0.90 trunk: when a store flush happens, the forceMajorCompact was being set to false.  Note that compactions are being refactored quite extensively right now, so we need to keep this bug in mind while making changes.  One thing that we should do is move the &apos;forceCompact&apos; state from the Region to the Store.  Because of various toggles coming soon, a major compaction can be downgraded if certain store thresholds are temporarily exceeded (e.g. thresholds to prevent OOM for pre-split regions).  If we&apos;re forced to minor compact, we should keep that state around and major compact on the next round.&lt;/p&gt;</comment>
                            <comment id="12928009" author="stack" created="Wed, 3 Nov 2010 21:24:29 +0000"  >&lt;p&gt;Will I close this Dave?&lt;/p&gt;</comment>
                            <comment id="13060014" author="davelatham" created="Tue, 5 Jul 2011 17:18:35 +0000"  >&lt;p&gt;Just noticed Ted&apos;s comment on the mailing list:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;Dave:&lt;br/&gt;
Nicolas has refactored major compaction code extensively.&lt;br/&gt;
Can you kindly verify whether &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2770&quot; title=&quot;Major compactions from shell may not major compact all families&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2770&quot;&gt;&lt;del&gt;HBASE-2770&lt;/del&gt;&lt;/a&gt; is still an issue for TRUNK ?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I don&apos;t really have time to review the current state of the compaction code and flags, but if that code&apos;s been extensively refactored, then let&apos;s close this issue and open a new one if it pops up again.&lt;/p&gt;</comment>
                            <comment id="13060016" author="davelatham" created="Tue, 5 Jul 2011 17:19:35 +0000"  >&lt;p&gt;Probably fixed in other refactoring.&lt;/p&gt;</comment>
                            <comment id="15017275" author="lars_francke" created="Fri, 20 Nov 2015 12:42:32 +0000"  >&lt;p&gt;This issue was closed as part of a bulk closing operation on 2015-11-20. All issues that have been resolved and where all fixVersions have been released have been closed (following discussions on the mailing list).&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310010">
                    <name>Incorporates</name>
                                                                <inwardlinks description="is part of">
                                        <issuelink>
            <issuekey id="12478482">HBASE-3160</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12493838">HBASE-3384</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 23 Jun 2010 18:29:38 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>26458</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 2 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0hj67:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>100368</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>