<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 02 20:26:56 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-1554/HBASE-1554.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-1554] TestHeapSize failing on Hudson</title>
                <link>https://issues.apache.org/jira/browse/HBASE-1554</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;TestHeapSize worked for me when tested locally but failing up on Hudson:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    [junit] Running org.apache.hadoop.hbase.io.TestHeapSize
    [junit] 2009-06-20 01:29:11,577 DEBUG [main] util.ClassSize(121): bytes
    [junit] 	class [B
    [junit] 2009-06-20 01:29:11,580 DEBUG [main] util.ClassSize(121): offset
    [junit] 	&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;
    [junit] 2009-06-20 01:29:11,580 DEBUG [main] util.ClassSize(121): length
    [junit] 	&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;
    [junit] 2009-06-20 01:29:11,581 DEBUG [main] util.ClassSize(147): Primitives 8, arrays 1, references(inlcuding 16, &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; object overhead) 2, refSize 4, size 32
    [junit] Tests run: 1, Failures: 1, Errors: 0, Time elapsed: 0.181 sec
    [junit] Test org.apache.hadoop.hbase.io.TestHeapSize FAILED
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12428436">HBASE-1554</key>
            <summary>TestHeapSize failing on Hudson</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.png">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="streamy">Jonathan Gray</assignee>
                                    <reporter username="apurtell">Andrew Purtell</reporter>
                        <labels>
                    </labels>
                <created>Sat, 20 Jun 2009 02:06:38 +0000</created>
                <updated>Sun, 13 Sep 2009 22:24:45 +0000</updated>
                            <resolved>Mon, 29 Jun 2009 23:29:19 +0000</resolved>
                                                    <fixVersion>0.20.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12722121" author="apurtell" created="Sat, 20 Jun 2009 02:09:40 +0000"  >&lt;p&gt;TestHFile is also failing, looks to be ClassSize related:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    [junit] Running org.apache.hadoop.hbase.io.hfile.TestHFile
    [junit] 2009-06-20 01:29:12,218 INFO  [main] hfile.TestHFile(121): writer=org.apache.hadoop.fs.FSDataOutputStream@
153f67e, compression=none
    [junit] 2009-06-20 01:29:12,250 INFO  [main] hfile.TestHFile(129): reader=org.apache.hadoop.fs.FSDataInputStream@
11671b2, compression=none, firstKey=0000000000, lastKey=0000000000, avgKeyLen=10, avgValueLen=10,
 entries=100, length=3738
    [junit] 2009-06-20 01:29:12,272 INFO  [main] hfile.TestHFile(121): writer=org.apache.hadoop.fs.FSDataOutputStream@
1a082e2, compression=gz
    [junit] 2009-06-20 01:29:12,301 WARN  [main] util.NativeCodeLoader(52): Unable to load &lt;span class=&quot;code-keyword&quot;&gt;native&lt;/span&gt;-hadoop library &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; your platform... using builtin-java classes where applicable
    [junit] 2009-06-20 01:29:12,315 INFO  [main] hfile.TestHFile(129): reader=org.apache.hadoop.fs.FSDataInputStream@
176cad3, compression=gz, firstKey=0000000000, lastKey=0000000000, avgKeyLen=10, avgValueLen=10,
 entries=100, length=1224
    [junit] 2009-06-20 01:29:14,830 DEBUG [main] util.ClassSize(121): count
    [junit] 	&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;
    [junit] 2009-06-20 01:29:14,830 DEBUG [main] util.ClassSize(121): blockKeys
    [junit] 	class [[B
    [junit] 2009-06-20 01:29:14,831 DEBUG [main] util.ClassSize(121): blockOffsets
    [junit] 	class [J
    [junit] 2009-06-20 01:29:14,832 DEBUG [main] util.ClassSize(121): blockDataSizes
    [junit] 	class [I
    [junit] 2009-06-20 01:29:14,832 DEBUG [main] util.ClassSize(121): size
    [junit] 	&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;
    [junit] 2009-06-20 01:29:14,833 DEBUG [main] util.ClassSize(121): comparator
    [junit] 	&lt;span class=&quot;code-keyword&quot;&gt;interface&lt;/span&gt; org.apache.hadoop.io.RawComparator
    [junit] 2009-06-20 01:29:14,833 DEBUG [main] util.ClassSize(147): Primitives 8, arrays 3, references(inlcuding 16, &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; object overhead) 3, refSize 4, size 72
    [junit] Tests run: 6, Failures: 1, Errors: 0, Time elapsed: 2.775 sec
    [junit] Test org.apache.hadoop.hbase.io.hfile.TestHFile FAILED
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12722123" author="nitay" created="Sat, 20 Jun 2009 02:16:31 +0000"  >&lt;p&gt;What about detecting 32 vs 64 bit jvm programatically in ClassSize? &lt;a href=&quot;http://java.sun.com/docs/hotspot/HotSpotFAQ.html#64bit_detection&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://java.sun.com/docs/hotspot/HotSpotFAQ.html#64bit_detection&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12722284" author="erikholstad@gmail.com" created="Sun, 21 Jun 2009 01:24:55 +0000"  >&lt;p&gt;All the issues are related to the fact that there is no place to set if you are running 32 or 64 bit machines at the moment and&lt;br/&gt;
this is needed for the test to pass.&lt;/p&gt;

&lt;p&gt;The tests are done in Classsize, but not in HeapSize, so we just need to find a good place to put this and some smaller changes&lt;br/&gt;
to the tests and we should be good to go.&lt;/p&gt;

&lt;p&gt;Erik&lt;/p&gt;</comment>
                            <comment id="12723704" author="streamy" created="Wed, 24 Jun 2009 19:54:14 +0000"  >&lt;p&gt;Confirmed that this issue is one with &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-1562&quot; title=&quot;How to handle the setting of 32 bit versus 64 bit machines&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-1562&quot;&gt;&lt;del&gt;HBASE-1562&lt;/del&gt;&lt;/a&gt;, will close once committed.&lt;/p&gt;</comment>
                            <comment id="12723717" author="streamy" created="Wed, 24 Jun 2009 20:05:20 +0000"  >&lt;p&gt;Fixed by commit of &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-1562&quot; title=&quot;How to handle the setting of 32 bit versus 64 bit machines&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-1562&quot;&gt;&lt;del&gt;HBASE-1562&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12723719" author="stack" created="Wed, 24 Jun 2009 20:09:41 +0000"  >&lt;p&gt;Hey man, maybe wait till actually passes!&lt;/p&gt;</comment>
                            <comment id="12725005" author="apurtell" created="Sun, 28 Jun 2009 22:36:42 +0000"  >&lt;p&gt;TestHeapSize is failing up on Hudson again.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/HBase-Patch/678/testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/HBase-Patch/678/testReport/&lt;/a&gt;&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Failed

org.apache.hadoop.hbase.io.TestHeapSize.testSizes
Failing for the past 7 builds (Since Failed#672 )
Took 71 ms.
Error Message

expected:&amp;lt;88&amp;gt; but was:&amp;lt;14824&amp;gt;

Stacktrace

junit.framework.AssertionFailedError: expected:&amp;lt;88&amp;gt; but was:&amp;lt;14824&amp;gt;
	at org.apache.hadoop.hbase.io.TestHeapSize.testSizes(TestHeapSize.java:57)

Standard Error

2009-06-28 20:48:26,914 DEBUG [main] util.ClassSize(162): map
	class java.util.concurrent.ConcurrentHashMap
2009-06-28 20:48:26,916 DEBUG [main] util.ClassSize(162): evictionLock
	class java.util.concurrent.locks.ReentrantLock
2009-06-28 20:48:26,917 DEBUG [main] util.ClassSize(162): evictionInProgress
	boolean
2009-06-28 20:48:26,918 DEBUG [main] util.ClassSize(162): evictionThread
	class org.apache.hadoop.hbase.io.hfile.LruBlockCache$EvictionThread
2009-06-28 20:48:26,918 DEBUG [main] util.ClassSize(162): scheduleThreadPool
	interface java.util.concurrent.ScheduledExecutorService
2009-06-28 20:48:26,919 DEBUG [main] util.ClassSize(162): size
	class java.util.concurrent.atomic.AtomicLong
2009-06-28 20:48:26,919 DEBUG [main] util.ClassSize(162): elements
	class java.util.concurrent.atomic.AtomicLong
2009-06-28 20:48:26,920 DEBUG [main] util.ClassSize(162): count
	class java.util.concurrent.atomic.AtomicLong
2009-06-28 20:48:26,920 DEBUG [main] util.ClassSize(162): stats
	class org.apache.hadoop.hbase.io.hfile.LruBlockCache$CacheStats
2009-06-28 20:48:26,921 DEBUG [main] util.ClassSize(162): maxSize
	long
2009-06-28 20:48:26,921 DEBUG [main] util.ClassSize(162): blockSize
	long
2009-06-28 20:48:26,922 DEBUG [main] util.ClassSize(162): acceptableFactor
	float
2009-06-28 20:48:26,923 DEBUG [main] util.ClassSize(162): minFactor
	float
2009-06-28 20:48:26,923 DEBUG [main] util.ClassSize(162): singleFactor
	float
2009-06-28 20:48:26,924 DEBUG [main] util.ClassSize(162): multiFactor
	float
2009-06-28 20:48:26,924 DEBUG [main] util.ClassSize(162): memoryFactor
	float
2009-06-28 20:48:26,924 DEBUG [main] util.ClassSize(162): overhead
	long
2009-06-28 20:48:26,925 DEBUG [main] util.ClassSize(188): Primitives 45, arrays 0, references(inlcuding 2, for object overhead) 10, refSize 4, size 88
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12725301" author="streamy" created="Mon, 29 Jun 2009 18:21:12 +0000"  >&lt;p&gt;I actually didn&apos;t know my new block cache was going to get committed yet.  It was done and tested but I knew there was a heapsize issue with it.&lt;/p&gt;

&lt;p&gt;There&apos;s a mismatch between how the LRU is tracking it&apos;s heap and how ClassSize is calculating it.&lt;/p&gt;

&lt;p&gt;Since the LRU pre-allocates it&apos;s backing map, I include all of that overhead in the initial overhead of the LRU.  ClassSize does not consider that memory, only the reference to the map.&lt;/p&gt;

&lt;p&gt;There are a large number of heapSize tests in the LRU unit tests, almost all of them at some point verify that it&apos;s properly keeping track of its size.  What is not done in those tests is verifying that the initial overhead/heapsize is perfectly aligned with the exact overhead of the object (and backing map).... However, since there is A) only one of these per regionserver, and B) the overhead from the Map is more than two orders of magnitude larger than the overhead of the LRU object itself... I don&apos;t think this is a particularly big deal.&lt;/p&gt;

&lt;p&gt;I will work with Erik on figuring this out.  We should do &lt;em&gt;some&lt;/em&gt; kind of test that will ensure if we make changes to the LRU without updating the overhead, a unit test will fail.  That either means a special constructor, or a different style of unit test that does a deeper analysis.... maybe both.&lt;/p&gt;</comment>
                            <comment id="12725308" author="streamy" created="Mon, 29 Jun 2009 18:39:26 +0000"  >&lt;p&gt;Modified TestHeapSize to just test a static final from LruBlockCache that is used to calculate the overhead of the object itself.&lt;/p&gt;

&lt;p&gt;Fixed that static final to be correct.&lt;/p&gt;

&lt;p&gt;Test now passes.  I&apos;m +1 on this being enough for heap size calculations for the lru.  The lru tests it&apos;s tracking of heapsize as it grows/shrinks, and this tests the baseline overhead of the object.&lt;/p&gt;</comment>
                            <comment id="12725310" author="streamy" created="Mon, 29 Jun 2009 18:39:55 +0000"  >&lt;p&gt;Shoot, hold on commit.  Going to add unit test for CachedBlock.&lt;/p&gt;</comment>
                            <comment id="12725320" author="streamy" created="Mon, 29 Jun 2009 19:33:18 +0000"  >&lt;p&gt;There&apos;s still a bit of a dissonance here, in that ClassSize calculates the overhead of a single object (and rather than the space of the objects within it, just the space to reference them).&lt;/p&gt;

&lt;p&gt;I&apos;m thinking what we really want is an additional ClassSize method like ClassSize.estimateFull() that includes the space of the objects beneath it.&lt;/p&gt;

&lt;p&gt;I don&apos;t have very much time today or before the meetup tomorrow, so I&apos;m going to throw up another patch that adds a few more checks in the style this currently works.  Will work on fancier stuff later in the week.&lt;/p&gt;</comment>
                            <comment id="12725342" author="streamy" created="Mon, 29 Jun 2009 20:50:45 +0000"  >&lt;p&gt;Adds additional tests in TestHeapSize for some of the native java types (and fixes their sizes to work).  Also adds a test for CachedBlock sizing.&lt;/p&gt;

&lt;p&gt;Will open another issue to deal with &quot;deep&quot; sizing.&lt;/p&gt;

&lt;p&gt;Tests pass for me now (32bit windows)... so please verify before commit on a real system &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="12725346" author="streamy" created="Mon, 29 Jun 2009 21:02:05 +0000"  >&lt;p&gt;Filed &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-1590&quot; title=&quot;Extend TestHeapSize and ClassSize to do &amp;quot;deep&amp;quot; sizing of Objects&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-1590&quot;&gt;&lt;del&gt;HBASE-1590&lt;/del&gt;&lt;/a&gt; for further work outside scope of this issue.&lt;/p&gt;</comment>
                            <comment id="12725390" author="stack" created="Mon, 29 Jun 2009 23:29:19 +0000"  >&lt;p&gt;Committed.  Thanks for patch Jon.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12428588">HBASE-1562</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12412095" name="HBASE-1554-v1.patch" size="1503" author="streamy" created="Mon, 29 Jun 2009 18:39:26 +0000"/>
                            <attachment id="12412101" name="HBASE-1554-v2.patch" size="8622" author="streamy" created="Mon, 29 Jun 2009 20:50:45 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sat, 20 Jun 2009 02:16:31 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>25821</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 23 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0hdxr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>99520</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>