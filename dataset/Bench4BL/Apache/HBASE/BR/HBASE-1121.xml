<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 02 19:33:59 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-1121/HBASE-1121.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-1121] Cluster confused about where -ROOT- is</title>
                <link>https://issues.apache.org/jira/browse/HBASE-1121</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Each node in cluster is doing below:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;2009-01-11 20:52:22,739 [regionserver/0:0:0:0:0:0:0:0:60020.compactor] DEBUG org.apache.hadoop.hbase.client.HConnectionManager$TableServers: Attempt 0 of 10 failed with &amp;lt;org.apache.hadoop.hbase.NotServingRegionException: org.apache.hadoop.hbase.NotServingRegionException: -ROOT-,,0
        at org.apache.hadoop.hbase.regionserver.HRegionServer.getRegion(HRegionServer.java:2064)
        at org.apache.hadoop.hbase.regionserver.HRegionServer.getClosestRowBefore(HRegionServer.java:1545)
        at sun.reflect.GeneratedMethodAccessor17.invoke(Unknown Source)
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
        at java.lang.reflect.Method.invoke(Method.java:597)
        at org.apache.hadoop.hbase.ipc.HBaseRPC$Server.call(HBaseRPC.java:632)
        at org.apache.hadoop.hbase.ipc.HBaseServer$Handler.run(HBaseServer.java:894)
&amp;gt;. Retrying after sleep of 20002009-01-11 20:52:22,742 [regionserver/0:0:0:0:0:0:0:0:60020.compactor] DEBUG org.apache.hadoop.hbase.client.HConnectionManager$TableServers: Found ROOT REGION =&amp;gt; {NAME =&amp;gt; &apos;-ROOT-,,0&apos;, STARTKEY =&amp;gt; &apos;&apos;, ENDKEY =&amp;gt; &apos;&apos;, ENCODED =&amp;gt; 70236052, TABLE =&amp;gt; {{NAME =&amp;gt; &apos;-ROOT-&apos;, IS_ROOT =&amp;gt; &apos;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&apos;, IS_META =&amp;gt; &apos;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&apos;, FAMILIES =&amp;gt; [{NAME =&amp;gt; &apos;info&apos;, BLOOMFILTER =&amp;gt; &apos;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&apos;, COMPRESSION =&amp;gt; &apos;NONE&apos;, VERSIONS =&amp;gt; &apos;10&apos;, LENGTH =&amp;gt; &apos;2147483647&apos;, TTL =&amp;gt; &apos;-1&apos;, IN_MEMORY =&amp;gt; &apos;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&apos;, BLOCKCACHE =&amp;gt; &apos;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&apos;}], INDEXES =&amp;gt; []}}2009-01-11 20:52:24,759 [regionserver/0:0:0:0:0:0:0:0:60020.compactor] DEBUG org.apache.hadoop.hbase.client.HConnectionManager$TableServers: Attempt 1 of 10 failed with &amp;lt;org.apache.hadoop.hbase.NotServingRegionException: org.apache.hadoop.hbase.NotServingRegionException: -ROOT-,,0
        at org.apache.hadoop.hbase.regionserver.HRegionServer.getRegion(HRegionServer.java:2064)
        at org.apache.hadoop.hbase.regionserver.HRegionServer.getClosestRowBefore(HRegionServer.java:1545)
        at sun.reflect.GeneratedMethodAccessor17.invoke(Unknown Source)
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
        at java.lang.reflect.Method.invoke(Method.java:597)
        at org.apache.hadoop.hbase.ipc.HBaseRPC$Server.call(HBaseRPC.java:632)
        at org.apache.hadoop.hbase.ipc.HBaseServer$Handler.run(HBaseServer.java:894)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I tried to close the root region and tripped over hbase-1120.&lt;/p&gt;

&lt;p&gt;So I killed the regionserver hosting &lt;del&gt;ROOT&lt;/del&gt; but weirdly had no effect as though the  regionservers&apos; internal cache of &lt;del&gt;ROOT&lt;/del&gt; location cannot be changed.&lt;/p&gt;</description>
                <environment>&lt;p&gt;TRUNK trying to do big upload&lt;/p&gt;</environment>
        <key id="12412155">HBASE-1121</key>
            <summary>Cluster confused about where -ROOT- is</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jimk">Jim Kellerman</assignee>
                                    <reporter username="stack">stack</reporter>
                        <labels>
                    </labels>
                <created>Sun, 11 Jan 2009 22:44:23 +0000</created>
                <updated>Sun, 13 Sep 2009 22:24:17 +0000</updated>
                            <resolved>Fri, 23 Jan 2009 23:24:27 +0000</resolved>
                                                    <fixVersion>0.19.1</fixVersion>
                    <fixVersion>0.20.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12662833" author="stack" created="Sun, 11 Jan 2009 22:57:17 +0000"  >&lt;p&gt;So, clients get right answer when they ask for where &lt;del&gt;ROOT&lt;/del&gt; is.  UI is all up running w/ &lt;del&gt;ROOT&lt;/del&gt; in same place.   The restarted regionserver complains about the &lt;del&gt;ROOT&lt;/del&gt; location wth above exception.&lt;/p&gt;</comment>
                            <comment id="12662836" author="stack" created="Sun, 11 Jan 2009 23:24:06 +0000"  >&lt;p&gt;This is on one of the regionservers that had been hosting root... 139... its being asked for the &lt;del&gt;ROOT&lt;/del&gt; by 140 though its been restarted.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;2009-01-11 23:04:39,674 [IPC Server handler 0 on 60020] ERROR org.apache.hadoop.hbase.regionserver.HRegionServer: org.apache.hadoop.hbase.NotServingRegionException: -ROOT-,,0
2009-01-11 23:04:39,674 [IPC Server handler 0 on 60020] INFO org.apache.hadoop.ipc.HBaseServer: IPC Server handler 0 on 60020, call getClosestRowBefore([B@32d27bb0, [B@18b679e1, [B@73fbaf73) from XX.XX.XX.140:53563: error: org.apache.hadoop.hbase.NotServingRegionException: -ROOT-,,0
org.apache.hadoop.hbase.NotServingRegionException: -ROOT-,,0
        at org.apache.hadoop.hbase.regionserver.HRegionServer.getRegion(HRegionServer.java:2064)
        at org.apache.hadoop.hbase.regionserver.HRegionServer.getClosestRowBefore(HRegionServer.java:1545)
        at sun.reflect.GeneratedMethodAccessor5.invoke(Unknown Source)
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
        at java.lang.reflect.Method.invoke(Method.java:597)
        at org.apache.hadoop.hbase.ipc.HBaseRPC$Server.call(HBaseRPC.java:632)
        at org.apache.hadoop.hbase.ipc.HBaseServer$Handler.run(HBaseServer.java:894)&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;On 140, 142 thinks it has the &lt;del&gt;ROOT&lt;/del&gt;:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2009-01-11 23:22:27,344 [IPC Server handler 4 on 60020] INFO org.apache.hadoop.ipc.HBaseServer: IPC Server handler 4 on 60020, call getClosestRowBefore([B@10321250, [B@47504a7e, [B@684abac5) from XX.XX.XX.142:58471: error: org.apache.hadoop.hbase.NotServingRegionException: -ROOT-,,0
org.apache.hadoop.hbase.NotServingRegionException: -ROOT-,,0
        at org.apache.hadoop.hbase.regionserver.HRegionServer.getRegion(HRegionServer.java:2064)
        at org.apache.hadoop.hbase.regionserver.HRegionServer.getClosestRowBefore(HRegionServer.java:1545)
        at sun.reflect.GeneratedMethodAccessor17.invoke(Unknown Source)
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
        at java.lang.reflect.Method.invoke(Method.java:597)
        at org.apache.hadoop.hbase.ipc.HBaseRPC$Server.call(HBaseRPC.java:632)
        at org.apache.hadoop.hbase.ipc.HBaseServer$Handler.run(HBaseServer.java:894)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12662840" author="stack" created="Sun, 11 Jan 2009 23:37:42 +0000"  >&lt;p&gt;It looks like its the regionhistorian trying to update about a compaction that is failing:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2009-01-11 06:11:56,405 [regionserver/0:0:0:0:0:0:0:0:60020.compactor] DEBUG org.apache.hadoop.hbase.regionserver.HStore: moving /hbasetrunk2/TestTable/compaction.dir/1701213566/info/mapfiles/4916277877406001197 to /hbasetrunk2/TestTable/1701213566/info/mapfiles/3125166216229916041
2009-01-11 06:11:56,472 [regionserver/0:0:0:0:0:0:0:0:60020.compactor] DEBUG org.apache.hadoop.hbase.regionserver.HStore: Completed major compaction of 1701213566/info store size is 188.2m
2009-01-11 06:11:56,480 [regionserver/0:0:0:0:0:0:0:0:60020.compactor] INFO org.apache.hadoop.hbase.regionserver.HRegion: compaction completed on region TestTable,0008454525,1231561159116 in 1mins, 8sec
2009-01-11 06:11:56,484 [regionserver/0:0:0:0:0:0:0:0:60020.compactor] DEBUG org.apache.hadoop.hbase.client.HConnectionManager$TableServers: Attempt 0 of 10 failed with &amp;lt;org.apache.hadoop.hbase.NotServingRegionException: org.apache.hadoop.hbase.NotServingRegionException: -ROOT-,,0
        at org.apache.hadoop.hbase.regionserver.HRegionServer.getRegion(HRegionServer.java:2064)
        at org.apache.hadoop.hbase.regionserver.HRegionServer.getClosestRowBefore(HRegionServer.java:1545)
        at sun.reflect.GeneratedMethodAccessor17.invoke(Unknown Source)
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
        at java.lang.reflect.Method.invoke(Method.java:597)
        at org.apache.hadoop.hbase.ipc.HBaseRPC$Server.call(HBaseRPC.java:632)
        at org.apache.hadoop.hbase.ipc.HBaseServer$Handler.run(HBaseServer.java:894)
&amp;gt;. Retrying after sleep of 2000
2009-01-11 06:11:56,487 [regionserver/0:0:0:0:0:0:0:0:60020.compactor] DEBUG org.apache.hadoop.hbase.client.HConnectionManager$TableServers: Found ROOT REGION =&amp;gt; {NAME =&amp;gt; &apos;-ROOT-,,0&apos;, STARTKEY =&amp;gt; &apos;&apos;, ENDKEY =&amp;gt; &apos;&apos;, ENCODED =&amp;gt; 70236052, TABLE =&amp;gt; {{NAME =&amp;gt; &apos;-ROOT-&apos;, IS_ROOT =&amp;gt; &apos;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&apos;, IS_META =&amp;gt; &apos;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&apos;, FAMILIES =&amp;gt; [{NAME =&amp;gt; &apos;info&apos;, BLOOMFILTER =&amp;gt; &apos;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&apos;, COMPRESSION =&amp;gt; &apos;NONE&apos;, VERSIONS =&amp;gt; &apos;10&apos;, LENGTH =&amp;gt; &apos;2147483647&apos;, TTL =&amp;gt; &apos;-1&apos;, IN_MEMORY =&amp;gt; &apos;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&apos;, BLOCKCACHE =&amp;gt; &apos;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&apos;}], INDEXES =&amp;gt; []}}
2009-01-11 06:11:58,491 [regionserver/0:0:0:0:0:0:0:0:60020.compactor] DEBUG org.apache.hadoop.hbase.client.HConnectionManager$TableServers: Attempt 1 of 10 failed with &amp;lt;org.apache.hadoop.hbase.NotServingRegionException: org.apache.hadoop.hbase.NotServingRegionException: -ROOT-,,0
        at org.apache.hadoop.hbase.regionserver.HRegionServer.getRegion(HRegionServer.java:2064)
        at org.apache.hadoop.hbase.regionserver.HRegionServer.getClosestRowBefore(HRegionServer.java:1545)
        at sun.reflect.GeneratedMethodAccessor17.invoke(Unknown Source)
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
        at java.lang.reflect.Method.invoke(Method.java:597)
        at org.apache.hadoop.hbase.ipc.HBaseRPC$Server.call(HBaseRPC.java:632)
        at org.apache.hadoop.hbase.ipc.HBaseServer$Handler.run(HBaseServer.java:894)
&amp;gt;. Retrying after sleep of 2000
...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Above goes on till attempt 8, then it starts over again at 0 and just keeps on going.&lt;/p&gt;

&lt;p&gt;Why ain&apos;t we recalibrating to find new &lt;del&gt;ROOT&lt;/del&gt; location.&lt;/p&gt;

&lt;p&gt;Cluster is hosed unless I restart a regionserver one at a time or just restart whole cluster.&lt;/p&gt;</comment>
                            <comment id="12662842" author="stack" created="Sun, 11 Jan 2009 23:45:26 +0000"  >&lt;p&gt;This looks like where things started to go wrong:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2009-01-11 06:11:13,560 [IPC Server handler 0 on 60020] WARN org.apache.hadoop.ipc.HBaseServer: IPC Server Responder, call batchUpdates([B@18e6b7f2, [Lorg.apache.hadoop.hbase.io.BatchUpdate;@6ff74992) from XX.XX.XX.141:40706: output error
2009-01-11 06:11:13,561 [IPC Server handler 0 on 60020] INFO org.apache.hadoop.ipc.HBaseServer: IPC Server handler 0 on 60020 caught: java.nio.channels.ClosedChannelException
        at sun.nio.ch.SocketChannelImpl.ensureWriteOpen(SocketChannelImpl.java:126)
        at sun.nio.ch.SocketChannelImpl.write(SocketChannelImpl.java:324)
        at org.apache.hadoop.hbase.ipc.HBaseServer.channelWrite(HBaseServer.java:1084)
        at org.apache.hadoop.hbase.ipc.HBaseServer.access$1900(HBaseServer.java:70)
        at org.apache.hadoop.hbase.ipc.HBaseServer$Responder.processResponse(HBaseServer.java:592)
        at org.apache.hadoop.hbase.ipc.HBaseServer$Responder.doRespond(HBaseServer.java:656)
        at org.apache.hadoop.hbase.ipc.HBaseServer$Handler.run(HBaseServer.java:922)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;141 went away.&lt;/p&gt;</comment>
                            <comment id="12662848" author="stack" created="Sun, 11 Jan 2009 23:57:51 +0000"  >&lt;p&gt;... will see this:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2009-01-11 23:47:26,255 [regionserver/0:0:0:0:0:0:0:0:60020.compactor] DEBUG org.apache.hadoop.hbase.client.HConnectionManager$TableServers: Found ROOT REGION =&amp;gt; {NAME =&amp;gt; &apos;-ROOT-,,0&apos;, STARTKEY =&amp;gt; &apos;&apos;, ENDKEY =&amp;gt; &apos;&apos;, ENCODED =&amp;gt; 70236052, TABLE =&amp;gt; {{NAME =&amp;gt; &apos;-ROOT-&apos;, IS_ROOT =&amp;gt; &apos;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&apos;, IS_META =&amp;gt; &apos;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&apos;, FAMILIES =&amp;gt; [{NAME =&amp;gt; &apos;info&apos;, BLOOMFILTER =&amp;gt; &apos;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&apos;, COMPRESSION =&amp;gt; &apos;NONE&apos;, VERSIONS =&amp;gt; &apos;10&apos;, LENGTH =&amp;gt; &apos;2147483647&apos;, TTL =&amp;gt; &apos;-1&apos;, IN_MEMORY =&amp;gt; &apos;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&apos;, BLOCKCACHE =&amp;gt; &apos;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&apos;}], INDEXES =&amp;gt; []}}
2009-01-11 23:49:02,268 [regionserver/0:0:0:0:0:0:0:0:60020.compactor] WARN org.apache.hadoop.hbase.RegionHistorian: Unable to &apos;Region compaction completed in 10sec&apos;
org.apache.hadoop.hbase.client.RetriesExhaustedException: Trying to contact region server Some server &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; region , row &apos;TestTable,0000442359,1231570256381&apos;, but failed after 11 attempts.
Exceptions:
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;They might be &apos;harmless&apos; in that it happens every time the regionhistorian tries to report a new event.  Really noisy though. &lt;/p&gt;

&lt;p&gt;My cluster is broke.  All of the above makes it hard to debug.&lt;/p&gt;</comment>
                            <comment id="12663038" author="stack" created="Mon, 12 Jan 2009 18:40:01 +0000"  >&lt;p&gt;This issue has aspects of &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-964&quot; title=&quot;Startup stuck &amp;quot;waiting for root region&amp;quot;&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-964&quot;&gt;&lt;del&gt;HBASE-964&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12663151" author="stack" created="Tue, 13 Jan 2009 00:02:46 +0000"  >&lt;p&gt;So its not &apos;innocuous&apos; as thought above in that we just lose the regionhistorian updates.  It actually makes compactions/splits fail:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
 ERROR org.apache.hadoop.hbase.regionserver.CompactSplitThread: Compaction/Split failed &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; region...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12663236" author="stack" created="Tue, 13 Jan 2009 05:50:41 +0000"  >&lt;p&gt;Better logging in HCM so can try to tell whats happening around rediscovery of &lt;del&gt;ROOT&lt;/del&gt; location&lt;/p&gt;</comment>
                            <comment id="12663239" author="stack" created="Tue, 13 Jan 2009 06:00:46 +0000"  >&lt;p&gt;hbase-1123 killed investigation of this issue.  I committed the better logging for next time.&lt;/p&gt;</comment>
                            <comment id="12665623" author="stack" created="Tue, 20 Jan 2009 22:52:42 +0000"  >&lt;p&gt;The scheme for setting root region in HRS looks badly broken.  Its set once on line #315 and the flat haveRootRegion makes it so its never ever reset.&lt;/p&gt;</comment>
                            <comment id="12665626" author="jimk" created="Tue, 20 Jan 2009 23:10:38 +0000"  >&lt;p&gt;The reason for this is that the root region needs to be set before any HTable accesses are&lt;br/&gt;
done. It is never reset, because it is assumed that HTable/HConnectionManager will detect if&lt;br/&gt;
the root region has moved and recalibrate accordingly. During the startup process, an HTable&lt;br/&gt;
in a server process will never start because it cannot find the root or meta regions (because&lt;br/&gt;
it is trying to serve the root or meta regions). It is a total hack to work around the fact&lt;br/&gt;
that HTable/HConnectionManager do not work in server processes, especially during safe-mode.&lt;/p&gt;

&lt;p&gt;This is why I have advocated in the past for never using HTable in server processes. The only&lt;br/&gt;
reason we have done so, is that doing HRegionServer RPC&apos;s for similar HTable requests are a&lt;br/&gt;
whole lot more complicated, and would require a duplication of code (or a significant&lt;br/&gt;
refactoring - I am opposed to duplication of code, but the refactoring is not going to be&lt;br/&gt;
trivial - in fact, I see it as being very difficult)&lt;/p&gt;</comment>
                            <comment id="12665632" author="stack" created="Tue, 20 Jan 2009 23:21:45 +0000"  >&lt;p&gt;If HTable in servers is a &apos;total hack&apos; we should move them out.&lt;/p&gt;

&lt;p&gt;J-D (or Nitay) have found why HCM doesn&apos;t recalibrate:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
          &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!useCache || rootRegionLocation == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; locateRootRegion();
          }
          &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; rootRegionLocation;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;rootRegionLocation is not set with the just found location.&lt;/p&gt;

&lt;p&gt;Going to test locally.&lt;/p&gt;</comment>
                            <comment id="12665742" author="stack" created="Wed, 21 Jan 2009 07:13:45 +0000"  >&lt;p&gt;I&apos;ve spent a bunch of time trying to reproduce but cannot.  I put up 4  node cluster and tried various sequences of moving &lt;del&gt;ROOT&lt;/del&gt; around cluster and then .META.   I wanted to reproduce so I could prove the J-D (+nitay) found issue fixed this prob.&lt;/p&gt;

&lt;p&gt;I think I should commit the below anyways:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Index: src/java/org/apache/hadoop/hbase/client/HConnectionManager.java
===================================================================
--- src/java/org/apache/hadoop/hbase/client/HConnectionManager.java     (revision 736178)
+++ src/java/org/apache/hadoop/hbase/client/HConnectionManager.java     (working copy)
@@ -445,7 +445,8 @@
           &lt;span class=&quot;code-comment&quot;&gt;// second waits. The second thread will not &lt;span class=&quot;code-keyword&quot;&gt;do&lt;/span&gt; find.
&lt;/span&gt;           
           &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!useCache || rootRegionLocation == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
-            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; locateRootRegion();
+            &lt;span class=&quot;code-comment&quot;&gt;// Cache &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; location.
&lt;/span&gt;+            &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.rootRegionLocation = locateRootRegion();
           }
           r
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt; ...maybe I need to open a new issue to do it.&lt;/p&gt;</comment>
                            <comment id="12665954" author="stack" created="Wed, 21 Jan 2009 20:15:39 +0000"  >&lt;p&gt;JK committed above.  He doesn&apos;t think it&apos;ll do any harm.&lt;/p&gt;</comment>
                            <comment id="12665985" author="jimk" created="Wed, 21 Jan 2009 22:08:28 +0000"  >&lt;p&gt;I managed to reproduce this on a three node cluster as follows:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;ensure root and meta regions are assigned to different nodes&lt;/li&gt;
	&lt;li&gt;while running PerformanceEvaluation
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;first kill the root server (and wait for it to be reassigned) - it needs to land on the node that is not serving meta&lt;/li&gt;
		&lt;li&gt;kill the server hosting meta&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;the remaining server never refinds root or meta.&lt;/p&gt;

&lt;p&gt;The patch does not help if the root lands on the same node as the master.&lt;/p&gt;</comment>
                            <comment id="12666685" author="jimk" created="Fri, 23 Jan 2009 20:27:14 +0000"  >&lt;p&gt;Patch for trunk.&lt;/p&gt;</comment>
                            <comment id="12666707" author="jimk" created="Fri, 23 Jan 2009 21:03:46 +0000"  >&lt;p&gt;Summary of changes:&lt;/p&gt;

&lt;p&gt;hbase-default.xml:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;change default HLog block size from 64MB to 1MB&lt;/li&gt;
	&lt;li&gt;remove hbase.regionserver.safemode.period - not in any way related to actual cluster safe mode. Now HRegionServer gets safe mode status from master.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;src/test/hbase-site.xml:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;disable safe mode for regression tests. Necessary for them to run successfully&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;src/test/TestSerialization:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;add missing @Override annotations&lt;/li&gt;
	&lt;li&gt;since some statics have been moved out of HLog, use constructor to create HMsg objects&lt;br/&gt;
HRegionServer:&lt;/li&gt;
	&lt;li&gt;move some statics from HLog to here because that is the only place they are used&lt;/li&gt;
	&lt;li&gt;rename SafeModeThread to CompactionLimitThread because that it what it was really doing.&lt;/li&gt;
	&lt;li&gt;CompactionLimitThread now waits for the cluster to exit safe mode rather than waiting an arbitrary period of time&lt;/li&gt;
	&lt;li&gt;if in safe mode, look at HMsg from master to determine if safe mode is done&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;HLog:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Change default block size from 64MB to 1MB&lt;/li&gt;
	&lt;li&gt;Remove statics used only by a single class&lt;/li&gt;
	&lt;li&gt;Add new constructors so that Master can tell region server if safe mode is still in effect&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;ServerManager:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Move some of the HLog statics here.&lt;/li&gt;
	&lt;li&gt;use new HLog constructors to tell region server if safe mode is still in effect&lt;/li&gt;
	&lt;li&gt;only cache root region location during safe mode. Once we exit safe mode we unset it so that HConnectionManager will recalibrate if the root region location changes.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;ProcessRegionOpen, ProcessRegionClose&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;metaRegion is now variable and these classes need to call their parent class to determine the location of the meta region they need. Previously, if the meta region moved, these classes would not recalibrate.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;RegionManager:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;use new HMsg constructors to tell region servers whether we are in safe mode or not.&lt;/li&gt;
	&lt;li&gt;once we exit safe mode, we unset the root region location in HConnectionManager so that it will recalibrate if the root region moves.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;ProcessRegionStatusChange:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;parent class of ProcessRegionOpen and ProcessRegionClose&lt;/li&gt;
	&lt;li&gt;implements getMetaRegion which provides for reassignment of meta regions from one server to another&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;HConnectionManager:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;do not cache root region location. If recalibrating, ask the master where the root region is.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;HMsg:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;added private boolean safeMode (settable only by master)&lt;/li&gt;
	&lt;li&gt;Move static declarations to modules that use them&lt;/li&gt;
	&lt;li&gt;Add new constructors so master can inform region servers of safe mode status&lt;/li&gt;
	&lt;li&gt;add new accessor method (isInSafeMode()) so region servers can determine if safe mode is still in effect&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="12666782" author="jimk" created="Fri, 23 Jan 2009 23:24:26 +0000"  >&lt;p&gt;Committed to branch and trunk.&lt;/p&gt;</comment>
                            <comment id="12666899" author="apurtell" created="Sat, 24 Jan 2009 12:03:29 +0000"  >&lt;p&gt;Did you change how &quot;hbase.regionserver.safemode.period&quot; is handled on the HRS? Does the HRS still run the safe mode thread for slowly ramping up compactions/splits on startup?&lt;/p&gt;</comment>
                            <comment id="12666952" author="jimk" created="Sat, 24 Jan 2009 16:43:11 +0000"  >&lt;p&gt;&amp;gt; Andrew Purtell - 24/Jan/09 04:03 AM&lt;br/&gt;
&amp;gt; Did you change how &quot;hbase.regionserver.safemode.period&quot; is handled on the HRS?&lt;/p&gt;

&lt;p&gt;Yes. The HRS now waits for the master to tell it when safe mode is off.&lt;/p&gt;

&lt;p&gt;&amp;gt; Does the HRS still run the safe mode thread for slowly ramping up compactions/splits on startup?&lt;/p&gt;

&lt;p&gt;Yes. After exiting safe mode, HRS slowly ramps up compactions and splits. The thread is now&lt;br/&gt;
called the CompactionLimitThread&lt;/p&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12398602" name="1121.patch" size="24414" author="jimk" created="Fri, 23 Jan 2009 20:27:14 +0000"/>
                            <attachment id="12397751" name="1121.patch" size="2976" author="stack" created="Tue, 13 Jan 2009 05:50:41 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 20 Jan 2009 23:10:38 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>25585</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 45 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0hbg7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>99117</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>