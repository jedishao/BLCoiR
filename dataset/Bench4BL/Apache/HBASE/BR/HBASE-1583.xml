<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 02 20:10:34 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-1583/HBASE-1583.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-1583] Start/Stop of large cluster untenable</title>
                <link>https://issues.apache.org/jira/browse/HBASE-1583</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Starting and stopping a loaded large cluster is way too flakey and takes too long.  This is 0.19.x but same issues apply to TRUNK I&apos;d say.&lt;/p&gt;

&lt;p&gt;At pset with our &amp;gt; 100 nodes carrying 6k regions:&lt;/p&gt;

&lt;p&gt;+ shutdown takes way too long.... maybe ten minutes or so.  We compact regions inline with shutdown.  We should just go down.  It doesn&apos;t seem like all regionservers go down everytime either.&lt;br/&gt;
+ startup is a mess with our assigning out regions an rebalancing at same time.  By time that the compactions on open run, it can be near an hour before whole thing settles down and becomes useable&lt;/p&gt;</description>
                <environment></environment>
        <key id="12428823">HBASE-1583</key>
            <summary>Start/Stop of large cluster untenable</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="stack">stack</assignee>
                                    <reporter username="stack">stack</reporter>
                        <labels>
                    </labels>
                <created>Thu, 25 Jun 2009 01:05:08 +0000</created>
                <updated>Sun, 13 Sep 2009 22:24:47 +0000</updated>
                            <resolved>Thu, 16 Jul 2009 23:30:52 +0000</resolved>
                                                    <fixVersion>0.20.0</fixVersion>
                                        <due></due>
                            <votes>1</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="12723845" author="ryanobjc" created="Thu, 25 Jun 2009 01:17:07 +0000"  >&lt;p&gt;some thoughts:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;get rid of compactions during startup/shutdown.  There is no reason to run compactions at those times.&lt;/li&gt;
	&lt;li&gt;dont worry about compacting reference regions as quickly, we can wait a few minutes if necessary.&lt;/li&gt;
	&lt;li&gt;make shut down flush memstore as fast as possible, then get the heck outta there.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;we need to do more work on bringing up regions as fast as possible in 0.21.  The master needs to blast region assignments out there in a threaded/performant manner, rather than waiting for 3-second checkins to do their magic.&lt;/p&gt;

&lt;p&gt;Finally I have decided to up the size of a region on my own set-up.  256MB seems a little too small, and with even twice as large regions, i end up with less than half the region count!&lt;/p&gt;</comment>
                            <comment id="12723861" author="jimk" created="Thu, 25 Jun 2009 01:35:37 +0000"  >&lt;p&gt;@stack:&lt;/p&gt;

&lt;p&gt;&amp;gt; startup is a mess with our assigning out regions an rebalancing at same time. By time that the&lt;br/&gt;
&amp;gt; compactions on open run, it can be near an hour before whole thing settles down and becomes&lt;br/&gt;
&amp;gt; useable&lt;/p&gt;

&lt;p&gt;safe mode was to prevent rebalancing during startup. Are we not using safe mode anymore?&lt;/p&gt;

&lt;p&gt;@ryan&lt;/p&gt;

&lt;p&gt;&amp;gt; The master needs to blast region assignments out there in a threaded/performant manner&lt;/p&gt;

&lt;p&gt;What I was planning to do for 0.21 when I put region assignments in ZK was to make a znode&lt;br/&gt;
whose children are unassigned regions. A region server can then decide if it is too busy or&lt;br/&gt;
not, and if not, remove the unassigned region from the list and add it to its list of regions being&lt;br/&gt;
served once the region is available.&lt;/p&gt;

&lt;p&gt;This removes the master from region assignment. It would then only need to detect unassigned&lt;br/&gt;
regions.&lt;/p&gt;</comment>
                            <comment id="12723883" author="stack" created="Thu, 25 Jun 2009 03:34:23 +0000"  >&lt;p&gt;Safe mode is still there.  Thats just period during which all machines report in and during which we hand out catalog regions.  After safe mode elapses, then the mayhem breaks out as master tries to hand out 6k regions ten or so at a time balancing at same time.&lt;/p&gt;

&lt;p&gt;Region assignment needs to part of larger scale rewrite of master function.  Hows does a master figure a region unassigned?  It reads .META. table to figure current state.  We need to be careful how we bridge scan of .META. and read of zk.&lt;/p&gt;</comment>
                            <comment id="12723885" author="ryanobjc" created="Thu, 25 Jun 2009 03:40:29 +0000"  >&lt;p&gt;It would also be neato to have more optimal global assignment of regions. Any given table should be spread out as much as possible.&lt;/p&gt;
</comment>
                            <comment id="12724327" author="streamy" created="Thu, 25 Jun 2009 22:31:29 +0000"  >&lt;p&gt;I like your idea, ryan.  Next generation of balancing needs to take into account actual usage that comprises a complex notion of &quot;load&quot; including memcache, er memstore, usage, block cache usage, and as you say, an additional factor could be how many other regions from the same table are already assigned to that regionserver.&lt;/p&gt;</comment>
                            <comment id="12724350" author="apurtell" created="Fri, 26 Jun 2009 00:11:32 +0000"  >&lt;p&gt;My understanding for 0.21 is the region assignment process is going to be largely unmediated by the master, except for the case where the master finds an unassigned region in META and puts up a node into the &quot;to be assigned&quot; queue out in ZK. My opinion this is the way to go, but how a regionserver is to judge its load relative to others, or even learn about the load of others, is an unanswered question. Furthermore, there must be a mechanism in place such that some regionserver will take on a new region if all others have passed on it.  Is there an issue up for this type of stuff yet? &lt;/p&gt;</comment>
                            <comment id="12724373" author="stack" created="Fri, 26 Jun 2009 03:39:45 +0000"  >&lt;p&gt;We should open an issue Andrew.  What&apos;ll we call it?  Master redesign?&lt;/p&gt;</comment>
                            <comment id="12724588" author="jdcryans" created="Fri, 26 Jun 2009 15:54:27 +0000"  >&lt;p&gt;+1 on this issue&lt;/p&gt;

&lt;p&gt;Also btw the Master redesign is &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-1110&quot; title=&quot;Distribute the master role to HRS after ZK integration&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-1110&quot;&gt;&lt;del&gt;HBASE-1110&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="12725218" author="viper799" created="Mon, 29 Jun 2009 15:33:43 +0000"  >&lt;p&gt;I suggested that we do not do come out of safe mode until all regions have been assigned when we added safe mode and make the regions not run compactions while in safe mode I thank that would be an easy fix for this problem&lt;br/&gt;
I have seen the same thing when you have region that are behind on compactions after a shutdown on start up compaction tie up reassignments.&lt;/p&gt;

&lt;p&gt;Billy&lt;/p&gt;</comment>
                            <comment id="12725220" author="viper799" created="Mon, 29 Jun 2009 15:35:56 +0000"  >&lt;p&gt;+1 on the kill compaction on shutdown why not just kill the thread and not let it finish it will get done on restart so we will not lose anything.&lt;/p&gt;</comment>
                            <comment id="12727145" author="stack" created="Fri, 3 Jul 2009 21:36:33 +0000"  >&lt;p&gt;Small jgray suggested optimization; don&apos;t compact on open unless has References&lt;/p&gt;</comment>
                            <comment id="12732069" author="stack" created="Thu, 16 Jul 2009 18:36:42 +0000"  >&lt;p&gt;Here is a patch to disable compaction on close of a region (helps with disable of table too).&lt;/p&gt;</comment>
                            <comment id="12732100" author="streamy" created="Thu, 16 Jul 2009 19:20:20 +0000"  >&lt;p&gt;+1 on 1583-nocompactonclose.patch&lt;/p&gt;</comment>
                            <comment id="12732103" author="stack" created="Thu, 16 Jul 2009 19:25:41 +0000"  >&lt;p&gt;This patch adds to the previous.  It adds no compaction on open unless region has references.&lt;/p&gt;</comment>
                            <comment id="12732122" author="streamy" created="Thu, 16 Jul 2009 19:58:32 +0000"  >&lt;p&gt;Looks good to me.&lt;/p&gt;</comment>
                            <comment id="12732156" author="stack" created="Thu, 16 Jul 2009 20:58:06 +0000"  >&lt;p&gt;With this patch applied and with &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-1058&quot; title=&quot;Prevent runaway compactions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-1058&quot;&gt;&lt;del&gt;HBASE-1058&lt;/del&gt;&lt;/a&gt; reverted, up and down as well as enable/disable is much smoother.&lt;/p&gt;

&lt;p&gt;Let me now take a look at &apos;safe mode&apos;.  Talking with JK, looks like its not working properly.  All regions were supposed to be assigned while in safe mode but not working.&lt;/p&gt;</comment>
                            <comment id="12732170" author="apurtell" created="Thu, 16 Jul 2009 21:21:25 +0000"  >&lt;p&gt;Ack on safe mode having oddities. I brought down a cluster with 133 regions cleanly and restarted it just now. Right away ~128 regions were assigned out. The rest were assigned out a few minutes later. Invoking &apos;enable&apos; on a incompletely assigned table prodded the master into some action but did not bring things up all the way as this kludge has done in the past. &lt;/p&gt;</comment>
                            <comment id="12732243" author="stack" created="Thu, 16 Jul 2009 23:16:24 +0000"  >&lt;p&gt;I took a look at this safe mode stuff.  Its broken.  Will open an issue.  Whats happening is that we exit safe mode near immediately after startup because initial MetaScanner scan does nothing except set that initial scan has completed (though it did nothing &amp;#8211; original idea was that initialScan would do first scan of the newly deployed .META.).  So, we exit safe mode near immediately after startup.&lt;/p&gt;

&lt;p&gt;Fixing metascanner so initial scan doesn&apos;t happen till we&apos;ve scanned actual deploy so safe mode stays in place while deploy is going on kills our assignment rate.  It crawls.  I gave up trying to debug more since these above patches undoing compactions on close and open seem to be enough to close this issue at least for 0.20.0 release.&lt;/p&gt;</comment>
                            <comment id="12732249" author="stack" created="Thu, 16 Jul 2009 23:30:52 +0000"  >&lt;p&gt;Committed to branch and trunk.  Resolving this issue.  There is more we can do but this I think is enough for 0.20.0.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12413718" name="1583-nocompactonclose.patch" size="2383" author="stack" created="Thu, 16 Jul 2009 18:36:42 +0000"/>
                            <attachment id="12413725" name="1583-v2-nocompactonopenclose.patch" size="3886" author="stack" created="Thu, 16 Jul 2009 19:24:45 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 25 Jun 2009 01:17:07 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>25844</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 21 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0he47:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>99549</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310192" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Release Note</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>No compaction on disable or shutdown of cluster.  No disable on open or enable unless the region has references.</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>