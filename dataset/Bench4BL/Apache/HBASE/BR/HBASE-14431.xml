<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Thu Dec 01 21:16:53 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-14431/HBASE-14431.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-14431] AsyncRpcClient#removeConnection() never removes connection from connections pool if server fails</title>
                <link>https://issues.apache.org/jira/browse/HBASE-14431</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;I was playing with master branch in distributed mode (3 rs + master + backup_master) and notice strange behavior when i was testing this sequence of events on single rs: /kill/start/run_balancer while client was writing data to cluster (LoadTestTool).&lt;br/&gt;
I have notice that LTT fails with following:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2015-09-09 11:05:58,364 INFO  [main] client.AsyncProcess: #2, waiting &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; some tasks to finish. Expected max=0, tasksInProgress=35
Exception in thread &lt;span class=&quot;code-quote&quot;&gt;&quot;main&quot;&lt;/span&gt; org.apache.hadoop.hbase.client.RetriesExhaustedWithDetailsException: Failed 1 action: BindException: 1 time, 
	at org.apache.hadoop.hbase.client.AsyncProcess$BatchErrors.makeException(AsyncProcess.java:228)
	at org.apache.hadoop.hbase.client.AsyncProcess$BatchErrors.access$1800(AsyncProcess.java:208)
	at org.apache.hadoop.hbase.client.AsyncProcess.waitForAllPreviousOpsAndReset(AsyncProcess.java:1697)
	at org.apache.hadoop.hbase.client.BufferedMutatorImpl.backgroundFlushCommits(BufferedMutatorImpl.java:211)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;After some digging  and adding some more logging in code i have notice that following condition in  &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;AsyncRpcClient.removeConnection(AsyncRpcChannel connection) &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt; is never true:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (connectionInPool == connection) {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt; 
&lt;p&gt;causing that  &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;AsyncRpcChannel&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt; connection is never removed from &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;connections&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt; pool in case rs fails.&lt;/p&gt;

&lt;p&gt;After changing this condition to:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (connectionInPool.address.equals(connection.address)) {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;issue was resolved and client was removing failed server from connections pool.&lt;br/&gt;
I will attach patch after running some more tests.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12863949">HBASE-14431</key>
            <summary>AsyncRpcClient#removeConnection() never removes connection from connections pool if server fails</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.png">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="asamir">Samir Ahmic</assignee>
                                    <reporter username="asamir">Samir Ahmic</reporter>
                        <labels>
                    </labels>
                <created>Mon, 14 Sep 2015 17:44:28 +0000</created>
                <updated>Wed, 27 Jan 2016 15:28:38 +0000</updated>
                            <resolved>Sat, 19 Sep 2015 14:36:28 +0000</resolved>
                                    <version>2.0.0</version>
                    <version>1.0.2</version>
                    <version>1.1.2</version>
                                    <fixVersion>2.0.0</fixVersion>
                    <fixVersion>1.2.0</fixVersion>
                    <fixVersion>1.3.0</fixVersion>
                    <fixVersion>1.1.3</fixVersion>
                                    <component>IPC/RPC</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>8</watches>
                                                                <comments>
                            <comment id="14743966" author="stack" created="Mon, 14 Sep 2015 18:21:47 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=asamir&quot; class=&quot;user-hover&quot; rel=&quot;asamir&quot;&gt;Samir Ahmic&lt;/a&gt; Nice debugging.&lt;/p&gt;</comment>
                            <comment id="14745146" author="chenheng" created="Tue, 15 Sep 2015 09:44:46 +0000"  >&lt;p&gt;Is it a better choice to override &lt;tt&gt;hashCode&lt;/tt&gt; method in &lt;tt&gt;AsyncRpcChannel&lt;/tt&gt; ?&lt;/p&gt;</comment>
                            <comment id="14745379" author="asamir" created="Tue, 15 Sep 2015 12:46:34 +0000"  >&lt;p&gt;bg.  Is it a better choice to override hashCode method in AsyncRpcChannel ?&lt;br/&gt;
I don&apos;t see that method. Can you elaborate ?&lt;/p&gt;

&lt;p&gt;BTW is there a reason why &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13337&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;HBASE-13337&lt;/a&gt; is not committed to master branch?  Without it any testing where restart of servers is included will cause issues and only in master branch AsyncRpcClient is default client implementation.&lt;/p&gt;</comment>
                            <comment id="14745457" author="stack" created="Tue, 15 Sep 2015 13:38:24 +0000"  >&lt;blockquote&gt;&lt;p&gt;BTW is there a reason why &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13337&quot; title=&quot;Table regions are not assigning back, after restarting all regionservers at once.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13337&quot;&gt;&lt;del&gt;HBASE-13337&lt;/del&gt;&lt;/a&gt; is not committed to master branch? &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;None. Mistake on my part. Fixed. Thanks for noticing &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=asamir&quot; class=&quot;user-hover&quot; rel=&quot;asamir&quot;&gt;Samir Ahmic&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14745518" author="chenheng" created="Tue, 15 Sep 2015 14:13:51 +0000"  >&lt;blockquote&gt;
&lt;p&gt;Is it a better choice to override hashCode method in AsyncRpcChannel ?&lt;br/&gt;
I don&apos;t see that method. Can you elaborate ?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;In class &lt;tt&gt;AsyncRpcChannel&lt;/tt&gt;, we override &lt;tt&gt;hashCode&lt;/tt&gt; method just like &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  @Override
  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; hashCode() {
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; getConnectionHashCode();
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Any concerns?&lt;/p&gt;</comment>
                            <comment id="14746000" author="asamir" created="Tue, 15 Sep 2015 19:35:26 +0000"  >&lt;p&gt;Looks like good idea &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=chenheng&quot; class=&quot;user-hover&quot; rel=&quot;chenheng&quot;&gt;Heng Chen&lt;/a&gt;. Thanks for review. I will include it in patch after some more testing.&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=stack&quot; class=&quot;user-hover&quot; rel=&quot;stack&quot;&gt;stack&lt;/a&gt; thanks for pushing   &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13337&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;HBASE-13337&lt;/a&gt; on master branch&lt;/p&gt;</comment>
                            <comment id="14780868" author="asamir" created="Wed, 16 Sep 2015 14:58:49 +0000"  >&lt;p&gt;Here is patch fixing this issue. I have notice that we have some 50s pause in client between detecting that session has been reset (killing rs) and removing connection to this server from connections pool. I will probably open new ticket  addressing this issue when i dig more info why this pause is so long  &lt;/p&gt;</comment>
                            <comment id="14790514" author="yuzhihong@gmail.com" created="Wed, 16 Sep 2015 15:04:34 +0000"  >&lt;p&gt;lgtm&lt;/p&gt;

&lt;p&gt;nit: connection.hashCode() is computed twice. You can save the return value in a local variable.&lt;/p&gt;</comment>
                            <comment id="14790813" author="hadoopqa" created="Wed, 16 Sep 2015 18:00:09 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12756275/HBASE-14431.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12756275/HBASE-14431.patch&lt;/a&gt;&lt;br/&gt;
  against master branch at commit d2e338181800ae3cef55ddca491901b65259dc7f.&lt;br/&gt;
  ATTACHMENT ID: 12756275&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 tests included&lt;/font&gt;.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop versions&lt;/font&gt;. The patch compiles with all supported hadoop versions (2.4.0 2.4.1 2.5.0 2.5.1 2.5.2 2.6.0 2.7.0 2.7.1)&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 protoc&lt;/font&gt;.  The applied patch does not increase the total number of protoc compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 checkstyle&lt;/font&gt;.  The applied patch does not increase the total number of checkstyle errors&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any  new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn post-site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core tests&lt;/font&gt;.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.client.TestFastFail&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/15624//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/15624//testReport/&lt;/a&gt;&lt;br/&gt;
Release Findbugs (version 2.0.3) 	warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/15624//artifact/patchprocess/newFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/15624//artifact/patchprocess/newFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Checkstyle Errors: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/15624//artifact/patchprocess/checkstyle-aggregate.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/15624//artifact/patchprocess/checkstyle-aggregate.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;  Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/15624//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/15624//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14791053" author="asamir" created="Wed, 16 Sep 2015 20:10:11 +0000"  >&lt;p&gt;This is interesting. I have run TestFastFail several times on two different machines and test never fails. I was using java 1.7.0_80 and 1.7.0_71&lt;/p&gt;




&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14877039" author="asamir" created="Sat, 19 Sep 2015 11:09:31 +0000"  >&lt;p&gt;Thanks for review &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tedyu&quot; class=&quot;user-hover&quot; rel=&quot;tedyu&quot;&gt;Ted Yu&lt;/a&gt;. Here is a new patch using local variable. &lt;/p&gt;</comment>
                            <comment id="14877053" author="yuzhihong@gmail.com" created="Sat, 19 Sep 2015 11:23:27 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="14877141" author="hadoopqa" created="Sat, 19 Sep 2015 14:19:14 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12761281/HBASE-14431-v2.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12761281/HBASE-14431-v2.patch&lt;/a&gt;&lt;br/&gt;
  against master branch at commit b0f52332651ecbb8af11557df5af3189c7283212.&lt;br/&gt;
  ATTACHMENT ID: 12761281&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 tests included&lt;/font&gt;.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop versions&lt;/font&gt;. The patch compiles with all supported hadoop versions (2.4.0 2.4.1 2.5.0 2.5.1 2.5.2 2.6.0 2.7.0 2.7.1)&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 protoc&lt;/font&gt;.  The applied patch does not increase the total number of protoc compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 checkstyle&lt;/font&gt;.  The applied patch does not increase the total number of checkstyle errors&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any  new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn post-site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core tests&lt;/font&gt;.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.client.TestSnapshotCloneIndependence&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/15641//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/15641//testReport/&lt;/a&gt;&lt;br/&gt;
Release Findbugs (version 2.0.3) 	warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/15641//artifact/patchprocess/newFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/15641//artifact/patchprocess/newFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Checkstyle Errors: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/15641//artifact/patchprocess/checkstyle-aggregate.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/15641//artifact/patchprocess/checkstyle-aggregate.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;  Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/15641//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/15641//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14877148" author="yuzhihong@gmail.com" created="Sat, 19 Sep 2015 14:36:28 +0000"  >&lt;p&gt;Thanks for the patch, Samir&lt;/p&gt;</comment>
                            <comment id="14877204" author="hudson" created="Sat, 19 Sep 2015 16:51:28 +0000"  >&lt;p&gt;SUCCESS: Integrated in HBase-1.3-IT #167 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-1.3-IT/167/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-1.3-IT/167/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-14431&quot; title=&quot;AsyncRpcClient#removeConnection() never removes connection from connections pool if server fails&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-14431&quot;&gt;&lt;del&gt;HBASE-14431&lt;/del&gt;&lt;/a&gt; AsyncRpcClient#removeConnection() never removes connection from connections pool if server fails (Samir Ahmic) (tedyu: rev 88adccd553e4f70a0e5362d5ab5158f45d57d201)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-client/src/main/java/org/apache/hadoop/hbase/ipc/AsyncRpcClient.java&lt;/li&gt;
	&lt;li&gt;hbase-client/src/main/java/org/apache/hadoop/hbase/ipc/AsyncRpcChannel.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14877206" author="hudson" created="Sat, 19 Sep 2015 16:51:44 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-1.2-IT #156 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-1.2-IT/156/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-1.2-IT/156/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-14431&quot; title=&quot;AsyncRpcClient#removeConnection() never removes connection from connections pool if server fails&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-14431&quot;&gt;&lt;del&gt;HBASE-14431&lt;/del&gt;&lt;/a&gt; AsyncRpcClient#removeConnection() never removes connection from connections pool if server fails (Samir Ahmic) (tedyu: rev 388e948dfedab59cfe8fe8cf42001fec0eb32cd3)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-client/src/main/java/org/apache/hadoop/hbase/ipc/AsyncRpcClient.java&lt;/li&gt;
	&lt;li&gt;hbase-client/src/main/java/org/apache/hadoop/hbase/ipc/AsyncRpcChannel.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14877211" author="hudson" created="Sat, 19 Sep 2015 17:00:39 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-TRUNK #6821 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/6821/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/6821/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-14431&quot; title=&quot;AsyncRpcClient#removeConnection() never removes connection from connections pool if server fails&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-14431&quot;&gt;&lt;del&gt;HBASE-14431&lt;/del&gt;&lt;/a&gt; AsyncRpcClient#removeConnection() never removes connection from connections pool if server fails (Samir Ahmic) (tedyu: rev 1545e1ed8d68b780dca49084cf5d8173481f72c0)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-client/src/main/java/org/apache/hadoop/hbase/ipc/AsyncRpcClient.java&lt;/li&gt;
	&lt;li&gt;hbase-client/src/main/java/org/apache/hadoop/hbase/ipc/AsyncRpcChannel.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14877214" author="hudson" created="Sat, 19 Sep 2015 17:09:29 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-1.2 #185 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-1.2/185/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-1.2/185/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-14431&quot; title=&quot;AsyncRpcClient#removeConnection() never removes connection from connections pool if server fails&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-14431&quot;&gt;&lt;del&gt;HBASE-14431&lt;/del&gt;&lt;/a&gt; AsyncRpcClient#removeConnection() never removes connection from connections pool if server fails (Samir Ahmic) (tedyu: rev 388e948dfedab59cfe8fe8cf42001fec0eb32cd3)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-client/src/main/java/org/apache/hadoop/hbase/ipc/AsyncRpcClient.java&lt;/li&gt;
	&lt;li&gt;hbase-client/src/main/java/org/apache/hadoop/hbase/ipc/AsyncRpcChannel.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14877218" author="hudson" created="Sat, 19 Sep 2015 17:21:33 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-1.1 #667 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-1.1/667/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-1.1/667/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-14431&quot; title=&quot;AsyncRpcClient#removeConnection() never removes connection from connections pool if server fails&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-14431&quot;&gt;&lt;del&gt;HBASE-14431&lt;/del&gt;&lt;/a&gt; AsyncRpcClient#removeConnection() never removes connection from connections pool if server fails (Samir Ahmic) (tedyu: rev 911c4342ae66447d51ec05e25eeb3b6c4d348a22)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-client/src/main/java/org/apache/hadoop/hbase/ipc/AsyncRpcClient.java&lt;/li&gt;
	&lt;li&gt;hbase-client/src/main/java/org/apache/hadoop/hbase/ipc/AsyncRpcChannel.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14877222" author="hudson" created="Sat, 19 Sep 2015 17:37:01 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-1.3 #185 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-1.3/185/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-1.3/185/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-14431&quot; title=&quot;AsyncRpcClient#removeConnection() never removes connection from connections pool if server fails&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-14431&quot;&gt;&lt;del&gt;HBASE-14431&lt;/del&gt;&lt;/a&gt; AsyncRpcClient#removeConnection() never removes connection from connections pool if server fails (Samir Ahmic) (tedyu: rev 88adccd553e4f70a0e5362d5ab5158f45d57d201)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-client/src/main/java/org/apache/hadoop/hbase/ipc/AsyncRpcChannel.java&lt;/li&gt;
	&lt;li&gt;hbase-client/src/main/java/org/apache/hadoop/hbase/ipc/AsyncRpcClient.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14900725" author="carp84" created="Mon, 21 Sep 2015 13:59:46 +0000"  >&lt;p&gt;From the HadoopQA report of &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-14448&quot; title=&quot;Refine RegionGroupingProvider Phase-2: remove provider nesting and formalize wal group name&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-14448&quot;&gt;&lt;del&gt;HBASE-14448&lt;/del&gt;&lt;/a&gt;, I found TestFastFail failed with below log:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;2015-09-21 11:42:58,768 WARN  [AsyncRpcChannel-pool2-t17] logging.Slf4JLogger(151): An exception was thrown by org.apache.hadoop.hbase.ipc.AsyncRpcChannel$2.operationComplete()
java.lang.NullPointerException
	at org.apache.hadoop.hbase.ipc.AsyncRpcClient.removeConnection(AsyncRpcClient.java:406)
	at org.apache.hadoop.hbase.ipc.AsyncRpcChannel.close(AsyncRpcChannel.java:537)
	at org.apache.hadoop.hbase.ipc.AsyncRpcChannel.retryOrClose(AsyncRpcChannel.java:300)
	at org.apache.hadoop.hbase.ipc.AsyncRpcChannel.access$200(AsyncRpcChannel.java:82)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Checking line 406 of AsyncRpcClient.java, we could find below changes in this JIRA:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;-    int connectionHashCode = connection.getConnectionHashCode();
+    int connectionHashCode = connection.hashCode();
     synchronized (connections) {
       // we use address as cache key, so we should check here to prevent removing the
       // wrong connection
       AsyncRpcChannel connectionInPool = this.connections.get(connectionHashCode);
-      if (connectionInPool == connection) {
+     if (connectionInPool.equals(connection)) {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;And line 406 is&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (connectionInPool.equals(connection)) {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I think we lack a null pointer check here, and attached is a straight addendum.&lt;/p&gt;</comment>
                            <comment id="14900742" author="yuzhihong@gmail.com" created="Mon, 21 Sep 2015 14:25:07 +0000"  >&lt;p&gt;Integrated addendum to related branches.&lt;/p&gt;

&lt;p&gt;Thanks, Yu.&lt;/p&gt;</comment>
                            <comment id="14900932" author="hudson" created="Mon, 21 Sep 2015 16:28:10 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-1.1 #669 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-1.1/669/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-1.1/669/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-14431&quot; title=&quot;AsyncRpcClient#removeConnection() never removes connection from connections pool if server fails&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-14431&quot;&gt;&lt;del&gt;HBASE-14431&lt;/del&gt;&lt;/a&gt; Addendum checks for null connectionInPool (Yu Li) (tedyu: rev 9ae6cead335c5afc298bd192820ecb7af928ab2c)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-client/src/main/java/org/apache/hadoop/hbase/ipc/AsyncRpcClient.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14900972" author="hudson" created="Mon, 21 Sep 2015 16:51:09 +0000"  >&lt;p&gt;SUCCESS: Integrated in HBase-1.2-IT #158 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-1.2-IT/158/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-1.2-IT/158/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-14431&quot; title=&quot;AsyncRpcClient#removeConnection() never removes connection from connections pool if server fails&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-14431&quot;&gt;&lt;del&gt;HBASE-14431&lt;/del&gt;&lt;/a&gt; Addendum checks for null connectionInPool (Yu Li) (tedyu: rev 78c8c772db84d88dcecaafd6ba9c7f7e611cc091)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-client/src/main/java/org/apache/hadoop/hbase/ipc/AsyncRpcClient.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14900977" author="hudson" created="Mon, 21 Sep 2015 16:56:06 +0000"  >&lt;p&gt;SUCCESS: Integrated in HBase-1.3-IT #169 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-1.3-IT/169/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-1.3-IT/169/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-14431&quot; title=&quot;AsyncRpcClient#removeConnection() never removes connection from connections pool if server fails&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-14431&quot;&gt;&lt;del&gt;HBASE-14431&lt;/del&gt;&lt;/a&gt; Addendum checks for null connectionInPool (Yu Li) (tedyu: rev ca6c7f0a6857a5ac16be6a13c461e2aae0b51821)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-client/src/main/java/org/apache/hadoop/hbase/ipc/AsyncRpcClient.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14900995" author="hudson" created="Mon, 21 Sep 2015 17:07:05 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-1.2 #187 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-1.2/187/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-1.2/187/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-14431&quot; title=&quot;AsyncRpcClient#removeConnection() never removes connection from connections pool if server fails&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-14431&quot;&gt;&lt;del&gt;HBASE-14431&lt;/del&gt;&lt;/a&gt; Addendum checks for null connectionInPool (Yu Li) (tedyu: rev 78c8c772db84d88dcecaafd6ba9c7f7e611cc091)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-client/src/main/java/org/apache/hadoop/hbase/ipc/AsyncRpcClient.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14901221" author="hudson" created="Mon, 21 Sep 2015 19:16:21 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-1.3 #188 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-1.3/188/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-1.3/188/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-14431&quot; title=&quot;AsyncRpcClient#removeConnection() never removes connection from connections pool if server fails&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-14431&quot;&gt;&lt;del&gt;HBASE-14431&lt;/del&gt;&lt;/a&gt; Addendum checks for null connectionInPool (Yu Li) (tedyu: rev ca6c7f0a6857a5ac16be6a13c461e2aae0b51821)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-client/src/main/java/org/apache/hadoop/hbase/ipc/AsyncRpcClient.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14901342" author="hudson" created="Mon, 21 Sep 2015 20:33:00 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-TRUNK #6824 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/6824/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/6824/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-14431&quot; title=&quot;AsyncRpcClient#removeConnection() never removes connection from connections pool if server fails&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-14431&quot;&gt;&lt;del&gt;HBASE-14431&lt;/del&gt;&lt;/a&gt; Addendum checks for null connectionInPool (Yu Li) (tedyu: rev 86cf14889462b6947f921c41401a8f925fe2b3b6)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-client/src/main/java/org/apache/hadoop/hbase/ipc/AsyncRpcClient.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15119507" author="ndimiduk" created="Wed, 27 Jan 2016 15:28:38 +0000"  >&lt;p&gt;Bulk closing 1.1.3 issues.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12761434" name="HBASE-14431-addendum.patch" size="947" author="carp84" created="Mon, 21 Sep 2015 14:00:23 +0000"/>
                            <attachment id="12761281" name="HBASE-14431-v2.patch" size="2549" author="asamir" created="Sat, 19 Sep 2015 11:09:31 +0000"/>
                            <attachment id="12756275" name="HBASE-14431.patch" size="2726" author="asamir" created="Wed, 16 Sep 2015 14:58:49 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 14 Sep 2015 18:21:47 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            44 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2k5ef:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>