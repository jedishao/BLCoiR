<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 02 20:18:11 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-1087/HBASE-1087.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-1087] DFS failures did not shutdown regionserver</title>
                <link>https://issues.apache.org/jira/browse/HBASE-1087</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;I lost three Datanodes, reasons of which are still being investigated, but it has left a number of regions unable to be written to.&lt;/p&gt;

&lt;p&gt;Relevant logs:&lt;/p&gt;

&lt;p&gt;2008-12-23 02:35:59,591 WARN org.apache.hadoop.hdfs.DFSClient: DataStreamer Exception: java.io.IOException: Connection reset by peer&lt;br/&gt;
        at sun.nio.ch.FileDispatcher.write0(Native Method)&lt;br/&gt;
        at sun.nio.ch.SocketDispatcher.write(SocketDispatcher.java:47)&lt;br/&gt;
        at sun.nio.ch.IOUtil.writeFromNativeBuffer(IOUtil.java:122)&lt;br/&gt;
        at sun.nio.ch.IOUtil.write(IOUtil.java:93)&lt;br/&gt;
        at sun.nio.ch.SocketChannelImpl.write(SocketChannelImpl.java:352)&lt;br/&gt;
        at org.apache.hadoop.net.SocketOutputStream$Writer.performIO(SocketOutputStream.java:55)&lt;br/&gt;
        at org.apache.hadoop.net.SocketIOWithTimeout.doIO(SocketIOWithTimeout.java:140)&lt;br/&gt;
        at org.apache.hadoop.net.SocketOutputStream.write(SocketOutputStream.java:146)&lt;br/&gt;
        at org.apache.hadoop.net.SocketOutputStream.write(SocketOutputStream.java:107)&lt;br/&gt;
        at java.io.BufferedOutputStream.write(BufferedOutputStream.java:122)&lt;br/&gt;
        at java.io.DataOutputStream.write(DataOutputStream.java:107)&lt;br/&gt;
        at org.apache.hadoop.hdfs.DFSClient$DFSOutputStream$DataStreamer.run(DFSClient.java:2209)&lt;/p&gt;

&lt;p&gt;2008-12-23 02:35:59,591 WARN org.apache.hadoop.hdfs.DFSClient: DFSOutputStream ResponseProcessor exception  for block blk_3615512604618056881_86411java.io.EOFException&lt;br/&gt;
        at java.io.DataInputStream.readFully(DataInputStream.java:197)&lt;br/&gt;
        at java.io.DataInputStream.readLong(DataInputStream.java:416)&lt;br/&gt;
        at org.apache.hadoop.hdfs.DFSClient$DFSOutputStream$ResponseProcessor.run(DFSClient.java:2318)&lt;/p&gt;

&lt;p&gt;2008-12-23 02:35:59,591 WARN org.apache.hadoop.hdfs.DFSClient: Error Recovery for block blk_3615512604618056881_86411 bad datanode&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt; 72.34.249.214:50010&lt;br/&gt;
2008-12-23 02:35:59,595 WARN org.apache.hadoop.hdfs.DFSClient: Error Recovery for block blk_3615512604618056881_86411 in pipeline 72.34.249.214:50010, 72.34.249.213:50010, 72.34.249.219:50010: bad datanode 72.34.249.214:50010&lt;/p&gt;

&lt;p&gt;2008-12-23 02:38:27,698 INFO org.apache.hadoop.hdfs.DFSClient: Exception in createBlockOutputStream java.net.ConnectException: Connection refused&lt;br/&gt;
2008-12-23 02:38:27,698 INFO org.apache.hadoop.hdfs.DFSClient: Abandoning block blk_-3678518999439029831_86910&lt;br/&gt;
2008-12-23 02:38:27,711 DEBUG org.apache.hadoop.hbase.regionserver.HRegionServer: Row lock 5392007859847346106 has been explicitly released by client&lt;br/&gt;
2008-12-23 02:38:30,048 DEBUG org.apache.hadoop.hbase.regionserver.HRegionServer: Row lock -5905479324505886709 explicitly acquired by client&lt;br/&gt;
2008-12-23 02:38:33,700 INFO org.apache.hadoop.hdfs.DFSClient: Exception in createBlockOutputStream java.net.ConnectException: Connection refused&lt;br/&gt;
2008-12-23 02:38:33,700 INFO org.apache.hadoop.hdfs.DFSClient: Abandoning block blk_-226119866881174578_86911&lt;br/&gt;
2008-12-23 02:38:34,908 DEBUG org.apache.hadoop.hbase.regionserver.HRegionServer: Row lock 346704317670569896 explicitly acquired by client&lt;br/&gt;
2008-12-23 02:38:39,702 INFO org.apache.hadoop.hdfs.DFSClient: Exception in createBlockOutputStream java.net.ConnectException: Connection refused&lt;br/&gt;
2008-12-23 02:38:39,702 INFO org.apache.hadoop.hdfs.DFSClient: Abandoning block blk_1719395740576248920_86913&lt;br/&gt;
2008-12-23 02:38:40,945 DEBUG org.apache.hadoop.hbase.regionserver.HRegionServer: Row lock 3819942931078736534 explicitly acquired by client&lt;br/&gt;
2008-12-23 02:38:45,572 DEBUG org.apache.hadoop.hbase.regionserver.HRegionServer: Row lock 254119037927296402 explicitly acquired by client&lt;br/&gt;
2008-12-23 02:38:45,703 INFO org.apache.hadoop.hdfs.DFSClient: Exception in createBlockOutputStream java.net.ConnectException: Connection refused&lt;br/&gt;
2008-12-23 02:38:45,703 INFO org.apache.hadoop.hdfs.DFSClient: Abandoning block blk_2443399503093377808_86915&lt;br/&gt;
2008-12-23 02:38:49,092 DEBUG org.apache.hadoop.hbase.regionserver.HRegionServer: Row lock 8573046623144113301 explicitly acquired by client&lt;br/&gt;
2008-12-23 02:38:49,385 DEBUG org.apache.hadoop.hbase.regionserver.HRegionServer: Row lock 7686739650257547105 explicitly acquired by client&lt;br/&gt;
2008-12-23 02:38:49,512 DEBUG org.apache.hadoop.hbase.regionserver.HRegionServer: Row lock 5582966798894532276 explicitly acquired by client&lt;br/&gt;
2008-12-23 02:38:51,704 WARN org.apache.hadoop.hdfs.DFSClient: DataStreamer Exception: java.io.IOException: Unable to create new block.&lt;br/&gt;
        at org.apache.hadoop.hdfs.DFSClient$DFSOutputStream.nextBlockOutputStream(DFSClient.java:2723)&lt;br/&gt;
        at org.apache.hadoop.hdfs.DFSClient$DFSOutputStream.access$2000(DFSClient.java:1997)&lt;br/&gt;
        at org.apache.hadoop.hdfs.DFSClient$DFSOutputStream$DataStreamer.run(DFSClient.java:2183)&lt;/p&gt;

&lt;p&gt;2008-12-23 02:38:51,704 WARN org.apache.hadoop.hdfs.DFSClient: Error Recovery for block blk_2443399503093377808_86915 bad datanode&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt; nodes == null&lt;br/&gt;
2008-12-23 02:38:51,704 WARN org.apache.hadoop.hdfs.DFSClient: Could not get block locations. Aborting...&lt;br/&gt;
2008-12-23 02:38:51,704 FATAL org.apache.hadoop.hbase.regionserver.HLog: Could not append. Requesting close of log&lt;br/&gt;
java.net.ConnectException: Connection refused&lt;br/&gt;
        at sun.nio.ch.SocketChannelImpl.checkConnect(Native Method)&lt;br/&gt;
        at sun.nio.ch.SocketChannelImpl.finishConnect(SocketChannelImpl.java:592)&lt;br/&gt;
        at sun.nio.ch.SocketAdaptor.connect(SocketAdaptor.java:118)&lt;br/&gt;
        at org.apache.hadoop.hdfs.DFSClient$DFSOutputStream.createBlockOutputStream(DFSClient.java:2748)&lt;br/&gt;
        at org.apache.hadoop.hdfs.DFSClient$DFSOutputStream.nextBlockOutputStream(DFSClient.java:2704)&lt;br/&gt;
        at org.apache.hadoop.hdfs.DFSClient$DFSOutputStream.access$2000(DFSClient.java:1997)&lt;br/&gt;
        at org.apache.hadoop.hdfs.DFSClient$DFSOutputStream$DataStreamer.run(DFSClient.java:2183)&lt;br/&gt;
2008-12-23 02:38:51,706 ERROR org.apache.hadoop.hbase.regionserver.LogRoller: Log rolling failed with ioe:&lt;br/&gt;
java.net.ConnectException: Connection refused&lt;br/&gt;
        at sun.nio.ch.SocketChannelImpl.checkConnect(Native Method)&lt;br/&gt;
        at sun.nio.ch.SocketChannelImpl.finishConnect(SocketChannelImpl.java:592)&lt;br/&gt;
        at sun.nio.ch.SocketAdaptor.connect(SocketAdaptor.java:118)&lt;br/&gt;
        at org.apache.hadoop.hdfs.DFSClient$DFSOutputStream.createBlockOutputStream(DFSClient.java:2748)&lt;br/&gt;
        at org.apache.hadoop.hdfs.DFSClient$DFSOutputStream.nextBlockOutputStream(DFSClient.java:2704)&lt;br/&gt;
        at org.apache.hadoop.hdfs.DFSClient$DFSOutputStream.access$2000(DFSClient.java:1997)&lt;br/&gt;
        at org.apache.hadoop.hdfs.DFSClient$DFSOutputStream$DataStreamer.run(DFSClient.java:2183)&lt;br/&gt;
2008-12-23 02:38:51,706 ERROR org.apache.hadoop.hbase.regionserver.HRegionServer: java.net.ConnectException: Connection refused&lt;/p&gt;</description>
                <environment></environment>
        <key id="12411261">HBASE-1087</key>
            <summary>DFS failures did not shutdown regionserver</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.png">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="stack">stack</assignee>
                                    <reporter username="streamy">Jonathan Gray</reporter>
                        <labels>
                    </labels>
                <created>Tue, 23 Dec 2008 18:36:46 +0000</created>
                <updated>Sun, 13 Sep 2009 22:26:36 +0000</updated>
                            <resolved>Fri, 26 Dec 2008 20:21:58 +0000</resolved>
                                    <version>0.19.0</version>
                                    <fixVersion>0.19.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12659004" author="stack" created="Wed, 24 Dec 2008 00:05:24 +0000"  >&lt;p&gt;I would have thought that &apos;2008-12-23 02:38:51,704 FATAL org.apache.hadoop.hbase.regionserver.HLog: Could not append. Requesting close of log&apos; should have triggered a hrs shutdown.&lt;/p&gt;</comment>
                            <comment id="12659129" author="streamy" created="Wed, 24 Dec 2008 18:02:52 +0000"  >&lt;p&gt;Same thing happened again.  Managed to get a thread dump this time, though nothing jumped out at me in it.&lt;/p&gt;</comment>
                            <comment id="12659134" author="stack" created="Wed, 24 Dec 2008 18:17:42 +0000"  >&lt;p&gt;Looking at Jon&apos;s thread dump, its a happy HRS all waiting and runnable.  The continual exceptions trying to append and roll log are not manifest here.&lt;/p&gt;

&lt;p&gt;I&apos;m committing below:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Index: src/java/org/apache/hadoop/hbase/regionserver/LogRoller.java
===================================================================
--- src/java/org/apache/hadoop/hbase/regionserver/LogRoller.java        (revision 729178)
+++ src/java/org/apache/hadoop/hbase/regionserver/LogRoller.java        (working copy)
@@ -69,6 +69,9 @@
       } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (FailedLogCloseException e) {
         LOG.fatal(&lt;span class=&quot;code-quote&quot;&gt;&quot;Forcing server shutdown&quot;&lt;/span&gt;, e);
         server.abort();
+      } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (java.net.ConnectException e) {
+        LOG.fatal(&lt;span class=&quot;code-quote&quot;&gt;&quot;Forcing server shutdown&quot;&lt;/span&gt;, e);
+        server.abort();
       } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (IOException ex) {
         LOG.error(&lt;span class=&quot;code-quote&quot;&gt;&quot;Log rolling failed with ioe: &quot;&lt;/span&gt;,
             RemoteExceptionHandler.checkIOException(ex));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;... as a reason to restart.  We fail to append and schedule a log roll as a desperate attempt at getting up a new context.  The ConnectException you&apos;d think would resolve itself but if its come up out of DFSClient, then it looks permanent.&lt;/p&gt;</comment>
                            <comment id="12659135" author="stack" created="Wed, 24 Dec 2008 18:30:20 +0000"  >&lt;p&gt;Datanode did this and then shut itself down nicely:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2008-12-23 02:35:49,487 ERROR org.apache.hadoop.hdfs.server.datanode.DataNode: DatanodeRegistration(72.34.249.214:50010, storageID=DS-1476108653-72.34.249.214-50010-1229363688235, infoPort=50075, ipcPort=50020):DataXceiveServer: Exiting due to:java.lang.OutOfMemoryError: unable to create &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;native&lt;/span&gt; thread
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.start0(Native Method)
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.start(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:614)
        at org.apache.hadoop.hdfs.server.datanode.DataXceiverServer.run(DataXceiverServer.java:131)
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:636)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12659265" author="stack" created="Fri, 26 Dec 2008 20:21:58 +0000"  >&lt;p&gt;Resolving this issue.  Lets reopen or open another if we seen another hang like this (or add it under hbase-1084 umbrella).&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12396745" name="regionserver.threaddump.log" size="19179" author="streamy" created="Wed, 24 Dec 2008 18:02:52 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 24 Dec 2008 00:05:24 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>25565</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 49 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0hb8v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>99084</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>