<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 02 18:40:37 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-259/HBASE-259.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-259] Hung region servers waiting on write locks</title>
                <link>https://issues.apache.org/jira/browse/HBASE-259</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;A couple of times this afternoon I&quot;ve been able to manufacture a hung region server variously stuck trying to obtain write locks either on memcache or a row lock on HRegion.  The lease expiration must not be working properly (shutting down all open scanners).  Maybe locks should be expiring.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-quote&quot;&gt;&quot;IPC Server handler 2 on 60010&quot;&lt;/span&gt; daemon prio=5 tid=0x005167f0 nid=0x189d000 in &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;.wait() [0xb1397000..0xb1397d10]
    at java.lang.&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;.wait(Native Method)
    - waiting on &amp;lt;0x0b316ba8&amp;gt; (a java.util.HashMap)
    at java.lang.&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;.wait(&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;.java:474)
    at org.apache.hadoop.hbase.HRegion.obtainRowLock(HRegion.java:1211)
    - locked &amp;lt;0x0b316ba8&amp;gt; (a java.util.HashMap)
    at org.apache.hadoop.hbase.HRegion.startUpdate(HRegion.java:1020)
    at org.apache.hadoop.hbase.HRegionServer.startUpdate(HRegionServer.java:1007)
    at sun.reflect.GeneratedMethodAccessor12.invoke(Unknown Source)
    at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
    at java.lang.reflect.Method.invoke(Method.java:585)
    at org.apache.hadoop.ipc.RPC$Server.call(RPC.java:340)
    at org.apache.hadoop.ipc.Server$Handler.run(Server.java:566)

&lt;span class=&quot;code-quote&quot;&gt;&quot;IPC Server handler 1 on 60010&quot;&lt;/span&gt; daemon prio=5 tid=0x005163f0 nid=0x189cc00 in &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;.wait() [0xb1316000..0xb1316d10]
    at java.lang.&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;.wait(Native Method)
    - waiting on &amp;lt;0x0b317148&amp;gt; (a java.lang.&lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;)
    at java.lang.&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;.wait(&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;.java:474)
    at org.apache.hadoop.hbase.HLocking.obtainWriteLock(HLocking.java:82)
    - locked &amp;lt;0x0b317148&amp;gt; (a java.lang.&lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;) 
    at org.apache.hadoop.hbase.HMemcache.add(HMemcache.java:153)
    at org.apache.hadoop.hbase.HRegion.commit(HRegion.java:1144)
    - locked &amp;lt;0x0b398080&amp;gt; (a org.apache.hadoop.io.Text)
    at org.apache.hadoop.hbase.HRegionServer.commit(HRegionServer.java:1071)
    at sun.reflect.GeneratedMethodAccessor13.invoke(Unknown Source)
    at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
    at java.lang.reflect.Method.invoke(Method.java:585)
    at org.apache.hadoop.ipc.RPC$Server.call(RPC.java:340)
    at org.apache.hadoop.ipc.Server$Handler.run(Server.java:566)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12372258">HBASE-259</key>
            <summary>Hung region servers waiting on write locks</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="stack">stack</reporter>
                        <labels>
                    </labels>
                <created>Sat, 23 Jun 2007 01:03:56 +0000</created>
                <updated>Mon, 4 Feb 2008 18:41:22 +0000</updated>
                            <resolved>Mon, 2 Jul 2007 00:47:54 +0000</resolved>
                                                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12509321" author="stack" created="Sat, 30 Jun 2007 18:52:40 +0000"  >&lt;p&gt;Here is commit message to along with this patch:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-259&quot; title=&quot;Hung region servers waiting on write locks&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-259&quot;&gt;&lt;del&gt;HADOOP-1523&lt;/del&gt;&lt;/a&gt; &apos;Hung region servers waiting on write locks&apos;&lt;br/&gt;
On shutdown, region servers and masters were just cancelling leases&lt;br/&gt;
without letting &apos;lease expired&apos; code run &amp;#8211; code to clean up&lt;br/&gt;
outstanding locks in region server.  Outstanding read locks were&lt;br/&gt;
getting in the way of region server getting necessary write locks&lt;br/&gt;
needed for the shutdown process.  Also, cleaned up messaging around&lt;br/&gt;
shutdown so its clean &amp;#8211; no timeout messages as region servers try&lt;br/&gt;
to talk to a master that has already shutdown &amp;#8211; even when region&lt;br/&gt;
servers take their time going down.&lt;br/&gt;
M src/contrib/hbase/conf/hbase-default.xml&lt;br/&gt;
    Make region server timeout 30 seconds instead of 3 minutes.&lt;br/&gt;
    Clients retry anyways. Make so its likely region servers report&lt;br/&gt;
    in their shutdown message before their lease expires on master.&lt;br/&gt;
M src/contrib/hbase/src/java/org/apache/hadoop/hbase/Leases.java&lt;br/&gt;
    (closeAfterLeasesExpire): Added.&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;src/contrib/hbase/src/java/org/apache/hadoop/hbase/HRegionServer.java&lt;br/&gt;
    Added comments.&lt;br/&gt;
    (stop): Converted from public to default access (master shuts&lt;br/&gt;
    down regionservers).&lt;br/&gt;
    (run): Use leases.closeAfterLeasesExpire instead of leases.close.&lt;br/&gt;
    Changed log of main thread exit from DEBUG to INFO.&lt;/li&gt;
	&lt;li&gt;src/contrib/hbase/src/java/org/apache/hadoop/hbase/HMaster.java&lt;br/&gt;
    (letRegionsServersShutdown): Add better explaination of shutdown&lt;br/&gt;
    process to method doc.  Changed timeout waits from&lt;br/&gt;
    hbase.regionserver.msginterval to threadWakeFrequency.&lt;br/&gt;
    (regionServerReport): If closing, we used to immediately respond&lt;br/&gt;
    to region server with a MSG_REGIONSERVER_STOP.  This meant that&lt;br/&gt;
    we avoided handling of the region servers MSG_REPORT_EXITING sent&lt;br/&gt;
    on shutdown so region servers had no chance to cancel their lease&lt;br/&gt;
    in the master.  Reordered.  Moved sending of MSG_REGIONSERVER_STOP&lt;br/&gt;
    to after handling of MSG_REPORT_EXITING.  Also, in handling of&lt;br/&gt;
    MSG_REGIONSERER_STOP removed cancelling of leases.  Let leases&lt;br/&gt;
    expire normally (or get cancelled when the region server comes in&lt;br/&gt;
    with MSG_RPORT_EXITING).&lt;/li&gt;
	&lt;li&gt;src/contrib/hbase/src/java/org/apache/hadoop/hbase/HMsg.java&lt;br/&gt;
    (MSG_REGIONSERVER_STOP_IN_ARRAY): Added.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="12509323" author="stack" created="Sat, 30 Jun 2007 18:53:27 +0000"  >&lt;p&gt;Built locally.  Try against Hudson.&lt;/p&gt;</comment>
                            <comment id="12509324" author="hadoopqa" created="Sat, 30 Jun 2007 19:50:03 +0000"  >&lt;p&gt;+1&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12360871/locks-v2.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12360871/locks-v2.patch&lt;/a&gt; applied and successfully tested against trunk revision r552127.&lt;/p&gt;

&lt;p&gt;Test results:   &lt;a href=&quot;http://lucene.zones.apache.org:8080/hudson/job/Hadoop-Patch/352/testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://lucene.zones.apache.org:8080/hudson/job/Hadoop-Patch/352/testReport/&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://lucene.zones.apache.org:8080/hudson/job/Hadoop-Patch/352/console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://lucene.zones.apache.org:8080/hudson/job/Hadoop-Patch/352/console&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12509546" author="hudson" created="Mon, 2 Jul 2007 11:40:14 +0000"  >&lt;p&gt;Integrated in Hadoop-Nightly #142 (See &lt;a href=&quot;http://lucene.zones.apache.org:8080/hudson/job/Hadoop-Nightly/142/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://lucene.zones.apache.org:8080/hudson/job/Hadoop-Nightly/142/&lt;/a&gt;)&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12360871" name="locks-v2.patch" size="13649" author="stack" created="Sat, 30 Jun 2007 18:52:40 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sat, 30 Jun 2007 19:50:03 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>25043</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 23 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0h5zb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>98231</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>