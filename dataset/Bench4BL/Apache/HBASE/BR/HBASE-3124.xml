<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sat Dec 03 16:50:50 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-3124/HBASE-3124.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-3124] TestHLogSplit#testSplitWillNotTouchLogsIfNewHLogGets occsionally fails with NPE</title>
                <link>https://issues.apache.org/jira/browse/HBASE-3124</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;I am working on an HDFS side patch to reduce the cost of file recovery in HLog#splitLog. when I run HBase unit test, I sometimes see TestHLogSplit#testSplitWillNotTouchLogsIfNewHLogGets fail with the following error.&lt;br/&gt;
java.lang.NullPointerException&lt;br/&gt;
	at org.apache.hadoop.hbase.regionserver.wal.TestHLogSplit.testSplitWillNotTouchLogsIfNewHLogGetsCreatedAfterSplitStarted(TestHLogSplit.java:462)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)&lt;br/&gt;
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
	at java.lang.reflect.Method.invoke(Method.java:597)&lt;br/&gt;
	at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:44)&lt;br/&gt;
	at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:15)&lt;br/&gt;
	at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:41)&lt;br/&gt;
	at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:20)&lt;br/&gt;
	at org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:28)&lt;br/&gt;
	at org.junit.internal.runners.statements.RunAfters.evaluate(RunAfters.java:31)&lt;br/&gt;
	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:76)&lt;br/&gt;
	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:50)&lt;br/&gt;
	at org.junit.runners.ParentRunner$3.run(ParentRunner.java:193)&lt;br/&gt;
	at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:52)&lt;br/&gt;
	at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:191)&lt;br/&gt;
	at org.junit.runners.ParentRunner.access$000(ParentRunner.java:42)&lt;br/&gt;
	at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:184)&lt;br/&gt;
	at org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:28)&lt;br/&gt;
	at org.junit.internal.runners.statements.RunAfters.evaluate(RunAfters.java:31)&lt;br/&gt;
	at org.junit.runners.ParentRunner.run(ParentRunner.java:236)&lt;br/&gt;
	at org.eclipse.jdt.internal.junit4.runner.JUnit4TestReference.run(JUnit4TestReference.java:46)&lt;br/&gt;
	at org.eclipse.jdt.internal.junit.runner.TestExecution.run(TestExecution.java:38)&lt;br/&gt;
	at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:467)&lt;br/&gt;
	at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:683)&lt;br/&gt;
	at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.run(RemoteTestRunner.java:390)&lt;br/&gt;
	at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.main(RemoteTestRunner.java:197)&lt;/p&gt;
</description>
                <environment></environment>
        <key id="12477689">HBASE-3124</key>
            <summary>TestHLogSplit#testSplitWillNotTouchLogsIfNewHLogGets occsionally fails with NPE</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="3">Duplicate</resolution>
                                        <assignee username="yuzhihong@gmail.com">Ted Yu</assignee>
                                    <reporter username="hairong">Hairong Kuang</reporter>
                        <labels>
                    </labels>
                <created>Tue, 19 Oct 2010 00:22:38 +0000</created>
                <updated>Thu, 6 Jun 2013 10:47:35 +0000</updated>
                            <resolved>Thu, 6 Jun 2013 10:47:35 +0000</resolved>
                                                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="12922381" author="hairong" created="Tue, 19 Oct 2010 00:34:30 +0000"  >&lt;p&gt;It seems to me this unit test has a race condition. ZombieNewLogWriterRegionServer creates a file after detecting that t1 split is done. However, there is no synchronization to guarantee that the created before logs are archived.&lt;/p&gt;

&lt;p&gt;The logs also show the problem:&lt;br/&gt;
2010-10-18 13:58:46,249 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; util.FSUtils(646): Finished lease recover attempt for hdfs://localhost.localdomain:54844/hbase/hlog/hlog.dat.9&lt;br/&gt;
2010-10-18 13:58:46,255 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; wal.HLog(1574): Pushed=20 entries from hdfs://localhost.localdomain:54844/hbase/hlog/hlog.dat.92010-10-18 13:58:46,256 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;SplitWriter-0&amp;#93;&lt;/span&gt; wal.HLog$1(1597): Split writer thread for region bbb got 10 to process&lt;br/&gt;
2010-10-18 13:58:46,256 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;SplitWriter-0&amp;#93;&lt;/span&gt; wal.HLog$1(1622): Split writer thread for region bbb Applied 10 total edits to bbb in 0ms&lt;br/&gt;
2010-10-18 13:58:46,256 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;SplitWriter-1&amp;#93;&lt;/span&gt; wal.HLog$1(1597): Split writer thread for region ccc got 10 to process&lt;br/&gt;
2010-10-18 13:58:46,257 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;SplitWriter-1&amp;#93;&lt;/span&gt; wal.HLog$1(1622): Split writer thread for region ccc Applied 10 total edits to ccc in 0ms2010-10-18 13:58:46,267 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; wal.HLog(1666): Archived processed log hdfs://localhost.localdomain:54844/hbase/hlog/hlog.dat.0 to /hbase/hlog.old/hlog.dat.0&lt;br/&gt;
2010-10-18 13:58:46,269 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;ZombieNewLogWriterRegionServer&amp;#93;&lt;/span&gt; wal.SequenceFileLogWriter(105): Using syncFs &amp;#8211; &lt;a href=&quot;https://issues.apache.org/jira/browse/HDFS-200&quot; title=&quot;In HDFS, sync() not yet guarantees data available to the new readers&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HDFS-200&quot;&gt;&lt;del&gt;HDFS-200&lt;/del&gt;&lt;/a&gt;&lt;br/&gt;
2010-10-18 13:58:46,271 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; wal.HLog(1666): Archived processed log hdfs://localhost.localdomain:54844/hbase/hlog/hlog.dat.1 to /hbase/hlog.old/hlog.dat.1&lt;br/&gt;
2010-10-18 13:58:46,274 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; wal.HLog(1666): Archived processed log hdfs://localhost.localdomain:54844/hbase/hlog/hlog.dat.2 to /hbase/hlog.old/hlog.dat.2&lt;br/&gt;
2010-10-18 13:58:46,276 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; wal.HLog(1666): Archived processed log hdfs://localhost.localdomain:54844/hbase/hlog/hlog.dat.3 to /hbase/hlog.old/hlog.dat.3&lt;br/&gt;
2010-10-18 13:58:46,279 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; wal.HLog(1666): Archived processed log hdfs://localhost.localdomain:54844/hbase/hlog/hlog.dat.4 to /hbase/hlog.old/hlog.dat.4&lt;br/&gt;
2010-10-18 13:58:46,281 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; wal.HLog(1666): Archived processed log hdfs://localhost.localdomain:54844/hbase/hlog/hlog.dat.5 to /hbase/hlog.old/hlog.dat.5&lt;br/&gt;
2010-10-18 13:58:46,284 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; wal.HLog(1666): Archived processed log hdfs://localhost.localdomain:54844/hbase/hlog/hlog.dat.6 to /hbase/hlog.old/hlog.dat.6&lt;br/&gt;
2010-10-18 13:58:46,287 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; wal.HLog(1666): Archived processed log hdfs://localhost.localdomain:54844/hbase/hlog/hlog.dat.7 to /hbase/hlog.old/hlog.dat.7&lt;br/&gt;
2010-10-18 13:58:46,290 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; wal.HLog(1666): Archived processed log hdfs://localhost.localdomain:54844/hbase/hlog/hlog.dat.8 to /hbase/hlog.old/hlog.dat.8&lt;br/&gt;
2010-10-18 13:58:46,292 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; wal.HLog(1666): Archived processed log hdfs://localhost.localdomain:54844/hbase/hlog/hlog.dat.9 to /hbase/hlog.old/hlog.dat.9&lt;br/&gt;
Juliet file creator: created file /hbase/hlog/hlog.dat..juliet&lt;br/&gt;
2010-10-18 13:58:46,314 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; wal.HLog(1348): Closed /hbase/t1/1183284561/recovered.edits/0000000000000000001&lt;br/&gt;
2010-10-18 13:58:46,336 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; wal.HLog(1348): Closed /hbase/t1/1386060762/recovered.edits/0000000000000000001&lt;br/&gt;
2010-10-18 13:58:46,337 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; wal.HLog(1203): Moving /hbase/hlog/hlog.dat..juliet to /hbase/hlog.old/hlog.dat..juliet&lt;br/&gt;
2010-10-18 13:58:46,339 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; wal.HLog(1207): Moved 1 log files to /hbase/hlog.old&lt;br/&gt;
2010-10-18 13:58:46,339 WARN  &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; hdfs.DFSClient(320): File /hbase/hlog is beng deleted only through Trash org.apache.hadoop.fs.FsShell.delete because all deletes must go through Trash.&lt;br/&gt;
Deleted /hbase/hlog&lt;br/&gt;
2010-10-18 13:58:46,343 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; wal.HLog(1217): hlog file splitting completed in 184 millis for /hbase/hlog&lt;/p&gt;</comment>
                            <comment id="12922611" author="stack" created="Tue, 19 Oct 2010 16:48:14 +0000"  >&lt;p&gt;Sounds reasonable to me  Hairong!&lt;/p&gt;</comment>
                            <comment id="13676904" author="rajesh23" created="Thu, 6 Jun 2013 10:47:35 +0000"  >&lt;p&gt;This issue got fixed as part of &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7878&quot; title=&quot;recoverFileLease does not check return value of recoverLease&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7878&quot;&gt;&lt;del&gt;HBASE-7878&lt;/del&gt;&lt;/a&gt; by providing syncronization to ensure new HLog files will be created before archiving old splits.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 19 Oct 2010 16:48:14 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>26662</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 26 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i02dnz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>11815</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>