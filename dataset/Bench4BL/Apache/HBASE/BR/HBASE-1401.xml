<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 02 19:41:19 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-1401/HBASE-1401.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-1401] close HLog (and open new one) if there hasnt been edits in N minutes/hours</title>
                <link>https://issues.apache.org/jira/browse/HBASE-1401</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;this will help narrow the write hole on clusters with periods of light load.  &lt;/p&gt;</description>
                <environment></environment>
        <key id="12425051">HBASE-1401</key>
            <summary>close HLog (and open new one) if there hasnt been edits in N minutes/hours</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.png">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="stack">stack</assignee>
                                    <reporter username="ryanobjc">ryan rawson</reporter>
                        <labels>
                    </labels>
                <created>Sun, 10 May 2009 22:32:26 +0000</created>
                <updated>Sun, 13 Sep 2009 22:24:37 +0000</updated>
                            <resolved>Mon, 18 May 2009 17:44:34 +0000</resolved>
                                    <version>0.20.0</version>
                                    <fixVersion>0.20.0</fixVersion>
                    <fixVersion>0.19.3</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12707863" author="apurtell" created="Mon, 11 May 2009 01:26:05 +0000"  >&lt;p&gt;This would also be a necessary thing for &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-1295&quot; title=&quot;Multi data center replication&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-1295&quot;&gt;&lt;del&gt;HBASE-1295&lt;/del&gt;&lt;/a&gt;. Under that scenario it&apos;s not unreasonable to consider rolling HLog every 1 minute, or 5 minutes, assuming there have been edits of course.&lt;/p&gt;</comment>
                            <comment id="12708116" author="stack" created="Mon, 11 May 2009 17:24:03 +0000"  >&lt;p&gt;We could add this feature to the LogFlusher thread, the thread that runs an optional sync on a period.&lt;/p&gt;</comment>
                            <comment id="12709488" author="stack" created="Thu, 14 May 2009 17:50:56 +0000"  >&lt;p&gt;Made this a blocker.  Pset needs it.  If we set default to be every hour, then thats 100 close/opens per hour.  Thats a little load on hdfs, but one that it probably should carry fine (though I remember in old days when we used to run compactions on a periiod, that  there&apos;d be a big spike in hdfs activity.. but thats a little different ... heavy reading and writing per region rather than per regionserver).&lt;/p&gt;

&lt;p&gt;Need to backport this too for 0.19.3.&lt;/p&gt;</comment>
                            <comment id="12710228" author="stack" created="Sun, 17 May 2009 21:46:12 +0000"  >&lt;p&gt;Patch that adds to the rollwriter thread a check on each iteration whether N milliseconds have elapsed.  If they have, call roll log.  roll log will roll log if there has been at least one edit since last roll.  Default period is one hour.  Means I/O on cluster every hour, one open/close per regionserver.&lt;/p&gt;

&lt;p&gt;Tested on little cluster.  When I take off load, it seems to do right thing (I had it configured to run every 3 minutes and had some debug in place not included in this patch):&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2009-05-17 21:38:43,297 [regionserver/0:0:0:0:0:0:0:0:60021.logRoller] INFO org.apache.hadoop.hbase.regionserver.LogRoller: LOGROLL BECAUSE PERIOD
2009-05-17 21:38:43,347 [regionserver/0:0:0:0:0:0:0:0:60021.logRoller] INFO org.apache.hadoop.hbase.regionserver.HLog: Roll /hbasetrunk2/.logs/aa0-000-15.u.powerset.com_1242595530778_60021/hlog.dat.1242596143117, entries=2, calcsize=0, filesize=378. New hlog /hbasetrunk2/.logs/aa0-000-15.u.powerset.com_1242595530778_60021/hlog.dat.1242596323344
2009-05-17 21:38:43,347 [regionserver/0:0:0:0:0:0:0:0:60021.logRoller] DEBUG org.apache.hadoop.hbase.regionserver.HLog: Found 0 hlogs to remove  out of total 8; oldest outstanding seqnum is 2758980 from region TestTable,0399337743,1242595974815
2009-05-17 21:41:43,517 [regionserver/0:0:0:0:0:0:0:0:60021.logRoller] INFO org.apache.hadoop.hbase.regionserver.LogRoller: LOGROLL BECAUSE PERIOD
2009-05-17 21:44:43,697 [regionserver/0:0:0:0:0:0:0:0:60021.logRoller] INFO org.apache.hadoop.hbase.regionserver.LogRoller: LOGROLL BECAUSE PERIOD
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;So, under load, the periodic rolling doesn&apos;t get a chance to run because we&apos;re rolling at the size limit.  After we take off the load we see behavior like the above where 3 minutes have elapsed since last roll and 2 edits in the file so we roll.  The next two periods elapse but we don&apos;t roll because no edits.&lt;/p&gt;</comment>
                            <comment id="12710229" author="stack" created="Sun, 17 May 2009 21:48:49 +0000"  >&lt;p&gt;I attached wrong patch.   Here&apos;s right one.&lt;/p&gt;</comment>
                            <comment id="12710230" author="stack" created="Sun, 17 May 2009 21:53:43 +0000"  >&lt;p&gt;Applied branch and trunk.  Closing.&lt;/p&gt;</comment>
                            <comment id="12710282" author="apurtell" created="Mon, 18 May 2009 06:12:43 +0000"  >&lt;p&gt;With the change set for this issue applied, regionservers shut down right away just after coming up. If I patch out the changes, all tests pass. Reverted.&lt;/p&gt;</comment>
                            <comment id="12710418" author="stack" created="Mon, 18 May 2009 17:44:34 +0000"  >&lt;p&gt;Committing again.  Last minute change broke my patch.&lt;/p&gt;</comment>
                            <comment id="12710423" author="stack" created="Mon, 18 May 2009 17:53:18 +0000"  >&lt;p&gt;Here is what I applied to trunk and branch to reclose this issue.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12408397" name="logroller-v3.patch" size="3833" author="stack" created="Mon, 18 May 2009 17:53:18 +0000"/>
                            <attachment id="12408346" name="rollwriteronperiod-v2.log" size="3640" author="stack" created="Sun, 17 May 2009 21:48:49 +0000"/>
                            <attachment id="12408345" name="rollwriteronperiod.log" size="3864" author="stack" created="Sun, 17 May 2009 21:46:12 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 11 May 2009 01:26:05 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>25740</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 29 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0hd13:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>99373</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>