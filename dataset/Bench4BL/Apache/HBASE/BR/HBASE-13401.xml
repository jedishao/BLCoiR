<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sat Dec 03 16:02:45 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-13401/HBASE-13401.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-13401] Snapshot export to S3 fails with jets3t error - The Content-MD5 you specified did not match what we received.</title>
                <link>https://issues.apache.org/jira/browse/HBASE-13401</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;We&apos;re running into issues exporting snapshots of large tables to Amazon S3.&lt;/p&gt;

&lt;p&gt;The snapshot completes successfully, but the snapshot export job throws jets3t errors when we attempt to export to S3.  &lt;/p&gt;

&lt;p&gt;Error snippet, from job log:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2015-04-03 16:59:16,425 INFO  [main] mapreduce.Job: Task Id : attempt_1426532296228_55454_m_000008_1, Status : FAILED
Error: org.apache.hadoop.fs.s3.S3Exception: org.jets3t.service.S3ServiceException: S3 Error Message. -- ResponseCode: 400, ResponseStatus: Bad Request, XML Error Message: &amp;lt;?xml version=&lt;span class=&quot;code-quote&quot;&gt;&quot;1.0&quot;&lt;/span&gt; encoding=&lt;span class=&quot;code-quote&quot;&gt;&quot;UTF-8&quot;&lt;/span&gt;?&amp;gt;&amp;lt;Error&amp;gt;&amp;lt;Code&amp;gt;BadDigest&amp;lt;/Code&amp;gt;&amp;lt;Message&amp;gt;The Content-MD5 you specified did not match what we received.&amp;lt;/Message&amp;gt;&amp;lt;ExpectedDigest&amp;gt;CWiSsgzVAJyzPy2oT8u4Ag==&amp;lt;/ExpectedDigest&amp;gt;&amp;lt;CalculatedDigest&amp;gt;2DIsv6jZJ8FuGtalOO8SPA==&amp;lt;/CalculatedDigest&amp;gt;&amp;lt;RequestId&amp;gt;CA325C738970C313&amp;lt;/RequestId&amp;gt;&amp;lt;HostId&amp;gt;tnE+O1zPZovaQWMhCuM4lkX0h/wN9173FQ7omxZzLb6eH0OCHASyan+mb8WBJkNn&amp;lt;/HostId&amp;gt;&amp;lt;/Error&amp;gt;
  at org.apache.hadoop.fs.s3native.Jets3tNativeFileSystemStore.handleS3ServiceException(Jets3tNativeFileSystemStore.java:405)
  at org.apache.hadoop.fs.s3native.Jets3tNativeFileSystemStore.storeFile(Jets3tNativeFileSystemStore.java:115)
  at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
  at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
  at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
  at java.lang.reflect.Method.invoke(Method.java:606)
  at org.apache.hadoop.io.retry.RetryInvocationHandler.invokeMethod(RetryInvocationHandler.java:190)
  at org.apache.hadoop.io.retry.RetryInvocationHandler.invoke(RetryInvocationHandler.java:103)
  at org.apache.hadoop.fs.s3native.$Proxy19.storeFile(Unknown Source)
  at org.apache.hadoop.fs.s3native.NativeS3FileSystem$NativeS3FsOutputStream.close(NativeS3FileSystem.java:221)
  at org.apache.hadoop.fs.FSDataOutputStream$PositionCache.close(FSDataOutputStream.java:70)
  at org.apache.hadoop.fs.FSDataOutputStream.close(FSDataOutputStream.java:103)
  at org.apache.hadoop.hbase.snapshot.ExportSnapshot$ExportMapper.copyFile(ExportSnapshot.java:200)
  at org.apache.hadoop.hbase.snapshot.ExportSnapshot$ExportMapper.map(ExportSnapshot.java:140)
  at org.apache.hadoop.hbase.snapshot.ExportSnapshot$ExportMapper.map(ExportSnapshot.java:89)
  at org.apache.hadoop.mapreduce.Mapper.run(Mapper.java:145)
  at org.apache.hadoop.mapred.MapTask.runNewMapper(MapTask.java:764)
  at org.apache.hadoop.mapred.MapTask.run(MapTask.java:340)
  at org.apache.hadoop.mapred.YarnChild$2.run(YarnChild.java:167)
  at java.security.AccessController.doPrivileged(Native Method)
  at javax.security.auth.Subject.doAs(Subject.java:415)
  at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1557)
  at org.apache.hadoop.mapred.YarnChild.main(YarnChild.java:162)
Caused by: org.jets3t.service.S3ServiceException: S3 Error Message. -- ResponseCode: 400, ResponseStatus: Bad Request, XML Error Message: &amp;lt;?xml version=&lt;span class=&quot;code-quote&quot;&gt;&quot;1.0&quot;&lt;/span&gt; encoding=&lt;span class=&quot;code-quote&quot;&gt;&quot;UTF-8&quot;&lt;/span&gt;?&amp;gt;&amp;lt;Error&amp;gt;&amp;lt;Code&amp;gt;BadDigest&amp;lt;/Code&amp;gt;&amp;lt;Message&amp;gt;The Content-MD5 you specified did not match what we received.&amp;lt;/Message&amp;gt;&amp;lt;ExpectedDigest&amp;gt;CWiSsgzVAJyzPy2oT8u4Ag==&amp;lt;/ExpectedDigest&amp;gt;&amp;lt;CalculatedDigest&amp;gt;2DIsv6jZJ8FuGtalOO8SPA==&amp;lt;/CalculatedDigest&amp;gt;&amp;lt;RequestId&amp;gt;CA325C738970C313&amp;lt;/RequestId&amp;gt;&amp;lt;HostId&amp;gt;tnE+O1zPZovaQWMhCuM4lkX0h/wN9173FQ7omxZzLb6eH0OCHASyan+mb8WBJkNn&amp;lt;/HostId&amp;gt;&amp;lt;/Error&amp;gt;
  at org.jets3t.service.S3Service.putObject(S3Service.java:2267)
  at org.apache.hadoop.fs.s3native.Jets3tNativeFileSystemStore.storeFile(Jets3tNativeFileSystemStore.java:113)
  ... 21 more

2015-04-03 17:03:50,613 INFO  [main] mapreduce.Job: Task Id : attempt_1426532296228_55454_m_000010_1, Status : FAILED
AttemptID:attempt_1426532296228_55454_m_000010_1 Timed out after 300 secs
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;We&apos;ve verified that exports to other clusters from these same snapshots work fine.  Thus the issue appears to lie within the snapshot export utility, jets3t, and S3.&lt;/p&gt;

&lt;p&gt;&quot;The Content-MD5 you specified did not match what we received&quot; seems to indicate that the snapshot changed between when the upload started and the error.   Is that possible?  Why would a snapshot change?  &lt;/p&gt;

&lt;p&gt;Our jets3t.properties:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
storage-service.internal-error-retry-max=5
storage-service.disable-live-md5=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
threaded-service.max-thread-count=20
threaded-service.admin-max-thread-count=20
s3service.max-thread-count=20
s3service.admin-max-thread-count=20
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Related to:&lt;br/&gt;
&lt;a href=&quot;https://groups.google.com/forum/#!topic/jets3t-users/Bg2qh7OdE2U&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;Discussion on jets3t user group&lt;/a&gt;&lt;/p&gt;</description>
                <environment>&lt;p&gt;CentOS 6.5, Hadoop 2.4.0, Yarn + MapReduce2 2.4.0, Hortonworks Data Platform 2.1.2&lt;/p&gt;</environment>
        <key id="12788071">HBASE-13401</key>
            <summary>Snapshot export to S3 fails with jets3t error - The Content-MD5 you specified did not match what we received.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="3">Duplicate</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="JReid">Joseph Reid</reporter>
                        <labels>
                    </labels>
                <created>Fri, 3 Apr 2015 18:49:02 +0000</created>
                <updated>Mon, 6 Apr 2015 13:58:22 +0000</updated>
                            <resolved>Mon, 6 Apr 2015 13:58:22 +0000</resolved>
                                    <version>0.98.0</version>
                                                    <component>hbase</component>
                    <component>mapreduce</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="14481234" author="jreid" created="Mon, 6 Apr 2015 13:58:22 +0000"  >&lt;p&gt;Duplicate of &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13400&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;HBASE-13400&lt;/a&gt;.  My mistake.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 34 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i27rpb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>