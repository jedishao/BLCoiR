<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 02 18:37:02 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-1052/HBASE-1052.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-1052] Stopping a HRegionServer with unflushed cache causes data loss from org.apache.hadoop.hbase.DroppedSnapshotException </title>
                <link>https://issues.apache.org/jira/browse/HBASE-1052</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt; 1.  Start a Hbase cluster&lt;br/&gt;
 2.  Create a table t1: create &apos;t1&apos;, &lt;/p&gt;
{NAME =&amp;gt; &apos;f1&apos;}
&lt;p&gt; 3.  Put a cell in the table: put &apos;t1&apos;, &apos;r1&apos;, &apos;f1:&apos;, &apos;value&apos;&lt;br/&gt;
 4.  Scan it, see it&apos;s fine&lt;br/&gt;
 5.  Stop the HRegionSever hosting the t1 region: hbase/bin/hbase-daemon.sh stop regionserver.&lt;br/&gt;
 6.  Watch the region being reassigned from the original HRegionServer&lt;br/&gt;
 7.  Scan the t1 table again. It&apos;s empty now.&lt;/p&gt;

&lt;p&gt;If between step 4 and step 5 the cache is flushed (e.g. Hbase cluster restart) no data is loss. However it means that if you stop a region server with dirty cache you will loose some data. &lt;/p&gt;



&lt;p&gt;HRegionServer log after issuing hbase-daemon.sh stop regionserver:&lt;/p&gt;

&lt;p&gt;2008-12-09 06:37:46,873 INFO org.apache.hadoop.ipc.Server: IPC Server handler 7 on 60020: exiting&lt;br/&gt;
2008-12-09 06:37:46,873 INFO org.apache.hadoop.ipc.Server: IPC Server handler 8 on 60020: exiting&lt;br/&gt;
2008-12-09 06:37:46,873 INFO org.apache.hadoop.ipc.Server: IPC Server handler 9 on 60020: exiting&lt;br/&gt;
2008-12-09 06:37:46,873 INFO org.apache.hadoop.ipc.Server: IPC Server handler 0 on 60020: exiting&lt;br/&gt;
2008-12-09 06:37:46,874 INFO org.apache.hadoop.hbase.regionserver.HRegionServer: Stopping infoServer&lt;br/&gt;
2008-12-09 06:37:46,874 INFO org.apache.hadoop.ipc.Server: Stopping IPC Server Responder&lt;br/&gt;
2008-12-09 06:37:46,874 INFO org.mortbay.util.ThreadedServer: Stopping Acceptor ServerSocket&lt;span class=&quot;error&quot;&gt;&amp;#91;addr=0.0.0.0/0.0.0.0,port=0,localport=60030&amp;#93;&lt;/span&gt;&lt;br/&gt;
2008-12-09 06:37:46,886 INFO org.mortbay.http.SocketListener: Stopped SocketListener on 0.0.0.0:60030&lt;br/&gt;
2008-12-09 06:37:46,948 INFO org.mortbay.util.Container: Stopped HttpContext&lt;span class=&quot;error&quot;&gt;&amp;#91;/static,/static&amp;#93;&lt;/span&gt;&lt;br/&gt;
2008-12-09 06:37:47,007 INFO org.mortbay.util.Container: Stopped HttpContext&lt;span class=&quot;error&quot;&gt;&amp;#91;/logs,/logs&amp;#93;&lt;/span&gt;&lt;br/&gt;
2008-12-09 06:37:47,007 INFO org.mortbay.util.Container: Stopped org.mortbay.jetty.servlet.WebApplicationHandler@60ded0f0&lt;br/&gt;
2008-12-09 06:37:47,094 INFO org.mortbay.util.Container: Stopped WebApplicationContext&lt;span class=&quot;error&quot;&gt;&amp;#91;/,/&amp;#93;&lt;/span&gt;&lt;br/&gt;
2008-12-09 06:37:47,094 INFO org.mortbay.util.Container: Stopped org.mortbay.jetty.Server@6490832e&lt;br/&gt;
2008-12-09 06:37:47,094 DEBUG org.apache.hadoop.hbase.regionserver.HRegionServer: closing region t1,,1228833363456&lt;br/&gt;
2008-12-09 06:37:47,094 DEBUG org.apache.hadoop.hbase.regionserver.HRegion: Compactions and cache flushes disabled for region t1,,1228833363456&lt;br/&gt;
2008-12-09 06:37:47,094 DEBUG org.apache.hadoop.hbase.regionserver.HRegion: Scanners disabled for region t1,,1228833363456&lt;br/&gt;
2008-12-09 06:37:47,094 DEBUG org.apache.hadoop.hbase.regionserver.HRegion: No more active scanners for region t1,,1228833363456&lt;br/&gt;
2008-12-09 06:37:47,095 DEBUG org.apache.hadoop.hbase.regionserver.HRegion: Updates disabled for region t1,,1228833363456&lt;br/&gt;
2008-12-09 06:37:47,095 DEBUG org.apache.hadoop.hbase.regionserver.HRegion: No more row locks outstanding on region t1,,1228833363456&lt;br/&gt;
2008-12-09 06:37:47,095 DEBUG org.apache.hadoop.hbase.regionserver.HRegion: Started memcache flush for region t1,,1228833363456. Current region memcache size 18.0&lt;br/&gt;
2008-12-09 06:37:47,095 INFO org.apache.hadoop.hbase.regionserver.Flusher: regionserver/0:0:0:0:0:0:0:0:60020.cacheFlusher exiting&lt;br/&gt;
2008-12-09 06:37:47,096 INFO org.apache.hadoop.hbase.regionserver.LogRoller: LogRoller exiting.&lt;br/&gt;
2008-12-09 06:37:47,096 INFO org.apache.hadoop.hbase.regionserver.CompactSplitThread: regionserver/0:0:0:0:0:0:0:0:60020.compactor exiting&lt;br/&gt;
2008-12-09 06:37:47,099 ERROR org.apache.hadoop.hbase.regionserver.HRegionServer: error closing region t1,,1228833363456&lt;br/&gt;
org.apache.hadoop.hbase.DroppedSnapshotException: region: t1,,1228833363456&lt;br/&gt;
    at org.apache.hadoop.hbase.regionserver.HRegion.internalFlushcache(HRegion.java:1071)&lt;br/&gt;
    at org.apache.hadoop.hbase.regionserver.HRegion.close(HRegion.java:619)&lt;br/&gt;
    at org.apache.hadoop.hbase.regionserver.HRegionServer.closeAllRegions(HRegionServer.java:951)&lt;br/&gt;
    at org.apache.hadoop.hbase.regionserver.HRegionServer.run(HRegionServer.java:459)&lt;br/&gt;
    at java.lang.Thread.run(Thread.java:619)&lt;br/&gt;
Caused by: java.io.IOException: Filesystem closed&lt;br/&gt;
    at org.apache.hadoop.dfs.DFSClient.checkOpen(DFSClient.java:196)&lt;br/&gt;
    at org.apache.hadoop.dfs.DFSClient.getFileInfo(DFSClient.java:564)&lt;br/&gt;
    at org.apache.hadoop.dfs.DistributedFileSystem.getFileStatus(DistributedFileSystem.java:390)&lt;br/&gt;
    at org.apache.hadoop.fs.FileSystem.exists(FileSystem.java:667)&lt;br/&gt;
    at org.apache.hadoop.hbase.regionserver.HStoreFile.&amp;lt;init&amp;gt;(HStoreFile.java:152)&lt;br/&gt;
    at org.apache.hadoop.hbase.regionserver.HStore.internalFlushCache(HStore.java:599)&lt;br/&gt;
    at org.apache.hadoop.hbase.regionserver.HStore.flushCache(HStore.java:577)&lt;br/&gt;
    at org.apache.hadoop.hbase.regionserver.HRegion.internalFlushcache(HRegion.java:1058)&lt;br/&gt;
    ... 4 more&lt;br/&gt;
2008-12-09 06:37:47,100 DEBUG org.apache.hadoop.hbase.regionserver.HLog: closing log writer in hdfs://h1:54310/hbase/log_10.131.237.51_1228833326838_60020&lt;br/&gt;
2008-12-09 06:37:47,101 ERROR org.apache.hadoop.hbase.regionserver.HRegionServer: Close and delete failed&lt;br/&gt;
java.io.IOException: Filesystem closed&lt;br/&gt;
    at org.apache.hadoop.dfs.DFSClient.checkOpen(DFSClient.java:196)&lt;br/&gt;
    at org.apache.hadoop.dfs.DFSClient.access$600(DFSClient.java:59)&lt;br/&gt;
    at org.apache.hadoop.dfs.DFSClient$DFSOutputStream.closeInternal(DFSClient.java:2689)&lt;br/&gt;
    at org.apache.hadoop.dfs.DFSClient$DFSOutputStream.close(DFSClient.java:2655)&lt;br/&gt;
    at org.apache.hadoop.fs.FSDataOutputStream$PositionCache.close(FSDataOutputStream.java:59)&lt;br/&gt;
    at org.apache.hadoop.fs.FSDataOutputStream.close(FSDataOutputStream.java:79)&lt;br/&gt;
    at org.apache.hadoop.io.SequenceFile$Writer.close(SequenceFile.java:962)&lt;br/&gt;
    at org.apache.hadoop.hbase.regionserver.HLog.close(HLog.java:349)&lt;br/&gt;
    at org.apache.hadoop.hbase.regionserver.HLog.closeAndDelete(HLog.java:333)&lt;br/&gt;
    at org.apache.hadoop.hbase.regionserver.HRegionServer.run(HRegionServer.java:461)&lt;br/&gt;
    at java.lang.Thread.run(Thread.java:619)&lt;br/&gt;
2008-12-09 06:37:47,102 INFO org.apache.hadoop.hbase.regionserver.HRegionServer: telling master that region server is shutting down at: 10.131.237.51:60020&lt;br/&gt;
2008-12-09 06:37:47,104 INFO org.apache.hadoop.hbase.regionserver.HRegionServer: stopping server at: 10.131.237.51:60020&lt;br/&gt;
2008-12-09 06:37:47,882 INFO org.apache.hadoop.hbase.Leases: regionserver/0:0:0:0:0:0:0:0:60020.leaseChecker closing leases&lt;br/&gt;
2008-12-09 06:37:47,882 INFO org.apache.hadoop.hbase.Leases: regionserver/0:0:0:0:0:0:0:0:60020.leaseChecker closed leases&lt;br/&gt;
2008-12-09 06:37:54,919 INFO org.apache.hadoop.hbase.regionserver.HRegionServer: worker thread exiting&lt;br/&gt;
2008-12-09 06:37:54,920 INFO org.apache.hadoop.hbase.regionserver.HRegionServer: regionserver/0:0:0:0:0:0:0:0:60020 exiting&lt;br/&gt;
2008-12-09 06:37:54,920 INFO org.apache.hadoop.hbase.regionserver.HRegionServer: Shutdown thread complete&lt;/p&gt;</description>
                <environment></environment>
        <key id="12410293">HBASE-1052</key>
            <summary>Stopping a HRegionServer with unflushed cache causes data loss from org.apache.hadoop.hbase.DroppedSnapshotException </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.png">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jimk">Jim Kellerman</assignee>
                                    <reporter username="clehene">Cosmin Lehene</reporter>
                        <labels>
                    </labels>
                <created>Tue, 9 Dec 2008 17:01:07 +0000</created>
                <updated>Mon, 28 Dec 2009 19:24:54 +0000</updated>
                            <resolved>Sun, 21 Dec 2008 02:45:32 +0000</resolved>
                                    <version>0.18.0</version>
                    <version>0.18.1</version>
                                    <fixVersion>0.19.0</fixVersion>
                                    <component>regionserver</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12654913" author="jimk" created="Tue, 9 Dec 2008 19:21:03 +0000"  >&lt;p&gt;This cannot be fixed in the hbase 0.18.x branch because it depends on features from hadoop-0.19. It has been fixed in trunk. See &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-728&quot; title=&quot;Supporting for HLog appends&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-728&quot;&gt;&lt;del&gt;HBASE-728&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12654927" author="stack" created="Tue, 9 Dec 2008 19:56:03 +0000"  >&lt;p&gt;If I&apos;m reading this properly, Cosmin is shutting the table down &apos;nicely&apos;; it ain&apos;t crashing out.  You&apos;d think the commit log would be tidely closed and on redeploy it should have been replayed by the new HRS?  If so, this issue looks like it has nought to do w/ appends and might exist in TRUNK?&lt;/p&gt;</comment>
                            <comment id="12654930" author="jimk" created="Tue, 9 Dec 2008 20:03:20 +0000"  >&lt;p&gt;Reopening. Cache flush did not complete before FileSystem was closed.&lt;/p&gt;</comment>
                            <comment id="12654932" author="jimk" created="Tue, 9 Dec 2008 20:05:40 +0000"  >&lt;p&gt;Stack is correct. I missed the &quot;nice&quot; shutdown part, my bad.&lt;/p&gt;

&lt;p&gt;Looks like there is a timing issue during shutdown where the FileSystem gets closed before all cache flushes complete.&lt;/p&gt;</comment>
                            <comment id="12655784" author="jimk" created="Thu, 11 Dec 2008 21:55:33 +0000"  >&lt;p&gt;Tested and committed to branch and trunk&lt;/p&gt;</comment>
                            <comment id="12658338" author="jimk" created="Sun, 21 Dec 2008 01:03:29 +0000"  >&lt;p&gt;Reopening. This fix makes tests (TestRegionRebalancing) fail when there are multiple region servers and one is stopped &quot;nicely&quot;&lt;/p&gt;</comment>
                            <comment id="12658339" author="stack" created="Sun, 21 Dec 2008 02:09:58 +0000"  >&lt;p&gt;The broken TRB was fixed by &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-1067&quot; title=&quot;TestRegionRebalancing broken by running of hdfs shutdown thread.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-1067&quot;&gt;&lt;del&gt;HBASE-1067&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12658345" author="jimk" created="Sun, 21 Dec 2008 02:45:32 +0000"  >&lt;p&gt;Yes it was. I hadn&apos;t picked up that patch. My bad.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 9 Dec 2008 19:21:03 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>25543</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 50 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0hb1b:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>99050</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>