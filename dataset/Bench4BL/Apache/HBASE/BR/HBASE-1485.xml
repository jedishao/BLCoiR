<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 02 19:47:40 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-1485/HBASE-1485.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-1485] Wrong or indeterminate behavior when there are duplicate versions of a column</title>
                <link>https://issues.apache.org/jira/browse/HBASE-1485</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;As of now, both gets and scanners will end up returning all duplicate versions of a column.  The ordering of them is indeterminate.&lt;/p&gt;

&lt;p&gt;We need to decide what the desired/expected behavior should be and make it happen.&lt;/p&gt;

&lt;p&gt;Note:  It&apos;s nearly impossible for this to work with Gets as they are now implemented in 1304 so this is really a Scanner issue.  To implement this correctly with Gets, we would have to undo basically all the optimizations that Gets do and making them far slower than a Scanner.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12427237">HBASE-1485</key>
            <summary>Wrong or indeterminate behavior when there are duplicate versions of a column</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="pranavkhaitan">Pranav Khaitan</assignee>
                                    <reporter username="streamy">Jonathan Gray</reporter>
                        <labels>
                    </labels>
                <created>Fri, 5 Jun 2009 18:08:05 +0000</created>
                <updated>Fri, 20 Nov 2015 13:01:15 +0000</updated>
                            <resolved>Wed, 8 Sep 2010 17:23:06 +0000</resolved>
                                    <version>0.20.0</version>
                                    <fixVersion>0.90.0</fixVersion>
                                    <component>regionserver</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>7</watches>
                                                                <comments>
                            <comment id="12716713" author="stack" created="Fri, 5 Jun 2009 18:33:12 +0000"  >&lt;p&gt;Just to say Gets and Scanners should work the same, whatever we decide.&lt;/p&gt;</comment>
                            <comment id="12729379" author="streamy" created="Thu, 9 Jul 2009 18:40:29 +0000"  >&lt;p&gt;I&apos;ve had at least three people with a use case for this.&lt;/p&gt;

&lt;p&gt;Might create a couple sub-tasks here so we can at least head in the right direction.&lt;/p&gt;

&lt;p&gt;First, we need to make scanners ignore duplicate versions of the same column.  The trickiest part is, how do we determine which to keep?  We want to always come from the latest storefile, but I believe their IDs are still random and not timestamps?  We might need to make that change to fix this.  Would also then require a modification to the KVHeap to take this into account, all other things considered equal.&lt;/p&gt;

&lt;p&gt;Once we have scanners working, that will mean the proper thing is enforced on major (and if we want, minor) compactions.&lt;/p&gt;

&lt;p&gt;Gets will only work once we re-implement Gets as an optimized scan (taking advantage of bloom filters, mostly).&lt;/p&gt;


&lt;p&gt;I remember why I punted this to 0.20.1, the tricky part at the beginning is pretty tough and touches a good bit of core read-path code.&lt;/p&gt;

&lt;p&gt;Revisiting now, we&apos;ll see.  Anyone else interested in this / want to work on it?&lt;/p&gt;</comment>
                            <comment id="12729526" author="stack" created="Fri, 10 Jul 2009 05:29:11 +0000"  >&lt;p&gt;Yeah, as ryan suggested, we should exploit sequenceid &amp;#8211; maybe name file for sequenceid?&lt;/p&gt;</comment>
                            <comment id="12742635" author="streamy" created="Wed, 12 Aug 2009 22:50:50 +0000"  >&lt;p&gt;Bumped to 0.21&lt;/p&gt;</comment>
                            <comment id="12746313" author="stack" created="Fri, 21 Aug 2009 22:42:44 +0000"  >&lt;p&gt;Related to hbase-997&lt;/p&gt;</comment>
                            <comment id="12805304" author="stack" created="Wed, 27 Jan 2010 00:48:42 +0000"  >&lt;p&gt;From the list:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
On Tue, Jan 26, 2010 at 9:36 AM, Rod Cope &amp;lt;rod.cope at openlogic dot com&amp;gt; wrote:
&amp;gt; Hi,
&amp;gt;
&amp;gt; I&#185;m seeing behavior on 0.20.2 and 0.20.3 that doesn&#185;t seem quite right and
&amp;gt; would like to know &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; is by design, a bug, or something I&#185;m doing
&amp;gt; wrong.
&amp;gt;
&amp;gt; Background:
&amp;gt;
&amp;gt; When I &lt;span class=&quot;code-keyword&quot;&gt;do&lt;/span&gt; a put that includes a timestamp like &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; (conceptually &#173; I know
&amp;gt; &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; is not the actual API), it works just fine.
&amp;gt; &#160;put &#179;table&#178;, &#179;family&#178;, &#179;column&#178;, &#179;bbb&#178;, 12345
&amp;gt;
&amp;gt; Then, &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; I &lt;span class=&quot;code-keyword&quot;&gt;do&lt;/span&gt; another put in the same client code using the same timestamp
&amp;gt; like &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;...
&amp;gt; &#160;put &#179;table&#178;, &#179;family&#178;, &#179;column&#178;, &#179;aaa&#178;, 12345
&amp;gt;
&amp;gt; ...and I create a scanner, grab a Result, and iterate over all values using
&amp;gt; list(), I get &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;...
&amp;gt; &#160;&#179;table&#178;, &#179;family&#178;, &#179;column&#178;, &#179;aaa&#178;, 12345
&amp;gt;
&amp;gt; So far, so good. &#160;Now, &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; I truncate the table from the shell and run a &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt;
&amp;gt; program that does a flush() on the table between the two put&#185;s, but does it
&amp;gt; in the same client program back-to-back, I also get the same results from
&amp;gt; list().
&amp;gt;
&amp;gt; -----
&amp;gt;
&amp;gt; Problem:
&amp;gt;
&amp;gt; Here&#185;s where the trouble starts. &#160;I truncate the table and run a &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; program
&amp;gt; that puts &#179;bbb&#178;, flushes the table, and quits. &#160;Here&#185;s what I get from
&amp;gt; list():
&amp;gt; &#160;&#179;table&#178;, &#179;family&#178;, &#179;column&#178;, &#179;bbb&#178;, 12345
&amp;gt;
&amp;gt; Then I run another program that puts &#179;aaa&#178;, flushes, and quits. &#160;Here&#185;s what
&amp;gt; I get from list():
&amp;gt; &#160;&#179;table&#178;, &#179;family&#178;, &#179;column&#178;, &#179;aaa&#178;, 12345
&amp;gt; &#160;&#179;table&#178;, &#179;family&#178;, &#179;column&#178;, &#179;bbb&#178;, 12345
&amp;gt;
&amp;gt; And &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; I then run a third program that puts &#179;ccc&#178;, flushes, and quits, I get
&amp;gt; &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; from list():
&amp;gt; &#160;&#179;table&#178;, &#179;family&#178;, &#179;column&#178;, &#179;ccc&#178;, 12345
&amp;gt; &#160;&#179;table&#178;, &#179;family&#178;, &#179;column&#178;, &#179;bbb&#178;, 12345
&amp;gt; &#160;&#179;table&#178;, &#179;family&#178;, &#179;column&#178;, &#179;aaa&#178;, 12345
&amp;gt;
&amp;gt; I&#185;m getting three different values &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; identical
&amp;gt; table/family/qualifier/timestamp tuples. &#160;Does &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; seem right? &#160;There also
&amp;gt; doesn&#185;t seem to be a defined sort order, probably because the timestamps are
&amp;gt; identical.
&amp;gt;
&amp;gt; Also, &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; instead of using list(), I use getMap(), then I always only get a
&amp;gt; single result. &#160;The single result is always the last item in the lists above
&amp;gt; (i.e., &#179;bbb&#178; then &#179;bbb&#178; then &#179;aaa&#178;). &#160;I get identical results from using
&amp;gt; getNoVersionMap().
&amp;gt;
&amp;gt; I suspect that &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; same behavior could occur when HBase decides to flush on
&amp;gt; its own, but I could be wrong. &#160;As you can imagine, &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; can cause problems
&amp;gt; because clients can&#185;t know from the results of calling list() which value is
&amp;gt; &#179;right&#178; or &#179;newest&#178;. &#160;They also can&#185;t rely on getMap() or getNoVersionMap()
&amp;gt; because the single result that gets returned is not necessarily &#179;right&#178; or
&amp;gt; &#179;newest&#178;.
&amp;gt;
&amp;gt; I&#185;ve reproduced everything above in a stand-alone installation and also with
&amp;gt; a 7 regionserver cluster with the &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; 0.20.3. &#160;I started down &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;
&amp;gt; debugging path originally because I ran into &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; problem on the 7
&amp;gt; regionserver cluster with one table of 100+ regions. &#160;I was flushing
&amp;gt; programmatically at the end of some large imports because I&apos;m doing
&amp;gt; setWriteToWAL(&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;) &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; load performance.
&amp;gt;
&amp;gt; Am I doing something wrong? &#160;Did I miss an HBase assumption about flushing
&amp;gt; and/or identical timestamps?
&amp;gt;
&amp;gt; Any help would be much appreciated.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12877589" author="ryanobjc" created="Thu, 10 Jun 2010 21:54:20 +0000"  >&lt;p&gt;Right now Get = 1 row Scans, thus making this issue at least twice as easy &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="12905772" author="stack" created="Fri, 3 Sep 2010 02:29:32 +0000"  >&lt;p&gt;Hurray!&lt;/p&gt;</comment>
                            <comment id="12906620" author="pranavkhaitan" created="Mon, 6 Sep 2010 22:55:44 +0000"  >&lt;p&gt;Patch for this issue posted at &lt;a href=&quot;https://review.cloudera.org/r/780/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://review.cloudera.org/r/780/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12906843" author="evertot" created="Tue, 7 Sep 2010 15:44:49 +0000"  >&lt;p&gt;We&apos;ve tried the patch posted at &lt;a href=&quot;https://review.cloudera.org/r/780/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://review.cloudera.org/r/780/&lt;/a&gt; here at Outerthought.&lt;br/&gt;
The attached file is a unit test showing that the patch works at first sight.&lt;br/&gt;
However, performing updates on existing timestamps, in combination with triggering major compactions things don&apos;t work as expected.&lt;/p&gt;

&lt;p&gt;I&apos;ve used negative-assertions in order to make the tests succeed, and added a comment where we would expect the result to be otherwise.&lt;/p&gt;

&lt;p&gt;I&apos;ve also added a test with the example where a row is deleted and then an update on an older timestamp afterwards remains hidden by the delete.&lt;/p&gt;</comment>
                            <comment id="12906847" author="streamy" created="Tue, 7 Sep 2010 15:53:05 +0000"  >&lt;p&gt;Great stuff Evert.  This is really helpful.&lt;/p&gt;

&lt;p&gt;In the delete case, this is still the expected behavior.  This patch doesn&apos;t change anything with regards to insertions past deletions.&lt;/p&gt;</comment>
                            <comment id="12906849" author="evertot" created="Tue, 7 Sep 2010 15:57:08 +0000"  >&lt;p&gt;The attached test TestCellUpdates.java also intializes a new HBaseTestingUtility for each test method.&lt;br/&gt;
Setting this up only once for the whole test class causes issues when triggering the major compaction which I haven&apos;t been able to pinpoint yet.&lt;/p&gt;</comment>
                            <comment id="12906850" author="pranavkhaitan" created="Tue, 7 Sep 2010 15:58:51 +0000"  >&lt;p&gt;Thanks Evert, for point this out. As Jonathan mentioned, the behavior remains the same for the delete case. I will look more into the flushing case and keep you updated.&lt;/p&gt;</comment>
                            <comment id="12906856" author="evertot" created="Tue, 7 Sep 2010 16:15:30 +0000"  >&lt;p&gt;I understand that the delete case isn&apos;t related to this jira. It would have been better to put it in a separate unit test.&lt;/p&gt;</comment>
                            <comment id="12906942" author="pranavkhaitan" created="Tue, 7 Sep 2010 19:30:12 +0000"  >&lt;p&gt;This is resolved. The fixed patch and explanation for this has been posted at &lt;a href=&quot;https://review.cloudera.org/r/780/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://review.cloudera.org/r/780/&lt;/a&gt;. Let me know if there are further questions. &lt;/p&gt;

&lt;p&gt;Thanks again Evert, for making us aware of this case!&lt;/p&gt;</comment>
                            <comment id="12907308" author="streamy" created="Wed, 8 Sep 2010 16:55:53 +0000"  >&lt;p&gt;Final patch posted by Pranav on reviewboard.  Has been reviewed and approved for commit by Ryan and myself.  Tests passing besides what already fails on trunk.&lt;/p&gt;</comment>
                            <comment id="12907323" author="streamy" created="Wed, 8 Sep 2010 17:23:06 +0000"  >&lt;p&gt;Committed to trunk.  Thanks Pranav!  Great work!&lt;/p&gt;</comment>
                            <comment id="12907365" author="stevenn" created="Wed, 8 Sep 2010 19:13:27 +0000"  >&lt;p&gt;Thanks all!&lt;/p&gt;</comment>
                            <comment id="15017758" author="lars_francke" created="Fri, 20 Nov 2015 13:01:15 +0000"  >&lt;p&gt;This issue was closed as part of a bulk closing operation on 2015-11-20. All issues that have been resolved and where all fixVersions have been released have been closed (following discussions on the mailing list).&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                                                <inwardlinks description="is blocked by">
                                        <issuelink>
            <issuekey id="12457384">HBASE-2265</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12461075">HBASE-2406</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12408440">HBASE-997</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12454126" name="HBASE-1485-v9.patch" size="43845" author="streamy" created="Wed, 8 Sep 2010 16:55:53 +0000"/>
                            <attachment id="12454026" name="TestCellUpdates.java" size="8190" author="evertot" created="Tue, 7 Sep 2010 15:44:49 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 5 Jun 2009 18:33:12 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>25781</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 2 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0hdj3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>99454</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>