<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sat Dec 03 18:09:32 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-11217/HBASE-11217.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-11217] Race between SplitLogManager task creation + TimeoutMonitor</title>
                <link>https://issues.apache.org/jira/browse/HBASE-11217</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Some time ago, we reported a test failure in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-11036&quot; title=&quot;Online schema change with region merge may cause data loss &quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-11036&quot;&gt;&lt;del&gt;HBASE-11036&lt;/del&gt;&lt;/a&gt;, which resulted in already-split and merged regions coming back to life, causing split brain for region boundaries and resulting in data loss. &lt;/p&gt;

&lt;p&gt;It turns out that the root cause was not concurrent online schema change + region split/merge, but meta log splitting failing and the meta updates getting lost. This in turn causes the region split/merge information and assignment to be lost causing large scale data loss. &lt;/p&gt;

&lt;p&gt;Logs below shows that the split task for meta log is created, but before the znode is created, the timeout thread kicks in and sees the unassigned task. Then it does a get on znode which fails with NoNode (because the znode is not created yet). This causes the task to be marked complete (setDone(path, SUCCESS)) which means that the logs are lost. Meta is assigned elsewhere (and opened with the same seqId as previous) confirming data loss in meta. &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2014-04-16 18:31:26,267 INFO  [MASTER_META_SERVER_OPERATIONS-hor13n02:60000-2] handler.MetaServerShutdownHandler: Splitting hbase:meta logs &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; hor13n03.gq1.ygridcore.net,60020,1397672668647
2014-04-16 18:31:26,274 DEBUG [MASTER_META_SERVER_OPERATIONS-hor13n02:60000-2] master.MasterFileSystem: Renamed region directory: hdfs:&lt;span class=&quot;code-comment&quot;&gt;//hor13n01.gq1.ygridcore.net:8020/apps/hbase/data/WALs/hor13n03.gq1.ygridcore.net,60020,1397672668647-splitting
&lt;/span&gt;2014-04-16 18:31:26,274 INFO  [MASTER_META_SERVER_OPERATIONS-hor13n02:60000-2] master.SplitLogManager: dead splitlog workers [hor13n03.gq1.ygridcore.net,60020,1397672668647]
2014-04-16 18:31:26,276 DEBUG [MASTER_META_SERVER_OPERATIONS-hor13n02:60000-2] master.SplitLogManager: Scheduling batch of logs to split
2014-04-16 18:31:26,276 INFO  [MASTER_META_SERVER_OPERATIONS-hor13n02:60000-2] master.SplitLogManager: started splitting 1 logs in [hdfs:&lt;span class=&quot;code-comment&quot;&gt;//hor13n01.gq1.ygridcore.net:8020/apps/hbase/data/WALs/hor13n03.gq1.ygridcore.net,60020,1397672668647-splitting]
&lt;/span&gt;2014-04-16 18:31:26,276 INFO  [hor13n02.gq1.ygridcore.net,60000,1397672191204.splitLogManagerTimeoutMonitor] master.SplitLogManager: total tasks = 1 unassigned = 1 tasks={/hbase/splitWAL/WALs%2Fhor13n03.gq1.ygridcore.net%2C60020%2C1397672668647-splitting%2Fhor13n03.gq1.ygridcore.net%252C60020%252C1397672668647.1397672681632.meta=last_update = -1 last_version = -
2014-04-16 18:31:26,276 DEBUG [hor13n02.gq1.ygridcore.net,60000,1397672191204.splitLogManagerTimeoutMonitor] master.SplitLogManager: resubmitting unassigned task(s) after timeout
2014-04-16 18:31:26,277 WARN  [main-EventThread] master.SplitLogManager$GetDataAsyncCallback: task znode /hbase/splitWAL/WALs%2Fhor13n03.gq1.ygridcore.net%2C60020%2C1397672668647-splitting%2Fhor13n03.gq1.ygridcore.net%252C60020%252C1397672668647.1397672681632.meta vanished.
2014-04-16 18:31:26,277 INFO  [main-EventThread] master.SplitLogManager: Done splitting /hbase/splitWAL/WALs%2Fhor13n03.gq1.ygridcore.net%2C60020%2C1397672668647-splitting%2Fhor13n03.gq1.ygridcore.net%252C60020%252C1397672668647.1397672681632.meta
2014-04-16 18:31:26,282 DEBUG [main-EventThread] master.SplitLogManager: put up splitlog task at znode /hbase/splitWAL/WALs%2Fhor13n03.gq1.ygridcore.net%2C60020%2C1397672668647-splitting%2Fhor13n03.gq1.ygridcore.net%252C60020%252C1397672668647.1397672681632.meta                                                                                                      
2014-04-16 18:31:26,286 WARN  [MASTER_META_SERVER_OPERATIONS-hor13n02:60000-2] master.SplitLogManager: returning success without actually splitting and deleting all the log files in path hdfs:&lt;span class=&quot;code-comment&quot;&gt;//hor13n01.gq1.ygridcore.net:8020/apps/hbase/data/WALs/hor13n03.gq1.ygridcore.net,60020,1397672668647-splitting
&lt;/span&gt;2014-04-16 18:31:26,286 INFO  [MASTER_META_SERVER_OPERATIONS-hor13n02:60000-2] master.SplitLogManager: finished splitting (more than or equal to) 9 bytes in 1 log files in [hdfs:&lt;span class=&quot;code-comment&quot;&gt;//hor13n01.gq1.ygridcore.net:8020/apps/hbase/data/WALs/hor13n03.gq1.ygridcore.net,60020,1397672668647-splitting] in 10ms
&lt;/span&gt;2014-04-16 18:31:26,290 DEBUG [main-EventThread] master.SplitLogManager$DeleteAsyncCallback: deleted /hbase/splitWAL/WALs%2Fhor13n03.gq1.ygridcore.net%2C60020%2C1397672668647-splitting%2Fhor13n03.gq1.ygridcore.net%252C60020%252C1397672668647.1397672681632.meta
2014-04-16 18:31:26,290 WARN  [main-EventThread] master.SplitLogManager$GetDataAsyncCallback: task znode /hbase/splitWAL/WALs%2Fhor13n03.gq1.ygridcore.net%2C60020%2C1397672668647-splitting%2Fhor13n03.gq1.ygridcore.net%252C60020%252C1397672668647.1397672681632.meta vanished.
2014-04-16 18:31:26,290 DEBUG [main-EventThread] master.SplitLogManager: unacquired orphan task is done /hbase/splitWAL/WALs%2Fhor13n03.gq1.ygridcore.net%2C60020%2C1397672668647-splitting%2Fhor13n03.gq1.ygridcore.net%252C60020%252C1397672668647.1397672681632.meta
2014-04-16 18:31:26,291 INFO  [main-EventThread] master.SplitLogManager: task /hbase/splitWAL/RESCAN0000000383 entered state: DONE hor13n02.gq1.ygridcore.net,60000,1397672191204
2014-04-16 18:31:26,291 DEBUG [MASTER_META_SERVER_OPERATIONS-hor13n02:60000-2] master.AssignmentManager: based on AM, current region=hbase:meta,,1.1588230740 is on server=hor13n03.gq1.ygridcore.net,60020,1397672668647 server being checked: hor13n03.gq1.ygridcore.net,60020,1397672668647
2014-04-16 18:31:26,291 INFO  [MASTER_META_SERVER_OPERATIONS-hor13n02:60000-2] handler.MetaServerShutdownHandler: Server hor13n03.gq1.ygridcore.net,60020,1397672668647 was carrying META. Trying to assign.
2014-04-16 18:31:26,291 INFO  [MASTER_META_SERVER_OPERATIONS-hor13n02:60000-2] master.RegionStates: Transitioned {1588230740 state=OPEN, ts=1397672681933, server=hor13n03.gq1.ygridcore.net,60020,1397672668647} to {1588230740 state=OFFLINE, ts=1397673086291, server=hor13n03.gq1.ygridcore.net,60020,1397672668647}
2014-04-16 18:31:26,291 INFO  [MASTER_META_SERVER_OPERATIONS-hor13n02:60000-2] master.RegionStates: Offlined 1588230740 from hor13n03.gq1.ygridcore.net,60020,1397672668647
2014-04-16 18:31:26,299 INFO  [main-EventThread] master.SplitLogManager$DeleteAsyncCallback: /hbase/splitWAL/WALs%2Fhor13n03.gq1.ygridcore.net%2C60020%2C1397672668647-splitting%2Fhor13n03.gq1.ygridcore.net%252C60020%252C1397672668647.1397672681632.meta does not exist. Either was created but deleted behind our back by another pending delete OR was deleted in earl
2014-04-16 18:31:26,299 DEBUG [main-EventThread] master.SplitLogManager: deleted task without in memory state /hbase/splitWAL/WALs%2Fhor13n03.gq1.ygridcore.net%2C60020%2C1397672668647-splitting%2Fhor13n03.gq1.ygridcore.net%252C60020%252C1397672668647.1397672681632.meta
2014-04-16 18:31:26,299 DEBUG [main-EventThread] master.SplitLogManager$DeleteAsyncCallback: deleted /hbase/splitWAL/RESCAN0000000383
2014-04-16 18:31:26,299 DEBUG [main-EventThread] master.SplitLogManager: deleted task without in memory state /hbase/splitWAL/RESCAN0000000383
2014-04-16 18:31:26,301 INFO  [MASTER_META_SERVER_OPERATIONS-hor13n02:60000-2] catalog.CatalogTracker: Failed verification of hbase:meta,,1 at address=hor13n03.gq1.ygridcore.net,60020,1397672668647, exception=java.net.ConnectException: Connection refused
2014-04-16 18:31:26,301 INFO  [MASTER_META_SERVER_OPERATIONS-hor13n02:60000-2] zookeeper.ZooKeeperNodeTracker: Unsetting hbase:meta region location in ZooKeeper
2014-04-16 18:31:26,315 DEBUG [MASTER_META_SERVER_OPERATIONS-hor13n02:60000-2] master.AssignmentManager: No previous transition plan found (or ignoring an existing plan) &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; hbase:meta,,1.1588230740; generated random plan=hri=hbase:meta,,1.1588230740, src=, dest=hor13n04.gq1.ygridcore.net,60020,1397672685370; 3 (online=3, available=3) available servers, forceNew
2014-04-16 18:31:26,315 DEBUG [MASTER_META_SERVER_OPERATIONS-hor13n02:60000-2] zookeeper.ZKAssign: master:60000-0x3456a48dd7d0223, quorum=hor13n04.gq1.ygridcore.net:2181,hor13n03.gq1.ygridcore.net:2181,hor13n20.gq1.ygridcore.net:2181, baseZNode=/hbase Creating (or updating) unassigned node 1588230740 with OFFLINE state
2014-04-16 18:31:26,323 INFO  [MASTER_META_SERVER_OPERATIONS-hor13n02:60000-2] master.AssignmentManager: Assigning hbase:meta,,1.1588230740 to hor13n04.gq1.ygridcore.net,60020,1397672685370
2014-04-16 18:31:26,323 INFO  [MASTER_META_SERVER_OPERATIONS-hor13n02:60000-2] master.RegionStates: Transitioned {1588230740 state=OFFLINE, ts=1397673086315, server=hor13n03.gq1.ygridcore.net,60020,1397672668647} to {1588230740 state=PENDING_OPEN, ts=1397673086323, server=hor13n04.gq1.ygridcore.net,60020,1397672685370}
2014-04-16 18:31:28,337 DEBUG [MASTER_META_SERVER_OPERATIONS-hor13n02:60000-2] master.DeadServer: Finished processing hor13n03.gq1.ygridcore.net,60020,1397672668647
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

</description>
                <environment></environment>
        <key id="12715657">HBASE-11217</key>
            <summary>Race between SplitLogManager task creation + TimeoutMonitor</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.png">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="enis">Enis Soztutar</assignee>
                                    <reporter username="enis">Enis Soztutar</reporter>
                        <labels>
                    </labels>
                <created>Wed, 21 May 2014 02:01:34 +0000</created>
                <updated>Sat, 21 Feb 2015 23:32:14 +0000</updated>
                            <resolved>Thu, 22 May 2014 18:42:58 +0000</resolved>
                                                    <fixVersion>0.99.0</fixVersion>
                    <fixVersion>0.98.3</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>9</watches>
                                                                <comments>
                            <comment id="14004249" author="enis" created="Wed, 21 May 2014 02:49:50 +0000"  >&lt;p&gt;Here is a simple patch which changes two things: &lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;lastNodeCreateTime is not updated for every task creation + resubmission before task is created in memory.&lt;/li&gt;
	&lt;li&gt;In SplitLogManager.TimeoutMonitor, when checking for the condition for unassigned tasks, we no longer cause a task completion if znode is not available (because it may not be created yet).&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14004274" author="yuzhihong@gmail.com" created="Wed, 21 May 2014 03:05:09 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+    lastTaskCreateTime = EnvironmentEdgeManager.currentTimeMillis();
     Task oldtask = createTaskIfAbsent(path, batch);
     &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (oldtask == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Should return value from createTaskIfAbsent() be checked before lastTaskCreateTime is assigned ?&lt;/p&gt;</comment>
                            <comment id="14004296" author="mantonov" created="Wed, 21 May 2014 03:37:56 +0000"  >&lt;p&gt;yep, may be in #splitLogDistributed(...) after #enqueueSplitTask returned true (if I understand the flow correctly)&lt;/p&gt;</comment>
                            <comment id="14004748" author="jxiang" created="Wed, 21 May 2014 15:11:38 +0000"  >&lt;p&gt;Because log replay is enabled in your test? Make sense.&lt;/p&gt;</comment>
                            <comment id="14005001" author="enis" created="Wed, 21 May 2014 18:07:08 +0000"  >&lt;blockquote&gt;&lt;p&gt;Should return value from createTaskIfAbsent() be checked before lastTaskCreateTime is assigned ?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;The trick is to set the time BEFORE task is created. &lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;Because log replay is enabled in your test?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;This is not with log replay. Standard log split. &lt;/p&gt;</comment>
                            <comment id="14005058" author="jxiang" created="Wed, 21 May 2014 18:34:15 +0000"  >&lt;p&gt;Yes, you are right. It&apos;s an issue with standard log split.&lt;br/&gt;
Will the problem still be there even if we set the time BEFORE task is created, in case the timeout monitor is too aggressive and creating the znode takes longer?&lt;br/&gt;
I was wondering if it is ok to do something different (for example, do nothing instead of marking it is done) if there is no node and the task is unassigned.&lt;/p&gt;</comment>
                            <comment id="14005244" author="enis" created="Wed, 21 May 2014 21:11:35 +0000"  >&lt;blockquote&gt;&lt;p&gt;Will the problem still be there even if we set the time BEFORE task is created, in case the timeout monitor is too aggressive and creating the znode takes longer?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;The timeout is 3 min by default. The znode gets created in a couple of ms that is fine. But the race condition was that, we first create the task in memory, then create the znode. Timeout monitor started after the task is created in memory, but before the znode is created. &lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;I was wondering if it is ok to do something different (for example, do nothing instead of marking it is done) if there is no node and the task is unassigned.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I think this is what we do in the patch. In the timeout monitor, if znode cannot be found for an unassigned task, we don&apos;t declare the task as successful via the new boolean completeTaskOnNoNode (although in other cases we still do it). Does it makes sense? &lt;/p&gt;</comment>
                            <comment id="14005254" author="jxiang" created="Wed, 21 May 2014 21:22:41 +0000"  >&lt;p&gt;Good. +1.&lt;/p&gt;</comment>
                            <comment id="14005280" author="jeffreyz" created="Wed, 21 May 2014 21:43:04 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=enis&quot; class=&quot;user-hover&quot; rel=&quot;enis&quot;&gt;Enis Soztutar&lt;/a&gt; I think we should not handle the nonode case basically not introducing completeTaskOnNoNode if possible. It&apos;s possible that we could end up a znode exists without internal Task memory state but not the other way around. &lt;/p&gt;

&lt;p&gt;To be safe, for 0.98 we can use your current approach(v1 patch) and for trunk we just do nothing for simplicity. Thanks. v1 patch looks good to me for pre 0.99 branches(+1)&lt;/p&gt;</comment>
                            <comment id="14005300" author="apurtell" created="Wed, 21 May 2014 22:05:57 +0000"  >&lt;blockquote&gt;&lt;p&gt;(Enis) In the timeout monitor, if znode cannot be found for an unassigned task, we don&apos;t declare the task as successful via the new boolean completeTaskOnNoNode (although in other cases we still do it). Does it makes sense?&lt;/p&gt;&lt;/blockquote&gt;

&lt;blockquote&gt;&lt;p&gt;(Jeffrey) To be safe, for 0.98 we can use your current approach(v1 patch) &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;This would be fine by me. Want to aim for 0.98.3?&lt;/p&gt;</comment>
                            <comment id="14005333" author="enis" created="Wed, 21 May 2014 22:31:40 +0000"  >&lt;blockquote&gt;&lt;p&gt;To be safe, for 0.98 we can use your current approach(v1 patch) and for trunk we just do nothing for simplicity.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Yeah, looking at the code unless something goes wrong or the race happens like in this case, we should not have in-memory task, but no znode. I&apos;ll upload a new patch. &lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;This would be fine by me. Want to aim for 0.98.3?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Thanks. It would be good to have this in 0.98. Let&apos;s commit v1 to 0.98, and v2 to trunk. &lt;/p&gt;</comment>
                            <comment id="14005339" author="enis" created="Wed, 21 May 2014 22:40:19 +0000"  >&lt;p&gt;Here is a v2 patch aimed at trunk. &lt;/p&gt;</comment>
                            <comment id="14005392" author="jeffreyz" created="Wed, 21 May 2014 23:30:12 +0000"  >&lt;p&gt;v2 looks good to me for the trunk. +1. Thanks.&lt;/p&gt;</comment>
                            <comment id="14006292" author="enis" created="Thu, 22 May 2014 18:42:58 +0000"  >&lt;p&gt;I have committed v2 patch to master and v1 to 0.98. Thanks for reviews. &lt;/p&gt;</comment>
                            <comment id="14006369" author="hudson" created="Thu, 22 May 2014 19:33:57 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-TRUNK #5137 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/5137/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/5137/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-11217&quot; title=&quot;Race between SplitLogManager task creation + TimeoutMonitor&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-11217&quot;&gt;&lt;del&gt;HBASE-11217&lt;/del&gt;&lt;/a&gt; Race between SplitLogManager task creation + TimeoutMonitor (enis: rev 92b2c86776d968c9f44bbf848e56eff753c8950f)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/master/SplitLogManager.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14006631" author="srikanth235" created="Thu, 22 May 2014 23:58:39 +0000"  >&lt;p&gt;When I was trying to run TestSplitLogManager test suite with the patch, I was encountering the following failure&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
-------------------------------------------------------
 T E S T S
-------------------------------------------------------
Running org.apache.hadoop.hbase.master.TestSplitLogManager
Tests run: 14, Failures: 1, Errors: 0, Skipped: 0, Time elapsed: 88.402 sec &amp;lt;&amp;lt;&amp;lt; FAILURE!

Results :

Failed tests:   testVanishingTaskZNode(org.apache.hadoop.hbase.master.TestSplitLogManager): Waiting timed out after [3,200] msec

Tests run: 14, Failures: 1, Errors: 0, Skipped: 0

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I tried to run the TestSplitLogManager by reverting this patch and the test passed. This issue may be specific to my local machine, but can you please verify this once more from your side too. &lt;/p&gt;</comment>
                            <comment id="14006634" author="enis" created="Fri, 23 May 2014 00:03:08 +0000"  >&lt;p&gt;I run the test suite, but did not read much into the timeout, since that happens flakily. We did not wait for hadoopqa run due to the git transition. Let me check the test. &lt;/p&gt;</comment>
                            <comment id="14006643" author="enis" created="Fri, 23 May 2014 00:18:04 +0000"  >&lt;p&gt;Yeah it seems the patch causes the test to timeout, because we removed the condition the test tests. &lt;/p&gt;

&lt;p&gt;Addendum patch removes the test. Thanks fore reporting. &lt;/p&gt;</comment>
                            <comment id="14006652" author="jeffreyz" created="Fri, 23 May 2014 00:32:31 +0000"  >&lt;p&gt;+1 on the addendum patch if QA runs fine. Thanks.&lt;/p&gt;</comment>
                            <comment id="14006683" author="enis" created="Fri, 23 May 2014 01:31:49 +0000"  >&lt;p&gt;hadoopqa is still not updated with git repo AFAIK. I&apos;ve run the tests locally. Committed the addendum to master and 0.98. &lt;/p&gt;</comment>
                            <comment id="14006684" author="hudson" created="Fri, 23 May 2014 01:32:39 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-0.98 #311 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.98/311/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.98/311/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-11217&quot; title=&quot;Race between SplitLogManager task creation + TimeoutMonitor&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-11217&quot;&gt;&lt;del&gt;HBASE-11217&lt;/del&gt;&lt;/a&gt; Race between SplitLogManager task creation + TimeoutMonitor (enis: rev 49d7b9dc456d4ac7dca1cd16e019bf390332eea4)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/master/SplitLogManager.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14006688" author="apurtell" created="Fri, 23 May 2014 01:34:30 +0000"  >&lt;p&gt;Thanks for the initial fix and fast test fix Enis.&lt;/p&gt;</comment>
                            <comment id="14007112" author="hudson" created="Fri, 23 May 2014 12:51:29 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-TRUNK #5138 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/5138/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/5138/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-11217&quot; title=&quot;Race between SplitLogManager task creation + TimeoutMonitor&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-11217&quot;&gt;&lt;del&gt;HBASE-11217&lt;/del&gt;&lt;/a&gt; Race between SplitLogManager task creation + TimeoutMonitor - ADDENDUM to fix unit test (enis: rev 9dcebc396bf7dc697fba990c6ee35bc5009a7dc9)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/master/TestSplitLogManager.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14007168" author="hudson" created="Fri, 23 May 2014 13:54:11 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-0.98 #312 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.98/312/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.98/312/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-11217&quot; title=&quot;Race between SplitLogManager task creation + TimeoutMonitor&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-11217&quot;&gt;&lt;del&gt;HBASE-11217&lt;/del&gt;&lt;/a&gt; Race between SplitLogManager task creation + TimeoutMonitor - ADDENDUM to fix unit test (enis: rev 230a768a3ccf4ef8e50236e360035efadaea7ecc)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/master/TestSplitLogManager.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14081057" author="lhofhansl" created="Thu, 31 Jul 2014 16:20:23 +0000"  >&lt;p&gt;Does anybody know if this is an issue in 0.94?&lt;/p&gt;</comment>
                            <comment id="14081275" author="jeffreyz" created="Thu, 31 Jul 2014 18:59:46 +0000"  >&lt;p&gt;Actually this issue could happen to 0.94 more easily. In trunk branch, we have following code &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
((EnvironmentEdgeManager.currentTimeMillis() - lastTaskCreateTime) &amp;gt;
          unassignedTimeout)) {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The issue will happen only when the time between the task creation and znode creation takes more than 3mins(default unassignedTimeout value). I guess we saw this in test cases where unassignedTimeout is set as 0.&lt;/p&gt;

&lt;p&gt;While in 0.94, it&apos;s easier to see the issue as we use following condition based on lastNodeCreateTime which could be from last recovery and be hours/days away. &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
(EnvironmentEdgeManager.currentTimeMillis() - lastNodeCreateTime) &amp;gt;
          unassignedTimeout)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14081317" author="lhofhansl" created="Thu, 31 Jul 2014 19:32:07 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jeffreyz&quot; class=&quot;user-hover&quot; rel=&quot;jeffreyz&quot;&gt;Jeffrey Zhong&lt;/a&gt;, filed an issue to fix this in 0.94 as well.&lt;/p&gt;</comment>
                            <comment id="14081999" author="hudson" created="Fri, 1 Aug 2014 06:58:19 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-0.94 #1392 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.94/1392/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.94/1392/&lt;/a&gt;)&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;0.94&amp;#93;&lt;/span&gt; port &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-11217&quot; title=&quot;Race between SplitLogManager task creation + TimeoutMonitor&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-11217&quot;&gt;&lt;del&gt;HBASE-11217&lt;/del&gt;&lt;/a&gt; Race between SplitLogManager task creation + TimeoutMonitor. (LarsH - original patch by Enis) (larsh: rev 812be0ca43f8ea0b6ce8e78249b170afa04b5767)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;src/test/java/org/apache/hadoop/hbase/master/TestSplitLogManager.java&lt;/li&gt;
	&lt;li&gt;src/main/java/org/apache/hadoop/hbase/master/SplitLogManager.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14082077" author="hudson" created="Fri, 1 Aug 2014 08:47:10 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-0.94-security #505 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.94-security/505/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.94-security/505/&lt;/a&gt;)&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;0.94&amp;#93;&lt;/span&gt; port &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-11217&quot; title=&quot;Race between SplitLogManager task creation + TimeoutMonitor&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-11217&quot;&gt;&lt;del&gt;HBASE-11217&lt;/del&gt;&lt;/a&gt; Race between SplitLogManager task creation + TimeoutMonitor. (LarsH - original patch by Enis) (larsh: rev 812be0ca43f8ea0b6ce8e78249b170afa04b5767)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;src/test/java/org/apache/hadoop/hbase/master/TestSplitLogManager.java&lt;/li&gt;
	&lt;li&gt;src/main/java/org/apache/hadoop/hbase/master/SplitLogManager.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14082078" author="hudson" created="Fri, 1 Aug 2014 08:47:26 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-0.94-JDK7 #160 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.94-JDK7/160/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.94-JDK7/160/&lt;/a&gt;)&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;0.94&amp;#93;&lt;/span&gt; port &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-11217&quot; title=&quot;Race between SplitLogManager task creation + TimeoutMonitor&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-11217&quot;&gt;&lt;del&gt;HBASE-11217&lt;/del&gt;&lt;/a&gt; Race between SplitLogManager task creation + TimeoutMonitor. (LarsH - original patch by Enis) (larsh: rev 812be0ca43f8ea0b6ce8e78249b170afa04b5767)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;src/test/java/org/apache/hadoop/hbase/master/TestSplitLogManager.java&lt;/li&gt;
	&lt;li&gt;src/main/java/org/apache/hadoop/hbase/master/SplitLogManager.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14330932" author="enis" created="Sat, 21 Feb 2015 23:32:14 +0000"  >&lt;p&gt;Closing this issue after 0.99.0 release. &lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12709371">HBASE-11036</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12731153">HBASE-11633</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12646416" name="hbase-11217_addendum.patch" size="2502" author="enis" created="Fri, 23 May 2014 00:18:04 +0000"/>
                            <attachment id="12645927" name="hbase-11217_v1.patch" size="9529" author="enis" created="Wed, 21 May 2014 02:49:50 +0000"/>
                            <attachment id="12646123" name="hbase-11217_v2.patch" size="6481" author="enis" created="Wed, 21 May 2014 22:40:19 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 21 May 2014 03:05:09 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>393942</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 40 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1vtwf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>394082</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>