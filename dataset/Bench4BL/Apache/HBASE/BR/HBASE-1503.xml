<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 02 19:49:49 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-1503/HBASE-1503.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-1503] hbase-1304 dropped updating list of store files on flush</title>
                <link>https://issues.apache.org/jira/browse/HBASE-1503</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Here is how current updateReaders is implemented in StoreScanner:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  &lt;span class=&quot;code-comment&quot;&gt;// Implementation of ChangedReadersObserver
&lt;/span&gt;  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void updateReaders() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.closing.get()) {
      &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt;;
    }
    &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.lock.writeLock().lock();
    &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
      &lt;span class=&quot;code-comment&quot;&gt;// Could &lt;span class=&quot;code-keyword&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; pretty nicely with KeyValueHeap, but the existing
&lt;/span&gt;      &lt;span class=&quot;code-comment&quot;&gt;// implementation of &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; method only updated &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; no existing storefiles?
&lt;/span&gt;      &lt;span class=&quot;code-comment&quot;&gt;// Lets discuss.
&lt;/span&gt;      &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt;;
    } &lt;span class=&quot;code-keyword&quot;&gt;finally&lt;/span&gt; {
      &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.lock.writeLock().unlock();
    }
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Fill in missing functionality.&lt;/p&gt;

&lt;p&gt;Count of store files changes on flush and compaction.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12427421">HBASE-1503</key>
            <summary>hbase-1304 dropped updating list of store files on flush</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="stack">stack</assignee>
                                    <reporter username="stack">stack</reporter>
                        <labels>
                    </labels>
                <created>Tue, 9 Jun 2009 04:37:12 +0000</created>
                <updated>Sun, 13 Sep 2009 22:24:42 +0000</updated>
                            <resolved>Mon, 15 Jun 2009 22:24:15 +0000</resolved>
                                                    <fixVersion>0.20.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12719184" author="streamy" created="Sat, 13 Jun 2009 21:28:05 +0000"  >&lt;p&gt;Rebuilds the KVHeap in the StoreScanner when readers have changed.  Reinitializes heap and resets query matcher.&lt;/p&gt;</comment>
                            <comment id="12719185" author="streamy" created="Sat, 13 Jun 2009 22:03:04 +0000"  >&lt;p&gt;Removes the read/write lock in favor of only object-level synchronization.&lt;/p&gt;</comment>
                            <comment id="12719187" author="stack" created="Sat, 13 Jun 2009 22:20:42 +0000"  >&lt;p&gt;Saw this w/ v2:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Caused by: java.lang.NullPointerException
        at org.apache.hadoop.hbase.regionserver.StoreFileScanner.seekAtOrAfter(StoreFileScanner.java:89)
        at org.apache.hadoop.hbase.regionserver.StoreFileScanner.seek(StoreFileScanner.java:62)
        at org.apache.hadoop.hbase.regionserver.StoreScanner.updateReaders(StoreScanner.java:211)
        at org.apache.hadoop.hbase.regionserver.Store.notifyChangedReadersObservers(Store.java:583)
        at org.apache.hadoop.hbase.regionserver.Store.updateStorefiles(Store.java:569)
        at org.apache.hadoop.hbase.regionserver.Store.flushCache(Store.java:479)
        at org.apache.hadoop.hbase.regionserver.HRegion.internalFlushcache(HRegion.java:925)
        ... 3 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12719216" author="stack" created="Sun, 14 Jun 2009 03:00:20 +0000"  >&lt;p&gt;Marking patch available... this patch seems to work in my testing and it looks good.  Will commit soon.&lt;/p&gt;</comment>
                            <comment id="12719252" author="ryanobjc" created="Sun, 14 Jun 2009 11:42:31 +0000"  >&lt;p&gt;i have this patched in on my cluster, and I just got this:&lt;/p&gt;

&lt;p&gt;2009-06-14 04:35:17,194 DEBUG org.apache.hadoop.hbase.master.BaseScanner: Looking for reference files in: hdfs://borg13:9000/hbase-1304/table/375231875/default&lt;br/&gt;
2009-06-14 04:35:17,196 DEBUG org.apache.hadoop.hbase.master.BaseScanner: isReference: hdfs://borg13:9000/hbase-1304/table/375&lt;br/&gt;
231875/default/7596663133220302018&lt;br/&gt;
2009-06-14 04:35:17,196 DEBUG org.apache.hadoop.hbase.master.BaseScanner: table,\x00\x02\x90\xDF\x00\x00\x01\x11\xFCo\xDB\xC8\&lt;br/&gt;
x00\x23\xED\xEA,1244979274858/375231875 no longer has references to table,\x00\x02\x90\xDF\x00\x00\x01\x11\xFCo\xDB\xC8\x00\x2&lt;br/&gt;
3\xED\xEA,1244979185927&lt;br/&gt;
2009-06-14 04:35:17,197 DEBUG org.apache.hadoop.hbase.master.BaseScanner: Looking for reference files in: hdfs://borg13:9000/hbase-1304/table/375231875/default&lt;br/&gt;
2009-06-14 04:35:17,198 DEBUG org.apache.hadoop.hbase.master.BaseScanner: isReference: hdfs://borg13:9000/hbase-1304/table/375&lt;br/&gt;
231875/default/7596663133220302018&lt;br/&gt;
2009-06-14 04:35:17,198 DEBUG org.apache.hadoop.hbase.master.BaseScanner: table,\x00\x02\x90\xDF\x00\x00\x01\x11\xFCo\xDB\xC8\&lt;br/&gt;
x00\x23\xED\xEA,1244979274858/375231875 no longer has references to table,\x00\x02\x90\xDF\x00\x00\x01\x11\xFCo\xDB\xC8\x00\x2&lt;br/&gt;
3\xED\xEA,1244979185927&lt;br/&gt;
2009-06-14 04:35:17,199 INFO org.apache.hadoop.hbase.master.BaseScanner: Deleting region table,\x00\x02\x90\xDF\x00\x00\x01\x1&lt;br/&gt;
1\xFCo\xDB\xC8\x00\x23\xED\xEA,1244979185927 (encoded=1429689300) because daughter splits no longer hold references&lt;br/&gt;
2009-06-14 04:35:17,199 DEBUG org.apache.hadoop.hbase.regionserver.HRegion: DELETING region hdfs://borg13:9000/hbase-1304/table/1429689300&lt;/p&gt;

&lt;p&gt;the other side of the split still had references like so:&lt;br/&gt;
/hbase-1304/table/1765060841/default/2821551828116783466.1429689300&lt;/p&gt;

&lt;p&gt;so, still something.  or else i forgot to type &apos;ant&apos;.&lt;/p&gt;</comment>
                            <comment id="12719408" author="ryanobjc" created="Mon, 15 Jun 2009 05:47:29 +0000"  >&lt;p&gt;i was suffering from &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-1522&quot; title=&quot;We delete splits before their time occasionally&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-1522&quot;&gt;&lt;del&gt;HBASE-1522&lt;/del&gt;&lt;/a&gt; im pretty sure now.&lt;/p&gt;</comment>
                            <comment id="12719687" author="stack" created="Mon, 15 Jun 2009 18:29:07 +0000"  >&lt;p&gt;I got this again:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2009-06-15 18:21:34,868 [regionserver/0:0:0:0:0:0:0:0:60021.cacheFlusher] FATAL org.apache.hadoop.hbase.regionserver.MemcacheFlusher: Replay of hlog required. Forcing server shutdown
org.apache.hadoop.hbase.DroppedSnapshotException: region: .META.,,1
        at org.apache.hadoop.hbase.regionserver.HRegion.internalFlushcache(HRegion.java:936)
        at org.apache.hadoop.hbase.regionserver.HRegion.flushcache(HRegion.java:829)
        at org.apache.hadoop.hbase.regionserver.MemcacheFlusher.flushRegion(MemcacheFlusher.java:268)
        at org.apache.hadoop.hbase.regionserver.MemcacheFlusher.run(MemcacheFlusher.java:149)
Caused by: java.lang.NullPointerException
        at org.apache.hadoop.hbase.regionserver.StoreFileScanner.seekAtOrAfter(StoreFileScanner.java:95)
        at org.apache.hadoop.hbase.regionserver.StoreFileScanner.seek(StoreFileScanner.java:68)
        at org.apache.hadoop.hbase.regionserver.StoreScanner.updateReaders(StoreScanner.java:209)
        at org.apache.hadoop.hbase.regionserver.Store.notifyChangedReadersObservers(Store.java:583)
        at org.apache.hadoop.hbase.regionserver.Store.updateStorefiles(Store.java:569)
        at org.apache.hadoop.hbase.regionserver.Store.flushCache(Store.java:479)
        at org.apache.hadoop.hbase.regionserver.HRegion.internalFlushcache(HRegion.java:921)
        ... 3 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Investigating.&lt;/p&gt;</comment>
                            <comment id="12719737" author="stack" created="Mon, 15 Jun 2009 19:46:27 +0000"  >&lt;p&gt;The NPE I&apos;d already worked through w/ Jon... its peek returning empty key.   Hacking up new patch that will include scanner for snapshot (see hbase-1507 discussion).&lt;/p&gt;</comment>
                            <comment id="12719755" author="stack" created="Mon, 15 Jun 2009 20:29:28 +0000"  >&lt;p&gt;Patch that deals with NPE and that adds scanner on Snapshot if there is one present.&lt;/p&gt;</comment>
                            <comment id="12719817" author="ryanobjc" created="Mon, 15 Jun 2009 22:19:22 +0000"  >&lt;p&gt;1503-v3 looking good to me!&lt;/p&gt;

&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="12719821" author="stack" created="Mon, 15 Jun 2009 22:24:15 +0000"  >&lt;p&gt;Thanks for review Ryan.  Committed after testing.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310010">
                    <name>Incorporates</name>
                                            <outwardlinks description="incorporates">
                                        <issuelink>
            <issuekey id="12415196">HBASE-1207</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12410706" name="1503-v3.patch" size="12844" author="stack" created="Mon, 15 Jun 2009 20:29:28 +0000"/>
                            <attachment id="12410551" name="HBASE-1503-v1.patch" size="4641" author="streamy" created="Sat, 13 Jun 2009 21:28:05 +0000"/>
                            <attachment id="12410552" name="HBASE-1503-v2.patch" size="5316" author="streamy" created="Sat, 13 Jun 2009 22:03:04 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sat, 13 Jun 2009 21:28:05 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>25792</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 25 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0hdn3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>99472</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>