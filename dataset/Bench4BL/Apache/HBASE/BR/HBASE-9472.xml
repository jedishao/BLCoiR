<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sat Dec 03 15:59:27 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-9472/HBASE-9472.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-9472] If the memstore size is under .1 or greater than .9 the memstore size defaults to the default memstore size</title>
                <link>https://issues.apache.org/jira/browse/HBASE-9472</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;In HbaseConfiguration.checkForClusterFreeMemoryLimit it does a check to see if the blockCache + memstore &amp;gt; .8 this threshold ensures we do not run out of memory.&lt;/p&gt;

&lt;p&gt;But MemStoreFlusher.getMemStoreLimit does this check:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (limit &amp;gt;= 0.9f || limit &amp;lt; 0.1f) {
      LOG.warn(&lt;span class=&quot;code-quote&quot;&gt;&quot;Setting global memstore limit to &lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt; of &quot;&lt;/span&gt; + defaultLimit +
        &lt;span class=&quot;code-quote&quot;&gt;&quot; because supplied value outside allowed range of 0.1 -&amp;gt; 0.9&quot;&lt;/span&gt;);
      effectiveLimit = defaultLimit;
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;In our cluster we had the block cache set to an upper limit of 0.76 and the memstore upper limit was set to 0.04.  We noticed the memstore size was exceeding the limit we had set and after looking at the getMemStoreLimit code it seems that the memstore upper limit is sized to the default value if the configuration value is less than .1 or greater than .9.  This now makes the block cache and memstore greater than our available heap.&lt;/p&gt;

&lt;p&gt;We can remove the check for the greater than 90% of the heap as this can never happen due to the check in HbaseConfiguration.checkForClusterFreeMemoryLimit()&lt;/p&gt;

&lt;p&gt;This check doesn&apos;t seem necessary anymore as we have the HbaseConfiguration class checking for the cluster free limit.  Am I correct in this assumption?&lt;/p&gt;
</description>
                <environment></environment>
        <key id="12667625">HBASE-9472</key>
            <summary>If the memstore size is under .1 or greater than .9 the memstore size defaults to the default memstore size</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="3">Duplicate</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="churromorales">churro morales</reporter>
                        <labels>
                    </labels>
                <created>Mon, 9 Sep 2013 17:35:04 +0000</created>
                <updated>Tue, 21 Jul 2015 17:29:42 +0000</updated>
                            <resolved>Tue, 21 Jul 2015 17:29:42 +0000</resolved>
                                    <version>0.94.5</version>
                    <version>0.99.0</version>
                                                    <component>BlockCache</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                <comments>
                            <comment id="13762084" author="vrodionov" created="Mon, 9 Sep 2013 17:48:49 +0000"  >&lt;p&gt;Just a note. Memstore size of 0.04 is not a good idea. You will end up creating a lot of tiny flush files and compaction will be running around the clock. &lt;/p&gt;</comment>
                            <comment id="13762108" author="anoop.hbase" created="Mon, 9 Sep 2013 18:04:04 +0000"  >&lt;p&gt;Are you doing bulk load of data and that is why you almost dont need the memstore?&lt;/p&gt;</comment>
                            <comment id="13762117" author="churromorales" created="Mon, 9 Sep 2013 18:13:51 +0000"  >&lt;p&gt;We have a 20GB heap for these regionservers which are used for a cluster which is primarily doing random reads.  We are trying to hold everything in the block cache.  We don&apos;t do a lot of writes in comparison to reads in the steady state.  When we ran a job to write quite a few entries to this cluster we noticed the memstore was greater than the expected size:  of .8GB.  &lt;/p&gt;

&lt;p&gt;With respect to the configuration, our expected block cache upper limit is ~ 15GB and our memstore is ~ .8GB &lt;/p&gt;

&lt;p&gt;If the memstore is not allowed to be less than .1, we use the default value which is .4,  combined our blockcache + memstore upper limits are: 23GB which is larger than our total heap of 20GB.&lt;/p&gt;</comment>
                            <comment id="13771241" author="churromorales" created="Wed, 18 Sep 2013 21:11:44 +0000"  >&lt;p&gt;For regionservers with large heaps ~ 20GB, it might not make sense to have a restriction where the memstore size has to be a certain percentage of the heap size.  Instead the logic used is the memstore has to be either 100MB or 10% of the heap.&lt;/p&gt;</comment>
                            <comment id="13771242" author="churromorales" created="Wed, 18 Sep 2013 21:12:18 +0000"  >&lt;p&gt;If you guys feel this logic is appropriate I can provide a patch for trunk.&lt;/p&gt;</comment>
                            <comment id="14091136" author="stack" created="Fri, 8 Aug 2014 18:45:47 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=churromorales&quot; class=&quot;user-hover&quot; rel=&quot;churromorales&quot;&gt;churro morales&lt;/a&gt; Thanks for having a go at fixing this bug of ours.  Doing config check in HBaseConfiguration is good enough I&apos;d say.  No need of the dup check &amp;#8211; especially if it is in disagreement w/ the HBC check.  I think the memory math probably better belongs in our memory util classes ratther than in HBC.  Trunk patch would be great.&lt;/p&gt;</comment>
                            <comment id="14279015" author="churromorales" created="Thu, 15 Jan 2015 17:53:24 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=stack&quot; class=&quot;user-hover&quot; rel=&quot;stack&quot;&gt;stack&lt;/a&gt; are you comfortable with the logic for memstore sizing?  If yes, I&apos;ll get some patches ready for you folks&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="12769108">HBASE-12897</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12603916" name="HBASE-9742-0.94.patch" size="7099" author="churromorales" created="Wed, 18 Sep 2013 21:11:44 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 9 Sep 2013 17:48:49 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>347562</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 46 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1nxkf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>347861</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>