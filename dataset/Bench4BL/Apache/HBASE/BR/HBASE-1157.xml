<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 02 19:15:50 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-1157/HBASE-1157.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-1157] If we do not take start code as a part of region server recovery, we could inadvertantly try to reassign regions assigned to a restarted server with a different start code</title>
                <link>https://issues.apache.org/jira/browse/HBASE-1157</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description></description>
                <environment></environment>
        <key id="12413344">HBASE-1157</key>
            <summary>If we do not take start code as a part of region server recovery, we could inadvertantly try to reassign regions assigned to a restarted server with a different start code</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jimk">Jim Kellerman</assignee>
                                    <reporter username="jimk">Jim Kellerman</reporter>
                        <labels>
                    </labels>
                <created>Tue, 27 Jan 2009 02:55:58 +0000</created>
                <updated>Sun, 13 Sep 2009 22:24:22 +0000</updated>
                            <resolved>Fri, 27 Mar 2009 06:09:28 +0000</resolved>
                                    <version>0.20.0</version>
                                    <fixVersion>0.20.0</fixVersion>
                                    <component>master</component>
                    <component>regionserver</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                            <comments>
                            <comment id="12667570" author="jimk" created="Tue, 27 Jan 2009 03:01:34 +0000"  >&lt;p&gt;As 0.19.x does not allow a server with the same ip:port number to join the cluster until the previous instance has been recovered, this is not an issue for 0.19.x. However, if we intend to allow a new instance of the same server to start serving regions, we need to be able to differentiate between the dead instance and the new one.&lt;/p&gt;

&lt;p&gt;This is my primary reason for making the startcode a part of the regionserver identification.&lt;/p&gt;

&lt;p&gt;While we might use a different mechanism after ZK integration, the ZK integration still needs to account for what instance&lt;br/&gt;
of the regionserver it is dealing with.&lt;/p&gt;</comment>
                            <comment id="12681971" author="jimk" created="Sat, 14 Mar 2009 01:41:03 +0000"  >&lt;p&gt;Passes tests. Committed.&lt;/p&gt;</comment>
                            <comment id="12681994" author="stack" created="Sat, 14 Mar 2009 04:36:43 +0000"  >&lt;p&gt;Just wondering, did you talk w/ the ZKBoys about whether or not ZK already has a mechanism differentiating different regionservers in ZK?&lt;/p&gt;

&lt;p&gt;Above you say &quot;While we might use a different mechanism after ZK integration, the ZK integration still needs to account for what instance of the regionserver it is dealing with.&quot;  How does this patch help the ZK integration effort? &lt;/p&gt;

&lt;p&gt;(I ask because you just made a fairly large commit without general notes on what is in the commit).&lt;/p&gt;</comment>
                            <comment id="12682083" author="jimk" created="Sat, 14 Mar 2009 18:14:16 +0000"  >&lt;p&gt;Sorry, meant to include the list of changes (which I had written down), but forgot. Here they are:&lt;/p&gt;

&lt;p&gt;Summary of change:&lt;/p&gt;

&lt;p&gt;Server name is now hostname_startcode_port so it is unique among multiple instances of a region server running at the same address&lt;/p&gt;

&lt;p&gt;Files changed:&lt;/p&gt;

&lt;p&gt;HServerInfo&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Cache server name once it&apos;s been computed so that subsequent gets of the server name are a simple dereference. This required setServerAddress, setStartCode to be synchronized as well as getServerName.&lt;/li&gt;
	&lt;li&gt;Return a copy of the embedded HServerAddress since an HRegionInfo can get reused and the reference returned can change out from other methods that have stored that reference.&lt;/li&gt;
	&lt;li&gt;Changed hashCode, compareTo to just use the serverName as that is now unique.&lt;/li&gt;
	&lt;li&gt;new static methods to compute serverName given a HServerInfo; hostName (name:port String) and startCode; and one that takes a HServerAddress and startCode.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;HRegionInfo&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Not actually needed for this issue, but I had at one point thought I needed to change it, and when I discarded the change, I left the following in&lt;/li&gt;
	&lt;li&gt;make regionName transient as it is not serialized&lt;/li&gt;
	&lt;li&gt;fix javadoc for parseRegionName, shouldSplit&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;HMaster&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;regionServerStartup can now throw an exception which comes out of ServerManager.regionServerStartup&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;ServerManager&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;remove unused import&lt;/li&gt;
	&lt;li&gt;the key for serversToServerInfo is still a string but is the server name as described above, and not host:port as it was previously. This allows us to distinguish between different instances of a region server at the same address. Zookeeper still uses a ServerExpirer object, but the name is now the server name as described above rather than a host:port pair.&lt;/li&gt;
	&lt;li&gt;removed Boolean from deadServers Map. It was not used and is no longer needed. deadServers is now a set. deadServers is still used to detect a server that has not restarted but reports in after its lease has expired (perhaps due to a network partitioning). It cannot be given work until its existing logs have been recovered.&lt;/li&gt;
	&lt;li&gt;removed checkForGhostReferences. deadServers now handles servers that report back in after lease expiration but have not restarted. Servers that have restarted will have a new server name and can consequently be assigned work immediately.&lt;/li&gt;
	&lt;li&gt;regionServerStartup can now throw Leases.LeaseStillHeldException. Changed String &apos;s&apos; to String &apos;serverName&apos;.&lt;/li&gt;
	&lt;li&gt;regionServerReport can now throw Leases.LeaseStillHeldException.&lt;/li&gt;
	&lt;li&gt;processRegionServerExit, processRegionServerAllsWell, processMsgs, processRegionOpen now take a HServerInfo rather than a string server name&lt;/li&gt;
	&lt;li&gt;processSplitRegion no longer takes either a server name or a serverInfo because they were unused.&lt;/li&gt;
	&lt;li&gt;getServersToServerInfo, getServersToLoad now return a Collections.unmodifyableMap instead of a new HashMap&lt;/li&gt;
	&lt;li&gt;getLoadToServers removed. Unreferenced.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;RegionManager&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;regionsInTransition is now a Map&amp;lt;String, RegionState&amp;gt; instead of Map&amp;lt;byte[], RegionState&amp;gt; key is server name described above&lt;/li&gt;
	&lt;li&gt;assignRegions now just takes an HServerInfo instead of HServerInfo, String as that was redundant and the server name can be obtained from HServerInfo&lt;/li&gt;
	&lt;li&gt;unassignSomeRegions, assignRegionsToOneServer, assignRegionsToMultipleServers take an HServerInfo rather than String&lt;/li&gt;
	&lt;li&gt;regionIsInTransition, regionIsOpening, isPendingOpen, setOpen, isOfflined, setPendingClose, setClosed take String as argument instead of byte[] due to change in regionsInTransition map&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;BaseScanner&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;checkAssigned now composes a server name as described above from serverAddress and startCode. Additionally it no longer needs to compare start codes as ServerManager.getServerInfo uses a server name as described above and since nothing will be found if the names do not match exactly (since the startcode is part of the name) the comparison of start codes is redundant. Finally it calls new static function HLog.getHLogDirectoryName instead of duplicating the code.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;TableOperation&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;now builds a server name as described above to pass to isBeingServed and processScanItem&lt;/li&gt;
	&lt;li&gt;isBeingServed, processScanItem now take a server name as described above rather than host:port and start code&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;ChangeTableState&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;processScanItem now takes a server name as described above rather than host:port and start code&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;ModifyTableMeta&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;added @SuppressWarnings(&quot;unused&quot;) for server name argument in processScanItem&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;TableDelete&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;added @SuppressWarnings(&quot;unused&quot;) for server name argument in processScanItem&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;ColumnOperation&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;added @SuppressWarnings(&quot;unused&quot;) for server name argument in processScanItem&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;ProcessRegionOpen&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;now stores the HServerInfo passed to the constructor rather than the HServerAddress and start code contained therein&lt;/li&gt;
	&lt;li&gt;added if (LOG.isDebugEnabled()) { around LOG.debug calls&lt;/li&gt;
	&lt;li&gt;other changes are related to extracting the HServerAddress and start code fields from the HServerInfo&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;ProcessServerShutdown&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;no longer needs the HServerAddress as it constructs a server name as described above for comparision with entries scanned from meta region.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;HLog&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Added new static methods getHLogDirectoryName that take either a HServerInfo a host:port string and start code or a string which is a server name as described above&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="12683264" author="ryanobjc" created="Thu, 19 Mar 2009 01:00:42 +0000"  >&lt;p&gt;The web UI is broken now.  The web UI has dependencies on the servers to server info map, and the key format has changed but the JSP code has not.&lt;/p&gt;</comment>
                            <comment id="12683284" author="ryanobjc" created="Thu, 19 Mar 2009 02:07:16 +0000"  >&lt;p&gt;the problem seems to be the new serverToServerInfo() map format...&lt;/p&gt;

&lt;p&gt;previously the key was &apos;server:port&apos;.  Now it is: &apos;server_startcode_port&apos;.&lt;/p&gt;

&lt;p&gt;The problem seems to be that the only place one has access to the startcode is if you already have the HServerInfo, which if you did, you wouldn&apos;t need the serversToServerInfo map anyways...&lt;/p&gt;</comment>
                            <comment id="12683317" author="ryanobjc" created="Thu, 19 Mar 2009 04:37:19 +0000"  >&lt;p&gt;here is a proposed patch - the other option is to add a parallel map in addition to serversToServerInfo.  Considering the major purpose of this map is to feed into the JSPs i went with this approach instead.&lt;/p&gt;</comment>
                            <comment id="12683338" author="ryanobjc" created="Thu, 19 Mar 2009 06:25:37 +0000"  >&lt;p&gt;ok the previous approach does not work.  Here is a new patch with the other approach.&lt;/p&gt;</comment>
                            <comment id="12689817" author="jimk" created="Fri, 27 Mar 2009 05:50:06 +0000"  >&lt;p&gt;&amp;gt; ryan rawson added a comment - 18/Mar/09 09:37 PM&lt;br/&gt;
&amp;gt; here is a proposed patch - the other option is to add a parallel map in addition to serversToServerInfo.&lt;br/&gt;
&amp;gt; Considering the major purpose of this map is to feed into the JSPs i went with this approach instead.&lt;/p&gt;

&lt;p&gt;The major purpose of serversToServerinfo is to keep track of which servers are alive.&lt;br/&gt;
This will change as Zookeeper integration expands.&lt;/p&gt;</comment>
                            <comment id="12689820" author="ryanobjc" created="Fri, 27 Mar 2009 06:09:05 +0000"  >&lt;p&gt;have a look at the work i patched in on &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-1290&quot; title=&quot;table.jsp either 500s out or doesnt list the regions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-1290&quot;&gt;&lt;del&gt;HBASE-1290&lt;/del&gt;&lt;/a&gt;, i added a second map to provide data for the JSP.&lt;/p&gt;</comment>
                            <comment id="12689821" author="ryanobjc" created="Fri, 27 Mar 2009 06:09:27 +0000"  >&lt;p&gt;fixed in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-1290&quot; title=&quot;table.jsp either 500s out or doesnt list the regions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-1290&quot;&gt;&lt;del&gt;HBASE-1290&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                            <outwardlinks description="blocks">
                                        <issuelink>
            <issuekey id="12412928">HBASE-1144</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12413319">HBASE-1156</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12413345">HBASE-1158</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12402543" name="HBASE-1157.patch" size="11036" author="ryanobjc" created="Thu, 19 Mar 2009 04:37:18 +0000"/>
                            <attachment id="12402549" name="HBASE-1267-3.patch" size="11650" author="ryanobjc" created="Thu, 19 Mar 2009 06:25:37 +0000"/>
                    </attachments>
                <subtasks>
                            <subtask id="12413319">HBASE-1156</subtask>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sat, 14 Mar 2009 04:36:43 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>25605</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 37 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0hbnz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>99152</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310192" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Release Note</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Part of region server death recovery depends on knowing which instance (start code) of the server being recovered.&lt;br/&gt;
&lt;br/&gt;
If we allow a new instance to join the cluster immediately (desirable) then we must know the difference between regions&lt;br/&gt;
served by a previous instance of a server with the same ipaddress:port and the current instance. We need to have the &lt;br/&gt;
information about the startcode to know the difference.</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>