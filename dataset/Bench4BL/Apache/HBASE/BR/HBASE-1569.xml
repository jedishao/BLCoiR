<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 02 19:27:17 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-1569/HBASE-1569.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-1569] rare race condition can take down a regionserver. </title>
                <link>https://issues.apache.org/jira/browse/HBASE-1569</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;this happened after &amp;gt; 24 hours of heavy import load on my cluster.  Luckily the shutdown seemed to be clean:&lt;/p&gt;

&lt;p&gt;java.lang.IllegalAccessError: Call open first&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.StoreFile.getReader(StoreFile.java:356)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.Store.getStorefilesIndexSize(Store.java:1378)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.HRegionServer.doMetrics(HRegionServer.java:1075)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.HRegionServer.run(HRegionServer.java:454)&lt;br/&gt;
        at java.lang.Thread.run(Thread.java:619)&lt;/p&gt;</description>
                <environment></environment>
        <key id="12428635">HBASE-1569</key>
            <summary>rare race condition can take down a regionserver. </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.png">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="stack">stack</assignee>
                                    <reporter username="ryanobjc">ryan rawson</reporter>
                        <labels>
                    </labels>
                <created>Tue, 23 Jun 2009 07:42:47 +0000</created>
                <updated>Sun, 13 Sep 2009 22:24:46 +0000</updated>
                            <resolved>Thu, 25 Jun 2009 23:57:37 +0000</resolved>
                                    <version>0.20.0</version>
                                    <fixVersion>0.20.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12723002" author="ryanobjc" created="Tue, 23 Jun 2009 08:18:14 +0000"  >&lt;p&gt;this is a race condition, here is how it happens:&lt;/p&gt;

&lt;p&gt;doMetrics() calls getStorefilesIndexSize() which gets a view of the storefiles ConcurrentSkipListMap at some point in time.  Working on this snapshot it calls each store file in turn asking for the index size.&lt;/p&gt;

&lt;p&gt;In another thread, the compaction completion code finishes, first thing it does is:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;remove store files from the storefiles list.&lt;/li&gt;
	&lt;li&gt;do some stuff&lt;/li&gt;
	&lt;li&gt;close the aforementioned store files, which causes the this.reader to become null.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Back in thread #1, we run into the this.reader == null, and we throw the exception.&lt;/p&gt;

&lt;p&gt;So we need to do either of:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;sync on this map, use a synced versin of the map&lt;/li&gt;
	&lt;li&gt;allow the ability to check this metrics without causing a RS abort when we hit an exception.  Either catch it, or prevent it from happening.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="12723361" author="stack" created="Tue, 23 Jun 2009 23:32:41 +0000"  >&lt;p&gt;At first I thought that use of ConcurrentSkipListSet the problem but thinking on it more, rather, we need to make code tolerate fact that a file has been moved or removed.  Alternative is syncing around file operations till they complete which is too much to ask.&lt;/p&gt;

&lt;p&gt;A good while a go, an issue in metrics got HRS stuck in an infinite loop.&lt;/p&gt;

&lt;p&gt;Let me try hack up a patch.&lt;/p&gt;</comment>
                            <comment id="12723387" author="stack" created="Wed, 24 Jun 2009 00:46:27 +0000"  >&lt;p&gt;Unfinished first attempt.&lt;/p&gt;</comment>
                            <comment id="12723437" author="stack" created="Wed, 24 Jun 2009 05:00:13 +0000"  >&lt;p&gt;Patch does following:&lt;/p&gt;

&lt;p&gt;+ Wraps metrics in a try/catch that catches any exception, logs it and then moves on rather than let it out and kill HRS&lt;br/&gt;
+ Changed getReader so it doesn&apos;t do IllegalArgumentException with &quot;must open first&quot; but instead lets out the null Reader.&lt;br/&gt;
+ Then, changed whereever we get a Reader to check for null.  If null log it so we can see extent of phenomeon but in general just keep going.&lt;/p&gt;</comment>
                            <comment id="12723981" author="larsgeorge" created="Thu, 25 Jun 2009 09:49:21 +0000"  >&lt;p&gt;I ran into the same issue, killed the HRS that hosted the ROOT partition. The &quot;Catalog Tables&quot; tbale in the UI was empty afterwards and the running MR job was failing fast. I synced to trunk and applied this patch and restarted the cluster. With the above patch two pieces are failing to update but they were the removed bloomfilter variables and it looks like it was removed in trunk already so no harm done.&lt;/p&gt;

&lt;p&gt;Will report if I run into the new log outputs or if anything else happens.&lt;/p&gt;</comment>
                            <comment id="12724333" author="ryanobjc" created="Thu, 25 Jun 2009 22:54:55 +0000"  >&lt;p&gt;+1 lgtm&lt;/p&gt;</comment>
                            <comment id="12724346" author="stack" created="Thu, 25 Jun 2009 23:57:37 +0000"  >&lt;p&gt;Committed&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12411603" name="1569-v2.patch" size="10908" author="stack" created="Wed, 24 Jun 2009 05:00:13 +0000"/>
                            <attachment id="12411596" name="sf.patch" size="5365" author="stack" created="Wed, 24 Jun 2009 00:46:27 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 23 Jun 2009 23:32:41 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>25834</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 24 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0he13:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>99535</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>