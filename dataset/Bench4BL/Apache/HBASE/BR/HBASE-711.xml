<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 02 18:34:35 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-711/HBASE-711.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-711] Complain if clock skew across the cluster is badly out of sync</title>
                <link>https://issues.apache.org/jira/browse/HBASE-711</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;hbase-710 and hbase-609 are issues where the system has broken in presence of clock skew over the cluster.  Would be a nice service if master could flag very bad clock skew.  Regionservers could report their local time when they ping the master.  It could do a compare.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12399055">HBASE-711</key>
            <summary>Complain if clock skew across the cluster is badly out of sync</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jimk">Jim Kellerman</assignee>
                                    <reporter username="stack">stack</reporter>
                        <labels>
                    </labels>
                <created>Thu, 26 Jun 2008 03:09:35 +0000</created>
                <updated>Tue, 7 Dec 2010 20:34:35 +0000</updated>
                            <resolved>Tue, 7 Dec 2010 20:34:35 +0000</resolved>
                                                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12608501" author="stack" created="Thu, 26 Jun 2008 17:04:54 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-710&quot; title=&quot;If clocks are way off, then we can have daughter split come before rather than after its parent in .META.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-710&quot;&gt;&lt;del&gt;HBASE-710&lt;/del&gt;&lt;/a&gt; now emits on regionserver a warning at split time if difference between parent and daughter regionid/timestamp is such that current time on regionserver is less than parent regionid/timestamp.   This is not sufficient to satisfy this issue but its a start.&lt;/p&gt;</comment>
                            <comment id="12609425" author="jimk" created="Tue, 1 Jul 2008 01:52:30 +0000"  >&lt;p&gt;When the master is in &quot;safe mode&quot;, region servers that check in with a &quot;large&quot; clock skew should shut down, or synchronize their clocks with the master.&lt;/p&gt;</comment>
                            <comment id="12614947" author="viper799" created="Sat, 19 Jul 2008 05:57:33 +0000"  >&lt;p&gt;How about we stored a variable for the skew for the region server?&lt;br/&gt;
Example when the region server checks in with the the master on startup and the master sends back its time and the region server stores the skew form its clock to the master clock? &lt;br/&gt;
We would need to factor this skew in to the internal code that call for timestamp not sure how much work that would be but an idea.&lt;/p&gt;

</comment>
                            <comment id="12615029" author="jimk" created="Sat, 19 Jul 2008 18:00:40 +0000"  >&lt;p&gt;We need to document in the FAQ or somewhere, that servers should be running nntpd (or the equivalent on other platforms)&lt;/p&gt;</comment>
                            <comment id="12615030" author="jdcryans" created="Sat, 19 Jul 2008 18:02:58 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="12615031" author="apurtell" created="Sat, 19 Jul 2008 18:20:29 +0000"  >&lt;p&gt;+1 Definitely not an inconvenience to a professional to require it. Should get prominent mention. Should be one of the first things any competent administrator of a distributed system sets up anyhow. (Assuming I am an example of such a thing &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; )&lt;/p&gt;</comment>
                            <comment id="12615052" author="stack" created="Sat, 19 Jul 2008 21:38:51 +0000"  >&lt;p&gt;Added NTP into the requirements section of the &apos;Gettting Started&apos; documentation.&lt;/p&gt;</comment>
                            <comment id="12620080" author="jimk" created="Tue, 5 Aug 2008 22:59:14 +0000"  >&lt;p&gt;Noting the clock skew won&apos;t work because HRegionInfo constructor uses clock time to set the region name.&lt;/p&gt;

&lt;p&gt;However, do we really need to disambiguate region names with the clock time?&lt;br/&gt;
Since region name = table name + start key + end key, can it ever be the case that you would have two regions with the same name?&lt;/p&gt;</comment>
                            <comment id="12620099" author="jimk" created="Wed, 6 Aug 2008 00:38:08 +0000"  >&lt;p&gt;I was incorrect in previous comment. Currently, region name = table name + start key + region id.&lt;/p&gt;

&lt;p&gt;Proposal: make region name = table name + start key + end key. This would eliminate the need for the region id.&lt;/p&gt;</comment>
                            <comment id="12620392" author="jimk" created="Wed, 6 Aug 2008 19:20:18 +0000"  >&lt;p&gt;Another place we use the current time is in the creation of HLog files.&lt;/p&gt;

&lt;p&gt;Proposal: instead of using the current time, use the current sequence number (with leading zero padding out to some large size so the files still sort properly). The files would still be increasing, and sort properly.&lt;/p&gt;</comment>
                            <comment id="12620397" author="stack" created="Wed, 6 Aug 2008 19:29:28 +0000"  >&lt;p&gt;+1 on the latter suggestion regards HLog names.&lt;/p&gt;

&lt;p&gt;On the renaming of regions to include start/end keys, when region splits, its end-key will be less than that of its parents so daughter will go in ahead of its parent in the meta.  Will this be a problem?  Will it break our getRowAtOrBefore?&lt;/p&gt;</comment>
                            <comment id="12620402" author="jimk" created="Wed, 6 Aug 2008 19:52:09 +0000"  >&lt;p&gt;HRegion plays around with current time to create region names for split children. If we named regions as I have suggested above, this will no longer be necessary.&lt;/p&gt;

&lt;p&gt;All the other references to System.currentTimeMillis() are used for interval computations and so it doesn&apos;t matter if the clock is skewed or not.&lt;/p&gt;</comment>
                            <comment id="12620406" author="stack" created="Wed, 6 Aug 2008 19:57:35 +0000"  >&lt;p&gt;IIUC, region A with key a start key of 10 and an end key of 12 will be named A,10,12.  When it splits, the lower halves new name will be A,10,11 which sorts before A,10,12.  We don&apos;t want that, right?&lt;/p&gt;</comment>
                            <comment id="12620454" author="jimk" created="Wed, 6 Aug 2008 22:24:23 +0000"  >&lt;p&gt;&amp;gt; stack - 06/Aug/08 12:57 PM&lt;/p&gt;

&lt;p&gt;&amp;gt; IIUC, region A with key a start key of 10 and an end key of 12 will be named A,10,12. When it splits, the lower&lt;br/&gt;
&amp;gt; halves new name will be A,10,11 which sorts before A,10,12. We don&apos;t want that, right?&lt;/p&gt;

&lt;p&gt;Yes, this is a problem given that we use getRowAtOrBefore. If we exposed something like getRowAtOrAfter, this would work.. I have been playing around with strategies that do not require additional APIs, but have not been successful in constructing a key that would sort to the right spot if we got a result back that said that the region was split,offline. I think it is do-able, but just don&apos;t have an exact handle on it yet.&lt;/p&gt;</comment>
                            <comment id="12622730" author="jimk" created="Thu, 14 Aug 2008 22:52:35 +0000"  >&lt;p&gt;If we require all the servers to run nntpd (or equivalent) then this should largely be a non-issue with respect to either region names or HLog names.&lt;/p&gt;

&lt;p&gt;The only thing we might want to do is have the master examine the HServerInfo passed from the region server in the regionServerStartup message and if HServerInfo.getStartCode() (which is the time the region server started) is larger than some delta from the master&apos;s current clock time, the master should throw an exception that would cause the region server to shut down.&lt;/p&gt;</comment>
                            <comment id="12622935" author="stack" created="Fri, 15 Aug 2008 17:39:33 +0000"  >&lt;p&gt;FYI, in case you hadn&apos;t seen it, we added this to split code a while back:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
      &lt;span class=&quot;code-comment&quot;&gt;// Calculate regionid to use.  Can&apos;t be less than that of parent &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt;
&lt;/span&gt;      &lt;span class=&quot;code-comment&quot;&gt;// it&apos;ll insert into wrong location over in .META. table: HBASE-710.
&lt;/span&gt;      &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; rid = &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.currentTimeMillis();
      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (rid &amp;lt; &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.regionInfo.getRegionId()) {
        LOG.warn(&lt;span class=&quot;code-quote&quot;&gt;&quot;Clock skew; parent regions id is &quot;&lt;/span&gt; +
          &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.regionInfo.getRegionId() + &lt;span class=&quot;code-quote&quot;&gt;&quot; but current time here is &quot;&lt;/span&gt; + rid);
        rid = &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.regionInfo.getRegionId() + 1;
      }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Makes it so splits always sort after parents whatever the clockskew.&lt;/p&gt;</comment>
                            <comment id="12622940" author="jimk" created="Fri, 15 Aug 2008 17:44:29 +0000"  >&lt;p&gt;Yes, saw that. Coupled with the use of nntpd, this is largely a non-issue. However I thought we could add something to the startup sequence in which:&lt;/p&gt;

&lt;p&gt;&amp;gt; The master examines the HServerInfo passed from the region server in the regionServerStartup message&lt;br/&gt;
&amp;gt; and if HServerInfo.getStartCode() (which is the time the region server started) is larger than some delta&lt;br/&gt;
&amp;gt; from the master&apos;s current clock time, the master should throw an exception that would cause the region&lt;br/&gt;
&amp;gt; server to shut down.&lt;/p&gt;

&lt;p&gt;Think that is necessary? Or should we close this issue as either wontfix or invalid?&lt;/p&gt;</comment>
                            <comment id="12622943" author="stack" created="Fri, 15 Aug 2008 17:49:30 +0000"  >&lt;p&gt;That&apos;d be useful.  Maybe a warning is good enough on master side rather than a shutdown of regionserver since we &lt;b&gt;think&lt;/b&gt; we&apos;re immune to clock skew at this stage.&lt;/p&gt;</comment>
                            <comment id="12643588" author="stack" created="Wed, 29 Oct 2008 18:34:25 +0000"  >&lt;p&gt;Moved out of 0.19.0.&lt;/p&gt;</comment>
                            <comment id="12702591" author="stack" created="Fri, 24 Apr 2009 22:40:30 +0000"  >&lt;p&gt;Moving out of 0.20.0. Non-critical. If a patch shows up before release, we&apos;ll add it.&lt;/p&gt;</comment>
                            <comment id="12968956" author="stack" created="Tue, 7 Dec 2010 20:34:35 +0000"  >&lt;p&gt;Fixed by &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3168&quot; title=&quot;Sanity date and time check when a region server joins the cluster&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3168&quot;&gt;&lt;del&gt;HBASE-3168&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 1 Jul 2008 01:52:30 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>25353</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0h8zb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>98717</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>