<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Thu Dec 01 22:28:30 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-13618/HBASE-13618.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-13618] ReplicationSource is too eager to remove sinks</title>
                <link>https://issues.apache.org/jira/browse/HBASE-13618</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Looking at the replication for some other reason I noticed that the replication source might be a bit too eager to remove sinks from the list of valid sinks.&lt;/p&gt;

&lt;p&gt;The current logic allows a sink to fail N times (default 3) and then it will be remove from the sinks. But note that this failure count is never reduced, so given enough runtime and some network glitches &lt;em&gt;every&lt;/em&gt; sink will eventually be removed. When all sink are removed the source pick new sinks and the counter is set to 0 for all of them.&lt;/p&gt;

&lt;p&gt;I think we should change to reset the counter each time we successfully replicate something to the sink (which proves the sink isn&apos;t dead). Or we could decrease the counter each time we successfully replication, that might be better - if we consistently fail more attempts than we succeed the sink should be removed.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12827135">HBASE-13618</key>
            <summary>ReplicationSource is too eager to remove sinks</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="lhofhansl">Lars Hofhansl</assignee>
                                    <reporter username="lhofhansl">Lars Hofhansl</reporter>
                        <labels>
                    </labels>
                <created>Tue, 5 May 2015 04:03:29 +0000</created>
                <updated>Mon, 31 Aug 2015 22:39:42 +0000</updated>
                            <resolved>Wed, 20 May 2015 18:51:28 +0000</resolved>
                                                    <fixVersion>2.0.0</fixVersion>
                    <fixVersion>0.98.13</fixVersion>
                    <fixVersion>1.0.2</fixVersion>
                    <fixVersion>1.2.0</fixVersion>
                    <fixVersion>1.1.1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                <comments>
                            <comment id="14527880" author="lhofhansl" created="Tue, 5 May 2015 04:21:38 +0000"  >&lt;p&gt;Something as simple as this. Decreases the fail count each time we get a successful replication attempt; avoids bringing the sink count down to 0 before we pick new peers when we have some random blibs.&lt;/p&gt;</comment>
                            <comment id="14529894" author="lhofhansl" created="Wed, 6 May 2015 04:38:03 +0000"  >&lt;p&gt;Comments? Concerns?&lt;/p&gt;

&lt;p&gt;The issue that I am trying to fix is for a long running region server. If over (say) a month we successfully replicated 100000&apos;s of batches across but just three batches fail due to random temporary glitches (maybe we rolling restarted the target cluster a few times), we&apos;ll still remove the sink.&lt;/p&gt;</comment>
                            <comment id="14535941" author="apurtell" created="Fri, 8 May 2015 23:52:50 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="14536968" author="lhofhansl" created="Sun, 10 May 2015 00:25:55 +0000"  >&lt;p&gt;Looking closer now, I think there might be a cocurrency issue (that actually existed before, but this patch might make it more likely to happen)... badReportCounts is not thread safe.&lt;/p&gt;</comment>
                            <comment id="14536970" author="lhofhansl" created="Sun, 10 May 2015 00:31:29 +0000"  >&lt;p&gt;Ah no. All good, access in single threaded through replication source only. Got confused by another patch I am working on.&lt;/p&gt;</comment>
                            <comment id="14536978" author="lhofhansl" created="Sun, 10 May 2015 00:53:22 +0000"  >&lt;p&gt;I like -v2 better since it simplifies the success code a bit.&lt;br/&gt;
Instead of decreasing the fail counter, a success resets the counter.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=apurtell&quot; class=&quot;user-hover&quot; rel=&quot;apurtell&quot;&gt;Andrew Purtell&lt;/a&gt;, can you have a quick look again?&lt;/p&gt;</comment>
                            <comment id="14538176" author="apurtell" created="Mon, 11 May 2015 17:01:39 +0000"  >&lt;blockquote&gt;&lt;p&gt;Instead of decreasing the fail counter, a success resets the counter.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;+1&lt;/p&gt;

&lt;p&gt;Simpler. Better.&lt;/p&gt;</comment>
                            <comment id="14541299" author="lhofhansl" created="Wed, 13 May 2015 04:33:45 +0000"  >&lt;p&gt;Committed to world-0.94.&lt;br/&gt;
Thanks for having a look &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=apurtell&quot; class=&quot;user-hover&quot; rel=&quot;apurtell&quot;&gt;Andrew Purtell&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14541387" author="hudson" created="Wed, 13 May 2015 05:44:04 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-0.98-on-Hadoop-1.1 #938 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.98-on-Hadoop-1.1/938/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.98-on-Hadoop-1.1/938/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13618&quot; title=&quot;ReplicationSource is too eager to remove sinks&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13618&quot;&gt;&lt;del&gt;HBASE-13618&lt;/del&gt;&lt;/a&gt; ReplicationSource is too eager to remove sinks. (larsh: rev 2c02724c7b3369eac4a5acfe74de1c5fad8e005f)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/replication/regionserver/HBaseInterClusterReplicationEndpoint.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSinkManager.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/replication/regionserver/TestReplicationSinkManager.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14541407" author="hudson" created="Wed, 13 May 2015 05:56:57 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-1.1 #486 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-1.1/486/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-1.1/486/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13618&quot; title=&quot;ReplicationSource is too eager to remove sinks&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13618&quot;&gt;&lt;del&gt;HBASE-13618&lt;/del&gt;&lt;/a&gt; ReplicationSource is too eager to remove sinks. (larsh: rev 45c91e2149e7ae4e2f594ddd91c1cfd6acc3037b)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/replication/regionserver/TestReplicationSinkManager.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSinkManager.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/replication/regionserver/HBaseInterClusterReplicationEndpoint.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14541419" author="hudson" created="Wed, 13 May 2015 06:06:18 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-1.0 #913 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-1.0/913/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-1.0/913/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13618&quot; title=&quot;ReplicationSource is too eager to remove sinks&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13618&quot;&gt;&lt;del&gt;HBASE-13618&lt;/del&gt;&lt;/a&gt; ReplicationSource is too eager to remove sinks. (larsh: rev 2ea7394c91db5e48b1164119f8d94954f545f73b)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/replication/regionserver/HBaseInterClusterReplicationEndpoint.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSinkManager.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/replication/regionserver/TestReplicationSinkManager.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14541479" author="hudson" created="Wed, 13 May 2015 06:56:22 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-1.2 #77 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-1.2/77/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-1.2/77/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13618&quot; title=&quot;ReplicationSource is too eager to remove sinks&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13618&quot;&gt;&lt;del&gt;HBASE-13618&lt;/del&gt;&lt;/a&gt; ReplicationSource is too eager to remove sinks. (larsh: rev 34327408c1fa5080a2f3c2ae45784cf0af911c4c)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/replication/regionserver/TestReplicationSinkManager.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/replication/regionserver/HBaseInterClusterReplicationEndpoint.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSinkManager.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14541511" author="hudson" created="Wed, 13 May 2015 07:25:41 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-TRUNK #6480 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/6480/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/6480/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13618&quot; title=&quot;ReplicationSource is too eager to remove sinks&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13618&quot;&gt;&lt;del&gt;HBASE-13618&lt;/del&gt;&lt;/a&gt; ReplicationSource is too eager to remove sinks. (larsh: rev 220ac141bfcea7798faa5f73295ec61d8b173af9)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/replication/regionserver/TestReplicationSinkManager.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSinkManager.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/replication/regionserver/HBaseInterClusterReplicationEndpoint.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14541658" author="hudson" created="Wed, 13 May 2015 09:36:28 +0000"  >&lt;p&gt;SUCCESS: Integrated in HBase-0.98 #987 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.98/987/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.98/987/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13618&quot; title=&quot;ReplicationSource is too eager to remove sinks&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13618&quot;&gt;&lt;del&gt;HBASE-13618&lt;/del&gt;&lt;/a&gt; ReplicationSource is too eager to remove sinks. (larsh: rev 2c02724c7b3369eac4a5acfe74de1c5fad8e005f)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSinkManager.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/replication/regionserver/TestReplicationSinkManager.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/replication/regionserver/HBaseInterClusterReplicationEndpoint.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14552861" author="enis" created="Wed, 20 May 2015 18:51:28 +0000"  >&lt;p&gt;Changed resolution to Fixed. &lt;/p&gt;</comment>
                            <comment id="14724243" author="enis" created="Mon, 31 Aug 2015 22:39:42 +0000"  >&lt;p&gt;Closing this issue after 1.0.2 release.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12731762" name="13618-v2.txt" size="4458" author="lhofhansl" created="Sun, 10 May 2015 00:53:22 +0000"/>
                            <attachment id="12730362" name="13618.txt" size="4488" author="lhofhansl" created="Tue, 5 May 2015 04:21:38 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 8 May 2015 23:52:50 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 13 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2ea4v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>