<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Thu Dec 01 21:13:30 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-13877/HBASE-13877.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-13877] Interrupt to flush from TableFlushProcedure causes dataloss in ITBLL</title>
                <link>https://issues.apache.org/jira/browse/HBASE-13877</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;ITBLL with 1.25B rows failed for me (and Stack as reported in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13811?focusedCommentId=14577834&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14577834&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-13811?focusedCommentId=14577834&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14577834&lt;/a&gt;) &lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13811&quot; title=&quot;Splitting WALs, we are filtering out too many edits -&amp;gt; DATALOSS&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13811&quot;&gt;&lt;del&gt;HBASE-13811&lt;/del&gt;&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13853&quot; title=&quot;ITBLL improvements after HBASE-13811&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13853&quot;&gt;&lt;del&gt;HBASE-13853&lt;/del&gt;&lt;/a&gt; fixed an issue with WAL edit filtering. &lt;/p&gt;

&lt;p&gt;The root cause this time seems to be different. It is due to procedure based flush interrupting the flush request in case the procedure is cancelled from an exception elsewhere. This leaves the memstore snapshot intact without aborting the server. The next flush, then flushes the previous memstore with the current seqId (as opposed to seqId from the memstore snapshot). This creates an hfile with larger seqId than what its contents are. Previous behavior in 0.98 and 1.0 (I believe) is that after flush prepare and interruption / exception will cause RS abort.&lt;/p&gt;
</description>
                <environment></environment>
        <key id="12836673">HBASE-13877</key>
            <summary>Interrupt to flush from TableFlushProcedure causes dataloss in ITBLL</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.png">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="enis">Enis Soztutar</assignee>
                                    <reporter username="enis">Enis Soztutar</reporter>
                        <labels>
                    </labels>
                <created>Tue, 9 Jun 2015 22:01:58 +0000</created>
                <updated>Thu, 17 Dec 2015 23:45:00 +0000</updated>
                            <resolved>Wed, 17 Jun 2015 19:23:17 +0000</resolved>
                                                    <fixVersion>2.0.0</fixVersion>
                    <fixVersion>0.98.14</fixVersion>
                    <fixVersion>1.0.2</fixVersion>
                    <fixVersion>1.2.0</fixVersion>
                    <fixVersion>1.1.1</fixVersion>
                                    <component>integration tests</component>
                    <component>proc-v2</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>10</watches>
                                                                <comments>
                            <comment id="14579669" author="stack" created="Tue, 9 Jun 2015 22:25:43 +0000"  >&lt;p&gt;Nice one &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=enis&quot; class=&quot;user-hover&quot; rel=&quot;enis&quot;&gt;Enis Soztutar&lt;/a&gt; A run of 1B just passed for me.... will hold on running more tests till you have a patch to test.&lt;/p&gt;</comment>
                            <comment id="14579697" author="enis" created="Tue, 9 Jun 2015 22:38:19 +0000"  >&lt;p&gt;ITBLL Search job finds the missing keys in this WAL file: &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2015-06-09 11:25:47,659 INFO [main] org.apache.hadoop.mapred.MapTask: Processing split: hdfs:&lt;span class=&quot;code-comment&quot;&gt;//cn011.l42scl.hortonworks.com:8020/apps/hbase/data/oldWALs/cn012.l42scl.hortonworks.com%2C16020%2C1433836445051.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;.1433836858473 (-9223372036854775808:9223372036854775807) length:136606270
&lt;/span&gt;2015-06-09 11:25:47,678 INFO [main] org.apache.hadoop.hbase.mapreduce.WALInputFormat: Opening reader &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; hdfs:&lt;span class=&quot;code-comment&quot;&gt;//cn011.l42scl.hortonworks.com:8020/apps/hbase/data/oldWALs/cn012.l42scl.hortonworks.com%2C16020%2C1433836445051.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;.1433836858473 (-9223372036854775808:9223372036854775807) length:136606270
&lt;/span&gt;2015-06-09 11:25:48,889 INFO [main] org.apache.hadoop.hbase.test.IntegrationTestBigLinkedList$Search: Loaded keys to find: count=81027
2015-06-09 11:25:49,510 INFO [main] org.apache.hadoop.hbase.test.IntegrationTestBigLinkedList$Search: Found cell=c\xEA\xC7\xDC\x16\xA8\x0A\x08\xE0\x18\xE8p\xF8\x0A)5/meta:prev/1433836859261/Put/vlen=16/seqid=0
2015-06-09 11:25:49,522 INFO [main] org.apache.hadoop.hbase.test.IntegrationTestBigLinkedList$Search: Found cell=c\xEA\xC7\xDC\x16\xA8\x0A\x08\xE0\x18\xE8p\xF8\x0A)5/meta:count/1433836859261/Put/vlen=8/seqid=0
2015-06-09 11:25:49,523 INFO [main] org.apache.hadoop.hbase.test.IntegrationTestBigLinkedList$Search: Found cell=c\xEA\xC7\xDC\x16\xA8\x0A\x08\xE0\x18\xE8p\xF8\x0A)5/meta:client/1433836859261/Put/vlen=71/seqid=0
2015-06-09 11:25:49,524 INFO [main] org.apache.hadoop.hbase.test.IntegrationTestBigLinkedList$Search: Found cell=^\x04\xD2\x18T\x13\xA2\x83~N&amp;lt;\xD5\xA0\xECU\xEE/meta:prev/1433836859261/Put/vlen=16/seqid=0
2015-06-09 11:25:49,525 INFO [main] org.apache.hadoop.hbase.test.IntegrationTestBigLinkedList$Search: Found cell=^\x04\xD2\x18T\x13\xA2\x83~N&amp;lt;\xD5\xA0\xECU\xEE/meta:count/1433836859261/Put/vlen=8/seqid=0
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;That particular WAL file have the missing keys at Sequence=82053: &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
First missing: 
Sequence=82053 , region=acddcb7f27d64872b021900ad063f453 at write timestamp=Tue Jun 09 01:00:59 PDT 2015
row=c\xEA\xC7\xDC\x16\xA8\x0A\x08\xE0\x18\xE8p\xF8\x0A)5, column=meta:prev
    value: \x06\xA9)\xEF\x9D]~\x1C\x01b\xB4\x9E\x9D\x5Cv\x5C
row=c\xEA\xC7\xDC\x16\xA8\x0A\x08\xE0\x18\xE8p\xF8\x0A)5, column=meta:count
    value: \x00\x00\x00\x00\x01&amp;lt;\x04y
row=c\xEA\xC7\xDC\x16\xA8\x0A\x08\xE0\x18\xE8p\xF8\x0A)5, column=meta:client
    value: Job: job_1432937636181_0080 Task: attempt_1432937636181_0080_m_000003_0
row=^\x04\xD2\x18T\x13\xA2\x83~N&amp;lt;\xD5\xA0\xECU\xEE, column=meta:prev
    value: \xFD\xDE\xC9\xD6\xE4qU&quot;\x8A\x92){\x15\xC7\x1F3
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The same file also have non-missing keys with earlier seqIds for the same region &lt;tt&gt;acddcb7f27d64872b021900ad063f453&lt;/tt&gt;: &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Sequence=81992 , region=acddcb7f27d64872b021900ad063f453 at write timestamp=Tue Jun 09 01:00:58 PDT 2015
Sequence=81994 , region=acddcb7f27d64872b021900ad063f453 at write timestamp=Tue Jun 09 01:00:58 PDT 2015
...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Last non missing:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Sequence=82042 , region=acddcb7f27d64872b021900ad063f453 at write timestamp=Tue Jun 09 01:00:59 PDT 2015
row=Y\x99\x99\x99\x99\x99\x99\x94, column=METAFAMILY:HBASE::FLUSH
    value: \x08\x00\x12\x1CIntegrationTestBigLinkedList\x1A acddcb7f27d64872b021900ad063f453 \xF9\x80\x05*\x0E\x0A\x05ErkuW\x12\x05ErkuW*\x0A\x0A\x03big\x12\x03big*\x0E\x0A\x05fcSFt\x12\x05fcSFt*\x0C\x0
A\x04meta\x12\x04meta*\x0C\x0A\x04tiny\x12\x04tiny2UIntegrationTestBigLinkedList,Y\x99\x99\x99\x99\x99\x99\x94,1433835414361.acddcb7f27d64872b021900ad063f453.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;As you can see, for this region &lt;tt&gt;acddcb7f27d64872b021900ad063f453&lt;/tt&gt;, we have the keys with seqId up to 82042, but we miss some of the keys with seqid 82053+. &lt;/p&gt;

&lt;p&gt;Looking at the WAL splitting, it seems that everything below seqId 82627 is skipped: &lt;br/&gt;
Master:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2015-06-09 01:02:13,296 INFO  [RS_LOG_REPLAY_OPS-cn015:16020-1] wal.WALSplitter: Splitting wal: hdfs:&lt;span class=&quot;code-comment&quot;&gt;//cn011.l42scl.hortonworks.com:8020/apps/hbase/data/WALs/cn012.l42scl.hortonworks.com,16020,1433836445051-splitting/cn012.l42scl.hortonworks.com%2C16020%2C1433836445051.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;.1433836858473, length=136606270
&lt;/span&gt;2015-06-09 01:02:14,103 INFO  [RS_LOG_REPLAY_OPS-cn015:16020-1] wal.WALSplitter: Processed 247 edits across 3 regions; edits skipped=3210; log file=hdfs:&lt;span class=&quot;code-comment&quot;&gt;//cn011.l42scl.hortonworks.com:8020/apps/hbase/data/WALs/cn012.l42scl.hortonworks.com,16020,1433836445051-splitting/cn012.l42scl.hortonworks.com%2C16020%2C1433836445051.&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;.1433836858473, length=136606270, corrupted=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, progress failed=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Earliest recovered.edits: &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2015-06-09 01:02:12,152 DEBUG [split-log-closeStream-2] wal.WALSplitter: Closed wap hdfs:&lt;span class=&quot;code-comment&quot;&gt;//cn011.l42scl.hortonworks.com:8020/apps/hbase/data/data/&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/IntegrationTestBigLinkedList/acddcb7f27d64872b021900ad063f453/recovered.edits/0000000000000082627.temp (wrote 12 edits, skipped 0 edits in 17ms
&lt;/span&gt;2015-06-09 01:02:12,332 INFO  [split-log-closeStream-2] wal.WALSplitter: Rename hdfs:&lt;span class=&quot;code-comment&quot;&gt;//cn011.l42scl.hortonworks.com:8020/apps/hbase/data/data/&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/IntegrationTestBigLinkedList/acddcb7f27d64872b021900ad063f453/recovered.edits/0000000000000082627.temp to hdfs://cn011.l42scl.hortonworks.com:8020/apps/hbase/data/data/&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/IntegrationTestBigLinkedList/acddcb7f27d64872b021900ad063f453/recovered.edits/0000000000000082650&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This filtering is the correct behavior since it seems that we have done a flush with seqid=82626 earlier: &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2015-06-09 01:01:13,274 INFO  [rs(cn012.l42scl.hortonworks.com,16020,1433836445051)-flush-proc-pool7-thread-1] regionserver.DefaultStoreFlusher: Flushed, sequenceid=82626, memsize=280.7 M, hasBloomFilter=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, into tmp file hdfs:&lt;span class=&quot;code-comment&quot;&gt;//cn011.l42scl.hortonworks.com:8020/apps/hbase/data/data/&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/IntegrationTestBigLinkedList/acddcb7f27d64872b021900ad063f453/.tmp/26d0cfddc2a242f396447e51629bf74e&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;However, looking at the contents of this hfile &lt;tt&gt;26d0cfddc2a242f396447e51629bf74e&lt;/tt&gt;, we can find only cells with seqIds in the range of 78284 to 82040. &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
hbase hfile -p -f hdfs:&lt;span class=&quot;code-comment&quot;&gt;//cn011.l42scl.hortonworks.com:8020/apps/hbase/data/archive/data/&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/IntegrationTestBigLinkedList/acddcb7f27d64872b021900ad063f453/meta/26d0cfddc2a242f396447e51629bf74e | grep &lt;span class=&quot;code-quote&quot;&gt;&quot;seqid=&quot;&lt;/span&gt; | cut -d &lt;span class=&quot;code-quote&quot;&gt;&quot;/&quot;&lt;/span&gt; -f 6 |  cut -f 2 -d &lt;span class=&quot;code-quote&quot;&gt;&quot;=&quot;&lt;/span&gt; | cut -f 1 -d &lt;span class=&quot;code-quote&quot;&gt;&quot; &quot;&lt;/span&gt; | sort | less&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;However, the hfile metadata says that the file has a maxSeqId of 82626: &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
hbase hfile -m -f hdfs:&lt;span class=&quot;code-comment&quot;&gt;//cn011.l42scl.hortonworks.com:8020/apps/hbase/data/archive/data/&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/IntegrationTestBigLinkedList/acddcb7f27d64872b021900ad063f453/meta/26d0cfddc2a242f396447e51629bf74e
&lt;/span&gt;...
Fileinfo:
    DATA_BLOCK_ENCODING = DIFF
    DELETE_FAMILY_COUNT = \x00\x00\x00\x00\x00\x00\x00\x00
    EARLIEST_PUT_TS = \x00\x00\x01M\xD7UG\xFF
    KEY_VALUE_VERSION = \x00\x00\x00\x01
    MAJOR_COMPACTION_KEY = \x00
    MAX_MEMSTORE_TS_KEY = \x00\x00\x00\x00\x00\x01@x
    MAX_SEQ_ID_KEY = 82626
...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;As you can see, the missing keys range from 82053 - 82626, so the difference in this hfiles contents and missing keys fits perfectly. &lt;/p&gt;

&lt;p&gt;The flush writing this hfile with seqId=82626 complains about &lt;tt&gt;Snapshot called again without clearing previous&lt;/tt&gt;: &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2015-06-09 01:00:59,552 DEBUG [B.defaultRpcServer.handler=2,queue=2,port=16020] regionserver.HRegion: Flush requested on IntegrationTestBigLinkedList,Y\x99\x99\x99\x99\x99\x99\x94,1433835414361.acddcb7f27d64872b021900ad063f453.
2015-06-09 01:01:06,776 DEBUG [rs(cn012.l42scl.hortonworks.com,16020,1433836445051)-flush-proc-pool7-thread-1] flush.FlushTableSubprocedure: Flush region IntegrationTestBigLinkedList,Y\x99\x99\x99\x99\x99\x99\x94,1433835414361.acddcb7f27d64872b021900ad063f453. started...
2015-06-09 01:01:06,776 INFO  [rs(cn012.l42scl.hortonworks.com,16020,1433836445051)-flush-proc-pool7-thread-1] regionserver.HRegion: Started memstore flush &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; IntegrationTestBigLinkedList,Y\x99\x99\x99\x99\x99\x99\x94,1433835414361.acddcb7f27d64872b021900ad063f453., current region memstore size 328.90 MB, and 5/5 column families&apos; memstores are being flushed.
2015-06-09 01:01:13,274 INFO  [rs(cn012.l42scl.hortonworks.com,16020,1433836445051)-flush-proc-pool7-thread-1] regionserver.DefaultStoreFlusher: Flushed, sequenceid=82626, memsize=280.7 M, hasBloomFilter=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, into tmp file hdfs:&lt;span class=&quot;code-comment&quot;&gt;//cn011.l42scl.hortonworks.com:8020/apps/hbase/data/data/&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/IntegrationTestBigLinkedList/acddcb7f27d64872b021900ad063f453/.tmp/26d0cfddc2a242f396447e51629bf74e
&lt;/span&gt;2015-06-09 01:01:06,787 WARN  [rs(cn012.l42scl.hortonworks.com,16020,1433836445051)-flush-proc-pool7-thread-1] regionserver.DefaultMemStore: Snapshot called again without clearing previous. Doing nothing. Another ongoing flush or did we fail last attempt?
2015-06-09 01:01:13,294 INFO  [rs(cn012.l42scl.hortonworks.com,16020,1433836445051)-flush-proc-pool7-thread-1] regionserver.HStore: Added hdfs:&lt;span class=&quot;code-comment&quot;&gt;//cn011.l42scl.hortonworks.com:8020/apps/hbase/data/data/&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/IntegrationTestBigLinkedList/acddcb7f27d64872b021900ad063f453/meta/26d0cfddc2a242f396447e51629bf74e, entries=1414983, sequenceid=82626, filesize=69.4 M&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Now, coming to the fun part. Going back to earlier in the RS log, an earlier flush attempt from &lt;tt&gt;FlushTableSubprocedure&lt;/tt&gt; was cancelled and it left the memstore snapshot not being cleared: &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2015-06-09 01:00:28,239 DEBUG [B.defaultRpcServer.handler=4,queue=4,port=16020] regionserver.HRegion: Flush requested on IntegrationTestBigLinkedList,Y\x99\x99\x99\x99\x99\x99\x94,1433835414361.acddcb7f27d64872b021900ad063f453.
2015-06-09 01:00:28,239 WARN  [MemStoreFlusher.1] regionserver.MemStoreFlusher: Region IntegrationTestBigLinkedList,Y\x99\x99\x99\x99\x99\x99\x94,1433835414361.acddcb7f27d64872b021900ad063f453. has too many store files; delaying flush up to 90000ms
2015-06-09 01:00:59,197 DEBUG [rs(cn012.l42scl.hortonworks.com,16020,1433836445051)-flush-proc-pool6-thread-1] flush.FlushTableSubprocedure: Starting region operation on IntegrationTestBigLinkedList,Y\x99\x99\x99\x99\x99\x99\x94,1433835414361.acddcb7f27d64872b021900ad063f453.
2015-06-09 01:00:59,198 DEBUG [rs(cn012.l42scl.hortonworks.com,16020,1433836445051)-flush-proc-pool6-thread-1] flush.FlushTableSubprocedure: Flush region IntegrationTestBigLinkedList,Y\x99\x99\x99\x99\x99\x99\x94,1433835414361.acddcb7f27d64872b021900ad063f453. started...
2015-06-09 01:00:59,199 INFO  [rs(cn012.l42scl.hortonworks.com,16020,1433836445051)-flush-proc-pool6-thread-1] regionserver.HRegion: Started memstore flush &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; IntegrationTestBigLinkedList,Y\x99\x99\x99\x99\x99\x99\x94,1433835414361.acddcb7f27d64872b021900ad063f453., current region memstore size 280.68 MB, and 5/5 column families&apos; memstores are being flushed.
2015-06-09 01:00:59,520 WARN  [rs(cn012.l42scl.hortonworks.com,16020,1433836445051)-flush-proc-pool6-thread-1] wal.FSHLog: Interrupted
java.lang.InterruptedException
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;.wait(Native Method)
        at org.apache.hadoop.hbase.regionserver.wal.SyncFuture.get(SyncFuture.java:167)
        at org.apache.hadoop.hbase.regionserver.wal.FSHLog.blockOnSync(FSHLog.java:1472)
        at org.apache.hadoop.hbase.regionserver.wal.FSHLog.publishSyncThenBlockOnCompletion(FSHLog.java:1466)
        at org.apache.hadoop.hbase.regionserver.wal.FSHLog.sync(FSHLog.java:1585)
        at org.apache.hadoop.hbase.regionserver.HRegion.internalPrepareFlushCache(HRegion.java:2205)
        at org.apache.hadoop.hbase.regionserver.HRegion.internalFlushcache(HRegion.java:2029)
        at org.apache.hadoop.hbase.regionserver.HRegion.internalFlushcache(HRegion.java:1994)
        at org.apache.hadoop.hbase.regionserver.HRegion.flushcache(HRegion.java:1886)
        at org.apache.hadoop.hbase.regionserver.HRegion.flush(HRegion.java:1813)
        at org.apache.hadoop.hbase.procedure.flush.FlushTableSubprocedure$RegionFlushTask.call(FlushTableSubprocedure.java:69)
        at org.apache.hadoop.hbase.procedure.flush.FlushTableSubprocedure$RegionFlushTask.call(FlushTableSubprocedure.java:57)
        at java.util.concurrent.FutureTask.run(FutureTask.java:262)
        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:471)
        at java.util.concurrent.FutureTask.run(FutureTask.java:262)
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745)
2015-06-09 01:00:59,521 WARN  [rs(cn012.l42scl.hortonworks.com,16020,1433836445051)-flush-proc-pool6-thread-1] regionserver.HRegion: Unexpected exception &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; wal.sync(), ignoring. Exception: java.io.InterruptedIOException
        at org.apache.hadoop.hbase.regionserver.wal.FSHLog.convertInterruptedExceptionToIOException(FSHLog.java:1484)
        at org.apache.hadoop.hbase.regionserver.wal.FSHLog.blockOnSync(FSHLog.java:1476)
        at org.apache.hadoop.hbase.regionserver.wal.FSHLog.publishSyncThenBlockOnCompletion(FSHLog.java:1466)
        at org.apache.hadoop.hbase.regionserver.wal.FSHLog.sync(FSHLog.java:1585)
        at org.apache.hadoop.hbase.regionserver.HRegion.internalPrepareFlushCache(HRegion.java:2205)
        at org.apache.hadoop.hbase.regionserver.HRegion.internalFlushcache(HRegion.java:2029)
        at org.apache.hadoop.hbase.regionserver.HRegion.internalFlushcache(HRegion.java:1994)
        at org.apache.hadoop.hbase.regionserver.HRegion.flushcache(HRegion.java:1886)
        at org.apache.hadoop.hbase.regionserver.HRegion.flush(HRegion.java:1813)
        at org.apache.hadoop.hbase.procedure.flush.FlushTableSubprocedure$RegionFlushTask.call(FlushTableSubprocedure.java:69)
        at org.apache.hadoop.hbase.procedure.flush.FlushTableSubprocedure$RegionFlushTask.call(FlushTableSubprocedure.java:57)
        at java.util.concurrent.FutureTask.run(FutureTask.java:262)
        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:471)
        at java.util.concurrent.FutureTask.run(FutureTask.java:262)
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745)
Caused by: java.lang.InterruptedException
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;.wait(Native Method)
        at org.apache.hadoop.hbase.regionserver.wal.SyncFuture.get(SyncFuture.java:167)
        at org.apache.hadoop.hbase.regionserver.wal.FSHLog.blockOnSync(FSHLog.java:1472)
        ... 15 more
2015-06-09 01:00:59,522 WARN  [rs(cn012.l42scl.hortonworks.com,16020,1433836445051)-flush-proc-pool6-thread-1] ipc.Client: interrupted waiting to send rpc request to server
java.lang.InterruptedException
        at java.util.concurrent.FutureTask.awaitDone(FutureTask.java:400)
        at java.util.concurrent.FutureTask.get(FutureTask.java:187)
        at org.apache.hadoop.ipc.Client$Connection.sendRpcRequest(Client.java:1046)
        at org.apache.hadoop.ipc.Client.call(Client.java:1441)
        at org.apache.hadoop.ipc.Client.call(Client.java:1399)
        at org.apache.hadoop.ipc.ProtobufRpcEngine$Invoker.invoke(ProtobufRpcEngine.java:232)
        at com.sun.proxy.$Proxy19.getFileInfo(Unknown Source)
        at org.apache.hadoop.hdfs.protocolPB.ClientNamenodeProtocolTranslatorPB.getFileInfo(ClientNamenodeProtocolTranslatorPB.java:752)
        at sun.reflect.GeneratedMethodAccessor8.invoke(Unknown Source)
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
        at java.lang.reflect.Method.invoke(Method.java:606)
        at org.apache.hadoop.io.retry.RetryInvocationHandler.invokeMethod(RetryInvocationHandler.java:187)
        at org.apache.hadoop.io.retry.RetryInvocationHandler.invoke(RetryInvocationHandler.java:102)
        at com.sun.proxy.$Proxy20.getFileInfo(Unknown Source)
        at sun.reflect.GeneratedMethodAccessor8.invoke(Unknown Source)
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
        at java.lang.reflect.Method.invoke(Method.java:606)
        at org.apache.hadoop.hbase.fs.HFileSystem$1.invoke(HFileSystem.java:279)
        at com.sun.proxy.$Proxy21.getFileInfo(Unknown Source)
        at org.apache.hadoop.hdfs.DFSClient.getFileInfo(DFSClient.java:1988)
        at org.apache.hadoop.hdfs.DistributedFileSystem$18.doCall(DistributedFileSystem.java:1118)
        at org.apache.hadoop.hdfs.DistributedFileSystem$18.doCall(DistributedFileSystem.java:1114)
        at org.apache.hadoop.fs.FileSystemLinkResolver.resolve(FileSystemLinkResolver.java:81)
        at org.apache.hadoop.hdfs.DistributedFileSystem.getFileStatus(DistributedFileSystem.java:1114)
        at org.apache.hadoop.fs.FilterFileSystem.getFileStatus(FilterFileSystem.java:409)
        at org.apache.hadoop.fs.FileSystem.exists(FileSystem.java:1400)
        at org.apache.hadoop.hbase.regionserver.StoreFile$WriterBuilder.build(StoreFile.java:629)
        at org.apache.hadoop.hbase.regionserver.HStore.createWriterInTmp(HStore.java:1007)
        at org.apache.hadoop.hbase.regionserver.DefaultStoreFlusher.flushSnapshot(DefaultStoreFlusher.java:66)
        at org.apache.hadoop.hbase.regionserver.HStore.flushCache(HStore.java:920)
        at org.apache.hadoop.hbase.regionserver.HStore$StoreFlusherImpl.flushCache(HStore.java:2192)
        at org.apache.hadoop.hbase.regionserver.HRegion.internalFlushCacheAndCommit(HRegion.java:2282)
        at org.apache.hadoop.hbase.regionserver.HRegion.internalFlushcache(HRegion.java:2032)
        at org.apache.hadoop.hbase.regionserver.HRegion.internalFlushcache(HRegion.java:1994)
        at org.apache.hadoop.hbase.regionserver.HRegion.flushcache(HRegion.java:1886)
        at org.apache.hadoop.hbase.regionserver.HRegion.flush(HRegion.java:1813)
        at org.apache.hadoop.hbase.procedure.flush.FlushTableSubprocedure$RegionFlushTask.call(FlushTableSubprocedure.java:69)
        at org.apache.hadoop.hbase.procedure.flush.FlushTableSubprocedure$RegionFlushTask.call(FlushTableSubprocedure.java:57)
        at java.util.concurrent.FutureTask.run(FutureTask.java:262)
        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:471)
        at java.util.concurrent.FutureTask.run(FutureTask.java:262)
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;So it seems that the interrupt from &lt;tt&gt;FlushTableSubprocedure&lt;/tt&gt; causes the flush to abort after the prepare step. This leaves the memstore snapshot to be left there. A later attempt to flush, then uses the same snapshot (see &lt;tt&gt;Snapshot called again without clearing previous&lt;/tt&gt; above), but obtains the next seqId from the region: &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
          flushOpSeqId = getNextSequenceId(wal);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This flushes entries in the non-cleared snapshot with seqIds in range 78284-82040, but does not persist entries with seqId 82053 - 82626. However, since the flushOpSeqId is obtained from regions next seqId, the entries are written with 82626. &lt;/p&gt;
</comment>
                            <comment id="14579720" author="enis" created="Tue, 9 Jun 2015 23:08:19 +0000"  >&lt;p&gt;How about this? &lt;/p&gt;</comment>
                            <comment id="14579723" author="enis" created="Tue, 9 Jun 2015 23:11:08 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jinghe&quot; class=&quot;user-hover&quot; rel=&quot;jinghe&quot;&gt;Jerry He&lt;/a&gt; mind taking a look? I&apos;ll run ITBLL with this in the mean time. &lt;/p&gt;</comment>
                            <comment id="14579733" author="hadoopqa" created="Tue, 9 Jun 2015 23:18:53 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12738692/hbase-13877_v1.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12738692/hbase-13877_v1.patch&lt;/a&gt;&lt;br/&gt;
  against master branch at commit 14fe23254a78c52bdaef0da819268c8b405059cb.&lt;br/&gt;
  ATTACHMENT ID: 12738692&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 patch&lt;/font&gt;.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14353//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14353//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14579737" author="stack" created="Tue, 9 Jun 2015 23:19:44 +0000"  >&lt;p&gt;That was a fun read &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=enis&quot; class=&quot;user-hover&quot; rel=&quot;enis&quot;&gt;Enis Soztutar&lt;/a&gt; (smile)&lt;/p&gt;

&lt;p&gt;Patch looks good to me.  Let me set up a test with it overnight.&lt;/p&gt;
</comment>
                            <comment id="14579743" author="stack" created="Tue, 9 Jun 2015 23:24:35 +0000"  >&lt;p&gt;Why bother giving an option on whether interruptible on the stop method in the procedure?  There is no other caller?  Just call shutdown rather than shutdownNow?&lt;/p&gt;</comment>
                            <comment id="14579761" author="enis" created="Tue, 9 Jun 2015 23:47:50 +0000"  >&lt;blockquote&gt;&lt;p&gt;Patch looks good to me. Let me set up a test with it overnight.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Thanks Stack. That would be awesome. &lt;/p&gt;</comment>
                            <comment id="14579764" author="enis" created="Tue, 9 Jun 2015 23:50:58 +0000"  >&lt;blockquote&gt;&lt;p&gt;There is no other caller? Just call shutdown rather than shutdownNow?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Yeah, looked like the intention for writing that method was to do interruption, but it is called from cancelTasks() which calls cancel(false). Let me update the patch. &lt;/p&gt;</comment>
                            <comment id="14579767" author="enis" created="Tue, 9 Jun 2015 23:53:08 +0000"  >&lt;p&gt;New patch. &lt;/p&gt;</comment>
                            <comment id="14579769" author="stack" created="Wed, 10 Jun 2015 00:00:10 +0000"  >&lt;p&gt;+1&lt;/p&gt;

&lt;p&gt;Started a long-running test with the previous patch. Will let it go on.&lt;/p&gt;</comment>
                            <comment id="14579777" author="jinghe" created="Wed, 10 Jun 2015 00:10:26 +0000"  >&lt;p&gt;Great analysts!  Tough bug, and you made it easy to follow and persuasive ...&lt;br/&gt;
I like the safeguard in HRegion too, which will prevent the problem happening from causes other than the Flush Procedure.&lt;/p&gt;</comment>
                            <comment id="14579783" author="apache9" created="Wed, 10 Jun 2015 00:17:08 +0000"  >&lt;p&gt;In MemStoreFlusher we catch DroppedSnapshotException and abort the regionserver, and the javadoc of Region.flush says that DroppedSnapshotException is thrown when abort is required. So I think it is the caller&apos;s duty to abort the regionserver? If we abort the server inside Region.flush, do we still need to throw DroppedSnapshotException out? Thanks.&lt;/p&gt;</comment>
                            <comment id="14579852" author="enis" created="Wed, 10 Jun 2015 01:51:17 +0000"  >&lt;blockquote&gt;&lt;p&gt;So I think it is the caller&apos;s duty to abort the regionserver? If we abort the server inside Region.flush, do we still need to throw DroppedSnapshotException out?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Yes, the DroppedSnapshotException has that contract. i&apos;ve added extra abort() statement to safeguard against cases where the caller does not handle this exception explicitly. &lt;/p&gt;</comment>
                            <comment id="14579870" author="apache9" created="Wed, 10 Jun 2015 02:13:29 +0000"  >&lt;blockquote&gt;
&lt;p&gt;i&apos;ve added extra abort() statement to safeguard against cases where the caller does not handle this exception explicitly.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Then this is the caller&apos;s fault? Why not fix it at the caller side?&lt;br/&gt;
Or we could remove the &quot;abort regionserver&quot; semantics of DroppedSnapshotException so the caller do not need to deal with it anymore? We&apos;d better make the rule clear otherwise people may get confusing...&lt;/p&gt;</comment>
                            <comment id="14579894" author="hadoopqa" created="Wed, 10 Jun 2015 02:45:04 +0000"  >&lt;p&gt;&lt;font color=&quot;green&quot;&gt;+1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12738702/hbase-13877_v2-branch-1.1.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12738702/hbase-13877_v2-branch-1.1.patch&lt;/a&gt;&lt;br/&gt;
  against branch-1.1 branch at commit 14fe23254a78c52bdaef0da819268c8b405059cb.&lt;br/&gt;
  ATTACHMENT ID: 12738702&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop versions&lt;/font&gt;. The patch compiles with all supported hadoop versions (2.4.1 2.5.2 2.6.0)&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 protoc&lt;/font&gt;.  The applied patch does not increase the total number of protoc compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 checkstyle&lt;/font&gt;.  The applied patch does not increase the total number of checkstyle errors&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any  new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 core tests&lt;/font&gt;.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14356//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14356//testReport/&lt;/a&gt;&lt;br/&gt;
Release Findbugs (version 2.0.3) 	warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14356//artifact/patchprocess/newFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14356//artifact/patchprocess/newFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Checkstyle Errors: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14356//artifact/patchprocess/checkstyle-aggregate.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14356//artifact/patchprocess/checkstyle-aggregate.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;  Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14356//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14356//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14580040" author="stack" created="Wed, 10 Jun 2015 05:23:57 +0000"  >&lt;p&gt;Seeing @duo zhang&apos;s name in here made me think of tests. He added nice tests over in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13811&quot; title=&quot;Splitting WALs, we are filtering out too many edits -&amp;gt; DATALOSS&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13811&quot;&gt;&lt;del&gt;HBASE-13811&lt;/del&gt;&lt;/a&gt; so we don&apos;t regress. Any chance of our adding one here given it is torturous to figure (though as said above, the &quot;Enis the Detective&quot; novel above was a good read).&lt;/p&gt;</comment>
                            <comment id="14580046" author="enis" created="Wed, 10 Jun 2015 05:33:05 +0000"  >&lt;blockquote&gt;&lt;p&gt;He added nice tests over in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13811&quot; title=&quot;Splitting WALs, we are filtering out too many edits -&amp;gt; DATALOSS&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13811&quot;&gt;&lt;del&gt;HBASE-13811&lt;/del&gt;&lt;/a&gt; so we don&apos;t regress. Any chance of our adding one here given it is torturous to figure&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;We can cook up something I guess. Not sure how to test the condition that HRegion.flush() should not be aborted, or it if throws DroppedSnapshotException will be properly handled. Do you have anything in mind? &lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;though as said above, the &quot;Enis the Detective&quot; novel above was a good read&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Hehe. That is the next title of my book. &lt;/p&gt;</comment>
                            <comment id="14580729" author="enis" created="Wed, 10 Jun 2015 16:20:17 +0000"  >&lt;p&gt;My run for 2.5B failed yesterday overnight, but not due to dataloss, but other hdfs problems in my env. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=stack&quot; class=&quot;user-hover&quot; rel=&quot;stack&quot;&gt;stack&lt;/a&gt; any luck with your run? &lt;/p&gt;</comment>
                            <comment id="14580851" author="stack" created="Wed, 10 Jun 2015 17:29:53 +0000"  >&lt;p&gt;@enis still running (3B) ... In an hour or two I&apos;d say. On adding a test, yeah, probably hard to &apos;test&apos; for &apos;you can&apos;t cancel a result&apos;.&lt;/p&gt;</comment>
                            <comment id="14581157" author="stack" created="Wed, 10 Jun 2015 22:21:21 +0000"  >&lt;p&gt;Failed. Trying to figure why; i.e. writing a novel. Will be back when done.&lt;/p&gt;</comment>
                            <comment id="14581442" author="stack" created="Thu, 11 Jun 2015 05:14:01 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=enis&quot; class=&quot;user-hover&quot; rel=&quot;enis&quot;&gt;Enis Soztutar&lt;/a&gt; any comment on &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Apache9&quot; class=&quot;user-hover&quot; rel=&quot;Apache9&quot;&gt;Duo Zhang&lt;/a&gt; remark?&lt;/p&gt;

&lt;p&gt;Are dealing w/ above, I&apos;m +1 on commit. I did not find incidence of the original issue in my run after looking in all logs. In my case, I am seeing double-assignment over a master restart.&lt;/p&gt;

&lt;p&gt;2015-06-09 20:06:20,839 WARN  &lt;span class=&quot;error&quot;&gt;&amp;#91;c2020.halxg.cloudera.com,16000,1433905568816-GeneralBulkAssigner-1&amp;#93;&lt;/span&gt; master.AssignmentManager: Assigning a region not in region states: &lt;/p&gt;
{ENCODED =&amp;gt; 6fbe22ff15c2e5f2b207f79eaf8f382a, NAME =&amp;gt; &apos;IntegrationTestBigLinkedList,\xEB\x85\x1E\xB8Q\xEB\x85\x10,1433895189133.6fbe22ff15c2e5f2b207f79eaf8f382a.&apos;, STARTKEY =&amp;gt; &apos;\xEB\x85\x1E\xB8Q\xEB\x85\x10&apos;, ENDKEY =&amp;gt; &apos;\xF5\xC2\x8F\x5C(\xF5\xC2\x80&apos;}

&lt;p&gt;Will open new &apos;My Struggle&apos; issue when I have figured more why double-assign and then in turn, why dataloss (I don&apos;t see how at mo &amp;#8211; will keep digging).&lt;/p&gt;</comment>
                            <comment id="14582298" author="enis" created="Thu, 11 Jun 2015 18:05:01 +0000"  >&lt;blockquote&gt;&lt;p&gt;Enis Soztutar any comment on Duo Zhang remark?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Let me see how I can simplify the contract. &lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;Are dealing w/ above, I&apos;m +1 on commit. I did not find incidence of the original issue in my run after looking in all logs. In my case, I am seeing double-assignment over a master restart.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Agreed, lets commit this and continue on yet another issue. &lt;/p&gt;</comment>
                            <comment id="14582725" author="enis" created="Fri, 12 Jun 2015 00:16:27 +0000"  >&lt;p&gt;Here is a v3 patch which is a little bit more comprehensive. The semantics for what to do if flushCache() and close() fails is hard since the region cannot do much by itself. &lt;/p&gt;

&lt;p&gt;The contract for flushCache() and close() when DroppedSnapshotException is thrown was already that RS should abort. Now, the patch makes it more explicit, as well as adds safeguard so that region itself calls abort if rss is passed. Since flush() can be called from multiple different callers (MemstoreFlusher, snapshot, etc), we also have to guarantee that before DSE is thrown, we put the region in closing state so that no other writes / flushes can happen. This is because we cannot call &lt;tt&gt;close(true)&lt;/tt&gt; in the flushCache() since we cannot promote our read lock to a write lock. The caller should receive the DSE, then abort himself and RSS, which then calls close(true). But there is a window of time before RSS calls close(true), so no other flushes should come in while the caller handles the exception. &lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=saint.ack%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;saint.ack@gmail.com&quot;&gt;Stack&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Apache9&quot; class=&quot;user-hover&quot; rel=&quot;Apache9&quot;&gt;Duo Zhang&lt;/a&gt; does the patch make sense? It also touches upon &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-10514&quot; title=&quot;Forward port HBASE-10466, possible data loss when failed flushes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-10514&quot;&gt;&lt;del&gt;HBASE-10514&lt;/del&gt;&lt;/a&gt;. &lt;/p&gt;



</comment>
                            <comment id="14582742" author="apache9" created="Fri, 12 Jun 2015 00:37:58 +0000"  >&lt;p&gt;+1 on patch v3.&lt;/p&gt;</comment>
                            <comment id="14582858" author="hadoopqa" created="Fri, 12 Jun 2015 02:39:32 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12739146/hbase-13877_v3-branch-1.1.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12739146/hbase-13877_v3-branch-1.1.patch&lt;/a&gt;&lt;br/&gt;
  against branch-1.1 branch at commit 9d3422ed16004da1b0f9a874a98bd140b46b7a6f.&lt;br/&gt;
  ATTACHMENT ID: 12739146&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 6 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop versions&lt;/font&gt;. The patch compiles with all supported hadoop versions (2.4.1 2.5.2 2.6.0)&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 protoc&lt;/font&gt;.  The applied patch does not increase the total number of protoc compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 checkstyle&lt;/font&gt;.  The applied patch does not increase the total number of checkstyle errors&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any  new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core tests&lt;/font&gt;.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.regionserver.wal.TestSecureWALReplay&lt;br/&gt;
                  org.apache.hadoop.hbase.regionserver.wal.TestWALReplay&lt;br/&gt;
                  org.apache.hadoop.hbase.regionserver.wal.TestWALReplayCompressed&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14383//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14383//testReport/&lt;/a&gt;&lt;br/&gt;
Release Findbugs (version 2.0.3) 	warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14383//artifact/patchprocess/newFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14383//artifact/patchprocess/newFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Checkstyle Errors: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14383//artifact/patchprocess/checkstyle-aggregate.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14383//artifact/patchprocess/checkstyle-aggregate.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;  Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14383//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14383//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14582909" author="stack" created="Fri, 12 Jun 2015 04:18:54 +0000"  >&lt;p&gt;On patch, in this section:&lt;/p&gt;

&lt;p&gt;	699	            }&lt;br/&gt;
700	            if (rows.addAndGet(1) &amp;lt; MISSING_ROWS_TO_LOG) {&lt;br/&gt;
701	              context.getCounter(FOUND_GROUP_KEY, keyStr + &quot;&lt;em&gt;in&lt;/em&gt;&quot;&lt;br/&gt;
702	                  + context.getInputSplit().toString()).increment(1);&lt;/p&gt;

&lt;p&gt;When YARN dumps result, this nice addition gets cut off. How you looking at it &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=enis&quot; class=&quot;user-hover&quot; rel=&quot;enis&quot;&gt;Enis Soztutar&lt;/a&gt;?&lt;/p&gt;

&lt;p&gt;Patch is great. +1 after you get hadoopqa to pass.&lt;/p&gt;</comment>
                            <comment id="14584387" author="enis" created="Sat, 13 Jun 2015 02:07:23 +0000"  >&lt;p&gt;v4 test should fix the UT. &lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;When YARN dumps result, this nice addition gets cut off. How you looking at it Enis Soztutar?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Yarn 2.7.1 fails the tasks if task emits more than 120 counters. If that happens, the job does not show any counters at all at the end. I thought we would still want the job to go through. Should I revert this part? &lt;/p&gt;</comment>
                            <comment id="14584396" author="hadoopqa" created="Sat, 13 Jun 2015 02:22:40 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12739391/hbase-13877_v2-to-v4-branch-1.1.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12739391/hbase-13877_v2-to-v4-branch-1.1.patch&lt;/a&gt;&lt;br/&gt;
  against branch-1.1 branch at commit 293506c7cdef3e866c75a7b92558a423eb804d11.&lt;br/&gt;
  ATTACHMENT ID: 12739391&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 9 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 patch&lt;/font&gt;.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14393//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14393//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14584407" author="stack" created="Sat, 13 Jun 2015 02:41:05 +0000"  >&lt;p&gt;@enis That part of the change that dumps out 2 or less is good for reasons you say (else job fails).&lt;/p&gt;

&lt;p&gt;I was just commenting that when the job finishes and dumps summary on console, stuff is cut off. Here is example:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;

        Found
                CELL_WITH_MISSING_ROW=1917348
                S\x99\xE1\xF9\x00\xD3\xEE\xEE\xC6\x8E\x87\xAA\x87\xFEX\xFF_in_h=1
                T\x8Ec\xAB^\x89_O\xA3=\x8Asd&apos;5~_in_hdfs:&lt;span class=&quot;code-comment&quot;&gt;//c2020.halxg.cloudera.=1
&lt;/span&gt;                YB\xEC\xC4\xA3\x9C\xE4\x0FD\xB4`\xFFgs\x0C3_in_hdfs:&lt;span class=&quot;code-comment&quot;&gt;//c2020.hal=1
&lt;/span&gt;                Y\x98\x8A\x855\x13\xD0i\x97\x1D\x84&quot;G\xC7\x16m_in_hdfs:&lt;span class=&quot;code-comment&quot;&gt;//c2020.=1
&lt;/span&gt;                \xE3\xEA\xB0n[\xDB\xE0GT_\x08wfIa)_in_hdfs:&lt;span class=&quot;code-comment&quot;&gt;//c2020.halxg.cloude=1
&lt;/span&gt;                \xEA\x96o\x94\xF4\xD5k\x80[\x0D\xE6\xA1\xABe\x1C\xC6_in_hdfs:&lt;span class=&quot;code-comment&quot;&gt;//=1
&lt;/span&gt;                \xF1H#%Vx/m\x8E\x7F\x93\x11\xB4\x7FX\xD5_in_hdfs:&lt;span class=&quot;code-comment&quot;&gt;//c2020.halxg.=1
&lt;/span&gt;                \xF4\x89\xDE\x92\x95#\xC9\xC9K\xDD\x94z\x0F\x17\xBB\xA1_in_hdfs=1
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Was wondering if you saw something else?&lt;/p&gt;</comment>
                            <comment id="14584947" author="enis" created="Sun, 14 Jun 2015 06:03:51 +0000"  >&lt;blockquote&gt;&lt;p&gt;was just commenting that when the job finishes and dumps summary on console, stuff is cut off. &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Was wondering if you saw something else?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Ah, I see. Yes it seems that YARN trims the counter values. I just saw the same thing. Removed appending the input file name in v5. Will commit this version if qa passes. &lt;/p&gt;</comment>
                            <comment id="14584988" author="hadoopqa" created="Sun, 14 Jun 2015 08:46:26 +0000"  >&lt;p&gt;&lt;font color=&quot;green&quot;&gt;+1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12739471/hbase-13877_v5-branch-1.1.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12739471/hbase-13877_v5-branch-1.1.patch&lt;/a&gt;&lt;br/&gt;
  against branch-1.1 branch at commit 682b8ab8a542a903e5807053282693e3a96bad2d.&lt;br/&gt;
  ATTACHMENT ID: 12739471&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 9 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop versions&lt;/font&gt;. The patch compiles with all supported hadoop versions (2.4.1 2.5.2 2.6.0)&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 protoc&lt;/font&gt;.  The applied patch does not increase the total number of protoc compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 checkstyle&lt;/font&gt;.  The applied patch does not increase the total number of checkstyle errors&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any  new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 core tests&lt;/font&gt;.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14400//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14400//testReport/&lt;/a&gt;&lt;br/&gt;
Release Findbugs (version 2.0.3) 	warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14400//artifact/patchprocess/newFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14400//artifact/patchprocess/newFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Checkstyle Errors: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14400//artifact/patchprocess/checkstyle-aggregate.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14400//artifact/patchprocess/checkstyle-aggregate.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;  Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14400//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14400//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14585179" author="enis" created="Sun, 14 Jun 2015 18:26:07 +0000"  >&lt;p&gt;I&apos;ve pushed this to 1.1+. Keeping it open because I want to check whether a smaller version in 1.0 and 0.98 is needed. &lt;/p&gt;</comment>
                            <comment id="14585260" author="hudson" created="Sun, 14 Jun 2015 20:35:02 +0000"  >&lt;p&gt;SUCCESS: Integrated in HBase-1.1 #540 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-1.1/540/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-1.1/540/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13877&quot; title=&quot;Interrupt to flush from TableFlushProcedure causes dataloss in ITBLL&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13877&quot;&gt;&lt;del&gt;HBASE-13877&lt;/del&gt;&lt;/a&gt; Interrupt to flush from TableFlushProcedure causes dataloss in ITBLL (enis: rev 31e81829bf21b2c44499372c1ac5a17f562377af)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/wal/TestWALReplay.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/snapshot/RegionServerSnapshotManager.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/procedure/flush/FlushTableSubprocedure.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/procedure/flush/RegionServerFlushTableProcedureManager.java&lt;/li&gt;
	&lt;li&gt;hbase-it/src/test/java/org/apache/hadoop/hbase/test/IntegrationTestBigLinkedList.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/Region.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/RegionMergeRequest.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/SplitRequest.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/TestHRegion.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/RSRpcServices.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14585265" author="hudson" created="Sun, 14 Jun 2015 20:45:29 +0000"  >&lt;p&gt;SUCCESS: Integrated in HBase-1.2 #8 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-1.2/8/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-1.2/8/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13877&quot; title=&quot;Interrupt to flush from TableFlushProcedure causes dataloss in ITBLL&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13877&quot;&gt;&lt;del&gt;HBASE-13877&lt;/del&gt;&lt;/a&gt; Interrupt to flush from TableFlushProcedure causes dataloss in ITBLL (enis: rev 10772d3af9d0e4e9a2bdd73730dbc7548c461ccb)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/TestHRegion.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/SplitRequest.java&lt;/li&gt;
	&lt;li&gt;hbase-it/src/test/java/org/apache/hadoop/hbase/test/IntegrationTestBigLinkedList.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/snapshot/RegionServerSnapshotManager.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/procedure/flush/RegionServerFlushTableProcedureManager.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/RegionMergeRequest.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/Region.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/RSRpcServices.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/wal/TestWALReplay.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/procedure/flush/FlushTableSubprocedure.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14585281" author="hudson" created="Sun, 14 Jun 2015 21:42:02 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-TRUNK #6570 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/6570/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/6570/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13877&quot; title=&quot;Interrupt to flush from TableFlushProcedure causes dataloss in ITBLL&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13877&quot;&gt;&lt;del&gt;HBASE-13877&lt;/del&gt;&lt;/a&gt; Interrupt to flush from TableFlushProcedure causes dataloss in ITBLL (enis: rev c6dd3f965ba00722a7b8418f61180e694b846610)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/snapshot/RegionServerSnapshotManager.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/SplitRequest.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/procedure/flush/FlushTableSubprocedure.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/Region.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/wal/TestWALReplay.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/RegionMergeRequest.java&lt;/li&gt;
	&lt;li&gt;hbase-it/src/test/java/org/apache/hadoop/hbase/test/IntegrationTestBigLinkedList.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/TestHRegion.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/procedure/flush/RegionServerFlushTableProcedureManager.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/RSRpcServices.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14590401" author="enis" created="Wed, 17 Jun 2015 19:23:17 +0000"  >&lt;p&gt;I have pushed this to 1.0 and 0.98 as well. &lt;/p&gt;</comment>
                            <comment id="14590461" author="hudson" created="Wed, 17 Jun 2015 20:00:29 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-0.98-on-Hadoop-1.1 #984 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.98-on-Hadoop-1.1/984/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.98-on-Hadoop-1.1/984/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13877&quot; title=&quot;Interrupt to flush from TableFlushProcedure causes dataloss in ITBLL&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13877&quot;&gt;&lt;del&gt;HBASE-13877&lt;/del&gt;&lt;/a&gt; Interrupt to flush from TableFlushProcedure causes dataloss in ITBLL (enis: rev 4cde6b3b88c9a4c48d5c7ad5b1b58027f46a9f23)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/snapshot/RegionServerSnapshotManager.java&lt;/li&gt;
	&lt;li&gt;hbase-it/src/test/java/org/apache/hadoop/hbase/test/IntegrationTestBigLinkedList.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/wal/TestWALReplay.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/TestHRegion.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/SplitRequest.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/RegionMergeRequest.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14590857" author="hudson" created="Wed, 17 Jun 2015 23:36:34 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-1.0 #966 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-1.0/966/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-1.0/966/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13877&quot; title=&quot;Interrupt to flush from TableFlushProcedure causes dataloss in ITBLL&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13877&quot;&gt;&lt;del&gt;HBASE-13877&lt;/del&gt;&lt;/a&gt; Interrupt to flush from TableFlushProcedure causes dataloss in ITBLL (enis: rev 28534d1e9ccfa648cf6062eda59e8340f1d90d41)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/procedure/flush/RegionServerFlushTableProcedureManager.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/TestHRegion.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/SplitRequest.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/snapshot/RegionServerSnapshotManager.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java&lt;/li&gt;
	&lt;li&gt;hbase-it/src/test/java/org/apache/hadoop/hbase/test/IntegrationTestBigLinkedList.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/RegionMergeRequest.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/RSRpcServices.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/wal/TestWALReplay.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14591137" author="hudson" created="Thu, 18 Jun 2015 02:28:54 +0000"  >&lt;p&gt;SUCCESS: Integrated in HBase-0.98 #1031 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.98/1031/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.98/1031/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13877&quot; title=&quot;Interrupt to flush from TableFlushProcedure causes dataloss in ITBLL&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13877&quot;&gt;&lt;del&gt;HBASE-13877&lt;/del&gt;&lt;/a&gt; Interrupt to flush from TableFlushProcedure causes dataloss in ITBLL (enis: rev 4cde6b3b88c9a4c48d5c7ad5b1b58027f46a9f23)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-it/src/test/java/org/apache/hadoop/hbase/test/IntegrationTestBigLinkedList.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/snapshot/RegionServerSnapshotManager.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/SplitRequest.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/wal/TestWALReplay.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/TestHRegion.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/RegionMergeRequest.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14724259" author="enis" created="Mon, 31 Aug 2015 22:39:45 +0000"  >&lt;p&gt;Closing this issue after 1.0.2 release.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12833919">HBASE-13811</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12738692" name="hbase-13877_v1.patch" size="9403" author="enis" created="Tue, 9 Jun 2015 23:08:19 +0000"/>
                            <attachment id="12738702" name="hbase-13877_v2-branch-1.1.patch" size="9072" author="enis" created="Tue, 9 Jun 2015 23:53:08 +0000"/>
                            <attachment id="12739391" name="hbase-13877_v2-to-v4-branch-1.1.patch" size="22865" author="enis" created="Sat, 13 Jun 2015 02:07:23 +0000"/>
                            <attachment id="12739146" name="hbase-13877_v3-branch-1.1.patch" size="28250" author="enis" created="Fri, 12 Jun 2015 00:16:27 +0000"/>
                            <attachment id="12739471" name="hbase-13877_v5-branch-1.1.patch" size="29853" author="enis" created="Sun, 14 Jun 2015 06:04:21 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 9 Jun 2015 22:25:43 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 13 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2fupz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>