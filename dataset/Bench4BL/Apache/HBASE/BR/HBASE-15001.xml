<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Thu Dec 01 21:15:22 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-15001/HBASE-15001.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-15001] Thread Safety issues in ReplicationSinkManager and HBaseInterClusterReplicationEndpoint</title>
                <link>https://issues.apache.org/jira/browse/HBASE-15001</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;ReplicationSinkManager is not thread-safe. This can cause problems in HBaseInterClusterReplicationEndpoint,  when the walprovider is multiwal. &lt;br/&gt;
For example: &lt;br/&gt;
1. When multiple threads report bad sinks, the sink list can be non-empty but report a negative size because the ArrayList itself is not thread-safe. &lt;/p&gt;

&lt;p&gt;2. HBaseInterClusterReplicationEndpoint depends on the number of sinks to batch edits for shipping. However, it&apos;s quite possible that the following code makes it assume that there are no batches to process (sink size is non-zero, but by the time we reach the &quot;batching&quot; part, sink size becomes zero.)&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (replicationSinkMgr.getSinks().size() == 0) {
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
}
...
&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; n = &lt;span class=&quot;code-object&quot;&gt;Math&lt;/span&gt;.min(&lt;span class=&quot;code-object&quot;&gt;Math&lt;/span&gt;.min(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.maxThreads, entries.size()/100+1),
               replicationSinkMgr.getSinks().size());
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;Update&amp;#93;&lt;/span&gt; This leads to ArithmeticException: division by zero at:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
entryLists.get(&lt;span class=&quot;code-object&quot;&gt;Math&lt;/span&gt;.abs(Bytes.hashCode(e.getKey().getEncodedRegionName())%n)).add(e);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;which is benign and will just lead to retries by the ReplicationSource.&lt;/p&gt;

&lt;p&gt;The idea is to make all operations in ReplicationSinkManager thread-safe and do a verification on the size of replicated edits before we report success.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12922856">HBASE-15001</key>
            <summary>Thread Safety issues in ReplicationSinkManager and HBaseInterClusterReplicationEndpoint</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.png">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ashu210890">Ashu Pachauri</assignee>
                                    <reporter username="ashu210890">Ashu Pachauri</reporter>
                        <labels>
                    </labels>
                <created>Thu, 17 Dec 2015 21:27:57 +0000</created>
                <updated>Tue, 22 Dec 2015 06:48:24 +0000</updated>
                            <resolved>Tue, 22 Dec 2015 06:48:24 +0000</resolved>
                                    <version>2.0.0</version>
                    <version>1.2.0</version>
                    <version>1.3.0</version>
                    <version>1.2.1</version>
                                    <fixVersion>2.0.0</fixVersion>
                    <fixVersion>1.2.0</fixVersion>
                    <fixVersion>1.3.0</fixVersion>
                                    <component>Replication</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>9</watches>
                                                                <comments>
                            <comment id="15062871" author="ashu210890" created="Thu, 17 Dec 2015 21:34:32 +0000"  >&lt;p&gt;V0: Makes operations in ReplicationSinkManager synchronized and adds a verification on total number of replicated edits in HBaseInterClusterReplicationEndpoint before reporting success.&lt;/p&gt;</comment>
                            <comment id="15062937" author="yuzhihong@gmail.com" created="Thu, 17 Dec 2015 22:04:42 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
263	          LOG.warn(&lt;span class=&quot;code-quote&quot;&gt;&quot;The number of edits replicated is different from the number received,&quot;&lt;/span&gt;
264	              + &lt;span class=&quot;code-quote&quot;&gt;&quot; failing &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; now.&quot;&lt;/span&gt;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Please note the two numbers in the above message so that the log is more useful for debugging.&lt;/p&gt;

&lt;p&gt;Is it possible to reproduce, in a unit test, the race you outlined ?&lt;/p&gt;

&lt;p&gt;Thanks&lt;/p&gt;</comment>
                            <comment id="15063144" author="ashu210890" created="Fri, 18 Dec 2015 00:09:52 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tedyu&quot; class=&quot;user-hover&quot; rel=&quot;tedyu&quot;&gt;Ted Yu&lt;/a&gt; I did reproduce it in unit test but after instrumenting the code with artificial waiting conditionals. Basically, what I did was too specific to how the code is currently structured (without the patch). Let me see if I can create a more general patch around race conditions in the ReplicationEndpoint.&lt;/p&gt;</comment>
                            <comment id="15063157" author="eclark" created="Fri, 18 Dec 2015 00:21:32 +0000"  >&lt;p&gt;+1 lets get this in so &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=busbey&quot; class=&quot;user-hover&quot; rel=&quot;busbey&quot;&gt;Sean Busbey&lt;/a&gt; can get a 1.2 rolled. We can add a test in a new jira.&lt;/p&gt;</comment>
                            <comment id="15063161" author="yuzhihong@gmail.com" created="Fri, 18 Dec 2015 00:24:09 +0000"  >&lt;p&gt;Please share your modified unit test so that people can understand the race condition better.&lt;/p&gt;</comment>
                            <comment id="15063162" author="busbey" created="Fri, 18 Dec 2015 00:24:25 +0000"  >&lt;p&gt;did this not apply to versions before 1.2?&lt;/p&gt;</comment>
                            <comment id="15063167" author="eclark" created="Fri, 18 Dec 2015 00:27:26 +0000"  >&lt;blockquote&gt;&lt;p&gt;did this not apply to versions before 1.2?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;It&apos;s much harder to run into pre 1.2 because we were not doing the batching/threading before 1.2.&lt;/p&gt;</comment>
                            <comment id="15063185" author="ashu210890" created="Fri, 18 Dec 2015 00:39:28 +0000"  >&lt;blockquote&gt;
&lt;p&gt;did this not apply to versions before 1.2?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I believe we only had one replication worker thread before 1.2, so there was no synchronization/race issues.&lt;/p&gt;</comment>
                            <comment id="15063193" author="busbey" created="Fri, 18 Dec 2015 00:49:47 +0000"  >&lt;p&gt;okay, wfm then. no release note needed.&lt;/p&gt;</comment>
                            <comment id="15063238" author="ashu210890" created="Fri, 18 Dec 2015 01:22:18 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tedyu&quot; class=&quot;user-hover&quot; rel=&quot;tedyu&quot;&gt;Ted Yu&lt;/a&gt; I am sorry, I did not notice you were talking about race condition in point 2 of my description. I did not reproduce it in unit tests. When I try to reproduce it, it&apos;s not as bad as I thought. It just errors out on &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
entryLists.get(&lt;span class=&quot;code-object&quot;&gt;Math&lt;/span&gt;.abs(Bytes.hashCode(e.getKey().getEncodedRegionName())%n)).add(e);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;due to division by zero.&lt;/p&gt;

&lt;p&gt;The other race conditions are in ReplicationSinkPeer which cannot be deterministically reproduced (as I dont have control over race conditions in an arralist). I just introduced a a random failing sink behavior, and ran it with enough number of wals and edits to replicate.. and I was able to reproduce that arraylist reports the size as negative, which stays that way infinitely. I need to run somewhere right now, but I will post the code for this reproduction later tonight.&lt;/p&gt;</comment>
                            <comment id="15064538" author="ashu210890" created="Fri, 18 Dec 2015 19:18:12 +0000"  >&lt;p&gt;Repro_stuck_replication:  This was a randomized version of the bug repro that I performed. I have no idea how to deterministically reproduce the bug. I let it run on a loop for a few hours last night and I got this in the logs this morning (stuck replication on one of the node, it&apos;s stuck because once this happens, the sink list is never refreshed) :&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2015-12-18 05:08:15,923 WARN  [main-EventThread.replicationSource,testInterClusterReplication.replicationSource.ashu-mbp.dhcp.thefacebook.com%2C53383%2C1450465675871.regiongroup-0,testInterClusterReplication] regionserver.ReplicationSource$ReplicationSourceWorkerThread(1020): org.apache.hadoop.hbase.replication.TestReplicationEndpoint$InterClusterReplicationEndpointForTest threw unknown exception:java.lang.IllegalArgumentException: Illegal Capacity: -1
        at java.util.ArrayList.&amp;lt;init&amp;gt;(ArrayList.java:156)
        at org.apache.hadoop.hbase.replication.regionserver.HBaseInterClusterReplicationEndpoint.replicate(HBaseInterClusterReplicationEndpoint.java:196)
        at org.apache.hadoop.hbase.replication.TestReplicationEndpoint$InterClusterReplicationEndpointForTest.replicate(TestReplicationEndpoint.java:330)
        at org.apache.hadoop.hbase.replication.regionserver.ReplicationSource$ReplicationSourceWorkerThread.shipEdits(ReplicationSource.java:983)
        at org.apache.hadoop.hbase.replication.regionserver.ReplicationSource$ReplicationSourceWorkerThread.run(ReplicationSource.java:653)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Anyways, there is no point needed to be made for using synchronized operations on an unsafe container. But, just to be sure I performed a multithreaded write test on an ArrayList (Attached Test.java) that it can report negative size. Here is the output after a few minutes of run:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
List not empty, it&apos;s size is:  -1
List not empty, it&apos;s size is:  -1
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15064551" author="ashu210890" created="Fri, 18 Dec 2015 19:23:32 +0000"  >&lt;p&gt;The point 2 of the description does not reproduce because it is masked by an ArithmeticException  (Divide by zero) here in HBaseInterClusterReplicationEndpoint:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
entryLists.get(&lt;span class=&quot;code-object&quot;&gt;Math&lt;/span&gt;.abs(Bytes.hashCode(e.getKey().getEncodedRegionName())%n)).add(e);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;So, I will change this in description. However, I would still like to make a point that we should keep the following verification check in patch:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (numReplicated != entries.size()) {
+          &lt;span class=&quot;code-comment&quot;&gt;// Something went wrong here and we don&apos;t know what, let&apos;s just fail and retry.
&lt;/span&gt;+          LOG.warn(&lt;span class=&quot;code-quote&quot;&gt;&quot;The number of edits replicated is different from the number received,&quot;&lt;/span&gt;
+              + &lt;span class=&quot;code-quote&quot;&gt;&quot; failing &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; now.&quot;&lt;/span&gt;);
+          &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
+        }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This allows for more robustness in replication loop and makes it easy to catch errors during replication, especially in a multithreaded world.&lt;/p&gt;</comment>
                            <comment id="15064681" author="yuzhihong@gmail.com" created="Fri, 18 Dec 2015 20:10:32 +0000"  >&lt;p&gt;A bit confused by the following commit:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
commit 48113d7572bbea2f05ae619882d43aa41827f147
Author: Ashu Pachauri &amp;lt;ashu210890@gmail.com&amp;gt;
Date:   Thu Dec 17 13:25:39 2015 -0800

    HBASE-15001 Fix thread-safety issues with replication

    ReplicationSinkManager and HBaseInterClusterReplicationEndpoint
    perform certain unsafe operations which might lead to undesirable
    behavior with multiwal enabled.

    Signed-off-by: Elliott Clark &amp;lt;eclark@apache.org&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;To my knowledge, review on this JIRA hasn&apos;t completed. There was no QA run either.&lt;/p&gt;</comment>
                            <comment id="15064693" author="eclark" created="Fri, 18 Dec 2015 20:15:53 +0000"  >&lt;p&gt;I gave my explicit +1&lt;/p&gt;</comment>
                            <comment id="15064718" author="yuzhihong@gmail.com" created="Fri, 18 Dec 2015 20:33:24 +0000"  >&lt;p&gt;But QA run is needed, right ?&lt;/p&gt;</comment>
                            <comment id="15064722" author="ashu210890" created="Fri, 18 Dec 2015 20:37:08 +0000"  >&lt;blockquote&gt;
&lt;p&gt;But QA run is needed, right ?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I believe that was my mistake. I should have kicked in QA by submitting the patch as soon as Elliott gave a +1. I guess QA git lost between all the discussion.&lt;/p&gt;</comment>
                            <comment id="15064832" author="hudson" created="Fri, 18 Dec 2015 21:54:48 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-Trunk_matrix #568 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-Trunk_matrix/568/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-Trunk_matrix/568/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-15001&quot; title=&quot;Thread Safety issues in ReplicationSinkManager and HBaseInterClusterReplicationEndpoint&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-15001&quot;&gt;&lt;del&gt;HBASE-15001&lt;/del&gt;&lt;/a&gt; Fix thread-safety issues with replication (eclark: rev 48113d7572bbea2f05ae619882d43aa41827f147)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/replication/regionserver/HBaseInterClusterReplicationEndpoint.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/replication/regionserver/TestReplicationSinkManager.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSinkManager.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15064954" author="hudson" created="Fri, 18 Dec 2015 23:22:30 +0000"  >&lt;p&gt;SUCCESS: Integrated in HBase-1.3-IT #388 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-1.3-IT/388/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-1.3-IT/388/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-15001&quot; title=&quot;Thread Safety issues in ReplicationSinkManager and HBaseInterClusterReplicationEndpoint&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-15001&quot;&gt;&lt;del&gt;HBASE-15001&lt;/del&gt;&lt;/a&gt; Fix thread-safety issues with replication (eclark: rev b3300602ed3af9254eabe0bf3db0570cbf01ae05)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/replication/regionserver/HBaseInterClusterReplicationEndpoint.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/replication/regionserver/TestReplicationSinkManager.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSinkManager.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15065017" author="hudson" created="Sat, 19 Dec 2015 00:02:08 +0000"  >&lt;p&gt;SUCCESS: Integrated in HBase-1.2-IT #353 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-1.2-IT/353/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-1.2-IT/353/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-15001&quot; title=&quot;Thread Safety issues in ReplicationSinkManager and HBaseInterClusterReplicationEndpoint&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-15001&quot;&gt;&lt;del&gt;HBASE-15001&lt;/del&gt;&lt;/a&gt; Fix thread-safety issues with replication (eclark: rev f656701f156a28215ce690c566f8e529f4e3a55c)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/replication/regionserver/HBaseInterClusterReplicationEndpoint.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSinkManager.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/replication/regionserver/TestReplicationSinkManager.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15065142" author="hudson" created="Sat, 19 Dec 2015 01:46:44 +0000"  >&lt;p&gt;ABORTED: Integrated in HBase-1.3 #451 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-1.3/451/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-1.3/451/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-15001&quot; title=&quot;Thread Safety issues in ReplicationSinkManager and HBaseInterClusterReplicationEndpoint&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-15001&quot;&gt;&lt;del&gt;HBASE-15001&lt;/del&gt;&lt;/a&gt; Fix thread-safety issues with replication (eclark: rev b3300602ed3af9254eabe0bf3db0570cbf01ae05)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSinkManager.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/replication/regionserver/TestReplicationSinkManager.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/replication/regionserver/HBaseInterClusterReplicationEndpoint.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15065152" author="hudson" created="Sat, 19 Dec 2015 02:06:37 +0000"  >&lt;p&gt;SUCCESS: Integrated in HBase-1.2 #457 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-1.2/457/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-1.2/457/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-15001&quot; title=&quot;Thread Safety issues in ReplicationSinkManager and HBaseInterClusterReplicationEndpoint&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-15001&quot;&gt;&lt;del&gt;HBASE-15001&lt;/del&gt;&lt;/a&gt; Fix thread-safety issues with replication (eclark: rev f656701f156a28215ce690c566f8e529f4e3a55c)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/replication/regionserver/TestReplicationSinkManager.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSinkManager.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/replication/regionserver/HBaseInterClusterReplicationEndpoint.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15066039" author="busbey" created="Mon, 21 Dec 2015 04:19:24 +0000"  >&lt;p&gt;generally, yes. we should be getting a buildbot run in to ensure there aren&apos;t any surprises. it looks like this issue never changed from &quot;Open&quot; status, so the build bot never knew to look. mistakes happen, we can clean most things up if something is broken.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tedyu&quot; class=&quot;user-hover&quot; rel=&quot;tedyu&quot;&gt;Ted Yu&lt;/a&gt; would you prefer any clean up happen in this ticket (please specify what) or are your fine with a follow on?&lt;/p&gt;</comment>
                            <comment id="15066051" author="yuzhihong@gmail.com" created="Mon, 21 Dec 2015 05:06:30 +0000"  >&lt;p&gt;I went through the patch - it looks good.&lt;/p&gt;

&lt;p&gt;Jenkins builds are currently failing, due to some other JIRA.&lt;/p&gt;

&lt;p&gt;I hope we follow the procedure of submitting for QA run, validation, review and then commit in the future.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12778347" name="HBASE-15001-V0.patch" size="10979" author="ashu210890" created="Thu, 17 Dec 2015 21:34:32 +0000"/>
                            <attachment id="12778553" name="Test.java" size="1196" author="ashu210890" created="Fri, 18 Dec 2015 19:18:12 +0000"/>
                            <attachment id="12778552" name="repro_stuck_replication.diff" size="8467" author="ashu210890" created="Fri, 18 Dec 2015 19:18:12 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 17 Dec 2015 22:04:42 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            49 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2q287:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>