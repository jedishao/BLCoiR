<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Thu Dec 01 22:42:38 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-14474/HBASE-14474.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-14474] DeadLock in RpcClientImpl.Connection.close() </title>
                <link>https://issues.apache.org/jira/browse/HBASE-14474</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;From a code base that contains 1.1.2 + &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-14449&quot; title=&quot;Rewrite deadlock prevention for concurrent connection close&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-14449&quot;&gt;&lt;del&gt;HBASE-14449&lt;/del&gt;&lt;/a&gt; + &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-14241&quot; title=&quot;Fix deadlock during cluster shutdown due to concurrent connection close&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-14241&quot;&gt;&lt;del&gt;HBASE-14241&lt;/del&gt;&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-14313&quot; title=&quot;After a Connection sees ConnectionClosingException it never recovers&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-14313&quot;&gt;&lt;del&gt;HBASE-14313&lt;/del&gt;&lt;/a&gt; we can reproduce a dead lock with serverKilling CM easily: &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Found one Java-level deadlock:
=============================
&lt;span class=&quot;code-quote&quot;&gt;&quot;htable-pool1-t63&quot;&lt;/span&gt;:
  waiting to lock monitor 0x0000000001cb1688 (object 0x00000000806ef150, a org.apache.hadoop.hbase.ipc.RpcClientImpl$Connection),
  which is held by &lt;span class=&quot;code-quote&quot;&gt;&quot;IPC Client (1403704789) connection to enis-hbase-sep-21-6.novalocal/172.22.107.106:16020 from root&quot;&lt;/span&gt;
&lt;span class=&quot;code-quote&quot;&gt;&quot;IPC Client (1403704789) connection to enis-hbase-sep-21-6.novalocal/172.22.107.106:16020 from root&quot;&lt;/span&gt;:
  waiting to lock monitor 0x0000000001cb1738 (object 0x00000000806f0c60, a java.lang.&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;),
  which is held by &lt;span class=&quot;code-quote&quot;&gt;&quot;htable-pool1-t63&quot;&lt;/span&gt;

Java stack information &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; the threads listed above:
===================================================
&lt;span class=&quot;code-quote&quot;&gt;&quot;htable-pool1-t63&quot;&lt;/span&gt;:
	at org.apache.hadoop.hbase.ipc.RpcClientImpl$Connection.close(RpcClientImpl.java:819)
	- waiting to lock &amp;lt;0x00000000806ef150&amp;gt; (a org.apache.hadoop.hbase.ipc.RpcClientImpl$Connection)
	at org.apache.hadoop.hbase.ipc.RpcClientImpl$Connection.writeRequest(RpcClientImpl.java:906)
	- locked &amp;lt;0x00000000806f0c60&amp;gt; (a java.lang.&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;)
	at org.apache.hadoop.hbase.ipc.RpcClientImpl$Connection.tracedWriteRequest(RpcClientImpl.java:856)
	at org.apache.hadoop.hbase.ipc.RpcClientImpl.call(RpcClientImpl.java:1192)
	at org.apache.hadoop.hbase.ipc.AbstractRpcClient.callBlockingMethod(AbstractRpcClient.java:213)
	at org.apache.hadoop.hbase.ipc.AbstractRpcClient$BlockingRpcChannelImplementation.callBlockingMethod(AbstractRpcClient.java:287)
	at org.apache.hadoop.hbase.protobuf.generated.ClientProtos$ClientService$BlockingStub.multi(ClientProtos.java:32699)
	at org.apache.hadoop.hbase.client.MultiServerCallable.call(MultiServerCallable.java:129)
	at org.apache.hadoop.hbase.client.MultiServerCallable.call(MultiServerCallable.java:54)
	at org.apache.hadoop.hbase.client.RpcRetryingCaller.callWithoutRetries(RpcRetryingCaller.java:200)
	at org.apache.hadoop.hbase.client.AsyncProcess$AsyncRequestFutureImpl$SingleServerRequestRunnable.run(AsyncProcess.java:708)
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745)
&lt;span class=&quot;code-quote&quot;&gt;&quot;IPC Client (1403704789) connection to enis-hbase-sep-21-6.novalocal/172.22.107.106:16020 from root&quot;&lt;/span&gt;:
	at org.apache.hadoop.hbase.ipc.RpcClientImpl$Connection.close(RpcClientImpl.java:832)
	- waiting to lock &amp;lt;0x00000000806f0c60&amp;gt; (a java.lang.&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;)
	- locked &amp;lt;0x00000000806ef150&amp;gt; (a org.apache.hadoop.hbase.ipc.RpcClientImpl$Connection)
	at org.apache.hadoop.hbase.ipc.RpcClientImpl$Connection.run(RpcClientImpl.java:574)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12895970">HBASE-14474</key>
            <summary>DeadLock in RpcClientImpl.Connection.close() </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.png">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="enis">Enis Soztutar</assignee>
                                    <reporter username="enis">Enis Soztutar</reporter>
                        <labels>
                    </labels>
                <created>Thu, 24 Sep 2015 00:53:34 +0000</created>
                <updated>Wed, 27 Jan 2016 15:28:42 +0000</updated>
                            <resolved>Fri, 16 Oct 2015 19:23:06 +0000</resolved>
                                                    <fixVersion>2.0.0</fixVersion>
                    <fixVersion>1.2.0</fixVersion>
                    <fixVersion>1.0.3</fixVersion>
                    <fixVersion>1.1.3</fixVersion>
                                    <component>IPC/RPC</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>8</watches>
                                                                                                            <comments>
                            <comment id="14905611" author="enis" created="Thu, 24 Sep 2015 01:07:54 +0000"  >&lt;p&gt;I think this is due to the addendum for &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-14313&quot; title=&quot;After a Connection sees ConnectionClosingException it never recovers&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-14313&quot;&gt;&lt;del&gt;HBASE-14313&lt;/del&gt;&lt;/a&gt;:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
-          markClosed(e);
+          &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (markClosed(e)) {
+            close();
+          }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Since now we are calling close() while holding the lock for &lt;tt&gt;this.outLock&lt;/tt&gt; and waiting on the lock for &lt;tt&gt;this&lt;/tt&gt;, and the other thread is in &lt;tt&gt;close()&lt;/tt&gt; while holding the lock for &lt;tt&gt;this&lt;/tt&gt; and waiting for the lock for &lt;tt&gt;this.outLock&lt;/tt&gt;. &lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=eclark&quot; class=&quot;user-hover&quot; rel=&quot;eclark&quot;&gt;Elliott Clark&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=saint.ack%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;saint.ack@gmail.com&quot;&gt;Stack&lt;/a&gt; I have to understand the full context at &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-14313&quot; title=&quot;After a Connection sees ConnectionClosingException it never recovers&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-14313&quot;&gt;&lt;del&gt;HBASE-14313&lt;/del&gt;&lt;/a&gt; for attempting a fix here. Any suggestions? &lt;/p&gt;</comment>
                            <comment id="14905624" author="enis" created="Thu, 24 Sep 2015 01:18:21 +0000"  >&lt;p&gt;I think this patch should fix the deadlock. It does not revert &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-14313&quot; title=&quot;After a Connection sees ConnectionClosingException it never recovers&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-14313&quot;&gt;&lt;del&gt;HBASE-14313&lt;/del&gt;&lt;/a&gt;. We release the &lt;tt&gt;outLock&lt;/tt&gt; before calling &lt;tt&gt;close()&lt;/tt&gt; in &lt;tt&gt;writeRequest()&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;Will try this in the cluster. &lt;/p&gt;</comment>
                            <comment id="14905649" author="hadoopqa" created="Thu, 24 Sep 2015 01:39:41 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12762027/hbase-14474_v1.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12762027/hbase-14474_v1.patch&lt;/a&gt;&lt;br/&gt;
  against master branch at commit 5e26ae043dde217aeda29d9b67e290728adade89.&lt;br/&gt;
  ATTACHMENT ID: 12762027&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 tests included&lt;/font&gt;.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 patch&lt;/font&gt;.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/15704//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/15704//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14905771" author="enis" created="Thu, 24 Sep 2015 03:30:56 +0000"  >&lt;p&gt;v1 would not work since markClosed() is also synchronized. &lt;br/&gt;
v2 patch reverts 14313 (not the addendum) and reverts some parts of  &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-14449&quot; title=&quot;Rewrite deadlock prevention for concurrent connection close&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-14449&quot;&gt;&lt;del&gt;HBASE-14449&lt;/del&gt;&lt;/a&gt;. &lt;/p&gt;

&lt;p&gt;markClosed() is still synchronized since it calls notifyAll(). As in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-14449&quot; title=&quot;Rewrite deadlock prevention for concurrent connection close&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-14449&quot;&gt;&lt;del&gt;HBASE-14449&lt;/del&gt;&lt;/a&gt;,  the Connection.run() is the main responsible party to call &lt;tt&gt;close()&lt;/tt&gt; from all remaining parts when &lt;tt&gt;markClosed()&lt;/tt&gt; is invoked (&lt;tt&gt;readResponse()&lt;/tt&gt;, etc.) if the Connection thread have started after &lt;tt&gt;setupIOStreams&lt;/tt&gt;. &lt;tt&gt;writeRequest()&lt;/tt&gt; still calls &lt;tt&gt;close()&lt;/tt&gt;, but not sure it is needed anymore. &lt;/p&gt;</comment>
                            <comment id="14905775" author="enis" created="Thu, 24 Sep 2015 03:35:36 +0000"  >&lt;p&gt;On second thought, calling close() without checking markClosed() result in &lt;tt&gt;setupIOStreams&lt;/tt&gt; is safer since we have to ensure that there is at least one call to &lt;tt&gt;close()&lt;/tt&gt;. v3 patch reverts those changes from v2.  &lt;/p&gt;</comment>
                            <comment id="14905890" author="hadoopqa" created="Thu, 24 Sep 2015 06:27:51 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12762044/hbase-14474_v3.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12762044/hbase-14474_v3.patch&lt;/a&gt;&lt;br/&gt;
  against master branch at commit 5e26ae043dde217aeda29d9b67e290728adade89.&lt;br/&gt;
  ATTACHMENT ID: 12762044&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 tests included&lt;/font&gt;.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop versions&lt;/font&gt;. The patch compiles with all supported hadoop versions (2.4.0 2.4.1 2.5.0 2.5.1 2.5.2 2.6.0 2.7.0 2.7.1)&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 protoc&lt;/font&gt;.  The applied patch does not increase the total number of protoc compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 checkstyle&lt;/font&gt;.  The applied patch does not increase the total number of checkstyle errors&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any  new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn post-site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core tests&lt;/font&gt;.  The patch failed these unit tests:&lt;/p&gt;


&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core zombie tests&lt;/font&gt;.  There are 6 zombie test(s): 	at org.apache.hadoop.hbase.regionserver.TestHRegion.testFlushCacheWhileScanning(TestHRegion.java:3756)&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/15706//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/15706//testReport/&lt;/a&gt;&lt;br/&gt;
Release Findbugs (version 2.0.3) 	warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/15706//artifact/patchprocess/newFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/15706//artifact/patchprocess/newFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Checkstyle Errors: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/15706//artifact/patchprocess/checkstyle-aggregate.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/15706//artifact/patchprocess/checkstyle-aggregate.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;  Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/15706//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/15706//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14906692" author="stack" created="Thu, 24 Sep 2015 17:29:05 +0000"  >&lt;p&gt;That is pretty bad if the jvm itself can detect the deadlock. Good one &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=enis&quot; class=&quot;user-hover&quot; rel=&quot;enis&quot;&gt;Enis Soztutar&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Looks like lots of cooks recently in the close of a connection. I said I&apos;d write a test over in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-14313&quot; title=&quot;After a Connection sees ConnectionClosingException it never recovers&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-14313&quot;&gt;&lt;del&gt;HBASE-14313&lt;/del&gt;&lt;/a&gt; but didn&apos;t (all talk!). We need one it looks like given all the machinations around close that have gone in w/o test?&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-14313&quot; title=&quot;After a Connection sees ConnectionClosingException it never recovers&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-14313&quot;&gt;&lt;del&gt;HBASE-14313&lt;/del&gt;&lt;/a&gt; addendum moved the close back in under the lock.... I missed that in review (should have had a broader context looking at the patch)... but it ran conditionally. Then &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-14449&quot; title=&quot;Rewrite deadlock prevention for concurrent connection close&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-14449&quot;&gt;&lt;del&gt;HBASE-14449&lt;/del&gt;&lt;/a&gt; changed it so we always ran the close code whether it had been run already or not which made the lock up more likely.&lt;/p&gt;

&lt;p&gt;The original Jurriaan Mous code didn&apos;t do the close....&lt;/p&gt;

&lt;p&gt;900	          // We set the value inside the synchronized block, this way the next in line&lt;br/&gt;
901	          //  won&apos;t even try to write&lt;br/&gt;
902	          shouldCloseConnection.set(true);&lt;br/&gt;
903	          writeException = e;&lt;/p&gt;

&lt;p&gt;On your patch,&lt;/p&gt;

&lt;p&gt;917	          //  won&apos;t even try to write. Otherwise we might miss a call in the calls map?&lt;br/&gt;
918	          shouldCloseConnection.set(true);&lt;/p&gt;

&lt;p&gt;... you don&apos;t want to call markClose instead of the above?&lt;/p&gt;

&lt;p&gt;Agree with the undoings of &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-14449&quot; title=&quot;Rewrite deadlock prevention for concurrent connection close&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-14449&quot;&gt;&lt;del&gt;HBASE-14449&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Patch looks good.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=eclark&quot; class=&quot;user-hover&quot; rel=&quot;eclark&quot;&gt;Elliott Clark&lt;/a&gt; Why you not seeing this lockup?  Because you don&apos;t have &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-14449&quot; title=&quot;Rewrite deadlock prevention for concurrent connection close&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-14449&quot;&gt;&lt;del&gt;HBASE-14449&lt;/del&gt;&lt;/a&gt;?&lt;/p&gt;

&lt;p&gt;Nice one &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=enis&quot; class=&quot;user-hover&quot; rel=&quot;enis&quot;&gt;Enis Soztutar&lt;/a&gt; &lt;/p&gt;</comment>
                            <comment id="14906910" author="enis" created="Thu, 24 Sep 2015 20:03:55 +0000"  >&lt;blockquote&gt;&lt;p&gt;... you don&apos;t want to call markClose instead of the above?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Yes. markClose() is synchronized since it is doing the &lt;tt&gt;nofityAll()&lt;/tt&gt;, we cannot call it while holding the &lt;tt&gt;outLock&lt;/tt&gt; due to deadlock. The patch does &lt;tt&gt;shouldCloseConnection.set(true);&lt;/tt&gt; there, and immediately after we call markClose() and close() outside of the outLock monitor: &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
     &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (writeException != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (markClosed(writeException)) {
          close();
        }
      }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;blockquote&gt;&lt;p&gt;Elliott Clark Why you not seeing this lockup? Because you don&apos;t have &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-14449&quot; title=&quot;Rewrite deadlock prevention for concurrent connection close&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-14449&quot;&gt;&lt;del&gt;HBASE-14449&lt;/del&gt;&lt;/a&gt;?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;This is relatively easy to reproduce with CM running. We saw it in ITLAV runs where the map task times out stuck in the deadlock.&lt;/p&gt;</comment>
                            <comment id="14906923" author="stack" created="Thu, 24 Sep 2015 20:12:38 +0000"  >&lt;p&gt;Ok. Patch LGTM. Working on your cluster &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=enis&quot; class=&quot;user-hover&quot; rel=&quot;enis&quot;&gt;Enis Soztutar&lt;/a&gt; ? +1 Want me to do up a test? Seems like it would be easy to make a deadlock in current code base.&lt;/p&gt;</comment>
                            <comment id="14907109" author="enis" created="Thu, 24 Sep 2015 21:57:41 +0000"  >&lt;blockquote&gt;&lt;p&gt;Working on your cluster Enis Soztutar ? +1 Want me to do up a test? Seems like it would be easy to make a deadlock in current code base.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Yep, I was able to write 30M rows from ITLAV which was timing out previously. &lt;br/&gt;
Let me commit it then. Extra testing won&apos;t hurt though &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="14908443" author="enis" created="Fri, 25 Sep 2015 18:13:25 +0000"  >&lt;p&gt;I have committed this. Thanks Stack for taking a look. &lt;/p&gt;</comment>
                            <comment id="14908593" author="hudson" created="Fri, 25 Sep 2015 20:07:53 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-1.0 #1057 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-1.0/1057/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-1.0/1057/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-14474&quot; title=&quot;DeadLock in RpcClientImpl.Connection.close() &quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-14474&quot;&gt;&lt;del&gt;HBASE-14474&lt;/del&gt;&lt;/a&gt; DeadLock in RpcClientImpl.Connection.close() (enis: rev e3b2608819f51c296b3e5108f58be1d50a9a8ed5)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-client/src/main/java/org/apache/hadoop/hbase/ipc/RpcClientImpl.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14908639" author="hudson" created="Fri, 25 Sep 2015 20:37:45 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-TRUNK #6842 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/6842/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/6842/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-14474&quot; title=&quot;DeadLock in RpcClientImpl.Connection.close() &quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-14474&quot;&gt;&lt;del&gt;HBASE-14474&lt;/del&gt;&lt;/a&gt; DeadLock in RpcClientImpl.Connection.close() (enis: rev 32f49fa7fc2bcad0004e249887cc1973becc98db)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-client/src/main/java/org/apache/hadoop/hbase/ipc/RpcClientImpl.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14908657" author="yuzhihong@gmail.com" created="Fri, 25 Sep 2015 20:56:28 +0000"  >&lt;p&gt;If I read the code correctly, the call to shouldCloseConnection.set(true) around line 919 would result in markClosed() outside the synchronized block returning false because shouldCloseConnection is true by that time.&lt;/p&gt;

&lt;p&gt;Hopefully attached addendum does what Enis intended to do originally.&lt;/p&gt;

&lt;p&gt;I ran the addendum through test suite which passed.&lt;/p&gt;</comment>
                            <comment id="14908696" author="hudson" created="Fri, 25 Sep 2015 21:24:32 +0000"  >&lt;p&gt;SUCCESS: Integrated in HBase-1.2-IT #169 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-1.2-IT/169/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-1.2-IT/169/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-14474&quot; title=&quot;DeadLock in RpcClientImpl.Connection.close() &quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-14474&quot;&gt;&lt;del&gt;HBASE-14474&lt;/del&gt;&lt;/a&gt; DeadLock in RpcClientImpl.Connection.close() (enis: rev ff4d93e59d7393918eeedf12108fb4c371bf0402)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-client/src/main/java/org/apache/hadoop/hbase/ipc/RpcClientImpl.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14908699" author="hudson" created="Fri, 25 Sep 2015 21:25:14 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-1.1 #680 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-1.1/680/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-1.1/680/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-14474&quot; title=&quot;DeadLock in RpcClientImpl.Connection.close() &quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-14474&quot;&gt;&lt;del&gt;HBASE-14474&lt;/del&gt;&lt;/a&gt; DeadLock in RpcClientImpl.Connection.close() (enis: rev 77e2bc95c6dc56c5a579e2b18c15a8a2ffe13cc7)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-client/src/main/java/org/apache/hadoop/hbase/ipc/RpcClientImpl.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14908709" author="enis" created="Fri, 25 Sep 2015 21:34:29 +0000"  >&lt;blockquote&gt;&lt;p&gt;If I read the code correctly, the call to shouldCloseConnection.set(true) around line 919 would result in markClosed() outside the synchronized block returning false because shouldCloseConnection is true by that time.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Right. But we cannot skip calling shouldCloseConnection in that synchronized block I think. The problem is that writeRequest() is called by different threads and the logic there corresponding to this comment: &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
          &lt;span class=&quot;code-comment&quot;&gt;// We set the value inside the &lt;span class=&quot;code-keyword&quot;&gt;synchronized&lt;/span&gt; block, &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; way the next in line
&lt;/span&gt;          &lt;span class=&quot;code-comment&quot;&gt;//  won&apos;t even &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; to write. Otherwise we might miss a call in the calls map?&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;means that the assumption is that before giving the outLock, we have to ensure that no more calls can be added to the &lt;tt&gt;calls&lt;/tt&gt; map. &lt;/p&gt;</comment>
                            <comment id="14908710" author="hudson" created="Fri, 25 Sep 2015 21:34:54 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-1.2 #201 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-1.2/201/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-1.2/201/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-14474&quot; title=&quot;DeadLock in RpcClientImpl.Connection.close() &quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-14474&quot;&gt;&lt;del&gt;HBASE-14474&lt;/del&gt;&lt;/a&gt; DeadLock in RpcClientImpl.Connection.close() (enis: rev ff4d93e59d7393918eeedf12108fb4c371bf0402)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-client/src/main/java/org/apache/hadoop/hbase/ipc/RpcClientImpl.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14908711" author="yuzhihong@gmail.com" created="Fri, 25 Sep 2015 21:39:13 +0000"  >&lt;p&gt;Alright then.&lt;/p&gt;

&lt;p&gt;How about addendum v2 ?&lt;/p&gt;</comment>
                            <comment id="14908730" author="hudson" created="Fri, 25 Sep 2015 22:00:45 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-1.3-IT #183 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-1.3-IT/183/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-1.3-IT/183/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-14474&quot; title=&quot;DeadLock in RpcClientImpl.Connection.close() &quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-14474&quot;&gt;&lt;del&gt;HBASE-14474&lt;/del&gt;&lt;/a&gt; DeadLock in RpcClientImpl.Connection.close() (enis: rev bc1a03d9b4b2c64c9fe0c32fdc65174c0edf80bf)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-client/src/main/java/org/apache/hadoop/hbase/ipc/RpcClientImpl.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14908744" author="enis" created="Fri, 25 Sep 2015 22:09:33 +0000"  >&lt;p&gt;+1 for addendum v2. I wonder what would happen if we happen to call close() without markClosed(). Since it seems that the markClose() call here will immediately return since we already manually set shouldCloseConnection. &lt;/p&gt;</comment>
                            <comment id="14908757" author="hudson" created="Fri, 25 Sep 2015 22:20:32 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-1.3 #206 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-1.3/206/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-1.3/206/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-14474&quot; title=&quot;DeadLock in RpcClientImpl.Connection.close() &quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-14474&quot;&gt;&lt;del&gt;HBASE-14474&lt;/del&gt;&lt;/a&gt; DeadLock in RpcClientImpl.Connection.close() (enis: rev bc1a03d9b4b2c64c9fe0c32fdc65174c0edf80bf)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-client/src/main/java/org/apache/hadoop/hbase/ipc/RpcClientImpl.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14908775" author="stack" created="Fri, 25 Sep 2015 22:29:52 +0000"  >&lt;p&gt;Can we not commit any more changes here without unit test that first demos the problem and proves the fix or the patch is run on cluster with loading that in the past produced the issue?&lt;/p&gt;</comment>
                            <comment id="14908854" author="enis" created="Fri, 25 Sep 2015 23:13:32 +0000"  >&lt;p&gt;Yeah sorry about that. We are trying to unblock testing on our end which was hitting this in ITLAV and couple of others. Now after the main fix, some other test is also getting ConnectionClosingExceptions that we are trying to debug what is going on. The addendum was found due to tha t. &lt;br/&gt;
I&apos;ll try to add some unit testing in this area.  &lt;/p&gt;</comment>
                            <comment id="14908866" author="stack" created="Fri, 25 Sep 2015 23:19:27 +0000"  >&lt;blockquote&gt;&lt;p&gt;Now after the main fix, some other test is also getting ConnectionClosingExceptions that we are trying to debug what is going on. The addendum was found due to tha t. &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I it is being driven by actual test/findings, that is totally different. Trying to follow-along, the above came across as postulate in an arcane area that has already been hacked on a bunch... Thanks.&lt;/p&gt;</comment>
                            <comment id="14909038" author="hudson" created="Sat, 26 Sep 2015 03:33:17 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-TRUNK #6844 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/6844/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/6844/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-14474&quot; title=&quot;DeadLock in RpcClientImpl.Connection.close() &quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-14474&quot;&gt;&lt;del&gt;HBASE-14474&lt;/del&gt;&lt;/a&gt; Addendum closes connection in writeRequest() outside synchronized block (tedyu: rev dc2aa7e513a5c9ca1cd748b5d28a5109b37dee45)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-client/src/main/java/org/apache/hadoop/hbase/ipc/RpcClientImpl.java&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-14474&quot; title=&quot;DeadLock in RpcClientImpl.Connection.close() &quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-14474&quot;&gt;&lt;del&gt;HBASE-14474&lt;/del&gt;&lt;/a&gt; Revert addendum (tedyu: rev 414a7b18b12bdda51effcc7074c6134364fedf42)&lt;/li&gt;
	&lt;li&gt;hbase-client/src/main/java/org/apache/hadoop/hbase/ipc/RpcClientImpl.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14909205" author="stack" created="Sat, 26 Sep 2015 11:15:05 +0000"  >&lt;p&gt;These two commits were made against this issue:&lt;/p&gt;

&lt;p&gt;commit 414a7b18b12bdda51effcc7074c6134364fedf42&lt;br/&gt;
Author: tedyu &amp;lt;yuzhihong@gmail.com&amp;gt;&lt;br/&gt;
Date:   Fri Sep 25 15:48:08 2015 -0700&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-14474&quot; title=&quot;DeadLock in RpcClientImpl.Connection.close() &quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-14474&quot;&gt;&lt;del&gt;HBASE-14474&lt;/del&gt;&lt;/a&gt; Revert addendum&lt;/p&gt;

&lt;p&gt;commit dc2aa7e513a5c9ca1cd748b5d28a5109b37dee45&lt;br/&gt;
Author: tedyu &amp;lt;yuzhihong@gmail.com&amp;gt;&lt;br/&gt;
Date:   Fri Sep 25 15:18:21 2015 -0700&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-14474&quot; title=&quot;DeadLock in RpcClientImpl.Connection.close() &quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-14474&quot;&gt;&lt;del&gt;HBASE-14474&lt;/del&gt;&lt;/a&gt; Addendum closes connection in writeRequest() outside synchronized block&lt;/p&gt;

&lt;p&gt;... but there is no note in the  JIRA.  There is no comment as to why the revert (it looks like it broke unit tests).&lt;/p&gt;

&lt;p&gt;Not talking out loud makes it hard to keep up. I just wasted a bunch of time trying to bisect where master unit tests got broke.&lt;/p&gt;</comment>
                            <comment id="14909270" author="yuzhihong@gmail.com" created="Sat, 26 Sep 2015 13:11:14 +0000"  >&lt;p&gt;Since yesterday afternoon, into the night, our hbase team tried to find root cause for several failing system tests.&lt;br/&gt;
I was working on multiple internal tickets.&lt;/p&gt;

&lt;p&gt;I should have commented on this JIRA for the revert.&lt;br/&gt;
The reason was not due to failing unit test. I ran both addendum 1 and 2 through test suite locally. They both passed.&lt;/p&gt;

&lt;p&gt;The revert is to gain consensus on the efficacy of addendum 2 (the first commit was made between Enis&apos; +1 and Stack&apos;s comment).&lt;/p&gt;

&lt;p&gt;I am confident in the correctness of addendum 2.&lt;/p&gt;</comment>
                            <comment id="14934246" author="enis" created="Mon, 28 Sep 2015 22:46:51 +0000"  >&lt;p&gt;Re-opening till we decide on the next steps and more testing. &lt;/p&gt;</comment>
                            <comment id="14951370" author="ndimiduk" created="Fri, 9 Oct 2015 23:18:53 +0000"  >&lt;p&gt;Any conclusion here? This is last blocker for 1.1.3.&lt;/p&gt;</comment>
                            <comment id="14955434" author="apurtell" created="Tue, 13 Oct 2015 18:36:26 +0000"  >&lt;p&gt;What is the current state of your tests &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=enis&quot; class=&quot;user-hover&quot; rel=&quot;enis&quot;&gt;Enis Soztutar&lt;/a&gt; / &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ted_yu&quot; class=&quot;user-hover&quot; rel=&quot;ted_yu&quot;&gt;Ted Yu&lt;/a&gt;?&lt;/p&gt;

&lt;p&gt;I tried to follow the above and have concerns. If these changes didn&apos;t fix the tests or introduced new problems I prefer we back everything out and try again once we have a complete solution. Or, if tests are passing, let&apos;s resolve this. &lt;/p&gt;</comment>
                            <comment id="14956102" author="enis" created="Wed, 14 Oct 2015 01:33:58 +0000"  >&lt;p&gt;The v3 patch fixes the above deadlock case in our testing and the test from &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-14535&quot; title=&quot;Integration test for rpc connection concurrency / deadlock testing &quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-14535&quot;&gt;&lt;del&gt;HBASE-14535&lt;/del&gt;&lt;/a&gt;. The deadlock is easily reproducible with either running ITLAV with CM or running the test at &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-14535&quot; title=&quot;Integration test for rpc connection concurrency / deadlock testing &quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-14535&quot;&gt;&lt;del&gt;HBASE-14535&lt;/del&gt;&lt;/a&gt; 10 times. ITLAV with CM also passes on top of v3+addendum2. &lt;br/&gt;
v3 patch makes it so that &lt;tt&gt;close()&lt;/tt&gt; is not called anymore from the writeRequest() failure. Instead close() is always called from &lt;tt&gt;Connection#run()&lt;/tt&gt;. Originally, &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-14313&quot; title=&quot;After a Connection sees ConnectionClosingException it never recovers&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-14313&quot;&gt;&lt;del&gt;HBASE-14313&lt;/del&gt;&lt;/a&gt; made it so that &lt;tt&gt;close()&lt;/tt&gt; is explicitly called. However, neither our test rig nor &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-14535&quot; title=&quot;Integration test for rpc connection concurrency / deadlock testing &quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-14535&quot;&gt;&lt;del&gt;HBASE-14535&lt;/del&gt;&lt;/a&gt; can reproduce an issue with only v3 but not with addendum2. However, after reading the code, we seem to be closing the connection, but the extra &lt;tt&gt;close()&lt;/tt&gt; call will not hurt. I believe we should commit the addendum2 as well, and resolve this issue. &lt;/p&gt;</comment>
                            <comment id="14959952" author="apurtell" created="Fri, 16 Oct 2015 00:48:17 +0000"  >&lt;blockquote&gt;&lt;p&gt;I believe we should commit the addendum2 as well, and resolve this issue.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Ok, +1&lt;/p&gt;</comment>
                            <comment id="14961237" author="enis" created="Fri, 16 Oct 2015 19:23:06 +0000"  >&lt;p&gt;Thanks. I&apos;ve pushed the addendum patch to 1.0+, &lt;/p&gt;</comment>
                            <comment id="14961369" author="hudson" created="Fri, 16 Oct 2015 21:15:36 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-1.0 #1088 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-1.0/1088/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-1.0/1088/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-14474&quot; title=&quot;DeadLock in RpcClientImpl.Connection.close() &quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-14474&quot;&gt;&lt;del&gt;HBASE-14474&lt;/del&gt;&lt;/a&gt; Addendum closes connection in writeRequest() outside (enis: rev 0ac70bfe4bc88b271f415347b1e31aaf7a2a87e6)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-client/src/main/java/org/apache/hadoop/hbase/ipc/RpcClientImpl.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14961385" author="hudson" created="Fri, 16 Oct 2015 21:29:53 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-TRUNK #6921 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/6921/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/6921/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-14474&quot; title=&quot;DeadLock in RpcClientImpl.Connection.close() &quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-14474&quot;&gt;&lt;del&gt;HBASE-14474&lt;/del&gt;&lt;/a&gt; Addendum closes connection in writeRequest() outside (enis: rev 6076ed2a127705ab9301597ee22b1bf2bbbec991)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-client/src/main/java/org/apache/hadoop/hbase/ipc/RpcClientImpl.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14961393" author="hudson" created="Fri, 16 Oct 2015 21:37:28 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-1.1 #711 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-1.1/711/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-1.1/711/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-14474&quot; title=&quot;DeadLock in RpcClientImpl.Connection.close() &quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-14474&quot;&gt;&lt;del&gt;HBASE-14474&lt;/del&gt;&lt;/a&gt; Addendum closes connection in writeRequest() outside (enis: rev f2b059ea7a36866079f1babc13d2d561bcf4e42b)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-client/src/main/java/org/apache/hadoop/hbase/ipc/RpcClientImpl.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14961398" author="hudson" created="Fri, 16 Oct 2015 21:40:56 +0000"  >&lt;p&gt;SUCCESS: Integrated in HBase-1.2-IT #217 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-1.2-IT/217/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-1.2-IT/217/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-14474&quot; title=&quot;DeadLock in RpcClientImpl.Connection.close() &quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-14474&quot;&gt;&lt;del&gt;HBASE-14474&lt;/del&gt;&lt;/a&gt; Addendum closes connection in writeRequest() outside (enis: rev 2040d8dfc2a6c3910336a903b21a122ac025352e)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-client/src/main/java/org/apache/hadoop/hbase/ipc/RpcClientImpl.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14961408" author="hudson" created="Fri, 16 Oct 2015 21:48:10 +0000"  >&lt;p&gt;SUCCESS: Integrated in HBase-1.3-IT #244 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-1.3-IT/244/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-1.3-IT/244/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-14474&quot; title=&quot;DeadLock in RpcClientImpl.Connection.close() &quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-14474&quot;&gt;&lt;del&gt;HBASE-14474&lt;/del&gt;&lt;/a&gt; Addendum closes connection in writeRequest() outside (enis: rev 6dc33cad75c9581a5008c78b8c0f8181b3c93deb)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-client/src/main/java/org/apache/hadoop/hbase/ipc/RpcClientImpl.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14961509" author="hudson" created="Fri, 16 Oct 2015 23:08:25 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-1.2 #266 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-1.2/266/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-1.2/266/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-14474&quot; title=&quot;DeadLock in RpcClientImpl.Connection.close() &quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-14474&quot;&gt;&lt;del&gt;HBASE-14474&lt;/del&gt;&lt;/a&gt; Addendum closes connection in writeRequest() outside (enis: rev 2040d8dfc2a6c3910336a903b21a122ac025352e)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-client/src/main/java/org/apache/hadoop/hbase/ipc/RpcClientImpl.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14961524" author="hudson" created="Fri, 16 Oct 2015 23:21:59 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-1.3 #274 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-1.3/274/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-1.3/274/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-14474&quot; title=&quot;DeadLock in RpcClientImpl.Connection.close() &quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-14474&quot;&gt;&lt;del&gt;HBASE-14474&lt;/del&gt;&lt;/a&gt; Addendum closes connection in writeRequest() outside (enis: rev 6dc33cad75c9581a5008c78b8c0f8181b3c93deb)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-client/src/main/java/org/apache/hadoop/hbase/ipc/RpcClientImpl.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15119520" author="ndimiduk" created="Wed, 27 Jan 2016 15:28:42 +0000"  >&lt;p&gt;Bulk closing 1.1.3 issues.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12762462" name="14474-addendum-2.txt" size="786" author="yuzhihong@gmail.com" created="Fri, 25 Sep 2015 21:39:13 +0000"/>
                            <attachment id="12762454" name="14474-addendum.txt" size="852" author="yuzhihong@gmail.com" created="Fri, 25 Sep 2015 20:53:31 +0000"/>
                            <attachment id="12762027" name="hbase-14474_v1.patch" size="1338" author="enis" created="Thu, 24 Sep 2015 01:18:21 +0000"/>
                            <attachment id="12762043" name="hbase-14474_v2.patch" size="3409" author="enis" created="Thu, 24 Sep 2015 03:30:56 +0000"/>
                            <attachment id="12762044" name="hbase-14474_v3.patch" size="2752" author="enis" created="Thu, 24 Sep 2015 03:35:36 +0000"/>
                    </attachments>
                <subtasks>
                            <subtask id="12902015">HBASE-14535</subtask>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 24 Sep 2015 01:39:41 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            44 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2lhov:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>