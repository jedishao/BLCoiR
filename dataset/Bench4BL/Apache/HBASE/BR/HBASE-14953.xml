<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Thu Dec 01 22:44:57 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-14953/HBASE-14953.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-14953] HBaseInterClusterReplicationEndpoint: Do not retry the whole batch of edits in case of RejectedExecutionException</title>
                <link>https://issues.apache.org/jira/browse/HBASE-14953</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;When we have wal provider set to multiwal, the ReplicationSource has multiple worker threads submitting batches to HBaseInterClusterReplicationEndpoint. In such a scenario, it is quite common to encounter RejectedExecutionException because it takes quite long for shipping edits to peer cluster compared to reading edits from source and submitting more batches to the endpoint. &lt;br/&gt;
The logs are just filled with warnings due to this very exception.&lt;/p&gt;

&lt;p&gt;Since we subdivide batches before actually shipping them, we don&apos;t need to fail and resend the whole batch if one of the sub-batches fails with RejectedExecutionException. Rather, we should just retry the failed sub-batches. &lt;/p&gt;</description>
                <environment></environment>
        <key id="12920223">HBASE-14953</key>
            <summary>HBaseInterClusterReplicationEndpoint: Do not retry the whole batch of edits in case of RejectedExecutionException</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.png">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ashu210890">Ashu Pachauri</assignee>
                                    <reporter username="ashu210890">Ashu Pachauri</reporter>
                        <labels>
                    </labels>
                <created>Tue, 8 Dec 2015 22:55:59 +0000</created>
                <updated>Sat, 12 Dec 2015 03:31:35 +0000</updated>
                            <resolved>Fri, 11 Dec 2015 21:22:27 +0000</resolved>
                                    <version>2.0.0</version>
                    <version>1.2.0</version>
                    <version>1.3.0</version>
                                    <fixVersion>2.0.0</fixVersion>
                    <fixVersion>1.2.0</fixVersion>
                    <fixVersion>1.3.0</fixVersion>
                                    <component>Replication</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                <comments>
                            <comment id="15047647" author="ashu210890" created="Tue, 8 Dec 2015 23:03:40 +0000"  >&lt;p&gt;V1: Retries remaining batches after sleeping in case we fail submitting new batches. &lt;br/&gt;
One line of thought is we could try using another custom policy of threadpoolexecutor, that blocks on RejectedExecutionException. However, I don&apos;t feel comfortable with that, because such an implementation is prone to side-effects.&lt;/p&gt;</comment>
                            <comment id="15049885" author="ashu210890" created="Thu, 10 Dec 2015 02:30:50 +0000"  >&lt;p&gt;To give more context on why we really need to do this:&lt;br/&gt;
1. This impacts replication performance, because we are retrying unnecessarily.&lt;br/&gt;
2. The more pressing concern is that this creates significant extra traffic to peer clusters, because a good chunk of edits already sent across the wire (which would potentially succeed) are resent. This translates into more load on both the clusters.&lt;br/&gt;
3. Clutters the logs with too many warning. The major portion of logs is filled with these exceptions.&lt;br/&gt;
These factors become more significant in a high traffic environment. &lt;/p&gt;</comment>
                            <comment id="15050198" author="lhofhansl" created="Thu, 10 Dec 2015 06:50:20 +0000"  >&lt;p&gt;Interesting, didn&apos;t think of that case. Amazing how many problems a little change like this can cause.&lt;/p&gt;

&lt;p&gt;Why not add a real queue (i.e. not synchronous queue)? (In that case we need to set coreThreads to maxThreads as well, and allow core threads to time out)&lt;/p&gt;

&lt;p&gt;Since we&apos;re waiting on the futures to finish anyway, as they sit in the queue we&apos;d naturally wait exactly the right amount of time, so the queue can be unbounded - eventually we&apos;d have all workers waiting, which is what we want.&lt;/p&gt;</comment>
                            <comment id="15051522" author="ashu210890" created="Thu, 10 Dec 2015 19:39:11 +0000"  >&lt;p&gt;If we use a bounded queue with fixed bounds, we will encounter the same issue, just a lot less frequently. But, yeah, your idea of unbounded queue certainly makes sense. We will anyways have a maximum of  (number of WAL groups)*maxThreads number of items in the queue. I will make the change.&lt;/p&gt;</comment>
                            <comment id="15051647" author="ashu210890" created="Thu, 10 Dec 2015 21:04:28 +0000"  >&lt;p&gt;V2: replacing SynchronousQueue with LinkedBlockingQueue.&lt;/p&gt;</comment>
                            <comment id="15051851" author="eclark" created="Thu, 10 Dec 2015 23:29:42 +0000"  >&lt;p&gt;I don&apos;t think that we want to set allowCoreThreadTimeOut. If the threads go away they will never come back. &lt;/p&gt;</comment>
                            <comment id="15051858" author="ashu210890" created="Thu, 10 Dec 2015 23:41:50 +0000"  >&lt;p&gt;The core threads do come back when new tasks arrive even if they had terminated after a time out. It&apos;s just that they will be replaced with new threads. Since we don&apos;t maintain any thread local state here, I guess that should be okay.&lt;/p&gt;</comment>
                            <comment id="15051869" author="eclark" created="Thu, 10 Dec 2015 23:50:00 +0000"  >&lt;p&gt;Yeah I must have never tried with coreThreads = maxThreads. lgtm.&lt;/p&gt;</comment>
                            <comment id="15052262" author="lhofhansl" created="Fri, 11 Dec 2015 06:26:02 +0000"  >&lt;p&gt;+1 on V2.&lt;br/&gt;
I assume it still fixes the issue you&apos;ve seen? &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="15052263" author="lhofhansl" created="Fri, 11 Dec 2015 06:27:02 +0000"  >&lt;p&gt;If not objection I&apos;m going to commit tomorrow.&lt;/p&gt;</comment>
                            <comment id="15052499" author="ashu210890" created="Fri, 11 Dec 2015 09:26:35 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lhofhansl&quot; class=&quot;user-hover&quot; rel=&quot;lhofhansl&quot;&gt;Lars Hofhansl&lt;/a&gt; Yes, I have tested the patch.&lt;/p&gt;</comment>
                            <comment id="15053515" author="hadoopqa" created="Fri, 11 Dec 2015 20:27:16 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12776889/HBASE-14953-V2.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12776889/HBASE-14953-V2.patch&lt;/a&gt;&lt;br/&gt;
  against master branch at commit 22b95aebcd7fc742412ab514520008fda5e327de.&lt;br/&gt;
  ATTACHMENT ID: 12776889&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 tests included&lt;/font&gt;.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop versions&lt;/font&gt;. The patch compiles with all supported hadoop versions (2.4.0 2.4.1 2.5.0 2.5.1 2.5.2 2.6.0 2.6.1 2.7.0 2.7.1)&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 protoc&lt;/font&gt;.  The applied patch does not increase the total number of protoc compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 checkstyle&lt;/font&gt;. The applied patch does not generate new checkstyle errors.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any  new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn post-site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 core tests&lt;/font&gt;.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 zombies&lt;/font&gt;. No zombie tests found running at the end of the build.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/16835//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/16835//testReport/&lt;/a&gt;&lt;br/&gt;
Release Findbugs (version 2.0.3) 	warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/16835//artifact/patchprocess/newFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/16835//artifact/patchprocess/newFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Checkstyle Errors: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/16835//artifact/patchprocess/checkstyle-aggregate.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/16835//artifact/patchprocess/checkstyle-aggregate.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;  Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/16835//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/16835//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="15053581" author="eclark" created="Fri, 11 Dec 2015 21:22:27 +0000"  >&lt;p&gt;Pushed to branch-1.2, branch-1, and master.&lt;/p&gt;

&lt;p&gt;Thanks for the patch &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ashu210890&quot; class=&quot;user-hover&quot; rel=&quot;ashu210890&quot;&gt;Ashu Pachauri&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15053863" author="hudson" created="Sat, 12 Dec 2015 00:47:36 +0000"  >&lt;p&gt;SUCCESS: Integrated in HBase-1.2-IT #336 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-1.2-IT/336/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-1.2-IT/336/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-14953&quot; title=&quot;HBaseInterClusterReplicationEndpoint: Do not retry the whole batch of edits in case of RejectedExecutionException&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-14953&quot;&gt;&lt;del&gt;HBASE-14953&lt;/del&gt;&lt;/a&gt; Replication: retry on RejectedExecutionException (eclark: rev daa755801fda34203f6eef9ae8331d99aaa2c2cd)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/replication/regionserver/HBaseInterClusterReplicationEndpoint.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15053880" author="hudson" created="Sat, 12 Dec 2015 00:58:21 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-Trunk_matrix #547 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-Trunk_matrix/547/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-Trunk_matrix/547/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-14953&quot; title=&quot;HBaseInterClusterReplicationEndpoint: Do not retry the whole batch of edits in case of RejectedExecutionException&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-14953&quot;&gt;&lt;del&gt;HBASE-14953&lt;/del&gt;&lt;/a&gt; Replication: retry on RejectedExecutionException (eclark: rev 453a66c3b9d4f51311db6acc5cba84290dbd29ed)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/replication/regionserver/HBaseInterClusterReplicationEndpoint.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15053911" author="hudson" created="Sat, 12 Dec 2015 01:22:30 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-1.3-IT #370 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-1.3-IT/370/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-1.3-IT/370/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-14953&quot; title=&quot;HBaseInterClusterReplicationEndpoint: Do not retry the whole batch of edits in case of RejectedExecutionException&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-14953&quot;&gt;&lt;del&gt;HBASE-14953&lt;/del&gt;&lt;/a&gt; Replication: retry on RejectedExecutionException (eclark: rev 9e6acffca07b0d0206c8a5686347687050223de9)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/replication/regionserver/HBaseInterClusterReplicationEndpoint.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15053999" author="hudson" created="Sat, 12 Dec 2015 03:24:17 +0000"  >&lt;p&gt;SUCCESS: Integrated in HBase-1.3 #433 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-1.3/433/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-1.3/433/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-14953&quot; title=&quot;HBaseInterClusterReplicationEndpoint: Do not retry the whole batch of edits in case of RejectedExecutionException&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-14953&quot;&gt;&lt;del&gt;HBASE-14953&lt;/del&gt;&lt;/a&gt; Replication: retry on RejectedExecutionException (eclark: rev 9e6acffca07b0d0206c8a5686347687050223de9)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/replication/regionserver/HBaseInterClusterReplicationEndpoint.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15054005" author="hudson" created="Sat, 12 Dec 2015 03:31:35 +0000"  >&lt;p&gt;SUCCESS: Integrated in HBase-1.2 #439 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-1.2/439/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-1.2/439/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-14953&quot; title=&quot;HBaseInterClusterReplicationEndpoint: Do not retry the whole batch of edits in case of RejectedExecutionException&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-14953&quot;&gt;&lt;del&gt;HBASE-14953&lt;/del&gt;&lt;/a&gt; Replication: retry on RejectedExecutionException (eclark: rev daa755801fda34203f6eef9ae8331d99aaa2c2cd)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/replication/regionserver/HBaseInterClusterReplicationEndpoint.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12776430" name="HBASE-14953-V1.patch" size="3245" author="ashu210890" created="Tue, 8 Dec 2015 23:03:40 +0000"/>
                            <attachment id="12776889" name="HBASE-14953-V2.patch" size="2192" author="ashu210890" created="Thu, 10 Dec 2015 21:04:28 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 10 Dec 2015 06:50:20 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            50 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2pmin:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>