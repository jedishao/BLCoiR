<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sat Dec 03 16:11:48 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-2197/HBASE-2197.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-2197] Start replication from a point in time</title>
                <link>https://issues.apache.org/jira/browse/HBASE-2197</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;One way to set up a cluster for replication is to distcp all files then start the replication. We need a way to make sure we don&apos;t miss any edits by being able to start a process that reads old log files from a defined point in time and send them to a specific slave cluster and then catch up with normal replication.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12455718">HBASE-2197</key>
            <summary>Start replication from a point in time</summary>
                <type id="7" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/subtask_alternate.png">Sub-task</type>
                            <parent id="12421518">HBASE-1295</parent>
                                    <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="3">Duplicate</resolution>
                                        <assignee username="jdcryans">Jean-Daniel Cryans</assignee>
                                    <reporter username="jdcryans">Jean-Daniel Cryans</reporter>
                        <labels>
                    </labels>
                <created>Tue, 9 Feb 2010 02:17:02 +0000</created>
                <updated>Fri, 20 Nov 2015 13:02:06 +0000</updated>
                            <resolved>Tue, 13 Jul 2010 19:03:12 +0000</resolved>
                                                    <fixVersion>0.90.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="12831764" author="jdcryans" created="Tue, 9 Feb 2010 23:46:57 +0000"  >&lt;p&gt;Basically I see two ways of solving this problem:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;The master cluster itself reads the old edits and streams them to the slave cluster using a distributed queue for all files to process.&lt;/li&gt;
	&lt;li&gt;The master cluster does a distcp-like operation to ship all files to the slave which will be responsible to replay them.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;The second solution can be implemented very easily by making some operations sequentially. First the user runs a jruby script on the master cluster to move all files to the slave cluster sequentially, then run another script on the slave cluster to apply all edits sequentially from all files.&lt;/p&gt;

&lt;p&gt;An upgrade would be to copy (or move) the desired files on the master cluster to a different folder and start a real distcp to the slave cluster. Then on the slave cluster start a MapReduce job to process all those files. It&apos;s still manual but much faster.&lt;/p&gt;

&lt;p&gt;The next problem to tackle is how to switch from sending files to streaming the edits. An easy solution would be to start the replication as soon as the initial distcp of all the data is done and then start a second copying of all the files to reapply. There&apos;s 2 issues with that:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;How do we make sure that when we start the second distcp that all the files we need are in the HLog archive folder? There&apos;s a possibility that some are still &quot;active&quot; in some region servers&apos; .logs folder and that we may miss them. A workaround would be to wait long enough to make sure everything is archived.&lt;/li&gt;
	&lt;li&gt;Currently random reads have that problem where the can return older versions of the data if a timestamp in the memstore is older than data in the store files. That can easily be the case here because we stream newer edit before applying the old ones. This problem applies only for those who wants to serve ASAP out of the slave cluster although they will also have to deal with missing data (which is in transfer). So this could even be a non-issue.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="12831823" author="ryanobjc" created="Wed, 10 Feb 2010 02:17:26 +0000"  >&lt;p&gt;I am not generally a fan of depending on files and region layout.  We need to have a system where we can bring up a cluster immediately and get new edits in then pull in the rest of them as fast as possible.  I think the latter process should be out of bounds, ie: lets keep the replication core in HRS really small, then add value on and around it, possibly with some HRS hooks if necessary.&lt;/p&gt;

&lt;p&gt;As for the random read issue, we should highly consider removing that code.&lt;/p&gt;</comment>
                            <comment id="12832081" author="apurtell" created="Wed, 10 Feb 2010 17:19:21 +0000"  >&lt;p&gt;My expectation as a user is that I would turn on replication and then do a MR job to transfer already stored data from the source cluster to the new peer. So this is iterating over and streaming values, not shipping files. In this way I would not miss any new edits because they are already replicating even as I am bringing over the values persisted before replication started, with timestamps preserved. But, I would also have my clocks NTP synchronized and I would not be manually adjusting timestamps. &lt;/p&gt;</comment>
                            <comment id="12832087" author="apurtell" created="Wed, 10 Feb 2010 17:32:26 +0000"  >&lt;blockquote&gt;&lt;p&gt;Currently random reads have that problem where they can return older versions of the data if a timestamp in the memstore is older than data in the store files.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;That&apos;s a bug. Let&apos;s file a jira for it and fix it. &lt;/p&gt;</comment>
                            <comment id="12832105" author="jdcryans" created="Wed, 10 Feb 2010 18:17:15 +0000"  >&lt;blockquote&gt;&lt;p&gt;My expectation as a user is that I would turn on replication and then do a MR job to transfer already stored data from the source cluster to the new peer.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Good idea, I feel dumb not thinking about it. So we could ship a MR that takes in input a table and that outputs to a peer cluster, that&apos;s how you see it?&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;That&apos;s a bug. Let&apos;s file a jira for it and fix it.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I think it&apos;s &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-1485&quot; title=&quot;Wrong or indeterminate behavior when there are duplicate versions of a column&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-1485&quot;&gt;&lt;del&gt;HBASE-1485&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12832151" author="apurtell" created="Wed, 10 Feb 2010 19:50:21 +0000"  >&lt;blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;My expectation as a user is that I would turn on replication and then do a MR job to transfer already stored data from the source cluster to the new peer.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;So we could ship a MR that takes in input a table and that outputs to a peer cluster, that&apos;s how you see it?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Something generic we can provide would be helpful. A TOF that supports some notion of remote table? &lt;/p&gt;</comment>
                            <comment id="12832154" author="jdcryans" created="Wed, 10 Feb 2010 19:54:57 +0000"  >&lt;p&gt;@Andrew&lt;/p&gt;

&lt;p&gt;That&apos;s my thought. It would be easily configurable with peer address and time from which to replicate, and could use the replication logic (which will be refactored out) to only replicate the right column families. That sounds badass.&lt;/p&gt;</comment>
                            <comment id="12833119" author="jdcryans" created="Fri, 12 Feb 2010 19:22:49 +0000"  >&lt;p&gt;I opened &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2221&quot; title=&quot;MR to copy a table&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2221&quot;&gt;&lt;del&gt;HBASE-2221&lt;/del&gt;&lt;/a&gt; to develop the MR Andrew and I discussed.&lt;/p&gt;</comment>
                            <comment id="12887934" author="jdcryans" created="Tue, 13 Jul 2010 19:03:12 +0000"  >&lt;p&gt;Using &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2221&quot; title=&quot;MR to copy a table&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2221&quot;&gt;&lt;del&gt;HBASE-2221&lt;/del&gt;&lt;/a&gt; is good enough.&lt;/p&gt;</comment>
                            <comment id="15017979" author="lars_francke" created="Fri, 20 Nov 2015 13:02:06 +0000"  >&lt;p&gt;This issue was closed as part of a bulk closing operation on 2015-11-20. All issues that have been resolved and where all fixVersions have been released have been closed (following discussions on the mailing list).&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 10 Feb 2010 02:17:26 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>32451</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 2 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0hgqv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>99975</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>