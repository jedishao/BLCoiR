<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sat Dec 03 16:06:53 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-11714/HBASE-11714.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-11714] RpcRetryingCaller#callWithoutRetries set rpc timeout to 2 seconds incorrectly</title>
                <link>https://issues.apache.org/jira/browse/HBASE-11714</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Discussed on the user@hbase mailing list (&lt;a href=&quot;http://markmail.org/thread/w3cqjxwo2smkn2jw&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://markmail.org/thread/w3cqjxwo2smkn2jw&lt;/a&gt;)&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&quot;Recently switched from 0.94 and 0.98, and finding that periodically things&lt;br/&gt;
are having issues - lots of retry exceptions&quot; :&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;client log:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;2014-08-08 17:22:43 o.a.h.h.c.AsyncProcess &lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; #105158,&lt;br/&gt;
table=rt_global_monthly_campaign_deliveries, attempt=10/35 failed 500 ops,&lt;br/&gt;
last exception: java.net.SocketTimeoutException: Call to&lt;br/&gt;
ip-10-201-128-23.us-west-1.compute.internal/10.201.128.23:60020 failed&lt;br/&gt;
because java.net.SocketTimeoutException: 2000 millis timeout while waiting&lt;br/&gt;
for channel to be ready for read. ch :&lt;br/&gt;
java.nio.channels.SocketChannel[connected local=/10.248.130.152:46014&lt;br/&gt;
remote=ip-10-201-128-23.us-west-1.compute.internal/10.201.128.23:60020] on&lt;br/&gt;
ip-10-201-128-23.us-west-1.compute.internal,60020,1405642103651, tracking&lt;br/&gt;
started Fri Aug 08 17:21:55 UTC 2014, retrying after 10043 ms, replay 500&lt;br/&gt;
ops.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;analysis:&lt;br/&gt;
there are 2 methods in RpcRetryingCaller: callWithRetries and callWithoutRetries.&lt;br/&gt;
it looks the timeout setup of callWithRetries is good, while callWithoutRetries is wrong(multi RPC for this user): caller cannot specify a valid timeout, but callWithoutRetries still calls beforeCall, which looks a method for callWithRetries only,  to set timeout. since RpcRetryingCaller#callTimeout  is not set, thread local timeout is set to 2s(MIN_RPC_TIMEOUT) via RpcClient.setRpcTimeout, which is the final pinginterval set to the socket.&lt;/p&gt;

&lt;p&gt;when there are heavy write workload and the rpc cannot complete in 2s, the client close the connection, so the server side connection is reset and finally exposes the problem in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-11705&quot; title=&quot;callQueueSize should be decremented in a fail-fast scenario&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-11705&quot;&gt;&lt;del&gt;HBASE-11705&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12733025">HBASE-11714</key>
            <summary>RpcRetryingCaller#callWithoutRetries set rpc timeout to 2 seconds incorrectly</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="3">Duplicate</resolution>
                                        <assignee username="tianq">Qiang Tian</assignee>
                                    <reporter username="tianq">Qiang Tian</reporter>
                        <labels>
                    </labels>
                <created>Sat, 9 Aug 2014 08:57:02 +0000</created>
                <updated>Mon, 11 Aug 2014 18:11:25 +0000</updated>
                            <resolved>Mon, 11 Aug 2014 08:54:03 +0000</resolved>
                                    <version>0.98.3</version>
                                                    <component>IPC/RPC</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="14091707" author="tianq" created="Sat, 9 Aug 2014 09:22:53 +0000"  >&lt;p&gt;click wrong button before filling in the info...just added more info.&lt;/p&gt;</comment>
                            <comment id="14091713" author="tianq" created="Sat, 9 Aug 2014 09:51:27 +0000"  >&lt;p&gt;the rpc timeout value transmission in the master branch and 1.0 branch is different. the patch is for 0.98 only(the timeout is passed via createBlockingRpcChannel, e.g. HConnectionImplementation)&lt;/p&gt;</comment>
                            <comment id="14092410" author="tianq" created="Mon, 11 Aug 2014 04:04:45 +0000"  >&lt;p&gt;ping &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=apurtell&quot; class=&quot;user-hover&quot; rel=&quot;apurtell&quot;&gt;Andrew Purtell&lt;/a&gt;, thanks!&lt;/p&gt;</comment>
                            <comment id="14092416" author="tianq" created="Mon, 11 Aug 2014 04:12:15 +0000"  >&lt;p&gt;search hit:&lt;br/&gt;
&lt;a href=&quot;http://stackoverflow.com/questions/25038030/sockettimeoutexception-emerges-when-insert-millions-of-records-to-hbase&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://stackoverflow.com/questions/25038030/sockettimeoutexception-emerges-when-insert-millions-of-records-to-hbase&lt;/a&gt;&lt;br/&gt;
I&apos;d think below one is also the hit:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/PHOENIX-998&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/PHOENIX-998&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14092531" author="nkeywal" created="Mon, 11 Aug 2014 07:41:08 +0000"  >&lt;p&gt;This is already fixed by &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-11374&quot; title=&quot;RpcRetryingCaller#callWithoutRetries has a timeout of zero&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-11374&quot;&gt;&lt;del&gt;HBASE-11374&lt;/del&gt;&lt;/a&gt;, no?&lt;/p&gt;</comment>
                            <comment id="14092574" author="tianq" created="Mon, 11 Aug 2014 08:50:58 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=nkeywal&quot; class=&quot;user-hover&quot; rel=&quot;nkeywal&quot;&gt;Nicolas Liochon&lt;/a&gt;! good to know it. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;br/&gt;
I did not find it..perhaps pasting the error info helps people google it?&lt;/p&gt;
</comment>
                            <comment id="14092592" author="nkeywal" created="Mon, 11 Aug 2014 09:13:04 +0000"  >&lt;p&gt;Make sense, I&apos;ve updated description in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-11374&quot; title=&quot;RpcRetryingCaller#callWithoutRetries has a timeout of zero&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-11374&quot;&gt;&lt;del&gt;HBASE-11374&lt;/del&gt;&lt;/a&gt; with the error message.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="12722180">HBASE-11374</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12732790">HBASE-11705</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12660807" name="hbase-11714-0.98.patch" size="835" author="tianq" created="Sat, 9 Aug 2014 09:45:41 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 11 Aug 2014 07:41:08 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>411053</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 16 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1ypw7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>411045</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>