<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 02 19:13:32 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-537/HBASE-537.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-537] We no longer wait on hdfs to exit safe mode</title>
                <link>https://issues.apache.org/jira/browse/HBASE-537</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;We used wait on hdfs to exit safe mode before going on to startup hbase but this feature is broken since we moved out of hadoop contrib.  Now when you try start with hdfs in safe mode you get:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;08/03/21 04:39:56 FATAL hbase.HMaster: Not starting HMaster because:
org.apache.hadoop.ipc.RemoteException: org.apache.hadoop.dfs.SafeModeException: Cannot create directory /hbase010. Name node is in safe mode.
Safe mode will be turned off automatically.
        at org.apache.hadoop.dfs.FSNamesystem.mkdirsInternal(FSNamesystem.java:1571)
        at org.apache.hadoop.dfs.FSNamesystem.mkdirs(FSNamesystem.java:1559)
        at org.apache.hadoop.dfs.NameNode.mkdirs(NameNode.java:422)
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If you are lucky, it appears on STDOUT/ERR but may just be stuffed into logs and all looks like its running properly.&lt;/p&gt;

&lt;p&gt;Noticed first by Lars George.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12392028">HBASE-537</key>
            <summary>We no longer wait on hdfs to exit safe mode</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.png">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jimk">Jim Kellerman</assignee>
                                    <reporter username="stack">stack</reporter>
                        <labels>
                    </labels>
                <created>Fri, 21 Mar 2008 04:42:19 +0000</created>
                <updated>Fri, 22 Aug 2008 21:13:12 +0000</updated>
                            <resolved>Fri, 21 Mar 2008 21:43:25 +0000</resolved>
                                    <version>0.1.0</version>
                    <version>0.2.0</version>
                                    <fixVersion>0.1.0</fixVersion>
                    <fixVersion>0.2.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12581004" author="stack" created="Fri, 21 Mar 2008 05:18:15 +0000"  >&lt;p&gt;This may be a blocker; those with big clusters will be annoyed having to manually wait on exit of safe mode before starting hbase.  They can put in the way of the hbase startup, invocation of ./bin/hadoop dfsadmin --safemode wait.&lt;/p&gt;

&lt;p&gt;In the past, it was suggested that hbase come up anyways, even if in safe mode in hdfs and that the UI and logs show us as blocked waiting on hdfs to exit safe mode.  Shouldn&apos;t be hard to do.  Might be our only alternative since hadoop is now elsewhere.  Could do the following pseudo-code in HMaster constructor:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
...
    Path rootRegionDir =
      HRegion.getRegionDir(rootdir, HRegionInfo.rootRegionInfo);
    LOG.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;Root region dir: &quot;&lt;/span&gt; + rootRegionDir.toString());

    &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
      &lt;span class=&quot;code-comment&quot;&gt;// Before we make our first fs access, check to see &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; hdfs is in safe
&lt;/span&gt;      &lt;span class=&quot;code-comment&quot;&gt;// mode and park here until it exists.
&lt;/span&gt;      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (ishdfs(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.conf)) {
        DFSAdmin admin = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; DFSAdmin(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.conf);
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (admin.isInSafeMode()) {
          admin.parkUntilWeExitSafeModeLoggingMessageEverySoOften();
        }
      }
...
    Go on to create -ROOT- and .META. &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;do&lt;/span&gt; not exist, etc.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Would need to move the startup of the master info server before this code with its own query about state of hdfs. &lt;/p&gt;</comment>
                            <comment id="12581107" author="jimk" created="Fri, 21 Mar 2008 16:08:37 +0000"  >&lt;p&gt;Not only should the master wait, but the region servers as well. This would suggest a common method in FSUtils.&lt;/p&gt;</comment>
                            <comment id="12581122" author="bryanduxbury" created="Fri, 21 Mar 2008 17:01:13 +0000"  >&lt;p&gt;+1 to Jim&apos;s comment.&lt;/p&gt;</comment>
                            <comment id="12581147" author="stack" created="Fri, 21 Mar 2008 18:01:42 +0000"  >&lt;p&gt;The regionservers already wait.  They do nothing until master tells them the hdfs to use.&lt;/p&gt;

&lt;p&gt;If only master needs the wait facility, should be in master class? (Hadoop already exposes tools for querying state of safemode)&lt;/p&gt;</comment>
                            <comment id="12581188" author="jimk" created="Fri, 21 Mar 2008 21:06:04 +0000"  >&lt;p&gt;For 0.1.0, this patch works if Hadoop permissions are disabled or if the user starting HBase is the Hadoop Superuser.&lt;/p&gt;

&lt;p&gt;Hadoop 0.17 will contain a fix that allows querying the state of the dfs without being superuser.&lt;/p&gt;</comment>
                            <comment id="12581190" author="bryanduxbury" created="Fri, 21 Mar 2008 21:09:40 +0000"  >&lt;p&gt;Move &quot;String message = ...&quot; outside of the loop. Otherwise +1.&lt;/p&gt;</comment>
                            <comment id="12581191" author="jimk" created="Fri, 21 Mar 2008 21:11:38 +0000"  >&lt;p&gt;? It is outside the loop:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
      &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; message = &lt;span class=&quot;code-quote&quot;&gt;&quot;Waiting &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; dfs to exit safe mode...&quot;&lt;/span&gt;;
      &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; (((DistributedFileSystem) fs).setSafeMode(
          FSConstants.SafeModeAction.SAFEMODE_GET)) {
        &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(message);
        LOG.info(message);
...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12581192" author="bryanduxbury" created="Fri, 21 Mar 2008 21:14:45 +0000"  >&lt;p&gt;I misread.&lt;/p&gt;</comment>
                            <comment id="12581197" author="jimk" created="Fri, 21 Mar 2008 21:43:25 +0000"  >&lt;p&gt;Committed to both 0.1.0 and trunk.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12378409" name="patch.txt" size="1942" author="jimk" created="Fri, 21 Mar 2008 21:06:04 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 21 Mar 2008 16:08:37 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>25251</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 37 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0h7wn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>98543</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>