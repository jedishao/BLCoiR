<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sat Dec 03 16:19:37 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-6533/HBASE-6533.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-6533] [replication] replication will block if WAL compress set differently in master and slave configuration</title>
                <link>https://issues.apache.org/jira/browse/HBASE-6533</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;as we know in hbase 0.94.0 we have a configuration below&lt;br/&gt;
  &amp;lt;property&amp;gt;&lt;br/&gt;
    &amp;lt;name&amp;gt;hbase.regionserver.wal.enablecompression&amp;lt;/name&amp;gt;&lt;br/&gt;
         &amp;lt;value&amp;gt;true&amp;lt;/value&amp;gt;&lt;br/&gt;
  &amp;lt;/property&amp;gt;&lt;br/&gt;
if we enable it in master cluster and disable it in slave cluster . Then replication will not work. It will throw unwrapRemoteException again and again in master cluster.&lt;/p&gt;



&lt;p&gt;2012-08-09 12:49:55,892 WARN org.apache.hadoop.hbase.replication.regionserver.ReplicationSource: Can&apos;t replicate because of an error&lt;br/&gt;
 on the remote cluster: &lt;br/&gt;
java.io.IOException: IPC server unable to read call parameters: Error in readFields&lt;br/&gt;
        at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)&lt;br/&gt;
        at sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:39)&lt;br/&gt;
        at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:27)&lt;br/&gt;
        at java.lang.reflect.Constructor.newInstance(Constructor.java:513)&lt;br/&gt;
        at org.apache.hadoop.ipc.RemoteException.instantiateException(RemoteException.java:95)&lt;br/&gt;
        at org.apache.hadoop.ipc.RemoteException.unwrapRemoteException(RemoteException.java:79)&lt;br/&gt;
        at org.apache.hadoop.hbase.replication.regionserver.ReplicationSource.shipEdits(ReplicationSource.java:635)&lt;br/&gt;
        at org.apache.hadoop.hbase.replication.regionserver.ReplicationSource.run(ReplicationSource.java:365)&lt;br/&gt;
Caused by: org.apache.hadoop.ipc.RemoteException: IPC server unable to read call parameters: Error in readFields&lt;br/&gt;
        at org.apache.hadoop.hbase.ipc.HBaseClient.call(HBaseClient.java:921)&lt;br/&gt;
        at org.apache.hadoop.hbase.ipc.WritableRpcEngine$Invoker.invoke(WritableRpcEngine.java:151)&lt;br/&gt;
        at $Proxy13.replicateLogEntries(Unknown Source)&lt;br/&gt;
        at org.apache.hadoop.hbase.replication.regionserver.ReplicationSource.shipEdits(ReplicationSource.java:616)&lt;br/&gt;
        ... 1 more &lt;/p&gt;


&lt;p&gt;This is because Slave cluster can not parse the hlog entry .&lt;/p&gt;

&lt;p&gt;2012-08-09 14:46:05,891 WARN org.apache.hadoop.ipc.HBaseServer: Unable to read call parameters for client 10.232.98.89&lt;br/&gt;
java.io.IOException: Error in readFields&lt;br/&gt;
        at org.apache.hadoop.hbase.io.HbaseObjectWritable.readObject(HbaseObjectWritable.java:685)&lt;br/&gt;
        at org.apache.hadoop.hbase.io.HbaseObjectWritable.readObject(HbaseObjectWritable.java:586)&lt;br/&gt;
        at org.apache.hadoop.hbase.io.HbaseObjectWritable.readObject(HbaseObjectWritable.java:635)&lt;br/&gt;
        at org.apache.hadoop.hbase.ipc.Invocation.readFields(Invocation.java:125)&lt;br/&gt;
        at org.apache.hadoop.hbase.ipc.HBaseServer$Connection.processData(HBaseServer.java:1292)&lt;br/&gt;
        at org.apache.hadoop.hbase.ipc.HBaseServer$Connection.readAndProcess(HBaseServer.java:1207)&lt;br/&gt;
        at org.apache.hadoop.hbase.ipc.HBaseServer$Listener.doRead(HBaseServer.java:735)&lt;br/&gt;
        at org.apache.hadoop.hbase.ipc.HBaseServer$Listener$Reader.doRunLoop(HBaseServer.java:524)&lt;br/&gt;
        at org.apache.hadoop.hbase.ipc.HBaseServer$Listener$Reader.run(HBaseServer.java:499)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)&lt;br/&gt;
        at java.lang.Thread.run(Thread.java:662)&lt;br/&gt;
Caused by: java.io.EOFException&lt;br/&gt;
        at java.io.DataInputStream.readFully(DataInputStream.java:180)&lt;br/&gt;
        at org.apache.hadoop.hbase.KeyValue.readFields(KeyValue.java:2254)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.wal.WALEdit.readFields(WALEdit.java:146)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.wal.HLog$Entry.readFields(HLog.java:1767)&lt;br/&gt;
        at org.apache.hadoop.hbase.io.HbaseObjectWritable.readObject(HbaseObjectWritable.java:682)&lt;br/&gt;
        ... 11 more &lt;/p&gt;

</description>
                <environment></environment>
        <key id="12602372">HBASE-6533</key>
            <summary>[replication] replication will block if WAL compress set differently in master and slave configuration</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.png">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="3">Duplicate</resolution>
                                        <assignee username="terry_zhang">terry zhang</assignee>
                                    <reporter username="terry_zhang">terry zhang</reporter>
                        <labels>
                    </labels>
                <created>Thu, 9 Aug 2012 07:26:52 +0000</created>
                <updated>Tue, 18 Sep 2012 15:25:31 +0000</updated>
                            <resolved>Tue, 18 Sep 2012 15:25:31 +0000</resolved>
                                    <version>0.94.0</version>
                                                    <component>Replication</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                <comments>
                            <comment id="13431640" author="terry_zhang" created="Thu, 9 Aug 2012 07:35:56 +0000"  >&lt;p&gt;so sorry create so many same issue because my IE issue. Could anyone help me delete them ? &lt;/p&gt;</comment>
                            <comment id="13431643" author="terry_zhang" created="Thu, 9 Aug 2012 07:42:34 +0000"  >&lt;p&gt;  now we can only go around this issue is set the master back to uncompressed mode and delete the zk node replication/rs. And restart the master cluster. Cause replication slave don&apos;t support reading compress hlog.&lt;br/&gt;
  But if we have multi master and some of them set hlog to compressed mode. Them we can not handler this situation.&lt;/p&gt;</comment>
                            <comment id="13448537" author="terry_zhang" created="Wed, 5 Sep 2012 07:12:56 +0000"  >&lt;p&gt;this is because of master sending the hlog entry in compress mode. But Slave do not know about it. So when slave ipc hbaseserver deserilize the buffer and read the hlog entry fields error will happen. We can let the Master send the buffer in none compress mode. then whether master use hlog compression or not. Slave both can work fine&lt;/p&gt;</comment>
                            <comment id="13450337" author="stack" created="Fri, 7 Sep 2012 04:34:19 +0000"  >&lt;p&gt;Its a known issue that replication won&apos;t work w/ compressed WALs Terry.  I&apos;m not sure if we already have an issue for this so lets keep this one open.&lt;/p&gt;</comment>
                            <comment id="13452519" author="jdcryans" created="Mon, 10 Sep 2012 22:17:18 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=terry_zhang&quot; class=&quot;user-hover&quot; rel=&quot;terry_zhang&quot;&gt;terry zhang&lt;/a&gt; your solution is not complete, see &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5778?focusedCommentId=13253995&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13253995&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-5778?focusedCommentId=13253995&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13253995&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13453788" author="terry_zhang" created="Wed, 12 Sep 2012 06:46:12 +0000"  >&lt;p&gt;yes,Daniel and Stack. Now replication can&apos;t work in hlog compress mode &#12290; cause compress mode need read hlog sequentially to construct the compressionContext dictionary . But when replication didn&apos;t read the entry in the hlog one by one(using Seek).So it can only get a tag(dictIdx) in the hlog. The original data is not exist in compressionContext. Usually we can get below error:&lt;/p&gt;

&lt;p&gt;java.lang.IndexOutOfBoundsException: index (2) must be less than size (1)&lt;br/&gt;
at com.google.common.base.Preconditions.checkElementIndex(Preconditions.java:301)&lt;br/&gt;
at com.google.common.base.Preconditions.checkElementIndex(Preconditions.java:280)&lt;br/&gt;
at org.apache.hadoop.hbase.regionserver.wal.LRUDictionary$BidirectionalLRUMap.get(LRUDictionary.java:122)&lt;br/&gt;
at org.apache.hadoop.hbase.regionserver.wal.LRUDictionary$BidirectionalLRUMap.access$000(LRUDictionary.java:69)&lt;br/&gt;
at org.apache.hadoop.hbase.regionserver.wal.LRUDictionary.getEntry(LRUDictionary.java:40)&lt;br/&gt;
at org.apache.hadoop.hbase.regionserver.wal.Compressor.readCompressed(Compressor.java:111)&lt;br/&gt;
at org.apache.hadoop.hbase.regionserver.wal.HLogKey.readFields(HLogKey.java:321)&lt;br/&gt;
at org.apache.hadoop.io.SequenceFile$Reader.next(SequenceFile.java:1851)&lt;br/&gt;
at org.apache.hadoop.io.SequenceFile$Reader.next(SequenceFile.java:1891)&lt;br/&gt;
at org.apache.hadoop.hbase.regionserver.wal.SequenceFileLogReader.next(SequenceFileLogReader.java:235)&lt;br/&gt;
at org.apache.hadoop.hbase.regionserver.wal.SequenceFileLogReader.next(SequenceFileLogReader.java:206)&lt;br/&gt;
at org.apache.hadoop.hbase.replication.regionserver.ReplicationSource.readAllEntriesToReplicateOrNextFile(ReplicationSource.java:435)&lt;br/&gt;
at org.apache.hadoop.hbase.replication.regionserver.ReplicationSource.run(ReplicationSource.java:311)&lt;/p&gt;</comment>
                            <comment id="13453791" author="terry_zhang" created="Wed, 12 Sep 2012 06:50:56 +0000"  >&lt;p&gt;Can we disable hlog compress mode when we start Replication ?&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-style: solid;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;border-bottom-style: solid;&quot;&gt;&lt;b&gt;HRegionServer.java&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
     &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!conf.getBoolean(HConstants.REPLICATION_ENABLE_KEY, &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;)) {
       &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt;;
     }
+    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (conf.getBoolean(HConstants.ENABLE_WAL_COMPRESSION, &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;)) {
+      &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; RegionServerRunningException(&lt;span class=&quot;code-quote&quot;&gt;&quot;Region server master cluster doesn&apos;t support&quot;&lt;/span&gt; +
+      &lt;span class=&quot;code-quote&quot;&gt;&quot;Hlog working in compression mode!&quot;&lt;/span&gt;);
+    }
 
     &lt;span class=&quot;code-comment&quot;&gt;// read in the name of the source replication class from the config file.
&lt;/span&gt;     &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; sourceClassname = conf.get(HConstants.REPLICATION_SOURCE_SERVICE_CLASSNAME,
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt; 

&lt;p&gt;Or we need change the replication do not use seek when we read hlog in replication.do not close hlog again and again when we meet EOF exception. Which one is better?&lt;/p&gt;</comment>
                            <comment id="13454128" author="jdcryans" created="Wed, 12 Sep 2012 17:02:49 +0000"  >&lt;p&gt;Currently those two features are just incompatible, you use one or the other.&lt;/p&gt;

&lt;p&gt;Maybe we should add a check in HBaseConfiguration to make sure both aren&apos;t enabled, no need to throw the exception that deep in the code (and you&apos;d have to do it inside WAL compression for replication too).&lt;/p&gt;

&lt;p&gt;In any case the real fix is described in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5778&quot; title=&quot;Fix HLog compression&amp;#39;s incompatibilities&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5778&quot;&gt;&lt;del&gt;HBASE-5778&lt;/del&gt;&lt;/a&gt;, the rest is just hacks.&lt;/p&gt;</comment>
                            <comment id="13454872" author="mdrzal" created="Thu, 13 Sep 2012 13:00:21 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=terry_zhang&quot; class=&quot;user-hover&quot; rel=&quot;terry_zhang&quot;&gt;terry zhang&lt;/a&gt; I&apos;ve cleaned up the duplicate issues for you.&lt;/p&gt;</comment>
                            <comment id="13454873" author="mdrzal" created="Thu, 13 Sep 2012 13:02:35 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jdcryans&quot; class=&quot;user-hover&quot; rel=&quot;jdcryans&quot;&gt;Jean-Daniel Cryans&lt;/a&gt; should we just close this out since the real fix is &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5778&quot; title=&quot;Fix HLog compression&amp;#39;s incompatibilities&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5778&quot;&gt;&lt;del&gt;HBASE-5778&lt;/del&gt;&lt;/a&gt;?&lt;/p&gt;</comment>
                            <comment id="13457886" author="lhofhansl" created="Tue, 18 Sep 2012 15:25:31 +0000"  >&lt;p&gt;Closing as dup of &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5778&quot; title=&quot;Fix HLog compression&amp;#39;s incompatibilities&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5778&quot;&gt;&lt;del&gt;HBASE-5778&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12602373">HBASE-6534</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12602374">HBASE-6535</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12602377">HBASE-6536</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12550753">HBASE-5778</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12543820" name="hbase-6533.patch" size="871" author="terry_zhang" created="Wed, 5 Sep 2012 07:14:49 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 7 Sep 2012 04:34:19 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>245281</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 11 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i067jz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>34155</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>