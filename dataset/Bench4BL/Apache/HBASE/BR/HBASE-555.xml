<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 02 19:08:28 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-555/HBASE-555.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-555] Only one Worker in HRS; on startup, if assigned tens of regions, havoc of reassignments because open processing is done in series</title>
                <link>https://issues.apache.org/jira/browse/HBASE-555</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;On the Lars clusters, he&apos;s up into the thousands of regions.  Starting this cluster, there is a load of churn in the master log as we assign regions, they report their opening and then after the hbase.hbasemaster.maxregionopen of one minute elapses, we assign the region elsewhere.&lt;/p&gt;

&lt;p&gt;Problem seems to be the fact that we only run a single Worker thread in our regionserver; means that region opens are processed in series.&lt;/p&gt;

&lt;p&gt;For example, the below shows when a master assigned a region and then the regionserver side log when it got around to opening it:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;2008-03-29 04:48:51,638 INFO org.apache.hadoop.hbase.HMaster: assigning region pdc-docs,US20060158177_20060720,1205765009844 to server 192.168.105.19:60020
..
2008-03-29 04:50:58,124 INFO org.apache.hadoop.hbase.HRegionServer: MSG_REGION_OPEN : pdc-docs,US20060158177_20060720,1205765009844
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;There is &amp;gt; 2 minutes between the two loggings (I checked clocks on this cluster and they are synced).&lt;/p&gt;

&lt;p&gt;Looking in the regionserver log, its just filled with logging on the opening of regions.  The region opens are running pretty fast at about a second each but there are hundreds of regions to open in this case so its easy to go over our default of 60 seconds.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12392787">HBASE-555</key>
            <summary>Only one Worker in HRS; on startup, if assigned tens of regions, havoc of reassignments because open processing is done in series</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.png">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="stack">stack</assignee>
                                    <reporter username="stack">stack</reporter>
                        <labels>
                    </labels>
                <created>Mon, 31 Mar 2008 23:04:38 +0000</created>
                <updated>Sat, 12 Apr 2008 16:12:06 +0000</updated>
                            <resolved>Tue, 1 Apr 2008 22:10:46 +0000</resolved>
                                    <version>0.16.0</version>
                    <version>0.1.0</version>
                    <version>0.2.0</version>
                                    <fixVersion>0.1.1</fixVersion>
                                    <component>regionserver</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12583932" author="stack" created="Mon, 31 Mar 2008 23:38:52 +0000"  >&lt;p&gt;Couple of ideas:&lt;/p&gt;

&lt;p&gt;Create a worker thread for every message.  That&apos;d be a worker per region to open.  If hundreds, not so smart as all would be contending.  So perhaps an upper bound on threads created.  But then we&apos;d just have same issue again where we&apos;d have queued opens that were not being serviced?&lt;/p&gt;

&lt;p&gt;So maybe single Worker ain&apos;t so bad.  Issue then is making it so we report the master that regions are being worked on.  Could take out an iterator and queue a PROCESSING message per queued region.&lt;/p&gt;

&lt;p&gt;Trying to come up w/ minimal patch for 0.1.  We can fix better in 0.2.&lt;/p&gt;</comment>
                            <comment id="12583993" author="stack" created="Tue, 1 Apr 2008 04:32:05 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
M  src/java/org/apache/hadoop/hbase/HRegionServer.java
   (housekeeping): Call a housekeeping method before we go into
   hibernation.  Currently its only task is review of the todo
   list and adding MSG_REGION_PROCESS_OPEN &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; any regions waiting
   to be opened in the queue.
   (addProcessMessage): Method to add MSG_REPORT_PROCESS_OPEN to
   messages to send the server.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12584274" author="stack" created="Tue, 1 Apr 2008 19:48:02 +0000"  >&lt;p&gt;When .19 server shows up, gets 100+ regions.  This patch should include upper bound on how many regions we assign at a time.&lt;/p&gt;

&lt;p&gt;Looking at the Lars cluster, this patch seems to be doing what its supposed to.... Its ugly in that currently there is a log for every MSG_REPORT_PROCESS_OPEN message &amp;#8211; one per region every time it reports in &amp;#8211; but its just during startup (Previous our startup logs were clogged with reassigning regions already assigned).&lt;/p&gt;

&lt;p&gt;Here is illustration that patch is basically working...  After assignment, 7 seconds after last assigned region message is logged we see this:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2008-04-01 00:07:05,460 DEBUG org.apache.hadoop.hbase.HMaster: Received MSG_REPORT_PROCESS_OPEN : pdc-docs,US20070223009_20070927,1205860531876 from 192.168.105.19:60020
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;A few regions open, then we get this:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2008-04-01 00:07:11,528 DEBUG org.apache.hadoop.hbase.HMaster: Received MSG_REPORT_PROCESS_OPEN : pdc-docs,US4881767_19891121,1205704528908 from 192.168.105.19:60020
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;... about 6 seconds after one from previous batch... then...&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2008-04-01 00:07:14,534 DEBUG org.apache.hadoop.hbase.HMaster: Received MSG_REPORT_PROCESS_OPEN : pdc-docs,US5399923_19950321,1205793104251 from 192.168.105.19:60020
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;later....&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2008-04-01 00:07:23,614 DEBUG org.apache.hadoop.hbase.HMaster: Received MSG_REPORT_PROCESS_OPEN : pdc-docs,EP04011653NWA1,1205771873299 from 192.168.105.19:60020
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;etc.&lt;/p&gt;</comment>
                            <comment id="12584281" author="stack" created="Tue, 1 Apr 2008 20:14:52 +0000"  >&lt;p&gt;Add to original patch assigning max of ten regions at a time.&lt;/p&gt;</comment>
                            <comment id="12584302" author="jimk" created="Tue, 1 Apr 2008 20:46:30 +0000"  >&lt;p&gt;Reviewed new patch. +1&lt;/p&gt;</comment>
                            <comment id="12584318" author="stack" created="Tue, 1 Apr 2008 21:31:28 +0000"  >&lt;p&gt;Going to commit this thing.  Just tested it over on the Lars cluster (2100 regions on 20 servers).  The two fixes in this patch made it so on restart, there were no more &quot;should not have opened region&apos;s&quot; &amp;#8211; all came up smoothly and regions are spread pretty evenly (looks better than what it used to be but I only did one restart).&lt;/p&gt;</comment>
                            <comment id="12584334" author="stack" created="Tue, 1 Apr 2008 22:10:46 +0000"  >&lt;p&gt;Committed branch and trunk.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12379061" name="555-0.1-v2.patch" size="5648" author="stack" created="Tue, 1 Apr 2008 20:14:52 +0000"/>
                            <attachment id="12379002" name="555-0.1.patch" size="3759" author="stack" created="Tue, 1 Apr 2008 04:32:05 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 1 Apr 2008 20:46:30 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>25263</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 36 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0h80n:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>98561</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>