<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sat Dec 03 19:37:31 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-2616/HBASE-2616.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-2616] TestHRegion.testWritesWhileGetting flaky on trunk</title>
                <link>https://issues.apache.org/jira/browse/HBASE-2616</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Saw this failure on my internal hudson:&lt;/p&gt;

&lt;p&gt;junit.framework.AssertionFailedError: expected:&amp;lt;\x00\x00\x00\x96&amp;gt; but was:&amp;lt;\x00\x00\x01\x00&amp;gt;&lt;br/&gt;
	at org.apache.hadoop.hbase.HBaseTestCase.assertEquals(HBaseTestCase.java:684)&lt;br/&gt;
	at org.apache.hadoop.hbase.regionserver.TestHRegion.testWritesWhileGetting(TestHRegion.java:2334)&lt;/p&gt;</description>
                <environment></environment>
        <key id="12465487">HBASE-2616</key>
            <summary>TestHRegion.testWritesWhileGetting flaky on trunk</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.png">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ryanobjc">ryan rawson</assignee>
                                    <reporter username="tlipcon">Todd Lipcon</reporter>
                        <labels>
                    </labels>
                <created>Wed, 26 May 2010 16:43:42 +0000</created>
                <updated>Fri, 12 Oct 2012 06:15:37 +0000</updated>
                            <resolved>Sat, 19 Jun 2010 19:22:31 +0000</resolved>
                                                    <fixVersion>0.20.5</fixVersion>
                                    <component>regionserver</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="12875309" author="stack" created="Thu, 3 Jun 2010 21:43:54 +0000"  >&lt;p&gt;Marking against 0.20.5 and moving comment I put in duplicate issue here: &quot;Made this a blocker. See how builds on hudson.hbase.org alternate between successful build and a build that fails this test. This is the only issue in way of a 0.20.5.&quot;&lt;/p&gt;</comment>
                            <comment id="12875823" author="ryanobjc" created="Sat, 5 Jun 2010 01:25:02 +0000"  >&lt;p&gt;here is an candidate patch... give it a shot on your hudson instance guys.&lt;/p&gt;</comment>
                            <comment id="12875852" author="stack" created="Sat, 5 Jun 2010 04:54:50 +0000"  >&lt;p&gt;Thanks Ryan.  I committed it after all tests passed locally (0.20 build takes one hour for me!).  Committed so can try it up on Andrew&apos;s super flakey ec2 hudson server.  If it passes 4 times w/o failure, we said that means good enough to ship.  Trying it now.&lt;/p&gt;</comment>
                            <comment id="12875853" author="stack" created="Sat, 5 Jun 2010 04:55:34 +0000"  >&lt;p&gt;Oh, &quot;Andrew&apos;s super flakey ec2 hudson server&quot; is AKA hudson.hbase.org.&lt;/p&gt;</comment>
                            <comment id="12875854" author="stack" created="Sat, 5 Jun 2010 04:56:59 +0000"  >&lt;p&gt;The next build that should have this patch ie #70.&lt;/p&gt;</comment>
                            <comment id="12875857" author="tlipcon" created="Sat, 5 Jun 2010 05:02:32 +0000"  >&lt;p&gt;Ryan, why does the test now flush the cache before joining? Are we masking an issue here?&lt;/p&gt;</comment>
                            <comment id="12875935" author="stack" created="Sat, 5 Jun 2010 20:48:47 +0000"  >&lt;p&gt;Ten builds have passed up on hudson.hbase.org since I committed patch last night.&lt;/p&gt;

&lt;p&gt;I just committed this:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Index: src/test/org/apache/hadoop/hbase/regionserver/TestHRegion.java
===================================================================
--- src/test/org/apache/hadoop/hbase/regionserver/TestHRegion.java      (revision 951761)
+++ src/test/org/apache/hadoop/hbase/regionserver/TestHRegion.java      (working copy)
@@ -2269,8 +2269,6 @@
 
     putThread.done();
 
-    region.flushcache();
-
     putThread.join();
     putThread.checkNoError();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;... to try and get an answer to Todd&apos;s question.  In local tests its fine.  Lets see how it does up on hudson.hbase.org (Its a nice day in SF.  Ryan might not be around for a while).&lt;/p&gt;</comment>
                            <comment id="12875942" author="ryanobjc" created="Sat, 5 Jun 2010 21:11:58 +0000"  >&lt;p&gt;The flushcache is an old fix that helped make the tests less flakey.  As you may remember there are 2 threads:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;getting thread which when finished sets a &apos;done&apos; flag&lt;/li&gt;
	&lt;li&gt;putting thread&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;well the putting thread can get caught up in the HRegion calls when the cache is full (this happens on my laptop frequently), so before we wait on the put thread to be finished, we flush the cache which unblocks the put thread.&lt;/p&gt;

&lt;p&gt;Note this happens &lt;em&gt;AFTER&lt;/em&gt; the asserts, therefore this has &lt;em&gt;nothing&lt;/em&gt; to do with the test failures.  This is how the code is on trunk, and how it should be.&lt;/p&gt;</comment>
                            <comment id="12875944" author="stack" created="Sat, 5 Jun 2010 21:30:45 +0000"  >&lt;p&gt;Ok... starting build 81.  This build will be w/ the removed flush above.&lt;/p&gt;</comment>
                            <comment id="12875945" author="stack" created="Sat, 5 Jun 2010 21:31:13 +0000"  >&lt;p&gt;&lt;a href=&quot;http://hudson.hbase.org/job/hbase-branch-0.20/81/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.hbase.org/job/hbase-branch-0.20/81/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12875952" author="tlipcon" created="Sat, 5 Jun 2010 21:58:15 +0000"  >&lt;p&gt;OK, that seems reasonable. A comment to that effect would be nice, though, so people reading the test cases understand it&apos;s for convenience/test speed, not because it has something to do with the test.&lt;/p&gt;</comment>
                            <comment id="12875954" author="ryanobjc" created="Sat, 5 Jun 2010 22:03:31 +0000"  >&lt;p&gt;well its not just about test speed, because without this the test&lt;br/&gt;
never finishes on my laptop &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;


</comment>
                            <comment id="12875955" author="tlipcon" created="Sat, 5 Jun 2010 22:06:20 +0000"  >&lt;p&gt;hm, then I&apos;m confused &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; If the put thread is blocked on full hregions, why doesn&apos;t that trigger a flush of its own?&lt;/p&gt;</comment>
                            <comment id="12875957" author="ryanobjc" created="Sat, 5 Jun 2010 22:19:44 +0000"  >&lt;p&gt;it has to do because we are running with a standalone HRegion without&lt;br/&gt;
all the corresponding background threads.  normally yes, in this case&lt;br/&gt;
not as much!&lt;/p&gt;



</comment>
                            <comment id="12875958" author="stack" created="Sat, 5 Jun 2010 22:25:36 +0000"  >&lt;p&gt;Bldg #81 passed and #82 is running.  Not definitive proof but....  Let me put back the flush.  Going to go ahead and cut a 0.20.5 RC.  Thanks all.&lt;/p&gt;</comment>
                            <comment id="12875959" author="stack" created="Sat, 5 Jun 2010 22:27:13 +0000"  >&lt;p&gt;hmmm.. just thinking that all these tests up on hudson.hbase.org are passing because its w/e and ec2 is quiet.  Monday when the load comes on again, it&apos;ll all start failing again I suppose.  Anyways, cutting a 0.20.5.&lt;/p&gt;</comment>
                            <comment id="12875994" author="stack" created="Sun, 6 Jun 2010 05:16:26 +0000"  >&lt;p&gt;So build #82 failed, that&apos;d be w/o the flush, but so did #83 which seems to be w/ the fush put back (#84 succeeded).  I&apos;m going to go ahead and roll the candidate for now but there may be something in here still.  I&apos;m going to keep triggering builds on this hudson.hbase.org to see if we get any more fails.&lt;/p&gt;</comment>
                            <comment id="12876321" author="stack" created="Mon, 7 Jun 2010 17:28:39 +0000"  >&lt;p&gt;Builds still failing on this test: See #90, #91 and #94 builds.&lt;/p&gt;</comment>
                            <comment id="12876488" author="stack" created="Mon, 7 Jun 2010 23:33:27 +0000"  >&lt;p&gt;This test runs for 2minutes and 30seconds up on hudson.  Does it have to?  The testWritesWhileScanning  runs 30 seconds.&lt;/p&gt;</comment>
                            <comment id="12876491" author="ryanobjc" created="Mon, 7 Jun 2010 23:40:58 +0000"  >&lt;p&gt;the test should not take that long, but it is slow ... seems like the&lt;br/&gt;
get() calls are strangely slow, i think because of the nature of&lt;br/&gt;
piling multiple version on top of older versions.  maybe some&lt;br/&gt;
improvements in the get/scan calls in the single thick row case would&lt;br/&gt;
make this faster.&lt;/p&gt;

</comment>
                            <comment id="12876492" author="tlipcon" created="Mon, 7 Jun 2010 23:41:58 +0000"  >&lt;p&gt;wait, how did test performance come up here? shouldn&apos;t we fix it before we make it faster? &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="12880313" author="jdcryans" created="Fri, 18 Jun 2010 20:28:44 +0000"  >&lt;p&gt;Looks like it was committed, can we close this?&lt;/p&gt;</comment>
                            <comment id="12880531" author="stack" created="Sat, 19 Jun 2010 19:22:31 +0000"  >&lt;p&gt;Closing for Ryan. &lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12465688">HBASE-2627</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12462576">HBASE-2474</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12466239">HBASE-2670</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12446394" name="HBASE-2616.patch" size="38543" author="ryanobjc" created="Sat, 5 Jun 2010 01:25:02 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 3 Jun 2010 21:43:54 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>26387</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 25 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i08skf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>49228</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>