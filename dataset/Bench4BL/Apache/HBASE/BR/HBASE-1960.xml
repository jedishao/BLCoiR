<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sat Dec 03 16:31:06 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-1960/HBASE-1960.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-1960] Master should wait for DFS to come up when creating hbase.version</title>
                <link>https://issues.apache.org/jira/browse/HBASE-1960</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;The master does not wait for DFS to come up in the circumstance where the DFS master is started for the first time after format and no datanodes have been started yet. &lt;/p&gt;


&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;2009-11-07 11:47:28,115 INFO org.apache.hadoop.hbase.master.HMaster: vmName=Java HotSpot(TM) 64-Bit Server VM, vmVendor=Sun Microsystems Inc., vmVersion=14.2-b01
2009-11-07 11:47:28,116 INFO org.apache.hadoop.hbase.master.HMaster: vmInputArguments=[-Xmx1000m, -XX:+HeapDumpOnOutOfMemoryError, -XX:+UseConcMarkSweepGC, -XX:+CMSIncrementalMode, -Dhbase.log.dir=/mnt/hbase/logs, -Dhbase.log.file=hbase-root-master-ip-10-242-15-159.log, -Dhbase.home.dir=/usr/local/hbase-0.20.1/bin/.., -Dhbase.id.str=root, -Dhbase.root.logger=INFO,DRFA, -Djava.library.path=/usr/local/hbase-0.20.1/bin/../lib/native/Linux-amd64-64]
2009-11-07 11:47:28,247 INFO org.apache.hadoop.hbase.master.HMaster: My address is ip-10-242-15-159.ec2.internal:60000
2009-11-07 11:47:28,728 WARN org.apache.hadoop.hdfs.DFSClient: DataStreamer Exception: org.apache.hadoop.ipc.RemoteException: java.io.IOException: File /hbase/hbase.version could only be replicated to 0 nodes, instead of 1
	at org.apache.hadoop.hdfs.server.namenode.FSNamesystem.getAdditionalBlock(FSNamesystem.java:1267)
	at org.apache.hadoop.hdfs.server.namenode.NameNode.addBlock(NameNode.java:422)

[...]

2009-11-07 11:47:28,728 WARN org.apache.hadoop.hdfs.DFSClient: Error Recovery for block null bad datanode[0] nodes == null
2009-11-07 11:47:28,728 WARN org.apache.hadoop.hdfs.DFSClient: Could not get block locations. Source file &quot;/hbase/hbase.version&quot; - Aborting...
2009-11-07 11:47:28,729 FATAL org.apache.hadoop.hbase.master.HMaster: Not starting HMaster because:
org.apache.hadoop.ipc.RemoteException: java.io.IOException: File /hbase/hbase.version could only be replicated to 0 nodes, instead of 1
	at org.apache.hadoop.hdfs.server.namenode.FSNamesystem.getAdditionalBlock(FSNamesystem.java:1267)
	at org.apache.hadoop.hdfs.server.namenode.NameNode.addBlock(NameNode.java:422)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Should probably sleep and retry the write a few times.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12440098">HBASE-1960</key>
            <summary>Master should wait for DFS to come up when creating hbase.version</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="apurtell">Andrew Purtell</assignee>
                                    <reporter username="apurtell">Andrew Purtell</reporter>
                        <labels>
                    </labels>
                <created>Sat, 7 Nov 2009 16:54:51 +0000</created>
                <updated>Wed, 18 Apr 2012 01:00:19 +0000</updated>
                            <resolved>Wed, 18 Apr 2012 01:00:19 +0000</resolved>
                                                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12792250" author="apurtell" created="Fri, 18 Dec 2009 00:14:51 +0000"  >&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;[...]
09/12/17 16:10:17 INFO util.FSUtils: Waiting for dfs to come up...
09/12/17 16:10:27 INFO util.FSUtils: Waiting for dfs to come up...
09/12/17 16:10:37 INFO util.FSUtils: Waiting for dfs to come up...
09/12/17 16:10:47 INFO util.FSUtils: Waiting for dfs to come up...
09/12/17 16:10:58 INFO master.HMaster: BOOTSTRAP: creating ROOT and first META regions
[...]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12792277" author="apurtell" created="Fri, 18 Dec 2009 01:33:50 +0000"  >&lt;p&gt;Committed to trunk, 0.20, and 0.20_on_hadoop_0.18.3 branches.&lt;/p&gt;</comment>
                            <comment id="13004092" author="apurtell" created="Tue, 8 Mar 2011 17:53:32 +0000"  >&lt;p&gt;Got this again with 0.90:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;
2011-03-08 08:41:44,428 INFO org.apache.hadoop.hbase.master.ActiveMasterManager:
 Master=ip-10-160-166-143.us-west-1.compute.internal:60000
2011-03-08 08:41:44,780 WARN org.apache.hadoop.hdfs.DFSClient: DataStreamer Exce
ption: org.apache.hadoop.ipc.RemoteException: java.io.IOException: File /hbase/h
base.version could only be replicated to 0 nodes, instead of 1
        at org.apache.hadoop.hdfs.server.namenode.FSNamesystem.getAdditionalBloc
k(FSNamesystem.java:1416)
        at org.apache.hadoop.hdfs.server.namenode.NameNode.addBlock(NameNode.jav
a:643)
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.
java:39)
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAcces
sorImpl.java:25)
        at java.lang.reflect.Method.invoke(Method.java:597)
        at org.apache.hadoop.ipc.RPC$Server.call(RPC.java:557)
        at org.apache.hadoop.ipc.Server$Handler$1.run(Server.java:1416)
        at org.apache.hadoop.ipc.Server$Handler$1.run(Server.java:1412)
        at java.security.AccessController.doPrivileged(Native Method)
        at javax.security.auth.Subject.doAs(Subject.java:396)
        at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInforma
tion.java:1116)
        at org.apache.hadoop.ipc.Server$Handler.run(Server.java:1410)

        at org.apache.hadoop.ipc.Client.call(Client.java:1104)
        at org.apache.hadoop.ipc.RPC$Invoker.invoke(RPC.java:226)
        at $Proxy7.addBlock(Unknown Source)
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.
java:39)
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAcces
sorImpl.java:25)
        at java.lang.reflect.Method.invoke(Method.java:597)
        at org.apache.hadoop.io.retry.RetryInvocationHandler.invokeMethod(RetryI
nvocationHandler.java:82)
        at org.apache.hadoop.io.retry.RetryInvocationHandler.invoke(RetryInvocat
ionHandler.java:59)
        at $Proxy7.addBlock(Unknown Source)
        at org.apache.hadoop.hdfs.DFSClient$DFSOutputStream.locateFollowingBlock
(DFSClient.java:3241)
        at org.apache.hadoop.hdfs.DFSClient$DFSOutputStream.nextBlockOutputStrea
m(DFSClient.java:3110)
        at org.apache.hadoop.hdfs.DFSClient$DFSOutputStream.access$1900(DFSClien
t.java:2360)
        at org.apache.hadoop.hdfs.DFSClient$DFSOutputStream$DataStreamer.run(DFS
Client.java:2555)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13004154" author="apurtell" created="Tue, 8 Mar 2011 19:38:06 +0000"  >&lt;p&gt;DFS will immediately leave safe mode with 0 DNs when there are 0 blocks. This is inconvenient. It&apos;s an edge case but happens for example when setting up EC2 clusters where up comes the master instance running both NN and HMaster, and slaves with DNs and RegionServers come up at some later time.&lt;/p&gt;

&lt;p&gt;We used to handle this by checking the current DN count and waiting until it is nonzero. With security, the check for datanode countdoesn&apos;t work &amp;#8211; it is a privileged op, we swallow the IOE, and continue. Attached -redux patch removes the DN count check and instead adopts the strategy of the jobtracker: we simply retry indefinitely the creation of hbase.version. This will handle both the secure and nonsecure cases.&lt;/p&gt;</comment>
                            <comment id="13004155" author="apurtell" created="Tue, 8 Mar 2011 19:40:28 +0000"  >&lt;p&gt;Committed trivial patch to trunk and 0.90 branch.&lt;/p&gt;</comment>
                            <comment id="13005587" author="hudson" created="Fri, 11 Mar 2011 10:34:12 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK #1781 (See &lt;a href=&quot;https://hudson.apache.org/hudson/job/HBase-TRUNK/1781/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://hudson.apache.org/hudson/job/HBase-TRUNK/1781/&lt;/a&gt;)&lt;/p&gt;
</comment>
                            <comment id="13025989" author="nrapolu" created="Wed, 27 Apr 2011 20:37:52 +0000"  >&lt;p&gt;Got this again with HBase-0.90.2 and Hadoop-0.20.2 append branch while launching cluster on EC2 :&lt;br/&gt;
The master retries to create /hbase/hbase.version, but the namenode rejects saying &lt;/p&gt;
&lt;div class=&quot;panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;panelContent&quot;&gt;
&lt;p&gt;2011-04-27 20:26:15,004 WARN org.apache.hadoop.hdfs.StateChange: DIR* NameSystem.startFile: failed to create file /hbase/hbase.version for DFSClient_hb_m_ip-10-108-79-232.ec2.internal:60000_1303935162105 on client 10.108.79.232 because current leaseholder is trying to recreate file.&lt;/p&gt;

&lt;p&gt;2011-04-27 20:26:15,005 INFO org.apache.hadoop.ipc.Server: IPC Server handler 0 on 50001, call create(/hbase/hbase.version, rwxr-xr-x, DFSClient_hb_m_ip-10-108-79-232.ec2.internal:60000_1303935162105, true, 3, 67108864) from 10.108.79.232:36701: error: org.apache.hadoop.hdfs.protocol.AlreadyBeingCreatedException: failed to create file /hbase/hbase.version for DFSClient_hb_m_ip-10-108-79-232.ec2.internal:60000_1303935162105 on client 10.108.79.232 because current leaseholder is trying to recreate file.&lt;br/&gt;
org.apache.hadoop.hdfs.protocol.AlreadyBeingCreatedException: failed to create file /hbase/hbase.version for DFSClient_hb_m_ip-10-108-79-232.ec2.internal:60000_1303935162105 on client 10.108.79.232 because current leaseholder is trying to recreate file.&lt;br/&gt;
        at org.apache.hadoop.hdfs.server.namenode.FSNamesystem.recoverLeaseInternal(FSNamesystem.java:1182)&lt;br/&gt;
        at org.apache.hadoop.hdfs.server.namenode.FSNamesystem.startFileInternal(FSNamesystem.java:1054)&lt;br/&gt;
        at org.apache.hadoop.hdfs.server.namenode.FSNamesystem.startFile(FSNamesystem.java:1002)&lt;br/&gt;
        at org.apache.hadoop.hdfs.server.namenode.NameNode.create(NameNode.java:381)&lt;br/&gt;
        at sun.reflect.GeneratedMethodAccessor6.invoke(Unknown Source)&lt;br/&gt;
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
        at java.lang.reflect.Method.invoke(Method.java:597)&lt;br/&gt;
        at org.apache.hadoop.ipc.RPC$Server.call(RPC.java:508)&lt;br/&gt;
        at org.apache.hadoop.ipc.Server$Handler$1.run(Server.java:961)&lt;br/&gt;
        at org.apache.hadoop.ipc.Server$Handler$1.run(Server.java:957)&lt;br/&gt;
        at java.security.AccessController.doPrivileged(Native Method)&lt;br/&gt;
        at javax.security.auth.Subject.doAs(Subject.java:396)&lt;br/&gt;
        at org.apache.hadoop.ipc.Server$Handler.run(Server.java:955)&lt;/p&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This sequence of events (retry by master and rejection by namenode) continue forever; master is never started. &lt;br/&gt;
The following is from HBase master logs:&lt;/p&gt;

&lt;div class=&quot;panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;panelContent&quot;&gt;
&lt;p&gt;2011-04-27 20:12:44,760 WARN org.apache.hadoop.hdfs.DFSClient: Error Recovery for block null bad datanode&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt; nodes == null&lt;br/&gt;
2011-04-27 20:12:44,760 WARN org.apache.hadoop.hdfs.DFSClient: Could not get block locations. Source file &quot;/hbase/hbase.version&quot; - Aborting...&lt;br/&gt;
2011-04-27 20:12:44,762 WARN org.apache.hadoop.hbase.util.FSUtils: Unable to create version file at hdfs://ip-10-108-79-232.ec2.internal:50001/hbase, retrying: org.apache.hadoop.ipc.RemoteException: java.io.IOException: File /hbase/hbase.version could only be replicated to 0 nodes, instead of 1&lt;br/&gt;
        at org.apache.hadoop.hdfs.server.namenode.FSNamesystem.getAdditionalBlock(FSNamesystem.java:1363)&lt;br/&gt;
        at org.apache.hadoop.hdfs.server.namenode.NameNode.addBlock(NameNode.java:449)&lt;br/&gt;
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
..........&lt;br/&gt;
.......... (While retrying)&lt;br/&gt;
..........&lt;/p&gt;

&lt;p&gt;2011-04-27 20:28:15,044 WARN org.apache.hadoop.hbase.util.FSUtils: Unable to create version file at hdfs://ip-10-108-79-232.ec2.internal:50001/hbase, retrying: org.apache.hadoop.ipc.RemoteException: org.apache.hadoop.hdfs.protocol.AlreadyBeingCreatedException: failed to create file /hbase/hbase.version for DFSClient_hb_m_ip-10-108-79-232.ec2.internal:60000_1303935162105 on client 10.108.79.232 because current leaseholder is trying to recreate file.&lt;br/&gt;
        at org.apache.hadoop.hdfs.server.namenode.FSNamesystem.recoverLeaseInternal(FSNamesystem.java:1182)&lt;br/&gt;
        at org.apache.hadoop.hdfs.server.namenode.FSNamesystem.startFileInternal(FSNamesystem.java:1054)&lt;/p&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13038224" author="stack" created="Mon, 23 May 2011 21:01:31 +0000"  >&lt;p&gt;Reopening until we look into Naresh&apos;s report.&lt;/p&gt;</comment>
                            <comment id="13047707" author="stack" created="Fri, 10 Jun 2011 22:58:24 +0000"  >&lt;p&gt;Moving out of 0.92.  Move it back in if you think differently.&lt;/p&gt;</comment>
                            <comment id="13047719" author="stack" created="Fri, 10 Jun 2011 22:58:26 +0000"  >&lt;p&gt;Moving out of 0.92.  Move it back in if you think differently.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                                                <inwardlinks description="is depended upon by">
                                        <issuelink>
            <issuekey id="12444435">HBASE-2083</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12473031" name="HBASE-1960-redux.patch" size="4680" author="apurtell" created="Tue, 8 Mar 2011 19:38:06 +0000"/>
                            <attachment id="12428372" name="HBASE-1960.patch" size="1395" author="apurtell" created="Fri, 18 Dec 2009 00:19:23 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 11 Mar 2011 10:34:12 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>26081</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 26 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0hg07:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>99855</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310192" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Release Note</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>This has been addressed as part of &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5003&quot; title=&quot;If the master is started with a wrong root dir, it gets stuck and can&amp;#39;t be killed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5003&quot;&gt;&lt;strike&gt;HBASE-5003&lt;/strike&gt;&lt;/a&gt; and others.</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>