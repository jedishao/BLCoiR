<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 02 20:16:56 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-14943/HBASE-14943.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-14943] Procedure-V2: Deadlock in WALProcedureStore</title>
                <link>https://issues.apache.org/jira/browse/HBASE-14943</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Found deadlock in WALProcedureStore between the WALProcedureSyncThread and WALProcedureStore#update/delete/insert API which is used by the ProcedureExecutor.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12919842">HBASE-14943</key>
            <summary>Procedure-V2: Deadlock in WALProcedureStore</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.png">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="3">Duplicate</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="ashu210890">Ashu Pachauri</reporter>
                        <labels>
                    </labels>
                <created>Mon, 7 Dec 2015 21:01:11 +0000</created>
                <updated>Thu, 17 Dec 2015 22:09:31 +0000</updated>
                            <resolved>Wed, 16 Dec 2015 17:27:29 +0000</resolved>
                                    <version>2.0.0</version>
                    <version>1.2.0</version>
                    <version>1.1.3</version>
                                                    <component>proc-v2</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                <comments>
                            <comment id="15045722" author="ashu210890" created="Mon, 7 Dec 2015 21:02:08 +0000"  >&lt;p&gt;deadlock-jstack.out : The jstack output for the deadlock situation.&lt;/p&gt;</comment>
                            <comment id="15045750" author="busbey" created="Mon, 7 Dec 2015 21:20:30 +0000"  >&lt;p&gt;if someone can confirm, I&apos;d like to raise this to blocker.&lt;/p&gt;</comment>
                            <comment id="15045852" author="mbertozzi" created="Mon, 7 Dec 2015 22:08:36 +0000"  >&lt;p&gt;yeah, I think v0 will be ok as quick fix.&lt;/p&gt;</comment>
                            <comment id="15045906" author="ashu210890" created="Mon, 7 Dec 2015 22:39:04 +0000"  >&lt;p&gt;v0 looks okay. But, in general, I would refrain from using more than one lock at a point where you take reach by multiple code paths. This is just adding more locking &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="15046017" author="ashu210890" created="Tue, 8 Dec 2015 00:04:49 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=busbey&quot; class=&quot;user-hover&quot; rel=&quot;busbey&quot;&gt;Sean Busbey&lt;/a&gt; Don&apos;t let my comment stop you from moving forward with this. The patch looks completely fine, given that this is a blocker. We can always revisit this to do some refactor/rewrite.&lt;/p&gt;

&lt;p&gt;+1 for v0.&lt;/p&gt;</comment>
                            <comment id="15046119" author="busbey" created="Tue, 8 Dec 2015 01:20:27 +0000"  >&lt;p&gt;okay then let&apos;s go +1 on v0.&lt;/p&gt;

&lt;p&gt;Can someone file a follow-on for revisiting this?&lt;/p&gt;</comment>
                            <comment id="15046121" author="busbey" created="Tue, 8 Dec 2015 01:21:15 +0000"  >&lt;p&gt;let&apos;s make that +1 pending jenkins. didn&apos;t notice it hadn&apos;t come through. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="15046140" author="ashu210890" created="Tue, 8 Dec 2015 01:42:11 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=busbey&quot; class=&quot;user-hover&quot; rel=&quot;busbey&quot;&gt;Sean Busbey&lt;/a&gt; Filed &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-14947&quot; title=&quot;Procedure V2 - WALProcedureStore improvements&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-14947&quot;&gt;&lt;del&gt;HBASE-14947&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15046433" author="hadoopqa" created="Tue, 8 Dec 2015 06:09:46 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12776190/HBASE-14943-v0.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12776190/HBASE-14943-v0.patch&lt;/a&gt;&lt;br/&gt;
  against master branch at commit 1f999c1e2bba62fda0fb426a168afa338b31c251.&lt;br/&gt;
  ATTACHMENT ID: 12776190&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 tests included&lt;/font&gt;.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop versions&lt;/font&gt;. The patch compiles with all supported hadoop versions (2.4.0 2.4.1 2.5.0 2.5.1 2.5.2 2.6.0 2.6.1 2.7.0 2.7.1)&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 protoc&lt;/font&gt;.  The applied patch does not increase the total number of protoc compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;                &lt;font color=&quot;red&quot;&gt;-1 checkstyle&lt;/font&gt;.  The applied patch generated new checkstyle errors. Check build console for list of new errors.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any  new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn post-site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 core tests&lt;/font&gt;.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 zombies&lt;/font&gt;. No zombie tests found running at the end of the build.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/16788//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/16788//testReport/&lt;/a&gt;&lt;br/&gt;
Release Findbugs (version 2.0.3) 	warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/16788//artifact/patchprocess/newFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/16788//artifact/patchprocess/newFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Checkstyle Errors: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/16788//artifact/patchprocess/checkstyle-aggregate.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/16788//artifact/patchprocess/checkstyle-aggregate.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;                Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/16788//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/16788//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="15046526" author="syuanjiang" created="Tue, 8 Dec 2015 07:44:18 +0000"  >&lt;p&gt;+1 on the patch.&lt;/p&gt;

&lt;p&gt;This is a good found.  Now I know why sometimes the procedure hangs during system tests.&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Found one Java-level deadlock:
=============================

&quot;ProcedureExecutor-0&quot;:
 waiting for ownable synchronizer 0x00000004410fa5b8, (a java/util/concurrent/locks/ReentrantLock$NonfairSync),
 which is held by &quot;WALProcedureStoreSyncThread&quot;
&quot;WALProcedureStoreSyncThread&quot;:
  waiting to lock Monitor@0x00007f90f0847de8 (Object@0x00000004410f9ca8, a org/apache/hadoop/hbase/procedure2/store/ProcedureStoreTracker),
  which is held by &quot;ProcedureExecutor-0&quot;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;For the &quot;WALProcedureStoreSyncThread&quot; - syncLoop() holds &quot;lock.lock()&quot; and wait for &quot;synchronized (storeTracker)&quot; by calling periodicRoll().  &lt;br/&gt;
For the &quot;ProcedureExecutor-0&quot; - insert/delete/update holds the &quot;synchronized (storeTracker)&quot;, then checkAndTryRoll() calls rollWriter(), which trying to do &quot;lock.lock()&quot;.  &lt;/p&gt;</comment>
                            <comment id="15058782" author="mbertozzi" created="Tue, 15 Dec 2015 20:54:53 +0000"  >&lt;p&gt;committed &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-14943&quot; title=&quot;Procedure-V2: Deadlock in WALProcedureStore&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-14943&quot;&gt;&lt;del&gt;HBASE-14943&lt;/del&gt;&lt;/a&gt; which removes the 2nd lock&lt;/p&gt;</comment>
                            <comment id="15060352" author="syuanjiang" created="Wed, 16 Dec 2015 17:26:36 +0000"  >&lt;p&gt;Correction: commit in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-14947&quot; title=&quot;Procedure V2 - WALProcedureStore improvements&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-14947&quot;&gt;&lt;del&gt;HBASE-14947&lt;/del&gt;&lt;/a&gt; which has a completed fix (the patch in this JIRA, &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-14943&quot; title=&quot;Procedure-V2: Deadlock in WALProcedureStore&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-14943&quot;&gt;&lt;del&gt;HBASE-14943&lt;/del&gt;&lt;/a&gt; is not committed)&lt;/p&gt;</comment>
                            <comment id="15062948" author="busbey" created="Thu, 17 Dec 2015 22:09:31 +0000"  >&lt;p&gt;removing fix versions since this was closed as duplicate.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12919915">HBASE-14947</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12776190" name="HBASE-14943-v0.patch" size="4561" author="mbertozzi" created="Mon, 7 Dec 2015 22:08:36 +0000"/>
                            <attachment id="12776175" name="deadlock-jstack.out" size="220163" author="ashu210890" created="Mon, 7 Dec 2015 21:02:08 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 7 Dec 2015 21:20:30 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            50 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2pk5z:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>