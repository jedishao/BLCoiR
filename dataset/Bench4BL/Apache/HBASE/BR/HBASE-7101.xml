<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sat Dec 03 16:23:15 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-7101/HBASE-7101.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-7101] HBase stuck in Region SPLIT </title>
                <link>https://issues.apache.org/jira/browse/HBASE-7101</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;I found this issue from a zknode which has existed for a long time in the unassigned parent.And HMaster report warnning log increasingly.The loop log is at below. &lt;/p&gt;

&lt;p&gt;WARN org.apache.hadoop.hbase.master.AssignmentManager: Region 1a1c950ad45812d7b4b9b90ebf268468 not found on server sev0040,60020,1350378314041; failed processing&lt;br/&gt;
WARN org.apache.hadoop.hbase.master.AssignmentManager: Received SPLIT for region 1a1c950ad45812d7b4b9b90ebf268468 from server sev0040,60020,1350378314041 but it doesn&apos;t exist anymore, probably already processed its split&lt;br/&gt;
WARN org.apache.hadoop.hbase.master.AssignmentManager: Region 1a1c950ad45812d7b4b9b90ebf268468 not found on server gs-dpo-sev0040,60020,1350378314041; failed processing&lt;br/&gt;
WARN org.apache.hadoop.hbase.master.AssignmentManager: Received SPLIT for region 1a1c950ad45812d7b4b9b90ebf268468 from server sev0040,60020,1350378314041 but it doesn&apos;t exist anymore, probably already processed its split&lt;/p&gt;

&lt;p&gt;we use Hbase-0.92.1, and I trace back to the source code. HMaster AssignmentManager have already deleted the SPLIT_Region in its memory structure,but HRegionServer SplitTransaction has found the unassigned/parent-node existed in a transient state, precisely SplitTransaction executes tickleNodeSplit to update a new version a little later than  AssignmentManager deleting unassigned/parent-znode. After updating a version of the znode, it will intrigue the handleRegion operation again, however, AssignmentManager assert that the RegionState in Memory has been deleted, and transaction goes into a retry loop.&lt;/p&gt;

&lt;p&gt;In the SplitTransaction, transitionZKNode will retry tickleNodeSplit after sleeping 100ms. In my opinion, if the time is much longger than 100ms, all the operation from AssignmentManagement will finish off completely.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12614893">HBASE-7101</key>
            <summary>HBase stuck in Region SPLIT </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="3">Duplicate</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="jiangbinglover">Bing Jiang</reporter>
                        <labels>
                    </labels>
                <created>Tue, 6 Nov 2012 02:36:21 +0000</created>
                <updated>Sun, 27 Jan 2013 08:02:40 +0000</updated>
                            <resolved>Sun, 27 Jan 2013 08:02:39 +0000</resolved>
                                    <version>0.92.1</version>
                                                        <due></due>
                            <votes>1</votes>
                                    <watches>11</watches>
                                                                <comments>
                            <comment id="13491179" author="yuzhihong@gmail.com" created="Tue, 6 Nov 2012 03:29:40 +0000"  >&lt;p&gt;The following code is from 0.94:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
          &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.sleep(100);
          &lt;span class=&quot;code-comment&quot;&gt;// When &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; returns -1 it means the znode doesn&apos;t exist
&lt;/span&gt;          &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.znodeVersion = tickleNodeSplit(server.getZooKeeper(),
            parent.getRegionInfo(), a.getRegionInfo(), b.getRegionInfo(),
            server.getServerName(), &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.znodeVersion);
          spins++;
        } &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.znodeVersion != -1 &amp;amp;&amp;amp; !server.isStopped()
            &amp;amp;&amp;amp; !services.isStopping());
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;In 0.92, condition for while loop is (this.znodeVersion != -1)&lt;br/&gt;
Meaning, we check whether the znode exists before writing new version.&lt;/p&gt;</comment>
                            <comment id="13491206" author="lhofhansl" created="Tue, 6 Nov 2012 04:39:07 +0000"  >&lt;p&gt;Assigning to 0.94.4 for now, since this is not new (I believe)&lt;/p&gt;</comment>
                            <comment id="13491234" author="ram_krish" created="Tue, 6 Nov 2012 06:21:41 +0000"  >&lt;p&gt;@Ted&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
     &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.znodeVersion = transitionNodeSplit(server.getZooKeeper(),
          parent.getRegionInfo(), a.getRegionInfo(), b.getRegionInfo(),
          server.getServerName(), &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.znodeVersion);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The znodeVersion is updated once the node is changed to Split for the first time. in both versions.&lt;/p&gt;</comment>
                            <comment id="13491357" author="ram_krish" created="Tue, 6 Nov 2012 10:10:44 +0000"  >&lt;p&gt;May be this and &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7103&quot; title=&quot;Need to fail split if SPLIT znode is deleted even before the split is completed.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7103&quot;&gt;&lt;del&gt;HBASE-7103&lt;/del&gt;&lt;/a&gt; are different.&lt;/p&gt;</comment>
                            <comment id="13491386" author="jiangbinglover" created="Tue, 6 Nov 2012 11:07:11 +0000"  >&lt;p&gt;If znode change state from SPLITTING to SPLIT, please assert HRegionServer SplitTransaction wait a long time that HMaster-AssignmentManager has finished the clean-up work.Maybe it can add a ZooKeeperWatcher in the SplitTransaction.&lt;/p&gt;
</comment>
                            <comment id="13492637" author="lhofhansl" created="Wed, 7 Nov 2012 19:39:08 +0000"  >&lt;p&gt;Pulling back into 0.94.3, so that we at least have a look before 0.94.3 goes out.&lt;/p&gt;</comment>
                            <comment id="13494370" author="lhofhansl" created="Fri, 9 Nov 2012 22:27:57 +0000"  >&lt;p&gt;Any chance for a test for this, Bing?&lt;/p&gt;</comment>
                            <comment id="13495003" author="lhofhansl" created="Sun, 11 Nov 2012 21:33:12 +0000"  >&lt;p&gt;Pushing to 0.94.4 after all.&lt;/p&gt;</comment>
                            <comment id="13525801" author="davelatham" created="Thu, 6 Dec 2012 22:00:43 +0000"  >&lt;p&gt;We&apos;ve run in to this a few times.  What&apos;s the best workaround for this?  So far we&apos;ve been restarting the master process.&lt;/p&gt;</comment>
                            <comment id="13525814" author="davelatham" created="Thu, 6 Dec 2012 22:13:48 +0000"  >&lt;p&gt;Correction, got my notes wrong.  For this one, I restarted the master but that did not solve it.  Manually going in to ZK and doing a rmr on the /hbase/unassigned regions did seem to solve it.  Would that have any other unpleasant side effects?&lt;/p&gt;</comment>
                            <comment id="13526116" author="ram_krish" created="Fri, 7 Dec 2012 03:23:41 +0000"  >&lt;p&gt;As far i see if the split was successful and only the znodes were not cleared then the cleanup that you had done should do no harm.  Are you using 0.92?&lt;/p&gt;</comment>
                            <comment id="13526592" author="davelatham" created="Fri, 7 Dec 2012 18:14:52 +0000"  >&lt;p&gt;Yes, I&apos;m using 0.92.  I should note that until I intervened that the region server in question had it&apos;s split thread stuck waiting for the master to complete, and so it stopped processing other splits which eventually led to some huge regions and some other problems.  Relevant regionserver log output like:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;2012-12-06 00:00:03,346 DEBUG org.apache.hadoop.hbase.regionserver.SplitTransaction: Still waiting on the master to process the split for 374f57cc18a7f8ee54b322350c009169
2012-12-06 00:00:03,449 DEBUG org.apache.hadoop.hbase.zookeeper.ZKAssign: regionserver:60020-0x13ae81c303ef0c2-0x13ae81c303ef0c2-0x13ae81c303ef0c2 Attempting to transition node 374f57cc18a7f8ee54b322350c009169 from RS_ZK_REGION_SPLIT to RS_ZK_REGION_SPLIT
2012-12-06 00:00:03,451 DEBUG org.apache.hadoop.hbase.zookeeper.ZKAssign: regionserver:60020-0x13ae81c303ef0c2-0x13ae81c303ef0c2-0x13ae81c303ef0c2 Successfully transitioned node 374f57cc18a7f8ee54b322350c009169 from RS_ZK_REGION_SPLIT to RS_ZK_REGION_SPLIT
2012-12-06 00:00:03,553 DEBUG org.apache.hadoop.hbase.zookeeper.ZKAssign: regionserver:60020-0x13ae81c303ef0c2-0x13ae81c303ef0c2-0x13ae81c303ef0c2 Attempting to transition node 374f57cc18a7f8ee54b322350c009169 from RS_ZK_REGION_SPLIT to RS_ZK_REGION_SPLIT
2012-12-06 00:00:03,554 DEBUG org.apache.hadoop.hbase.zookeeper.ZKAssign: regionserver:60020-0x13ae81c303ef0c2-0x13ae81c303ef0c2-0x13ae81c303ef0c2 Successfully transitioned node 374f57cc18a7f8ee54b322350c009169 from RS_ZK_REGION_SPLIT to RS_ZK_REGION_SPLIT
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13535739" author="lhofhansl" created="Wed, 19 Dec 2012 07:24:14 +0000"  >&lt;p&gt;Moving to 0.94.5, since we do not have a patch.&lt;/p&gt;</comment>
                            <comment id="13558486" author="lhofhansl" created="Mon, 21 Jan 2013 02:29:22 +0000"  >&lt;p&gt;This is possibly a dup of &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7551&quot; title=&quot;nodeChildrenChange event may happen after the transition to RS_ZK_REGION_SPLITTING in SplitTransaction causing the SPLIT event to be missed in the master side.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7551&quot;&gt;&lt;del&gt;HBASE-7551&lt;/del&gt;&lt;/a&gt;. The issue fixed there would lead to region begin stuck in SPLITTING forever (until a master restart at least), since the Assignment Manager would never learn about it.&lt;/p&gt;</comment>
                            <comment id="13563759" author="lhofhansl" created="Sun, 27 Jan 2013 08:02:17 +0000"  >&lt;p&gt;I think this is a dup.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 6 Nov 2012 03:29:40 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>255398</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 44 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0eron:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>84247</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>