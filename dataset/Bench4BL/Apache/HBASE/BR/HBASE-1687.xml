<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 02 20:29:27 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-1687/HBASE-1687.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-1687] bin/hbase script doesn&apos;t allow for different memory settings for each daemon type</title>
                <link>https://issues.apache.org/jira/browse/HBASE-1687</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;bin/hbase assumes that all daemon types ( master, regionserver ), all use the same memory settings.. (HBASE_HEAPSIZE).&lt;/p&gt;

&lt;p&gt;1) I propose adding daemon specific OPTS much like hadoop already has ( HBASE_MASTER_OPTS, HBASE_REGIONSERVER_OPTS ).&lt;/p&gt;

&lt;p&gt;So in bin/hbase, we would merge in the daemon specific opts within the case statement as such:&lt;/p&gt;

&lt;p&gt;elif [ &quot;$COMMAND&quot; = &quot;master&quot; ] ; then&lt;br/&gt;
  CLASS=&apos;org.apache.hadoop.hbase.master.HMaster&apos;&lt;br/&gt;
  HBASE_OPTS=&quot;$HBASE_OPTS $HBASE_MASTER_OPTS&quot;&lt;br/&gt;
elif [ &quot;$COMMAND&quot; = &quot;regionserver&quot; ] ; then&lt;br/&gt;
  CLASS=&apos;org.apache.hadoop.hbase.regionserver.HRegionServer&apos;&lt;br/&gt;
  HBASE_OPTS=&quot;$HBASE_OPTS $HBASE_REGIONSERVER_OPTS&quot;&lt;/p&gt;


&lt;p&gt;the new environment variables can then be added to hbase-env.sh as empty:&lt;/p&gt;

&lt;p&gt;export HBASE_MASTER_OPTS=&quot;&quot;&lt;br/&gt;
export HBASE_REGIONSERVER=&quot;&quot;&lt;br/&gt;
..etc&lt;/p&gt;



&lt;p&gt;2) I propose changes to that script to allow overriding the default memory ( HBASE_HEAPSIZE ), with daemon specific OPTS (HBASE_MASTER_OPTS, etc ).&lt;/p&gt;

&lt;p&gt;Basically at the bottom of the bin/hbase script, it will check to see if the user has already set &quot;-Xmx&quot; in the HBASE_OPTS variable.. if so, then it will ignore the JAVA_HEAP_SIZE variable..&lt;/p&gt;

&lt;p&gt;as such:&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;run it&lt;br/&gt;
if [[ $HBASE_OPTS == &lt;b&gt;-Xmx&lt;/b&gt; ]]; then&lt;br/&gt;
  exec &quot;$JAVA&quot; $HBASE_OPTS -classpath &quot;$CLASSPATH&quot; $CLASS &quot;$@&quot;&lt;br/&gt;
else&lt;br/&gt;
  exec &quot;$JAVA&quot; $JAVA_HEAP_MAX $HBASE_OPTS -classpath &quot;$CLASSPATH&quot; $CLASS &quot;$@&quot;&lt;br/&gt;
fi&lt;/li&gt;
&lt;/ol&gt;




&lt;p&gt;I will attach the file as I have modified it..&lt;/p&gt;</description>
                <environment></environment>
        <key id="12431205">HBASE-1687</key>
            <summary>bin/hbase script doesn&apos;t allow for different memory settings for each daemon type</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="fern">Fernando Padilla</reporter>
                        <labels>
                    </labels>
                <created>Thu, 23 Jul 2009 01:58:39 +0000</created>
                <updated>Fri, 20 Nov 2015 13:01:52 +0000</updated>
                            <resolved>Fri, 11 Sep 2009 22:18:33 +0000</resolved>
                                                    <fixVersion>0.20.1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                <comments>
                            <comment id="12734454" author="stack" created="Thu, 23 Jul 2009 04:23:38 +0000"  >&lt;p&gt;This change looks good.  We need it.&lt;/p&gt;

&lt;p&gt;Do you know how to make a patch?  That&apos;d be better but I can work with what you&apos;ve put above.&lt;/p&gt;

&lt;p&gt;The only thing that concerns me is whether this test:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; [[ $HBASE_OPTS == *-Xmx* ]]; then
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;... is portable bash.  Where did you get it from?  Do you know it will work on bash on other operating systems?&lt;/p&gt;

&lt;p&gt;Thanks.&lt;/p&gt;</comment>
                            <comment id="12734677" author="fern" created="Thu, 23 Jul 2009 18:15:34 +0000"  >&lt;p&gt;Sorry about not being in a patch form, I have been a little lazy because I actually built it in ec2.. since at the moment I can&apos;t do 1.6 dev work on my workstation &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; (soon).  So I just copied the whole file &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;It is from the latest trunk if you want to generate the diff.. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;  else I&apos;ll do it later today or tomorrow...&lt;/p&gt;


&lt;p&gt;The bash &quot;contains&quot; ( == &lt;b&gt;-Xmx&lt;/b&gt; )  I got from a StackOverflow question.  I am not a bash expert, so I just googled &quot;bash contains&quot;, and people suggested various things ( like using grep ), but this one did show up a few times, so I went with it.. it looked a little big cleaner.&lt;/p&gt;</comment>
                            <comment id="12734679" author="ryanobjc" created="Thu, 23 Jul 2009 18:21:39 +0000"  >&lt;p&gt;what if my HBASE_OPTS dont start with -Xmx, what then?&lt;/p&gt;

&lt;p&gt;I think we should copy whatever hadoop is doing here, they have multiple options for each type of daemon.&lt;/p&gt;</comment>
                            <comment id="12734689" author="fern" created="Thu, 23 Jul 2009 18:31:43 +0000"  >&lt;p&gt;sadly, hadoop has this bug as well &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;I submitted pretty much this exact same bug against bin/hadoop &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; (just changed hadoop with hbase)&lt;/p&gt;

&lt;p&gt;I just realized, it&apos;s hard to see because this wiki thinks I&apos;m trying to bold the code, but there are &apos;*&apos; around the -Xmx, those are bash globs..  so it means.. if the $var equals &amp;lt;glob&amp;gt;-Xmx&amp;lt;glob&amp;gt; so it should match -Xmx anywhere in the string.. try it out..&lt;/p&gt;

&lt;p&gt;you should be able to create a simple bash file.. that has a variable, then an if statement like above, then echo &quot;CONTAINS&quot; else echo &quot;NOT CONTAINS&quot;, and you&apos;ll see it working..&lt;/p&gt;</comment>
                            <comment id="12734690" author="fern" created="Thu, 23 Jul 2009 18:32:39 +0000"  >&lt;p&gt;This is the related hadoop bug: &lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-6167&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HADOOP-6167&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12734870" author="fern" created="Fri, 24 Jul 2009 01:52:43 +0000"  >&lt;p&gt;ok, this is the diff.  Please have a look, it should be pretty straight forward.&lt;/p&gt;

&lt;p&gt;I changed it a little bit from a Doug Cutting suggestion to add JAVA_HEAP_SIZE into the H*_OPTS before the exec line.. and remove it from the exec line..&lt;/p&gt;</comment>
                            <comment id="12735860" author="fern" created="Tue, 28 Jul 2009 00:38:53 +0000"  >
&lt;p&gt;1) we still need support for OPTS for each daemon type.&lt;/p&gt;

&lt;p&gt;2) we might not need the fancy JAVA_HEAP_SIZE handling, since it looks like java ignores duplicate Xmx settings, and keeps the last one in the command line.. so it looks ok.. as long as the default is put first in the command line.. (but changing the script does make it a little cleaner..)&lt;/p&gt;</comment>
                            <comment id="12735918" author="stack" created="Tue, 28 Jul 2009 04:28:06 +0000"  >&lt;p&gt;I tried this.&lt;/p&gt;

&lt;p&gt;I added defaults to hbase-env.sh and to test uncommented some:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Index: conf/hbase-env.sh
===================================================================
--- conf/hbase-env.sh   (revision 798386)
+++ conf/hbase-env.sh   (working copy)
@@ -23,6 +23,7 @@
 
 # The java implementation to use.  Java 1.6 required.
 # export JAVA_HOME=/usr/java/jdk1.6.0/
+export JAVA_HOME=&lt;span class=&quot;code-quote&quot;&gt;&quot;/&lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;/Library/Frameworks/JavaVM.framework/Versions/1.6/Home/&quot;&lt;/span&gt;
 
 # Extra Java CLASSPATH elements.  Optional.
 # export HBASE_CLASSPATH=
@@ -30,6 +31,17 @@
 # The maximum amount of heap to use, in MB. Default is 1000.
 # export HBASE_HEAPSIZE=1000
 
+# Heap to give regionserver. Default is HBASE_HEAPSIZE.
+# export HBASE_REGIONSERVER_OPTS=${HBASE_HEAPSIZE}
+
+# Heap to give master. Default is HBASE_HEAPSIZE.
+# export HBASE_MASTER_OPTS=${HBASE_HEAPSIZE}
+export HBASE_MASTER_OPTS=&lt;span class=&quot;code-quote&quot;&gt;&quot;-Xmx513m -Xms513m&quot;&lt;/span&gt;
+
+# Heap to give master. Default is HBASE_HEAPSIZE.
+# export HBASE_QUORUMPEER_OPTS=${HBASE_HEAPSIZE}
+export HBASE_QUORUMPEER_OPTS=&lt;span class=&quot;code-quote&quot;&gt;&quot;-Xmx514m -Xms514m&quot;&lt;/span&gt;
+
 # Extra Java runtime options.
 # Below are what we set by &lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;.  May only work with SUN JVM.
 # For more on why as well as other possible settings,
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;In my process listing I see that the HBASE_HEAPSIZE always comes afterward so if java takes last -Xms, then it will always take default.  So we could swap HBASE_HEAPSIZE and HBASE_REGIONSERVER_OPTS, etc.?  Is that the idea ? As is it don&apos;t seem to be too useful.&lt;/p&gt;</comment>
                            <comment id="12753876" author="ryanobjc" created="Thu, 10 Sep 2009 22:49:39 +0000"  >&lt;p&gt;here is my implementation of this, modelled after how hadoop does it.  In my setup I end up with this:&lt;/p&gt;

&lt;p&gt;14682 ?        SNl    3:25 /usr/java/jdk1.6.0_14/bin/java -Xmx4000m -Xmx1000m -XX:+DoEscapeAnalysis -XX:+AggressiveOpts -XX:+UseConcMarkSweepGC ....&lt;/p&gt;


&lt;p&gt;and jmap says:&lt;br/&gt;
$ jmap -heap 14682&lt;br/&gt;
Attaching to process ID 14682, please wait...&lt;br/&gt;
Debugger attached successfully.&lt;br/&gt;
Server compiler detected.&lt;br/&gt;
JVM version is 14.0-b13&lt;/p&gt;

&lt;p&gt;using parallel threads in the new generation.&lt;br/&gt;
using thread-local object allocation.&lt;br/&gt;
Concurrent Mark-Sweep GC&lt;/p&gt;

&lt;p&gt;Heap Configuration:&lt;br/&gt;
   MinHeapFreeRatio = 40&lt;br/&gt;
   MaxHeapFreeRatio = 70&lt;br/&gt;
   MaxHeapSize      = 1048576000 (1000.0MB)&lt;br/&gt;
   NewSize          = 67108864 (64.0MB)&lt;br/&gt;
   MaxNewSize       = 67108864 (64.0MB)&lt;br/&gt;
   OldSize          = 201326592 (192.0MB)&lt;br/&gt;
   NewRatio         = 7&lt;br/&gt;
   SurvivorRatio    = 8&lt;br/&gt;
   PermSize         = 21757952 (20.75MB)&lt;br/&gt;
   MaxPermSize      = 88080384 (84.0MB)&lt;/p&gt;

&lt;p&gt;so java uses the last listed Xmx as the one to use.&lt;/p&gt;</comment>
                            <comment id="12754381" author="stack" created="Fri, 11 Sep 2009 22:18:33 +0000"  >&lt;p&gt;Committed to trunk and branch.&lt;/p&gt;

&lt;p&gt;Changed name of the regionserver variable from HBASE_RS_OPTS to be HBASE_REGIONSERVER_OPTS to be consistent. &lt;/p&gt;

&lt;p&gt;Also updated the metrics.xml doc. that gario recently contributed so it no longer describes adding above HBASE_*_OPTS.. no need now they have been committed.&lt;/p&gt;</comment>
                            <comment id="15017919" author="lars_francke" created="Fri, 20 Nov 2015 13:01:52 +0000"  >&lt;p&gt;This issue was closed as part of a bulk closing operation on 2015-11-20. All issues that have been resolved and where all fixVersions have been released have been closed (following discussions on the mailing list).&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12419231" name="HBASE-1687-ryan.patch" size="985" author="ryanobjc" created="Thu, 10 Sep 2009 22:49:39 +0000"/>
                            <attachment id="12414299" name="hbase" size="6978" author="fern" created="Thu, 23 Jul 2009 02:00:14 +0000"/>
                            <attachment id="12414398" name="hbase-script.diff" size="1495" author="fern" created="Fri, 24 Jul 2009 01:52:43 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 23 Jul 2009 04:23:38 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>25917</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 2 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0hep3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>99643</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>