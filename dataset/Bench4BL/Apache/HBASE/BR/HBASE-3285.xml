<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sat Dec 03 19:39:48 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-3285/HBASE-3285.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-3285] Hlog recovery takes too much time</title>
                <link>https://issues.apache.org/jira/browse/HBASE-3285</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Currently HBase uses append to trigger the close of HLog during Hlog split. Append is a very expensive operation, which involves not only NameNode operations but creating a writing pipeline. If one of datanodes on the pipeline has a problem, this recovery may takes minutes. I&apos;d like implement a lightweight NameNode operation to trigger lease recovery and make HBase to use this instead.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12491584">HBASE-3285</key>
            <summary>Hlog recovery takes too much time</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="hairong">Hairong Kuang</assignee>
                                    <reporter username="hairong">Hairong Kuang</reporter>
                        <labels>
                    </labels>
                <created>Mon, 29 Nov 2010 21:28:36 +0000</created>
                <updated>Fri, 20 Nov 2015 12:43:57 +0000</updated>
                            <resolved>Mon, 7 Mar 2011 18:55:21 +0000</resolved>
                                                    <fixVersion>0.90.2</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                <comments>
                            <comment id="12965038" author="jdcryans" created="Tue, 30 Nov 2010 00:50:27 +0000"  >&lt;p&gt;Would this new NN operation still goes through the lease recovery? In my experience, waiting on the leases to expire has been our biggest source of downtime.&lt;/p&gt;</comment>
                            <comment id="12965579" author="hairong" created="Wed, 1 Dec 2010 06:20:57 +0000"  >&lt;p&gt;This issue does not speedup the lease recovery process but will reduce the cost of triggering lease recovery. In our environment, we have observed over 10 minutes for append to finish due to a problematic datanode in the pipeline.&lt;/p&gt;</comment>
                            <comment id="12979000" author="hairong" created="Fri, 7 Jan 2011 22:40:14 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HDFS-1554&quot; title=&quot;Append 0.20: New semantics for recoverLease&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HDFS-1554&quot;&gt;&lt;del&gt;HDFS-1554&lt;/del&gt;&lt;/a&gt; provides a new semantics which will speed up lease recovery. (No need to wait for soft lease expiration).&lt;/p&gt;</comment>
                            <comment id="12979012" author="hairong" created="Fri, 7 Jan 2011 22:57:34 +0000"  >&lt;p&gt;Here is the patch that uses the new recoverLease API to recover HLog.&lt;/p&gt;

&lt;p&gt;I assume that CDH will pull in the HADOOP recoverLease change into their distribution.&lt;/p&gt;</comment>
                            <comment id="12998549" author="stack" created="Wed, 23 Feb 2011 21:16:06 +0000"  >&lt;p&gt;@Hairong Are there new exceptions when hdfs-1554 is in place?  This patch seems to just catch and wait and change whats logged, not call some new API (oh, it also adds a new convertion to FNFE).  Thanks.&lt;/p&gt;</comment>
                            <comment id="12998551" author="hairong" created="Wed, 23 Feb 2011 21:22:48 +0000"  >&lt;p&gt;RecoverLease does not introduce any new exception. The patch changed to use recoverLease not append to recover lease. &lt;a href=&quot;https://issues.apache.org/jira/browse/HDFS-1554&quot; title=&quot;Append 0.20: New semantics for recoverLease&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HDFS-1554&quot;&gt;&lt;del&gt;HDFS-1554&lt;/del&gt;&lt;/a&gt; did not introduce new API, but changed recoverLease semantics.&lt;/p&gt;</comment>
                            <comment id="13002878" author="stack" created="Sat, 5 Mar 2011 00:01:28 +0000"  >&lt;p&gt;Made patch work when recoverLease is not available by stealing from Nicolas&apos;s &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2312&quot; title=&quot;Possible data loss when RS goes into GC pause while rolling HLog&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2312&quot;&gt;&lt;del&gt;HBASE-2312&lt;/del&gt;&lt;/a&gt; patch; he uses reflection to test for recoverLease falling back on append if its missing (as opposed to this patch just using recoverLease).  Running tests.&lt;/p&gt;</comment>
                            <comment id="13002921" author="stack" created="Sat, 5 Mar 2011 04:30:24 +0000"  >&lt;p&gt;All tests on 0.90 pass w/ this patch in place.  TestReplication failed but when I ran it alone it passed.&lt;/p&gt;</comment>
                            <comment id="13002939" author="stack" created="Sat, 5 Mar 2011 06:18:28 +0000"  >&lt;p&gt;Did a bit of server killing on a cluster that was up on the tip of branch-0.20-append &amp;#8211; i.e. had hdfs-1520, 1555, and 1554 &amp;#8211; and recovery of lease seems to run nice and promptly.  Testing now on the branch-0.20-append that hbase 0.90.1 ships with, a branch-0.20-append that was absent 1520, 1555, and 1554.&lt;/p&gt;</comment>
                            <comment id="13002940" author="stack" created="Sat, 5 Mar 2011 06:26:55 +0000"  >&lt;p&gt;Patch for cdh3b2 adding recent additions from branch-0.20-append (hdfs-1520,1555,1554) used testing recover hlog works up on cdh too.  Running tests, I see a bunch fail &amp;#8211; TestPread, TestFileCreation, TestDatanodeBlockScanner.  Will try w/o this patch to see if I get same failure set.&lt;/p&gt;</comment>
                            <comment id="13002948" author="stack" created="Sat, 5 Mar 2011 07:52:00 +0000"  >&lt;p&gt;Fix a noisey log message in case where recoverlease method is missing.&lt;/p&gt;

&lt;p&gt;Tested on cluster w/o the api and seems to work fine.&lt;/p&gt;

&lt;p&gt;Will apply this patch to branch and trunk unless objection.  It can make use of the fs.recoverLease API if present purportedly skirting issues seen where we can get into a loop stuck trying to grab lease when trying to open a file for append.&lt;/p&gt;</comment>
                            <comment id="13003510" author="stack" created="Mon, 7 Mar 2011 18:49:44 +0000"  >&lt;p&gt;Unit tests are broke on branch-0.20-append.  In particular TestFileAppend4 fails in testRecoverFinalizedBlock.  Its broke before these 1520,1555,1554 patches went in.  TestMultiThreadedSync is also failing.&lt;/p&gt;

&lt;p&gt;Before applying patches to CDH3b2, I had this failing TestSyncingWriterInterrupted.  Seems sporadic though because after applying the 1520+ series of patches, only TestAppend4 failed.&lt;/p&gt;

&lt;p&gt;Going to apply this patch to hbase.&lt;/p&gt;</comment>
                            <comment id="13003518" author="stack" created="Mon, 7 Mar 2011 19:10:22 +0000"  >&lt;p&gt;Updated patch for cdh3b2.&lt;/p&gt;</comment>
                            <comment id="13003606" author="hudson" created="Mon, 7 Mar 2011 21:07:32 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK #1771 (See &lt;a href=&quot;https://hudson.apache.org/hudson/job/HBase-TRUNK/1771/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://hudson.apache.org/hudson/job/HBase-TRUNK/1771/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3285&quot; title=&quot;Hlog recovery takes too much time&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3285&quot;&gt;&lt;del&gt;HBASE-3285&lt;/del&gt;&lt;/a&gt; Hlog recovery takes too much time&lt;/p&gt;</comment>
                            <comment id="15017667" author="lars_francke" created="Fri, 20 Nov 2015 12:43:57 +0000"  >&lt;p&gt;This issue was closed as part of a bulk closing operation on 2015-11-20. All issues that have been resolved and where all fixVersions have been released have been closed (following discussions on the mailing list).&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                                                <inwardlinks description="is blocked by">
                                        <issuelink>
            <issuekey id="12491585">HDFS-1520</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12493774">HBASE-3379</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12472843" name="0004-Added-in-the-hdfs-1520-1555-1554-from-tip-of-the-bra.patch" size="40972" author="stack" created="Mon, 7 Mar 2011 19:10:22 +0000"/>
                            <attachment id="12472724" name="3285-v2.txt" size="2533" author="stack" created="Sat, 5 Mar 2011 00:01:28 +0000"/>
                            <attachment id="12472743" name="3285-v3.txt" size="2549" author="stack" created="Sat, 5 Mar 2011 07:52:00 +0000"/>
                            <attachment id="12467773" name="hbaseRecoverHLog.patch" size="2245" author="hairong" created="Fri, 7 Jan 2011 22:57:34 +0000"/>
                            <attachment id="12472740" name="hdfs-1520,1555,1554-for-cdh3b2.txt" size="37562" author="stack" created="Sat, 5 Mar 2011 06:26:55 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 30 Nov 2010 00:50:27 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>26761</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 2 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0b1ov:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>62386</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310192" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Release Note</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Adds hbase exploitation of  new lease recovery added by hdfs-1520.  New API is available at tip of branch-0.20-append, in advance of the version of hadoop that ships with 0.90.1 hbase (r1057313).  Must patch CDH to add the API.</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>