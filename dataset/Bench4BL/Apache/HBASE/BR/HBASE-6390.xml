<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sat Dec 03 16:22:00 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-6390/HBASE-6390.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-6390] append() and increment() may result in inconsistent result on retries.</title>
                <link>https://issues.apache.org/jira/browse/HBASE-6390</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;append() and increment() api can give inconsistent result in following scenarios :&lt;/p&gt;

&lt;p&gt;1- For eg, if the client does not receive the response in the specified time, it retries.  Now the first call to increment/append is already done and this retry will again make the operation to succeed.  &lt;br/&gt;
2- Now if the sync() to WAL fails we get an IOException, on getting an exception there is a retry done which again results in the doing the increment/append again.  &lt;/p&gt;

&lt;p&gt;When may need some sort of roll back for the second problem.&lt;/p&gt;

&lt;p&gt;For the first one we need to see how to handle this.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12598661">HBASE-6390</key>
            <summary>append() and increment() may result in inconsistent result on retries.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="3">Duplicate</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="ashutosh_jindal">Ashutosh Jindal</reporter>
                        <labels>
                    </labels>
                <created>Fri, 13 Jul 2012 04:30:51 +0000</created>
                <updated>Thu, 31 Jan 2013 04:14:36 +0000</updated>
                            <resolved>Thu, 31 Jan 2013 04:14:36 +0000</resolved>
                                    <version>0.94.0</version>
                    <version>0.95.2</version>
                                                        <due></due>
                            <votes>1</votes>
                                    <watches>9</watches>
                                                                <comments>
                            <comment id="13413870" author="apurtell" created="Fri, 13 Jul 2012 16:56:50 +0000"  >&lt;p&gt;So what you are looking for here is a way for a user to, perhaps optionally, make idempotent requests out of Append and Increment, correct?&lt;/p&gt;

&lt;p&gt;Let me volunteer a couple of strawmen:&lt;/p&gt;

&lt;p&gt;1) Could overload the timestamp of the Append and Increment requests. If the request is &quot;out of date&quot; relative to another request already applied, throw back a DoNotRetryException (or just a DNRE for that op if submitted as a MultiAction). This is roughly how ZooKeeper handles this class of distributed synchronization issue. Timestamp becomes a global sequence number. Not a logical sequence number so clocks must be closely synchronized. Each memstore would track the (server side) time of the most recent in-place update mutation. Could go further and keep a soft cache of in-place update times by row or even KV for use by append/increment/ICV. If more specific information gets evicted from the cache due to pressure then fallback to the per-memstore global timestamp would still insure correctness but potentially more resubmission work for the client/app.&lt;/p&gt;

&lt;p&gt;2) A more generic option could be:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Extend the API where the user can set an optional cookie (a long).&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;Keep a ring buffer of recent cookies up on the server.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;Check the buffer first if a request with given cookie has already been applied and throw an exception back to the client if so.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Wouldn&apos;t guarantee correctness outside of some time bound. Also I worry about state management on the server. How large would that buffer need to be to capture all cookies submitted within ~(2 * time bound)?&lt;/p&gt;</comment>
                            <comment id="13567340" author="apurtell" created="Thu, 31 Jan 2013 04:14:36 +0000"  >&lt;p&gt;Dup of &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3787&quot; title=&quot;Increment is non-idempotent but client retries RPC&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3787&quot;&gt;&lt;del&gt;HBASE-3787&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 13 Jul 2012 16:56:50 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>241798</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 44 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i02d3r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>11724</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>