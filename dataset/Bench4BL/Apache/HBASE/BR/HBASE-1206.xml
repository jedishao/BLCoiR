<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 02 20:30:06 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-1206/HBASE-1206.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-1206] Scanner spins when there are concurrent inserts to column family</title>
                <link>https://issues.apache.org/jira/browse/HBASE-1206</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;I had a MR job that would launch multiple scanners on a region that made updates to the same column family as they were scanning on (but not the same column). As a result, there were lots of processes that had to grep through all of the irrelevent inserts many times as flushes occurred.&lt;/p&gt;

&lt;p&gt;However, if I put the column that I was outputting to in the list of columns to scan for, everything worked quickly.&lt;/p&gt;

&lt;p&gt;The code that&apos;s causing this is:&lt;br/&gt;
01:13 &amp;lt; BenM&amp;gt;       keys&lt;span class=&quot;error&quot;&gt;&amp;#91;i&amp;#93;&lt;/span&gt; = new HStoreKey(HConstants.EMPTY_BYTE_ARRAY, this.store.getHRegionInfo());&lt;br/&gt;
01:13 &amp;lt; BenM&amp;gt;       if (firstRow != null &amp;amp;&amp;amp; firstRow.length != 0) {&lt;br/&gt;
01:13 &amp;lt; BenM&amp;gt;         if (findFirstRow(i, firstRow)) &lt;/p&gt;
{
01:13 &amp;lt; BenM&amp;gt;           continue;
01:13 &amp;lt; BenM&amp;gt;         }
&lt;p&gt;01:13 &amp;lt; BenM&amp;gt;       }&lt;br/&gt;
01:13 &amp;lt; BenM&amp;gt;       while (getNext&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/information.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;) {&lt;br/&gt;
01:13 &amp;lt; BenM&amp;gt;         if (columnMatch&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/information.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;) &lt;/p&gt;
{
01:13 &amp;lt; BenM&amp;gt;           break;
01:13 &amp;lt; BenM&amp;gt;         }
&lt;p&gt;01:13 &amp;lt; BenM&amp;gt;       }&lt;/p&gt;

&lt;p&gt;columnMatch() on the stuff that just got flushed out never returns true. This caused lots of problems to build up.&lt;/p&gt;

&lt;p&gt;The fix for this is:&lt;/p&gt;

&lt;p&gt;(10:58:30 PM) BenM: IMHO, this is a somewhat easier issue to fix&lt;br/&gt;
(10:58:38 PM) BenM: i think it could be done in a way that cleans up the code&lt;br/&gt;
(10:58:50 PM) BenM: right now, the code just scans through each of the map files&lt;br/&gt;
(10:59:02 PM) BenM: without regard to the relative key positions&lt;br/&gt;
(10:59:12 PM) BenM: i think it could use a priority queue so that it only works on the relevent files&lt;br/&gt;
(11:01:22 PM) St^Ack_: BenM: please expand, I don&apos;t follow exactly&lt;br/&gt;
(11:01:50 PM) BenM: lets say we have two map files&lt;br/&gt;
(11:02:09 PM) BenM: one with 1/foo:bar 2/foo:bar 3/foo:bar&lt;br/&gt;
(11:02:17 PM) BenM: (row/family:col)&lt;br/&gt;
(11:02:31 PM) BenM: and the other with 1000/blah:blah 1001/blah:blah&lt;br/&gt;
(11:02:39 PM) BenM: the curent logic is&lt;br/&gt;
(11:02:44 PM) BenM: for each map file:&lt;br/&gt;
(11:02:56 PM) BenM:    find the first potential row in this file&lt;br/&gt;
(11:03:08 PM) BenM: look at min(all potential rows)&lt;br/&gt;
(11:03:34 PM) BenM: the algorith should be:&lt;br/&gt;
(11:03:43 PM) BenM: q = new PriorityQueue()&lt;br/&gt;
(11:04:05 PM) BenM: for each map file: insert the HStoreKey of the first key in the file&lt;br/&gt;
(11:04:17 PM) BenM: while(k = q.pop()) &lt;/p&gt;
{
(11:04:37 PM) BenM:   if (k is intersting) break;
(11:04:37 PM) BenM:   advance k
(11:04:37 PM) BenM:   q.push(k)
(11:04:38 PM) BenM: }</description>
                <environment></environment>
        <key id="12415194">HBASE-1206</key>
            <summary>Scanner spins when there are concurrent inserts to column family</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="bmaurer">Ben Maurer</reporter>
                        <labels>
                    </labels>
                <created>Fri, 20 Feb 2009 04:36:02 +0000</created>
                <updated>Sun, 13 Sep 2009 22:24:25 +0000</updated>
                            <resolved>Tue, 16 Jun 2009 16:12:48 +0000</resolved>
                                    <version>0.19.0</version>
                                    <fixVersion>0.20.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12680616" author="stack" created="Tue, 10 Mar 2009 21:06:22 +0000"  >&lt;p&gt;Can I push this refactor out to 0.19.2 Ben?  ColumnMatch should run faster after hbase-1253 if that&apos;ll help any.  &lt;/p&gt;</comment>
                            <comment id="12680674" author="streamy" created="Tue, 10 Mar 2009 22:55:21 +0000"  >&lt;p&gt;This issue seems to be inline with the discussion in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-1249&quot; title=&quot;Rearchitecting of server, client, API, key format, etc for 0.20&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-1249&quot;&gt;&lt;del&gt;HBASE-1249&lt;/del&gt;&lt;/a&gt;.  Is something still broken related to this issue?  Or just inefficient?  If it&apos;s an inefficiency, we will definitely be looking closely at this for 0.20.  Up to you, Ben, if you want to attempt this for 0.19.x.  If not a bug, let&apos;s move it out of 0.19.1 so we can get the RC out.&lt;/p&gt;</comment>
                            <comment id="12680698" author="bmaurer" created="Wed, 11 Mar 2009 00:07:35 +0000"  >&lt;p&gt;Yeah, this can be pushed back.&lt;/p&gt;</comment>
                            <comment id="12680920" author="stack" created="Wed, 11 Mar 2009 16:55:17 +0000"  >&lt;p&gt;Moving out of 0.19.1 with Ben&apos;s permission.&lt;/p&gt;</comment>
                            <comment id="12703747" author="streamy" created="Tue, 28 Apr 2009 17:10:56 +0000"  >&lt;p&gt;Pulling in to 0.20&lt;/p&gt;</comment>
                            <comment id="12703748" author="streamy" created="Tue, 28 Apr 2009 17:11:47 +0000"  >&lt;p&gt;Should be able to fix this with 1249 rework.  The optimization ben suggests is exactly the type of implementation we are going for with 1249-related issues.&lt;/p&gt;</comment>
                            <comment id="12705451" author="stack" created="Sun, 3 May 2009 21:30:49 +0000"  >&lt;p&gt;Moving out of 0.19.2.&lt;/p&gt;</comment>
                            <comment id="12713114" author="streamy" created="Tue, 26 May 2009 17:02:19 +0000"  >&lt;p&gt;New KVScanner and other new scanners in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-1304&quot; title=&quot;New client server implementation of how gets and puts are handled. &quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-1304&quot;&gt;&lt;del&gt;HBASE-1304&lt;/del&gt;&lt;/a&gt; should resolve this issue.&lt;/p&gt;</comment>
                            <comment id="12720208" author="streamy" created="Tue, 16 Jun 2009 16:08:49 +0000"  >&lt;p&gt;This issue is resolved by &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-1503&quot; title=&quot;hbase-1304 dropped updating list of store files on flush&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-1503&quot;&gt;&lt;del&gt;HBASE-1503&lt;/del&gt;&lt;/a&gt; and all changes in scanning from &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-1304&quot; title=&quot;New client server implementation of how gets and puts are handled. &quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-1304&quot;&gt;&lt;del&gt;HBASE-1304&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;The KeyValueHeap is now implemented using a PriorityQueue, as described in the original description of this issue.&lt;/p&gt;

&lt;p&gt;StoreScanner, which is the object notified of changed readers, is used on a per-row basis now, so inserts to a row will not cause the interruption described.&lt;/p&gt;

&lt;p&gt;We&apos;re also retaining our previous position when we do change the readers, so we&apos;re guaranteed to start where we left off last.&lt;/p&gt;</comment>
                            <comment id="12720209" author="stack" created="Tue, 16 Jun 2009 16:12:48 +0000"  >&lt;p&gt;Resolving as implemented.&lt;/p&gt;</comment>
                            <comment id="12720211" author="stack" created="Tue, 16 Jun 2009 16:13:30 +0000"  >&lt;p&gt;We can open a new issue if same thing happens in new context.&lt;/p&gt;

&lt;p&gt;Added this issue to CHANGES.txt.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310010">
                    <name>Incorporates</name>
                                                                <inwardlinks description="is part of">
                                        <issuelink>
            <issuekey id="12421797">HBASE-1304</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12403648">HBASE-867</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12416456">HBASE-1249</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 10 Mar 2009 21:06:22 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>25624</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 25 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0hbyf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>99199</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>