<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Thu Dec 01 20:05:59 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/CONFIGURATION-89/CONFIGURATION-89.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[CONFIGURATION-89] [configuration] Setting the reloading strategy to FileChangedReloadingStrategy erases entire configuration</title>
                <link>https://issues.apache.org/jira/browse/CONFIGURATION-89</link>
                <project id="12310467" key="CONFIGURATION">Commons Configuration</project>
                    <description>&lt;p&gt;When setting a PropertiesConfiguration reloading strategy to&lt;br/&gt;
FileChangedReloadingStrategy - the entire configuration is erased.&lt;/p&gt;

&lt;p&gt;The problem is that when the FileChangedReloadingStrategy is set, the&lt;br/&gt;
configuration file is erased and then reloaded and then written out.&lt;/p&gt;

&lt;p&gt;The file is erased in AbstractFileConfiguration.save(File) when a new&lt;br/&gt;
FileOutputStream is created.  Then in the PropertiesConfiguration.save(Writer)&lt;br/&gt;
the call to getKeys() causes a reaload() to occur (which the strategy says needs&lt;br/&gt;
to be reloaded because it has been modified).  But the saved config file is now&lt;br/&gt;
zeroed out by the new file stream, and it is read in as an empty config.&lt;/p&gt;


&lt;p&gt;Here is a testcase that exposed this defect:&lt;/p&gt;

&lt;p&gt;    public void&lt;br/&gt;
testPropertiesConfigurationWithFileChangedReloadingStrategyDefect() throws&lt;br/&gt;
ConfigurationException, FileNotFoundException, IOException &lt;/p&gt;
{
        FileWriter file = new FileWriter(&quot;testfile.properties&quot;);
        file.write(&quot;a=1&quot;);
        file.close();
        FileConfiguration config = new
PropertiesConfiguration(&quot;testfile.properties&quot;);
        config.setAutoSave(true);
        config.setReloadingStrategy(new FileChangedReloadingStrategy());

        assertEquals(&quot;1&quot;, config.getString(&quot;a&quot;));
        config.setProperty(&quot;2&quot;, &quot;b&quot;);
        assertEquals(&quot;1&quot;, config.getString(&quot;a&quot;));                        
    }</description>
                <environment>&lt;p&gt;Operating System: Windows XP&lt;br/&gt;
Platform: PC&lt;/p&gt;</environment>
        <key id="12342185">CONFIGURATION-89</key>
            <summary>[configuration] Setting the reloading strategy to FileChangedReloadingStrategy erases entire configuration</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.png">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="bsoutham@gmail.com">Blaine R Southam</reporter>
                        <labels>
                    </labels>
                <created>Thu, 14 Apr 2005 01:26:20 +0000</created>
                <updated>Sat, 22 Aug 2009 19:36:41 +0000</updated>
                            <resolved>Sat, 22 Aug 2009 19:36:41 +0000</resolved>
                                    <version>1.1</version>
                                    <fixVersion>1.2</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12409143" author="oliver.heger@t-online.de" created="Mon, 18 Apr 2005 19:17:06 +0000"  >&lt;p&gt;I had a look at this issue, but am yet unsure about the best way to solve it.&lt;br/&gt;
Here are some of my thoughts:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;In general setting both a reloading strategy and auto save mode can always&lt;br/&gt;
lead to problems because there can be concurrent changes in both the&lt;br/&gt;
Configuration object and the configuration file. Then the results cannot be&lt;br/&gt;
predicted.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;In this special case the problem lies in the call to getKeys() in the save()&lt;br/&gt;
method of PropertiesConfiguration. So a quick (and dirty?) solution would be to&lt;br/&gt;
access the properties in a different way, maybe by making the map with the&lt;br/&gt;
properties in BaseConfiguration protected.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;In the current implementation there is more danger potential in the&lt;br/&gt;
collaboration of save() methods and reloading behavior, e.g. a getProperty()&lt;br/&gt;
call might also cause a reload. So it might make sense to disable reloading as&lt;br/&gt;
long as a save() operation is executed. This could be achieved by setting a flag&lt;br/&gt;
(or increasing a counter) at the entrance of a save() method and resetting this&lt;br/&gt;
flag again in a finally block. If this flag is set, the reload() method would do&lt;br/&gt;
nothing.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I don&apos;t know the affected code too well, so I might be missing something obvious.&lt;/p&gt;</comment>
                            <comment id="12409144" author="oliver.heger@t-online.de" created="Fri, 6 May 2005 01:49:51 +0000"  >&lt;p&gt;Created an attachment (id=14945)&lt;br/&gt;
Unit test to illustrate the bug&lt;/p&gt;</comment>
                            <comment id="12409145" author="oliver.heger@t-online.de" created="Fri, 6 May 2005 01:54:21 +0000"  >&lt;p&gt;Created an attachment (id=14946)&lt;br/&gt;
Proposed fix for this issue&lt;/p&gt;

&lt;p&gt;This patch is a proposal to fix the problem:&lt;/p&gt;

&lt;p&gt;Two methods were added to AbstractFileConfiguration, enterNoReload() and&lt;br/&gt;
exitNoReload(). The former increments a counter, the latter decrements it. The&lt;br/&gt;
reload() method now first checks this counter and only performs a reloading if&lt;br/&gt;
the counter is 0.&lt;/p&gt;

&lt;p&gt;In PropertiesConfiguration the save() method calls these methods thus ensuring&lt;br/&gt;
that no problems are caused by a reload.&lt;/p&gt;

&lt;p&gt;Comments?&lt;/p&gt;</comment>
                            <comment id="12409146" author="oliver.heger@t-online.de" created="Wed, 18 May 2005 02:51:56 +0000"  >&lt;p&gt;Committed a patch, should be fixed in the next nightly builds.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12333460" name="ASF.LICENSE.NOT.GRANTED--AbstractFileConfiguration.diff" size="2768" author="oliver.heger@t-online.de" created="Fri, 6 May 2005 01:54:21 +0000"/>
                            <attachment id="12333459" name="ASF.LICENSE.NOT.GRANTED--TestFileConfiguration.diff" size="2092" author="oliver.heger@t-online.de" created="Fri, 6 May 2005 01:49:51 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_10010" key="com.atlassian.jira.plugin.system.customfieldtypes:importid">
                        <customfieldname>Bugzilla Id</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>34441</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 18 Apr 2005 19:17:06 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>33932</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 30 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0uodr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>177091</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>