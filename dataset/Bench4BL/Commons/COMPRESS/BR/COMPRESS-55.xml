<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Thu Dec 01 20:25:33 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/COMPRESS-55/COMPRESS-55.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[COMPRESS-55] CpioArchiveEntry ignores invalid modes</title>
                <link>https://issues.apache.org/jira/browse/COMPRESS-55</link>
                <project id="12310904" key="COMPRESS">Commons Compress</project>
                    <description>&lt;p&gt;CpioArchiveEntry has the following code:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
        &lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;:
            &lt;span class=&quot;code-comment&quot;&gt;// FIXME: testCpioUnarchive fails &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; I change the line to
&lt;/span&gt;            &lt;span class=&quot;code-comment&quot;&gt;// actually &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; the excpetion
&lt;/span&gt;            &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; IllegalArgumentException(&lt;span class=&quot;code-quote&quot;&gt;&quot;Unknown mode (full mode: &quot;&lt;/span&gt; + mode
                    + &lt;span class=&quot;code-quote&quot;&gt;&quot;, masked mode: &quot;&lt;/span&gt; + (mode &amp;amp; S_IFMT));
        }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;As the comment says, rejecting invalid modes causes test failures.&lt;/p&gt;

&lt;p&gt;These appear to be caused by the code&lt;/p&gt;

{bq}
&lt;p&gt;        this.cpioEntry.setMode(0);&lt;/p&gt;

&lt;p&gt;in the method CpioArchiveOutputStream.finish()&lt;/p&gt;

&lt;p&gt;Is a mode of 0 allowed? If so, then setMode needs to allow it, otherwise the method call needs to change to something else.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12419488">COMPRESS-55</key>
            <summary>CpioArchiveEntry ignores invalid modes</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="sebb@apache.org">Sebb</reporter>
                        <labels>
                    </labels>
                <created>Thu, 26 Mar 2009 13:14:23 +0000</created>
                <updated>Fri, 8 Mar 2013 05:09:58 +0000</updated>
                            <resolved>Tue, 31 Mar 2009 19:17:17 +0000</resolved>
                                                    <fixVersion>1.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12689471" author="sebb@apache.org" created="Thu, 26 Mar 2009 13:19:40 +0000"  >&lt;p&gt;CpioArchiveInputStream.readNewEntry() can also set the mode to 0  when tested by CpioArchiveInputStreamTest.testCpioUnarchive(). &lt;/p&gt;</comment>
                            <comment id="12689474" author="sebb@apache.org" created="Thu, 26 Mar 2009 13:30:37 +0000"  >&lt;p&gt;Just tried a test with mode 0 allowed.&lt;br/&gt;
One test fails:&lt;/p&gt;

&lt;p&gt;Unknown mode (full mode: 4294967295, masked mode: 61440&lt;br/&gt;
	at org.apache.commons.compress.archivers.cpio.CpioArchiveEntry.setMode(CpioArchiveEntry.java:605)&lt;br/&gt;
	at org.apache.commons.compress.archivers.cpio.CpioArchiveInputStream.readNewEntry(CpioArchiveInputStream.java:324)&lt;br/&gt;
	at org.apache.commons.compress.archivers.cpio.CpioArchiveInputStream.getNextCPIOEntry(CpioArchiveInputStream.java:182)&lt;br/&gt;
	at org.apache.commons.compress.archivers.cpio.CpioArchiveInputStream.getNextEntry(CpioArchiveInputStream.java:421)&lt;br/&gt;
	at org.apache.commons.compress.archivers.CpioTestCase.testCpioUnarchive(CpioTestCase.java:82)&lt;/p&gt;

&lt;p&gt;4294967295 = 0xFFFFFFFF&lt;br/&gt;
61440 = 0xF000&lt;/p&gt;

&lt;p&gt;I think this may be due to problems with EOF handling, because I don&apos;t think the test file has that data in it.&lt;/p&gt;</comment>
                            <comment id="12689501" author="sebb@apache.org" created="Thu, 26 Mar 2009 14:44:00 +0000"  >&lt;p&gt;Further investigation shows that the test file &lt;b&gt;does&lt;/b&gt; have FFFFFFFF in it.&lt;/p&gt;

&lt;p&gt;The file (bla.cpio) is a temporary archive created by the test case.&lt;/p&gt;

&lt;p&gt;It looks like the problem may be that the CpioArchiveEntry class initialises the mode to -1.&lt;/p&gt;

&lt;p&gt;I can get the test cases to pass by:&lt;/p&gt;

&lt;p&gt;1) Allowing setMode(0)&lt;br/&gt;
2) defaulting mode to 0 rather than -1.&lt;/p&gt;

&lt;p&gt;But I&apos;m not sure that this is the correct approach - does 0 make sense as a mode? &lt;br/&gt;
Perhaps only for the trailer, in which case using a default of 0 would make more sense.&lt;br/&gt;
The finish() method would not need to call setMode(0) if the default were 0.&lt;br/&gt;
However, when reading a trailer the mode will be read as 0.&lt;/p&gt;

&lt;p&gt;I suppose it might be worth throwing an Exception if the mode is zero but the record is not the trailer record.&lt;/p&gt;

&lt;p&gt;Also, I suspect the &quot;mtime&quot; field should be initialised to 0 rather than -1.&lt;/p&gt;</comment>
                            <comment id="12689551" author="cgrobmeier" created="Thu, 26 Mar 2009 17:00:40 +0000"  >&lt;p&gt;Here is the original dcos for the mode:&lt;/p&gt;

&lt;p&gt; The mode specifies both the regular permissions and the file  type.  It consists of several bit fields as follows:&lt;br/&gt;
	     0170000  This masks the file type bits.&lt;br/&gt;
	     0140000  File type value for sockets.&lt;br/&gt;
	     0120000  File type value for symbolic links.  For symbolic links, the link body is stored as file data.&lt;br/&gt;
	     0100000  File type value for regular files.&lt;br/&gt;
	     0060000  File type value for block special devices.&lt;br/&gt;
	     0040000  File type value for directories.&lt;br/&gt;
	     0020000  File type value for character special devices.&lt;br/&gt;
	     0010000  File type value for named pipes or FIFOs.&lt;br/&gt;
	     0004000  SUID bit.&lt;br/&gt;
	     0002000  SGID bit.&lt;br/&gt;
	     0001000  Sticky bit.  On some systems, this modifies the behavior of executables and/or directories.&lt;br/&gt;
	     0000777  The lower 9 bits specify read/write/execute permissions for world, group, and user following standard POSIX con-&lt;br/&gt;
		      ventions.&lt;/p&gt;

&lt;p&gt;This tells me, that 0 is not correct since it is not described in the above. But I am unsure about this. If defaulting, I would do something for regular files and 777  or something like that&lt;/p&gt;</comment>
                            <comment id="12689605" author="sebb@apache.org" created="Thu, 26 Mar 2009 19:00:19 +0000"  >&lt;p&gt;I&apos;ve just created some test files on the people host (7.1-STABLE FreeBSD).&lt;/p&gt;

&lt;p&gt;In the case of the &apos;bin&apos; &apos;newc&apos; and &apos;crc&apos; formats, the TRAILER record has a link count of 1, namesize 10, and all the other fields are 0.&lt;/p&gt;

&lt;p&gt;So I think the defaults in the CpioArchiveEntry should also be set to 0.&lt;/p&gt;</comment>
                            <comment id="12689636" author="sebb@apache.org" created="Thu, 26 Mar 2009 20:34:20 +0000"  >&lt;p&gt;I&apos;ve changed the default header values to zero:&lt;/p&gt;

&lt;p&gt;URL: &lt;a href=&quot;http://svn.apache.org/viewvc?rev=758837&amp;amp;view=rev&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewvc?rev=758837&amp;amp;view=rev&lt;/a&gt;&lt;br/&gt;
Log:&lt;br/&gt;
The default value for fileFormat must be chosen so checkNewFormat() and checkOldFormat() both fail; -1 is not suitable.&lt;br/&gt;
Initialise other fields to zero as that is what the trailer needs.&lt;br/&gt;
Update Javadoc&lt;/p&gt;

&lt;p&gt;The output stream no longer needs to set the mode:&lt;br/&gt;
URL: &lt;a href=&quot;http://svn.apache.org/viewvc?rev=758838&amp;amp;view=rev&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewvc?rev=758838&amp;amp;view=rev&lt;/a&gt;&lt;br/&gt;
Log:&lt;br/&gt;
Mode defaults to zero, so no need to set it.&lt;/p&gt;</comment>
                            <comment id="12689647" author="sebb@apache.org" created="Thu, 26 Mar 2009 20:49:44 +0000"  >&lt;p&gt;Fixed for Input as well:&lt;/p&gt;

&lt;p&gt;URL: &lt;a href=&quot;http://svn.apache.org/viewvc?rev=758846&amp;amp;view=rev&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewvc?rev=758846&amp;amp;view=rev&lt;/a&gt;&lt;br/&gt;
Log:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/COMPRESS-55&quot; title=&quot;CpioArchiveEntry ignores invalid modes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;COMPRESS-55&quot;&gt;&lt;del&gt;COMPRESS-55&lt;/del&gt;&lt;/a&gt; Don&apos;t attempt to set mode zero. Print error if mode 0 found not in trailer.&lt;/p&gt;

&lt;p&gt;Just need to decide if the stacktrace should become a thrown Exception.&lt;/p&gt;</comment>
                            <comment id="12694216" author="sebb@apache.org" created="Tue, 31 Mar 2009 19:17:17 +0000"  >&lt;p&gt;Now throws an error for invalid mode&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 26 Mar 2009 17:00:40 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>110565</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 36 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0b43z:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>62778</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>