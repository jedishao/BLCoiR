<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Thu Dec 01 20:39:02 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/COMPRESS-85/COMPRESS-85.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[COMPRESS-85] cpio archive final entry corrupt</title>
                <link>https://issues.apache.org/jira/browse/COMPRESS-85</link>
                <project id="12310904" key="COMPRESS">Commons Compress</project>
                    <description>&lt;p&gt;The code below is called with an array of 4 file names. The cpio archive archive.cpio is created with no error messages, but when I then run the Unix command &quot;cpio -ivct &amp;lt;archive.cpio&quot; it reports the error &quot;Can&apos;t read input&quot; on the last file in the archive. If I run &quot;cpio -ivcBmu &amp;lt;archive.cpio&quot; the last file is incomplete, but the other files are extracted correctly. Same result in AIX and Linux.&lt;/p&gt;

&lt;p&gt;{{&lt;br/&gt;
  private void createArchive(String[] outFiles)&lt;br/&gt;
  throws FileNotFoundException, IOException, ArchiveException {&lt;br/&gt;
    short format = CpioArchiveOutputStream.FORMAT_OLD_ASCII;&lt;br/&gt;
    final OutputStream out = new FileOutputStream(&quot;archive.cpio&quot;);&lt;br/&gt;
    ArchiveOutputStream os = new CpioArchiveOutputStream(out, format);&lt;/p&gt;

&lt;p&gt;    for (int j = 0; j &amp;lt; outFiles.length; j++) &lt;/p&gt;
{
      System.out.println(&quot;Entry = &quot; + outFiles[j]);
      File f = new File(outFiles[j]);
      CpioArchiveEntry entry = new CpioArchiveEntry(format);
      entry.setName(outFiles[j]);
      entry.setSize(f.length());
      os.putArchiveEntry(entry);
      IOUtils.copy(new FileInputStream(outFiles[j]), os);
      os.closeArchiveEntry();
    }
&lt;p&gt;    os.finish();&lt;br/&gt;
    os.close();&lt;br/&gt;
  }&lt;br/&gt;
}}&lt;/p&gt;</description>
                <environment>&lt;p&gt;Java 1.4.2 run on AIX and Linux&lt;/p&gt;</environment>
        <key id="12436922">COMPRESS-85</key>
            <summary>cpio archive final entry corrupt</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="bmaier">Bill Maier</reporter>
                        <labels>
                    </labels>
                <created>Wed, 30 Sep 2009 14:58:58 +0000</created>
                <updated>Thu, 18 Feb 2010 14:56:20 +0000</updated>
                            <resolved>Thu, 18 Feb 2010 14:56:20 +0000</resolved>
                                    <version>1.0</version>
                                    <fixVersion>1.1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12833875" author="bodewig" created="Mon, 15 Feb 2010 16:26:57 +0000"  >&lt;p&gt;It may be that the result depends on the actual files being archived.  I&apos;ve turned your snippet into the trivial program (soon to be) attached and created an archive of four files from the current svn tree of commons compress (as of 2010-02-15) and cpio on my Linux box is happy with the result created with either the 1.0 version or currsnt svn trunk.&lt;/p&gt;

&lt;p&gt;Would it be possible for you to provide a set of files where creation fails?&lt;/p&gt;</comment>
                            <comment id="12833946" author="bmaier" created="Mon, 15 Feb 2010 19:51:02 +0000"  >&lt;p&gt;I&apos;ve attached a .tar file containing 4 class files and a readme.txt description. Saw the same problem when tried to put the 4 class files into a cpio archive. I used your file Creator.java to run. I suspect now that the files are not the problem - might be a combination of the older Java version we use (1.4.2) and the operating system. The attached readme.txt file shows the result in AIX. I also tried on Linux, which gave the error &quot;cpio: premature end of file&quot; when running cpio -ivct on the resulting file.&lt;/p&gt;</comment>
                            <comment id="12834083" author="bodewig" created="Tue, 16 Feb 2010 05:17:06 +0000"  >&lt;p&gt;At least the VM seems to be part of the problem, yes.  I&apos;ve just tried your classes (thanks!) on my Linux box and the archive seems to be fine, unfortunately I don&apos;t have a 1.4 JVM for Linux around, will try later today on my work Windows box where I have an old Sun 1.4.2 around.&lt;/p&gt;

&lt;p&gt;In any case, could you please also attach the archive that has been created so I can do a byte by byte comparison with the one I have created on Linux which works?  This may help diagnosing the problem even if I can&apos;t reproduce it myself.&lt;/p&gt;</comment>
                            <comment id="12834084" author="bodewig" created="Tue, 16 Feb 2010 05:22:37 +0000"  >&lt;p&gt;CPIO archive created with Creator.java from Bill&apos;s class files which seems to work fine on my Linux machine for reference&lt;/p&gt;</comment>
                            <comment id="12834141" author="bodewig" created="Tue, 16 Feb 2010 10:01:15 +0000"  >&lt;p&gt;I get the exact same cpio file using JDK 1.4.2 (Sun&apos;s) on Windows as well.&lt;/p&gt;</comment>
                            <comment id="12834196" author="bmaier" created="Tue, 16 Feb 2010 13:08:35 +0000"  >&lt;p&gt;Archive created by Creator class. The system cpio command on AIX and Linux is unable to read this file.&lt;/p&gt;</comment>
                            <comment id="12834203" author="bmaier" created="Tue, 16 Feb 2010 13:21:19 +0000"  >&lt;p&gt;I downloaded the archive you attached, and copied it to my AIX machine. I get the same error when the system command cpio tries to read the file:&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;npd1:/home/bmaier/test/java/creator&amp;#93;&lt;/span&gt; cpio -ivct &amp;lt;archive.cpio&lt;br/&gt;
0      root         593 Dec 31 18:00:00 1969 ApplicationException.class&lt;br/&gt;
0      root         857 Dec 31 18:00:00 1969 BData.class&lt;br/&gt;
0      root         342 Dec 31 18:00:00 1969 BufException.class&lt;br/&gt;
Can&apos;t read input&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;npd1:/home/bmaier/test/java/creator&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;Compared Stefan&apos;s archive with mine and they are byte-for-byte identical. I&apos;m running SUSE on the Linux machine:&lt;/p&gt;

&lt;p&gt;bmaier@ftw-srv-arv2-02:~&amp;gt; cat /etc/*-release&lt;br/&gt;
LSB_VERSION=&quot;core-2.0-noarch:core-3.0-noarch:core-2.0-ia32:core-3.0-ia32&quot;&lt;br/&gt;
SUSE Linux Enterprise Server 10 (i586)&lt;br/&gt;
VERSION = 10&lt;br/&gt;
PATCHLEVEL = 2&lt;/p&gt;
</comment>
                            <comment id="12834229" author="bodewig" created="Tue, 16 Feb 2010 14:33:23 +0000"  >&lt;p&gt;OK, so the problem is the version of cpio not the version of Java or the files - that&apos;s even worse.&lt;/p&gt;

&lt;p&gt;In my case it has been Ubuntu 9.04 which provides GNU cpio 2.9 (that&apos;s what cpio --version says).  I&apos;ll see whether I do have access to a Unix machine running a different flavor of cpio.&lt;/p&gt;

&lt;p&gt;Does it help (as a workaround) if you switch to one of the other formats the CPIO classes provide?&lt;/p&gt;</comment>
                            <comment id="12834232" author="bodewig" created="Tue, 16 Feb 2010 14:48:07 +0000"  >&lt;p&gt;The other one I&apos;ve found so far (Solaris) doesn&apos;t like the archive at all&lt;/p&gt;

&lt;p&gt;$ cpio -ivct &amp;lt; archive.cpio&lt;br/&gt;
cpio: Not a cpio file, bad header.&lt;br/&gt;
1 errors&lt;/p&gt;

&lt;p&gt;I guess I have some reading on the different cpio formats to do ...&lt;/p&gt;</comment>
                            <comment id="12834239" author="bmaier@nhsrx.com" created="Tue, 16 Feb 2010 14:58:30 +0000"  >&lt;p&gt;The cpio version on our SUSE is GNU cpio 2.6, quite a bit earlier than Stefan&apos;s version. Cpio on AIX doesn&apos;t seem to have an equivalent way of getting the version number.&lt;/p&gt;

&lt;p&gt;I have tried other formats (although for our specific application we need the old ASCII format). It has the same trouble with all the formats I&apos;ve tried, FORMAT_NEW and FORMAT_OLD_BINARY. Sometimes I get an &quot;Out of phase&quot; error, but I think this is when my flags don&apos;t match the archive format:&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;npd1:/home/bmaier/test/java/creator&amp;#93;&lt;/span&gt; cpio -ivct &amp;lt;archive.cpio&lt;/p&gt;


&lt;p&gt;Out of phase!&lt;br/&gt;
cpio attempting to continue...&lt;br/&gt;
Can&apos;t read input&lt;/p&gt;

</comment>
                            <comment id="12834265" author="bodewig" created="Tue, 16 Feb 2010 15:43:25 +0000"  >&lt;p&gt;So far I&apos;ve found a few places where we seem to deviate a bit from &lt;a href=&quot;http://people.freebsd.org/~kientzle/libarchive/man/cpio.5.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://people.freebsd.org/~kientzle/libarchive/man/cpio.5.txt&lt;/a&gt; or our own description in the javadocs of CpioArchiveEntry.  Mainly:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;namelen could be wrong in non.ASCII cases - not the case with the example files&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;dev/ino are always 0 but should be different for each entry&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;nlink is always 0 but should at least be 1 for files and 2 for directories&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;The permissions and gid/uid are also 0 but that should be OK.  Neither of these things would explain why cpio would be happy with the first three entries but doesn&apos;t like the forth one.  Can you isolate the forth one as the one causing the problem?  I.e. do you get valid archives when putting only the first three into it, or just the forth one?&lt;/p&gt;

&lt;p&gt;Back into hexl-mode trying to see whether there is anything fishy with the last entry.&lt;/p&gt;</comment>
                            <comment id="12834269" author="bmaier" created="Tue, 16 Feb 2010 15:49:12 +0000"  >&lt;p&gt;Still get &quot;can&apos;t read input&quot; error from cpio -ivct when only 3 files are in the archive.&lt;/p&gt;</comment>
                            <comment id="12834284" author="bodewig" created="Tue, 16 Feb 2010 16:13:46 +0000"  >&lt;p&gt;After explicitly setting inode, device and nlink Solaris at least sees the entries:&lt;/p&gt;

&lt;p&gt;-bash-3.00$ cpio -ivct &amp;lt; archive.cpio&lt;br/&gt;
cpio: Impossible file type&lt;br/&gt;
----------    1 root     root         593 Feb 16 16:08 2010, ApplicationException.class&lt;br/&gt;
cpio: Impossible file type&lt;br/&gt;
----------    1 root     root         857 Feb 16 16:08 2010, BData.class&lt;br/&gt;
cpio: Impossible file type&lt;br/&gt;
----------    1 root     root         342 Feb 16 16:08 2010, BufException.class&lt;br/&gt;
cpio: Impossible file type&lt;br/&gt;
----------    1 root     root        1274 Feb 16 16:08 2010, ByteArrayUtil.class&lt;/p&gt;

&lt;p&gt;7 blocks&lt;br/&gt;
4 error(s)&lt;/p&gt;</comment>
                            <comment id="12834288" author="bodewig" created="Tue, 16 Feb 2010 16:18:07 +0000"  >&lt;p&gt;and now with explicit file mode.  Solaris is happy.  What does your cpio say?&lt;/p&gt;</comment>
                            <comment id="12834294" author="bmaier" created="Tue, 16 Feb 2010 16:27:10 +0000"  >&lt;p&gt;Got same error on AIX with the attached archive, but on SUSE cpio now reports &quot;cpio:premature end of file&quot;.&lt;/p&gt;</comment>
                            <comment id="12834815" author="bodewig" created="Wed, 17 Feb 2010 16:00:52 +0000"  >&lt;p&gt;OK, I created a cpio archive of your example files with GNU cpio.  It looks as if cpio archives are supposed to write files in blocks of 512 bytes - actually the block size is a command line option for cpio.&lt;/p&gt;

&lt;p&gt;The attached archive has been created with Creator.java and svn revision 911031 of commons compress.  Does it work for your cpio versions?&lt;/p&gt;</comment>
                            <comment id="12834829" author="bmaier" created="Wed, 17 Feb 2010 16:37:41 +0000"  >&lt;p&gt;That archive works on AIX using either&lt;/p&gt;

&lt;p&gt;  cpio -ivct &amp;lt;archive.cpio&lt;/p&gt;

&lt;p&gt;for listing or&lt;/p&gt;

&lt;p&gt;  cpio -ivcmu &amp;lt;archive.cpio&lt;/p&gt;

&lt;p&gt;for extraction. Apparently the block size is a factor here, so you&apos;ve&lt;br/&gt;
made some progress. Interestingly it still doesn&apos;t work using&lt;/p&gt;

&lt;p&gt;  cpio -ivcBmu &amp;lt;archive.cpio&lt;/p&gt;

&lt;p&gt;where the B option is supposed to force 512-byte blocks (?!).&lt;/p&gt;

&lt;p&gt;Cpio still can&apos;t read the archive in SUSE. I tried all of these commands:&lt;/p&gt;

&lt;p&gt;  cpio -ivct &amp;lt;archive.cpio&lt;br/&gt;
  cpio -ivctB &amp;lt;archive.cpio&lt;br/&gt;
  cpio -ivctC512 &amp;lt;archive.cpio&lt;br/&gt;
  cpio -ivctC5120 &amp;lt;archive.cpio&lt;br/&gt;
  cpio -ivctC 5120 &amp;lt;archive.cpio&lt;br/&gt;
  cpio -ivctC 512 &amp;lt;archive.cpio&lt;br/&gt;
  cpio -ivct --block-size=512 &amp;lt;archive.cpio&lt;br/&gt;
  cpio -ivct --block-size=5120 &amp;lt;archive.cpio&lt;/p&gt;

&lt;p&gt;It always reports &quot;cpio: premature end of file&quot;.&lt;/p&gt;</comment>
                            <comment id="12835176" author="bodewig" created="Thu, 18 Feb 2010 12:18:33 +0000"  >&lt;p&gt;This is both frustrating and fun in a strange way.&lt;/p&gt;

&lt;p&gt;-B sets the block size to 5120 while the archive is created with a size of 512, so it isn&apos;t supposed to work.  With svn revision 911353 I&apos;ve made the block size configurable.&lt;/p&gt;

&lt;p&gt;I&apos;ve also introduced some logic inside the library so you don&apos;t have to set inode and device explicitly in order to get unique values.  nlink and mode should now at least provide reasonable default values.&lt;/p&gt;

&lt;p&gt;archive.cpio has been created with Creator.java and commons-compress svn revision 911353, archive2.cpio has been created with GNU cpio 2.9 on Ubuntu Linux 9.04.  They only differ in device and inode numbers and timestamps.&lt;/p&gt;

&lt;p&gt;Since the archive doesn&apos;t work for your Suse system, could you please create a cpio archive of your our files and upload it here as well?&lt;/p&gt;</comment>
                            <comment id="12835185" author="bmaier" created="Thu, 18 Feb 2010 13:33:04 +0000"  >&lt;p&gt;archive3.cpio was made with this command:&lt;/p&gt;

&lt;p&gt;  ls *class |cpio -ovc &amp;gt;archive3.cpio&lt;/p&gt;

&lt;p&gt;archive4.cpio was made with this command:&lt;/p&gt;

&lt;p&gt;  ls *class |cpio -ovcB &amp;gt;archive4.cpio&lt;/p&gt;

&lt;p&gt;Both were made on SUSE Linux (SLES 10).&lt;/p&gt;</comment>
                            <comment id="12835214" author="bodewig" created="Thu, 18 Feb 2010 14:20:48 +0000"  >&lt;p&gt;both archives use the &quot;new ascii&quot; format, so it looks as if -c didn&apos;t work.&lt;/p&gt;

&lt;p&gt;If I use my GNU cpio 2.9 and &quot;cpio -cvt &amp;lt; archive?.cpio&quot; I now get the &quot;premature end of file&quot;.&lt;/p&gt;

&lt;p&gt;The alternative to -c is &quot;-H odc&quot; - does that work to list/extract archive.cpio?&lt;/p&gt;</comment>
                            <comment id="12835223" author="bmaier" created="Thu, 18 Feb 2010 14:35:05 +0000"  >&lt;p&gt;These commands work on cpio.archive for SUSE to list and extract:&lt;/p&gt;

&lt;p&gt;   cpio -ivt -H odc &amp;lt;archive.cpio&lt;br/&gt;
   cpio -iv -H odc &amp;lt;archive.cpio&lt;/p&gt;

&lt;p&gt;So SUSE cpio won&apos;t do old ASCII format apparently.&lt;/p&gt;</comment>
                            <comment id="12835228" author="bodewig" created="Thu, 18 Feb 2010 14:47:58 +0000"  >&lt;p&gt;I&apos;m not sure whether you are saying that the commands with -D odc work for my cpio archives on Suse or not.  If they do then Suse&apos;s cpio works for old ascii but the -c switch is broken.&lt;/p&gt;

&lt;p&gt;In any case it means compress now creates cpio archives that can be extracted on AIX and Solaris and with GNU cpio 2.9.  I&apos;ll resolve this issue once I&apos;ve documented the fix.&lt;/p&gt;</comment>
                            <comment id="12835234" author="bodewig" created="Thu, 18 Feb 2010 14:56:20 +0000"  >&lt;p&gt;fixed and documented with svn revision 911427&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12436197" name="Creator.java" size="1188" author="bodewig" created="Thu, 18 Feb 2010 12:18:33 +0000"/>
                            <attachment id="12436198" name="archive.cpio" size="3584" author="bodewig" created="Thu, 18 Feb 2010 12:18:33 +0000"/>
                            <attachment id="12436199" name="archive2.cpio" size="3584" author="bodewig" created="Thu, 18 Feb 2010 12:18:33 +0000"/>
                            <attachment id="12436203" name="archive3.cpio" size="4096" author="bmaier" created="Thu, 18 Feb 2010 13:33:04 +0000"/>
                            <attachment id="12436204" name="archive4.cpio" size="5120" author="bmaier" created="Thu, 18 Feb 2010 13:33:04 +0000"/>
                            <attachment id="12435900" name="cpio.tar" size="10240" author="bmaier" created="Mon, 15 Feb 2010 19:51:02 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 15 Feb 2010 16:26:57 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>40276</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 42 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0b4kv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>62854</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>