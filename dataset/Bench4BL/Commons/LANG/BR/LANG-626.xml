<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Wed Nov 30 23:19:07 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/LANG-626/LANG-626.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[LANG-626] object cloning with SerializationUtils has classloader problems with no workaround</title>
                <link>https://issues.apache.org/jira/browse/LANG-626</link>
                <project id="12310481" key="LANG">Commons Lang</project>
                    <description>&lt;p&gt;In WebLogic 10.3, commons_lang is included on the main classpath, trumping the commons_lang on a webapp classpath (in webinf/lib).  This causes ClassNotFoundException errors when using SerializationUtils.clone() because Java serialization uses the classloader of the current class (class invoked from) when doing serialization.  Java serialization does not respond to the thread context classloader.&lt;/p&gt;

&lt;p&gt;Fix: The following web page suggests a fix (including the full source code) that honors the context classloader if set.  I don&apos;t know if this is the ideal solution, but at least it allows the problem to be worked around without affecting working behavior for existing clients.&lt;br/&gt;
&lt;a href=&quot;http://www.mail-archive.com/commons-dev@jakarta.apache.org/msg44524.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://www.mail-archive.com/commons-dev@jakarta.apache.org/msg44524.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Workaround: There is a flag to set on weblogic that inverts the classloader.  &lt;b&gt;HOWEVER&lt;/b&gt;, this only works if the webapp does not need certain xml jars.   Otherwise, WebLogic will fail to start because &lt;b&gt;it&lt;/b&gt; has classloader issues.    Therefore, this is not an acceptable workaround.  &lt;/p&gt;

&lt;p&gt;Another workaround: The only workaround I know of is to copy the SerializationUtils class into a different package in my app so that the proper invocation context will be used for serialization.  This is very undesirable.&lt;/p&gt;

&lt;p&gt;I found these 3 bugs in the database that all seem to be the same problem.  &lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/OJB-140&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/OJB-140&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/LANG-241&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/LANG-241&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/JS2-831&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/JS2-831&lt;/a&gt;&lt;/p&gt;
</description>
                <environment>&lt;p&gt;WebLogic 10.3&lt;/p&gt;</environment>
        <key id="12467372">LANG-626</key>
            <summary>object cloning with SerializationUtils has classloader problems with no workaround</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="ernestp">Ernest Pasour</reporter>
                        <labels>
                    </labels>
                <created>Fri, 18 Jun 2010 19:54:23 +0000</created>
                <updated>Wed, 16 Nov 2011 06:56:36 +0000</updated>
                            <resolved>Tue, 2 Aug 2011 06:57:17 +0000</resolved>
                                                    <fixVersion>3.0.1</fixVersion>
                                    <component>lang.*</component>
                        <due></due>
                            <votes>2</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="12881099" author="bayard" created="Tue, 22 Jun 2010 06:51:21 +0000"  >&lt;p&gt;mail-archive isn&apos;t working for me right now; I&apos;m guessing it&apos;s this thread from 2004:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://commons.markmail.org/thread/trfdrjeb6qohru7p&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://commons.markmail.org/thread/trfdrjeb6qohru7p&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The right solution, imo, is for Weblogic to do what all containers do/should do and use a package name rewrite at build time so they have their dependencies in private space. Presumably not likely to happen.&lt;/p&gt;

&lt;p&gt;Need to look at the attached mailing list code, also consider the option in &lt;a href=&quot;https://issues.apache.org/jira/browse/LANG-241&quot; title=&quot;[lang] Need ClassLoader support for SerializationUtils&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LANG-241&quot;&gt;&lt;del&gt;LANG-241&lt;/del&gt;&lt;/a&gt; that asked for an optional ClassLoader parameter.&lt;/p&gt;</comment>
                            <comment id="12881671" author="ernestp" created="Wed, 23 Jun 2010 12:46:36 +0000"  >&lt;p&gt;Yes, that appears to be the same thread I was referring to.&lt;/p&gt;

&lt;p&gt;I agree that it seems like WebLogic should repackage the code to avoid this issue, but I also agree that&apos;s not likely to happen. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="12885516" author="sludwig" created="Tue, 6 Jul 2010 12:25:23 +0000"  >&lt;p&gt;I encountered the same problem within the Tomcat-Container and my web-application. commons-lang is on the shared classpath, but the objects to clone are in the web-application.&lt;/p&gt;

&lt;p&gt;I vote for this issue to be fixed in such a way that the developer does not need to do more than call the right method on SerializationUtils. In these modern days it would be nice to have a working clone tool that saves one the potentially large hassle of keeping track of deep-clone methods or deep-clone copy-constructors.&lt;/p&gt;</comment>
                            <comment id="12885582" author="markt" created="Tue, 6 Jul 2010 16:21:15 +0000"  >&lt;p&gt;w.r.t. WebLogic: I assume folks using it have a support contract and since this is a clear bug I&apos;d recommend using your support contract to pressure Oracle into a fix. Yes it takes time and requires generally making a nuisance of yourself but it can be done - at least I got a handful of Oracle app server bugs fixed that way.&lt;/p&gt;

&lt;p&gt;w.r.t. Tomcat: if commons-lang is on the common class path it is because the user put it there. Tomcat does not use and does not ship with commons-lang and to the best of my recollection never has. The correct solution in this case is to put commons-lang where it belongs - in WEB-INF/lib. This would also work for any spec compliant servlet container.&lt;/p&gt;

&lt;p&gt;In terms of the original proposed patch, I am not a fan of configuration via system properties unless there is no other choice. I&apos;m not convinced that is the case here. I would also recommend testing to ensure that this patch does not trigger a class-loader memory leak. It shouldn&apos;t, but based on past experience I wouldn&apos;t be surprised if it did. Assuming no memory leak, the only remaining argument against the patch is one of bloat. Should we add code to commons-lang just to work around another product&apos;s bugs? My general view is that we shouldn&apos;t so I&apos;d be -0 for applying this patch.&lt;/p&gt;</comment>
                            <comment id="12885890" author="sludwig" created="Wed, 7 Jul 2010 08:59:18 +0000"  >&lt;p&gt;Proposal of additional method for the SerializationUtils that works with the current thread context ClassLoader. Fixes the problem under Tomcat. Attached ContextClassLoaderAwareCloneMethod.zip with two java files. Note that the code makes use of generics, but it can be easily adjusted to work under Java 1.4.&lt;/p&gt;</comment>
                            <comment id="12893180" author="azgard" created="Wed, 28 Jul 2010 13:46:39 +0000"  >&lt;p&gt;@Mark:&lt;br/&gt;
Whats about a OSGi environment? There are many classloaders around and i could not copy commons-lang.jar to every plugin it use commons-lang.&lt;/p&gt;

&lt;p&gt;Why not add all SerializationUtils methods a second method with classloader attribute and then resolve classes within the ObjectOutputStream with the submitted classloader and/or ContextClassLoader?&lt;/p&gt;</comment>
                            <comment id="13007343" author="bayard" created="Wed, 16 Mar 2011 04:04:19 +0000"  >&lt;p&gt;Assigning to 3.1 to consider Sven&apos;s patch.&lt;/p&gt;</comment>
                            <comment id="13007406" author="sludwig" created="Wed, 16 Mar 2011 10:29:56 +0000"  >&lt;p&gt;Attaching new second version as a good alternative. In this one it is possible to specify a ClassLoader that takes precedence over the Context-ClassLoader. We needed this, because in a Mock-Scenario we had some cglib-generated classes that could not be found on the Context-ClassLoader.&lt;/p&gt;</comment>
                            <comment id="13076072" author="bayard" created="Tue, 2 Aug 2011 06:57:18 +0000"  >&lt;p&gt;Thanks Sven &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;svn ci -m &quot;Applying Sven Ludwig&apos;s patch from &lt;a href=&quot;https://issues.apache.org/jira/browse/LANG-626&quot; title=&quot;object cloning with SerializationUtils has classloader problems with no workaround&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LANG-626&quot;&gt;&lt;del&gt;LANG-626&lt;/del&gt;&lt;/a&gt;. This modifies the SerializationUtils.clone method to use the threadContextLoader if it is unable to find a class using the object&apos;s current classloader. This should (hopefully) help with Weblogic and Tomcat situations where Lang is outside the web-inf for some reason (likely user error with Tomcat, by design for Weblogic)&quot;&lt;br/&gt;
Sending        pom.xml&lt;br/&gt;
Sending        src/main/java/org/apache/commons/lang3/SerializationUtils.java&lt;br/&gt;
Transmitting file data ..&lt;br/&gt;
Committed revision 1153046.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12473774" name="ClassLoaderAwareCloneMethod.zip" size="1998" author="sludwig" created="Wed, 16 Mar 2011 10:29:56 +0000"/>
                            <attachment id="12448868" name="ContextClassLoaderAwareCloneMethod.zip" size="3175" author="sludwig" created="Wed, 7 Jul 2010 08:59:18 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 22 Jun 2010 06:51:21 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>66520</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 18 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0d5ov:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>74698</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>