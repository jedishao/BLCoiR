<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun Nov 20 17:33:58 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/IO-160/IO-160.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[IO-160] [patch] FileSystemUtils.freeSpace fails on solaris </title>
                <link>https://issues.apache.org/jira/browse/IO-160</link>
                <project id="12310477" key="IO">Commons IO</project>
                    <description>&lt;p&gt;FileSystemUtils.freeSpace fails its tests on Solaris.  The following patch fixes it, and with it all tests pass on:&lt;br/&gt;
RedHat (FC7, EL3, EL4, CentOS4, CentOS5) and Solaris (8, 9-sparc, 9-i386, 10-sparc, 10-i386).&lt;/p&gt;

&lt;p&gt;The fix is to force the use of /usr/xpg4/bin/df on Solaris, which is the posix version.  This then means that the output-parsing works as expected.&lt;/p&gt;


&lt;p&gt;Index: src/java/org/apache/commons/io/FileSystemUtils.java&lt;br/&gt;
===================================================================&lt;br/&gt;
RCS file: /cvsroot/upstream/jpackage/jakarta-commons-io/src/java/org/apache/commons/io/FileSystemUtils.java,v&lt;br/&gt;
retrieving revision 1.1.1.1&lt;br/&gt;
retrieving revision 1.1.1.1.2.3&lt;br/&gt;
diff -u -r1.1.1.1 -r1.1.1.1.2.3&lt;br/&gt;
&amp;#8212; src/java/org/apache/commons/io/FileSystemUtils.java 2 Mar 2007 06:31:03 -0000       1.1.1.1&lt;br/&gt;
+++ src/java/org/apache/commons/io/FileSystemUtils.java 28 Mar 2008 11:56:06 -0000      1.1.1.1.2.3&lt;br/&gt;
@@ -64,6 +64,10 @@&lt;/p&gt;

&lt;p&gt;     /** The operating system flag. */&lt;br/&gt;
     private static final int OS;&lt;br/&gt;
+&lt;br/&gt;
+    /** The path to df */&lt;br/&gt;
+    private static String dfPath = &quot;df&quot;;&lt;br/&gt;
+&lt;br/&gt;
     static {&lt;br/&gt;
         int os = OTHER;&lt;br/&gt;
         try {&lt;br/&gt;
@@ -76,9 +80,6 @@&lt;br/&gt;
             if (osName.indexOf(&quot;windows&quot;) != -1) &lt;/p&gt;
{
                 os = WINDOWS;
             }
&lt;p&gt; else if (osName.indexOf(&quot;linux&quot;) != -1 ||&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;osName.indexOf(&quot;sun os&quot;) != -1 ||&lt;/li&gt;
	&lt;li&gt;osName.indexOf(&quot;sunos&quot;) != -1 ||&lt;/li&gt;
	&lt;li&gt;osName.indexOf(&quot;solaris&quot;) != -1 ||&lt;br/&gt;
                 osName.indexOf(&quot;mpe/ix&quot;) != -1 ||&lt;br/&gt;
                 osName.indexOf(&quot;freebsd&quot;) != -1 ||&lt;br/&gt;
                 osName.indexOf(&quot;irix&quot;) != -1 ||&lt;br/&gt;
@@ -86,6 +87,11 @@&lt;br/&gt;
                 osName.indexOf(&quot;unix&quot;) != -1 ||&lt;br/&gt;
                 osName.indexOf(&quot;mac os x&quot;) != -1) 
{
                 os = UNIX;
+            }
&lt;p&gt; else if (osName.indexOf(&quot;sun os&quot;) != -1 ||&lt;br/&gt;
+                osName.indexOf(&quot;sunos&quot;) != -1 ||&lt;br/&gt;
+                osName.indexOf(&quot;solaris&quot;) != -1) &lt;/p&gt;
{
+                os = POSIX_UNIX;
+                dfPath = &quot;/usr/xpg4/bin/df&quot;;
             }
&lt;p&gt; else if (osName.indexOf(&quot;hp-ux&quot;) != -1 ||&lt;br/&gt;
                 osName.indexOf(&quot;aix&quot;) != -1) {&lt;br/&gt;
                 os = POSIX_UNIX;&lt;br/&gt;
@@ -116,7 +122,7 @@&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;ul&gt;
	&lt;li&gt;of 
{@link #freeSpaceKb(String)}
&lt;p&gt; which returns a result in kilobytes.&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;&amp;lt;p&amp;gt;&lt;/li&gt;
	&lt;li&gt;Note that some OS&apos;s are NOT currently supported, including OS/390,&lt;/li&gt;
&lt;/ul&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;* OpenVMS and and SunOS 5. (SunOS is supported by &amp;lt;code&amp;gt;freeSpaceKb&amp;lt;/code&amp;gt;.)&lt;br/&gt;
+     * OpenVMS. &lt;/li&gt;
&lt;/ul&gt;
&lt;ul&gt;
	&lt;li&gt;&amp;lt;pre&amp;gt;&lt;/li&gt;
	&lt;li&gt;FileSystemUtils.freeSpace(&quot;C:&quot;);       // Windows&lt;/li&gt;
	&lt;li&gt;FileSystemUtils.freeSpace(&quot;/volume&quot;);  // *nix&lt;br/&gt;
@@ -317,14 +323,14 @@&lt;br/&gt;
             flags += &quot;P&quot;;&lt;br/&gt;
         }&lt;br/&gt;
         String[] cmdAttribs = &lt;/li&gt;
&lt;/ul&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;(flags.length() &amp;gt; 1 ? new String[] 
{&quot;df&quot;, flags, path}
&lt;p&gt; : new String[] &lt;/p&gt;
{&quot;df&quot;, path}
&lt;p&gt;);&lt;br/&gt;
+            (flags.length() &amp;gt; 1 ? new String[] &lt;/p&gt;
{dfPath, flags, path}
&lt;p&gt; : new String[] &lt;/p&gt;
{dfPath, path}
&lt;p&gt;);&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;         // perform the command, asking for up to 3 lines (header, interesting, overflow)&lt;br/&gt;
         List lines = performCommand(cmdAttribs, 3);&lt;br/&gt;
         if (lines.size() &amp;lt; 2) &lt;/p&gt;
{
             // unknown problem, throw exception
             throw new IOException(
-                    &quot;Command line &apos;df&apos; did not return info as expected &quot; +
+                    &quot;Command line &apos;&quot; + dfPath + &quot;&apos; did not return info as expected &quot; +
                     &quot;for path &apos;&quot; + path + &quot;&apos;- response was &quot; + lines);
         }
&lt;p&gt;         String line2 = (String) lines.get(1); // the line we&apos;re interested in&lt;br/&gt;
@@ -338,7 +344,7 @@&lt;br/&gt;
                 tok = new StringTokenizer(line3, &quot; &quot;);&lt;br/&gt;
             } else &lt;/p&gt;
{
                 throw new IOException(
-                        &quot;Command line &apos;df&apos; did not return data as expected &quot; +
+                        &quot;Command line &apos;&quot; + dfPath + &quot;&apos; did not return data as expected &quot; +
                         &quot;for path &apos;&quot; + path + &quot;&apos;- check path is valid&quot;);
             }
&lt;p&gt;         } else {&lt;br/&gt;
@@ -364,14 +370,14 @@&lt;br/&gt;
             long bytes = Long.parseLong(freeSpace);&lt;br/&gt;
             if (bytes &amp;lt; 0) &lt;/p&gt;
{
                 throw new IOException(
-                        &quot;Command line &apos;df&apos; did not find free space in response &quot; +
+                        &quot;Command line &apos;&quot; + dfPath + &quot;&apos; did not find free space in response &quot; +
                         &quot;for path &apos;&quot; + path + &quot;&apos;- check path is valid&quot;);
             }
&lt;p&gt;             return bytes;&lt;/p&gt;

&lt;p&gt;         } catch (NumberFormatException ex) &lt;/p&gt;
{
             throw new IOException(
-                    &quot;Command line &apos;df&apos; did not return numeric data as expected &quot; +
+                    &quot;Command line &apos;&quot; + dfPath + &quot;&apos; did not return numeric data as expected &quot; +
                     &quot;for path &apos;&quot; + path + &quot;&apos;- check path is valid&quot;);
         }
&lt;p&gt;     }&lt;br/&gt;
Index: src/test/org/apache/commons/io/FileSystemUtilsTestCase.java&lt;br/&gt;
===================================================================&lt;br/&gt;
RCS file: /cvsroot/upstream/jpackage/jakarta-commons-io/src/test/org/apache/commons/io/FileSystemUtilsTestCase.java,v&lt;br/&gt;
retrieving revision 1.1.1.1&lt;br/&gt;
retrieving revision 1.1.1.1.2.6&lt;br/&gt;
diff -u -r1.1.1.1 -r1.1.1.1.2.6&lt;br/&gt;
&amp;#8212; src/test/org/apache/commons/io/FileSystemUtilsTestCase.java 2 Mar 2007 06:30:58 -0000       1.1.1.1&lt;br/&gt;
+++ src/test/org/apache/commons/io/FileSystemUtilsTestCase.java 28 Mar 2008 15:26:43 -0000      1.1.1.1.2.6&lt;br/&gt;
@@ -68,8 +68,13 @@&lt;br/&gt;
             // have to figure out unix block size&lt;br/&gt;
             String[] cmd = null;&lt;br/&gt;
             String osName = System.getProperty(&quot;os.name&quot;);&lt;br/&gt;
+            osName = osName.toLowerCase();&lt;br/&gt;
+&lt;br/&gt;
             if (osName.indexOf(&quot;hp-ux&quot;) &amp;gt;= 0 || osName.indexOf(&quot;aix&quot;) &amp;gt;= 0) {&lt;br/&gt;
                 cmd = new String[] &lt;/p&gt;
{&quot;df&quot;, &quot;-P&quot;, &quot;/&quot;}
&lt;p&gt;;&lt;br/&gt;
+            } else if (osName.indexOf(&quot;sunos&quot;) &amp;gt;= 0 || osName.indexOf(&quot;sun os&quot;) &amp;gt;= 0&lt;br/&gt;
+                       || osName.indexOf(&quot;solaris&quot;) &amp;gt;= 0) {&lt;br/&gt;
+                cmd = new String[] &lt;/p&gt;
{&quot;/usr/xpg4/bin/df&quot;, &quot;-P&quot;, &quot;/&quot;}
&lt;p&gt;;&lt;br/&gt;
             } else {&lt;br/&gt;
                 cmd = new String[] &lt;/p&gt;
{&quot;df&quot;, &quot;/&quot;}
&lt;p&gt;;&lt;br/&gt;
             }&lt;/p&gt;</description>
                <environment></environment>
        <key id="12392566">IO-160</key>
            <summary>[patch] FileSystemUtils.freeSpace fails on solaris </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="niallp">Niall Pemberton</assignee>
                                    <reporter username="mike.bristow@thus.net">Mike Bristow</reporter>
                        <labels>
                    </labels>
                <created>Fri, 28 Mar 2008 15:38:29 +0000</created>
                <updated>Fri, 22 Aug 2008 07:36:51 +0000</updated>
                            <resolved>Fri, 30 May 2008 11:14:26 +0000</resolved>
                                    <version>1.3.2</version>
                                    <fixVersion>2.0</fixVersion>
                                    <component>Utilities</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12583070" author="mike.bristow@thus.net" created="Fri, 28 Mar 2008 15:39:31 +0000"  >&lt;p&gt;Attach patch as attachment; otherwise it is mangled&lt;/p&gt;</comment>
                            <comment id="12583076" author="niallp" created="Fri, 28 Mar 2008 16:02:41 +0000"  >&lt;p&gt;Your patch looks like its generated from CVS - but we moved to subversion a year or two ago. Even when I tried to fix it for SVN I get a message saying its outdated. Could you re-generate your patch using the latest trunk from subversion please:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://commons.apache.org/io/source-repository.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://commons.apache.org/io/source-repository.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Also, from a quick scan of your proposed patch - adding a static String variable (i.e. dfPath) and updating it is a really bad idea since this method is not thread safe.&lt;/p&gt;</comment>
                            <comment id="12586701" author="bodewig" created="Tue, 8 Apr 2008 07:59:31 +0000"  >&lt;p&gt;You can see IO&apos;s unit tests fail on Gump&apos;s Solaris Zone&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://gump.zones.apache.org/gump/test/apache-commons/commons-io/gump_work/build_apache-commons_commons-io.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://gump.zones.apache.org/gump/test/apache-commons/commons-io/gump_work/build_apache-commons_commons-io.html&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12586708" author="niallp" created="Tue, 8 Apr 2008 08:21:11 +0000"  >&lt;p&gt;Stefan pointed out that since the dfPath is being set in the static initializer then my thread-safe comment in nonsense &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;I&apos;ve applied the patch, thanks&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://svn.apache.org/viewvc?view=rev&amp;amp;revision=645787&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewvc?view=rev&amp;amp;revision=645787&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12586732" author="sebb@apache.org" created="Tue, 8 Apr 2008 09:54:54 +0000"  >&lt;p&gt;At present the field is not written after class construction so is guaranteed visible to all threads.&lt;/p&gt;

&lt;p&gt;However, to avoid accidents It would be safer to make the field final, as is done with the OS field.&lt;/p&gt;</comment>
                            <comment id="12586740" author="niallp" created="Tue, 8 Apr 2008 10:26:48 +0000"  >&lt;p&gt;Good point, I&apos;ve made it final&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://svn.apache.org/viewvc?view=rev&amp;amp;revision=645828&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewvc?view=rev&amp;amp;revision=645828&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12378796" name="jakarta-commons-io.patch" size="5547" author="mike.bristow@thus.net" created="Fri, 28 Mar 2008 15:39:31 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 28 Mar 2008 16:02:41 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>139598</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 33 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0b16f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>62303</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>