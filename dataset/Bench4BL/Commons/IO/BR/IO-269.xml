<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun Nov 20 16:11:05 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/IO-269/IO-269.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[IO-269] Tailer locks file from deletion/rename on Windows</title>
                <link>https://issues.apache.org/jira/browse/IO-269</link>
                <project id="12310477" key="IO">Commons IO</project>
                    <description>&lt;p&gt;The Tailer code works on Windows, except that it locks the file against deletion or rename.&lt;/p&gt;

&lt;p&gt;The test code fails to detect this, because it fails to check if the file deletion succeeds.&lt;/p&gt;

&lt;p&gt;This seems to be a Windows OS issue.&lt;/p&gt;

&lt;p&gt;A possible solution might be to keep closing and re-opening the file.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12503836">IO-269</key>
            <summary>Tailer locks file from deletion/rename on Windows</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="sebb@apache.org">Sebb</reporter>
                        <labels>
                    </labels>
                <created>Sat, 9 Apr 2011 17:00:32 +0000</created>
                <updated>Tue, 8 Nov 2016 17:57:27 +0000</updated>
                            <resolved>Mon, 11 Jun 2012 01:10:25 +0000</resolved>
                                                    <fixVersion>2.4</fixVersion>
                                        <due></due>
                            <votes>2</votes>
                                    <watches>4</watches>
                                                                <comments>
                            <comment id="13018287" author="niallp" created="Mon, 11 Apr 2011 11:14:57 +0000"  >&lt;p&gt;This was reported by Hemal Pandya in the following thread:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://markmail.org/message/3qydndh4doszjmdz&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://markmail.org/message/3qydndh4doszjmdz&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13232134" author="detinho" created="Sun, 18 Mar 2012 03:10:58 +0000"  >&lt;p&gt;Attached a patch.&lt;br/&gt;
I did a small manual benchmark here, comparing the old and new implementation, and, in fact, the new implementation is slight faster (0,1s). So keep reopening the file is not a problem.&lt;/p&gt;</comment>
                            <comment id="13232137" author="sebb@apache.org" created="Sun, 18 Mar 2012 03:22:30 +0000"  >&lt;p&gt;Thanks for the patch.&lt;/p&gt;

&lt;p&gt;In the benchmark, how big was the file that you were tailing?&lt;/p&gt;</comment>
                            <comment id="13232143" author="detinho" created="Sun, 18 Mar 2012 04:02:27 +0000"  >&lt;p&gt;The file was 9,73Mb.&lt;br/&gt;
The tailer was running with zero delay.&lt;/p&gt;</comment>
                            <comment id="13291428" author="niallp" created="Thu, 7 Jun 2012 23:45:29 +0000"  >&lt;p&gt;The original patch is now out-of-date. Attaching &lt;a href=&quot;https://issues.apache.org/jira/browse/IO-269&quot; title=&quot;Tailer locks file from deletion/rename on Windows&quot; class=&quot;issue-link&quot; data-issue-key=&quot;IO-269&quot;&gt;&lt;del&gt;IO-269&lt;/del&gt;&lt;/a&gt;-v2.patch which is up-to-date with the current code base&lt;/p&gt;</comment>
                            <comment id="13291432" author="sebb@apache.org" created="Fri, 8 Jun 2012 00:02:27 +0000"  >&lt;p&gt;File locking is only a problem on Windows, and could perhaps be addressed in a later release of the JVM.&lt;br/&gt;
Also, for some applications, it may not be necessary to allow concurrent rename/deletion.&lt;br/&gt;
So I think the re-open strategy should be an optional feature.&lt;/p&gt;</comment>
                            <comment id="13291452" author="niallp" created="Fri, 8 Jun 2012 00:30:15 +0000"  >&lt;p&gt;With NIO2 in JDK 7 I wouldn&apos;t hold out much hope for future file improvements.&lt;/p&gt;

&lt;p&gt;Also optional platform specific features really go against the ethos of Java&apos;s write once, run anywhere.&lt;/p&gt;

&lt;p&gt;Any reason why reopening is a bad idea on other non-Windoze platforms?&lt;/p&gt;</comment>
                            <comment id="13291469" author="sebb@apache.org" created="Fri, 8 Jun 2012 00:54:33 +0000"  >&lt;blockquote&gt;&lt;p&gt;Also optional platform specific features really go against the ethos of Java&apos;s write once, run anywhere.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I was not proposing making the code OS-specific.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Any reason why reopening is a bad idea on other non-Windoze platforms?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;It would be somewhat less efficient.&lt;br/&gt;
Also, AFAIK the Tailer can continue following a renamed file.&lt;/p&gt;

&lt;p&gt;If there do turn out to be issues with the new strategy - could it cause file rotations to be missed? - making it optional is safer.&lt;/p&gt;</comment>
                            <comment id="13291490" author="niallp" created="Fri, 8 Jun 2012 01:36:04 +0000"  >&lt;p&gt;Do you have any benchmark to back up the less efficient statement? Marcos indicated that it was not the case in his benchmark.&lt;/p&gt;

&lt;p&gt;Continuing to tail a file thats been renamed would be a bug (log files is a good example of that).&lt;/p&gt;

&lt;p&gt;The current implementation can miss rotations - thats a factor of the delay and how fast/frequently the file is being written to. So the question really is, is it more likely to miss rotations and I believe that goes back to the efficiency question.&lt;/p&gt;</comment>
                            <comment id="13291632" author="sebb@apache.org" created="Fri, 8 Jun 2012 08:49:21 +0000"  >&lt;blockquote&gt;&lt;p&gt;Marcos indicated that it was not the case in his benchmark.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;The readLines() method won&apos;t return until it reaches EOF, so when run against a pre-existing file there won&apos;t be any re-opens. It has to be run against a file that is growing.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Do you have any benchmark to back up the less efficient statement? &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes, it can be up to about 45% slower. &lt;br/&gt;
I used the attached benchmark (to follow), which simulates EOF by reading lines in chunks.&lt;/p&gt;</comment>
                            <comment id="13291923" author="sebb@apache.org" created="Fri, 8 Jun 2012 19:22:38 +0000"  >&lt;p&gt;Patch to optionally close input file whilst waiting.&lt;/p&gt;

&lt;p&gt;Also update test case so file deletion works on Windows&lt;/p&gt;</comment>
                            <comment id="13292613" author="garydgregory" created="Mon, 11 Jun 2012 01:10:25 +0000"  >&lt;p&gt;    Sending        C:/svn/org/apache/commons/trunks-proper/io/src/changes/changes.xml&lt;br/&gt;
    Sending        C:/svn/org/apache/commons/trunks-proper/io/src/main/java/org/apache/commons/io/input/Tailer.java&lt;br/&gt;
    Sending        C:/svn/org/apache/commons/trunks-proper/io/src/test/java/org/apache/commons/io/input/TailerTest.java&lt;br/&gt;
    Transmitting file data ...&lt;br/&gt;
    Committed revision 1348698.&lt;/p&gt;</comment>
                            <comment id="13920736" author="unlogic" created="Wed, 5 Mar 2014 11:03:02 +0000"  >&lt;p&gt;I came across this issue and noticed an inefficiency in the code of the run method.&lt;/p&gt;

&lt;p&gt;With the reOpen flag set a new RandomAccessFile is always created at the end of the main while loop in the run method:&lt;/p&gt;

&lt;p&gt;                if (getRun() &amp;amp;&amp;amp; reOpen) &lt;/p&gt;
{
                    reader = new RandomAccessFile(file, RAF_MODE);
                    reader.seek(position);
                }

&lt;p&gt;This is unnecessary and contributes to unnecessary file locking on Windows.&lt;/p&gt;

&lt;p&gt;If the reOpen flag is set a new RandomAccessFile should only be created when the length of the file or the last modification date indicate that the file needs to be read. &lt;/p&gt;</comment>
                            <comment id="13920904" author="sebb@apache.org" created="Wed, 5 Mar 2014 14:48:25 +0000"  >&lt;blockquote&gt;&lt;p&gt;This is unnecessary and contributes to unnecessary file locking on Windows.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;On the contrary, it is an essential part of unlocking the file on Windows when possible.&lt;br/&gt;
The full code is as follows:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (reOpen) {
    IOUtils.closeQuietly(reader);
}
&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.sleep(delayMillis);
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (getRun() &amp;amp;&amp;amp; reOpen) {
    reader = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; RandomAccessFile(file, RAF_MODE);
    reader.seek(position);
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Notice that the file is closed - and therefore unlocked - during the sleep if reOpen is true.&lt;br/&gt;
If reOpen is false, the file remains locked by Windows for the duration of the Tailer thread.&lt;/p&gt;</comment>
                            <comment id="13920933" author="unlogic" created="Wed, 5 Mar 2014 15:01:30 +0000"  >&lt;p&gt;Yes the file is closed when while loop sleeps, however what I&apos;m trying to point out is that the file is always opened during each iteration of the loop even when it&apos;s not necessary.&lt;/p&gt;

&lt;p&gt;There is no need to open the file unless changes to it&apos;s length or last modified date are detected.&lt;/p&gt;

&lt;p&gt;I&apos;ve created a modified version of Tailer for small desktop app called SwingTail (&lt;a href=&quot;http://unlogic.se/projects/swingtail&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://unlogic.se/projects/swingtail&lt;/a&gt;) the incorporates these changes among others. However I&apos;ve done so many other changes that I couldn&apos;t generate a clean diff. But the source is available here:&lt;/p&gt;

&lt;p&gt;svn://svn.unlogic.se/swingtail/trunk/src/se/unlogic/swingtail/Tailer.java&lt;/p&gt;

&lt;p&gt;Essentially I simply removed the open statement from the end of the loop and added three separate open statements higher up the loop that only open the file when a change is actually detected.&lt;/p&gt;</comment>
                            <comment id="13920973" author="sebb@apache.org" created="Wed, 5 Mar 2014 15:42:23 +0000"  >&lt;p&gt;I see now.&lt;/p&gt;

&lt;p&gt;In that case, I think a new JIRA issue is required.&lt;br/&gt;
The original issue was fixed so is complete.&lt;br/&gt;
Your proposal is to improve the locking behaviour, so should be filed as an enhancement please.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12531345" name="IO-269-v2.patch" size="4988" author="niallp" created="Thu, 7 Jun 2012 23:45:29 +0000"/>
                            <attachment id="12531430" name="IO-269-v3.patch" size="6447" author="sebb@apache.org" created="Fri, 8 Jun 2012 19:22:37 +0000"/>
                            <attachment id="12518817" name="IO-269.patch" size="4965" author="detinho" created="Sun, 18 Mar 2012 03:10:55 +0000"/>
                            <attachment id="12531381" name="ReOpen.java" size="2092" author="sebb@apache.org" created="Fri, 8 Jun 2012 08:50:44 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 11 Apr 2011 11:14:57 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3164</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 37 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0b0n3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>62216</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>