<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sat Nov 19 23:36:22 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/COLLECTIONS-5/COLLECTIONS-5.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[COLLECTIONS-5] [collections] Map.debug/verbosePrint Thread Safety</title>
                <link>https://issues.apache.org/jira/browse/COLLECTIONS-5</link>
                <project id="12310465" key="COLLECTIONS">Commons Collections</project>
                    <description>&lt;p&gt;This bug records a discussion on the mailing list, and provides a forum for &lt;br/&gt;
continuing that discussion.  I include below the content of the mailing on the &lt;br/&gt;
list because they raise some interesting points.  &lt;/p&gt;

&lt;p&gt;-----------------------------------------------------&lt;br/&gt;
From: &quot;Arun Thomas&quot; &amp;lt;Arun.Thomas@solidusnetworks.com&amp;gt;&lt;br/&gt;
-----------------------------------------------------&lt;/p&gt;

&lt;p&gt;I recently noticed that the current implementation of the debugPrint and &lt;br/&gt;
verbosePrint methods in MapUtils is not thread safe - in fact, these are the &lt;br/&gt;
only items that are not thread safe because the indentation state for the &lt;br/&gt;
output is preserved in a static variable. &lt;/p&gt;

&lt;p&gt;I think it would be fairly simple to make this thread safe, but it would &lt;br/&gt;
require a change to the signature of a protected member function printIndent&lt;br/&gt;
(PrintStream out) -&amp;gt; printIndent(PrintStream out, int indentDepth).  I&apos;m not &lt;br/&gt;
really clear as to why this method is protected rather than private (can &lt;br/&gt;
anyone clarify?).  Does it need to be protected? &lt;/p&gt;

&lt;p&gt;Looking forward to input from others.&lt;br/&gt;
-AMT &lt;/p&gt;

&lt;p&gt;------------------------------------------------------&lt;br/&gt;
From: Stephen Colebourne &lt;span class=&quot;error&quot;&gt;&amp;#91;scolebourne@btopenworld.com&amp;#93;&lt;/span&gt;&lt;br/&gt;
------------------------------------------------------&lt;/p&gt;

&lt;p&gt;The methods that call this one are synchronized to protect them, so it&lt;br/&gt;
should be thread-safe.&lt;/p&gt;

&lt;p&gt;However, I would prefer them not to need to be synchronized. If you want to&lt;br/&gt;
submit a patch that reworks the methods that would be great.&lt;/p&gt;

&lt;p&gt;Incompatable change?&lt;br/&gt;
The protected method should remain and be deprecated, as it may be used by a&lt;br/&gt;
MapUtils subclass (feasible but unlikely). However, I would prefer just to&lt;br/&gt;
go incompatable change on this one. Other committers may differ, but if they&lt;br/&gt;
don&apos;t I&apos;ll just commit the incompatable change.&lt;/p&gt;

&lt;p&gt;Stephen&lt;/p&gt;

&lt;p&gt;---------------------------------------&lt;br/&gt;
From: Janek Bogucki &lt;span class=&quot;error&quot;&gt;&amp;#91;yan@studylink.com&amp;#93;&lt;/span&gt;&lt;br/&gt;
---------------------------------------&lt;/p&gt;

&lt;p&gt;These methods are synchronized so are currently thread safe.&lt;/p&gt;

&lt;p&gt;    public static synchronized void verbosePrint (...)&lt;/p&gt;

&lt;p&gt;    public static synchronized void debugPrint (...)&lt;/p&gt;

&lt;p&gt;I would guess that a second intentional benefit of the synchronization&lt;br/&gt;
is to prevent overlapping invocations writing to System.out at the same&lt;br/&gt;
time.&lt;/p&gt;

&lt;p&gt;-Janek&lt;/p&gt;

&lt;p&gt;------------------------------------------------------&lt;br/&gt;
From: Stephen Colebourne &lt;span class=&quot;error&quot;&gt;&amp;#91;scolebourne@btopenworld.com&amp;#93;&lt;/span&gt;&lt;br/&gt;
------------------------------------------------------&lt;/p&gt;

&lt;p&gt;I like the System.out theory. Its probably unintentional, but it true. So&lt;br/&gt;
only a documentation patch is required then...&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;br/&gt;
Stephen&lt;/p&gt;</description>
                <environment>&lt;p&gt;Operating System: other&lt;br/&gt;
Platform: Other&lt;/p&gt;</environment>
        <key id="12340959">COLLECTIONS-5</key>
            <summary>[collections] Map.debug/verbosePrint Thread Safety</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="amamment">Arun Mammen Thomas</reporter>
                        <labels>
                    </labels>
                <created>Thu, 11 Sep 2003 10:26:43 +0000</created>
                <updated>Sat, 15 Mar 2008 21:35:57 +0000</updated>
                            <resolved>Sat, 15 Mar 2008 21:35:57 +0000</resolved>
                                                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12405038" author="amamment" created="Thu, 11 Sep 2003 10:36:29 +0000"  >&lt;p&gt;First of all, after Stephen&apos;s original comment, I created a patch and came &lt;br/&gt;
back online in order to create this bug and attach the patch.  I will do so &lt;br/&gt;
anyway, though whether or not this is the appropriate patch has yet to be &lt;br/&gt;
determined.  The patch makes use of the fact that debugPrint and verbosePrint &lt;br/&gt;
both delegate to verbosePrintInternal to pass on an extra variable &lt;br/&gt;
(indentDepth) removing the need for that state to be represented as part of &lt;br/&gt;
the class state.&lt;/p&gt;

&lt;p&gt;The old printIndent method has been deprecated, though, as you will see from &lt;br/&gt;
the comments I include in the patch, it doesn&apos;t make much sense to do so.&lt;/p&gt;

&lt;p&gt;That said, I&apos;d like to address here Janek&apos;s comment about preventing &lt;br/&gt;
overlapping invokations from writing to System.out at the same time.  I can &lt;br/&gt;
see why that would be useful, but I think forcing the synchronization on the &lt;br/&gt;
class (particularly a utility class like this) is the worst way to do it.  &lt;br/&gt;
This will prevent, as Janek notes, overlapping invokations to debugPrint and &lt;br/&gt;
verbosePrint from interfering with each other.  However....&lt;/p&gt;

&lt;p&gt;1) There is no lock on System.out.  In a multi-threaded environment, other &lt;br/&gt;
sources of output outside this class may well be writing to System.out at the &lt;br/&gt;
same time.  Such output may be interlaced with output from these two &lt;br/&gt;
synchronized methods - there is no guard against such behavior.  As a result, &lt;br/&gt;
preventing interlacing of output will most likely require an external guard &lt;br/&gt;
anyway.  &lt;/p&gt;

&lt;p&gt;2) The cost of synchronizing these two methods is that none of the otherwise &lt;br/&gt;
thread safe methods in this utility class can be used while any thread is &lt;br/&gt;
using either debugPrint or verbosePrint.  Any thread desiring to use any of &lt;br/&gt;
the other utilities will be blocked until all output is written.  &lt;/p&gt;

&lt;p&gt;IMHO, the two reasons above both suggest that the synchronized keyword should &lt;br/&gt;
be removed - any synchronization should be external - perhaps with the &lt;br/&gt;
additional class level documentation that the methods themselves are thread-&lt;br/&gt;
safe and do not require explicit synchronization.  &lt;/p&gt;</comment>
                            <comment id="12405039" author="amamment" created="Thu, 11 Sep 2003 10:37:14 +0000"  >&lt;p&gt;Created an attachment (id=8144)&lt;br/&gt;
Update to make debugPrint and verbosePrint thread safe&lt;/p&gt;</comment>
                            <comment id="12405040" author="amamment" created="Thu, 11 Sep 2003 10:38:40 +0000"  >&lt;p&gt;Note that the patch attached just previouslyt does not, in fact, remove the &lt;br/&gt;
synchronized keyword from debugPrint and verbosePrint.  I think it should be &lt;br/&gt;
removed, but I realized I had forgotten to do it.  I can submit another patch &lt;br/&gt;
with those removed if required.  &lt;/p&gt;</comment>
                            <comment id="12405041" author="janekdb@yahoo.co.uk" created="Thu, 11 Sep 2003 14:50:54 +0000"  >&lt;p&gt;I agree with Arun&apos;s removal of the synchronized key on these two methods. As &lt;br/&gt;
he correctly points out it will not, in general, prevent overlapping use of &lt;br/&gt;
System.out.&lt;/p&gt;</comment>
                            <comment id="12405042" author="scolebourne@joda.org" created="Sat, 20 Sep 2003 18:33:13 +0000"  >&lt;p&gt;Changes made so synchronization is now the responsibility of the caller if &lt;br/&gt;
required.&lt;/p&gt;

&lt;p&gt;(I should note that one thread in a synchronized method does NOT block access &lt;br/&gt;
to non synchronized methods from another thread)&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12332517" name="ASF.LICENSE.NOT.GRANTED--patch.txt" size="4195" author="amamment" created="Thu, 11 Sep 2003 10:37:14 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_10010" key="com.atlassian.jira.plugin.system.customfieldtypes:importid">
                        <customfieldname>Bugzilla Id</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>23092</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 11 Sep 2003 14:50:54 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>18993</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 11 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0sjwv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>164703</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>