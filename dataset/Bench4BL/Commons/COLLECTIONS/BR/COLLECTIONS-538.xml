<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Sun Nov 20 02:05:58 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/COLLECTIONS-538/COLLECTIONS-538.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[COLLECTIONS-538] ExtendedProperties causes AccessControlException when framework is called from a script</title>
                <link>https://issues.apache.org/jira/browse/COLLECTIONS-538</link>
                <project id="12310465" key="COLLECTIONS">Commons Collections</project>
                    <description>&lt;p&gt;We&apos;re using Velocity 1.7, which depends upon Commons Collections 3.x series&apos; ExtendedProperties class.&lt;/p&gt;

&lt;p&gt;ExtendedProperties has these constructors where it looks up the file separator using the least convenient means possible:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; ExtendedProperties() {
        &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.fileSeparator = &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.getProperty(&lt;span class=&quot;code-quote&quot;&gt;&quot;file.separator&quot;&lt;/span&gt;);
        &lt;span class=&quot;code-comment&quot;&gt;// ...
&lt;/span&gt;    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;For us, this is all being called from untrusted code, so this fails with AccessControlException.&lt;/p&gt;

&lt;p&gt;I think that instead of using the system property here, it is customary to use the File.separator constant.&lt;/p&gt;

&lt;p&gt;If you absolutely &lt;em&gt;must&lt;/em&gt; use System.getProperty() to fetch this value, it should at least be done from a doPrivileged() block.&lt;/p&gt;

&lt;p&gt;Also I had a quick check of Commons Collections 4 to see if this issue had been fixed, but couldn&apos;t immediately see what happened to this class. If it did turn out to have been fixed in v4, maybe Velocity could be encouraged to update to v4, but I haven&apos;t seen any updates from them in 4 years, so it&apos;s probably not a good sign.&lt;/p&gt;
</description>
                <environment>&lt;p&gt;Java security manager enabled&lt;/p&gt;</environment>
        <key id="12759317">COLLECTIONS-538</key>
            <summary>ExtendedProperties causes AccessControlException when framework is called from a script</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="trejkaz">Trejkaz</reporter>
                        <labels>
                    </labels>
                <created>Wed, 3 Dec 2014 23:58:01 +0000</created>
                <updated>Fri, 27 Nov 2015 21:11:12 +0000</updated>
                            <resolved>Sun, 8 Nov 2015 15:08:07 +0000</resolved>
                                    <version>3.2.1</version>
                                    <fixVersion>3.2.2</fixVersion>
                                    <component>Collection</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="14234061" author="tn" created="Thu, 4 Dec 2014 09:33:41 +0000"  >&lt;p&gt;Is it possible for you to do the relevant call to velocity within a privileged block?&lt;/p&gt;

&lt;p&gt;Currently, it is very unlikely that the 3.x branch will see a new release. The respective class (ExtendedProperties) has been removed from collections 4.0 (see the release notes for alternatives).&lt;/p&gt;</comment>
                            <comment id="14246334" author="trejkaz" created="Mon, 15 Dec 2014 05:31:25 +0000"  >&lt;p&gt;We use templates as something the user can customise. Users can therefore pass templates around to other users, and a particularly malicious user might find a way to have the template write to arbitrary files or something.&lt;/p&gt;

&lt;p&gt;Velocity may not be lowering privileges when calling methods on template objects either. I don&apos;t know either way, but I figure it&apos;s better not to trust it unless someone shows that it&apos;s doing things safely.&lt;/p&gt;

&lt;p&gt;If we called Velocity in a privileged block, we might be opening up the final link in that attack vector, so I&apos;m not exactly keen, no.&lt;/p&gt;
</comment>
                            <comment id="14249885" author="tn" created="Wed, 17 Dec 2014 14:22:16 +0000"  >&lt;p&gt;And giving the permission to read system properties to the commons-collections lib is not an option in your case?&lt;/p&gt;

&lt;p&gt;I understand it is annoying, but as I said, it is very unlikely that we will release a new 3.x lib, at least in the near future.&lt;/p&gt;</comment>
                            <comment id="14250738" author="trejkaz" created="Wed, 17 Dec 2014 22:53:10 +0000"  >&lt;p&gt;I think the situation is that the application has permission to read system properties anyway, but it&apos;s evaluating some JavaScript at some point.&lt;/p&gt;

&lt;p&gt;The script being down somewhere in the stack means that the entire stack is treated as unprivileged. I don&apos;t know if there is a way around that... I couldn&apos;t immediately see any APIs around ScriptEngine or ScriptContext which allowed me to set the privileges for the script. The script itself is running is from the same directory as the rest of our code, so it should presumably have had the same privileges as everything else, but for whatever reason, I guess script engines don&apos;t work like that.&lt;/p&gt;

&lt;p&gt;What I might do is fork the project into our local repo and make the change just for our copy.&lt;/p&gt;</comment>
                            <comment id="14259076" author="tn" created="Fri, 26 Dec 2014 13:30:31 +0000"  >&lt;p&gt;Ok, I will then mark it as to be fixed for 3.2.2 in case somebody is really willing to make a new point release for the 3.x branch.&lt;/p&gt;</comment>
                            <comment id="14995661" author="tn" created="Sun, 8 Nov 2015 15:08:07 +0000"  >&lt;p&gt;Fixed in commit r1713233.&lt;/p&gt;

&lt;p&gt;The system property is now accessed via a call to doPrivileged. If the call fails with a SecurityException, File#separator is used instead.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 4 Dec 2014 09:33:41 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 1 week, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i231d3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>