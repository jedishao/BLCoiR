<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Nov 18 21:11:57 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/MATH-780/MATH-780.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[MATH-780] BSPTree class and recovery of a Euclidean 3D BRep</title>
                <link>https://issues.apache.org/jira/browse/MATH-780</link>
                <project id="12310485" key="MATH">Commons Math</project>
                    <description>&lt;p&gt;New to the work here. Thanks for your efforts on this code.&lt;/p&gt;

&lt;p&gt;I create a BSPTree from a BoundaryRep (Brep) my test Brep is a cube as represented by a float array containing 8 3D points in(x,y,z) order and an array of indices (12 triplets for the 12 faces of the cube). I construct a BSPMesh() as shown in the code below. I can construct the PolyhedronsSet() but have problems extracting the faces from the BSPTree to reconstruct the BRep. The attached code (BSPMesh2.java) shows that a small change to 1 of the vertex positions causes/corrects the problem.&lt;/p&gt;

&lt;p&gt;Any ideas?&lt;/p&gt;</description>
                <environment>&lt;p&gt;Linux&lt;/p&gt;</environment>
        <key id="12551802">MATH-780</key>
            <summary>BSPTree class and recovery of a Euclidean 3D BRep</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="arwillis">Andrew Willis</reporter>
                        <labels>
                            <label>BSPTree</label>
                            <label>euclidean.threed</label>
                    </labels>
                <created>Fri, 20 Apr 2012 15:11:22 +0000</created>
                <updated>Mon, 4 Mar 2013 18:53:38 +0000</updated>
                            <resolved>Sun, 13 May 2012 15:56:34 +0000</resolved>
                                    <version>3.0</version>
                                    <fixVersion>3.1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="13258342" author="arwillis" created="Fri, 20 Apr 2012 16:08:58 +0000"  >&lt;p&gt;Looks like I had an index flipped resulting in an improperly oriented face for the tetrahedron. I did get the tetrahedron to work. However, I am now struggling with getting a cube to work and I have verified the normals/orientations of the planes to be correct.&lt;/p&gt;</comment>
                            <comment id="13258362" author="arwillis" created="Fri, 20 Apr 2012 16:40:42 +0000"  >&lt;p&gt;The code in BSPMesh2.java produces the following error when I run it. If you comment in the line that re-assigns the coordinate data to be cubeCoords1, then the code works fine. The only difference in the two data sets is that one coordinate has changed by a small amount.&lt;/p&gt;

&lt;p&gt;Exception in thread &quot;main&quot; java.lang.ClassCastException: org.apache.commons.math3.geometry.partitioning.BoundaryAttribute cannot be cast to java.lang.Boolean&lt;br/&gt;
	at org.apache.commons.math3.geometry.euclidean.twod_exact.PolygonsSet.computeGeometricalProperties(PolygonsSet.java:135)&lt;br/&gt;
	at org.apache.commons.math3.geometry.partitioning.AbstractRegion.getSize(AbstractRegion.java:380)&lt;br/&gt;
	at org.apache.commons.math3.geometry.euclidean.threed_exact.PolyhedronsSet$FacetsContributionVisitor.addContribution(PolyhedronsSet.java:171)&lt;br/&gt;
	at org.apache.commons.math3.geometry.euclidean.threed_exact.PolyhedronsSet$FacetsContributionVisitor.visitInternalNode(PolyhedronsSet.java:153)&lt;br/&gt;
	at org.apache.commons.math3.geometry.partitioning.BSPTree.visit(BSPTree.java:262)&lt;br/&gt;
	at org.apache.commons.math3.geometry.partitioning.BSPTree.visit(BSPTree.java:261)&lt;br/&gt;
	at org.apache.commons.math3.geometry.partitioning.BSPTree.visit(BSPTree.java:261)&lt;br/&gt;
	at org.apache.commons.math3.geometry.partitioning.BSPTree.visit(BSPTree.java:263)&lt;br/&gt;
	at org.apache.commons.math3.geometry.partitioning.BSPTree.visit(BSPTree.java:261)&lt;br/&gt;
	at org.apache.commons.math3.geometry.euclidean.threed_exact.PolyhedronsSet.computeGeometricalProperties(PolyhedronsSet.java:118)&lt;br/&gt;
	at org.apache.commons.math3.geometry.partitioning.AbstractRegion.getSize(AbstractRegion.java:380)&lt;br/&gt;
	at datastructures.j3d.bsptree.BSPMesh.&amp;lt;init&amp;gt;(BSPMesh.java:130)&lt;br/&gt;
	at datastructures.j3d.bsptree.BSPMesh2.main(BSPMesh2.java:206)&lt;/p&gt;</comment>
                            <comment id="13258440" author="luc" created="Fri, 20 Apr 2012 18:16:12 +0000"  >&lt;p&gt;Hi Andrew,&lt;/p&gt;

&lt;p&gt;The file BSPMesh2.java you attached to the issue is not sufficient to reproduce the error. It refers to a BSPMesh class and to a PolygonOfPoints class. It seems changing BSPMesh to BSPMesh2 is sufficient to solver the references in the main method (but I am not sure this class is a drop-in replacement for your issue), but I have no clue about the other class. Could you attach it to the issue too ?&lt;/p&gt;</comment>
                            <comment id="13258584" author="arwillis" created="Fri, 20 Apr 2012 20:52:42 +0000"  >&lt;p&gt;New version. Hopefully no missing references. I have removed references to the PolygonOfPoints class and fixed the constructor error. I have created a class specifically for the bug report and apologies for not making it cleaner/more clear.&lt;/p&gt;

&lt;p&gt;I&apos;m working on an exact arithmetic version of BSPTrees for CSG operations. I hope to contribute the code if it&apos;s of value to the project. Initially i&apos;ll use Java&apos;s BigDecimal classes for arbitrary arithmetic but I plan on performance enhancements per JR Shewchuk&apos;s work (orient3d() etc., &lt;a href=&quot;http://www.cs.cmu.edu/~quake/robust.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://www.cs.cmu.edu/~quake/robust.html&lt;/a&gt;).&lt;/p&gt;

&lt;p&gt;hope this code (latest version of BSPMesh2.java) helps.&lt;/p&gt;</comment>
                            <comment id="13259080" author="luc" created="Sun, 22 Apr 2012 13:10:00 +0000"  >&lt;p&gt;Thanks for the new version. I was able to reproduce the problem. However, I don&apos;t understand what you are trying to achieve here.&lt;/p&gt;

&lt;p&gt;In the double loop that creates the 2D SubLine instances, I have added some print statement to see the indices and the start and end points of the built lines. Here is the output I get:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;idxA = 0, idxB = 2, idxC = 4
   adding SubLine: {1; -1} {-1; 1}
   adding SubLine: {-1; 1} {-1; 1}
   adding SubLine: {-1; 1} {1; -1}
idxA = 2, idxB = 4, idxC = 6
   adding SubLine: {-1; 1} {-1; 1}
   adding SubLine: {-1; 1} {-1; -1}
   adding SubLine: {-1; -1} {-1; 1}
idxA = 8, idxB = 14, idxC = 12
   adding SubLine: {1; -1} {-1; 1}
   adding SubLine: {-1; 1} {1; 1}
   adding SubLine: {1; 1} {1; -1}
idxA = 14, idxB = 12, idxC = 10
   adding SubLine: {-1; 1} {1; 1}
   adding SubLine: {1; 1} {-1; -1}
   adding SubLine: {-1; -1} {-1; 1}
idxA = 0, idxB = 8, idxC = 10
   adding SubLine: {1; -1} {1; -1}
   adding SubLine: {1; -1} {-1; -1}
   adding SubLine: {-1; -1} {1; -1}
idxA = 8, idxB = 10, idxC = 2
   adding SubLine: {1; -1} {-1; -1}
   adding SubLine: {-1; -1} {-1; 1}
   adding SubLine: {-1; 1} {1; -1}
idxA = 2, idxB = 10, idxC = 12
   adding SubLine: {-1; 1} {-1; -1}
   adding SubLine: {-1; -1} {1; 1}
   adding SubLine: {1; 1} {-1; 1}
idxA = 10, idxB = 12, idxC = 4
   adding SubLine: {-1; -1} {1; 1}
   adding SubLine: {1; 1} {-1; 1}
   adding SubLine: {-1; 1} {-1; -1}
idxA = 4, idxB = 12, idxC = 14
   adding SubLine: {-1; 1} {1; 1}
   adding SubLine: {1; 1} {-1; 1}
   adding SubLine: {-1; 1} {-1; 1}
idxA = 12, idxB = 14, idxC = 6
   adding SubLine: {1; 1} {-1; 1}
   adding SubLine: {-1; 1} {-1; -1}
   adding SubLine: {-1; -1} {1; 1}
idxA = 8, idxB = 0, idxC = 6
   adding SubLine: {1; -1} {1; -1}
   adding SubLine: {1; -1} {-1; -1}
   adding SubLine: {-1; -1} {1; -1}
idxA = 0, idxB = 6, idxC = 14
   adding SubLine: {1; -1} {-1; -1}
   adding SubLine: {-1; -1} {-1; 1}
   adding SubLine: {-1; 1} {1; -1}
lines.size() = 36
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Once the 36 sublines have been created, one polygon is created from them.&lt;br/&gt;
It seems for each indices triplets, 3 lines are created representing a semi-infinite stripe. As they are all packed togeteher before building the single polygon, I guess the algorithm gets lots in all redundant boundary lines.&lt;/p&gt;

&lt;p&gt;Are you sure the inner loop should build only 3 Subline instance and not 4, and are you sure only one polygon should be built from all these lines ?&lt;/p&gt;</comment>
                            <comment id="13259154" author="arwillis" created="Sun, 22 Apr 2012 15:38:02 +0000"  >&lt;p&gt;By the output, the index values displayed are all factors of 2. This seems to indicate you are running the constructor for 2D shapes which is commented out with an if (false) {} statement in the main() function.&lt;br/&gt;
I you use the constructor:&lt;/p&gt;

&lt;p&gt;public BSPMesh2(float[] coords, int[] indices)&lt;/p&gt;

&lt;p&gt;Then your indices should be factors of 3.&lt;/p&gt;

&lt;p&gt;If you run the 2D shape constructor on the 3D points (cubeIndices, cubeCoords) strange things will occur as you mention.&lt;/p&gt;

&lt;p&gt;I&apos;ve attached yet another BSPMesh2.java with all extraneous code stripped out.&lt;/p&gt;

&lt;p&gt;The code constructs a cube from a set of triangles. Each face (having 4 vertices) is triangulated by adding an edge across the diagonal of the face, i.e., a quad face with vertex indices 0 1 2 3 becomes the following two triplets of indices &lt;/p&gt;
{0 1 2}
&lt;p&gt; &lt;/p&gt;
{2 1 3}
&lt;p&gt; as two triangles.&lt;br/&gt;
Hence each face (normally 4 SubLines has 6 subLines (one redundant across the diagonal and these redundant lines have opposing directions (subline 1 2 and subline 2 1)). I am working towards converting generic triangular meshes to BSPTrees (and back to meshes). This is a standard for triangular mesh representations.&lt;/p&gt;

&lt;p&gt;I hope this helps clarify.&lt;/p&gt;</comment>
                            <comment id="13259171" author="arwillis" created="Sun, 22 Apr 2012 16:37:56 +0000"  >&lt;p&gt;Sorry, the indices should be &lt;/p&gt;
{0 1 2}
&lt;p&gt; &lt;/p&gt;
{1 2 3}
&lt;p&gt; above and the subline &lt;/p&gt;
{1 2}
&lt;p&gt; will be redundant. I checked the orientation of the planes for the indices above and one of the two triangles is flipped orientation (incorrectly specified indices).&lt;/p&gt;</comment>
                            <comment id="13259410" author="luc" created="Mon, 23 Apr 2012 06:24:59 +0000"  >&lt;p&gt;Hi Andrew,&lt;/p&gt;

&lt;p&gt;Thanks for the explanation, now I understand your code. It would be a nice enhancement to have this in Apache Commons Math!&lt;/p&gt;

&lt;p&gt;I think there are still some indices issues. As far as I understand, for each facet of the cube, the current indices do not define two triangles sharing one diagonal, but rather two triangles with the crossing diagonals (i.e. they overlap on some part of the fact, and a quarter of the facet is missing. If I replace the indices array from:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;{0, 1, 2, 1, 2, 3,
 4, 7, 6, 7, 6, 5,
 0, 4, 5, 4, 5, 1,
 1, 5, 6, 5, 6, 2,
 2, 6, 7, 6, 7, 3,
 4, 0, 3, 0, 3, 7}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;to&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;{0, 1, 2, 2, 3, 0,
 4, 7, 6, 6, 5, 4,
 0, 4, 5, 5, 1, 0,
 1, 5, 6, 6, 2, 1,
 2, 6, 7, 7, 3, 2,
 4, 0, 3, 3, 7, 4}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;it seems to work (I had no time for thorough testing though). Note the pattern of the change on the last three columns.&lt;/p&gt;

&lt;p&gt;Could you tell me if this work for you ang give expected results ?&lt;/p&gt;</comment>
                            <comment id="13260152" author="arwillis" created="Tue, 24 Apr 2012 02:14:06 +0000"  >&lt;p&gt;The indices you have above work. Thanks. &lt;br/&gt;
Try these&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;            float[] coordVals = {
1.000000f, -1.000000f, -1.000000f, 
1.000000f, -1.000000f, 1.000000f, 
-1.000000f, -1.000000f, 1.000000f, 
-1.000000f, -1.000000f, -1.000000f, 
1.000000f, 1.000000f, -1f, 
0.999999f, 1.000000f, 1.000000f, 
-1.000000f, 1.000000f, 1.000000f, 
-1.000000f, 1.000000f, -1.000000f};
int[] coordIdxs = {
0, 1, 2, 0, 2, 3, 
4, 7, 6, 4, 6, 5, 
0, 4, 5, 0, 5, 1, 
1, 5, 6, 1, 6, 2, 
2, 6, 7, 2, 7, 3, 
4, 0, 3, 4, 3, 7};
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Then change the coord 0.999999f to 1.0f as follows:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;float[] coordVals = {
1.000000f, -1.000000f, -1.000000f, 
1.000000f, -1.000000f, 1.000000f, 
-1.000000f, -1.000000f, 1.000000f, 
-1.000000f, -1.000000f, -1.000000f, 
1.000000f, 1.000000f, -1.000000f, 
1.000000f, 1.000000f, 1.000000f, 
-1.000000f, 1.000000f, 1.000000f, 
-1.000000f, 1.000000f, -1.000000f};
coordIdxs = {
0, 1, 2, 0, 2, 3, 
4, 7, 6, 4, 6, 5, 
0, 4, 5, 0, 5, 1, 
1, 5, 6, 1, 6, 2, 
2, 6, 7, 2, 7, 3, 
4, 0, 3, 4, 3, 7};
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I get an error on the first set of coordinates but not on the second. The indices are the same. This is the original data which gave rise to the bug report.&lt;/p&gt;

&lt;p&gt;Let me know what you find.&lt;br/&gt;
thanks,&lt;br/&gt;
andrew&lt;/p&gt;</comment>
                            <comment id="13264594" author="luc" created="Sun, 29 Apr 2012 20:09:23 +0000"  >&lt;p&gt;I have made some progress analyzing this issue.&lt;br/&gt;
First, I confirm there is a problem in the code.&lt;br/&gt;
It appears that during the build, a very thin triangle occurs on a facet. In the facet plane, the coordinates of the three vertices of this triangle are (0.9999999997583233 -0.999998986721039), (-1.0000000000000002 -0.9999989867210387) and (-1.0000000000000002 -1.0). While extracting the vertices of this triangle, the public getVertices method in PolygonsSet first build the segments and then calls the private followLoop method to identify their topology (i.e. how they connect to each other). The segments are properly built and identified, but the followLoop method fails to connect them. It hits a dedicated conditional statement considering the loop is below some predefined threshold (despite it really is above this threshold) and it ignores the triangle completely. Later, this breaks things as a node in the tree without a boundary must be a leaf node which must contain a boolean attribute. However, here we are not a a leaf node, we are at an internal node with an ignored boundary.&lt;/p&gt;

&lt;p&gt;So I think there are two bugs here. One bug for not identifying correctly the triangle, and one bug for misclassifying an internal node as a leaf node.&lt;/p&gt;

&lt;p&gt;The triangle identification bug will probably take some time to fix. The internal/leaf node bug will probably be easy to fix.&lt;/p&gt;

&lt;p&gt;I&apos;ll look into that, hopefully in the next few days.&lt;/p&gt;</comment>
                            <comment id="13267481" author="arwillis" created="Thu, 3 May 2012 14:53:04 +0000"  >&lt;p&gt;Thanks for your input. I am still very much interested in resolving this. I&apos;ll keep an eye out for your reply.&lt;/p&gt;</comment>
                            <comment id="13274285" author="luc" created="Sun, 13 May 2012 15:56:34 +0000"  >&lt;p&gt;Fixed in subversion repository as of r1337929.&lt;/p&gt;

&lt;p&gt;The fix is an ugly one. I have only prevented the wrong cast since boolean attributes occur only at leaf nodes in the tree (internal nodes have different attributes, related to the boundary).&lt;/p&gt;

&lt;p&gt;The roots of the problem are much deeper than that, and need more thoughts.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12523688" name="BSPMesh2.java" size="5281" author="arwillis" created="Sun, 22 Apr 2012 15:44:35 +0000"/>
                            <attachment id="12523685" name="BSPMesh2.java" size="5281" author="arwillis" created="Sun, 22 Apr 2012 15:38:49 +0000"/>
                            <attachment id="12523563" name="BSPMesh2.java" size="7606" author="arwillis" created="Fri, 20 Apr 2012 20:55:18 +0000"/>
                            <attachment id="12523561" name="BSPMesh2.java" size="9076" author="arwillis" created="Fri, 20 Apr 2012 20:52:42 +0000"/>
                            <attachment id="12523518" name="BSPMesh2.java" size="9143" author="arwillis" created="Fri, 20 Apr 2012 16:40:41 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 20 Apr 2012 18:16:12 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>236609</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 27 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0rt93:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>160383</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>