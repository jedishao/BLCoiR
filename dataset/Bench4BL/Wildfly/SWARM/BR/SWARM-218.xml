<!-- 
RSS generated by JIRA (7.2.3#72005-sha1:73be91d2b96fc29303a7eb6820acf420e5d0ed65) at Tue Dec 06 18:34:40 EST 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.jboss.org/si/jira.issueviews:issue-xml/SWARM-218/SWARM-218.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>JBoss Issue Tracker</title>
    <link>https://issues.jboss.org</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-us</language>    <build-info>
        <version>7.2.3</version>
        <build-number>72005</build-number>
        <build-date>06-10-2016</build-date>
    </build-info>

<item>
            <title>[SWARM-218] DuplicateServiceException: Service jboss.persistenceunit at Arquillian Test when using deployment.addAllDependencies()</title>
                <link>https://issues.jboss.org/browse/SWARM-218</link>
                <project id="12317020" key="SWARM">WildFly Swarm</project>
                    <description>&lt;p&gt;&lt;b&gt;DuplicateServiceException: Service jboss.persistenceunit&lt;/b&gt; is thrown at Arquillian Test when using deployment.addAllDependencies().&lt;/p&gt;

&lt;p&gt;I attached the log.&lt;br/&gt;
The sample project is &lt;a href=&quot;https://github.com/emag/wildfly-swarm-quickstarts/tree/jpa-duplicate-service-exception-with-arq/jpa-duplicate-service-exception-with-arq&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;it&apos;s very exception name, it seems the persistence unit is registered twice.&lt;/p&gt;

&lt;p/&gt;
&lt;div id=&quot;syntaxplugin&quot; class=&quot;syntaxplugin&quot; style=&quot;border: 1px dashed #bbb; border-radius: 5px !important; overflow: auto; max-height: 30em;&quot;&gt;
&lt;table cellspacing=&quot;0&quot; cellpadding=&quot;0&quot; border=&quot;0&quot; width=&quot;100%&quot; style=&quot;font-size: 1em; line-height: 1.4em !important; font-weight: normal; font-style: normal; color: black;&quot;&gt;
		&lt;tbody &gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;  margin-top: 10px;   width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;2015-12-22 23:35:55,976 INFO  [org.jboss.as.jpa] (MSC service thread 1-5) WFLYJPA0002: Read persistence.xml for primary&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   margin-bottom: 10px;  width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;2015-12-22 23:35:55,979 INFO  [org.jboss.as.jpa] (MSC service thread 1-5) WFLYJPA0002: Read persistence.xml for primary&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
			&lt;/tbody&gt;
&lt;/table&gt;
&lt;/div&gt;
&lt;p/&gt;

&lt;p&gt;how to reproduce:&lt;/p&gt;

&lt;p/&gt;
&lt;div id=&quot;syntaxplugin&quot; class=&quot;syntaxplugin&quot; style=&quot;border: 1px dashed #bbb; border-radius: 5px !important; overflow: auto; max-height: 30em;&quot;&gt;
&lt;table cellspacing=&quot;0&quot; cellpadding=&quot;0&quot; border=&quot;0&quot; width=&quot;100%&quot; style=&quot;font-size: 1em; line-height: 1.4em !important; font-weight: normal; font-style: normal; color: black;&quot;&gt;
		&lt;tbody &gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;  margin-top: 10px;   width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;git clone https://github.com/emag/wildfly-swarm-quickstarts.git \&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;    &amp;amp;&amp;amp; cd wildfly-swarm-quickstarts \&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;    &amp;amp;&amp;amp; git checkout -b jpa-duplicate-service-exception-with-arq origin/jpa-duplicate-service-exception-with-arq \&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   margin-bottom: 10px;  width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;    &amp;amp;&amp;amp; mvn clean verify -pl jpa-duplicate-service-exception-with-arq&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
			&lt;/tbody&gt;
&lt;/table&gt;
&lt;/div&gt;
&lt;p/&gt;</description>
                <environment>&lt;p&gt;1.0.0.Alpha6-SNAPSHOT &lt;a href=&quot;https://github.com/wildfly-swarm/wildfly-swarm/commit/8acc52c9d1f76688ab4b9ac04dda591ecb934ad6&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;8acc5&lt;/a&gt;&lt;/p&gt;</environment>
        <key id="12597710">SWARM-218</key>
            <summary>DuplicateServiceException: Service jboss.persistenceunit at Arquillian Test when using deployment.addAllDependencies()</summary>
                <type id="1" iconUrl="https://issues.jboss.org/secure/viewavatar?size=xsmall&amp;avatarId=13263&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.jboss.org/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.jboss.org/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Done</resolution>
                                        <assignee username="tcrawley">Toby Crawley</assignee>
                                    <reporter username="emag">Yoshimasa Tanabe</reporter>
                        <labels>
                    </labels>
                <created>Tue, 22 Dec 2015 09:46:28 -0500</created>
                <updated>Mon, 22 Feb 2016 13:12:11 -0500</updated>
                            <resolved>Fri, 29 Jan 2016 17:32:36 -0500</resolved>
                                                    <fixVersion>1.0.0.Alpha8</fixVersion>
                                    <component>core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="13147209" author="tcrawley" created="Mon, 11 Jan 2016 17:21:08 -0500"  >&lt;p&gt;I&apos;ve figured out what is happening here: &lt;tt&gt;addAllDependencies&lt;/tt&gt; adds the application jar to the archive, and you are adding &lt;tt&gt;persistence.xml&lt;/tt&gt; directly, which results in two of them on the classpath, causing the error.&lt;/p&gt;

&lt;p&gt;With the following changes, I was able to get the test to pass: &lt;a href=&quot;https://gist.github.com/6b4af6aad7c3afa10815&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://gist.github.com/6b4af6aad7c3afa10815&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I adjusted for the new artifact names and commented out adding the &lt;tt&gt;persistence.xml&lt;/tt&gt; directly. I also changed the signature of the &lt;tt&gt;createDeployment&lt;/tt&gt; methods, since returning a &lt;tt&gt;JAXRSArchive&lt;/tt&gt; requires that class to be available at the time the test is instantiated on the server-side, which requires adding it to the archive (along with all parent classes/interfaces), and it really isn&apos;t necessary.&lt;/p&gt;

&lt;p&gt;I&apos;ll resolve this issue, but feel free to reopen if you aren&apos;t satisfied with this resolution.&lt;/p&gt;</comment>
                            <comment id="13147446" author="emag" created="Tue, 12 Jan 2016 07:08:31 -0500"  >&lt;p&gt;Thank you for your checking. I got it.&lt;/p&gt;

&lt;p&gt;I have another question about it.&lt;/p&gt;

&lt;p&gt;Though MyDeployment class aims to share the deployment code with production and arquillian tests, apparently I should not do it.&lt;/p&gt;

&lt;p&gt;Should I setup the deployment code for production and arquillian ?&lt;/p&gt;

</comment>
                            <comment id="13147533" author="tcrawley" created="Tue, 12 Jan 2016 08:48:49 -0500"  >&lt;p&gt;I think you should be able to share the deployment code between production and tests. If you can&apos;t we need to fix it so you can. &lt;/p&gt;

&lt;p&gt;I took another look at your project, and was able to change &lt;tt&gt;MyDeployment.createDeployment&lt;/tt&gt; back to returning a &lt;tt&gt;JAXRSArchive&lt;/tt&gt; without breaking the tests. So it&apos;s just the &lt;tt&gt;createDeployment&lt;/tt&gt; method on the test that needs to return &lt;tt&gt;Archive&lt;/tt&gt;, if that helps.&lt;/p&gt;</comment>
                            <comment id="13147989" author="emag" created="Wed, 13 Jan 2016 05:40:59 -0500"  >&lt;p&gt;You mean, what I need is just to return  &lt;b&gt;Archive&lt;/b&gt; on &lt;b&gt;ArqIT#createDeployment()&lt;/b&gt; for sharing &lt;b&gt;MyDeployment#createDeployment()&lt;/b&gt; which returns &lt;b&gt;JAXRSArchive&lt;/b&gt; ?&lt;br/&gt;
I changed it, but the same result(DuplicateServiceException).&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/emag/wildfly-swarm-quickstarts/blob/jpa-duplicate-service-exception-with-arq-2/jpa-duplicate-service-exception-with-arq/src/test/java/wildflyswarm/jpa_duplicate_service_exception_with_arq/ArqIT.java&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/emag/wildfly-swarm-quickstarts/blob/jpa-duplicate-service-exception-with-arq-2/jpa-duplicate-service-exception-with-arq/src/test/java/wildflyswarm/jpa_duplicate_service_exception_with_arq/ArqIT.java&lt;/a&gt;&lt;/p&gt;

&lt;p/&gt;
&lt;div id=&quot;syntaxplugin&quot; class=&quot;syntaxplugin&quot; style=&quot;border: 1px dashed #bbb; border-radius: 5px !important; overflow: auto; max-height: 30em;&quot;&gt;
&lt;table cellspacing=&quot;0&quot; cellpadding=&quot;0&quot; border=&quot;0&quot; width=&quot;100%&quot; style=&quot;font-size: 1em; line-height: 1.4em !important; font-weight: normal; font-style: normal; color: black;&quot;&gt;
		&lt;tbody &gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;  margin-top: 10px;   width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;git clone https://github.com/emag/wildfly-swarm-quickstarts.git \&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;    &amp;amp;&amp;amp; cd wildfly-swarm-quickstarts \&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;    &amp;amp;&amp;amp; git checkout -b jpa-duplicate-service-exception-with-arq-2 origin/jpa-duplicate-service-exception-with-arq-2 \&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   margin-bottom: 10px;  width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;    &amp;amp;&amp;amp; mvn clean verify -pl jpa-duplicate-service-exception-with-arq&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
			&lt;/tbody&gt;
&lt;/table&gt;
&lt;/div&gt;
&lt;p/&gt;</comment>
                            <comment id="13148246" author="tcrawley" created="Wed, 13 Jan 2016 11:28:39 -0500"  >&lt;p&gt;The DuplicateServiceException is unrelated to returning JAXRSArchive - it is caused by having:&lt;/p&gt;

&lt;p/&gt;
&lt;div id=&quot;syntaxplugin&quot; class=&quot;syntaxplugin&quot; style=&quot;border: 1px dashed #bbb; border-radius: 5px !important; overflow: auto; max-height: 30em;&quot;&gt;
&lt;table cellspacing=&quot;0&quot; cellpadding=&quot;0&quot; border=&quot;0&quot; width=&quot;100%&quot; style=&quot;font-size: 1em; line-height: 1.4em !important; font-weight: normal; font-style: normal; color: black;&quot;&gt;
		&lt;tbody &gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;  margin-top: 10px;   width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;deployment.addAsWebInfResource(&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;      new ClassLoaderAsset(&quot;META-INF/persistence.xml&quot;, App.class.getClassLoader()), &quot;classes/META-INF/persistence.xml&quot;);&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   width: auto; padding: 0;&quot;&gt;&amp;nbsp;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   margin-bottom: 10px;  width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;    deployment.addAllDependencies();&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
			&lt;/tbody&gt;
&lt;/table&gt;
&lt;/div&gt;
&lt;p/&gt;

&lt;p&gt;Both of these lines cause a &lt;tt&gt;persistence.xml&lt;/tt&gt; to be added to the jar, which results in a duplicate service. If you are calling &lt;tt&gt;addAllDependencies&lt;/tt&gt;, you can remove the &lt;tt&gt;addAsWebInfResource&lt;/tt&gt; line.&lt;/p&gt;</comment>
                            <comment id="13148819" author="emag" created="Thu, 14 Jan 2016 09:52:55 -0500"  >&lt;p&gt;Ok, ArqIT works fine by removing addAsWebInfResource, but it seems that the Archive doesn&apos;t contain persistence.xml...&lt;/p&gt;

&lt;p&gt;I added printing `deployment.toString(true)`.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/emag/wildfly-swarm-quickstarts/blob/jpa-duplicate-service-exception-with-arq-3/jpa-duplicate-service-exception-with-arq/src/main/java/wildflyswarm/jpa_duplicate_service_exception_with_arq/MyDeployment.java#L22-L24&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/emag/wildfly-swarm-quickstarts/blob/jpa-duplicate-service-exception-with-arq-3/jpa-duplicate-service-exception-with-arq/src/main/java/wildflyswarm/jpa_duplicate_service_exception_with_arq/MyDeployment.java#L22-L24&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;logs:&lt;br/&gt;
&lt;a href=&quot;https://gist.github.com/emag/7f1aad1a177945303e5c&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://gist.github.com/emag/7f1aad1a177945303e5c&lt;/a&gt;&lt;/p&gt;

&lt;p/&gt;
&lt;div id=&quot;syntaxplugin&quot; class=&quot;syntaxplugin&quot; style=&quot;border: 1px dashed #bbb; border-radius: 5px !important; overflow: auto; max-height: 30em;&quot;&gt;
&lt;table cellspacing=&quot;0&quot; cellpadding=&quot;0&quot; border=&quot;0&quot; width=&quot;100%&quot; style=&quot;font-size: 1em; line-height: 1.4em !important; font-weight: normal; font-style: normal; color: black;&quot;&gt;
		&lt;tbody &gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;  margin-top: 10px;   width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;git clone https://github.com/emag/wildfly-swarm-quickstarts.git \&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;    &amp;amp;&amp;amp; cd wildfly-swarm-quickstarts \&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;    &amp;amp;&amp;amp; git checkout -b jpa-duplicate-service-exception-with-arq-3 origin/jpa-duplicate-service-exception-with-arq-3 \&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;    &amp;amp;&amp;amp; mvn clean package -pl jpa-duplicate-service-exception-with-arq \&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   margin-bottom: 10px;  width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;    &amp;amp;&amp;amp; java -jar jpa-duplicate-service-exception-with-arq/target/jpa-duplicate-service-exception-with-arq-swarm.jar&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
			&lt;/tbody&gt;
&lt;/table&gt;
&lt;/div&gt;
&lt;p/&gt;</comment>
                            <comment id="13150202" author="tcrawley" created="Mon, 18 Jan 2016 13:50:09 -0500"  >&lt;p&gt;Hmm, it looks like &lt;tt&gt;addAllDependencies&lt;/tt&gt; behaves differently in the IT vs. runtime cases, probably because it is called at different times in the lifecycle in each case. &lt;/p&gt;

&lt;p&gt;I think the proper thing to do here is to leave the &lt;tt&gt;addAsWebInfResource&lt;/tt&gt; call, but &lt;em&gt;remove&lt;/em&gt; the &lt;tt&gt;addAllDependencies&lt;/tt&gt; call. I tried that with swarm &lt;tt&gt;1.0.0-alpha6&lt;/tt&gt;, and tests pass, and the swarjar works. I suspect whatever issues that required you to call &lt;tt&gt;addAllDependencies&lt;/tt&gt; have been resolved since this issue was originally opened - there have been some changes around how we handle dependencies.&lt;/p&gt;

&lt;p&gt;Sorry for the confusion - let me know if that makes sense and works for you.&lt;/p&gt;</comment>
                            <comment id="13150664" author="emag" created="Tue, 19 Jan 2016 09:51:01 -0500"  >&lt;p&gt;Hmm, What should I do when I want to add some libraries? In my understanding, `addAllDependencies` is used for ease in adding third-party libraries.&lt;/p&gt;

&lt;p&gt;For instance, now my example have added `joda-time`, and, ClassNotFoundException will occur if I remove `addAllDepencencies`. So I think `addAllDependencies` and `addWebInfResource` should be compatible.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/emag/wildfly-swarm-quickstarts/tree/jpa-duplicate-service-exception-with-arq-4/jpa-duplicate-service-exception-with-arq&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/emag/wildfly-swarm-quickstarts/tree/jpa-duplicate-service-exception-with-arq-4/jpa-duplicate-service-exception-with-arq&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I tested Alpha7-SNAPSHOT &lt;a href=&quot;https://github.com/wildfly-swarm/wildfly-swarm/commit/14bd2cab3e35f0c10b97ae8d7249653026589753&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;HEAD 14bd2&lt;/a&gt; .&lt;/p&gt;

&lt;p/&gt;
&lt;div id=&quot;syntaxplugin&quot; class=&quot;syntaxplugin&quot; style=&quot;border: 1px dashed #bbb; border-radius: 5px !important; overflow: auto; max-height: 30em;&quot;&gt;
&lt;table cellspacing=&quot;0&quot; cellpadding=&quot;0&quot; border=&quot;0&quot; width=&quot;100%&quot; style=&quot;font-size: 1em; line-height: 1.4em !important; font-weight: normal; font-style: normal; color: black;&quot;&gt;
		&lt;tbody &gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;  margin-top: 10px;   width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;$ git clone https://github.com/emag/wildfly-swarm-quickstarts.git \&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;    &amp;amp;&amp;amp; cd wildfly-swarm-quickstarts \&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;    &amp;amp;&amp;amp; git checkout -b jpa-duplicate-service-exception-with-arq-4 origin/jpa-duplicate-service-exception-with-arq-4 \&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;    &amp;amp;&amp;amp; mvn clean package -pl jpa-duplicate-service-exception-with-arq \&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   margin-bottom: 10px;  width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;    &amp;amp;&amp;amp; java -jar jpa-duplicate-service-exception-with-arq/target/jpa-duplicate-service-exception-with-arq-swarm.jar&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
			&lt;/tbody&gt;
&lt;/table&gt;
&lt;/div&gt;
&lt;p/&gt;

&lt;p/&gt;
&lt;div id=&quot;syntaxplugin&quot; class=&quot;syntaxplugin&quot; style=&quot;border: 1px dashed #bbb; border-radius: 5px !important; overflow: auto; max-height: 30em;&quot;&gt;
&lt;table cellspacing=&quot;0&quot; cellpadding=&quot;0&quot; border=&quot;0&quot; width=&quot;100%&quot; style=&quot;font-size: 1em; line-height: 1.4em !important; font-weight: normal; font-style: normal; color: black;&quot;&gt;
		&lt;tbody &gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;  margin-top: 10px;   margin-bottom: 10px;  width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;$ curl http://localhost:8080&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
			&lt;/tbody&gt;
&lt;/table&gt;
&lt;/div&gt;
&lt;p/&gt;</comment>
                            <comment id="13151400" author="tcrawley" created="Wed, 20 Jan 2016 15:33:04 -0500"  >&lt;p&gt;You are absolutely correct - reopening. &lt;/p&gt;</comment>
                            <comment id="13156736" author="tcrawley" created="Fri, 29 Jan 2016 17:32:36 -0500"  >&lt;p&gt;Arq tests will no longer include the default artifact within the deployment it builds, which matches the behavior of the package and run tasks.&lt;/p&gt;</comment>
                            <comment id="13156750" author="emag" created="Sat, 30 Jan 2016 02:39:00 -0500"  >&lt;p&gt;Thank you for your commit! Now Arq tests can avoid DuplicateServiceException with using allDependencies and addAsWebInfResource.&lt;/p&gt;

&lt;p&gt;However, I got stuck at another problem.&lt;/p&gt;

&lt;p&gt;I added resteasy-client dependency  with test scope in pom.xml because my ArqIT run as client(if not, ClassNotFoundException: org.glassfish.jersey.client.JerseyClientBuilder will be thrown).&lt;/p&gt;

&lt;p&gt;And I got an exception, &lt;blockquote&gt;&lt;p&gt;RuntimeException: RESTEASY003190: Could not find constructor for class: org.jboss.resteasy.core.AsynchronousDispatcher&lt;/p&gt;&lt;/blockquote&gt;.&lt;/p&gt;

&lt;p&gt;full log is here. &lt;a href=&quot;https://gist.github.com/emag/b395bfd9b63603bb2cf7&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://gist.github.com/emag/b395bfd9b63603bb2cf7&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Anyway, for now originally issue(DuplicationServiceException) is fixed, should I open another issue?&lt;/p&gt;

&lt;p&gt;how to reproduce:&lt;/p&gt;

&lt;p/&gt;
&lt;div id=&quot;syntaxplugin&quot; class=&quot;syntaxplugin&quot; style=&quot;border: 1px dashed #bbb; border-radius: 5px !important; overflow: auto; max-height: 30em;&quot;&gt;
&lt;table cellspacing=&quot;0&quot; cellpadding=&quot;0&quot; border=&quot;0&quot; width=&quot;100%&quot; style=&quot;font-size: 1em; line-height: 1.4em !important; font-weight: normal; font-style: normal; color: black;&quot;&gt;
		&lt;tbody &gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;  margin-top: 10px;   width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt; git clone https://github.com/emag/wildfly-swarm-quickstarts.git \&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;    &amp;amp;&amp;amp; cd wildfly-swarm-quickstarts \&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;    &amp;amp;&amp;amp; git checkout -b jpa-duplicate-service-exception-with-arq-5 origin/jpa-duplicate-service-exception-with-arq-5 \&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   margin-bottom: 10px;  width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;    &amp;amp;&amp;amp; mvn clean verify -pl jpa-duplicate-service-exception-with-arq&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
			&lt;/tbody&gt;
&lt;/table&gt;
&lt;/div&gt;
&lt;p/&gt;</comment>
                            <comment id="13156785" author="tcrawley" created="Sun, 31 Jan 2016 10:16:13 -0500"  >&lt;p&gt;Yes, that&apos;s a different issue - can you please open a new jira for it?&lt;/p&gt;</comment>
                            <comment id="13157699" author="emag" created="Tue, 2 Feb 2016 09:17:31 -0500"  >&lt;p&gt;sure, and done. &lt;a href=&quot;https://issues.jboss.org/browse/SWARM-291&quot; title=&quot;Arq tests throws RuntimeException: RESTEASY003190 with resteasy-client&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SWARM-291&quot;&gt;&lt;del&gt;SWARM-291&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12396274" name="jpa-duplicate-service-exception-with-arq.log" size="8871" author="emag" created="Tue, 22 Dec 2015 09:41:50 -0500"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310641" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Number of attachments</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310640" key="com.atlassian.jira.toolkit:comments">
                        <customfieldname>Number of comments</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>13.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311940" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1|i00gtr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310840" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>