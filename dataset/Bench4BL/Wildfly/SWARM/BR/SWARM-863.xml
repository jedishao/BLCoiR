<!-- 
RSS generated by JIRA (7.2.3#72005-sha1:73be91d2b96fc29303a7eb6820acf420e5d0ed65) at Mon Dec 12 22:09:00 EST 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.jboss.org/si/jira.issueviews:issue-xml/SWARM-863/SWARM-863.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>JBoss Issue Tracker</title>
    <link>https://issues.jboss.org</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-us</language>    <build-info>
        <version>7.2.3</version>
        <build-number>72005</build-number>
        <build-date>06-10-2016</build-date>
    </build-info>

<item>
            <title>[SWARM-863] Version 2016.11.0 doesn&apos;t stop properly (with custom main class)</title>
                <link>https://issues.jboss.org/browse/SWARM-863</link>
                <project id="12317020" key="SWARM">WildFly Swarm</project>
                    <description>&lt;p&gt;We are using a custom main class whose main method reacts on a single argument: &quot;start&quot; or &quot;stop&quot;. Actually we are feeding that argument through Procrun (&lt;a href=&quot;https://commons.apache.org/proper/commons-daemon/procrun.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://commons.apache.org/proper/commons-daemon/procrun.html&lt;/a&gt;). Inside that main class we hold a field&lt;/p&gt;

&lt;p/&gt;
&lt;div id=&quot;syntaxplugin&quot; class=&quot;syntaxplugin&quot; style=&quot;border: 1px dashed #bbb; border-radius: 5px !important; overflow: auto; max-height: 30em;&quot;&gt;
&lt;table cellspacing=&quot;0&quot; cellpadding=&quot;0&quot; border=&quot;0&quot; width=&quot;100%&quot; style=&quot;font-size: 1em; line-height: 1.4em !important; font-weight: normal; font-style: normal; color: black;&quot;&gt;
		&lt;tbody &gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;  margin-top: 10px;   margin-bottom: 10px;  width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;    private static org.wildfly.swarm.Swarm container&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
			&lt;/tbody&gt;
&lt;/table&gt;
&lt;/div&gt;
&lt;p/&gt;

&lt;p&gt;which we handle as following during startup:&lt;/p&gt;

&lt;p/&gt;
&lt;div id=&quot;syntaxplugin&quot; class=&quot;syntaxplugin&quot; style=&quot;border: 1px dashed #bbb; border-radius: 5px !important; overflow: auto; max-height: 30em;&quot;&gt;
&lt;table cellspacing=&quot;0&quot; cellpadding=&quot;0&quot; border=&quot;0&quot; width=&quot;100%&quot; style=&quot;font-size: 1em; line-height: 1.4em !important; font-weight: normal; font-style: normal; color: black;&quot;&gt;
		&lt;tbody &gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;  margin-top: 10px;   width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;    container = new Swarm(); // fractions being added here also&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;    container.start();&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   margin-bottom: 10px;  width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;    container.deploy(...);&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
			&lt;/tbody&gt;
&lt;/table&gt;
&lt;/div&gt;
&lt;p/&gt;

&lt;p&gt;The reaction on the &quot;stop&quot; signal is as easy as following:&lt;/p&gt;

&lt;p/&gt;
&lt;div id=&quot;syntaxplugin&quot; class=&quot;syntaxplugin&quot; style=&quot;border: 1px dashed #bbb; border-radius: 5px !important; overflow: auto; max-height: 30em;&quot;&gt;
&lt;table cellspacing=&quot;0&quot; cellpadding=&quot;0&quot; border=&quot;0&quot; width=&quot;100%&quot; style=&quot;font-size: 1em; line-height: 1.4em !important; font-weight: normal; font-style: normal; color: black;&quot;&gt;
		&lt;tbody &gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;  margin-top: 10px;   margin-bottom: 10px;  width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;    container.stop();&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
			&lt;/tbody&gt;
&lt;/table&gt;
&lt;/div&gt;
&lt;p/&gt;

&lt;p&gt;We now have the problem that stopping such a Swarm service in version 2016.11.0 does not properly shutdown the Swarm container (or better the underlying `Server`). I did a debug session and found out that there remains one non-daemon thread blocking the JVM shutdown. With version 2016.10.0 everything works fine. The shutdown is clean and fast.&lt;/p&gt;

&lt;p&gt;An example project can be found at &lt;a href=&quot;https://github.com/seelenvirtuose/de.mwa.testing.wfs&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/seelenvirtuose/de.mwa.testing.wfs&lt;/a&gt;. But I also have attached it as a zip.  &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.jboss.org/secure/attachment/12413564/12413564_de.mwa.testing.wfs-master.zip&quot; title=&quot;de.mwa.testing.wfs-master.zip attached to SWARM-863&quot;&gt;de.mwa.testing.wfs-master.zip&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.jboss.org/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt; &lt;br/&gt;
Procrun can be downloaded at &lt;a href=&quot;http://mirror.serversupportforum.de/apache//commons/daemon/binaries/windows/commons-daemon-1.0.15-bin-windows.zip&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://mirror.serversupportforum.de/apache//commons/daemon/binaries/windows/commons-daemon-1.0.15-bin-windows.zip&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Steps to reproduce:&lt;/p&gt;

&lt;p&gt;1) Clone the github project and start a &quot;mvn package&quot; to produce the uber-jar, which is located in the &quot;swarm&quot; sub-module of that project.&lt;br/&gt;
2) Copy that uber-jar and both procrun executables (&quot;prunsrv.exe&quot; and &quot;prunmgr.exe&quot;) into a test directory. For 64-bit OS&apos;s use the file &quot;amd64/prunsrv.exe&quot; (inside that procrun zip file). Rename the file &quot;prunsrv.exe&quot; to &quot;testing-wfs.exe&quot; and the file &quot;prunmgr.exe&quot; to &quot;testing-wfsw.exe&quot;.&lt;br/&gt;
3) Install a Windows service by running the command &quot;testing-wfs.exe //IS&quot;. Now this service can be configured by running the &quot;testing-wfsw.exe&quot; (a Windows GUI Tool for that purpose).&lt;/p&gt;

&lt;p&gt;4) Configure the service as following:&lt;/p&gt;

&lt;p&gt;Tab Logging&lt;br/&gt;
Log path: &amp;lt;path-to-the-service-directory&amp;gt;\logs&lt;br/&gt;
Redirect Stdout: auto&lt;br/&gt;
Redirect Stderror: auto&lt;/p&gt;

&lt;p&gt;Tab Java&lt;br/&gt;
Java Virtual Machine: Path to the &quot;jvm.dll&quot; of a JRE 8 (usually &amp;lt;path-to-jdk&amp;gt;\jre\bin\server\jvm.dll).&lt;br/&gt;
Java Classpath: Full path to the uber-jar.&lt;br/&gt;
Java Options: -agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=7777 (to enable remote debugging).&lt;/p&gt;

&lt;p&gt;Tab Startup&lt;br/&gt;
Class: org.wildfly.swarm.bootstrap.Main&lt;br/&gt;
Method: main&lt;br/&gt;
Arguments: start&lt;br/&gt;
Mode: jvm&lt;/p&gt;

&lt;p&gt;Tab Shutdown&lt;br/&gt;
Class: org.wildfly.swarm.bootstrap.Main&lt;br/&gt;
Method: main&lt;br/&gt;
Arguments: stop&lt;br/&gt;
Mode:jvm&lt;/p&gt;

&lt;p&gt;5) Now start the service. After a succesful start you can &quot;GET &lt;a href=&quot;http://localhost:8080/hello&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://localhost:8080/hello&lt;/a&gt;&quot;, which should result in a &quot;Hello World&quot; response.&lt;br/&gt;
6) The service has many threads running. See first attached screenshot. &lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;a id=&quot;12413562_thumb&quot; href=&quot;https://issues.jboss.org/secure/attachment/12413562/12413562_1-ThreadAfterStartup.png&quot; title=&quot;1-ThreadAfterStartup.png&quot; file-preview-type=&quot;image&quot; file-preview-id=&quot;12413562&quot; file-preview-title=&quot;1-ThreadAfterStartup.png&quot;&gt;&lt;img src=&quot;https://issues.jboss.org/secure/thumbnail/12413562/_thumb_12413562.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/a&gt;&lt;/span&gt; &lt;br/&gt;
7) Now stop the service. Windows will hang in that stopping attempt and spit out a failure message after some time. The process is still running afterwards. The log file shows some output that indeed a shutdown is initalized. The GET does not work anymore.&lt;br/&gt;
8) The service still has many threads (especially non-daemon threads). See second attached screenshot. &lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;a id=&quot;12413563_thumb&quot; href=&quot;https://issues.jboss.org/secure/attachment/12413563/12413563_2-ThreadAfterShutdown.png&quot; title=&quot;2-ThreadAfterShutdown.png&quot; file-preview-type=&quot;image&quot; file-preview-id=&quot;12413563&quot; file-preview-title=&quot;2-ThreadAfterShutdown.png&quot;&gt;&lt;img src=&quot;https://issues.jboss.org/secure/thumbnail/12413563/_thumb_12413563.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/a&gt;&lt;/span&gt; &lt;br/&gt;
Note, that I have other services, which show only two non-deamon threads after a shutdown attempt.&lt;br/&gt;
9) Killing the task &quot;testing-wfs.exe&quot; is the only way to stop the process completely.&lt;/p&gt;

&lt;p&gt;Switching the Wildfly Swarm version to 2016.10.0 (in the POM of &quot;swarm&quot; module) makes it work great. Starting and stopping run both smoothly.&lt;/p&gt;</description>
                <environment>&lt;p&gt;OS: Windows&lt;/p&gt;</environment>
        <key id="12664521">SWARM-863</key>
            <summary>Version 2016.11.0 doesn&apos;t stop properly (with custom main class)</summary>
                <type id="1" iconUrl="https://issues.jboss.org/secure/viewavatar?size=xsmall&amp;avatarId=13263&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.jboss.org/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.jboss.org/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Done</resolution>
                                        <assignee username="bob.mcwhirter">Bob McWhirter</assignee>
                                    <reporter username="seelenvirtuose">Mirko Wagner</reporter>
                        <labels>
                    </labels>
                <created>Wed, 30 Nov 2016 09:54:40 -0500</created>
                <updated>Mon, 12 Dec 2016 12:26:22 -0500</updated>
                            <resolved>Mon, 12 Dec 2016 12:26:22 -0500</resolved>
                                    <version>2016.11.0</version>
                                    <fixVersion>2017.1.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="13335017" author="seelenvirtuose" created="Wed, 7 Dec 2016 02:36:19 -0500"  >&lt;p&gt;Addendum: The problem still exists with 2016.12.0&lt;/p&gt;</comment>
                            <comment id="13336117" author="bob.mcwhirter" created="Thu, 8 Dec 2016 11:49:44 -0500"  >&lt;p&gt;I&apos;ve tried this on our servlet-war (or now just servlet) example with no main() and here&apos;s what I&apos;ve found doing a &lt;tt&gt;jstack&lt;/tt&gt;:&lt;/p&gt;

&lt;p/&gt;
&lt;div id=&quot;syntaxplugin&quot; class=&quot;syntaxplugin&quot; style=&quot;border: 1px dashed #bbb; border-radius: 5px !important; overflow: auto; max-height: 30em;&quot;&gt;
&lt;table cellspacing=&quot;0&quot; cellpadding=&quot;0&quot; border=&quot;0&quot; width=&quot;100%&quot; style=&quot;font-size: 1em; line-height: 1.4em !important; font-weight: normal; font-style: normal; color: black;&quot;&gt;
		&lt;tbody &gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;  margin-top: 10px;   width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;&quot;MSC service thread 1-6&quot; #28 prio=5 os_prio=0 tid=0x000000001d5cf000 nid=0x1128 in Object.wait() [0x000000002183e000]&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;   java.lang.Thread.State: WAITING (on object monitor)&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;        at java.lang.Object.wait(Native Method)&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;        - waiting on &amp;lt;0x000000078042c7b8&amp;gt; (a sun.nio.fs.AbstractPoller$Request)&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;        at java.lang.Object.wait(Unknown Source)&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;        at sun.nio.fs.AbstractPoller$Request.awaitResult(Unknown Source)&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;        - locked &amp;lt;0x000000078042c7b8&amp;gt; (a sun.nio.fs.AbstractPoller$Request)&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;        at sun.nio.fs.AbstractPoller.invoke(Unknown Source)&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;        at sun.nio.fs.AbstractPoller.close(Unknown Source)&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;        at sun.nio.fs.WindowsWatchService.implClose(Unknown Source)&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;        at sun.nio.fs.AbstractWatchService.close(Unknown Source)&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;        - locked &amp;lt;0x0000000784462ed0&amp;gt; (a java.lang.Object)&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;        at org.xnio.IoUtils.safeClose(IoUtils.java:152)&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;        at org.xnio.nio.WatchServiceFileSystemWatcher.close(WatchServiceFileSystemWatcher.java:214)&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;        at io.undertow.server.handlers.resource.PathResourceManager.close(PathResourceManager.java:246)&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;        - locked &amp;lt;0x0000000784462920&amp;gt; (a io.undertow.server.handlers.resource.PathResourceManager)&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;        at org.wildfly.extension.undertow.deployment.ServletResourceManager.close(ServletResourceManager.java:92)&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;        at io.undertow.server.handlers.resource.CachingResourceManager.close(CachingResourceManager.java:166)&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;        at org.xnio.IoUtils.safeClose(IoUtils.java:152)&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;        at org.wildfly.extension.undertow.deployment.UndertowDeploymentInfoService.stop(UndertowDeploymentInfoService.java:442)&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;        - locked &amp;lt;0x00000007844783f0&amp;gt; (a org.wildfly.extension.undertow.deployment.UndertowDeploymentInfoService)&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;        at org.jboss.msc.service.ServiceControllerImpl$StopTask.stopService(ServiceControllerImpl.java:2056)&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;        at org.jboss.msc.service.ServiceControllerImpl$StopTask.run(ServiceControllerImpl.java:2017)&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;        at java.util.concurrent.ThreadPoolExecutor.runWorker(Unknown Source)&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;        at java.util.concurrent.ThreadPoolExecutor$Worker.run(Unknown Source)&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   margin-bottom: 10px;  width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;        at java.lang.Thread.run(Unknown Source)&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
			&lt;/tbody&gt;
&lt;/table&gt;
&lt;/div&gt;
&lt;p/&gt;

&lt;p&gt;Ultimately it seems that the &lt;tt&gt;WindowsWatchService&lt;/tt&gt; implementation requests a shutdown, but that request is never answered back, and thus the indefinite wait.  The JDK includes a strict &lt;tt&gt;wait()&lt;/tt&gt; without a timeout, which seems sub-par.&lt;/p&gt;

&lt;p&gt;That being said, I don&apos;t know if we&apos;re somehow causing this to be a problem and will continue to investigate.&lt;/p&gt;

&lt;p&gt;Would you be able to also perform a &lt;tt&gt;jstack &amp;lt;process-id&amp;gt;&lt;/tt&gt; on your process after the shutdown has hung, and attach that to this issue for comparison?&lt;/p&gt;

&lt;p&gt;Thanks!&lt;/p&gt;</comment>
                            <comment id="13336299" author="seelenvirtuose" created="Fri, 9 Dec 2016 02:44:38 -0500"  >&lt;p&gt;I did some extensive tests with versions 2016.10.0, 2016.11.0, and 2016.12.0, testing both - the service behavior and the &quot;java -jar &amp;lt;uberjar&amp;gt;&quot; mechanism. Additionally, I collected the stacktraces before and after initiating the shutdown. And as a bonus, I also added the log output for all tests. The attached ZIP file (testing-wfs-jstack.zip) contains all of those findings.&lt;/p&gt;</comment>
                            <comment id="13336579" author="bob.mcwhirter" created="Fri, 9 Dec 2016 09:27:07 -0500"  >&lt;p&gt;&lt;a href=&quot;https://issues.jboss.org/secure/ViewProfile.jspa?name=seelenvirtuose&quot; class=&quot;user-hover&quot; rel=&quot;seelenvirtuose&quot;&gt;Mirko Wagner&lt;/a&gt; Thanks for the great investigative work.&lt;/p&gt;

&lt;p&gt;Last night we merged in this PR:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/wildfly-swarm/wildfly-swarm/pull/252&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/wildfly-swarm/wildfly-swarm/pull/252&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;It&apos;s a one-line change, but as far as I can tell, it allows an uberjar process to successfully and cleanly shutdown when &lt;tt&gt;Control-C&lt;/tt&gt; is used under Windows. We had a lifecycle ordering issue, where we stopped some parts before other parts, in an incorrect order.&lt;/p&gt;

&lt;p&gt;Can you try 2017.1.0-SNAPSHOT from our snapshot repository, or attempt to use HEAD built from source, to verify if this solves the problem in your environment?&lt;/p&gt;

&lt;p&gt;Thanks!&lt;/p&gt;</comment>
                            <comment id="13336803" author="seelenvirtuose" created="Sat, 10 Dec 2016 03:44:43 -0500"  >&lt;p&gt;Hi Bob.&lt;/p&gt;

&lt;p&gt;Sorry for answering so late. Busy days in December.&lt;br/&gt;
I am going to retest with version 2017.1.0 this evening or tomorrow morning (I live in Germany).&lt;/p&gt;

&lt;p&gt;Regards&lt;br/&gt;
Mirko&lt;/p&gt;</comment>
                            <comment id="13336816" author="seelenvirtuose" created="Sat, 10 Dec 2016 13:23:40 -0500"  >&lt;p&gt;Hello again.&lt;/p&gt;

&lt;p&gt;Unfortunately it still doesn&apos;t work with version 2017.1.0-SNAPSHOT. I did the same extensive test as before. This time I also had the logging trace level enabled, which revealed some interesting things.&lt;/p&gt;

&lt;p&gt;First of all, I have attached again the produced log files as well as the jstack reports (see attached file &quot;WFS_Findings_2016-12-10.zip&quot;). The interesting log message is at the end of the shutdown attempt (so at the very end of the log file). One example:&lt;/p&gt;

&lt;p&gt;&amp;gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;...&amp;#93;&lt;/span&gt; Failed to delete root (C:\Users\...\AppData\Local\Temp\wildfly-self-contained3681826991226330288.d\vfs\wildfly-swarm\wildfly-swarmf960a140f5637bf5), retrying in 30sec.&lt;/p&gt;

&lt;p&gt;Inside the mentioned directory we have the extracted WAR file. The directory &quot;WEB-INF/lib&quot; cannot be deleted. In fact, it cannot be accessed at all: missing permissions. See screenshots. The security settings for this directory (see screenshot) are somewhat weird. I even can&apos;t see them.&lt;/p&gt;

&lt;p&gt;As soon as the process is killed, this &quot;lib&quot; directory gets deleted automatically.&lt;/p&gt;

&lt;p&gt;I think, this failure of deletion is the reason why the process can&apos;t stop. That also means that the order of shutdown events is not the cause.&lt;/p&gt;

&lt;p&gt;If I can help any further, please let me know.&lt;/p&gt;</comment>
                            <comment id="13336817" author="bob.mcwhirter" created="Sat, 10 Dec 2016 13:40:57 -0500"  >&lt;p&gt;Thanks for the feedback. I&apos;ll continue to investigate this week. &lt;/p&gt;</comment>
                            <comment id="13336831" author="seelenvirtuose" created="Sun, 11 Dec 2016 02:02:53 -0500"  >&lt;p&gt;Addendum: I retested with version 2016.10.0.&lt;/p&gt;

&lt;p&gt;Using the &quot;java -jar&quot; mechanism, I get the same problem. While the program is running, I can&apos;t browse into the &quot;WEB-INF/lib&quot; directory inside the temporarily extracted WAR file. The same weird persmissions on the directory.&lt;/p&gt;

&lt;p&gt;Using the &quot;service&quot; mechanism, which starts/stops smoothly, I don&apos;t have any problems to browse into the &quot;WEB-INF/lib&quot; directory. The security settings for all files and folders (of the temporarily extracted WAR file) seem to be normal..&lt;/p&gt;

&lt;p&gt;Good luck finding the issue,&lt;/p&gt;</comment>
                            <comment id="13337274" author="bob.mcwhirter" created="Mon, 12 Dec 2016 11:31:51 -0500"  >&lt;p&gt;So I fired up your test-case, which I should&apos;ve done earlier (I had been only testing our &lt;tt&gt;example-servlet&lt;/tt&gt; example).&lt;/p&gt;

&lt;p&gt;And yep, it truly won&apos;t stop, and I saw the same output as you when doing &lt;tt&gt;TRACE&lt;/tt&gt; logging, about the strange &lt;tt&gt;lib&lt;/tt&gt; temp-directory that couldn&apos;t even been &lt;tt&gt;ls&lt;/tt&gt;&apos;d.&lt;/p&gt;

&lt;p&gt;Anyhow, I have another PR hoping to merge today, which at least locally, allows your test-case to cleanly shutdown:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/wildfly-swarm/wildfly-swarm/pull/256&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/wildfly-swarm/wildfly-swarm/pull/256&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;It was more sneaky shutdown-ordering stuff, where we were recursively deleting the temp-directory before the file-watcher and other things, which were using it, were done using it.  Bad bad bad.&lt;/p&gt;

&lt;p&gt;Hopefully this will merge today and you&apos;ll be able to say &quot;Hey, Bob! That fixes it!&quot;&lt;/p&gt;

&lt;p&gt;I hope.&lt;/p&gt;

&lt;p&gt;Thanks for bearing with us. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.jboss.org/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12413562" name="1-ThreadAfterStartup.png" size="23724" author="seelenvirtuose" created="Wed, 30 Nov 2016 10:32:31 -0500"/>
                            <attachment id="12413563" name="2-ThreadAfterShutdown.png" size="22263" author="seelenvirtuose" created="Wed, 30 Nov 2016 10:35:50 -0500"/>
                            <attachment id="12413970" name="WFS_Findings_2016-12-10.zip" size="158747" author="seelenvirtuose" created="Sat, 10 Dec 2016 13:23:57 -0500"/>
                            <attachment id="12413564" name="de.mwa.testing.wfs-master.zip" size="9339" author="seelenvirtuose" created="Wed, 30 Nov 2016 10:44:05 -0500"/>
                            <attachment id="12413890" name="testing-wfs-jstack.zip" size="35532" author="seelenvirtuose" created="Fri, 9 Dec 2016 02:44:56 -0500"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310641" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Number of attachments</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310640" key="com.atlassian.jira.toolkit:comments">
                        <customfieldname>Number of comments</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311940" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1|i005g7:b3900000t</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310840" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12310940" key="com.pyxis.greenhopper.jira:gh-sprint">
                        <customfieldname>Sprint</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="5494">2016-Dec-A</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>