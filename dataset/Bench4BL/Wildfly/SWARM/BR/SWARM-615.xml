<!-- 
RSS generated by JIRA (7.2.3#72005-sha1:73be91d2b96fc29303a7eb6820acf420e5d0ed65) at Tue Dec 06 18:32:34 EST 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.jboss.org/si/jira.issueviews:issue-xml/SWARM-615/SWARM-615.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>JBoss Issue Tracker</title>
    <link>https://issues.jboss.org</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-us</language>    <build-info>
        <version>7.2.3</version>
        <build-number>72005</build-number>
        <build-date>06-10-2016</build-date>
    </build-info>

<item>
            <title>[SWARM-615] Manual lookup of CDI-Instance doesn&apos;t work since 2016.8.1</title>
                <link>https://issues.jboss.org/browse/SWARM-615</link>
                <project id="12317020" key="SWARM">WildFly Swarm</project>
                    <description>&lt;p&gt;Since swarm release 2016.8.1 a manual lookup of the current CDI-instance from within application code results the following error:&lt;/p&gt;


&lt;p/&gt;
&lt;div id=&quot;syntaxplugin&quot; class=&quot;syntaxplugin&quot; style=&quot;border: 1px dashed #bbb; border-radius: 5px !important; overflow: auto; max-height: 30em;&quot;&gt;
&lt;table cellspacing=&quot;0&quot; cellpadding=&quot;0&quot; border=&quot;0&quot; width=&quot;100%&quot; style=&quot;font-size: 1em; line-height: 1.4em !important; font-weight: normal; font-style: normal; color: black;&quot;&gt;
		&lt;tbody &gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;  margin-top: 10px;   width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;Caused by: java.lang.IllegalStateException: Unable to locate CDIProvider&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;        at javax.enterprise.inject.spi.CDI.findAllProviders(CDI.java:&lt;/span&gt;&lt;span style=&quot;color: #009900; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;139&lt;/span&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;)&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;        at javax.enterprise.inject.spi.CDI.getCDIProvider(CDI.java:&lt;/span&gt;&lt;span style=&quot;color: #009900; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;120&lt;/span&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;)&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   margin-bottom: 10px;  width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;        at javax.enterprise.inject.spi.CDI.current(CDI.java:&lt;/span&gt;&lt;span style=&quot;color: #009900; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;56&lt;/span&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;)&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
			&lt;/tbody&gt;
&lt;/table&gt;
&lt;/div&gt;
&lt;p/&gt;

&lt;p&gt;I&apos;ve got a scenario where i have to lookup a CDI-Bean manually and for this i need the CDI-instance. The problem occurs when starting the swarm app from the IDE and via java-jar swarmjar. It&apos;s possible to reproduce by add the following snippet in a simple rest-ressource.&lt;/p&gt;

&lt;p/&gt;
&lt;div id=&quot;syntaxplugin&quot; class=&quot;syntaxplugin&quot; style=&quot;border: 1px dashed #bbb; border-radius: 5px !important; overflow: auto; max-height: 30em;&quot;&gt;
&lt;table cellspacing=&quot;0&quot; cellpadding=&quot;0&quot; border=&quot;0&quot; width=&quot;100%&quot; style=&quot;font-size: 1em; line-height: 1.4em !important; font-weight: normal; font-style: normal; color: black;&quot;&gt;
		&lt;tbody &gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;  margin-top: 10px;   margin-bottom: 10px;  width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;CDI&amp;lt;Object&amp;gt; current = CDI.current();&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
			&lt;/tbody&gt;
&lt;/table&gt;
&lt;/div&gt;
&lt;p/&gt;
</description>
                <environment></environment>
        <key id="12644105">SWARM-615</key>
            <summary>Manual lookup of CDI-Instance doesn&apos;t work since 2016.8.1</summary>
                <type id="1" iconUrl="https://issues.jboss.org/secure/viewavatar?size=xsmall&amp;avatarId=13263&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.jboss.org/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.jboss.org/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Done</resolution>
                                        <assignee username="kenfinni">Ken Finnigan</assignee>
                                    <reporter username="mhofi">Marco Hofstetter</reporter>
                        <labels>
                    </labels>
                <created>Fri, 19 Aug 2016 11:37:03 -0400</created>
                <updated>Wed, 7 Sep 2016 13:07:10 -0400</updated>
                            <resolved>Thu, 25 Aug 2016 15:30:48 -0400</resolved>
                                    <version>2016.8</version>
                                    <fixVersion>2016.9</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                <comments>
                            <comment id="13282518" author="tremes" created="Tue, 23 Aug 2016 05:04:27 -0400"  >&lt;p&gt;My guess is &lt;tt&gt;org.jboss.as.weld.WeldProvider&lt;/tt&gt; cannot be loaded in user app or do we want to provide custom (Swarm) CDI provider?&lt;/p&gt;</comment>
                            <comment id="13290052" author="aanderson1776" created="Wed, 7 Sep 2016 12:10:39 -0400"  >&lt;p&gt;I am still receiving this error in my custom fraction. I added javax.enterprise.api to the fractions &lt;a href=&quot;https://github.com/aaronanderson/swarm-oidc/blob/master/swarm-oidc/module.conf&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;module.conf&lt;/a&gt; is that all that it is needed? I am trying to obtain a BeanManager from a &lt;a href=&quot;https://github.com/aaronanderson/swarm-oidc/blob/master/swarm-oidc/src/main/java/com/mercer/cpsg/swarm/oidc/deployment/OIDCServletExtension.java&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;deployment class&lt;/a&gt;, does that matter? Also this class is loaded as part of the undertow io initialization process. Could there be a CDI load order problem?&lt;/p&gt;


&lt;p&gt;016-09-07 11:06:53,656 ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;org.jboss.msc.service.fail&amp;#93;&lt;/span&gt; (ServerService Thread Pool &amp;#8211; 7) MSC000001: Failed to start service jboss.undertow.deployment.default-server.default-host./: org.jboss.msc.service.StartException in service jboss.undertow.deployment.default-server.default-host./: java.lang.IllegalStateException: Unable to locate CDIProvider&lt;br/&gt;
	at org.wildfly.extension.undertow.deployment.UndertowDeploymentService$1.run(UndertowDeploymentService.java:85)&lt;br/&gt;
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)&lt;br/&gt;
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)&lt;br/&gt;
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)&lt;br/&gt;
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)&lt;br/&gt;
	at java.lang.Thread.run(Thread.java:745)&lt;br/&gt;
	at org.jboss.threads.JBossThread.run(JBossThread.java:320)&lt;br/&gt;
Caused by: java.lang.IllegalStateException: Unable to locate CDIProvider&lt;br/&gt;
	at javax.enterprise.inject.spi.CDI.findAllProviders(CDI.java:139)&lt;br/&gt;
	at javax.enterprise.inject.spi.CDI.getCDIProvider(CDI.java:120)&lt;br/&gt;
	at javax.enterprise.inject.spi.CDI.current(CDI.java:56)&lt;br/&gt;
	at com.mercer.cpsg.swarm.oidc.deployment.OIDCServletExtension.handleDeployment(OIDCServletExtension.java:35)&lt;br/&gt;
	at io.undertow.servlet.core.DeploymentManagerImpl.handleExtensions(DeploymentManagerImpl.java:255)&lt;br/&gt;
	at io.undertow.servlet.core.DeploymentManagerImpl.deploy(DeploymentManagerImpl.java:159)&lt;br/&gt;
	at org.wildfly.extension.undertow.deployment.UndertowDeploymentService.startContext(UndertowDeploymentService.java:100)&lt;br/&gt;
	at org.wildfly.extension.undertow.deployment.UndertowDeploymentService$1.run(UndertowDeploymentService.java:82)&lt;br/&gt;
	... 6 more&lt;/p&gt;

</comment>
                            <comment id="13290055" author="kenfinni" created="Wed, 7 Sep 2016 12:17:26 -0400"  >&lt;p&gt;&lt;a href=&quot;https://issues.jboss.org/secure/ViewProfile.jspa?name=aanderson1776&quot; class=&quot;user-hover&quot; rel=&quot;aanderson1776&quot;&gt;Aaron Anderson&lt;/a&gt;, the problem that this issue was referring to was in relation to user application code, not a custom fraction.&lt;/p&gt;

&lt;p&gt;So there could be a different problem for that situation.&lt;/p&gt;

&lt;p&gt;However, from looking at some of the code in the fraction I&apos;m not sure why a BeanManager or ServletExtension is needed?&lt;/p&gt;

&lt;p&gt;Isn&apos;t it sufficient to add `OIDC` into the Archive and have Weld create an instance of that type in the user application itself?&lt;/p&gt;</comment>
                            <comment id="13290058" author="aanderson1776" created="Wed, 7 Sep 2016 12:22:49 -0400"  >&lt;p&gt;The undertow servlet extension is instanciated using the Java ServiceLoader mechanism so I don&apos;t believe native CDI injection is available. &lt;/p&gt;

&lt;p&gt;Also the reason why I got the &quot;Unable to locate CDIProvider&quot; exception is because my fraction didn&apos;t have a maven POM dependency on the CDI fraction and my simple test application did not include the JAX-RS CDI fraction in a typical swarm deployment. &lt;/p&gt;

&lt;p&gt;Thanks for the quick response!!!!!&lt;/p&gt;</comment>
                            <comment id="13290075" author="aanderson1776" created="Wed, 7 Sep 2016 13:07:10 -0400"  >&lt;p&gt;It appears the cdi module.conf depends on org.wildfly.swarm.undertow which when loaded attempts to load my ServletExtension that attempts to retrieve the CDI instance which is a circular dependency. I am not getting an expected error that the CDI singleton is not set. I am going to go back to using a traditional instance singleton without CDI since I know that works and it will reduce the complexity of the fraction.&lt;/p&gt;



&lt;p&gt;2016-09-07 12:01:53,416 ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;org.jboss.msc.service.fail&amp;#93;&lt;/span&gt; (ServerService Thread Pool &amp;#8211; 5) MSC000001: Failed to start service jboss.undertow.deployment.default-server.default-host./: org.jboss.msc.service.StartException in service jboss.undertow.deployment.default-server.default-host./: java.lang.IllegalStateException: Singleton not set for STATIC_INSTANCE =&amp;gt; []&lt;br/&gt;
	at org.wildfly.extension.undertow.deployment.UndertowDeploymentService$1.run(UndertowDeploymentService.java:85)&lt;br/&gt;
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)&lt;br/&gt;
	at java.util.concurrent.FutureTask.run(FutureTask.java:266)&lt;br/&gt;
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)&lt;br/&gt;
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)&lt;br/&gt;
	at java.lang.Thread.run(Thread.java:745)&lt;br/&gt;
	at org.jboss.threads.JBossThread.run(JBossThread.java:320)&lt;br/&gt;
Caused by: java.lang.IllegalStateException: Singleton not set for STATIC_INSTANCE =&amp;gt; []&lt;br/&gt;
	at org.jboss.weld.bootstrap.api.helpers.RegistrySingletonProvider$RegistrySingleton.get(RegistrySingletonProvider.java:28)&lt;br/&gt;
	at org.jboss.weld.Container.instance(Container.java:55)&lt;br/&gt;
	at org.jboss.as.weld.WeldProvider.getCDI(WeldProvider.java:61)&lt;br/&gt;
	at javax.enterprise.inject.spi.CDI.lambda$getCDIProvider$5(CDI.java:125)&lt;br/&gt;
	at java.util.stream.ReferencePipeline$2$1.accept(ReferencePipeline.java:174)&lt;br/&gt;
	at java.util.Spliterators$IteratorSpliterator.tryAdvance(Spliterators.java:1812)&lt;br/&gt;
	at java.util.stream.ReferencePipeline.forEachWithCancel(ReferencePipeline.java:126)&lt;br/&gt;
	at java.util.stream.AbstractPipeline.copyIntoWithCancel(AbstractPipeline.java:498)&lt;br/&gt;
	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:485)&lt;br/&gt;
	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:471)&lt;br/&gt;
	at java.util.stream.FindOps$FindOp.evaluateSequential(FindOps.java:152)&lt;br/&gt;
	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)&lt;br/&gt;
	at java.util.stream.ReferencePipeline.findAny(ReferencePipeline.java:469)&lt;br/&gt;
	at javax.enterprise.inject.spi.CDI.getCDIProvider(CDI.java:126)&lt;br/&gt;
	at javax.enterprise.inject.spi.CDI.current(CDI.java:56)&lt;br/&gt;
	at com.mercer.cpsg.swarm.oidc.deployment.OIDCServletExtension.handleDeployment(OIDCServletExtension.java:32)&lt;br/&gt;
	at io.undertow.servlet.core.DeploymentManagerImpl.handleExtensions(DeploymentManagerImpl.java:255)&lt;br/&gt;
	at io.undertow.servlet.core.DeploymentManagerImpl.deploy(DeploymentManagerImpl.java:159)&lt;br/&gt;
	at org.wildfly.extension.undertow.deployment.UndertowDeploymentService.startContext(UndertowDeploymentService.java:100)&lt;br/&gt;
	at org.wildfly.extension.undertow.deployment.UndertowDeploymentService$1.run(UndertowDeploymentService.java:82)&lt;br/&gt;
	... 6 more&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="org.jboss.labs.jira.plugin.jboss-custom-field-types-plugin:multiurl">
                        <customfieldname>Git Pull Request</customfieldname>
                        <customfieldvalues>
                            https://github.com/wildfly-swarm/wildfly-swarm/pull/115
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12310641" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Number of attachments</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310640" key="com.atlassian.jira.toolkit:comments">
                        <customfieldname>Number of comments</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311940" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1|hzzm16:xi</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310840" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12310940" key="com.pyxis.greenhopper.jira:gh-sprint">
                        <customfieldname>Sprint</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="5174">2016.9</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>