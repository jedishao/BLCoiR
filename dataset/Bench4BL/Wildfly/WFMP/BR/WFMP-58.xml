<!-- 
RSS generated by JIRA (7.2.3#72005-sha1:73be91d2b96fc29303a7eb6820acf420e5d0ed65) at Tue Dec 06 18:13:34 EST 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.jboss.org/si/jira.issueviews:issue-xml/WFMP-58/WFMP-58.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>JBoss Issue Tracker</title>
    <link>https://issues.jboss.org</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-us</language>    <build-info>
        <version>7.2.3</version>
        <build-number>72005</build-number>
        <build-date>06-10-2016</build-date>
    </build-info>

<item>
            <title>[WFMP-58] The WildFly plugin&apos;s shutdown(reload=true) goal doesn&apos;t wait for the server to come back up</title>
                <link>https://issues.jboss.org/browse/WFMP-58</link>
                <project id="12316025" key="WFMP">WildFly Maven Plugin</project>
                    <description>&lt;p&gt;If you call the &lt;tt&gt;shutdown(reload=true)&lt;/tt&gt; goal, followed by the &lt;tt&gt;deploy-artifact&lt;/tt&gt; goal, it goes boom. The reload operation runs asynchronously, and temporarily takes down the management interface that the &lt;tt&gt;deploy-artifact&lt;/tt&gt; goal needs to succeed, creating a race condition that has ended badly 100% of the time for me.&lt;/p&gt;

&lt;p&gt;Why might a project need to reload &lt;em&gt;then&lt;/em&gt; deploy? For instance, it might &lt;tt&gt;start&lt;/tt&gt; the server, use &lt;tt&gt;execute-commands&lt;/tt&gt; to set system properties required by an application, then &lt;tt&gt;reload&lt;/tt&gt; and use &lt;tt&gt;deploy-artifact&lt;/tt&gt; to deploy that application. Similarly, you might want to reconfigure SSL and then &lt;tt&gt;reload&lt;/tt&gt;, as that change also requires it.&lt;/p&gt;

&lt;p&gt;It&apos;s worth noting that this likely has a simple fix: just copy the &quot;wait for server to be ready&quot; code used in the &lt;tt&gt;start&lt;/tt&gt; goal over to the &lt;tt&gt;shutdown&lt;/tt&gt; goal&apos;s reload handling.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Linux, Java 8, WildFly 10.1&lt;/p&gt;</environment>
        <key id="12644783">WFMP-58</key>
            <summary>The WildFly plugin&apos;s shutdown(reload=true) goal doesn&apos;t wait for the server to come back up</summary>
                <type id="1" iconUrl="https://issues.jboss.org/secure/viewavatar?size=xsmall&amp;avatarId=13263&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.jboss.org/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.jboss.org/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Done</resolution>
                                        <assignee username="jamezp">James Perkins</assignee>
                                    <reporter username="karlmdavisgov">Karl Davis</reporter>
                        <labels>
                    </labels>
                <created>Thu, 25 Aug 2016 10:07:55 -0400</created>
                <updated>Mon, 29 Aug 2016 13:40:10 -0400</updated>
                            <resolved>Mon, 29 Aug 2016 13:40:10 -0400</resolved>
                                    <version>1.1.0.Alpha11</version>
                                    <fixVersion>1.1.0.Beta1</fixVersion>
                                    <component>Maven Plugin</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="13284350" author="jamezp" created="Thu, 25 Aug 2016 11:17:30 -0400"  >&lt;p&gt;Are you executing the &lt;tt&gt;shudown&lt;/tt&gt; goal or the &lt;tt&gt;:shutdown(restart=true)&lt;/tt&gt; CLI operation? Neither will work currently work. I think we could get the &lt;tt&gt;shutdown&lt;/tt&gt; goal itself to wait until the server has reloaded. It&apos;s much more difficult to get the &lt;tt&gt;:reload&lt;/tt&gt; or &lt;tt&gt;:shutdown(restart=true)&lt;/tt&gt; CLI operations to be synchronous.&lt;/p&gt;</comment>
                            <comment id="13284371" author="karlmdavisgov" created="Thu, 25 Aug 2016 11:37:16 -0400"  >&lt;p&gt;The goal itself: &lt;a href=&quot;https://docs.jboss.org/wildfly/plugins/maven/latest/shutdown-mojo.html#reload&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://docs.jboss.org/wildfly/plugins/maven/latest/shutdown-mojo.html#reload&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Initially, I had tried just the CLI&apos;s &lt;tt&gt;:reload&lt;/tt&gt; command, but yeah, that turned into a dead end. After that, I&apos;d hoped that the higher-level goal&apos;s reload logic might be a bit smarter, but alas. End up seeing this in my follow-on &lt;tt&gt;deploy-artifact&lt;/tt&gt; execution:&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;[ERROR] Failed to execute goal org.wildfly.plugins:wildfly-maven-plugin:1.1.0.Alpha11:deploy-artifact (configure-container-deploy) on project bluebutton-data-pipeline-app: Execution configure-container-deploy of goal org.wildfly.plugins:wildfly-maven-plugin:1.1.0.Alpha11:deploy-artifact failed: WFLYCTL0379: System boot is in process; execution of remote management operations is not currently available -&amp;gt; [Help 1]&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;(A more complete set of output is here: &lt;a href=&quot;http://pastebin.com/yQx6taPM&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://pastebin.com/yQx6taPM&lt;/a&gt;)&lt;/p&gt;

&lt;p&gt;I&apos;d suggest that this could be fixed by either:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Adding the &quot;wait for server to be ready&quot; logic at the end of the shutdown/reload goal logic.&lt;/li&gt;
	&lt;li&gt;Adding the &quot;wait for server to be ready&quot; logic at the start of every other goal, in addition to the connect timeout that they already support.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;The second one there would be more robust, but the first would work for my purposes.&lt;/p&gt;</comment>
                            <comment id="13284374" author="jamezp" created="Thu, 25 Aug 2016 11:44:40 -0400"  >&lt;p&gt;Okay that makes sense then. Having it on the goal shouldn&apos;t be too much of an issue. I suppose really a top-level reload goal should have been used rather than a shutdown with a reload parameter. Seems a bit odd in hindsight. Anyway I think that&apos;s reasonable.&lt;/p&gt;

&lt;p&gt;With regards to option 2 I&apos;m not so sure about that. I&apos;ll have to think about it. With most goals it assumes the server is already running which seems like the right thing to do. For locally running servers the overhead of checking of the server is running is probably negligible. However for remote servers there is a potential for it to be a bit of a bottleneck. It&apos;s definitely something to consider though. &lt;/p&gt;</comment>
                            <comment id="13284456" author="karlmdavisgov" created="Thu, 25 Aug 2016 13:24:26 -0400"  >&lt;p&gt;&lt;a href=&quot;https://issues.jboss.org/secure/ViewProfile.jspa?name=jamezp&quot; class=&quot;user-hover&quot; rel=&quot;jamezp&quot;&gt;James Perkins&lt;/a&gt; I can&apos;t find the link/tab anymore, but I did see one WildFly client that supports something similar to option 2 by just catching the errors that are thrown if they try to use the management interface too early, and waiting for them to go away. I don&apos;t think that&apos;d impose any performance penalties. Might be nice to make the plugin robust that way.&lt;/p&gt;

&lt;p&gt;Anyways, like I said: either works for me.&lt;/p&gt;</comment>
                            <comment id="13284492" author="jamezp" created="Thu, 25 Aug 2016 15:58:50 -0400"  >&lt;p&gt;I went with the first approach, but I&apos;ll think about the second approach.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="org.jboss.labs.jira.plugin.jboss-custom-field-types-plugin:multiurl">
                        <customfieldname>Git Pull Request</customfieldname>
                        <customfieldvalues>
                            https://github.com/wildfly/wildfly-maven-plugin/pull/127
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12310641" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Number of attachments</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310640" key="com.atlassian.jira.toolkit:comments">
                        <customfieldname>Number of comments</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311940" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1|i084f3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310840" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_12310183" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Steps to Reproduce</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;(see above)&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>