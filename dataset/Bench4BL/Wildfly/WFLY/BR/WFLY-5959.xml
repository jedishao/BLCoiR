<!-- 
RSS generated by JIRA (7.2.3#72005-sha1:73be91d2b96fc29303a7eb6820acf420e5d0ed65) at Tue Dec 06 15:08:57 EST 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.jboss.org/si/jira.issueviews:issue-xml/WFLY-5959/WFLY-5959.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>JBoss Issue Tracker</title>
    <link>https://issues.jboss.org</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-us</language>    <build-info>
        <version>7.2.3</version>
        <build-number>72005</build-number>
        <build-date>06-10-2016</build-date>
    </build-info>

<item>
            <title>[WFLY-5959] Infinispan caches non transactional despite transactional cache mode</title>
                <link>https://issues.jboss.org/browse/WFLY-5959</link>
                <project id="12313721" key="WFLY">WildFly</project>
                    <description>&lt;p&gt;Local Infinispan caches declared in standalone.xml are no longer set as transactional even if a transactional mode is selected.&lt;/p&gt;

&lt;p&gt;This prevents creation of atomic maps using AtomicMapLookup as that specifically checks if the cache is transactional (throws java.lang.IllegalStateException: AtomicMap needs a transactional cache.)&lt;/p&gt;

&lt;p&gt;Possibly caused by issue &lt;a href=&quot;https://issues.jboss.org/browse/WFLY-5327&quot; title=&quot;Support simple cache optimization in Infinispan subsystem&quot; class=&quot;issue-link&quot; data-issue-key=&quot;WFLY-5327&quot;&gt;&lt;del&gt;WFLY-5327&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12598604">WFLY-5959</key>
            <summary>Infinispan caches non transactional despite transactional cache mode</summary>
                <type id="1" iconUrl="https://issues.jboss.org/secure/viewavatar?size=xsmall&amp;avatarId=13263&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.jboss.org/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.jboss.org/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Done</resolution>
                                        <assignee username="pferraro">Paul Ferraro</assignee>
                                    <reporter username="alexslackx">Alexander Slack</reporter>
                        <labels>
                    </labels>
                <created>Fri, 8 Jan 2016 05:00:23 -0500</created>
                <updated>Mon, 15 Feb 2016 09:39:02 -0500</updated>
                            <resolved>Tue, 19 Jan 2016 15:18:06 -0500</resolved>
                                    <version>10.0.0.CR5</version>
                                    <fixVersion>10.0.0.Final</fixVersion>
                                    <component>Clustering</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="13146747" author="pferraro" created="Sun, 10 Jan 2016 15:30:13 -0500"  >&lt;p&gt;Injecting a cache container into a bean doesn&apos;t magically install its cache configurations.  These are installed only when some service demands them to start (e.g. a service dependency on a cache).  Because you are starting the cache manually, this never happens.&lt;br/&gt;
You should instead inject the cache directly, e.g.&lt;/p&gt;
&lt;p/&gt;
&lt;div id=&quot;syntaxplugin&quot; class=&quot;syntaxplugin&quot; style=&quot;border: 1px dashed #bbb; border-radius: 5px !important; overflow: auto; max-height: 30em;&quot;&gt;
&lt;table cellspacing=&quot;0&quot; cellpadding=&quot;0&quot; border=&quot;0&quot; width=&quot;100%&quot; style=&quot;font-size: 1em; line-height: 1.4em !important; font-weight: normal; font-style: normal; color: black;&quot;&gt;
		&lt;tbody &gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;  margin-top: 10px;   width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: gray; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;@Resource&lt;/span&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;(lookup = &lt;/span&gt;&lt;span style=&quot;color: blue; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;&quot;java:jboss/infinispan/cache/example/localfullxa&quot;&lt;/span&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;)&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   margin-bottom: 10px;  width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: #006699; font-weight: bold; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;private&lt;/span&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt; Cache&amp;lt;String, String&amp;gt; cache;&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
			&lt;/tbody&gt;
&lt;/table&gt;
&lt;/div&gt;
&lt;p/&gt;

&lt;p&gt;Perhaps we should have cache configurations installed as PASSIVE instead of ON_DEMAND - however, something still needs to require the requisite transaction manager to start, since even if PASSIVE, the configuration will not be installed until its dependencies are available.&lt;/p&gt;</comment>
                            <comment id="13146846" author="alexslackx" created="Mon, 11 Jan 2016 05:23:51 -0500"  >&lt;p&gt;I confirm that injecting the cache directly solves the problem (it reports the transaction mode as TRANSACTIONAL).&lt;/p&gt;

&lt;p&gt;Thank you for investigating the issue.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310120">
                    <name>Cloners</name>
                                                                <inwardlinks description="cloned to">
                                        <issuelink>
            <issuekey id="12598925">JBEAP-2658</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310031" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Affects</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10021"><![CDATA[Compatibility/Configuration]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310220" key="org.jboss.labs.jira.plugin.jboss-custom-field-types-plugin:multiurl">
                        <customfieldname>Git Pull Request</customfieldname>
                        <customfieldvalues>
                            https://github.com/wildfly/wildfly/pull/8558
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12310641" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Number of attachments</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310640" key="com.atlassian.jira.toolkit:comments">
                        <customfieldname>Number of comments</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311940" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1|i00lx3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310840" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_12310183" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Steps to Reproduce</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;Declare a cache-container and a cache like this:&lt;br/&gt;
{{&amp;lt;cache-container name=&quot;example&quot;&amp;gt;&lt;br/&gt;
  &amp;lt;local-cache name=&quot;localfullxa&quot;&amp;gt;&lt;br/&gt;
    &amp;lt;transaction mode=&quot;FULL_XA&quot;/&amp;gt;&lt;br/&gt;
  &amp;lt;/local-cache&amp;gt;&lt;br/&gt;
&amp;lt;/cache-container&amp;gt;}}&lt;/p&gt;

&lt;p&gt;Inject the cache container into a bean, obtain the advanced cache instance and print the transaction mode:&lt;/p&gt;

&lt;p&gt;{{@Resource(lookup = &quot;java:jboss/infinispan/container/example&quot;)&lt;br/&gt;
private CacheContainer container;&lt;br/&gt;
...&lt;br/&gt;
Cache&amp;lt;String, String&amp;gt; cache = container.getCache(&quot;localfullxa&quot;);&lt;br/&gt;
AdvancedCache&amp;lt;String, String&amp;gt; ac = cache.getAdvancedCache();&lt;br/&gt;
log.warn(&quot;tx mode is &quot; + ac.getCacheConfiguration().transaction().transactionMode());}}&lt;/p&gt;

&lt;p&gt;Expected result: mode to be TRANSACTIONAL (this is the case on WildFly9 and AS 7)&lt;br/&gt;
Actual result: mode is NON_TRANSACTIONAL&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_12310091" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Workaround Description</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;Creating cache programmatically might be a workaround.&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>
</channel>
</rss>