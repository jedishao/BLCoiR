<!-- 
RSS generated by JIRA (7.2.3#72005-sha1:73be91d2b96fc29303a7eb6820acf420e5d0ed65) at Tue Dec 06 13:03:43 EST 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.jboss.org/si/jira.issueviews:issue-xml/WFLY-1453/WFLY-1453.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>JBoss Issue Tracker</title>
    <link>https://issues.jboss.org</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-us</language>    <build-info>
        <version>7.2.3</version>
        <build-number>72005</build-number>
        <build-date>06-10-2016</build-date>
    </build-info>

<item>
            <title>[WFLY-1453] WildFly is not running on FreeBSD due to missing Linux epoll_create syscall</title>
                <link>https://issues.jboss.org/browse/WFLY-1453</link>
                <project id="12313721" key="WFLY">WildFly</project>
                    <description>&lt;p&gt;When trying to start ./bin/standalone.sh, it writes these errors to the console:&lt;/p&gt;

&lt;p&gt;09:22:43,771 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;org.jboss.remoting&amp;#93;&lt;/span&gt; (MSC service thread 1-2) JBoss Remoting version 4.0.0.Beta1&lt;br/&gt;
09:22:43,823 ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;org.jboss.msc.service.fail&amp;#93;&lt;/span&gt; (MSC service thread 1-2) MSC000001: Failed to start service jboss.remoting.endpoint.management: org.jboss.msc.service.StartException in service jboss.remoting.endpoint.management: JBAS017113: Failed to start service&lt;br/&gt;
	at org.jboss.as.remoting.EndpointService.start(EndpointService.java:85)&lt;br/&gt;
	at org.jboss.msc.service.ServiceControllerImpl$StartTask.startService(ServiceControllerImpl.java:1974) &lt;span class=&quot;error&quot;&gt;&amp;#91;jboss-msc-1.1.2.Final.jar:1.1.2.Final&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.jboss.msc.service.ServiceControllerImpl$StartTask.run(ServiceControllerImpl.java:1907) &lt;span class=&quot;error&quot;&gt;&amp;#91;jboss-msc-1.1.2.Final.jar:1.1.2.Final&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145) &lt;span class=&quot;error&quot;&gt;&amp;#91;rt.jar:1.7.0_21&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615) &lt;span class=&quot;error&quot;&gt;&amp;#91;rt.jar:1.7.0_21&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at java.lang.Thread.run(Thread.java:722) &lt;span class=&quot;error&quot;&gt;&amp;#91;rt.jar:1.7.0_21&amp;#93;&lt;/span&gt;&lt;br/&gt;
Caused by: java.io.IOException: Function not implemented&lt;br/&gt;
	at sun.nio.ch.EPollArrayWrapper.epollCreate(Native Method) &lt;span class=&quot;error&quot;&gt;&amp;#91;rt.jar:1.7.0_21&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at sun.nio.ch.EPollArrayWrapper.&amp;lt;init&amp;gt;(EPollArrayWrapper.java:87) &lt;span class=&quot;error&quot;&gt;&amp;#91;rt.jar:1.7.0_21&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at sun.nio.ch.EPollSelectorImpl.&amp;lt;init&amp;gt;(EPollSelectorImpl.java:68) &lt;span class=&quot;error&quot;&gt;&amp;#91;rt.jar:1.7.0_21&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at sun.nio.ch.EPollSelectorProvider.openSelector(EPollSelectorProvider.java:36) &lt;span class=&quot;error&quot;&gt;&amp;#91;rt.jar:1.7.0_21&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.xnio.nio.NioXnio$DefaultSelectorCreator.open(NioXnio.java:203)&lt;br/&gt;
	at org.xnio.nio.NioXnioWorker.&amp;lt;init&amp;gt;(NioXnioWorker.java:89)&lt;br/&gt;
	at org.xnio.nio.NioXnio.createWorker(NioXnio.java:172)&lt;br/&gt;
	at org.jboss.remoting3.EndpointImpl.construct(EndpointImpl.java:137)&lt;br/&gt;
	at org.jboss.remoting3.Remoting.createEndpoint(Remoting.java:60)&lt;br/&gt;
	at org.jboss.remoting3.Remoting.createEndpoint(Remoting.java:73)&lt;br/&gt;
	at org.jboss.as.remoting.EndpointService.start(EndpointService.java:72)&lt;br/&gt;
	... 5 more&lt;/p&gt;


&lt;p&gt;Which are repeated several times for different components.&lt;/p&gt;

&lt;p&gt;The problem is with unimplemented Linux epoll syscall on Linux compatibility layer. The state of compatibility of Linux with FreeBSD can be tracked here:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://wiki.freebsd.org/linux-kernel&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://wiki.freebsd.org/linux-kernel&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Where, specifically, the workaround for this issue is:&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;if you run an application in the linux java which wants to use the linux epoll functions (you should see &quot;not implemented&quot; messages in dmesg), you can start java with the argument -Djava.nio.channels.spi.SelectorProvider=sun.nio.ch.PollSelectorProvider&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;This is exactly what I see in dmesg: syscall epoll_create not implemented.&lt;/p&gt;

&lt;p&gt;I created simple patch for standalone.sh which resolve this by introducing FreeBSD platform and adding that argument into JAVA_OPTS.&lt;/p&gt;

&lt;p&gt;I am aware that WildFly is not officially supported for FreeBSD but I do not see a reason why it could not be repaired in order to provide at least some runnable version for the community to hack around.&lt;/p&gt;</description>
                <environment>&lt;p&gt;FreeBSD arq 9.1-RELEASE-p3 FreeBSD 9.1-RELEASE-p3 #0: Mon Apr 29 18:27:25 UTC 2013     root@amd64-builder.daemonology.net:/usr/obj/usr/src/sys/GENERIC  amd64&lt;/p&gt;

&lt;p&gt;I am running the latest FreeBSD patching -p3 on top of the latest FreeBSD 9.1.&lt;/p&gt;

&lt;p&gt;java -version&lt;br/&gt;
java version &quot;1.7.0_21&quot;&lt;br/&gt;
Java(TM) SE Runtime Environment (build 1.7.0_21-b11)&lt;br/&gt;
Java HotSpot(TM) Server VM (build 23.21-b01, mixed mode)&lt;/p&gt;

&lt;p&gt;I am running latest /usr/ports/java/linux-sun-jdk17 port which uses Java of version 1.7.0._21.&lt;/p&gt;

&lt;p&gt;Since this is JDK for Linux, there has to be Linux compatibility layer under Java and on top of FreeBSD. &lt;br/&gt;
I am running these ports in order to provide FreeBSD that Linux compatibility:&lt;/p&gt;

&lt;p&gt;% pkg_version | grep linux&lt;br/&gt;
linux-f10-expat                     =&lt;br/&gt;
linux-f10-fontconfig                =&lt;br/&gt;
linux-f10-xorg-libs                 =&lt;br/&gt;
linux_base-f10                      =&lt;/p&gt;

&lt;p&gt;I have enabled linux.ko driver in kernel&lt;/p&gt;

&lt;p&gt;% kldstat&lt;br/&gt;
Id Refs Address            Size     Name&lt;br/&gt;
 1   20 0xffffffff80200000 1323408  kernel&lt;br/&gt;
 2    1 0xffffffff81524000 208758   zfs.ko&lt;br/&gt;
 3    2 0xffffffff8172d000 5c78     opensolaris.ko&lt;br/&gt;
 4    1 0xffffffff81812000 3e1c     linprocfs.ko&lt;br/&gt;
 5    1 0xffffffff81816000 1f43e    linux.ko&lt;/p&gt;</environment>
        <key id="12493609">WFLY-1453</key>
            <summary>WildFly is not running on FreeBSD due to missing Linux epoll_create syscall</summary>
                <type id="1" iconUrl="https://issues.jboss.org/secure/viewavatar?size=xsmall&amp;avatarId=13263&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.jboss.org/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.jboss.org/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Done</resolution>
                                        <assignee username="dmlloyd">David Lloyd</assignee>
                                    <reporter username="smikloso">Stefan Miklosovic</reporter>
                        <labels>
                    </labels>
                <created>Wed, 5 Jun 2013 03:50:55 -0400</created>
                <updated>Thu, 4 Sep 2014 09:45:57 -0400</updated>
                            <resolved>Fri, 20 Sep 2013 15:24:21 -0400</resolved>
                                    <version>8.0.0.Alpha1</version>
                                    <fixVersion>8.0.0.Beta1</fixVersion>
                                    <component>Remoting</component>
                    <component>Scripts</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                <comments>
                            <comment id="12779398" author="smikloso" created="Wed, 5 Jun 2013 03:53:14 -0400"  >&lt;p&gt;Possible patch to further elaborate on:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/wildfly/wildfly/pull/4593&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/wildfly/wildfly/pull/4593&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12779399" author="jaikiran" created="Wed, 5 Jun 2013 03:57:02 -0400"  >&lt;p&gt;I&apos;m assigning this to David who I think will be interested in this, from a XNIO project point of view, which is what I think has the logic of inferring the right selector.&lt;/p&gt;
</comment>
                            <comment id="12779483" author="dmlloyd" created="Wed, 5 Jun 2013 08:30:03 -0400"  >&lt;p&gt;The problem is that the Linux JDK defaults to epoll.  Interestingly, XNIO actually tries to instantiate the KQueueSelectorProvider, which would theoretically work (probably optimally) on FreeBSD, however since the Linux JDK would lack that native code, the construction fails.  In any case though, XNIO makes the assumption at some point that the default NIO provider on the system actually works.  The system property is there for when detection fails and this is not possible, so that is a valid workaround for now.&lt;/p&gt;

&lt;p&gt;One thing I can do though is try to detect that the default provider doesn&apos;t work, and fall back to the polling provider at the last.&lt;/p&gt;</comment>
                            <comment id="12806178" author="dmlloyd" created="Fri, 20 Sep 2013 15:24:21 -0400"  >&lt;p&gt;This should be fixed in latest upstream now.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10012">
                    <name>Dependency</name>
                                            <outwardlinks description="is blocked by">
                                        <issuelink>
            <issuekey id="12493636">XNIO-200</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310641" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Number of attachments</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310640" key="com.atlassian.jira.toolkit:comments">
                        <customfieldname>Number of comments</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311940" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1|hzh8c7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310840" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>160958</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_12310183" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Steps to Reproduce</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;Download WildFly 8 Aplha1, set your FreeBSD as mentioned in environment section and start it (e.g. in standalone mode).&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>