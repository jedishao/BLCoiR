<!-- 
RSS generated by JIRA (7.2.3#72005-sha1:73be91d2b96fc29303a7eb6820acf420e5d0ed65) at Tue Dec 06 15:05:01 EST 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.jboss.org/si/jira.issueviews:issue-xml/WFLY-6056/WFLY-6056.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>JBoss Issue Tracker</title>
    <link>https://issues.jboss.org</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-us</language>    <build-info>
        <version>7.2.3</version>
        <build-number>72005</build-number>
        <build-date>06-10-2016</build-date>
    </build-info>

<item>
            <title>[WFLY-6056] Session.invalidate() exception with OPTIMISTIC cache configuration</title>
                <link>https://issues.jboss.org/browse/WFLY-6056</link>
                <project id="12313721" key="WFLY">WildFly</project>
                    <description>&lt;p&gt;We have an application that must handle &apos;long&apos; async requests and regular requests at the same time.&lt;br/&gt;
We have the same problem as described here:  &lt;a href=&quot;https://developer.jboss.org/thread/254200&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://developer.jboss.org/thread/254200&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;If I use the configuration that is described in this discussion:&lt;/p&gt;

&lt;p&gt;&amp;lt;replicated-cache name=&quot;repl&quot; mode=&quot;ASYNC&quot; batching=&quot;true&quot;&amp;gt; &lt;br/&gt;
&amp;lt;transaction locking=&quot;OPTIMISTIC&quot;/&amp;gt; &lt;br/&gt;
&amp;lt;locking isolation=&quot;READ_COMMITTED&quot;/&amp;gt; &lt;br/&gt;
&amp;lt;file-store/&amp;gt; &lt;br/&gt;
&amp;lt;/replicated-cache&amp;gt; &lt;/p&gt;

&lt;p&gt;then everything is fine until I call session.invalidate(). In this case I get an exception:&lt;br/&gt;
Caused by: java.lang.UnsupportedOperationException: Calling lock() on non-transactional caches is not allowed&lt;br/&gt;
at org.infinispan.cache.impl.CacheImpl.lock(CacheImpl.java:820)&lt;br/&gt;
at org.infinispan.cache.impl.DecoratedCache.lock(DecoratedCache.java:136)&lt;br/&gt;
at org.infinispan.cache.impl.AbstractDelegatingAdvancedCache.lock(AbstractDelegatingAdvancedCache.java:177)&lt;br/&gt;
at org.wildfly.clustering.web.infinispan.session.InfinispanSessionMetaDataFactory.remove(InfinispanSessionMetaDataFactory.java:124)&lt;br/&gt;
at org.wildfly.clustering.web.infinispan.session.InfinispanSessionMetaDataFactory.remove(InfinispanSessionMetaDataFactory.java:39)&lt;br/&gt;
at org.wildfly.clustering.web.infinispan.session.InfinispanSessionFactory.remove(InfinispanSessionFactory.java:89)&lt;br/&gt;
at org.wildfly.clustering.web.infinispan.session.InfinispanSessionFactory.remove(InfinispanSessionFactory.java:40)&lt;br/&gt;
at org.wildfly.clustering.web.infinispan.session.InfinispanSession.invalidate(InfinispanSession.java:67)&lt;br/&gt;
at org.wildfly.clustering.web.infinispan.session.InfinispanSessionManager$SchedulableSession.invalidate(InfinispanSessionManager.java:439)&lt;br/&gt;
at org.wildfly.clustering.web.undertow.session.DistributableSession.invalidate(DistributableSession.java:181)&lt;br/&gt;
at io.undertow.servlet.spec.HttpSessionImpl.invalidate(HttpSessionImpl.java:199)&lt;/p&gt;


&lt;p&gt;Now I modify the configuration and specify &amp;lt;transaction mode=&quot;BATCH&quot; locking=&quot;OPTIMISTIC&quot;/&amp;gt;, I do get another exception:&lt;/p&gt;


&lt;p&gt;Caused by: org.infinispan.InvalidCacheUsageException: Explicit locking is not allowed with optimistic caches!&lt;br/&gt;
at org.infinispan.interceptors.locking.OptimisticLockingInterceptor.visitLockControlCommand(OptimisticLockingInterceptor.java:142)&lt;br/&gt;
at org.infinispan.commands.control.LockControlCommand.acceptVisitor(LockControlCommand.java:110)&lt;br/&gt;
at org.infinispan.interceptors.base.CommandInterceptor.invokeNextInterceptor(CommandInterceptor.java:99)&lt;br/&gt;
at org.infinispan.interceptors.TxInterceptor.invokeNextInterceptorAndVerifyTransaction(TxInterceptor.java:157)&lt;br/&gt;
at org.infinispan.interceptors.TxInterceptor.visitLockControlCommand(TxInterceptor.java:215)&lt;br/&gt;
at org.infinispan.commands.control.LockControlCommand.acceptVisitor(LockControlCommand.java:110)&lt;br/&gt;
at org.infinispan.interceptors.base.CommandInterceptor.invokeNextInterceptor(CommandInterceptor.java:99)&lt;br/&gt;
at org.infinispan.interceptors.base.CommandInterceptor.handleDefault(CommandInterceptor.java:113)&lt;br/&gt;
at org.infinispan.commands.AbstractVisitor.visitLockControlCommand(AbstractVisitor.java:163)&lt;br/&gt;
at org.infinispan.statetransfer.TransactionSynchronizerInterceptor.visitLockControlCommand(TransactionSynchronizerInterceptor.java:78)&lt;br/&gt;
at org.infinispan.commands.control.LockControlCommand.acceptVisitor(LockControlCommand.java:110)&lt;br/&gt;
at org.infinispan.interceptors.base.CommandInterceptor.invokeNextInterceptor(CommandInterceptor.java:99)&lt;br/&gt;
at org.infinispan.statetransfer.StateTransferInterceptor.handleTxCommand(StateTransferInterceptor.java:238)&lt;br/&gt;
at org.infinispan.statetransfer.StateTransferInterceptor.visitLockControlCommand(StateTransferInterceptor.java:102)&lt;br/&gt;
at org.infinispan.commands.control.LockControlCommand.acceptVisitor(LockControlCommand.java:110)&lt;br/&gt;
at org.infinispan.interceptors.base.CommandInterceptor.invokeNextInterceptor(CommandInterceptor.java:99)&lt;br/&gt;
at org.infinispan.interceptors.InvocationContextInterceptor.handleAll(InvocationContextInterceptor.java:107)&lt;br/&gt;
at org.infinispan.interceptors.InvocationContextInterceptor.visitLockControlCommand(InvocationContextInterceptor.java:81)&lt;br/&gt;
at org.infinispan.commands.control.LockControlCommand.acceptVisitor(LockControlCommand.java:110)&lt;br/&gt;
at org.infinispan.interceptors.base.CommandInterceptor.invokeNextInterceptor(CommandInterceptor.java:99)&lt;br/&gt;
at org.infinispan.interceptors.base.CommandInterceptor.handleDefault(CommandInterceptor.java:113)&lt;br/&gt;
at org.infinispan.commands.AbstractVisitor.visitLockControlCommand(AbstractVisitor.java:163)&lt;br/&gt;
at org.infinispan.commands.control.LockControlCommand.acceptVisitor(LockControlCommand.java:110)&lt;br/&gt;
at org.infinispan.interceptors.InterceptorChain.invoke(InterceptorChain.java:336)&lt;br/&gt;
at org.infinispan.cache.impl.CacheImpl.lock(CacheImpl.java:828)&lt;br/&gt;
at org.infinispan.cache.impl.DecoratedCache.lock(DecoratedCache.java:136)&lt;br/&gt;
at org.infinispan.cache.impl.AbstractDelegatingAdvancedCache.lock(AbstractDelegatingAdvancedCache.java:177)&lt;br/&gt;
at org.wildfly.clustering.web.infinispan.session.InfinispanSessionMetaDataFactory.remove(InfinispanSessionMetaDataFactory.java:124)&lt;br/&gt;
at org.wildfly.clustering.web.infinispan.session.InfinispanSessionMetaDataFactory.remove(InfinispanSessionMetaDataFactory.java:39)&lt;br/&gt;
at org.wildfly.clustering.web.infinispan.session.InfinispanSessionFactory.remove(InfinispanSessionFactory.java:89)&lt;br/&gt;
at org.wildfly.clustering.web.infinispan.session.InfinispanSessionFactory.remove(InfinispanSessionFactory.java:40)&lt;br/&gt;
at org.wildfly.clustering.web.infinispan.session.InfinispanSession.invalidate(InfinispanSession.java:67)&lt;br/&gt;
at org.wildfly.clustering.web.infinispan.session.InfinispanSessionManager$SchedulableSession.invalidate(InfinispanSessionManager.java:439)&lt;br/&gt;
at org.wildfly.clustering.web.undertow.session.DistributableSession.invalidate(DistributableSession.java:181)&lt;br/&gt;
at io.undertow.servlet.spec.HttpSessionImpl.invalidate(HttpSessionImpl.java:199)&lt;br/&gt;
Is there some other configuration that I should use?&lt;/p&gt;</description>
                <environment></environment>
        <key id="12600903">WFLY-6056</key>
            <summary>Session.invalidate() exception with OPTIMISTIC cache configuration</summary>
                <type id="1" iconUrl="https://issues.jboss.org/secure/viewavatar?size=xsmall&amp;avatarId=13263&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.jboss.org/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.jboss.org/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="3">Duplicate Issue</resolution>
                                        <assignee username="pferraro">Paul Ferraro</assignee>
                                    <reporter username="jamat">Juan AMAT</reporter>
                        <labels>
                    </labels>
                <created>Sun, 24 Jan 2016 18:10:38 -0500</created>
                <updated>Wed, 27 Jan 2016 23:22:45 -0500</updated>
                            <resolved>Wed, 27 Jan 2016 19:25:46 -0500</resolved>
                                    <version>10.0.0.CR5</version>
                                                    <component>Clustering</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="13154807" author="pferraro" created="Wed, 27 Jan 2016 19:25:46 -0500"  >&lt;p&gt;Duplicate of &lt;a href=&quot;https://issues.jboss.org/browse/WFLY-5998&quot; title=&quot;ISPN-6007 workaround fails for caches using optimistic locking&quot; class=&quot;issue-link&quot; data-issue-key=&quot;WFLY-5998&quot;&gt;&lt;del&gt;WFLY-5998&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="13154823" author="jamat" created="Wed, 27 Jan 2016 23:22:45 -0500"  >&lt;p&gt;I guess that I must trust you on this one as I read the &apos;duplicate&apos; ticket and I am not sure if I follow everything.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310641" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Number of attachments</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310640" key="com.atlassian.jira.toolkit:comments">
                        <customfieldname>Number of comments</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311940" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1|i00zhz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310840" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>