<!-- 
RSS generated by JIRA (7.2.3#72005-sha1:73be91d2b96fc29303a7eb6820acf420e5d0ed65) at Tue Dec 06 14:53:13 EST 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.jboss.org/si/jira.issueviews:issue-xml/WFLY-3329/WFLY-3329.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>JBoss Issue Tracker</title>
    <link>https://issues.jboss.org</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-us</language>    <build-info>
        <version>7.2.3</version>
        <build-number>72005</build-number>
        <build-date>06-10-2016</build-date>
    </build-info>

<item>
            <title>[WFLY-3329] EJBs with same Java class name not intercepted by CDI interceptors</title>
                <link>https://issues.jboss.org/browse/WFLY-3329</link>
                <project id="12313721" key="WFLY">WildFly</project>
                    <description>&lt;h3&gt;&lt;a name=&quot;Given&quot;&gt;&lt;/a&gt;Given&lt;/h3&gt;
&lt;p&gt;Two or more EJBs with the same Java class name but from different Java deployments.&lt;/p&gt;

&lt;h3&gt;&lt;a name=&quot;Problem&quot;&gt;&lt;/a&gt;Problem&lt;/h3&gt;
&lt;p&gt;Interceptor intercepts method calls to only one of the EJBs.&lt;/p&gt;

&lt;p&gt;An EJB to be intercepted seems to be chosen randomly after each redeployment.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12540330">WFLY-3329</key>
            <summary>EJBs with same Java class name not intercepted by CDI interceptors</summary>
                <type id="1" iconUrl="https://issues.jboss.org/secure/viewavatar?size=xsmall&amp;avatarId=13263&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.jboss.org/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.jboss.org/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Done</resolution>
                                        <assignee username="mkouba">Martin Kouba</assignee>
                                    <reporter username="frolovmx">Maxim Frolov</reporter>
                        <labels>
                            <label>ejb</label>
                            <label>ejb3.1</label>
                            <label>interceptor</label>
                    </labels>
                <created>Fri, 9 May 2014 07:32:10 -0400</created>
                <updated>Thu, 4 Sep 2014 09:19:32 -0400</updated>
                            <resolved>Mon, 14 Jul 2014 03:45:57 -0400</resolved>
                                    <version>JBoss AS7 7.1.1.Final</version>
                    <version>JBoss AS7 7.2.0.Final</version>
                    <version>8.0.0.Final</version>
                                    <fixVersion>8.2.0.Final</fixVersion>
                    <fixVersion>9.0.0.Alpha1</fixVersion>
                                    <component>CDI / Weld</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                <comments>
                            <comment id="12966768" author="dmlloyd" created="Fri, 9 May 2014 09:00:50 -0400"  >&lt;p&gt;I think this might be more CDI-related, though it might also have something to do with the EJB deployment paths.&lt;/p&gt;</comment>
                            <comment id="12966771" author="frolovmx" created="Fri, 9 May 2014 09:12:25 -0400"  >&lt;p&gt;During debugging JBoss AS 7.1.3.Final I saw somewhere in the code, that interceptors for method beeing called are looked up by the &lt;em&gt;ejbName&lt;/em&gt; (key in a HashMap) name. The &lt;em&gt;ejbName&lt;/em&gt; in case of &lt;tt&gt;@Stateless&lt;/tt&gt; EJB is just the name of the class. Overriding it in ejb-jar.xml doesn&apos;t change the &lt;em&gt;ejbName&lt;/em&gt;.&lt;/p&gt;</comment>
                            <comment id="12966809" author="swd847" created="Fri, 9 May 2014 10:41:19 -0400"  >&lt;p&gt;The spec does not require us to support two classes with the same name in an ear.&lt;/p&gt;</comment>
                            <comment id="12966877" author="frolovmx" created="Fri, 9 May 2014 12:46:37 -0400"  >&lt;p&gt;As far as I understand the Enterprise JavaBeans 3.1 spec does not require that all classes in an ear have unique java class names.&lt;/p&gt;

&lt;p&gt;&lt;b&gt;&#167;8.3.13 The Bean Provider&#8217;s View of the Deployment Descriptor:&lt;/b&gt;, page 211:&lt;br/&gt;
&lt;cite&gt;An ejb-name element for each entity bean. The ejb-name must be a valid Java identifier and must be &lt;b&gt;unique within&lt;/b&gt; the ejb-name elements of the &lt;b&gt;ejb-jar&lt;/b&gt; file.&lt;/cite&gt;&lt;/p&gt;

&lt;p&gt;&lt;b&gt;&#167;8.6.14 Entity Bean&#8217;s Deployment Descriptor:&lt;/b&gt;, page 250:&lt;br/&gt;
&lt;cite&gt;... The Bean Provider must specify unique names for entity beans which are defined in the ejb-jar file by using the ejb-name element.&lt;/cite&gt;&lt;/p&gt;

&lt;p&gt;&lt;b&gt;&#167;19.3 Application Assembler&#8217;s Responsibility,&lt;/b&gt; page 533:&lt;br/&gt;
&lt;cite&gt;... The Application Assembler uses the ejb-name of the referenced bean for the link. If there are multiple enterprise beans with the same ejb-name, the Application Assembler uses the path name specifying the location of the ejb-jar file that contains the referenced component. The path name is relative to the referencing ejb-jar/.war file. The Application Assembler appends the ejb-name of the referenced bean to the path name separated by #. This allows multiple beans with the same name to be uniquely identified&lt;/cite&gt;&lt;/p&gt;

&lt;p&gt;&lt;b&gt;&#167;19.5 Deployment Descriptor XML Schema,&lt;/b&gt; page 538:&lt;br/&gt;
&lt;cite&gt;The ejb-name element contains the name of an enterprise bean. The name must be unique within the ejb-jar or .war file.&lt;/cite&gt;&lt;/p&gt;


&lt;p&gt;In my case EJB classes are deployed in &lt;b&gt;different JAR&lt;/b&gt; files within an EAR.&lt;/p&gt;</comment>
                            <comment id="12966886" author="swd847" created="Fri, 9 May 2014 13:11:54 -0400"  >&lt;p&gt;The CDI spec however explicitly states that CDI implementations are not required to support multiple classes with the same name in a deployment. We will still try and fix this, but your deployment is not spec compliant. &lt;/p&gt;</comment>
                            <comment id="12966887" author="maschmid" created="Fri, 9 May 2014 13:25:20 -0400"  >&lt;p&gt;The classes have different fully qualified names (different packages), so those should be different bean classes in terms of CDI I think... &lt;/p&gt;</comment>
                            <comment id="12966889" author="swd847" created="Fri, 9 May 2014 13:45:39 -0400"  >&lt;p&gt;ah sorry, my bad, I did not notice that.&lt;/p&gt;</comment>
                            <comment id="12968363" author="rsmeral" created="Fri, 16 May 2014 06:35:18 -0400"  >&lt;p&gt;This seems to be a more general problem, not just with interceptors: &lt;a href=&quot;https://issues.jboss.org/browse/WELD-1680&quot; title=&quot;Only one of two EJBs with equal class name gets discovered&quot; class=&quot;issue-link&quot; data-issue-key=&quot;WELD-1680&quot;&gt;&lt;del&gt;WELD-1680&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12971890" author="mkouba" created="Fri, 30 May 2014 04:56:54 -0400"  >&lt;p&gt;In fact, the fix for &lt;a href=&quot;https://issues.jboss.org/browse/WELD-1680&quot; title=&quot;Only one of two EJBs with equal class name gets discovered&quot; class=&quot;issue-link&quot; data-issue-key=&quot;WELD-1680&quot;&gt;&lt;del&gt;WELD-1680&lt;/del&gt;&lt;/a&gt; (and &lt;a href=&quot;https://issues.jboss.org/browse/WELD-1586&quot; title=&quot;Ambiguous dependency not detected for (two) session beans with the same name&quot; class=&quot;issue-link&quot; data-issue-key=&quot;WELD-1586&quot;&gt;&lt;del&gt;WELD-1586&lt;/del&gt;&lt;/a&gt; respectively) solves a different kind of issue (typesafe resolution). This interception problem cannot be fixed in the Weld code base. It&apos;s an integration issue. The &lt;tt&gt;org.jboss.weld.ejb.spi.EjbServices&lt;/tt&gt; Weld SPI implementation is using ejb-name as a key in a map which stores some interception-related info.&lt;/p&gt;

&lt;p&gt;As to &quot;overriding&quot;, using &lt;tt&gt;@Stateless(name=&quot;...&quot;)&lt;/tt&gt; works fine on WildFly. And also on EAP/AS7 if you modify the reproducer app a little bit. EAP/AS7 is shipped with Weld 1.1 (CDI 1.0) which does not parse CDI 1.1 beans.xml correctly. So if you change the &lt;tt&gt;beans&lt;/tt&gt; element declaration to:&lt;/p&gt;
&lt;p/&gt;
&lt;div id=&quot;syntaxplugin&quot; class=&quot;syntaxplugin&quot; style=&quot;border: 1px dashed #bbb; border-radius: 5px !important; overflow: auto; max-height: 30em;&quot;&gt;
&lt;table cellspacing=&quot;0&quot; cellpadding=&quot;0&quot; border=&quot;0&quot; width=&quot;100%&quot; style=&quot;font-size: 1em; line-height: 1.4em !important; font-weight: normal; font-style: normal; color: black;&quot;&gt;
		&lt;tbody &gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;  margin-top: 10px;   width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;&amp;lt;beans xmlns=&quot;http://java.sun.com/xml/ns/javaee&quot;&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;       xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   margin-bottom: 10px;  width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;       xsi:schemaLocation=&quot;http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/beans_1_0.xsd&quot;&amp;gt;&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
			&lt;/tbody&gt;
&lt;/table&gt;
&lt;/div&gt;
&lt;p/&gt;       
&lt;p&gt;interceptors are applied.&lt;/p&gt;

&lt;p&gt;Also note that the example session beans do not explicitly declare a no-interface view, only Web Service client view (see also EJB spec &quot;4.9.8 Session Bean&#8217;s No-Interface View&quot;) and so from the CDI point of view, their only bean type should be &lt;tt&gt;java.lang.Object&lt;/tt&gt; (see &lt;a href=&quot;http://docs.jboss.org/cdi/spec/1.2/cdi-spec.html#session_bean_types&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;3.2.2. Bean types of a session bean&lt;/a&gt;). And given that the CDI spec does not state whether a JAX-WS endpoint invocation is intercepted (&lt;a href=&quot;http://docs.jboss.org/cdi/spec/1.2/cdi-spec.html#biz_method&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;7.2. Container invocations and interception&lt;/a&gt;) it&apos;s rather questionable whether a bean which cannot be injected should be intercepted. You should annotate the session beans with &lt;tt&gt;javax.ejb.LocalBean&lt;/tt&gt; to expose a no-interface view. On the other hand a no-interface view would not help here (&lt;tt&gt;EjbServices&lt;/tt&gt; problem mentioned above).&lt;/p&gt;</comment>
                            <comment id="12972051" author="frolovmx" created="Fri, 30 May 2014 12:38:54 -0400"  >&lt;p&gt;Indeed &quot;overriding&quot;, using &lt;tt&gt;@Stateless(name=&quot;...&quot;)&lt;/tt&gt; works fine on WildFly and JBoss AS7! I retested it.&lt;br/&gt;
Obviously I made some mistake during my first tests.&lt;/p&gt;

&lt;p&gt;As to &lt;em&gt;no-interface view&lt;/em&gt;, thank you for good hints with correct spec references! &lt;br/&gt;
Actually the problem occured in production where both beans were &lt;tt&gt;@Remote(...)&lt;/tt&gt; &lt;tt&gt;@Stateless&lt;/tt&gt; and one of them was additionally &lt;tt&gt;@WebService&lt;/tt&gt;. To provide an example I tried to reduce everything to a minimum and clearly removed too much.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10012">
                    <name>Dependency</name>
                                            <outwardlinks description="is blocked by">
                                        <issuelink>
            <issuekey id="12540979">WELD-1680</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12542413">WELD-1685</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12544860">WELD-1700</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12545945">WFLY-3601</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="org.jboss.labs.jira.plugin.jboss-custom-field-types-plugin:multiurl">
                        <customfieldname>Git Pull Request</customfieldname>
                        <customfieldvalues>
                            https://github.com/wildfly/wildfly/pull/6501, https://github.com/wildfly/wildfly/pull/6500
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12310641" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Number of attachments</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310640" key="com.atlassian.jira.toolkit:comments">
                        <customfieldname>Number of comments</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>10.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311940" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1|hznntb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310840" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>198306</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_12310183" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Steps to Reproduce</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;ol&gt;
	&lt;li&gt;Check out Maven test project from GitHub:&lt;br/&gt;
&lt;a href=&quot;https://github.com/wrungel/bugs/tree/master/ejb-names-interceptor&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/wrungel/bugs/tree/master/ejb-names-interceptor&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;Build the project with &lt;tt&gt;mvn clean install&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;Deploy EAR file (&lt;tt&gt;ear/target/ejb-names-interceptor.ear&lt;/tt&gt;) to Wildfly&lt;/li&gt;
	&lt;li&gt;Call the Webservice &lt;tt&gt;&lt;a href=&quot;http://localhost:8080/MyWebservice/v1/MyEjbImpl?wsdl&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://localhost:8080/MyWebservice/v1/MyEjbImpl?wsdl&lt;/a&gt;&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;Call the Webservice &lt;tt&gt;&lt;a href=&quot;http://localhost:8080/MyWebservice/v2/MyEjbImpl?wsdl&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://localhost:8080/MyWebservice/v2/MyEjbImpl?wsdl&lt;/a&gt;&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;Check &lt;tt&gt;server.log&lt;/tt&gt;:&lt;br class=&quot;atl-forced-newline&quot; /&gt;
   &lt;b&gt;expected two&lt;/b&gt; lines containing: &lt;tt&gt;Intercepted v1.MyEjbImpl&lt;/tt&gt; and &lt;tt&gt;Intercepted v2.MyEjbImpl&lt;/tt&gt;&lt;br class=&quot;atl-forced-newline&quot; /&gt;
   but &lt;b&gt;actually only one&lt;/b&gt; line (either containing &lt;tt&gt;v1.MyEjbImpl&lt;/tt&gt; or &lt;tt&gt;v2.MyEjbImpl&lt;/tt&gt;) exists.&lt;/li&gt;
&lt;/ol&gt;
</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12310090" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Workaround</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Workaround Exists]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310091" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Workaround Description</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;Rename &lt;b&gt;Java class names&lt;/b&gt; of the EJBs so all names are &lt;b&gt;unique&lt;/b&gt;.&lt;/p&gt;

&lt;p&gt;Also tried to override the names of EJBs according to JSR 318 (EJB 3.1) spec: &lt;blockquote&gt;&lt;p&gt;&amp;lt;bean-name&amp;gt; is the ejb-name of the enterprise bean. For enterprise beans defined via annotation,&lt;br/&gt;
it defaults to the unqualified name of the session bean class, unless specified in the contents of the&lt;br/&gt;
Stateless/Stateful/Singleton annotation name() attribute.&lt;br/&gt;
For enterprise beans defined via ejb-jar.xml, it&#8217;s specified in the &amp;lt;ejb-name&amp;gt; deployment descriptor element.)&lt;/p&gt;&lt;/blockquote&gt;&lt;/p&gt;

&lt;p&gt;without success:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Overriding the EJB names of the beans in &lt;tt&gt;ejb-jar.xml&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;Overriding the EJB names of the beans using &lt;tt&gt;@Stateless(name=&quot;...&quot;)&lt;/tt&gt;&lt;/li&gt;
&lt;/ul&gt;
</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                    </customfields>
    </item>
</channel>
</rss>