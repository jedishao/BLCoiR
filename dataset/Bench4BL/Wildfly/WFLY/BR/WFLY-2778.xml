<!-- 
RSS generated by JIRA (7.2.3#72005-sha1:73be91d2b96fc29303a7eb6820acf420e5d0ed65) at Tue Dec 06 14:25:46 EST 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.jboss.org/si/jira.issueviews:issue-xml/WFLY-2778/WFLY-2778.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>JBoss Issue Tracker</title>
    <link>https://issues.jboss.org</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-us</language>    <build-info>
        <version>7.2.3</version>
        <build-number>72005</build-number>
        <build-date>06-10-2016</build-date>
    </build-info>

<item>
            <title>[WFLY-2778] CPU load at 99% with WildFly 8 CR1</title>
                <link>https://issues.jboss.org/browse/WFLY-2778</link>
                <project id="12313721" key="WFLY">WildFly</project>
                    <description>&lt;p&gt;After Undertow included https forwarding features when shipped with Wildfly CR1, we experienced high cpu load on our machines, reproduced on 5 different servers. Up to 3 threads are running wild, sometimes it&apos;s just one thread though. On the forum reference there are screenshots from jconsole including stacktraces of the threads.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://community.jboss.org/message/853569#853569&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://community.jboss.org/message/853569#853569&lt;/a&gt;&lt;/p&gt;</description>
                <environment>&lt;p&gt;$ java -version&lt;br/&gt;
java version &quot;1.7.0_45&quot;&lt;br/&gt;
Java(TM) SE Runtime Environment (build 1.7.0_45-b18)&lt;br/&gt;
Java HotSpot(TM) 64-Bit Server VM (build 24.45-b08, mixed mode)&lt;/p&gt;

&lt;p&gt;WildFly 8.0.0.CR1&lt;br/&gt;
XNIO version 3.2.0.Beta4&lt;br/&gt;
Undertow 1.0.0.Beta30&lt;/p&gt;</environment>
        <key id="12529838">WFLY-2778</key>
            <summary>CPU load at 99% with WildFly 8 CR1</summary>
                <type id="1" iconUrl="https://issues.jboss.org/secure/viewavatar?size=xsmall&amp;avatarId=13263&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.jboss.org/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="5" iconUrl="https://issues.jboss.org/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Done</resolution>
                                        <assignee username="swd847">Stuart Douglas</assignee>
                                    <reporter username="samma">Matthias Richter</reporter>
                        <labels>
                    </labels>
                <created>Mon, 20 Jan 2014 05:46:32 -0500</created>
                <updated>Thu, 4 Sep 2014 09:38:58 -0400</updated>
                            <resolved>Wed, 29 Jan 2014 11:49:40 -0500</resolved>
                                    <version>8.0.0.CR1</version>
                                    <fixVersion>8.0.0.Final</fixVersion>
                                    <component>Web (Undertow)</component>
                        <due></due>
                            <votes>3</votes>
                                    <watches>12</watches>
                                                                <comments>
                            <comment id="12936879" author="samma" created="Mon, 20 Jan 2014 05:57:59 -0500"  >&lt;p&gt;Stuart, if I can assist you any further please let me know.&lt;/p&gt;

&lt;p&gt;Thanks for your work!&lt;/p&gt;</comment>
                            <comment id="12936881" author="swd847" created="Mon, 20 Jan 2014 06:00:49 -0500"  >&lt;p&gt;I few more instances of stack traces could be useful, preferably in text rather than image form. &lt;/p&gt;</comment>
                            <comment id="12936886" author="samma" created="Mon, 20 Jan 2014 06:15:07 -0500"  >&lt;p&gt;Stuart,&lt;/p&gt;

&lt;p&gt;here are the stackstraces (sudo jstack -F PID) for three threads each using 33% cpu.&lt;/p&gt;

&lt;p&gt;Hope this helps.&lt;/p&gt;</comment>
                            <comment id="12937284" author="dmlloyd" created="Mon, 20 Jan 2014 12:09:16 -0500"  >&lt;p&gt;Those stack traces look a bit goofy.  Are you sure you used jstack from the same JVM that was running the hung process?&lt;/p&gt;</comment>
                            <comment id="12937409" author="samma" created="Tue, 21 Jan 2014 02:57:47 -0500"  >&lt;p&gt;I just verified that it is the same JVM. If I shall run it with any other options etc just let me know!&lt;/p&gt;</comment>
                            <comment id="12937771" author="samma" created="Wed, 22 Jan 2014 03:31:45 -0500"  >&lt;p&gt;While trying to analyze this by myself a thing came to mind I want to document here:&lt;/p&gt;

&lt;p&gt;we are using a JRuby / Rails 4 app and had issues with a CipherError, documented here: &lt;a href=&quot;https://github.com/jruby/jruby/wiki/UnlimitedStrengthCrypto&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/jruby/jruby/wiki/UnlimitedStrengthCrypto&lt;/a&gt; . We had the first solution working with installing the jars. I have no idea if this affects the issue &lt;a href=&quot;https://issues.jboss.org/browse/WFLY-2778&quot; title=&quot;CPU load at 99% with WildFly 8 CR1&quot; class=&quot;issue-link&quot; data-issue-key=&quot;WFLY-2778&quot;&gt;&lt;del&gt;WFLY-2778&lt;/del&gt;&lt;/a&gt;, but I thought I should share this info. Meanwhile we tried the other solution but our servers end up with the cpu load after some time as well.&lt;/p&gt;</comment>
                            <comment id="12937775" author="swd847" created="Wed, 22 Jan 2014 03:37:58 -0500"  >&lt;p&gt;I may have a solution in upstream Undertow. I will cut a release shortly and merge it upstream.&lt;/p&gt;</comment>
                            <comment id="12937785" author="samma" created="Wed, 22 Jan 2014 04:00:43 -0500"  >&lt;p&gt;Thanks Stuart. As soon as it is available we are going to test it.&lt;/p&gt;</comment>
                            <comment id="12938142" author="swd847" created="Thu, 23 Jan 2014 04:12:48 -0500"  >&lt;p&gt;The latest nightly should have the potential fix included: &lt;a href=&quot;https://ci.jboss.org/hudson/job/WildFly-latest-master/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://ci.jboss.org/hudson/job/WildFly-latest-master/&lt;/a&gt; &lt;/p&gt;</comment>
                            <comment id="12938156" author="samma" created="Thu, 23 Jan 2014 04:43:23 -0500"  >&lt;p&gt;Already checking it out, I&apos;ll get back to it soon. &lt;/p&gt;</comment>
                            <comment id="12938458" author="samma" created="Fri, 24 Jan 2014 01:57:35 -0500"  >&lt;p&gt;I got to test it this night and unfortunately it does not work. Still having three threads causing 100% cpu load.&lt;/p&gt;

&lt;p&gt;I made a new stacktrace and I think I figured out, why they looked strange to you, David. I&apos;ll attach an fresh stacktrace made with &apos;$ jstack -F -m 1295&apos;.&lt;/p&gt;</comment>
                            <comment id="12938493" author="halohalo" created="Fri, 24 Jan 2014 04:49:26 -0500"  >&lt;p&gt;I had the same issue and it&apos;s gone with the fix for this bug: &lt;a href=&quot;https://issues.jboss.org/browse/XNIO-215&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.jboss.org/browse/XNIO-215&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12938830" author="samma" created="Mon, 27 Jan 2014 02:50:58 -0500"  >&lt;p&gt;I upgraded the xnio module on wildfly 8.0.0.Final-SNAPSHOT on friday onto xnio-api/xnio-nio 3.2.0.Beta5-SNAPSHOT but still have the same behaviour during the weekend. Needed a restart at least every 10 hours, even there was almost no traffic (dev machines).&lt;/p&gt;</comment>
                            <comment id="12938881" author="ctomc" created="Mon, 27 Jan 2014 05:31:01 -0500"  >&lt;p&gt;This should be resolved in xnio 3.2.0.Final which is already part of WildFly master.&lt;br/&gt;
Can you guys verify that?&lt;/p&gt;</comment>
                            <comment id="12939110" author="samma" created="Mon, 27 Jan 2014 14:52:49 -0500"  >&lt;p&gt;Tomaz,&lt;/p&gt;

&lt;p&gt;I installed the latest master of wildfly and the log shows xnio 3.2.0.Final. Tomorrow I should see if that works. Thanks.&lt;/p&gt;</comment>
                            <comment id="12939191" author="samma" created="Tue, 28 Jan 2014 03:40:32 -0500"  >&lt;p&gt;So with yesterdays master build wildfly final I still have that error. Besides the cpu load I figured out that memory usage of those processes goes up as well.&lt;/p&gt;</comment>
                            <comment id="12939211" author="ctomc" created="Tue, 28 Jan 2014 04:32:15 -0500"  >&lt;p&gt;Can post new thread dump that you get when cpu is at 99%?&lt;/p&gt;</comment>
                            <comment id="12939231" author="samma" created="Tue, 28 Jan 2014 05:53:53 -0500"  >&lt;p&gt;Just a matter of time... I&apos;ll post it then.&lt;/p&gt;</comment>
                            <comment id="12939344" author="swd847" created="Tue, 28 Jan 2014 11:01:45 -0500"  >&lt;p&gt;Can you confirm the version of XNIO that you are using? (It is in the modules/system/layers/base/org/jboss/xnio/main directory)&lt;/p&gt;
</comment>
                            <comment id="12939345" author="jason.greene" created="Tue, 28 Jan 2014 11:04:09 -0500"  >&lt;p&gt;Thanks for being patient with us. We really would like to see this COMPLETELY resolved before final is released. Unfortunately we have been unable to reproduce whatever incarnation you are seeing.&lt;/p&gt;</comment>
                            <comment id="12939347" author="samma" created="Tue, 28 Jan 2014 11:09:19 -0500"  >&lt;p&gt;piece of cake:&lt;/p&gt;

&lt;p/&gt;
&lt;div id=&quot;syntaxplugin&quot; class=&quot;syntaxplugin&quot; style=&quot;border: 1px dashed #bbb; border-radius: 5px !important; overflow: auto; max-height: 30em;&quot;&gt;
&lt;table cellspacing=&quot;0&quot; cellpadding=&quot;0&quot; border=&quot;0&quot; width=&quot;100%&quot; style=&quot;font-size: 1em; line-height: 1.4em !important; font-weight: normal; font-style: normal; color: black;&quot;&gt;
		&lt;tbody &gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;  margin-top: 10px;   width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;wildfly/modules/system/layers/base/org/jboss/xnio/main$ ll&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;total 492&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;drwxr-xr-x 2 wildfly wildfly   4096 Jan 28 02:36 ./&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;drwxr-xr-x 5 wildfly wildfly   4096 Jan 28 02:36 ../&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;-rwxr-xr-x 1 wildfly wildfly   1466 Jan 28 02:36 module.xml*&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   margin-bottom: 10px;  width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;-rwxr-xr-x 1 wildfly wildfly 491417 Jan 28 02:36 xnio-api-3.2.0.Final.jar*&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
			&lt;/tbody&gt;
&lt;/table&gt;
&lt;/div&gt;
&lt;p/&gt;</comment>
                            <comment id="12939348" author="samma" created="Tue, 28 Jan 2014 11:10:44 -0500"  >&lt;p&gt;Jason,&lt;/p&gt;

&lt;p&gt;no problem, meanwhile we switched to an setup with nginx resolving https to http in front of wildfly. We left one machine running in the old setup to support resolving this issue. So if I can help you let me know.&lt;/p&gt;</comment>
                            <comment id="12939544" author="swd847" created="Wed, 29 Jan 2014 05:49:23 -0500"  >&lt;p&gt;Did you manage to get some new stack traces with the upgraded XNIO in place?&lt;/p&gt;</comment>
                            <comment id="12939803" author="samma" created="Wed, 29 Jan 2014 11:40:20 -0500"  >&lt;p&gt;Well, up until now we cannot see the issue again, seems to be working!&lt;/p&gt;

&lt;p&gt;We&apos;ll keep the instance running and observe its behavior. Thanks for your work, guys.&lt;/p&gt;</comment>
                            <comment id="12939808" author="ctomc" created="Wed, 29 Jan 2014 11:49:40 -0500"  >&lt;p&gt;Tnx Matthias for confirming that it works now.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12380076" name="stacktrace-6156.out" size="5798" author="samma" created="Mon, 20 Jan 2014 06:15:07 -0500"/>
                            <attachment id="12380077" name="stacktrace-6157.out" size="5405" author="samma" created="Mon, 20 Jan 2014 06:15:07 -0500"/>
                            <attachment id="12380078" name="stacktrace-6158.out" size="5405" author="samma" created="Mon, 20 Jan 2014 06:15:07 -0500"/>
                            <attachment id="12380176" name="stacktrace-new.out" size="142148" author="samma" created="Fri, 24 Jan 2014 01:58:01 -0500"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310010" key="org.jboss.labs.jira.plugin.jboss-custom-field-types-plugin:multiurl">
                        <customfieldname>Forum Reference</customfieldname>
                        <customfieldvalues>
                            https://community.jboss.org/message/853569#853569
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12310641" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Number of attachments</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310640" key="com.atlassian.jira.toolkit:comments">
                        <customfieldname>Number of comments</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>25.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311940" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1|hzlv8v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310840" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>187852</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>