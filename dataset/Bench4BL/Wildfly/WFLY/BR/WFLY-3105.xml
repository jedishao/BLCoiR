<!-- 
RSS generated by JIRA (7.2.3#72005-sha1:73be91d2b96fc29303a7eb6820acf420e5d0ed65) at Tue Dec 06 13:23:57 EST 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.jboss.org/si/jira.issueviews:issue-xml/WFLY-3105/WFLY-3105.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>JBoss Issue Tracker</title>
    <link>https://issues.jboss.org</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-us</language>    <build-info>
        <version>7.2.3</version>
        <build-number>72005</build-number>
        <build-date>06-10-2016</build-date>
    </build-info>

<item>
            <title>[WFLY-3105] Container-managed EXTENDED persistence context is always joined with transaction even if UNSYNCHRONIZED</title>
                <link>https://issues.jboss.org/browse/WFLY-3105</link>
                <project id="12313721" key="WFLY">WildFly</project>
                    <description>&lt;p&gt;&lt;a href=&quot;https://github.com/weld/wildfly/blob/master/testsuite/integration/basic/src/test/java/org/jboss/as/test/integration/jpa/transaction/UnsynchronizedSFSB.jav&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/weld/wildfly/blob/master/testsuite/integration/basic/src/test/java/org/jboss/as/test/integration/jpa/transaction/UnsynchronizedSFSB.jav&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Change this test to &lt;p/&gt;
&lt;div id=&quot;syntaxplugin&quot; class=&quot;syntaxplugin&quot; style=&quot;border: 1px dashed #bbb; border-radius: 5px !important; overflow: auto; max-height: 30em;&quot;&gt;
&lt;table cellspacing=&quot;0&quot; cellpadding=&quot;0&quot; border=&quot;0&quot; width=&quot;100%&quot; style=&quot;font-size: 1em; line-height: 1.4em !important; font-weight: normal; font-style: normal; color: black;&quot;&gt;
		&lt;tbody &gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;  margin-top: 10px;   margin-bottom: 10px;  width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;@PersistenceContext(type = EXTENDED, synchronization = UNSYNCHRONIZED)&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
			&lt;/tbody&gt;
&lt;/table&gt;
&lt;/div&gt;
&lt;p/&gt; and it will break. &lt;/p&gt;

&lt;p&gt;Looks like an extended PC is always joined to the transaction and flushed on commit, the unsynchronized mode is ignored. From what I can see this is not specified and indeed would make the whole new UNSYNCHRONIZED feature kind of pointless. It&apos;s primary use case is propagation of unflushed/unsynchronized extended PC from a SFSB to other beans while keeping transactions intact.&lt;/p&gt;
</description>
                <environment></environment>
        <key id="12534789">WFLY-3105</key>
            <summary>Container-managed EXTENDED persistence context is always joined with transaction even if UNSYNCHRONIZED</summary>
                <type id="1" iconUrl="https://issues.jboss.org/secure/viewavatar?size=xsmall&amp;avatarId=13263&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.jboss.org/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.jboss.org/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Done</resolution>
                                        <assignee username="smarlow">Scott Marlow</assignee>
                                    <reporter username="christian.bauer">Christian Bauer</reporter>
                        <labels>
                    </labels>
                <created>Wed, 12 Mar 2014 11:12:37 -0400</created>
                <updated>Thu, 4 Sep 2014 09:38:34 -0400</updated>
                            <resolved>Sat, 31 May 2014 22:30:41 -0400</resolved>
                                    <version>8.0.0.Final</version>
                                    <fixVersion>8.1.0.CR1</fixVersion>
                    <fixVersion>8.1.0.Final</fixVersion>
                                    <component>JPA / Hibernate</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>4</watches>
                                                                <comments>
                            <comment id="12952357" author="christian.bauer" created="Wed, 12 Mar 2014 11:38:21 -0400"  >&lt;p&gt;Of course there is this in JPA 2.1 section 7.6.3: &quot;The association of the extended persistence context with the JTA transaction is independent of the synchronization type of the persistence context and whether the persistence context has been joined to the transaction.&quot;&lt;/p&gt;

&lt;p&gt;What does that even mean?&lt;/p&gt;</comment>
                            <comment id="12954395" author="smarlow" created="Wed, 19 Mar 2014 15:48:15 -0400"  >&lt;p&gt;Hmm, sounds like a bug in &lt;a href=&quot;https://github.com/wildfly/wildfly/blob/master/jpa/src/main/java/org/jboss/as/jpa/container/ExtendedEntityManager.java#L136&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/wildfly/wildfly/blob/master/jpa/src/main/java/org/jboss/as/jpa/container/ExtendedEntityManager.java#L136&lt;/a&gt; and &lt;a href=&quot;https://github.com/wildfly/wildfly/blob/master/jpa/src/main/java/org/jboss/as/jpa/transaction/TransactionUtil.java#L82&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/wildfly/wildfly/blob/master/jpa/src/main/java/org/jboss/as/jpa/transaction/TransactionUtil.java#L82&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;From 7.6.1 Persistence Context Synchronization Type XPC can also be UNSYNCHRONIZED:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;By default, a container-managed persistence context is of type SynchronizationType.SYNCHRONIZED. Such a persistence context is automatically joined to the current JTA transaction, and updates made to the persistence context are propagated to the underlying resource manager.&lt;/p&gt;

&lt;p&gt;A container-managed persistence context may be specified to be of type SynchronizationType.UNSYNCHRONIZED. A persistence context of type SynchronizationType.UNSYNCHRONIZED is not enlisted in any JTA transaction unless explicitly joined to that transaction by the application. A persistence context of type SynchronizationType.UNSYNCHRONIZED is enlisted in a JTA transaction and registered for subsequent transaction notifications against that transaction by the invocation of the EntityManager joinTransaction method. The persistence context remains joined to the transaction until the transaction commits or rolls back. After the transaction commits or rolls back, the persistence context will not be joined to any subsequent transaction unless the joinTransaction method is invoked in the scope of that subsequent transaction.&lt;/p&gt;

&lt;p&gt;A persistence context of type SynchronizationType.UNSYNCHRONIZED must not be flushed to the database unless it is joined to a transaction. The application&apos;s use of queries with pessimistic locks, bulk update or delete queries, etc. result in the provider throwing the TransactionRequiredException. After the persistence context has been joined to the JTA transaction, these operations are again allowed.&lt;/p&gt;

&lt;p&gt;The application is permitted to invoke the persist, merge, remove, and refresh entity lifecycle operations on an entity manager of type SynchronizationType.UNSYNCHRONIZED independent of whether the persistence context is joined to the current transaction. After the persistence context has been joined to a transaction, changes in a persistence context can be flushed to the database either explicitly by the application or by the provider. If the flush method is not explicitly invoked, the persistence provider may defer flushing until commit time depending on the operations invoked and the flush mode setting in effect.&lt;/p&gt;

&lt;p&gt;If an extended persistence context of type SynchronizationType.UNSYNCHRONIZED has not been joined to the current JTA transaction, rollback of the JTA transaction will have no effect upon the persistence context. In general, it is recommended that a non-JTA datasource be specified for use by the persistence provider for a persistence context of type SynchronizationType.UNSYNCHRONIZED that has not been joined to a JTA transaction in order to alleviate the risk of integrating uncommitted changes into the persistence context in the event that the transaction is later rolled back.&lt;/p&gt;

&lt;p&gt;If a persistence context of type SynchronizationType.UNSYNCHRONIZED has been joined to the JTA transaction, transaction rollback will cause the persistence context to be cleared and all pre-existing managed and removed instances to become detached. (See section 3.3.3.)&lt;/p&gt;

&lt;p&gt;When a JTA transaction exists, a persistence context of type SynchronizationType.UNSYNCHRONIZED is propagated with that transaction according to the rules in section 7.6.4.1 regardless of whether the persistence context has been joined to that transaction.&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="12954688" author="smarlow" created="Thu, 20 Mar 2014 12:46:12 -0400"  >&lt;p&gt;The &lt;a href=&quot;https://github.com/wildfly/wildfly/pull/6065&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/wildfly/wildfly/pull/6065&lt;/a&gt; change is to not join the extended persistence context to the transaction (via EntityManager.joinTransaction()) for UNSYNCHRONIZED.&lt;/p&gt;

&lt;p&gt;The added unit test failed before the change and passed after.  &lt;/p&gt;</comment>
                            <comment id="12955112" author="smarlow" created="Fri, 21 Mar 2014 15:02:41 -0400"  >&lt;p&gt;Change is merged in (should show up in the &lt;a href=&quot;https://community.jboss.org/thread/224262&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://community.jboss.org/thread/224262&lt;/a&gt; nightly build).&lt;/p&gt;</comment>
                            <comment id="12956883" author="christian.bauer" created="Thu, 27 Mar 2014 02:40:36 -0400"  >&lt;p&gt;Thanks Scott, tested and works now.&lt;/p&gt;</comment>
                            <comment id="12956970" author="smarlow" created="Thu, 27 Mar 2014 08:14:02 -0400"  >&lt;p&gt;Thanks for reporting this Christian!&lt;/p&gt;</comment>
                            <comment id="12956971" author="smarlow" created="Thu, 27 Mar 2014 08:14:20 -0400"  >&lt;p&gt;And for verifying the fix as well!  &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.jboss.org/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="12972188" author="jason.greene" created="Sat, 31 May 2014 22:28:13 -0400"  >&lt;p&gt;Reopening to update fix version&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="org.jboss.labs.jira.plugin.jboss-custom-field-types-plugin:multiurl">
                        <customfieldname>Git Pull Request</customfieldname>
                        <customfieldvalues>
                            https://github.com/wildfly/wildfly/pull/6065
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12310641" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Number of attachments</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310640" key="com.atlassian.jira.toolkit:comments">
                        <customfieldname>Number of comments</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>8.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311940" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1|hzmryf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310840" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>193104</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>