<!-- 
RSS generated by JIRA (7.2.3#72005-sha1:73be91d2b96fc29303a7eb6820acf420e5d0ed65) at Tue Dec 06 14:24:18 EST 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.jboss.org/si/jira.issueviews:issue-xml/WFLY-6294/WFLY-6294.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>JBoss Issue Tracker</title>
    <link>https://issues.jboss.org</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-us</language>    <build-info>
        <version>7.2.3</version>
        <build-number>72005</build-number>
        <build-date>06-10-2016</build-date>
    </build-info>

<item>
            <title>[WFLY-6294] Session draining always takes maximum configured timeout</title>
                <link>https://issues.jboss.org/browse/WFLY-6294</link>
                <project id="12313721" key="WFLY">WildFly</project>
                    <description>&lt;p&gt;The mod_cluster session drain wait is not ending as expected.  mod_cluster adds a session listener to be notified of session destruction.  That is fired appropriately, but when the listener is invoked, the infinispan session manager still reports the session as active.  Thus, this drain loop doesn&apos;t end after the notify because it still sees the active session:&lt;/p&gt;
&lt;p/&gt;
&lt;div id=&quot;syntaxplugin&quot; class=&quot;syntaxplugin&quot; style=&quot;border: 1px dashed #bbb; border-radius: 5px !important; overflow: auto; max-height: 30em;&quot;&gt;
&lt;table cellspacing=&quot;0&quot; cellpadding=&quot;0&quot; border=&quot;0&quot; width=&quot;100%&quot; style=&quot;font-size: 1em; line-height: 1.4em !important; font-weight: normal; font-style: normal; color: black;&quot;&gt;
		&lt;tbody &gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;  margin-top: 10px;   width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;                while ((remainingSessions &amp;gt; 0) &amp;amp;&amp;amp; (noTimeout || (timeout &amp;gt; 0))) {&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;                    ModClusterLogger.LOGGER.drainSessions(remainingSessions, context.getHost(), context);&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   width: auto; padding: 0;&quot;&gt;&amp;nbsp;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;                    listener.wait(noTimeout ? 0 : timeout);&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   width: auto; padding: 0;&quot;&gt;&amp;nbsp;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;                    current = System.currentTimeMillis();&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;                    timeout = end - current;&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;                    remainingSessions = context.getActiveSessionCount();&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   margin-bottom: 10px;  width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;                }&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
			&lt;/tbody&gt;
&lt;/table&gt;
&lt;/div&gt;
&lt;p/&gt;

&lt;p&gt;Can the listeners be invoked when the session is fully removed and no longer considered active?&lt;/p&gt;</description>
                <environment></environment>
        <key id="12608010">WFLY-6294</key>
            <summary>Session draining always takes maximum configured timeout</summary>
                <type id="1" iconUrl="https://issues.jboss.org/secure/viewavatar?size=xsmall&amp;avatarId=13263&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.jboss.org/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="5" iconUrl="https://issues.jboss.org/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Done</resolution>
                                        <assignee username="rhusar">Radoslav Husar</assignee>
                                    <reporter username="aogburn">Aaron Ogburn</reporter>
                        <labels>
                            <label>downstream_dependency</label>
                    </labels>
                <created>Fri, 26 Feb 2016 14:40:04 -0500</created>
                <updated>Thu, 18 Aug 2016 23:49:28 -0400</updated>
                            <resolved>Wed, 20 Jul 2016 13:25:39 -0400</resolved>
                                    <version>10.0.0.Final</version>
                                    <fixVersion>10.1.0.CR1</fixVersion>
                    <fixVersion>10.1.0.Final</fixVersion>
                                    <component>Clustering</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                <comments>
                            <comment id="13181622" author="rhusar" created="Wed, 23 Mar 2016 18:03:02 -0400"  >&lt;p&gt;I would consider this as minor as it is not the default configuration and neither session draining ALWAYS makes much sense for distributable session manager. By default only requests are drained which is not even necessary for stop since we now support graceful shutdown. &lt;/p&gt;</comment>
                            <comment id="13181624" author="rhusar" created="Wed, 23 Mar 2016 18:07:45 -0400"  >&lt;p&gt;Awesome investigation &lt;a href=&quot;https://issues.jboss.org/secure/ViewProfile.jspa?name=aogburn&quot; class=&quot;user-hover&quot; rel=&quot;aogburn&quot;&gt;Aaron Ogburn&lt;/a&gt;, thanks. There is bunch of problems in the current implementation that I am fixing:&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;&lt;b&gt;all&lt;/b&gt; sessions that are in the node will be subject to draining while we want to only attempt to drain sessions for which given node is the primary owner (Jira TBD)&lt;/li&gt;
	&lt;li&gt;passivated sessions are not accounted for session draining &amp;#8211; this will NOT be fixed as the sessions are likely to be not used any more, but mainly this would mean we would bring all the sessions out of passivation, trigger session activated events and other undesirable side effects&lt;/li&gt;
	&lt;li&gt;the notification schema does not work, since the notification will always happen BEFORE the session is actually removed from the manager &amp;#8211; we will poll and wait with a smaller timeouts &amp;#8211; submitted as fix for &lt;a href=&quot;https://issues.jboss.org/browse/MODCLUSTER-478&quot; title=&quot;Session draining always takes maximum configured timeout since listener is always notified before session is removed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;MODCLUSTER-478&quot;&gt;&lt;del&gt;MODCLUSTER-478&lt;/del&gt;&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;the server might look hang while draining, so we should log what is it going to attempt to drain &amp;#8211; submitted as part of PR for &lt;a href=&quot;https://issues.jboss.org/browse/MODCLUSTER-478&quot; title=&quot;Session draining always takes maximum configured timeout since listener is always notified before session is removed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;MODCLUSTER-478&quot;&gt;&lt;del&gt;MODCLUSTER-478&lt;/del&gt;&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;
</comment>
                            <comment id="13182407" author="jira-bugzilla-migration" created="Sat, 26 Mar 2016 14:14:25 -0400"  >&lt;p&gt;Brad Maxwell &amp;lt;bmaxwell@redhat.com&amp;gt; changed the Status of &lt;a href=&quot;https://bugzilla.redhat.com/show_bug.cgi?id=1314792&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;bug 1314792&lt;/a&gt; from NEW to POST&lt;/p&gt;</comment>
                            <comment id="13182758" author="jira-bugzilla-migration" created="Mon, 28 Mar 2016 19:21:30 -0400"  >&lt;p&gt;Sat6QE Jenkins &amp;lt;sat6-jenkins@redhat.com&amp;gt; changed the Status of &lt;a href=&quot;https://bugzilla.redhat.com/show_bug.cgi?id=1314792&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;bug 1314792&lt;/a&gt; from POST to MODIFIED&lt;/p&gt;</comment>
                            <comment id="13182816" author="jira-bugzilla-migration" created="Mon, 28 Mar 2016 19:22:04 -0400"  >&lt;p&gt;Mike McCune &amp;lt;mmccune@redhat.com&amp;gt; changed the Status of &lt;a href=&quot;https://bugzilla.redhat.com/show_bug.cgi?id=1314792&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;bug 1314792&lt;/a&gt; from MODIFIED to POST&lt;/p&gt;</comment>
                            <comment id="13183461" author="rhusar" created="Tue, 29 Mar 2016 12:37:00 -0400"  >&lt;p&gt;Needs mod_cluster-core 1.3.3.Final (unreleased) upgrade.&lt;/p&gt;</comment>
                            <comment id="13185549" author="rhusar" created="Fri, 1 Apr 2016 14:18:26 -0400"  >&lt;p&gt;Created &lt;a href=&quot;https://issues.jboss.org/browse/WFLY-6453&quot; title=&quot;InfinispanSessionManager#getLocalSessions should only return sessions with current node locality&quot; class=&quot;issue-link&quot; data-issue-key=&quot;WFLY-6453&quot;&gt;&lt;del&gt;WFLY-6453&lt;/del&gt;&lt;/a&gt; to fix the issue with the session manager too.&lt;/p&gt;</comment>
                            <comment id="13188791" author="jira-bugzilla-migration" created="Fri, 8 Apr 2016 03:12:21 -0400"  >&lt;p&gt;baranowb &amp;lt;bbaranow@redhat.com&amp;gt; changed the Status of &lt;a href=&quot;https://bugzilla.redhat.com/show_bug.cgi?id=1314792&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;bug 1314792&lt;/a&gt; from POST to NEW&lt;/p&gt;</comment>
                            <comment id="13188800" author="jira-bugzilla-migration" created="Fri, 8 Apr 2016 03:31:51 -0400"  >&lt;p&gt;baranowb &amp;lt;bbaranow@redhat.com&amp;gt; changed the Status of &lt;a href=&quot;https://bugzilla.redhat.com/show_bug.cgi?id=1314792&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;bug 1314792&lt;/a&gt; from NEW to MODIFIED&lt;/p&gt;</comment>
                            <comment id="13196373" author="jira-bugzilla-migration" created="Mon, 25 Apr 2016 06:12:02 -0400"  >&lt;p&gt;Vladimir Dosoudil &amp;lt;dosoudil@redhat.com&amp;gt; changed the Status of &lt;a href=&quot;https://bugzilla.redhat.com/show_bug.cgi?id=1314792&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;bug 1314792&lt;/a&gt; from MODIFIED to ON_QA&lt;/p&gt;</comment>
                            <comment id="13202976" author="jira-bugzilla-migration" created="Tue, 10 May 2016 04:11:16 -0400"  >&lt;p&gt;Michael Cada &amp;lt;mcada@redhat.com&amp;gt; changed the Status of &lt;a href=&quot;https://bugzilla.redhat.com/show_bug.cgi?id=1314792&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;bug 1314792&lt;/a&gt; from ON_QA to VERIFIED&lt;/p&gt;</comment>
                            <comment id="13267418" author="rhusar" created="Tue, 19 Jul 2016 08:04:34 -0400"  >&lt;p&gt;Resolved by component upgrade PR &lt;a href=&quot;https://github.com/wildfly/wildfly/pull/9050&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/wildfly/wildfly/pull/9050&lt;/a&gt;&lt;br/&gt;
PR to modcluster was &lt;a href=&quot;https://github.com/modcluster/mod_cluster/pull/170&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/modcluster/mod_cluster/pull/170&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310120">
                    <name>Cloners</name>
                                                                <inwardlinks description="cloned to">
                                        <issuelink>
            <issuekey id="12639678">JBEAP-5278</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10012">
                    <name>Dependency</name>
                                            <outwardlinks description="is blocked by">
                                        <issuelink>
            <issuekey id="12608012">MODCLUSTER-478</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12612892">WFLY-6453</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10011">
                    <name>Superset</name>
                                                                <inwardlinks description="is incorporated by">
                                        <issuelink>
            <issuekey id="12639391">WFLY-6852</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310440" key="org.jboss.labs.jira.plugin.jboss-custom-field-types-plugin:multiurl">
                        <customfieldname>Bugzilla References</customfieldname>
                        <customfieldvalues>
                            https://bugzilla.redhat.com/show_bug.cgi?id=1314792
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="org.jboss.labs.jira.plugin.jboss-custom-field-types-plugin:multiurl">
                        <customfieldname>Git Pull Request</customfieldname>
                        <customfieldvalues>
                            https://github.com/wildfly/wildfly/pull/9050
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12310641" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Number of attachments</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310640" key="com.atlassian.jira.toolkit:comments">
                        <customfieldname>Number of comments</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>12.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311940" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1|i025pb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310840" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_12310183" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Steps to Reproduce</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;-Run ha profile with an increased session drain stop timeout:&lt;/p&gt;
&lt;p/&gt;
&lt;div id=&quot;syntaxplugin&quot; class=&quot;syntaxplugin&quot; style=&quot;border: 1px dashed #bbb; border-radius: 5px !important; overflow: auto; max-height: 30em;&quot;&gt;
&lt;table cellspacing=&quot;0&quot; cellpadding=&quot;0&quot; border=&quot;0&quot; width=&quot;100%&quot; style=&quot;font-size: 1em; line-height: 1.4em !important; font-weight: normal; font-style: normal; color: black;&quot;&gt;
		&lt;tbody &gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;  margin-top: 10px;   margin-bottom: 10px;  width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;            &amp;lt;mod-cluster-config advertise-socket=&quot;modcluster&quot; proxies=&quot;modclusterproxy&quot; stop-context-timeout=&quot;300&quot; connector=&quot;default&quot; session-draining-strategy=&quot;ALWAYS&quot;&amp;gt;&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
			&lt;/tbody&gt;
&lt;/table&gt;
&lt;/div&gt;
&lt;p/&gt;
&lt;p&gt;-create a session in an app&lt;br/&gt;
-stop jboss&lt;br/&gt;
-invalidate that session&lt;br/&gt;
-note shutdown drain wait doesn&apos;t end&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>