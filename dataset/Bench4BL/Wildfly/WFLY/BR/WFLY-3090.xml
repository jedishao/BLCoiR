<!-- 
RSS generated by JIRA (7.2.3#72005-sha1:73be91d2b96fc29303a7eb6820acf420e5d0ed65) at Tue Dec 06 12:01:11 EST 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.jboss.org/si/jira.issueviews:issue-xml/WFLY-3090/WFLY-3090.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>JBoss Issue Tracker</title>
    <link>https://issues.jboss.org</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-us</language>    <build-info>
        <version>7.2.3</version>
        <build-number>72005</build-number>
        <build-date>06-10-2016</build-date>
    </build-info>

<item>
            <title>[WFLY-3090] Administrative cancellation of management ops results in closed connections</title>
                <link>https://issues.jboss.org/browse/WFLY-3090</link>
                <project id="12313721" key="WFLY">WildFly</project>
                    <description>&lt;p&gt;Administrative cancellation of management ops is implemented by the thread that is handling the cancellation interrupting the thread that is executing the op. This works, but the thread executing the op can&apos;t readily distinguish between interruption do to admin action and cancellation for other reasons such as server shutdown. The OperationContext code detects interruption but restores the interrupted state to the thread, which is valid for the shutdown case. For the administrative cancellation case, it has the negative side effect of producing InterruptedExceptions later on; e.g. when the thread attempts to send data to the remote caller.&lt;/p&gt;

&lt;p&gt;This is particularly an issue in domain mode where the &quot;caller&quot; is a controlling process (HC). The InterruptedException has the effect of terminating the connection from the callee to the controlling process.&lt;/p&gt;

&lt;p&gt;The operation execution code needs to be able to distinguish between administrative cancellation and other causes of interruption.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12534477">WFLY-3090</key>
            <summary>Administrative cancellation of management ops results in closed connections</summary>
                <type id="1" iconUrl="https://issues.jboss.org/secure/viewavatar?size=xsmall&amp;avatarId=13263&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.jboss.org/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.jboss.org/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Done</resolution>
                                        <assignee username="brian.stansberry">Brian Stansberry</assignee>
                                    <reporter username="brian.stansberry">Brian Stansberry</reporter>
                        <labels>
                    </labels>
                <created>Fri, 7 Mar 2014 18:53:50 -0500</created>
                <updated>Thu, 4 Sep 2014 09:36:36 -0400</updated>
                            <resolved>Mon, 2 Jun 2014 10:31:44 -0400</resolved>
                                    <version>8.0.0.Final</version>
                                    <fixVersion>9.0.0.Alpha1</fixVersion>
                                    <component>Domain Management</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="12960638" author="brian.stansberry" created="Wed, 9 Apr 2014 16:20:35 -0400"  >&lt;p&gt;I&apos;m not certain how the operation execution code can cleanly &quot;distinguish between administrative cancellation and other causes of interruption&quot;. There are a layers in between the future being cancelled and the operation context object that would need to be aware of the fact of administrative cancellation, and that operation context is deliberately not exposed through all those layers.&lt;/p&gt;

&lt;p&gt;I&apos;m currently dealing with this issue by isolating the main operation execution thread &amp;#8211; the one that gets interrupted due to management cancellation &amp;#8211; from writing to the remoting channels. Writing is delegated to separate threads.&lt;/p&gt;</comment>
                            <comment id="12960653" author="dmlloyd" created="Wed, 9 Apr 2014 17:17:26 -0400"  >&lt;p&gt;It is probably OK to just suspend the interruption status until the response is written as long as you restore it afterwards, IMO.&lt;/p&gt;</comment>
                            <comment id="12960657" author="brian.stansberry" created="Wed, 9 Apr 2014 17:28:36 -0400"  >&lt;p&gt;I haven&apos;t touched this bit for a week or so and forgot something when I wrote my last &quot;status report&quot; comment &amp;#8211; I was also finding cases when testing cancellation where just by bad luck the op would be cancelled when writing. Now that was something of an edge case, due to the test design not being able to properly assert the system was in the exact desired state (blocking various intended spots) before canceling. But it showed me it could happen for real, with the negative effect of closing down inter-process channels.&lt;/p&gt;

&lt;p&gt;Noticing that was kind of the trump card that moved me past suspending the interruption status and all the way to move the write off to a separate thread.&lt;/p&gt;</comment>
                            <comment id="12960659" author="dmlloyd" created="Wed, 9 Apr 2014 17:34:23 -0400"  >&lt;p&gt;Hmm in retrospect the cancellation mechanism should probably have taken the current operation state into account when deciding whether to interrupt.  If cancellation happens after the operation is already done (or however else we may define &quot;too late&quot;) then it should be completely ignored, one way or another.&lt;/p&gt;</comment>
                            <comment id="12960664" author="brian.stansberry" created="Wed, 9 Apr 2014 17:53:17 -0400"  >&lt;p&gt;That can be done within the operation execution code with appropriate interruption handling. Agreed it would be nicer to have been control over whether interruption happens vs some other mechanism though.&lt;/p&gt;

&lt;p&gt;I think the &quot;too late&quot; state would really just be on the return path after the op commits, and perhaps not in the rollback case though. (It&apos;s possible for a hang to occur during rollback waiting for MSC stability; that should be interruptible with the process ending up in a restart-required state.) But before the op gets to that state it writes; e.g. the &quot;prepared&quot; message in a transactional op.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10012">
                    <name>Dependency</name>
                                                                <inwardlinks description="blocks">
                                        <issuelink>
            <issuekey id="12533829">WFLY-3058</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="org.jboss.labs.jira.plugin.jboss-custom-field-types-plugin:multiurl">
                        <customfieldname>Git Pull Request</customfieldname>
                        <customfieldvalues>
                            https://github.com/wildfly/wildfly/pull/6237
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12310641" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Number of attachments</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310640" key="com.atlassian.jira.toolkit:comments">
                        <customfieldname>Number of comments</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311940" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1|hzmq4v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310840" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>192812</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>