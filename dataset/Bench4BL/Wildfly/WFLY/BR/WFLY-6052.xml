<!-- 
RSS generated by JIRA (7.2.3#72005-sha1:73be91d2b96fc29303a7eb6820acf420e5d0ed65) at Tue Dec 06 14:22:35 EST 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.jboss.org/si/jira.issueviews:issue-xml/WFLY-6052/WFLY-6052.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>JBoss Issue Tracker</title>
    <link>https://issues.jboss.org</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-us</language>    <build-info>
        <version>7.2.3</version>
        <build-number>72005</build-number>
        <build-date>06-10-2016</build-date>
    </build-info>

<item>
            <title>[WFLY-6052] NPE on session.invalidate()</title>
                <link>https://issues.jboss.org/browse/WFLY-6052</link>
                <project id="12313721" key="WFLY">WildFly</project>
                    <description>&lt;p&gt;I created a discussion about the issue some time ago but got not answer.&lt;br/&gt;
See: &lt;a href=&quot;https://developer.jboss.org/message/946976#946976&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://developer.jboss.org/message/946976#946976&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The problem is that when a webapp is not marked as &apos;distributable&apos; the undertow InMemorySessionManager is used.&lt;br/&gt;
As mentioned in the discussion the &apos;getSession&apos; of this manager does not like to be called with a null parameter, which is what willdfy does.&lt;br/&gt;
This happens when single-sign-on is enable and multiple sessions are associated to the same sso session and &apos;invalidate&apos; is called on one of the session.&lt;/p&gt;

&lt;p&gt;The workaround is to marked all our webapps as distributable but this will have a performance impact.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12600876">WFLY-6052</key>
            <summary>NPE on session.invalidate()</summary>
                <type id="1" iconUrl="https://issues.jboss.org/secure/viewavatar?size=xsmall&amp;avatarId=13263&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.jboss.org/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.jboss.org/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Done</resolution>
                                        <assignee username="swd847">Stuart Douglas</assignee>
                                    <reporter username="jamat">Juan AMAT</reporter>
                        <labels>
                    </labels>
                <created>Fri, 22 Jan 2016 15:27:01 -0500</created>
                <updated>Sun, 31 Jan 2016 16:26:10 -0500</updated>
                            <resolved>Sun, 31 Jan 2016 16:26:10 -0500</resolved>
                                    <version>10.0.0.CR5</version>
                                    <fixVersion>10.0.0.Final</fixVersion>
                                    <component>Web (Undertow)</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="13152750" author="jamat" created="Sat, 23 Jan 2016 14:50:48 -0500"  >&lt;p&gt;Looking at changes in undertow, the problem is fixed: &lt;a href=&quot;https://issues.jboss.org/browse/UNDERTOW-603&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.jboss.org/browse/UNDERTOW-603&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I will patch my version of wildfy with undertow 1.3.14.Final and see how it goes.&lt;/p&gt;</comment>
                            <comment id="13152755" author="jamat" created="Sat, 23 Jan 2016 20:19:55 -0500"  >&lt;p&gt;undertow 1.3.14.Final does fix my issue.&lt;/p&gt;

&lt;p&gt;I do have though another problem with session.invalidate().&lt;/p&gt;

&lt;p&gt;This is related to the problem described here:  &lt;a href=&quot;https://developer.jboss.org/thread/254200&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://developer.jboss.org/thread/254200&lt;/a&gt;&lt;br/&gt;
If I use the configuration that is described in this discussion:&lt;br/&gt;
                &amp;lt;replicated-cache name=&quot;repl&quot; mode=&quot;ASYNC&quot; batching=&quot;true&quot;&amp;gt;  &lt;br/&gt;
                    &amp;lt;transaction locking=&quot;OPTIMISTIC&quot;/&amp;gt;  &lt;br/&gt;
                    &amp;lt;locking isolation=&quot;READ_COMMITTED&quot;/&amp;gt;  &lt;br/&gt;
                    &amp;lt;file-store/&amp;gt;  &lt;br/&gt;
                &amp;lt;/replicated-cache&amp;gt; &lt;br/&gt;
then everything is fine until I call session.invalidate(). In this case I get an exception:&lt;/p&gt;

&lt;p&gt;Caused by: java.lang.UnsupportedOperationException: Calling lock() on non-transactional caches is not allowed&lt;br/&gt;
	at org.infinispan.cache.impl.CacheImpl.lock(CacheImpl.java:820)&lt;br/&gt;
	at org.infinispan.cache.impl.DecoratedCache.lock(DecoratedCache.java:136)&lt;br/&gt;
	at org.infinispan.cache.impl.AbstractDelegatingAdvancedCache.lock(AbstractDelegatingAdvancedCache.java:177)&lt;br/&gt;
	at org.wildfly.clustering.web.infinispan.session.InfinispanSessionMetaDataFactory.remove(InfinispanSessionMetaDataFactory.java:124)&lt;br/&gt;
	at org.wildfly.clustering.web.infinispan.session.InfinispanSessionMetaDataFactory.remove(InfinispanSessionMetaDataFactory.java:39)&lt;br/&gt;
	at org.wildfly.clustering.web.infinispan.session.InfinispanSessionFactory.remove(InfinispanSessionFactory.java:89)&lt;br/&gt;
        at org.wildfly.clustering.web.infinispan.session.InfinispanSessionFactory.remove(InfinispanSessionFactory.java:40)&lt;br/&gt;
	at org.wildfly.clustering.web.infinispan.session.InfinispanSession.invalidate(InfinispanSession.java:67)&lt;br/&gt;
	at org.wildfly.clustering.web.infinispan.session.InfinispanSessionManager$SchedulableSession.invalidate(InfinispanSessionManager.java:439)&lt;br/&gt;
	at org.wildfly.clustering.web.undertow.session.DistributableSession.invalidate(DistributableSession.java:181)&lt;br/&gt;
	at io.undertow.servlet.spec.HttpSessionImpl.invalidate(HttpSessionImpl.java:199)&lt;/p&gt;

&lt;p&gt;Now I modify the configuration and specify &amp;lt;transaction mode=&quot;BATCH&quot; locking=&quot;OPTIMISTIC&quot;/&amp;gt;, I do get another exception:&lt;/p&gt;

&lt;p&gt;Caused by: org.infinispan.InvalidCacheUsageException: Explicit locking is not allowed with optimistic caches!&lt;br/&gt;
	at org.infinispan.interceptors.locking.OptimisticLockingInterceptor.visitLockControlCommand(OptimisticLockingInterceptor.java:142)&lt;br/&gt;
	at org.infinispan.commands.control.LockControlCommand.acceptVisitor(LockControlCommand.java:110)&lt;br/&gt;
	at org.infinispan.interceptors.base.CommandInterceptor.invokeNextInterceptor(CommandInterceptor.java:99)&lt;br/&gt;
	at org.infinispan.interceptors.TxInterceptor.invokeNextInterceptorAndVerifyTransaction(TxInterceptor.java:157)&lt;br/&gt;
	at org.infinispan.interceptors.TxInterceptor.visitLockControlCommand(TxInterceptor.java:215)&lt;br/&gt;
	at org.infinispan.commands.control.LockControlCommand.acceptVisitor(LockControlCommand.java:110)&lt;br/&gt;
	at org.infinispan.interceptors.base.CommandInterceptor.invokeNextInterceptor(CommandInterceptor.java:99)&lt;br/&gt;
	at org.infinispan.interceptors.base.CommandInterceptor.handleDefault(CommandInterceptor.java:113)&lt;br/&gt;
	at org.infinispan.commands.AbstractVisitor.visitLockControlCommand(AbstractVisitor.java:163)&lt;br/&gt;
	at org.infinispan.statetransfer.TransactionSynchronizerInterceptor.visitLockControlCommand(TransactionSynchronizerInterceptor.java:78)&lt;br/&gt;
	at org.infinispan.commands.control.LockControlCommand.acceptVisitor(LockControlCommand.java:110)&lt;br/&gt;
	at org.infinispan.interceptors.base.CommandInterceptor.invokeNextInterceptor(CommandInterceptor.java:99)&lt;br/&gt;
	at org.infinispan.statetransfer.StateTransferInterceptor.handleTxCommand(StateTransferInterceptor.java:238)&lt;br/&gt;
	at org.infinispan.statetransfer.StateTransferInterceptor.visitLockControlCommand(StateTransferInterceptor.java:102)&lt;br/&gt;
	at org.infinispan.commands.control.LockControlCommand.acceptVisitor(LockControlCommand.java:110)&lt;br/&gt;
	at org.infinispan.interceptors.base.CommandInterceptor.invokeNextInterceptor(CommandInterceptor.java:99)&lt;br/&gt;
	at org.infinispan.interceptors.InvocationContextInterceptor.handleAll(InvocationContextInterceptor.java:107)&lt;br/&gt;
	at org.infinispan.interceptors.InvocationContextInterceptor.visitLockControlCommand(InvocationContextInterceptor.java:81)&lt;br/&gt;
	at org.infinispan.commands.control.LockControlCommand.acceptVisitor(LockControlCommand.java:110)&lt;br/&gt;
	at org.infinispan.interceptors.base.CommandInterceptor.invokeNextInterceptor(CommandInterceptor.java:99)&lt;br/&gt;
	at org.infinispan.interceptors.base.CommandInterceptor.handleDefault(CommandInterceptor.java:113)&lt;br/&gt;
	at org.infinispan.commands.AbstractVisitor.visitLockControlCommand(AbstractVisitor.java:163)&lt;br/&gt;
	at org.infinispan.commands.control.LockControlCommand.acceptVisitor(LockControlCommand.java:110)&lt;br/&gt;
	at org.infinispan.interceptors.InterceptorChain.invoke(InterceptorChain.java:336)&lt;br/&gt;
	at org.infinispan.cache.impl.CacheImpl.lock(CacheImpl.java:828)&lt;br/&gt;
	at org.infinispan.cache.impl.DecoratedCache.lock(DecoratedCache.java:136)&lt;br/&gt;
	at org.infinispan.cache.impl.AbstractDelegatingAdvancedCache.lock(AbstractDelegatingAdvancedCache.java:177)&lt;br/&gt;
	at org.wildfly.clustering.web.infinispan.session.InfinispanSessionMetaDataFactory.remove(InfinispanSessionMetaDataFactory.java:124)&lt;br/&gt;
	at org.wildfly.clustering.web.infinispan.session.InfinispanSessionMetaDataFactory.remove(InfinispanSessionMetaDataFactory.java:39)&lt;br/&gt;
	at org.wildfly.clustering.web.infinispan.session.InfinispanSessionFactory.remove(InfinispanSessionFactory.java:89)&lt;br/&gt;
	at org.wildfly.clustering.web.infinispan.session.InfinispanSessionFactory.remove(InfinispanSessionFactory.java:40)&lt;br/&gt;
	at org.wildfly.clustering.web.infinispan.session.InfinispanSession.invalidate(InfinispanSession.java:67)&lt;br/&gt;
	at org.wildfly.clustering.web.infinispan.session.InfinispanSessionManager$SchedulableSession.invalidate(InfinispanSessionManager.java:439)&lt;br/&gt;
	at org.wildfly.clustering.web.undertow.session.DistributableSession.invalidate(DistributableSession.java:181)&lt;br/&gt;
	at io.undertow.servlet.spec.HttpSessionImpl.invalidate(HttpSessionImpl.java:199)&lt;/p&gt;

&lt;p&gt;Is there some other configuration that I should use?&lt;/p&gt;</comment>
                            <comment id="13152770" author="swd847" created="Sun, 24 Jan 2016 16:56:04 -0500"  >&lt;p&gt;You will need to create a new issue for the clustering exception.&lt;/p&gt;</comment>
                            <comment id="13152773" author="jamat" created="Sun, 24 Jan 2016 18:11:05 -0500"  >&lt;p&gt;You are absolutely right: &lt;a href=&quot;https://issues.jboss.org/browse/WFLY-6056&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.jboss.org/browse/WFLY-6056&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310641" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Number of attachments</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310640" key="com.atlassian.jira.toolkit:comments">
                        <customfieldname>Number of comments</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311940" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1|i00zcn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310840" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_12310183" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Steps to Reproduce</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;enable single-sign-on&lt;/li&gt;
	&lt;li&gt;deploy 2 web apps that are not &apos;distributable&apos;&lt;/li&gt;
	&lt;li&gt;login to one on the web app&lt;/li&gt;
	&lt;li&gt;navigate to the other webapp (no authentication is needed)&lt;/li&gt;
	&lt;li&gt;make a call to the for webapp that will call session.invalidate()&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;-&amp;gt; NPE&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>