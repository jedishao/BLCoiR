<!-- 
RSS generated by JIRA (7.2.3#72005-sha1:73be91d2b96fc29303a7eb6820acf420e5d0ed65) at Tue Dec 06 12:25:42 EST 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.jboss.org/si/jira.issueviews:issue-xml/WFLY-6943/WFLY-6943.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>JBoss Issue Tracker</title>
    <link>https://issues.jboss.org</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-us</language>    <build-info>
        <version>7.2.3</version>
        <build-number>72005</build-number>
        <build-date>06-10-2016</build-date>
    </build-info>

<item>
            <title>[WFLY-6943] javax.el.ImportHandler#resolveClass API doesn&apos;t use &quot;current&quot; classloader</title>
                <link>https://issues.jboss.org/browse/WFLY-6943</link>
                <project id="12313721" key="WFLY">WildFly</project>
                    <description>&lt;p&gt;The EL 3.0 spec, section 1.22.2 states:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;Either a class or a package can be explicitly imported into the EL evaluation&lt;br/&gt;
environment. Importing a package imports all the classes in the package. The classes&lt;br/&gt;
that can be imported are restricted to the classes that can be loaded by the &lt;b&gt;current class loader&lt;/b&gt;.&lt;/p&gt;

&lt;p&gt;The imports of packages, classes, and static fields are handled by the&lt;br/&gt;
&lt;b&gt;ImportHandler&lt;/b&gt; in the ELContext.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;It states that the &quot;current&quot; class loader is used to load those classes. Although it doesn&apos;t specifically state it as context classloader of the current thread, I suspect that&apos;s what it means since it makes sense to obviously allow application specific classes to be imported. &lt;/p&gt;

&lt;p&gt;The `javax.el.ImportHandler` class which is noted above as the one which handles resolution of these classes, is thus responsible for using the &quot;current&quot; class loader. However, the current implementation of the `javax.el.ImportHandler` instead uses the class loader which loaded the ImportHandler class itself, which of course leads to issues like the application specific class not being visible to it and thus the `resolveClass` method  doesn&apos;t return the application specific Class instance back and instead returns null.&lt;/p&gt;

&lt;p&gt;This is what the current implementation looks like &lt;a href=&quot;https://github.com/jboss/jboss-el-api_spec/blob/jboss-el-api_3.0-1.0.x/src/main/java/javax/el/ImportHandler.java#L176&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/jboss/jboss-el-api_spec/blob/jboss-el-api_3.0-1.0.x/src/main/java/javax/el/ImportHandler.java#L176&lt;/a&gt;&lt;/p&gt;
&lt;p/&gt;
&lt;div id=&quot;syntaxplugin&quot; class=&quot;syntaxplugin&quot; style=&quot;border: 1px dashed #bbb; border-radius: 5px !important; overflow: auto; max-height: 30em;&quot;&gt;
&lt;table cellspacing=&quot;0&quot; cellpadding=&quot;0&quot; border=&quot;0&quot; width=&quot;100%&quot; style=&quot;font-size: 1em; line-height: 1.4em !important; font-weight: normal; font-style: normal; color: black;&quot;&gt;
		&lt;tbody &gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;  margin-top: 10px;   width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;try {&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;return Class.forName(className, false, getClass().getClassLoader());&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;} catch (ClassNotFoundException ex) {&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;notAClass.add(className);&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   margin-bottom: 10px;  width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;}&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
			&lt;/tbody&gt;
&lt;/table&gt;
&lt;/div&gt;
&lt;p/&gt;

&lt;p&gt;The fix would involve using the TCCL during the resolution, but I think this needs a clarification from the EL spec team and also a fix to the API published by Oracle (as well as WildFly team&apos;s own copies).&lt;/p&gt;</description>
                <environment></environment>
        <key id="12642981">WFLY-6943</key>
            <summary>javax.el.ImportHandler#resolveClass API doesn&apos;t use &quot;current&quot; classloader</summary>
                <type id="1" iconUrl="https://issues.jboss.org/secure/viewavatar?size=xsmall&amp;avatarId=13263&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.jboss.org/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.jboss.org/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Done</resolution>
                                        <assignee username="jamezp">James Perkins</assignee>
                                    <reporter username="jaikiran">jaikiran pai</reporter>
                        <labels>
                    </labels>
                <created>Thu, 11 Aug 2016 09:50:02 -0400</created>
                <updated>Fri, 12 Aug 2016 01:31:48 -0400</updated>
                            <resolved>Thu, 11 Aug 2016 22:03:10 -0400</resolved>
                                    <version>10.0.0.Final</version>
                    <version>10.1.0.CR1</version>
                                    <fixVersion>10.1.0.Final</fixVersion>
                    <fixVersion>11.0.0.Alpha1</fixVersion>
                                    <component>EE</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="13277925" author="jaikiran" created="Thu, 11 Aug 2016 09:52:21 -0400"  >&lt;p&gt;Assigning to Jason since he might know more about the spec.&lt;/p&gt;

&lt;p&gt;This can be reproduced by uncommenting this line &lt;a href=&quot;https://github.com/wildfly/wildfly/pull/9114/files#diff-63f7ae381250a1ccbb45db6649fffc8fR82&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/wildfly/wildfly/pull/9114/files#diff-63f7ae381250a1ccbb45db6649fffc8fR82&lt;/a&gt; in the testcase included in that PR.&lt;/p&gt;</comment>
                            <comment id="13278034" author="ctomc" created="Thu, 11 Aug 2016 11:45:04 -0400"  >&lt;p&gt;The current impl of ImportHandler probably works fine in non modular environments.&lt;br/&gt;
but in case of WildFly the EL api / impl classes are loaded from their own module and as such get module classloader that is limited to that module.&lt;/p&gt;

&lt;p&gt;I think we could just fix or version of the ImportHandler to work with TCCL&lt;/p&gt;</comment>
                            <comment id="13278236" author="jaikiran" created="Thu, 11 Aug 2016 22:01:45 -0400"  >&lt;p&gt;James fixed it in our EL API code &lt;a href=&quot;https://github.com/jboss/jboss-el-api_spec/commit/30972d1e849df479477fc7bfdb1d5a9fefd3f5a4&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/jboss/jboss-el-api_spec/commit/30972d1e849df479477fc7bfdb1d5a9fefd3f5a4&lt;/a&gt;. Thanks James. Marking this as resolved.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310001">
                    <name>Related</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12642703">WFLY-6939</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310010" key="org.jboss.labs.jira.plugin.jboss-custom-field-types-plugin:multiurl">
                        <customfieldname>Forum Reference</customfieldname>
                        <customfieldvalues>
                            https://developer.jboss.org/message/961282#961282
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12310641" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Number of attachments</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310640" key="com.atlassian.jira.toolkit:comments">
                        <customfieldname>Number of comments</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311940" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1|i07ugv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310840" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310211" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Release Notes Text</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Newer version of the EL spec API project has been merged to 10.x (and master) of WildFly &lt;a href=&quot;https://github.com/wildfly/wildfly/commit/d1212ed7091627aed9696d2e5361bdf30b39e9af&quot;&gt;https://github.com/wildfly/wildfly/commit/d1212ed7091627aed9696d2e5361bdf30b39e9af&lt;/a&gt;.&lt;br/&gt;
</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>