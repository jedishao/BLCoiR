<!-- 
RSS generated by JIRA (7.2.3#72005-sha1:73be91d2b96fc29303a7eb6820acf420e5d0ed65) at Tue Dec 06 15:42:41 EST 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.jboss.org/si/jira.issueviews:issue-xml/WFLY-2521/WFLY-2521.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>JBoss Issue Tracker</title>
    <link>https://issues.jboss.org</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-us</language>    <build-info>
        <version>7.2.3</version>
        <build-number>72005</build-number>
        <build-date>06-10-2016</build-date>
    </build-info>

<item>
            <title>[WFLY-2521] EJB backing cache&apos;s can generate large retention from cancelled tasks in its scheduled executor&apos;s DelayedWorkQueue</title>
                <link>https://issues.jboss.org/browse/WFLY-2521</link>
                <project id="12313721" key="WFLY">WildFly</project>
                    <description>&lt;p&gt;EJB backing cache&apos;s frequently cancel remove and passivation tasks with each access and replace them with new ones.  Per &lt;a href=&quot;http://docs.oracle.com/javase/7/docs/api/java/util/concurrent/ScheduledThreadPoolExecutor.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://docs.oracle.com/javase/7/docs/api/java/util/concurrent/ScheduledThreadPoolExecutor.html&lt;/a&gt; cancelled tasks are not removed from queue until their scheduled delay passes.&lt;/p&gt;

&lt;p&gt;So due to the java ScheduledThreadPoolExecutor&apos;s lazy cancelled task removal, this scheduled task cancellation and recreation model can potentially churn up quite a number of queued cancelled tasks sitting in the executor&apos;s DelayedWorkQueue.  With longer timeouts and frequent ejb access, this can generate substantial heap overhead.&lt;/p&gt;

&lt;p&gt;It should be pretty easy to help limit any such build up by calling purge() &lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; on the scheduled executor.  Likely don&apos;t want to purge with each cancel, so perhaps a purge() could be called on a configurable time delay or after a configurable amount of cancels?&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; &lt;a href=&quot;http://docs.oracle.com/javase/6/docs/api/java/util/concurrent/ThreadPoolExecutor.html#purge%28%29&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://docs.oracle.com/javase/6/docs/api/java/util/concurrent/ThreadPoolExecutor.html#purge%28%29&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12525362">WFLY-2521</key>
            <summary>EJB backing cache&apos;s can generate large retention from cancelled tasks in its scheduled executor&apos;s DelayedWorkQueue</summary>
                <type id="1" iconUrl="https://issues.jboss.org/secure/viewavatar?size=xsmall&amp;avatarId=13263&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.jboss.org/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.jboss.org/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Done</resolution>
                                        <assignee username="pferraro">Paul Ferraro</assignee>
                                    <reporter username="aogburn">Aaron Ogburn</reporter>
                        <labels>
                    </labels>
                <created>Fri, 15 Nov 2013 16:31:01 -0500</created>
                <updated>Thu, 4 Sep 2014 09:30:56 -0400</updated>
                            <resolved>Wed, 20 Nov 2013 14:33:52 -0500</resolved>
                                    <version>8.0.0.Beta1</version>
                                    <fixVersion>8.0.0.CR1</fixVersion>
                                    <component>EJB</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                <comments>
                            <comment id="12924686" author="dmlloyd" created="Mon, 18 Nov 2013 17:53:32 -0500"  >&lt;p&gt;Using STPE for this probably isn&apos;t a great fit as it just doesn&apos;t do well with lots of cancellations.  A simple sorted fast-access queue of some sort would probably work much better.&lt;/p&gt;</comment>
                            <comment id="12924689" author="pferraro" created="Mon, 18 Nov 2013 18:09:31 -0500"  >&lt;p&gt;&lt;a href=&quot;https://issues.jboss.org/secure/ViewProfile.jspa?name=dmlloyd&quot; class=&quot;user-hover&quot; rel=&quot;dmlloyd&quot;&gt;David Lloyd&lt;/a&gt; That&apos;s a good point.  It looks like queue removal is an O(N) operation - so even setRemoveOnCancelPolicy(true) is not ideal.  I&apos;ll open a separate jira to address this.&lt;/p&gt;</comment>
                            <comment id="12924691" author="pferraro" created="Mon, 18 Nov 2013 18:21:34 -0500"  >&lt;p&gt;See: &lt;a href=&quot;https://issues.jboss.org/browse/WFLY-2534&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.jboss.org/browse/WFLY-2534&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12925015" author="jira-bugzilla-migration" created="Tue, 19 Nov 2013 12:18:59 -0500"  >&lt;p&gt;Paul Ferraro &amp;lt;paul.ferraro@redhat.com&amp;gt; made a comment on &lt;a href=&quot;https://bugzilla.redhat.com/show_bug.cgi?id=1031199&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;bug 1031199&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/jbossas/jboss-eap/pull/706&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/jbossas/jboss-eap/pull/706&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12925016" author="jira-bugzilla-migration" created="Tue, 19 Nov 2013 12:19:00 -0500"  >&lt;p&gt;Paul Ferraro &amp;lt;paul.ferraro@redhat.com&amp;gt; changed the Status of &lt;a href=&quot;https://bugzilla.redhat.com/show_bug.cgi?id=1031199&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;bug 1031199&lt;/a&gt; from NEW to POST&lt;/p&gt;</comment>
                            <comment id="12925053" author="jira-bugzilla-migration" created="Tue, 19 Nov 2013 14:20:50 -0500"  >&lt;p&gt;Aaron Ogburn &amp;lt;aogburn@redhat.com&amp;gt; made a comment on &lt;a href=&quot;https://bugzilla.redhat.com/show_bug.cgi?id=1031199&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;bug 1031199&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Hey Paul,&lt;/p&gt;


&lt;p&gt;Were you planning to add similar cancelled task removes in the NonPassivatingBackingCache&apos;s executor as well?&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Aaron&lt;/p&gt;</comment>
                            <comment id="12925372" author="jira-bugzilla-migration" created="Wed, 20 Nov 2013 10:07:13 -0500"  >&lt;p&gt;Paul Ferraro &amp;lt;paul.ferraro@redhat.com&amp;gt; made a comment on &lt;a href=&quot;https://bugzilla.redhat.com/show_bug.cgi?id=1031199&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;bug 1031199&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Good catch.  I&apos;ve updated the PR.&lt;/p&gt;</comment>
                            <comment id="12934502" author="jira-bugzilla-migration" created="Wed, 8 Jan 2014 11:05:39 -0500"  >&lt;p&gt;Kabir Khan &amp;lt;kkhan@redhat.com&amp;gt; changed the Status of &lt;a href=&quot;https://bugzilla.redhat.com/show_bug.cgi?id=1031199&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;bug 1031199&lt;/a&gt; from POST to MODIFIED&lt;/p&gt;</comment>
                            <comment id="12943727" author="jira-bugzilla-migration" created="Tue, 11 Feb 2014 18:54:11 -0500"  >&lt;p&gt;Paul Gier &amp;lt;pgier@redhat.com&amp;gt; changed the Status of &lt;a href=&quot;https://bugzilla.redhat.com/show_bug.cgi?id=1031199&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;bug 1031199&lt;/a&gt; from MODIFIED to ON_QA&lt;/p&gt;</comment>
                            <comment id="12947341" author="jira-bugzilla-migration" created="Mon, 24 Feb 2014 08:21:51 -0500"  >&lt;p&gt;Jan Martiska &amp;lt;jmartisk@redhat.com&amp;gt; changed the Status of &lt;a href=&quot;https://bugzilla.redhat.com/show_bug.cgi?id=1031199&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;bug 1031199&lt;/a&gt; from ON_QA to VERIFIED&lt;/p&gt;</comment>
                            <comment id="12980168" author="jira-bugzilla-migration" created="Sat, 28 Jun 2014 11:27:46 -0400"  >&lt;p&gt;mark yarborough &amp;lt;myarboro@redhat.com&amp;gt; changed the Status of &lt;a href=&quot;https://bugzilla.redhat.com/show_bug.cgi?id=1031199&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;bug 1031199&lt;/a&gt; from VERIFIED to CLOSED&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310440" key="org.jboss.labs.jira.plugin.jboss-custom-field-types-plugin:multiurl">
                        <customfieldname>Bugzilla References</customfieldname>
                        <customfieldvalues>
                            https://bugzilla.redhat.com/show_bug.cgi?id=1031199
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="org.jboss.labs.jira.plugin.jboss-custom-field-types-plugin:multiurl">
                        <customfieldname>Git Pull Request</customfieldname>
                        <customfieldvalues>
                            https://github.com/wildfly/wildfly/pull/5357
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12310641" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Number of attachments</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310640" key="com.atlassian.jira.toolkit:comments">
                        <customfieldname>Number of comments</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>11.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311940" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1|hzkutr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310840" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>181965</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_12310183" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Steps to Reproduce</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;1. configure long ejb timeout with the Nonpassivating or PassivatingBackingCache&lt;br/&gt;
2. put load on the ejb&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>