<!-- 
RSS generated by JIRA (7.2.3#72005-sha1:73be91d2b96fc29303a7eb6820acf420e5d0ed65) at Tue Dec 06 12:03:06 EST 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.jboss.org/si/jira.issueviews:issue-xml/WFLY-2690/WFLY-2690.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>JBoss Issue Tracker</title>
    <link>https://issues.jboss.org</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-us</language>    <build-info>
        <version>7.2.3</version>
        <build-number>72005</build-number>
        <build-date>06-10-2016</build-date>
    </build-info>

<item>
            <title>[WFLY-2690] JSP/JSPX tags don&apos;t work with Wildfly CR1</title>
                <link>https://issues.jboss.org/browse/WFLY-2690</link>
                <project id="12313721" key="WFLY">WildFly</project>
                    <description>&lt;p&gt;My app works fine on JBoss AS 7.1. When I migrate to Wildfly 8.0.0 CR1, my JSP tags don&apos;t work as expected. My project is a EAR with WAR module.&lt;/p&gt;

&lt;p&gt;When app starts, in the 1st access to page A, tag file is compiled and the page are rendered fine. But when I access another page (B in example), I got this error: org.apache.jasper.JasperException: java.lang.ClassCastException: org.apache.jsp.tag.web.default_tagx cannot be cast to org.apache.jsp.tag.web.default_tagx&lt;/p&gt;

&lt;p&gt;If I restart Wildfly and try to access page B, works fine. But when I access page A, I got the same error.&lt;/p&gt;

&lt;p&gt;My default.tagx is bellow:&lt;/p&gt;

&lt;p&gt;&amp;lt;jsp:root xmlns:jsp=&quot;http://java.sun.com/JSP/Page&quot; xmlns:html=&quot;http://www.w3.org/1999/xhtml&quot; version=&quot;2.2&quot;&amp;gt;&lt;br/&gt;
    &amp;lt;jsp:output doctype-root-element=&quot;HTML&quot; doctype-system=&quot;about:legacy-compat&quot; omit-xml-declaration=&quot;yes&quot; /&amp;gt;&lt;br/&gt;
    some code&lt;br/&gt;
    &amp;lt;jsp:doBody /&amp;gt;&lt;br/&gt;
    more code&lt;br/&gt;
&amp;lt;/jsp:root&amp;gt;&lt;/p&gt;

&lt;p&gt;And the pages are somethink like this:&lt;/p&gt;

&lt;p&gt;&amp;lt;tags:default xmlns:tags=&quot;urn:jsptagdir:/WEB-INF/tags&quot; xmlns:jsp=&quot;http://java.sun.com/JSP/Page&quot; xmlns:html=&quot;http://www.w3.org/1999/xhtml&quot;&amp;gt;&lt;br/&gt;
    &amp;lt;jsp:output omit-xml-declaration=&quot;yes&quot; /&amp;gt;&lt;br/&gt;
    my code here&lt;br/&gt;
&amp;lt;/tags:default&amp;gt;&lt;/p&gt;

&lt;p&gt;I was created a new empty project with two pages and one tagfile. The error don&apos;t occurs. But when I add CDI capabilities, the error occurs. There are something in CDI that confuses Jastow?&lt;/p&gt;

&lt;p&gt;As discussed here: &lt;a href=&quot;https://community.jboss.org/message/850730&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://community.jboss.org/message/850730&lt;/a&gt;&lt;/p&gt;</description>
                <environment>&lt;p&gt;OpenJDK Runtime Environment (fedora-2.4.3.0.fc18-x86_64 u45-b15)&lt;br/&gt;
OpenJDK 64-Bit Server VM (build 24.45-b08, mixed mode)&lt;/p&gt;</environment>
        <key id="12528434">WFLY-2690</key>
            <summary>JSP/JSPX tags don&apos;t work with Wildfly CR1</summary>
                <type id="1" iconUrl="https://issues.jboss.org/secure/viewavatar?size=xsmall&amp;avatarId=13263&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.jboss.org/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.jboss.org/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Done</resolution>
                                        <assignee username="jharting">Jozef Hartinger</assignee>
                                    <reporter username="garcia-jj">Ot&#225;vio Garcia</reporter>
                        <labels>
                    </labels>
                <created>Thu, 26 Dec 2013 19:55:45 -0500</created>
                <updated>Fri, 26 Aug 2016 05:29:38 -0400</updated>
                            <resolved>Wed, 8 Jan 2014 06:11:57 -0500</resolved>
                                    <version>8.0.0.CR1</version>
                                    <fixVersion>8.0.0.Final</fixVersion>
                                    <component>Web (Undertow)</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>5</watches>
                                                                <comments>
                            <comment id="12933584" author="swd847" created="Fri, 3 Jan 2014 08:06:30 -0500"  >&lt;p&gt;Do you have a reproducer? &lt;/p&gt;

&lt;p&gt;I am pretty sure this is a weld issue, but it should be possible for me to work around it, however it would be easier if you have a ready made reproducer I can test out. &lt;/p&gt;</comment>
                            <comment id="12933604" author="backslash47" created="Fri, 3 Jan 2014 10:10:10 -0500"  >&lt;p&gt;Hello,&lt;br/&gt;
I have one (will upload it shortly). It really is a problem of weld. I went a little bit deeper and even find the problem. The problem is in &lt;br/&gt;
&lt;a href=&quot;https://github.com/weld/core/blob/master/impl/src/main/java/org/jboss/weld/annotated/slim/AnnotatedTypeIdentifier.java&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;org.jboss.weld.annotated.slim.AnnotatedTypeIdentifier &lt;/a&gt;. Deep down it is used as a key in caching Annotated types and as you can see from sources of this class, it uses only className (and other attributes) to distinguish between classes. But Wildfly uses different class loaders for every JSP (and included tags). &lt;/p&gt;

&lt;p&gt;The problem manifests as casting exception from class A1 to class A2 (where A1 and A2 have the same class name but are loaded with different classloaders).&lt;/p&gt;

&lt;p&gt;I rewrote AnnotatedTypeIdentifier so it uses the class object instead of className and it looks promising (no exceptions). But I am not a weld developer, and don&apos;t really know if it wont have any other consequences.&lt;/p&gt;</comment>
                            <comment id="12933617" author="swd847" created="Fri, 3 Jan 2014 11:25:39 -0500"  >&lt;p&gt;Jozef, any chance that you could have a look at this? Basically this issue is that Jasper creates multiple classes with the same name but different class loaders, and Weld can&apos;t really handle it (see the earlier comment about the underlying cause). &lt;/p&gt;</comment>
                            <comment id="12933636" author="backslash47" created="Fri, 3 Jan 2014 12:26:48 -0500"  >&lt;p&gt;Here is the reproducer. Its a simple web app, not a test case (sorry for that). &lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/backslash47/wfly2690.git&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/backslash47/wfly2690.git&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To reproduce the error, try &lt;a href=&quot;http://localhost:8080/wfly2690/index.jsp&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://localhost:8080/wfly2690/index.jsp&lt;/a&gt; and then &lt;a href=&quot;http://localhost:8080/wfly2690/index2.jsp&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://localhost:8080/wfly2690/index2.jsp&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;As of the possible fix I propose, please, look at this &lt;a href=&quot;https://github.com/backslash47/core/commit/22005cb9b9f561949f8490286c28b88ad3d9ca64&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;Commit &lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12933683" author="garcia-jj" created="Fri, 3 Jan 2014 21:03:46 -0500"  >&lt;p&gt; Matus Zamborsky, I&apos;ve tested with your commit from github, and works fine for me.&lt;/p&gt;</comment>
                            <comment id="12933789" author="jharting" created="Mon, 6 Jan 2014 08:14:53 -0500"  >&lt;p&gt;The proposed commit breaks the Identifier contract. We&apos;ll have to use a different solution.&lt;/p&gt;</comment>
                            <comment id="12934143" author="backslash47" created="Tue, 7 Jan 2014 08:29:02 -0500"  >&lt;p&gt;Jozef, do you mean, that the method asString() from Identiefier should be unique for every type ? Or there is something else which should be taken care of. If it&apos;s the first option, we can add Integer.toHexString(System.identityHashCode(clazz)) to the identifier string. &lt;/p&gt;

&lt;p&gt;The problem is that Integer.toHexString(System.identityHashCode(clazz)) does not necessary need to be unique by java spec. Another, slightly more complicated solution will be to use a static Map from Class object to unique generated identifier. As a source we can use static Long number incremented and returned in synchronized method, so every invocation will return new unique number. Even better, if we use the classloader of the clazz as there can&apos;t be two classes with same name in one classloader.&lt;/p&gt;</comment>
                            <comment id="12934185" author="jharting" created="Tue, 7 Jan 2014 10:21:47 -0500"  >&lt;p&gt;Two Identifiers may only be equal only if their asString() results are equal. In addition, the ID has to be deterministic - each node of a cluster has to use the same id for a given type.&lt;/p&gt;</comment>
                            <comment id="12934307" author="backslash47" created="Tue, 7 Jan 2014 15:28:28 -0500"  >&lt;p&gt;In that case, I don&apos;t see a way how to make the ID deterministic, because the class is loaded by class loader dynamically created during JSP loading. Only deterministic and distinct information is the jsp name, but I have no idea how it will be possible to pass this information down to weld and still don&apos;t make weld dependent on this specific class loader.&lt;/p&gt;

&lt;p&gt;Does anybody know, how this problem was solved in AS 7 ?&lt;/p&gt;</comment>
                            <comment id="12934349" author="jharting" created="Wed, 8 Jan 2014 01:16:28 -0500"  >&lt;p&gt;We can sacrifice deterministic IDs for InjectionTargets of JSP components, since these will never be passivated. However, we cannot do this globally in Weld&apos;s AnnotatedTypeIdentifier since that would affect all component types including contextual ones. See the PR.&lt;/p&gt;

&lt;p&gt;AFAIK in AS7 this approach of using multiple classloaders to load a single class was not used and therefore the problem did not occur.&lt;/p&gt;</comment>
                            <comment id="12937310" author="garcia-jj" created="Mon, 20 Jan 2014 15:26:36 -0500"  >&lt;p&gt;Any news about this issues?&lt;/p&gt;</comment>
                            <comment id="12937312" author="jharting" created="Mon, 20 Jan 2014 15:29:56 -0500"  >&lt;p&gt;It was resolved. You can use a nightly build or wait for Final.&lt;/p&gt;</comment>
                            <comment id="12937316" author="garcia-jj" created="Mon, 20 Jan 2014 15:33:16 -0500"  >&lt;p&gt; Jozef, thank you. I can compile from github. It&apos;s on weld repository?&lt;/p&gt;</comment>
                            <comment id="12937317" author="garcia-jj" created="Mon, 20 Jan 2014 15:35:47 -0500"  >&lt;p&gt;Oh, now I see the commit. Thank you.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310001">
                    <name>Related</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12592302">WELD-2062</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310010" key="org.jboss.labs.jira.plugin.jboss-custom-field-types-plugin:multiurl">
                        <customfieldname>Forum Reference</customfieldname>
                        <customfieldvalues>
                            https://community.jboss.org/message/850730
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310220" key="org.jboss.labs.jira.plugin.jboss-custom-field-types-plugin:multiurl">
                        <customfieldname>Git Pull Request</customfieldname>
                        <customfieldvalues>
                            https://github.com/wildfly/wildfly/pull/5670
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12310641" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Number of attachments</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310640" key="com.atlassian.jira.toolkit:comments">
                        <customfieldname>Number of comments</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>14.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311940" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1|hzlmmn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310840" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>186451</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>