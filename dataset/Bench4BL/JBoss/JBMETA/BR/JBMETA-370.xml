<!-- 
RSS generated by JIRA (7.2.3#72005-sha1:73be91d2b96fc29303a7eb6820acf420e5d0ed65) at Thu Dec 08 11:35:32 EST 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.jboss.org/si/jira.issueviews:issue-xml/JBMETA-370/JBMETA-370.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>JBoss Issue Tracker</title>
    <link>https://issues.jboss.org</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-us</language>    <build-info>
        <version>7.2.3</version>
        <build-number>72005</build-number>
        <build-date>06-10-2016</build-date>
    </build-info>

<item>
            <title>[JBMETA-370] Deployment of a war with 2 web-fragments both containing ejb-local-refs fails</title>
                <link>https://issues.jboss.org/browse/JBMETA-370</link>
                <project id="12310511" key="JBMETA">JBoss Metadata</project>
                    <description>&lt;p&gt;When trying to deploy a WAR containing two web-fragments both containing ejb-local-refs the deployment fails with this error message:&lt;/p&gt;

&lt;p&gt;17:54:24,669 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;org.jboss.as.server.deployment&amp;#93;&lt;/span&gt; (MSC service thread 1-5) JBAS015876: Starting deployment of &quot;testear.ear&quot; (runtime-name: &quot;testear.ear&quot;)&lt;br/&gt;
17:54:24,815 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;org.jboss.as.server.deployment&amp;#93;&lt;/span&gt; (MSC service thread 1-4) JBAS015876: Starting deployment of &quot;null&quot; (runtime-name: &quot;testwar.war&quot;)&lt;br/&gt;
17:54:24,815 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;org.jboss.as.server.deployment&amp;#93;&lt;/span&gt; (MSC service thread 1-2) JBAS015876: Starting deployment of &quot;null&quot; (runtime-name: &quot;ejbjar.jar&quot;)&lt;br/&gt;
17:55:55,538 ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;org.jboss.msc.service.fail&amp;#93;&lt;/span&gt; (MSC service thread 1-1) MSC000001: Failed to start service jboss.deployment.subunit.&quot;testear.ear&quot;.&quot;testwar.war&quot;.PARSE: org.jboss.msc.service.StartExcep&lt;br/&gt;
tion in service jboss.deployment.subunit.&quot;testear.ear&quot;.&quot;testwar.war&quot;.PARSE: JBAS018733: Failed to process phase PARSE of subdeployment &quot;testwar.war&quot; of deployment &quot;testear.ear&quot;&lt;br/&gt;
        at org.jboss.as.server.deployment.DeploymentUnitPhaseService.start(DeploymentUnitPhaseService.java:166) &lt;span class=&quot;error&quot;&gt;&amp;#91;wildfly-server-8.0.0.Final-SNAPSHOT.jar:8.0.0.Final-SNAPSHOT&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at org.jboss.msc.service.ServiceControllerImpl$StartTask.startService(ServiceControllerImpl.java:1948) &lt;span class=&quot;error&quot;&gt;&amp;#91;jboss-msc-1.2.0.CR1.jar:1.2.0.CR1&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at org.jboss.msc.service.ServiceControllerImpl$StartTask.run(ServiceControllerImpl.java:1881) &lt;span class=&quot;error&quot;&gt;&amp;#91;jboss-msc-1.2.0.CR1.jar:1.2.0.CR1&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145) &lt;span class=&quot;error&quot;&gt;&amp;#91;rt.jar:1.7.0_45&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615) &lt;span class=&quot;error&quot;&gt;&amp;#91;rt.jar:1.7.0_45&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at java.lang.Thread.run(Thread.java:744) &lt;span class=&quot;error&quot;&gt;&amp;#91;rt.jar:1.7.0_45&amp;#93;&lt;/span&gt;&lt;br/&gt;
Caused by: org.jboss.as.server.deployment.DeploymentUnitProcessingException: JBAS017318: Conflict occurred processing web fragment in JAR: fragment2.jar&lt;br/&gt;
        at org.wildfly.extension.undertow.deployment.WarMetaDataProcessor.deploy(WarMetaDataProcessor.java:294)&lt;br/&gt;
        at org.jboss.as.server.deployment.DeploymentUnitPhaseService.start(DeploymentUnitPhaseService.java:159) &lt;span class=&quot;error&quot;&gt;&amp;#91;wildfly-server-8.0.0.Final-SNAPSHOT.jar:8.0.0.Final-SNAPSHOT&amp;#93;&lt;/span&gt;&lt;br/&gt;
        ... 5 more&lt;br/&gt;
Caused by: java.lang.IllegalArgumentException: Null administeredObjects&lt;br/&gt;
        at org.jboss.metadata.javaee.spec.RemoteEnvironmentRefsGroupMetaData.setAdministeredObjects(RemoteEnvironmentRefsGroupMetaData.java:431)&lt;br/&gt;
        at org.jboss.metadata.merge.javaee.spec.RemoteEnvironmentRefsGroupMetaDataMerger.augment(RemoteEnvironmentRefsGroupMetaDataMerger.java:337)&lt;br/&gt;
        at org.jboss.metadata.merge.javaee.spec.EnvironmentRefsGroupMetaDataMerger.augment(EnvironmentRefsGroupMetaDataMerger.java:71)&lt;br/&gt;
        at org.jboss.metadata.merge.web.spec.WebCommonMetaDataMerger.augment(WebCommonMetaDataMerger.java:383)&lt;br/&gt;
        at org.wildfly.extension.undertow.deployment.WarMetaDataProcessor.deploy(WarMetaDataProcessor.java:292)&lt;br/&gt;
        ... 6 more&lt;/p&gt;

&lt;p&gt;17:55:55,621 ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;org.jboss.as.controller.management-operation&amp;#93;&lt;/span&gt; (DeploymentScanner-threads - 2) JBAS014613: Operation (&quot;deploy&quot;) failed - address: (&lt;span class=&quot;error&quot;&gt;&amp;#91;(&amp;quot;deployment&amp;quot; =&amp;gt; &amp;quot;testear.ear&amp;quot;)&amp;#93;&lt;/span&gt;) - failure descr&lt;br/&gt;
iption: {&quot;JBAS014671: Failed services&quot; =&amp;gt; {&quot;jboss.deployment.subunit.\&quot;testear.ear\&quot;.\&quot;testwar.war\&quot;.PARSE&quot; =&amp;gt; &quot;org.jboss.msc.service.StartException in service jboss.deployment.subunit.\&quot;testear.ear\&quot;&lt;br/&gt;
.\&quot;testwar.war\&quot;.PARSE: JBAS018733: Failed to process phase PARSE of subdeployment \&quot;testwar.war\&quot; of deployment \&quot;testear.ear\&quot;&lt;br/&gt;
    Caused by: org.jboss.as.server.deployment.DeploymentUnitProcessingException: JBAS017318: Conflict occurred processing web fragment in JAR: fragment2.jar&lt;br/&gt;
    Caused by: java.lang.IllegalArgumentException: Null administeredObjects&quot;}}&lt;br/&gt;
17:55:55,881 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;org.jboss.as.server&amp;#93;&lt;/span&gt; (DeploymentScanner-threads - 2) JBAS018559: Deployed &quot;testear.ear&quot; (runtime-name : &quot;testear.ear&quot;)&lt;br/&gt;
17:55:55,882 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;org.jboss.as.controller&amp;#93;&lt;/span&gt; (DeploymentScanner-threads - 2) JBAS014774: Service status report&lt;br/&gt;
JBAS014777:   Services which failed to start:      service jboss.deployment.subunit.&quot;testear.ear&quot;.&quot;testwar.war&quot;.PARSE: org.jboss.msc.service.StartException in service jboss.deployment.subunit.&quot;testear&lt;br/&gt;
.ear&quot;.&quot;testwar.war&quot;.PARSE: JBAS018733: Failed to process phase PARSE of subdeployment &quot;testwar.war&quot; of deployment &quot;testear.ear&quot;&lt;/p&gt;

&lt;p&gt;There seems to be an error in the class RemoteEnvironmentRefsGroupMetaDataMerger because it calls dest.setAdministeredObjects() during augmentation even if the fragment does not contain administered objects (but entries in the ENC so that the merger is called.)&lt;/p&gt;

&lt;p&gt;I created a test application that shows the problem. You can find it at &lt;a href=&quot;https://github.com/robertpanzer/webfragmenttest.git&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/robertpanzer/webfragmenttest.git&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I can also provide a PR.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Win7, Oracle JDK 1.7.0_45, Wildfly 8.0.0-CR1&lt;/p&gt;</environment>
        <key id="12528756">JBMETA-370</key>
            <summary>Deployment of a war with 2 web-fragments both containing ejb-local-refs fails</summary>
                <type id="1" iconUrl="https://issues.jboss.org/secure/viewavatar?size=xsmall&amp;avatarId=13263&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.jboss.org/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.jboss.org/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Done</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="Robert.Panzer">Robert Panzer</reporter>
                        <labels>
                    </labels>
                <created>Tue, 7 Jan 2014 12:12:39 -0500</created>
                <updated>Mon, 27 Jan 2014 11:53:22 -0500</updated>
                            <resolved>Mon, 27 Jan 2014 11:53:22 -0500</resolved>
                                                    <fixVersion>8.0.0.CR1</fixVersion>
                                    <component>common</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="12934352" author="robert.panzer" created="Wed, 8 Jan 2014 02:45:45 -0500"  >&lt;p&gt;The affected version is metadata 8.0.0.Beta5.&lt;br/&gt;
Unfortunately I cannot select that in the form.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310220" key="org.jboss.labs.jira.plugin.jboss-custom-field-types-plugin:multiurl">
                        <customfieldname>Git Pull Request</customfieldname>
                        <customfieldvalues>
                            https://github.com/jboss/metadata/pull/56
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12310641" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Number of attachments</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310640" key="com.atlassian.jira.toolkit:comments">
                        <customfieldname>Number of comments</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311940" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1|hzlp3b:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310840" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>186852</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310183" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Steps to Reproduce</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;Build the ear at &lt;a href=&quot;https://github.com/robertpanzer/webfragmenttest.git&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/robertpanzer/webfragmenttest.git&lt;/a&gt; using gradle :testear:ear&lt;br/&gt;
The error occurs during deployment of that ear.&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>