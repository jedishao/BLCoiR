<!-- 
RSS generated by JIRA (7.2.3#72005-sha1:73be91d2b96fc29303a7eb6820acf420e5d0ed65) at Mon Dec 12 15:05:14 EST 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.jboss.org/si/jira.issueviews:issue-xml/ENTESB-3809/ENTESB-3809.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>JBoss Issue Tracker</title>
    <link>https://issues.jboss.org</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-us</language>    <build-info>
        <version>7.2.3</version>
        <build-number>72005</build-number>
        <build-date>06-10-2016</build-date>
    </build-info>

<item>
            <title>[ENTESB-3809] New deployment of another SwitchYard application disables ExchangeInterceptors</title>
                <link>https://issues.jboss.org/browse/ENTESB-3809</link>
                <project id="12314570" key="ENTESB">JBoss Fuse</project>
                    <description>&lt;p&gt;Product JIRA for &lt;a href=&quot;https://issues.jboss.org/browse/SWITCHYARD-2775&quot; title=&quot;New deployment of another SwitchYard application disables ExchangeInterceptors&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SWITCHYARD-2775&quot;&gt;&lt;del&gt;SWITCHYARD-2775&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Suppose we have two SwitchYard applications, &lt;tt&gt;switchyard-example1&lt;/tt&gt; and &lt;tt&gt;switchyard-example2&lt;/tt&gt;. &lt;tt&gt;switchyard-example1&lt;/tt&gt; (consumer) invokes &lt;tt&gt;switchyard-example2&lt;/tt&gt; (provider) via SCA binding. &lt;tt&gt;switchyard-example2&lt;/tt&gt; has an exchange intercepter &lt;tt&gt;SimpleInterceptor&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;When we deploy &lt;tt&gt;switchyard-example2&lt;/tt&gt; and &lt;tt&gt;switchyard-example1&lt;/tt&gt; in sequence, &lt;tt&gt;SimpleInterceptor&lt;/tt&gt; doesn&apos;t work. The log shows:&lt;/p&gt;
&lt;p/&gt;
&lt;div id=&quot;syntaxplugin&quot; class=&quot;syntaxplugin&quot; style=&quot;border: 1px dashed #bbb; border-radius: 5px !important; overflow: auto; max-height: 30em;&quot;&gt;
&lt;table cellspacing=&quot;0&quot; cellpadding=&quot;0&quot; border=&quot;0&quot; width=&quot;100%&quot; style=&quot;font-size: 1em; line-height: 1.4em !important; font-weight: normal; font-style: normal; color: black;&quot;&gt;
		&lt;tbody &gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;  margin-top: 10px;   width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;[example1.ConsumerServiceBean] ============================================================&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;[example2.ProviderServiceBean] Received: ConsumerServiceBean&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;[example1.ConsumerServiceBean] Hello, ConsumerServiceBean!&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   margin-bottom: 10px;  width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;[example1.ConsumerServiceBean] ============================================================&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
			&lt;/tbody&gt;
&lt;/table&gt;
&lt;/div&gt;
&lt;p/&gt;
&lt;p&gt;Then redeploying &lt;tt&gt;switchyard-example2&lt;/tt&gt; alone, we see it starts to work:&lt;/p&gt;
&lt;p/&gt;
&lt;div id=&quot;syntaxplugin&quot; class=&quot;syntaxplugin&quot; style=&quot;border: 1px dashed #bbb; border-radius: 5px !important; overflow: auto; max-height: 30em;&quot;&gt;
&lt;table cellspacing=&quot;0&quot; cellpadding=&quot;0&quot; border=&quot;0&quot; width=&quot;100%&quot; style=&quot;font-size: 1em; line-height: 1.4em !important; font-weight: normal; font-style: normal; color: black;&quot;&gt;
		&lt;tbody &gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;  margin-top: 10px;   width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;[example1.ConsumerServiceBean] ============================================================&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;[example2.SimpleInterceptor] ***** Before: ProviderService -&amp;gt; ProviderService&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;[example2.ProviderServiceBean] Received: ConsumerServiceBean&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;[example2.SimpleInterceptor] ***** After:  ProviderService &amp;lt;- ProviderService&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;[example1.ConsumerServiceBean] Hello, ConsumerServiceBean!&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   margin-bottom: 10px;  width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;[example1.ConsumerServiceBean] ============================================================&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
			&lt;/tbody&gt;
&lt;/table&gt;
&lt;/div&gt;
&lt;p/&gt;
&lt;p&gt;But then redeploying &lt;tt&gt;switchyard-example1&lt;/tt&gt; alone this time, we now see it disabled again:&lt;/p&gt;
&lt;p/&gt;
&lt;div id=&quot;syntaxplugin&quot; class=&quot;syntaxplugin&quot; style=&quot;border: 1px dashed #bbb; border-radius: 5px !important; overflow: auto; max-height: 30em;&quot;&gt;
&lt;table cellspacing=&quot;0&quot; cellpadding=&quot;0&quot; border=&quot;0&quot; width=&quot;100%&quot; style=&quot;font-size: 1em; line-height: 1.4em !important; font-weight: normal; font-style: normal; color: black;&quot;&gt;
		&lt;tbody &gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;  margin-top: 10px;   width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;[example1.ConsumerServiceBean] ============================================================&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;[example2.ProviderServiceBean] Received: ConsumerServiceBean&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;[example1.ConsumerServiceBean] Hello, ConsumerServiceBean!&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   margin-bottom: 10px;  width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;[example1.ConsumerServiceBean] ============================================================&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
			&lt;/tbody&gt;
&lt;/table&gt;
&lt;/div&gt;
&lt;p/&gt;

&lt;p&gt;Interestingly, if we redeploy &lt;tt&gt;switchyard-example1&lt;/tt&gt; but invoke &lt;tt&gt;switchyard-example2&lt;/tt&gt; in some other way (e.g. remote client invocation using &lt;tt&gt;HttpInvoker&lt;/tt&gt;) before &lt;tt&gt;switchyard-example1&lt;/tt&gt; starts to invoke &lt;tt&gt;switchyard-example2&lt;/tt&gt;, the interceptor remains working.&lt;/p&gt;

&lt;p&gt;This observation makes me suspect that a local SCA invocation from a newly deployed application somehow overrides the bean registry with its thread local context.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12580824">ENTESB-3809</key>
            <summary>New deployment of another SwitchYard application disables ExchangeInterceptors</summary>
                <type id="1" iconUrl="https://issues.jboss.org/secure/viewavatar?size=xsmall&amp;avatarId=13263&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.jboss.org/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.jboss.org/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Done</resolution>
                                        <assignee username="virchete">David virgil naranjo</assignee>
                                    <reporter username="tadayosi">Tadayoshi Sato</reporter>
                        <labels>
                    </labels>
                <created>Tue, 11 Aug 2015 06:42:00 -0400</created>
                <updated>Wed, 27 Jan 2016 07:15:42 -0500</updated>
                            <resolved>Tue, 15 Sep 2015 03:42:47 -0400</resolved>
                                    <version>jboss-fuse-6.2.1</version>
                                    <fixVersion>jboss-fuse-6.2.1</fixVersion>
                                    <component>SwitchYard</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                <comments>
                            <comment id="13106198" author="virchete" created="Tue, 8 Sep 2015 05:06:48 -0400"  >&lt;p&gt;I found something weird. &lt;/p&gt;

&lt;p&gt;These 2 applications create 2 different camel-context. &lt;/p&gt;

&lt;p&gt;Then the interceptor processor is launched for both threads:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/dvirgiln/switchyard/blob/2.x.redhat-6-2-x-patch/core/bus/camel/src/main/java/org/switchyard/bus/camel/processors/InterceptProcessor.java#L91&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/dvirgiln/switchyard/blob/2.x.redhat-6-2-x-patch/core/bus/camel/src/main/java/org/switchyard/bus/camel/processors/InterceptProcessor.java#L91&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I could see that the different exchange with different camel context were executed. Then this line will go to the CDIRegistry. For each CamelContext a different CDIRegistry is created. This is good.&lt;/p&gt;

&lt;p&gt;Then we go to the following line:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/camel/blob/camel-2.15.2/components/camel-cdi/src/main/java/org/apache/camel/cdi/CdiBeanRegistry.java#L60&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/apache/camel/blob/camel-2.15.2/components/camel-cdi/src/main/java/org/apache/camel/cdi/CdiBeanRegistry.java#L60&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Here it is the problem. When we are in the camel-context of Switchyard-Example-2 (the one that contains the interceptor), it returns an empty list. We need to dig into the deltaspike-core-api jar. &lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/deltaspike/blob/deltaspike-project-1.2.1/deltaspike/core/api/src/main/java/org/apache/deltaspike/core/api/provider/BeanProvider.java#L385&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/apache/deltaspike/blob/deltaspike-project-1.2.1/deltaspike/core/api/src/main/java/org/apache/deltaspike/core/api/provider/BeanProvider.java#L385&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Then it gets the instance:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/deltaspike/blob/deltaspike-project-1.2.1/deltaspike/core/api/src/main/java/org/apache/deltaspike/core/api/provider/BeanManagerProvider.java#L168&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/apache/deltaspike/blob/deltaspike-project-1.2.1/deltaspike/core/api/src/main/java/org/apache/deltaspike/core/api/provider/BeanManagerProvider.java#L168&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The value of this instance is:&lt;/p&gt;
{ModuleClassLoader for Module &quot;deployment.switchyard-example1-2.0.1-redhat-SNAPSHOT.jar:main&quot; from Service Module Loader=org.apache.deltaspike.core.api.provider.BeanManagerProvider$BeanManagerInfo@5efd2442, ModuleClassLoader for Module &quot;deployment.switchyard-example2-2.0.1-redhat-SNAPSHOT.jar:main&quot; from Service Module Loader=org.apache.deltaspike.core.api.provider.BeanManagerProvider$BeanManagerInfo@3d5799c6, sun.misc.Launcher$AppClassLoader@45a27a8f=org.apache.deltaspike.core.api.provider.BeanManagerProvider$BeanManagerInfo@be43d53}
&lt;p&gt;As we see we have 2 values: one for switchyard-example2-2.0.1-redhat-SNAPSHOT.jar and one for switchyard-example1-2.0.1-redhat-SNAPSHOT.jar&lt;/p&gt;

&lt;p&gt;Then it takes the BeanManager from the current classpath:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/deltaspike/blob/deltaspike-project-1.2.1/deltaspike/core/api/src/main/java/org/apache/deltaspike/core/api/provider/BeanManagerProvider.java#L197&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/apache/deltaspike/blob/deltaspike-project-1.2.1/deltaspike/core/api/src/main/java/org/apache/deltaspike/core/api/provider/BeanManagerProvider.java#L197&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;In the Switchyard-Example-2 (SimpleInterceptor) it takes correctly the org.apache.deltaspike.core.api.provider.BeanManagerProvider$BeanManagerInfo@3d5799c6, that is the one associated in the map. &lt;/p&gt;

&lt;p&gt;But for my surprise when I inspect this bean, the property finalBMI:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/deltaspike/blob/deltaspike-project-1.2.1/deltaspike/core/api/src/main/java/org/apache/deltaspike/core/api/provider/BeanManagerProvider.java#L219&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/apache/deltaspike/blob/deltaspike-project-1.2.1/deltaspike/core/api/src/main/java/org/apache/deltaspike/core/api/provider/BeanManagerProvider.java#L219&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Manager switchyard-example1-2.0.1-redhat-SNAPSHOT.jar/&lt;br/&gt;
Enabled alternatives: [] []&lt;br/&gt;
Registered contexts: &lt;span class=&quot;error&quot;&gt;&amp;#91;interface javax.enterprise.context.SessionScoped, interface javax.enterprise.context.ApplicationScoped, interface javax.enterprise.context.RequestScoped, interface javax.enterprise.context.ConversationScoped, interface javax.inject.Singleton, interface javax.enterprise.context.Dependent&amp;#93;&lt;/span&gt;&lt;br/&gt;
Registered beans: 22&lt;/p&gt;</comment>
                            <comment id="13106272" author="virchete" created="Tue, 8 Sep 2015 07:10:50 -0400"  >&lt;p&gt;I discovered what happened. &lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/deltaspike/blob/deltaspike-project-1.2.1/deltaspike/core/api/src/main/java/org/apache/deltaspike/core/api/provider/BeanManagerProvider.java&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/apache/deltaspike/blob/deltaspike-project-1.2.1/deltaspike/core/api/src/main/java/org/apache/deltaspike/core/api/provider/BeanManagerProvider.java&lt;/a&gt; &lt;/p&gt;

&lt;p&gt;This class uses a Map having as key the classloader and as value a BeanManagerInfo that contains the BeanManager.&lt;/p&gt;

&lt;p&gt;When SwitchyardExample2 is deployed, then this beanManager is set correctly. The BeanManagerInfo.finalBm contains a value.&lt;/p&gt;

&lt;p&gt;When SwitchyarExample1 is deployed then a call to this method is done:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/deltaspike/blob/deltaspike-project-1.2.1/deltaspike/core/api/src/main/java/org/apache/deltaspike/core/api/provider/BeanManagerProvider.java#L274&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/apache/deltaspike/blob/deltaspike-project-1.2.1/deltaspike/core/api/src/main/java/org/apache/deltaspike/core/api/provider/BeanManagerProvider.java#L274&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Then the SwitchyardExample2 BeanManager is set to null. &lt;/p&gt;

&lt;p&gt;Then when the &lt;br/&gt;
&lt;a href=&quot;https://github.com/dvirgiln/switchyard/blob/2.x.redhat-6-2-x-patch/core/bus/camel/src/main/java/org/switchyard/bus/camel/processors/InterceptProcessor.java#L91&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/dvirgiln/switchyard/blob/2.x.redhat-6-2-x-patch/core/bus/camel/src/main/java/org/switchyard/bus/camel/processors/InterceptProcessor.java#L91&lt;/a&gt; &lt;br/&gt;
is executed for the Exchange of the SwitchyardExample2 it goes to take the BeanManager, but the value is null, so it retrieves it throw jndi:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/deltaspike/blob/deltaspike-project-1.2.1/deltaspike/core/api/src/main/java/org/apache/deltaspike/core/api/provider/BeanManagerProvider.java#L229&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/apache/deltaspike/blob/deltaspike-project-1.2.1/deltaspike/core/api/src/main/java/org/apache/deltaspike/core/api/provider/BeanManagerProvider.java#L229&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This then set the BeanManager of SwitchyardExample1 in the Swithcyard-example2 class loader!!!!&lt;/p&gt;

&lt;p&gt;In my opinion the problem is the cleanup done. This makes the BeanManager to be set as null.&lt;/p&gt;
</comment>
                            <comment id="13109456" author="tcunning" created="Wed, 16 Sep 2015 12:49:46 -0400"  >&lt;p&gt;Verifiable in 6.2.1 ER4.&lt;/p&gt;</comment>
                            <comment id="13154375" author="tturek" created="Wed, 27 Jan 2016 07:15:42 -0500"  >&lt;p&gt;Verified in 6.2.1 build 621084&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310120">
                    <name>Cloners</name>
                                            <outwardlinks description="cloned from">
                                        <issuelink>
            <issuekey id="12580811">SWITCHYARD-2775</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="cloned to">
                                        <issuelink>
            <issuekey id="12580828">ENTESB-3811</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12391612" name="reproducer.zip" size="17506" author="tadayosi" created="Tue, 11 Aug 2015 06:43:02 -0400"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310220" key="org.jboss.labs.jira.plugin.jboss-custom-field-types-plugin:multiurl">
                        <customfieldname>Git Pull Request</customfieldname>
                        <customfieldvalues>
                            https://github.com/jboss-fuse/switchyard/pull/56, https://github.com/jboss-switchyard/switchyard/pull/32
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12310641" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Number of attachments</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310640" key="com.atlassian.jira.toolkit:comments">
                        <customfieldname>Number of comments</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311940" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1|hzxwkn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310840" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310183" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Steps to Reproduce</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;ol&gt;
	&lt;li&gt;Deploy &lt;tt&gt;switchyard-example2&lt;/tt&gt; and {{&lt;tt&gt;switchyard-example1&lt;/tt&gt; in sequence:
&lt;p/&gt;
&lt;div id=&quot;syntaxplugin&quot; class=&quot;syntaxplugin&quot; style=&quot;border: 1px dashed #bbb; border-radius: 5px !important; overflow: auto; max-height: 30em;&quot;&gt;
&lt;table cellspacing=&quot;0&quot; cellpadding=&quot;0&quot; border=&quot;0&quot; width=&quot;100%&quot; style=&quot;font-size: 1em; line-height: 1.4em !important; font-weight: normal; font-style: normal; color: black;&quot;&gt;
		&lt;tbody &gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;  margin-top: 10px;   width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;$ cd switchyard-example2/&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;$ mvn jboss-as:deploy&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;$ cd ../switchyard-example1/&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   margin-bottom: 10px;  width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;$ mvn jboss-as:deploy&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
			&lt;/tbody&gt;
&lt;/table&gt;
&lt;/div&gt;
&lt;p/&gt;
&lt;p&gt;  You&apos;ll see the interceptor not working.&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;Redeploy &lt;tt&gt;switchyard-example2&lt;/tt&gt; alone. You&apos;ll see the interceptor starts working.&lt;/li&gt;
	&lt;li&gt;Then redeploy &lt;tt&gt;switchyard-example1&lt;/tt&gt; alone. You&apos;ll see the interceptor disabled again.&lt;/li&gt;
	&lt;li&gt;Redeploy &lt;tt&gt;switchyard-example2&lt;/tt&gt; and &lt;tt&gt;switchyard-example1&lt;/tt&gt; in sequence again, but before &lt;tt&gt;switchyard-example1&lt;/tt&gt; starts to invoke &lt;tt&gt;switchyard-example2&lt;/tt&gt; run the following command under &lt;tt&gt;switchyard-example2&lt;/tt&gt;:
&lt;p/&gt;
&lt;div id=&quot;syntaxplugin&quot; class=&quot;syntaxplugin&quot; style=&quot;border: 1px dashed #bbb; border-radius: 5px !important; overflow: auto; max-height: 30em;&quot;&gt;
&lt;table cellspacing=&quot;0&quot; cellpadding=&quot;0&quot; border=&quot;0&quot; width=&quot;100%&quot; style=&quot;font-size: 1em; line-height: 1.4em !important; font-weight: normal; font-style: normal; color: black;&quot;&gt;
		&lt;tbody &gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;  margin-top: 10px;   width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;$ cd switchyard-example2/&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   margin-bottom: 10px;  width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;$ mvn exec:java&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
			&lt;/tbody&gt;
&lt;/table&gt;
&lt;/div&gt;
&lt;p/&gt;
&lt;p&gt;  Then you&apos;ll see the interceptor remains working.&lt;/p&gt;&lt;/li&gt;
&lt;/ol&gt;
</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12310080" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Tester</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>tturek</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>