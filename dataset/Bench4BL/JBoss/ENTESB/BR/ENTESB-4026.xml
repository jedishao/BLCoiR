<!-- 
RSS generated by JIRA (7.2.3#72005-sha1:73be91d2b96fc29303a7eb6820acf420e5d0ed65) at Mon Dec 12 15:36:32 EST 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.jboss.org/si/jira.issueviews:issue-xml/ENTESB-4026/ENTESB-4026.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>JBoss Issue Tracker</title>
    <link>https://issues.jboss.org</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-us</language>    <build-info>
        <version>7.2.3</version>
        <build-number>72005</build-number>
        <build-date>06-10-2016</build-date>
    </build-info>

<item>
            <title>[ENTESB-4026] Memory leak org.apache.felix.eventadmin.impl.tasks.AsyncDeliverTasks is holding millions of instances of org.apache.felix.eventadmin.impl.tasks.AsyncDeliverTasks$TaskExecuter</title>
                <link>https://issues.jboss.org/browse/ENTESB-4026</link>
                <project id="12314570" key="ENTESB">JBoss Fuse</project>
                    <description>&lt;p&gt;After 2 weeks A-MQ (embedded in karaf) heap contains over 14 million instances of org.apache.felix.eventadmin.impl.tasks.AsyncDeliverTasks$TaskExecuter (see attached screen shot for structure of dominator tree.&lt;/p&gt;

&lt;p&gt;From debugging through the code, it seems that entries get added to the org.apache.felix.eventadmin.impl.tasks.AsyncDeliverTasks#m_running_threads  (java.util.concurrent.ConcurrentHashMap) but not removed. &lt;/p&gt;

&lt;p&gt;In org.apache.felix.eventadmin.impl.tasks.AsyncDeliverTasks.TaskExecuter#run() the call to remove is trying to remove the &quot;object&quot; rather than the key. This does not remove anything from the map. &lt;/p&gt;

&lt;p/&gt;
&lt;div id=&quot;syntaxplugin&quot; class=&quot;syntaxplugin&quot; style=&quot;border: 1px dashed #bbb; border-radius: 5px !important; overflow: auto; max-height: 30em;&quot;&gt;
&lt;table cellspacing=&quot;0&quot; cellpadding=&quot;0&quot; border=&quot;0&quot; width=&quot;100%&quot; style=&quot;font-size: 1em; line-height: 1.4em !important; font-weight: normal; font-style: normal; color: black;&quot;&gt;
		&lt;tbody &gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;  margin-top: 10px;   width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;  public void run()&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;        {&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;          ...&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;                        this.m_running_threads.remove(this);&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;           ...&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;            } while ( running );&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   margin-bottom: 10px;  width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;        }&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
			&lt;/tbody&gt;
&lt;/table&gt;
&lt;/div&gt;
&lt;p/&gt;</description>
                <environment>&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;tested on JBoss Fuse 6.2 GA&lt;/li&gt;
&lt;/ul&gt;
</environment>
        <key id="12585123">ENTESB-4026</key>
            <summary>Memory leak org.apache.felix.eventadmin.impl.tasks.AsyncDeliverTasks is holding millions of instances of org.apache.felix.eventadmin.impl.tasks.AsyncDeliverTasks$TaskExecuter</summary>
                <type id="1" iconUrl="https://issues.jboss.org/secure/viewavatar?size=xsmall&amp;avatarId=13263&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.jboss.org/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.jboss.org/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Done</resolution>
                                        <assignee username="gnodet">Guillaume Nodet</assignee>
                                    <reporter username="pfox">Pat Fox</reporter>
                        <labels>
                    </labels>
                <created>Wed, 16 Sep 2015 10:26:16 -0400</created>
                <updated>Fri, 6 May 2016 05:04:27 -0400</updated>
                            <resolved>Thu, 3 Mar 2016 20:12:07 -0500</resolved>
                                    <version> jboss-fuse-6.2</version>
                                    <fixVersion>jboss-fuse-6.3</fixVersion>
                                    <component>Karaf</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>8</watches>
                                                                <comments>
                            <comment id="13109628" author="pfox" created="Wed, 16 Sep 2015 16:40:34 -0400"  >&lt;p&gt;If the same thread ids are generating Events this issue is not exercised.  Need to get unique threads generating events to EventAdmin Service (see simple.tar.gz example) see issue.&lt;/p&gt;</comment>
                            <comment id="13109629" author="pfox" created="Wed, 16 Sep 2015 16:46:46 -0400"  >&lt;p&gt;Potential workaround: &lt;/p&gt;

&lt;p&gt;set &quot;org.apache.felix.eventadmin.IgnoreTopic=*&quot; in org.apache.felix.eventadmin.impl.EventAdmin.cfg .&lt;br/&gt;
I think this will effectively turn off the EventAdmin Service and avoid the code.&lt;/p&gt;

</comment>
                            <comment id="13111349" author="sjavurek" created="Tue, 22 Sep 2015 11:35:30 -0400"  >&lt;p&gt;Guillaume, would you have a peek hopefully for 6.2.1?&lt;/p&gt;</comment>
                            <comment id="13115328" author="aileenc" created="Tue, 6 Oct 2015 06:06:27 -0400"  >&lt;p&gt;&lt;a href=&quot;https://issues.jboss.org/secure/ViewProfile.jspa?name=gnodet&quot; class=&quot;user-hover&quot; rel=&quot;gnodet&quot;&gt;Guillaume Nodet&lt;/a&gt; Any ideas on this?&lt;/p&gt;</comment>
                            <comment id="13118302" author="gnodet" created="Wed, 14 Oct 2015 11:05:31 -0400"  >&lt;p&gt;This issue has been fixed at Apache a few weeks ago but there&apos;s no release containing it.  The fastest way would be to fork it and use our own version.&lt;/p&gt;

&lt;p&gt;Else, we schedule it for 6.2.2&lt;/p&gt;</comment>
                            <comment id="13118324" author="aileenc" created="Wed, 14 Oct 2015 11:42:39 -0400"  >&lt;p&gt;&lt;a href=&quot;https://issues.jboss.org/secure/ViewProfile.jspa?name=sjavurek&quot; class=&quot;user-hover&quot; rel=&quot;sjavurek&quot;&gt;Susan Javurek&lt;/a&gt; What is priority of this issue? Can we wait for Apache release and fix in 6.3 or a 6.2.1 patch?&lt;/p&gt;</comment>
                            <comment id="13118539" author="aileenc" created="Thu, 15 Oct 2015 05:51:12 -0400"  >&lt;p&gt;Which release of Event Admin will contain the fix we need?&lt;/p&gt;</comment>
                            <comment id="13171749" author="janstey" created="Thu, 3 Mar 2016 20:12:07 -0500"  >&lt;p&gt;We&apos;re using event admin 1.4.6 in 6.3 which contains the fix.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/jboss-fuse/karaf/blob/2.4.0.redhat-6-3-x/pom.xml#L172-Lundefined&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/jboss-fuse/karaf/blob/2.4.0.redhat-6-3-x/pom.xml#L172-Lundefined&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13201936" author="pmacik" created="Fri, 6 May 2016 05:04:10 -0400"  >&lt;p&gt;Verified in 630067&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12392868" name="Screen Shot 2015-09-16 at 16.16.46.png" size="103595" author="pfox" created="Wed, 16 Sep 2015 10:17:53 -0400"/>
                            <attachment id="12392877" name="simple.tar.gz" size="4456" author="pfox" created="Wed, 16 Sep 2015 16:19:51 -0400"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12312340" key="org.jboss.labs.jira.plugin.jboss-custom-field-types-plugin:jbonlyselect">
                        <customfieldname>GSS Priority</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12310641" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Number of attachments</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310640" key="com.atlassian.jira.toolkit:comments">
                        <customfieldname>Number of comments</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311940" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1|hzyifz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310840" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12310940" key="com.pyxis.greenhopper.jira:gh-sprint">
                        <customfieldname>Sprint</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="4670">6.3 Sprint 3 (Feb 29 - Mar 25)</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310183" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Steps to Reproduce</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;run attach client  (simple.tar.gz) and point it to a clean A-MQ 6.2 GA distribution.&lt;/p&gt;

&lt;p/&gt;
&lt;div id=&quot;syntaxplugin&quot; class=&quot;syntaxplugin&quot; style=&quot;border: 1px dashed #bbb; border-radius: 5px !important; overflow: auto; max-height: 30em;&quot;&gt;
&lt;table cellspacing=&quot;0&quot; cellpadding=&quot;0&quot; border=&quot;0&quot; width=&quot;100%&quot; style=&quot;font-size: 1em; line-height: 1.4em !important; font-weight: normal; font-style: normal; color: black;&quot;&gt;
		&lt;tbody &gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;  margin-top: 10px;   margin-bottom: 10px;  width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;mvn exec:java -Dexec.mainClass=com.mysample.Client&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
			&lt;/tbody&gt;
&lt;/table&gt;
&lt;/div&gt;
&lt;p/&gt;

&lt;p&gt;This will create 1000 A-MQ connection which get shutdown ungracefully (without connection.close() being called). On the karaf side with will generate warning log messages  that get posted to eventAdmin services as Events. These events are being generated from unique thread ids with the karaf container.&lt;/p&gt;

&lt;p&gt;-attach debugger and review contents of &quot;org.apache.felix.eventadmin.impl.tasks.AsyncDeliverTasks#m_running_threads&quot; . It will contain &amp;gt;1000 entries.&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12310080" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Tester</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>pmacik</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>