<!-- 
RSS generated by JIRA (7.2.3#72005-sha1:73be91d2b96fc29303a7eb6820acf420e5d0ed65) at Mon Dec 12 14:23:24 EST 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.jboss.org/si/jira.issueviews:issue-xml/ENTESB-2581/ENTESB-2581.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>JBoss Issue Tracker</title>
    <link>https://issues.jboss.org</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-us</language>    <build-info>
        <version>7.2.3</version>
        <build-number>72005</build-number>
        <build-date>06-10-2016</build-date>
    </build-info>

<item>
            <title>[ENTESB-2581] Git repo very slow after adding 100s of profiles</title>
                <link>https://issues.jboss.org/browse/ENTESB-2581</link>
                <project id="12314570" key="ENTESB">JBoss Fuse</project>
                    <description>&lt;p&gt;Customer has around 800 profiles added over ~100 commits to fabric&apos;s Git repo. A container upgrade was taking over 6 minutes and with the CPU spiking to 100% for the duration. Pertinent stack was:&lt;/p&gt;

&lt;p&gt;&quot;pool-18-thread-1&quot; prio=10 tid=0x00007f02dc2ba800 nid=0xa3d3 runnable &lt;span class=&quot;error&quot;&gt;&amp;#91;0x00007f03e86ad000&amp;#93;&lt;/span&gt;&lt;br/&gt;
   java.lang.Thread.State: RUNNABLE&lt;br/&gt;
	at java.util.zip.Inflater.inflateBytes(Native Method)&lt;br/&gt;
	at java.util.zip.Inflater.inflate(Inflater.java:259)&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;locked &amp;lt;0x0000000781773c98&amp;gt; (a java.util.zip.ZStreamRef)&lt;br/&gt;
	at org.eclipse.jgit.internal.storage.file.WindowCursor.inflate(WindowCursor.java:311)&lt;br/&gt;
	at org.eclipse.jgit.internal.storage.file.PackFile.decompress(PackFile.java:337)&lt;br/&gt;
	at org.eclipse.jgit.internal.storage.file.PackFile.load(PackFile.java:731)&lt;br/&gt;
	at org.eclipse.jgit.internal.storage.file.PackFile.get(PackFile.java:256)&lt;br/&gt;
	at org.eclipse.jgit.internal.storage.file.ObjectDirectory.openObject1(ObjectDirectory.java:371)&lt;br/&gt;
	at org.eclipse.jgit.internal.storage.file.FileObjectDatabase.openObjectImpl1(FileObjectDatabase.java:173)&lt;br/&gt;
	at org.eclipse.jgit.internal.storage.file.FileObjectDatabase.openObject(FileObjectDatabase.java:158)&lt;br/&gt;
	at org.eclipse.jgit.internal.storage.file.WindowCursor.open(WindowCursor.java:145)&lt;br/&gt;
	at org.eclipse.jgit.treewalk.CanonicalTreeParser.reset(CanonicalTreeParser.java:201)&lt;br/&gt;
	at org.eclipse.jgit.treewalk.CanonicalTreeParser.createSubtreeIterator0(CanonicalTreeParser.java:235)&lt;br/&gt;
	at org.eclipse.jgit.treewalk.CanonicalTreeParser.createSubtreeIterator(CanonicalTreeParser.java:213)&lt;br/&gt;
	at org.eclipse.jgit.treewalk.CanonicalTreeParser.createSubtreeIterator(CanonicalTreeParser.java:60)&lt;br/&gt;
	at org.eclipse.jgit.treewalk.TreeWalk.enterSubtree(TreeWalk.java:912)&lt;br/&gt;
	at org.eclipse.jgit.treewalk.TreeWalk.next(TreeWalk.java:566)&lt;br/&gt;
	at org.eclipse.jgit.revwalk.RewriteTreeFilter.include(RewriteTreeFilter.java:119)&lt;br/&gt;
	at org.eclipse.jgit.revwalk.PendingGenerator.next(PendingGenerator.java:141)&lt;br/&gt;
	at org.eclipse.jgit.revwalk.BlockRevQueue. (BlockRevQueue.java:65)&lt;br/&gt;
	at org.eclipse.jgit.revwalk.FIFORevQueue. (FIFORevQueue.java:64)&lt;br/&gt;
	at org.eclipse.jgit.revwalk.StartGenerator.next(StartGenerator.java:157)&lt;br/&gt;
	at org.eclipse.jgit.revwalk.RevWalk.next(RevWalk.java:414)&lt;br/&gt;
	at org.gitective.core.CommitUtils.getLastCommit(CommitUtils.java:418)&lt;br/&gt;
	at io.fabric8.git.internal.CachingGitDataStore.addProfileData(CachingGitDataStore.java:160)&lt;br/&gt;
	at io.fabric8.git.internal.CachingGitDataStore.addProfileData(CachingGitDataStore.java:150)&lt;br/&gt;
	at io.fabric8.git.internal.CachingGitDataStore.addProfileData(CachingGitDataStore.java:150)&lt;br/&gt;
	at io.fabric8.git.internal.CachingGitDataStore.addProfileData(CachingGitDataStore.java:150)&lt;br/&gt;
	at io.fabric8.git.internal.CachingGitDataStore.addProfileData(CachingGitDataStore.java:150)&lt;br/&gt;
	at io.fabric8.git.internal.CachingGitDataStore.addProfileData(CachingGitDataStore.java:150)&lt;br/&gt;
	at io.fabric8.git.internal.CachingGitDataStore.pouplateVersionData(CachingGitDataStore.java:130)&lt;br/&gt;
	at io.fabric8.git.internal.CachingGitDataStore$1$1.call(CachingGitDataStore.java:90)&lt;br/&gt;
	at io.fabric8.git.internal.CachingGitDataStore$1$1.call(CachingGitDataStore.java:87)&lt;br/&gt;
	at io.fabric8.git.internal.GitDataStore.gitOperation(GitDataStore.java:909)&lt;/li&gt;
	&lt;li&gt;locked &amp;lt;0x000000078155d6c8&amp;gt; (a java.lang.Object)&lt;br/&gt;
	at io.fabric8.git.internal.GitDataStore.gitOperation(GitDataStore.java:876)&lt;br/&gt;
	at io.fabric8.git.internal.GitDataStore.gitOperation(GitDataStore.java:871)&lt;br/&gt;
	at io.fabric8.git.internal.CachingGitDataStore$1.load(CachingGitDataStore.java:87)&lt;br/&gt;
	at io.fabric8.git.internal.CachingGitDataStore$1.load(CachingGitDataStore.java:84)&lt;br/&gt;
	at com.google.common.cache.LocalCache$LoadingValueReference.loadFuture(LocalCache.java:3522)&lt;br/&gt;
	at com.google.common.cache.LocalCache$Segment.loadSync(LocalCache.java:2315)&lt;br/&gt;
	at com.google.common.cache.LocalCache$Segment.lockedGetOrLoad(LocalCache.java:2278)&lt;/li&gt;
	&lt;li&gt;locked &amp;lt;0x000000078155c1f8&amp;gt; (a com.google.common.cache.LocalCache$StrongEntry)&lt;br/&gt;
	at com.google.common.cache.LocalCache$Segment.get(LocalCache.java:2193)&lt;br/&gt;
	at com.google.common.cache.LocalCache.get(LocalCache.java:3932)&lt;br/&gt;
	at com.google.common.cache.LocalCache.getOrLoad(LocalCache.java:3936)&lt;br/&gt;
	at com.google.common.cache.LocalCache$LocalLoadingCache.get(LocalCache.java:4806)&lt;br/&gt;
	at io.fabric8.git.internal.CachingGitDataStore.getVersionData(CachingGitDataStore.java:114)&lt;br/&gt;
	at io.fabric8.git.internal.CachingGitDataStore.hasProfile(CachingGitDataStore.java:185)&lt;br/&gt;
	at io.fabric8.internal.VersionImpl.getProfile(VersionImpl.java:100)&lt;br/&gt;
	at io.fabric8.internal.ContainerImpl$ContainerProfile.getParents(ContainerImpl.java:271)&lt;br/&gt;
	at io.fabric8.internal.ProfileOverlayImpl.fillParentProfiles(ProfileOverlayImpl.java:248)&lt;br/&gt;
	at io.fabric8.internal.ProfileOverlayImpl.getInheritedProfiles(ProfileOverlayImpl.java:243)&lt;br/&gt;
	at io.fabric8.internal.ProfileOverlayImpl.getConfigurations(ProfileOverlayImpl.java:346)&lt;br/&gt;
	at io.fabric8.internal.ProfileOverlayImpl.getContainerConfiguration(ProfileOverlayImpl.java:121)&lt;br/&gt;
	at io.fabric8.internal.ProfileImpl.getContainerConfigList(ProfileImpl.java:149)&lt;br/&gt;
	at io.fabric8.internal.ProfileOverlayImpl.getRepositories(ProfileOverlayImpl.java:106)&lt;br/&gt;
	at io.fabric8.features.FabricFeaturesServiceImpl.listInstalledRepositories(FabricFeaturesServiceImpl.java:327)&lt;br/&gt;
	at io.fabric8.features.FabricFeaturesServiceImpl.run(FabricFeaturesServiceImpl.java:93)&lt;/li&gt;
	&lt;li&gt;locked &amp;lt;0x00000007811fa720&amp;gt; (a io.fabric8.features.FabricFeaturesServiceImpl)&lt;br/&gt;
	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:471)&lt;br/&gt;
	at java.util.concurrent.FutureTask.run(FutureTask.java:262)&lt;br/&gt;
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)&lt;br/&gt;
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)&lt;br/&gt;
	at java.lang.Thread.run(Thread.java:745)&lt;/li&gt;
&lt;/ul&gt;
</description>
                <environment></environment>
        <key id="12562037">ENTESB-2581</key>
            <summary>Git repo very slow after adding 100s of profiles</summary>
                <type id="1" iconUrl="https://issues.jboss.org/secure/viewavatar?size=xsmall&amp;avatarId=13263&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.jboss.org/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.jboss.org/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Done</resolution>
                                        <assignee username="janstey">Jonathan Anstey</assignee>
                                    <reporter username="janstey">Jonathan Anstey</reporter>
                        <labels>
                    </labels>
                <created>Thu, 29 Jan 2015 15:00:51 -0500</created>
                <updated>Thu, 28 Jan 2016 04:17:36 -0500</updated>
                            <resolved>Fri, 30 Jan 2015 10:58:42 -0500</resolved>
                                    <version>jboss-fuse-6.1</version>
                                    <fixVersion> jboss-fuse-6.2</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                <comments>
                            <comment id="13036341" author="janstey" created="Thu, 29 Jan 2015 15:14:45 -0500"  >&lt;p&gt;So in fabric the repo is gc&apos;d every 40 commits. This appears to be not often enough when a large number of profiles are involved. A workaround is to do the gc manually with the Git C client:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;shutdown fuse&lt;/li&gt;
	&lt;li&gt;backup &amp;lt;fuse-home&amp;gt;/data/git&lt;br/&gt;
cd &amp;lt;fuse-home&amp;gt;/data/git/local/fabric&lt;br/&gt;
git gc --aggressive&lt;/li&gt;
	&lt;li&gt;start fuse&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Before doing this a container upgrade was taking me 6m 40s. After the git gc it took 42s.&lt;/p&gt;</comment>
                            <comment id="13036505" author="janstey" created="Fri, 30 Jan 2015 10:58:42 -0500"  >&lt;p&gt;Fixed for 6.2 with &lt;a href=&quot;https://github.com/jboss-fuse/fabric8/commit/0473a623141f601af676acce4609935c5c3bdc4e&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/jboss-fuse/fabric8/commit/0473a623141f601af676acce4609935c5c3bdc4e&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13083137" author="llowinge" created="Wed, 24 Jun 2015 05:10:38 -0400"  >&lt;p&gt;With &lt;p/&gt;
&lt;div id=&quot;syntaxplugin&quot; class=&quot;syntaxplugin&quot; style=&quot;border: 1px dashed #bbb; border-radius: 5px !important; overflow: auto; max-height: 30em;&quot;&gt;
&lt;table cellspacing=&quot;0&quot; cellpadding=&quot;0&quot; border=&quot;0&quot; width=&quot;100%&quot; style=&quot;font-size: 1em; line-height: 1.4em !important; font-weight: normal; font-style: normal; color: black;&quot;&gt;
		&lt;tbody &gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;  margin-top: 10px;   margin-bottom: 10px;  width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;gitGcOnLoad=true&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
			&lt;/tbody&gt;
&lt;/table&gt;
&lt;/div&gt;
&lt;p/&gt; the gc is called on creating/connecting to fabric.&lt;br/&gt;
But with command &lt;p/&gt;
&lt;div id=&quot;syntaxplugin&quot; class=&quot;syntaxplugin&quot; style=&quot;border: 1px dashed #bbb; border-radius: 5px !important; overflow: auto; max-height: 30em;&quot;&gt;
&lt;table cellspacing=&quot;0&quot; cellpadding=&quot;0&quot; border=&quot;0&quot; width=&quot;100%&quot; style=&quot;font-size: 1em; line-height: 1.4em !important; font-weight: normal; font-style: normal; color: black;&quot;&gt;
		&lt;tbody &gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;  margin-top: 10px;   margin-bottom: 10px;  width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;container-upgrade&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
			&lt;/tbody&gt;
&lt;/table&gt;
&lt;/div&gt;
&lt;p/&gt; is not called, which upgrading do you mean ?&lt;/p&gt;

&lt;p&gt;Fuse 6.2.0 build 133&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12583224">ENTESB-3907</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="12310001">
                    <name>Related</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12601632">ENTESB-4883</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                                        </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310641" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Number of attachments</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310640" key="com.atlassian.jira.toolkit:comments">
                        <customfieldname>Number of comments</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311940" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1|hzuu5z:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310840" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>