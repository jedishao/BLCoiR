<!-- 
RSS generated by JIRA (7.2.3#72005-sha1:73be91d2b96fc29303a7eb6820acf420e5d0ed65) at Mon Dec 12 15:57:55 EST 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.jboss.org/si/jira.issueviews:issue-xml/ENTESB-2274/ENTESB-2274.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>JBoss Issue Tracker</title>
    <link>https://issues.jboss.org</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-us</language>    <build-info>
        <version>7.2.3</version>
        <build-number>72005</build-number>
        <build-date>06-10-2016</build-date>
    </build-info>

<item>
            <title>[ENTESB-2274] Camel Ruby integration fails with parallel processing </title>
                <link>https://issues.jboss.org/browse/ENTESB-2274</link>
                <project id="12314570" key="ENTESB">JBoss Fuse</project>
                    <description>&lt;p&gt;When a Camel route contains a Ruby invocation, of this form:&lt;/p&gt;

&lt;p&gt;.to(&quot;language:ruby:puts $request.body;result = $request.body&quot;)&lt;/p&gt;

&lt;p&gt;and this route is invoked in parallel from a SEDA parallel consumer:&lt;/p&gt;

&lt;p&gt;from(&quot;seda:parallel?concurrentConsumers=5&quot;)&lt;/p&gt;

&lt;p&gt;then the route fails intermittently with the following exception message:&lt;/p&gt;

&lt;p&gt;NoMethodError: undefined method `body&apos; for nil:NilClass&lt;br/&gt;
  (root) at &amp;lt;script&amp;gt;:1&lt;/p&gt;

&lt;p&gt;The same route works correctly with Camel 2.8.0. In addition, execution of the route is 2-3 times slower with Camel 2.12.0 than it was with 2.8.0; it is not clear whether this reduction in throughput is associated with the errors or not.&lt;/p&gt;
</description>
                <environment>&lt;p&gt;Red Hat JBoss Fuse 6.1.0 GA; Camel 2.12.0&lt;/p&gt;</environment>
        <key id="12558892">ENTESB-2274</key>
            <summary>Camel Ruby integration fails with parallel processing </summary>
                <type id="1" iconUrl="https://issues.jboss.org/secure/viewavatar?size=xsmall&amp;avatarId=13263&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.jboss.org/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.jboss.org/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Done</resolution>
                                        <assignee username="willem.jiang">Willem Jiang</assignee>
                                    <reporter username="kboone">Kevin Boone</reporter>
                        <labels>
                    </labels>
                <created>Mon, 8 Dec 2014 04:38:36 -0500</created>
                <updated>Tue, 12 May 2015 06:06:31 -0400</updated>
                            <resolved>Thu, 29 Jan 2015 21:11:36 -0500</resolved>
                                    <version>jboss-fuse-6.1</version>
                                    <fixVersion> jboss-fuse-6.2</fixVersion>
                                    <component>Camel</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                <comments>
                            <comment id="13025814" author="kboone" created="Mon, 8 Dec 2014 04:39:27 -0500"  >&lt;p&gt;Test cases&lt;/p&gt;</comment>
                            <comment id="13027413" author="aileenc" created="Fri, 12 Dec 2014 11:11:26 -0500"  >&lt;p&gt;&lt;a href=&quot;https://issues.jboss.org/secure/ViewProfile.jspa?name=willem.jiang&quot; class=&quot;user-hover&quot; rel=&quot;willem.jiang&quot;&gt;Willem Jiang&lt;/a&gt; Can you look at this next week?&lt;/p&gt;</comment>
                            <comment id="13028656" author="willem.jiang" created="Thu, 18 Dec 2014 08:39:04 -0500"  >&lt;p&gt;Hi Kevin,&lt;/p&gt;

&lt;p&gt;I just checked the change log of camel-script, there are some changes which could relate to this issue.&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-6559&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;CAMEL-6559&lt;/a&gt; caches the script engine per thread to avoid synchronize option on the evaluate method (affects Camel 2.12.0) and &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-7143&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;CAMEL-7143&lt;/a&gt; create a script engine per exchange (affects Camel 2.12.3).&lt;br/&gt;
I used JProfile to monitor the JVM thread and found out the JRuby1.7.x starts a JIT compile thread per script engine, so that could explain why the test is much slower in Camel 2.14.0.&lt;/p&gt;

&lt;p&gt;I will keep digging code to see if  I can find a way to address CAMEL-6559 and CAMEL-7143 without introducing the throughput reduction.&lt;/p&gt;

&lt;p&gt;Regards,&lt;/p&gt;

&lt;p&gt;Willem&lt;/p&gt;</comment>
                            <comment id="13028686" author="kboone" created="Thu, 18 Dec 2014 09:46:12 -0500"  >&lt;p&gt;Thanks for the update.&lt;/p&gt;</comment>
                            <comment id="13030946" author="kboone" created="Thu, 8 Jan 2015 10:43:06 -0500"  >&lt;p&gt;Test case with 2.15-SNAP&lt;/p&gt;</comment>
                            <comment id="13067182" author="mbasovni" created="Tue, 12 May 2015 06:06:31 -0400"  >&lt;p&gt;Verified with 2.15.0.redhat-620099 (JBoss Fuse 6.2 ER3).&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310001">
                    <name>Related</name>
                                                                <inwardlinks description="is related to">
                                                        </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12386731" name="camel-2.12.0-jruby-1.7.4.zip" size="4362" author="kboone" created="Mon, 8 Dec 2014 04:39:27 -0500"/>
                            <attachment id="12387179" name="camel-2.15-SNAP-jruby.zip" size="22787" author="kboone" created="Thu, 8 Jan 2015 10:43:06 -0500"/>
                            <attachment id="12386732" name="camel-ruby-test.zip" size="11973" author="kboone" created="Mon, 8 Dec 2014 04:39:27 -0500"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310641" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Number of attachments</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310640" key="com.atlassian.jira.toolkit:comments">
                        <customfieldname>Number of comments</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311940" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1|hzucb3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310840" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310183" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Steps to Reproduce</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;1. Download and unpack camel-ruby-test.zip&lt;br/&gt;
2. cd camel-2.8.0-jruby-1.5.6&lt;br/&gt;
3. mvn -Dtest=JRubyTest#testParallel test&lt;br/&gt;
4. Test completes successfully (record time)&lt;br/&gt;
5. Download and unpack camel-2.12.0-jruby-1.7.4.zip&lt;br/&gt;
6  mvn -Dtest=JRubyTest#testParallelLocalContextScopeSingleton test&lt;br/&gt;
7. Note many errors:&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>