<!-- 
RSS generated by JIRA (7.2.3#72005-sha1:73be91d2b96fc29303a7eb6820acf420e5d0ed65) at Mon Dec 12 14:38:41 EST 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.jboss.org/si/jira.issueviews:issue-xml/ENTESB-2946/ENTESB-2946.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>JBoss Issue Tracker</title>
    <link>https://issues.jboss.org</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-us</language>    <build-info>
        <version>7.2.3</version>
        <build-number>72005</build-number>
        <build-date>06-10-2016</build-date>
    </build-info>

<item>
            <title>[ENTESB-2946] Camel: onCompletion() handlers cancelled by stop() call in route</title>
                <link>https://issues.jboss.org/browse/ENTESB-2946</link>
                <project id="12314570" key="ENTESB">JBoss Fuse</project>
                    <description>&lt;p&gt;When a camel 2.12.0 route is stopped using the Java DSL stop() call, then any operations registered using the onCompletion() API are not activated. This is true also for 2.13.0, but not for 2.12.5 not 2.14.0.&lt;/p&gt;</description>
                <environment>&lt;p&gt;JBoss Fuse 6.1.01&lt;/p&gt;</environment>
        <key id="12567148">ENTESB-2946</key>
            <summary>Camel: onCompletion() handlers cancelled by stop() call in route</summary>
                <type id="1" iconUrl="https://issues.jboss.org/secure/viewavatar?size=xsmall&amp;avatarId=13263&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.jboss.org/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.jboss.org/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Done</resolution>
                                        <assignee username="willem.jiang">Willem Jiang</assignee>
                                    <reporter username="kboone">Kevin Boone</reporter>
                        <labels>
                            <label>QA_WILL_AUTOMATE</label>
                    </labels>
                <created>Fri, 27 Mar 2015 12:41:20 -0400</created>
                <updated>Mon, 27 Apr 2015 09:03:12 -0400</updated>
                            <resolved>Mon, 30 Mar 2015 21:44:40 -0400</resolved>
                                    <version>jboss-fuse-6.1</version>
                                    <fixVersion> jboss-fuse-6.2</fixVersion>
                                    <component>Camel</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                <comments>
                            <comment id="13054132" author="kboone" created="Fri, 27 Mar 2015 12:50:14 -0400"  >&lt;p&gt;According to the onCompletion() documentation:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://camel.apache.org/oncompletion.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://camel.apache.org/oncompletion.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;onCompletion() handlers are asynchronous of the route handling thread in 2.12.0 and 2.13.0, and synchronous thereafter. Modifying the customer&apos;s test case to use 2.13.0 shows the same result as 2.12.0, whilst using 2.14.0 shows the &quot;desired&quot; result, which is that the onCompletion() handler gets called. I surmise that, because of the asynchronous handling, the route stop() method removes the asynchronous handlers from the route before it stops, so the handlers never get called. In 2.14.0 there is no need to remove these handlers, because handling is synchronous, so they are in place when the route is stop()-ed.&lt;/p&gt;

&lt;p&gt;Whatever, there is a marked difference in behaviour between 2.12.0/2.13.0, and 2.14.0 concerning the stop() API and onCompletion(). Whilst the change in documented behaviour (synchronous/asynchronous) might account for this, it isn&apos;t something that is documented. &lt;/p&gt;

&lt;p&gt;What makes this all the more interesting (or bewildering) is that 2.12.5 behaves the same as 2.14.0 so far as stop() is concerned, and differently than 2.12.0. It looks as if somebody didn&apos;t like the way stop() did not invoke onCompletion() and changed it, but then it got changed back in 2.13.0.&lt;/p&gt;

&lt;p&gt;The difference in behaviour viz-a-viz synchronous and asynchronous onCompletion() handlers is well documented, and I don&apos;t think it could be considered a bug that handling in Fuse is asynchronous. However, that it is asynchronous does not by itself create a reason for the stop() operation to prevent onCompletion() handlers being called, and that might still be a bug.&lt;/p&gt;</comment>
                            <comment id="13054136" author="kboone" created="Fri, 27 Mar 2015 12:53:58 -0400"  >&lt;p&gt;Test case&lt;/p&gt;</comment>
                            <comment id="13054438" author="davsclaus" created="Mon, 30 Mar 2015 04:34:51 -0400"  >&lt;p&gt;See CAMEL-7707&lt;/p&gt;</comment>
                            <comment id="13062836" author="tturek" created="Mon, 27 Apr 2015 09:03:12 -0400"  >&lt;p&gt;Verified in ER3&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310001">
                    <name>Related</name>
                                                                <inwardlinks description="is related to">
                                                        </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12388583" name="onCompletion.7z" size="3173" author="kboone" created="Fri, 27 Mar 2015 12:53:58 -0400"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310641" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Number of attachments</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310640" key="com.atlassian.jira.toolkit:comments">
                        <customfieldname>Number of comments</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311940" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1|hzvoqf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310840" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310183" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Steps to Reproduce</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;1. Download and unpack onCompletion.7z to reveal a Maven project&lt;br/&gt;
2. Run &quot;mvn test&quot;&lt;br/&gt;
3. Note the failed unit test, indicating that the onCompletion() handler had not activated.&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>