<!-- 
RSS generated by JIRA (7.2.3#72005-sha1:73be91d2b96fc29303a7eb6820acf420e5d0ed65) at Tue Dec 06 22:32:08 EST 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.jboss.org/si/jira.issueviews:issue-xml/ENTESB-4836/ENTESB-4836.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>JBoss Issue Tracker</title>
    <link>https://issues.jboss.org</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-us</language>    <build-info>
        <version>7.2.3</version>
        <build-number>72005</build-number>
        <build-date>06-10-2016</build-date>
    </build-info>

<item>
            <title>[ENTESB-4836] SwitchYard on EAP allows &quot;transaction is not active&quot; error</title>
                <link>https://issues.jboss.org/browse/ENTESB-4836</link>
                <project id="12314570" key="ENTESB">JBoss Fuse</project>
                    <description>&lt;p&gt;SwitchYard allows &apos;Transaction is not active&apos; errors, not predictably reproduceable.&lt;/p&gt;

&lt;p&gt;After discussion with EAP Tx SMEs, it seems possible this is related to SwitchYard&apos;s transaction interceptor code.  EAP had similar symptoms with EJB transactions, an adjustment to the interceptor solved the issue.&lt;/p&gt;

&lt;p&gt;Some resources:&lt;br/&gt;
&lt;a href=&quot;https://issues.jboss.org/browse/WFLY-1346&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.jboss.org/browse/WFLY-1346&lt;/a&gt;         // the Wildfly fix&lt;br/&gt;
&lt;a href=&quot;https://bugzilla.redhat.com/show_bug.cgi?id=1008644&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://bugzilla.redhat.com/show_bug.cgi?id=1008644&lt;/a&gt;    // EAP BZ&lt;br/&gt;
&lt;a href=&quot;https://developer.jboss.org/thread/228598&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://developer.jboss.org/thread/228598&lt;/a&gt;        // conversation on the topic&lt;br/&gt;
&lt;a href=&quot;http://pastebin.test.redhat.com/341474&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://pastebin.test.redhat.com/341474&lt;/a&gt;      // Pastebin with sample code (may expire)&lt;/p&gt;



&lt;p&gt;Possibly helpful code snippet:&lt;br/&gt;
            } else if (txStatus == Status.STATUS_MARKED_ROLLBACK) &lt;/p&gt;
{
                tm.rollback();
            }
&lt;p&gt; else if (txStatus == Status.STATUS_ROLLEDBACK) {&lt;br/&gt;
                // handle reaper canceled (rolled back) tx case (see &lt;a href=&quot;https://issues.jboss.org/browse/WFLY-1346&quot; title=&quot;avoid &amp;quot;transaction is not active&amp;quot; error by having CMTTxInterceptor.endTransaction check transaction status&quot; class=&quot;issue-link&quot; data-issue-key=&quot;WFLY-1346&quot;&gt;&lt;del&gt;WFLY-1346&lt;/del&gt;&lt;/a&gt;)&lt;br/&gt;
                // clear current tx state and throw RollbackException (EJBTransactionRolledbackException)&lt;br/&gt;
                tm.rollback();&lt;br/&gt;
                throw EjbLogger.ROOT_LOGGER.transactionAlreadyRolledBack(tx);&lt;/p&gt;</description>
                <environment>&lt;p&gt;SwitchYard on EAP&lt;/p&gt;</environment>
        <key id="12599907">ENTESB-4836</key>
            <summary>SwitchYard on EAP allows &quot;transaction is not active&quot; error</summary>
                <type id="1" iconUrl="https://issues.jboss.org/secure/viewavatar?size=xsmall&amp;avatarId=13263&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.jboss.org/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.jboss.org/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Done</resolution>
                                        <assignee username="igarashitm">Tomohisa igarashi</assignee>
                                    <reporter username="rick_wagner">Rick Wagner</reporter>
                        <labels>
                    </labels>
                <created>Mon, 18 Jan 2016 12:26:31 -0500</created>
                <updated>Tue, 17 May 2016 16:33:11 -0400</updated>
                            <resolved>Thu, 25 Feb 2016 12:25:10 -0500</resolved>
                                    <version>jboss-fuse-6.2.1</version>
                                    <fixVersion>jboss-fuse-6.3</fixVersion>
                                    <component>Camel</component>
                    <component>SwitchYard</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>8</watches>
                                                                <comments>
                            <comment id="13154742" author="stephen.fikes" created="Wed, 27 Jan 2016 15:46:14 -0500"  >&lt;p&gt;Per our discussion, I believe you can reproduce the issue by &quot;speeding&quot; up the reaper. Normally, it defaults to timing out transactions after 300 seconds (5 minutes) but this can be decreased to force the issue more quickly. When Switchyard is deployed in EAP, you can simply adjust the following property from the standalone or domain .xml:&lt;/p&gt;

&lt;p&gt;        &amp;lt;subsystem xmlns=&quot;urn:jboss:domain:transactions:...&quot;&amp;gt;&lt;br/&gt;
            ...&lt;br/&gt;
            &amp;lt;coordinator-environment default-timeout=&quot;300&quot;/&amp;gt; &amp;lt;!-- maybe lower this to 30 or 15 and then sleep at least that long during the transaction --&amp;gt;&lt;br/&gt;
        &amp;lt;/subsystem&amp;gt;&lt;/p&gt;</comment>
                            <comment id="13158901" author="rick_wagner" created="Thu, 4 Feb 2016 11:33:09 -0500"  >&lt;p&gt;The customer is using Roll up FSW_6.0_2_2014 in their environment.  If we want to exactly replicate the environment, this patch can be obtained from the portal.&lt;/p&gt;</comment>
                            <comment id="13161909" author="igarashitm" created="Thu, 11 Feb 2016 13:20:26 -0500"  >&lt;p&gt;Although we&apos;ll fix SwitchYard code to do tm.suspend() explicitly on STATUS_ROLLEDBACK by &lt;a href=&quot;https://issues.jboss.org/browse/SWITCHYARD-2878&quot; title=&quot;Disassociate transaction explicitly on Status.STATUS_ROLLEDBACK&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SWITCHYARD-2878&quot;&gt;&lt;del&gt;SWITCHYARD-2878&lt;/del&gt;&lt;/a&gt;, it only addresses the case that SwitchYard initiates the transaction (i.e. managedTransaction.Global required but transaction is not propagated). In other case like camel-jpa or camel-jms initiates the transaction, SwitchYard won&apos;t touch it.&lt;/p&gt;

&lt;p&gt;Assuming there&apos;s no requirement to do tm.suspend() on transaction timeout in any spec (if there is please let me know), that requirement is quite specific to Narayana transaction manager thus we can&apos;t say it must be done by other frameworks like spring-tx or spring-orm (those are used by camel-jpa under the cover). I would say it&apos;s a serious side effect on Narayana transaction reaper unless it&apos;s explicitly definied in any spec.&lt;/p&gt;</comment>
                            <comment id="13161915" author="igarashitm" created="Thu, 11 Feb 2016 13:34:28 -0500"  >&lt;p&gt;I almost forgot spring doesn&apos;t care if it&apos;s compliant to Java EE spec. So spec wouldn&apos;t help to convince them.&lt;/p&gt;</comment>
                            <comment id="13162013" author="igarashitm" created="Fri, 12 Feb 2016 00:54:23 -0500"  >&lt;p&gt;Ah sorry I missed this one - it changed to tm.rollback() from tm.suspend() for Status.STATUS_ROLLEDBACK case:&lt;br/&gt;
&lt;a href=&quot;https://issues.jboss.org/browse/WFLY-4327&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.jboss.org/browse/WFLY-4327&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;So, when reaper rollback the transaction, not only it doesn&apos;t disassociate the transaction from app thread, but also it doesn&apos;t clean up internal static stuff in Narayana. It just sounds like this transaction reaper is really dangerous and should not let it do a job. (IMHO it&apos;s almost a bug in Narayana, and &lt;a href=&quot;https://issues.jboss.org/browse/WFLY-1346&quot; title=&quot;avoid &amp;quot;transaction is not active&amp;quot; error by having CMTTxInterceptor.endTransaction check transaction status&quot; class=&quot;issue-link&quot; data-issue-key=&quot;WFLY-1346&quot;&gt;&lt;del&gt;WFLY-1346&lt;/del&gt;&lt;/a&gt; and &lt;a href=&quot;https://issues.jboss.org/browse/WFLY-4327&quot; title=&quot;when background tx-timeout rolls back the transaction, application thread should call tx.rollback instead of tx.suspend&quot; class=&quot;issue-link&quot; data-issue-key=&quot;WFLY-4327&quot;&gt;&lt;del&gt;WFLY-4327&lt;/del&gt;&lt;/a&gt; are just workarounds for it though...)&lt;/p&gt;

&lt;p&gt;Realistic workaround is to extend transaction timeout so that it won&apos;t really happen, or introduce application timeout so that the transaction always completes before its timeout.&lt;/p&gt;</comment>
                            <comment id="13162299" author="igarashitm" created="Fri, 12 Feb 2016 09:54:24 -0500"  >&lt;p&gt;&lt;a href=&quot;https://issues.jboss.org/secure/ViewProfile.jspa?name=stephen.fikes&quot; class=&quot;user-hover&quot; rel=&quot;stephen.fikes&quot;&gt;Stephen Fikes&lt;/a&gt; I don&apos;t think so. If reaper can&apos;t rollback then it shouldn&apos;t set the STATUS_ROLLEDBACK on the transaction, but it does and actually the transaction is already rolledback. If reaper just set STATUS_MARKED_ROLLBACK without actually rolling back, then things go well.&lt;/p&gt;

&lt;p&gt;Actually the hibernate is complaining that &quot;the transaction was already rolled back by other thread&quot;&lt;br/&gt;
&quot;other thread&quot; in this sentence is of course, Narayana tx reaper.&lt;/p&gt;</comment>
                            <comment id="13168512" author="tcunning" created="Thu, 25 Feb 2016 12:25:10 -0500"  >&lt;p&gt;Processed pull request.&lt;/p&gt;</comment>
                            <comment id="13180437" author="tturek" created="Tue, 22 Mar 2016 06:46:48 -0400"  >&lt;p&gt;Verified on Fuse build 630033&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310001">
                    <name>Related</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12491838">WFLY-1346</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12562657">WFLY-4327</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12603488">ENTESB-4941</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12603624">SWITCHYARD-2878</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12312340" key="org.jboss.labs.jira.plugin.jboss-custom-field-types-plugin:jbonlyselect">
                        <customfieldname>GSS Priority</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12310641" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Number of attachments</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310640" key="com.atlassian.jira.toolkit:comments">
                        <customfieldname>Number of comments</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>8.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311940" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1|hzmgw6:zzzzzzzzv53r</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310840" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                <customfield id="customfield_12310940" key="com.pyxis.greenhopper.jira:gh-sprint">
                        <customfieldname>Sprint</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue id="4558">6.3 Sprint 2 (1-Feb - 26-Feb)</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310183" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Steps to Reproduce</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&lt;p&gt;Not yet known.&lt;/p&gt;</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12310080" key="com.atlassian.jira.plugin.system.customfieldtypes:userpicker">
                        <customfieldname>Tester</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>tturek</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            </customfields>
    </item>
</channel>
</rss>