<!-- 
RSS generated by JIRA (7.2.3#72005-sha1:73be91d2b96fc29303a7eb6820acf420e5d0ed65) at Tue Dec 06 21:39:48 EST 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.jboss.org/si/jira.issueviews:issue-xml/ENTESB-894/ENTESB-894.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>JBoss Issue Tracker</title>
    <link>https://issues.jboss.org</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-us</language>    <build-info>
        <version>7.2.3</version>
        <build-number>72005</build-number>
        <build-date>06-10-2016</build-date>
    </build-info>

<item>
            <title>[ENTESB-894] JMS request/reply</title>
                <link>https://issues.jboss.org/browse/ENTESB-894</link>
                <project id="12314570" key="ENTESB">JBoss Fuse</project>
                    <description>&lt;p&gt;When a JMS message is sent to a TOPIC with a JMSReplyTo queue, it seems Camel is not able find a correlation match when a JMS response arrives to the response queue. Camel picks up the response from the QUEUE and attemps to match the JMSCorrelationId but fails to do so.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12511868">ENTESB-894</key>
            <summary>JMS request/reply</summary>
                <type id="1" iconUrl="https://issues.jboss.org/secure/viewavatar?size=xsmall&amp;avatarId=13263&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.jboss.org/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.jboss.org/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Done</resolution>
                                        <assignee username="davsclaus">Claus Ibsen</assignee>
                                    <reporter username="nsaad">Nabeel Saad</reporter>
                        <labels>
                    </labels>
                <created>Tue, 1 Oct 2013 11:44:26 -0400</created>
                <updated>Thu, 7 Nov 2013 06:25:32 -0500</updated>
                            <resolved>Mon, 4 Nov 2013 10:37:48 -0500</resolved>
                                    <version>jboss-fuse-6.1</version>
                                    <fixVersion>jboss-fuse-6.1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="12832292" author="nsaad" created="Thu, 3 Oct 2013 12:14:25 -0400"  >&lt;p&gt;In relation to the JMS Topics to Queues, I agree it is not a good idea if you&apos;re just doing request/reply interactions. On those cases we only use queues.&lt;/p&gt;

&lt;p&gt;We do need Topics for a good reason, but you obviously need to know what you&apos;re doing.&lt;br/&gt;
Among these &quot;special&quot; use cases, we have one for instance where we need to have a passive system that is monitoring the traffic, but does not generate responses. Depending on the traffic it scans it may need to react and send alerts. So in this scenario you would have the producer (Fuse) sending traffic to a Topic, then a consumer that generates responses, and the monitoring system that won&apos;t generate responses.&lt;br/&gt;
There are other use cases in need of request to TOPIC, response to QUEUE.&lt;/p&gt;

&lt;p&gt;Find attached the logs where you can see the trace below:&lt;/p&gt;

&lt;p&gt;09:34:32,577 | WARN  | lelogin.gatewaynorth.response] | QueueReplyManager                                            | 201 - org.apache.camel.camel-jms - 2.12.0.redhat-610054 | org.apache.camel.component.jms.reply.QueueReplyManager | Reply received for unknown correlationID &lt;span class=&quot;error&quot;&gt;&amp;#91;Camel-ID-sbox-62042-1380292211076-0-33&amp;#93;&lt;/span&gt;. The message will be ignored: TextMessage={ Header={ JMSMessageID=&lt;/p&gt;
{ID:EMS-SERVER.696522F0ED41D9:62}
&lt;p&gt; JMSDestination=&lt;/p&gt;
{Queue[vf.gig.eu.lifecyclelogin.gatewaynorth.response]}
&lt;p&gt; JMSReplyTo=&lt;/p&gt;
{null} JMSDeliveryMode={NON_PERSISTENT} JMSRedelivered={false} JMSCorrelationID={Camel-ID-sbox-62042-1380292211076-0-33} JMSType={null}
&lt;p&gt; JMSTimestamp=&lt;/p&gt;
{Mon Sep 30 09:34:32 EEST 2013}
&lt;p&gt; JMSExpiration=&lt;/p&gt;
{0}
&lt;p&gt; JMSPriority=&lt;/p&gt;
{4}
&lt;p&gt; } Properties={ port=&lt;/p&gt;
{Integer:-1}
&lt;p&gt; headers={String:Content-Type: application/xml&lt;/p&gt;

&lt;p&gt;Fuse is getting the response with the right correlation ID but can&apos;t internally resolve it to the correspondent exchange.&lt;/p&gt;

&lt;p&gt;This problem is quiet important&lt;/p&gt;</comment>
                            <comment id="12832418" author="nsaad" created="Mon, 14 Oct 2013 17:58:59 -0400"  >&lt;p&gt;Ok, will pass the debug request to Vodafone.&lt;/p&gt;

&lt;p&gt;A bit more feedback from them, if I&apos;m not mistaken, the maven project referenced is found in test2.zip:&lt;/p&gt;

&lt;p&gt;************************&lt;/p&gt;

&lt;p&gt;RH &lt;b&gt;Can you get their configuration, as camel-jms can be configured in many ways.&lt;/b&gt;&lt;br/&gt;
Bruno: I provided a Maven Project that reproduces the problem, there you can see the JMS configuration and all other executed actions.&lt;/p&gt;

&lt;p&gt;RH &lt;b&gt;Also are they using useMessageIDAsCorrelationID=true, as that is not optimal to use (better to not use it)&lt;/b&gt;&lt;br/&gt;
Bruno: no, we&apos;re not using this option, the maven sample provided mimics what our framework does.&lt;/p&gt;

&lt;p&gt;************************&lt;/p&gt;

&lt;p&gt;RH: &lt;b&gt;What are we supposed to see from the notes.txt file?&lt;/b&gt;&lt;br/&gt;
The &quot;notes.txt&quot; simply shows how on build 22 the sample problem is able to process the JMS response and respond to the HTTP client, while logs from build 54 (as it occurs on build 115) show that the JMS response is never processed.&lt;/p&gt;

&lt;p&gt;The &quot;notes.txt&quot; also explains the stub we&apos;re using, the flow is as follows:&lt;br/&gt;
HTTP client &#224; Fuse engine (test2 bundle) &#224; request to EMS topic &#224;JMS stub &#224; response to EMS queue &#224; Fuse engine (test2 bundle) &#224; HTTP client (response)&lt;/p&gt;

&lt;p&gt;************************&lt;/p&gt;

&lt;p&gt;RH: *If the JVM hangs, they should take a thread dump that can aid to see if there is hanging threads or dead-locks or the likes.&lt;br/&gt;
Also they should try JMS request/reply without HTTP. For example from an unit test, or something else. Eg divide and conquer, to narrow down the problem.*&lt;/p&gt;

&lt;p&gt;Apologies, I didn&apos;t have much time, and simply managed to put together a sample project that shows how it succeeds under build 22, but fails with 54 (and 115). I was hoping this is enough evidence for you to understand there is something really misbehaving in the engine, and allows you to track it down.&lt;/p&gt;

&lt;p&gt;************************&lt;/p&gt;

&lt;p&gt;Bruno: will try the netty-http&lt;br/&gt;
 Bruno: we need to use &quot;recipient list&quot;, as &quot;to&quot; does not permit to construct URIs on the fly, which is a feature we require.&lt;/p&gt;</comment>
                            <comment id="12832592" author="nsaad" created="Wed, 30 Oct 2013 11:08:15 -0400"  >&lt;p&gt;Latest debug info on correlation&lt;/p&gt;</comment>
                            <comment id="12832608" author="nsaad" created="Thu, 31 Oct 2013 16:57:43 -0400"  >&lt;p&gt;Also relating to the dual entries, can you confirm that&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;the &quot;DEBUG&quot; line is a standard line that implies that the message has been processed.&lt;/li&gt;
	&lt;li&gt;the &quot;WARN&quot; line highlights that a second message was received and ignored due to fuse no longer expecting a response?&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="12832614" author="davsclaus" created="Fri, 1 Nov 2013 07:15:11 -0400"  >&lt;p&gt;Yes DEBUG and WARN are standard logging messages from camel-jms.&lt;/p&gt;

&lt;p&gt;Though DEBUG means the message has just been received, and was able to be correlated.&lt;br/&gt;
The message hasn&apos;t been fully processed (yet), but that is what is about to happen.&lt;/p&gt;</comment>
                            <comment id="12832626" author="nsaad" created="Fri, 1 Nov 2013 12:57:03 -0400"  >&lt;p&gt;Could you also clarify this comment I made please Claus:&lt;/p&gt;

&lt;p&gt;    Regarding the dual entries in the log relating to the correlation ID, one comment is that it&apos;s the same correlation ID. If you had multiple consumers and they sent back answers to a message, would they all have the same correlation ID? They suggest that The JMS Message ID is populated by the EMS server and it is guaranteed to be unique, that proves that only 1 JMS message is consumed by Fuse, but it is not correlated correctly.&lt;/p&gt;</comment>
                            <comment id="12850508" author="nsaad" created="Mon, 4 Nov 2013 10:37:48 -0500"  >&lt;p&gt;Finally had a consolidated effort from Vodafone and they&apos;ve come back with this info, looks like this issue itself is resolved.. it was partly covered up by another problem, for which I will raise a separate ticket so that we can move on from this one (The new issue is 993).&lt;/p&gt;

&lt;p&gt;*******************************************************&lt;/p&gt;

&lt;p&gt;Hi Nabeel,&lt;/p&gt;

&lt;p&gt;I&#8217;ve been testing as agreed using both TIBCO EMS, and ActiveMQ.&lt;br/&gt;
And my final observations have been the following:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;On build 22, it works.&lt;/li&gt;
	&lt;li&gt;On build 54, it does not work.&lt;/li&gt;
	&lt;li&gt;On build 119, it works.&lt;/li&gt;
	&lt;li&gt;On build 120, it works.&lt;/li&gt;
	&lt;li&gt;On build 137, it works.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;The above applies to both TIBCO EMS and ActiveMQ, so at least this proves there is consistency between different brokers.&lt;/p&gt;

&lt;p&gt;Unfortunately we are all different parties and not all of us test all the versions, I&#8217;ve been mainly testing with version 22 and 54.&lt;br/&gt;
After aligning with the development team, we concluded the problem was getting some interference from a second problem. So we were actually facing 2 problems.&lt;/p&gt;

&lt;p&gt;The first one is the topic/queue interaction problem we&#8217;ve been discussing. That was a real problem reproducible on build 54 (both using ActiveMQ and EMS), but gone at least in build 119 onwards.&lt;br/&gt;
So this is good news because we should perfectly able to run request/response interactions using topics and queues.&lt;br/&gt;
We&#8217;re sorry we kept insisting the problem was still there on 119 onwards when it wasn&#8217;t, but this was actually due to the second problem I now follow to explain.&lt;/p&gt;</comment>
                            <comment id="12921213" author="nsaad" created="Thu, 7 Nov 2013 06:25:32 -0500"  >&lt;p&gt;This and the subsequent issue were closed. &lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12367322" name="JmsInOutExclusiveTopicTest.java" size="3608" author="davsclaus" created="Thu, 31 Oct 2013 09:49:26 -0400"/>
                            <attachment id="12367299" name="camel-jms-diff.txt" size="12342" author="davsclaus" created="Sun, 13 Oct 2013 10:02:59 -0400"/>
                            <attachment id="12367293" name="correlation_issue.log" size="41636" author="nsaad" created="Thu, 3 Oct 2013 12:14:54 -0400"/>
                            <attachment id="12367319" name="fuse_topic_correlation_issue.txt" size="53804" author="nsaad" created="Wed, 30 Oct 2013 11:08:15 -0400"/>
                            <attachment id="12367296" name="notes.txt" size="2614" author="nsaad" created="Fri, 11 Oct 2013 15:43:38 -0400"/>
                            <attachment id="12367302" name="test2-claus.zip" size="15988" author="davsclaus" created="Wed, 16 Oct 2013 10:23:52 -0400"/>
                            <attachment id="12367295" name="test2.zip" size="20951" author="nsaad" created="Fri, 11 Oct 2013 15:43:38 -0400"/>
                            <attachment id="12367303" name="test3-claus.zip" size="9290" author="davsclaus" created="Wed, 16 Oct 2013 10:23:52 -0400"/>
                            <attachment id="12367305" name="vodaphone.jmx" size="4726" author="davsclaus" created="Wed, 16 Oct 2013 10:23:52 -0400"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310641" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Number of attachments</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310640" key="com.atlassian.jira.toolkit:comments">
                        <customfieldname>Number of comments</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>8.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311940" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1|hzjkbr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310840" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>174437</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>