<!-- 
RSS generated by JIRA (6.4.11#64026-sha1:78f6ec473a3f058bd5d6c30e9319c7ab376bdb9c) at Thu Dec 22 14:20:43 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://jira.spring.io/si/jira.issueviews:issue-xml/SGF-168/SGF-168.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>Spring JIRA</title>
    <link>https://jira.spring.io</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.4.11</version>
        <build-number>64026</build-number>
        <build-date>25-08-2015</build-date>
    </build-info>

<item>
            <title>[SGF-168] Race condition when using Spring data gemfire with tc Server parallel deployment</title>
                <link>https://jira.spring.io/browse/SGF-168</link>
                <project id="10462" key="SGF">Spring Data GemFire</project>
                    <description>&lt;p&gt;We have multiple web applications running under tc Server 2.8. Each webapp uses a common gemfire cache and replicated region. Since we cannot control the order that webapps are deployed, each webapp is configured to create the cache and region using Spring data gemfire (spring dependency injection). This works fine when starting up tc Server with the webapps deploying sequentially. However, if we set startStopThreads=0 in the tc Server server.xml so that the webapps are deployed in parallel, there is a race condition in creating the gemfire cache. Getting error:&lt;/p&gt;

&lt;p&gt;com.gemstone.gemfire.cache.CacheClosedException: The cache is closed.&lt;/p&gt;

&lt;p&gt;Unfortunately, using spring data gemfire to create the cache and region, there is no way to synchronize this. I believe the underlying gemfire code should be synchronized to avoid this problem.&lt;/p&gt;

&lt;p&gt;Usign startStopThreads=0 reduces our startup time by 50% so this is very useful. &lt;/p&gt;

&lt;p&gt;To replicate this problem, create two or more web applications, which create a common cache and region using spring data gemfire, and deploy them in tc Server. Enable startStopThreads=0 and startup tc Server on a machine with multiple CPUs or cores. You might have to do this a few times to get the error.&lt;/p&gt;</description>
                <environment></environment>
        <key id="47856">SGF-168</key>
            <summary>Race condition when using Spring data gemfire with tc Server parallel deployment</summary>
                <type id="1" iconUrl="https://jira.spring.io/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://jira.spring.io/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://jira.spring.io/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dturanski">David Turanski</assignee>
                                    <reporter username="nchaudhry">Naveed Chaudhry</reporter>
                        <labels>
                    </labels>
                <created>Wed, 20 Mar 2013 02:48:04 +0000</created>
                <updated>Mon, 23 May 2016 20:53:32 +0000</updated>
                            <resolved>Tue, 6 Aug 2013 06:08:30 +0000</resolved>
                                                    <fixVersion>1.3.2</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="89450" author="dturanski" created="Wed, 17 Apr 2013 08:25:04 +0000"  >&lt;p&gt;I&apos;m not able to reproduce this so far on MacBook Pro with 4 cores. Here, the gemfire initialization always happens on a single thread with startStopThreads=0, I&apos;ve tested with GemFire 6.6.3 and GemFire 7.0.1. &lt;/p&gt;</comment>
                            <comment id="92001" author="mike.roda@sas.com" created="Tue, 23 Jul 2013 07:48:06 +0000"  >&lt;p&gt;David, I am guessing you had the gemfire.jar under WEB-INF/lib. Make sure it is in the server lib so all the webapps are sharing the same cache.  Seems pretty clear the problem is here:&lt;/p&gt;

&lt;p&gt;org.springframework.data.gemfire.RegionLookupFactoryBean:53&lt;/p&gt;

&lt;p&gt;    if (this.region != null) &lt;/p&gt;
{
      this.log.info(&quot;Retrieved region [&quot; + this.name + &quot;] from cache&quot;);
    }
&lt;p&gt;    else&lt;/p&gt;
    {
      this.region = lookupFallback(this.cache, this.name);
    }

&lt;p&gt;Unless that is somehow synchronized across all the threads, it&apos;s going to be a race condition. Note that we have the gemfire.jar in the server lib but the spring-data-gemfire.jar in the WEB-INF/lib.&lt;/p&gt;</comment>
                            <comment id="92005" author="mike.roda@sas.com" created="Tue, 23 Jul 2013 09:14:28 +0000"  >&lt;p&gt;I submitted a pull request for this on github.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="21110" name="sas_gemfire_config.xml" size="2588" author="nchaudhry" created="Wed, 20 Mar 2013 02:48:04 +0000"/>
                            <attachment id="21111" name="server.log" size="26328" author="nchaudhry" created="Wed, 20 Mar 2013 02:48:04 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_10170" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>First Response Date</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 17 Apr 2013 08:25:04 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10280" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>34384</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_10182" key="com.atlassian.jira.toolkit:lastupdaterorcommenter">
                        <customfieldname>Last updater</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>jblum</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10880" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0674n:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_10380" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>36193</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_10381" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Ranking</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>34086</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10171" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>