<!-- 
RSS generated by JIRA (6.4.11#64026-sha1:78f6ec473a3f058bd5d6c30e9319c7ab376bdb9c) at Fri Dec 23 05:13:50 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://jira.spring.io/si/jira.issueviews:issue-xml/SECOAUTH-295/SECOAUTH-295.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>Spring JIRA</title>
    <link>https://jira.spring.io</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.4.11</version>
        <build-number>64026</build-number>
        <build-date>25-08-2015</build-date>
    </build-info>

<item>
            <title>[SECOAUTH-295] Oauth2 AuthorizationEndpoint ignores user approval flag for implicit grant</title>
                <link>https://jira.spring.io/browse/SECOAUTH-295</link>
                <project id="10440" key="SECOAUTH">Spring Security OAuth</project>
                    <description>&lt;p&gt;The current implementation of the AuthorizationEndpoint contains a method &quot;approveOrDeny&quot; that is used to redirect a client based on the UsersApproval.  It currently does not test the result of such approval leading to all possible requests being issued a token/code regardless of the users approval decision, as per code below:&lt;/p&gt;

&lt;p/&gt;
&lt;div id=&quot;syntaxplugin&quot; class=&quot;syntaxplugin&quot; style=&quot;border: 1px dashed #bbb; border-radius: 5px !important; overflow: auto; max-height: 30em;&quot;&gt;
&lt;table cellspacing=&quot;0&quot; cellpadding=&quot;0&quot; border=&quot;0&quot; width=&quot;100%&quot; style=&quot;font-size: 1em; line-height: 1.4em !important; font-weight: normal; font-style: normal; color: black;&quot;&gt;
		&lt;tbody &gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;  margin-top: 10px;   width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;			authorizationRequest = authorizationRequest.addApprovalParameters(approvalParameters);&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;			authorizationRequest = resolveRedirectUriAndCheckApproval(authorizationRequest, (Authentication) principal);&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;			if (responseTypes.contains(&quot;token&quot;)) {&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;				return getImplicitGrantResponse(authorizationRequest).getView();&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;			}&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   margin-bottom: 10px;  width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;			return getAuthorizationCodeResponse(authorizationRequest, (Authentication) principal);&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
			&lt;/tbody&gt;
&lt;/table&gt;
&lt;/div&gt;
&lt;p/&gt;

&lt;p&gt;It is suggested that the above snippet is replaced with (tested locally and conforms to latest draft spec):&lt;/p&gt;

&lt;p/&gt;
&lt;div id=&quot;syntaxplugin&quot; class=&quot;syntaxplugin&quot; style=&quot;border: 1px dashed #bbb; border-radius: 5px !important; overflow: auto; max-height: 30em;&quot;&gt;
&lt;table cellspacing=&quot;0&quot; cellpadding=&quot;0&quot; border=&quot;0&quot; width=&quot;100%&quot; style=&quot;font-size: 1em; line-height: 1.4em !important; font-weight: normal; font-style: normal; color: black;&quot;&gt;
		&lt;tbody &gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;  margin-top: 10px;   width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;			authorizationRequest = authorizationRequest.addApprovalParameters(approvalParameters);&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;			authorizationRequest = resolveRedirectUriAndCheckApproval(authorizationRequest, (Authentication) principal);&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;			if (authorizationRequest.isApproved()) {&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;				if (responseTypes.contains(&quot;token&quot;)) {&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;					return getImplicitGrantResponse(authorizationRequest).getView();&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;				}&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;				return getAuthorizationCodeResponse(authorizationRequest, (Authentication) principal);&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;			}&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;			return new RedirectView(getUnsuccessfulRedirect(authorizationRequest, OAuth2Exception.create(OAuth2Exception.ACCESS_DENIED, &quot;User denied access&quot;),&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   margin-bottom: 10px;  width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;					true), false);&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
			&lt;/tbody&gt;
&lt;/table&gt;
&lt;/div&gt;
&lt;p/&gt;

&lt;p&gt;Thanks - G.&lt;/p&gt;
</description>
                <environment></environment>
        <key id="43956">SECOAUTH-295</key>
            <summary>Oauth2 AuthorizationEndpoint ignores user approval flag for implicit grant</summary>
                <type id="1" iconUrl="https://jira.spring.io/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://jira.spring.io/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://jira.spring.io/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="8">Complete</resolution>
                                        <assignee username="david_syer">Dave Syer</assignee>
                                    <reporter username="miniman42">Greg Balmer</reporter>
                        <labels>
                    </labels>
                <created>Wed, 20 Jun 2012 10:51:24 +0000</created>
                <updated>Fri, 22 Jun 2012 08:37:50 +0000</updated>
                            <resolved>Fri, 22 Jun 2012 06:02:32 +0000</resolved>
                                    <version>1.0.0.M6</version>
                                    <fixVersion>1.0.0.RC1</fixVersion>
                                    <component>OAuth 2</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                    <timeoriginalestimate seconds="0">0d</timeoriginalestimate>
                            <timeestimate seconds="0">0d</timeestimate>
                                        <comments>
                            <comment id="80849" author="david_syer" created="Thu, 21 Jun 2012 01:11:57 +0000"  >&lt;p&gt;I think if you look in the resolveRedirectUriAndCheckApproval() method (which is called) you will find that the approved flag is checked there.  So I think this is invalid, but please come back if you think I am wrong.&lt;/p&gt;</comment>
                            <comment id="80855" author="miniman42" created="Thu, 21 Jun 2012 02:44:56 +0000"  >&lt;p&gt;You are correct in that it does call resolveRedirectUriAndCheckApproval(...) and that does in turn check the isApproved()... the problem is that resolveRedirectUriAndCheckApproval returns the authorization request (unapproved) to the approveOrDeny(...) method which grants the token/code regardless of the approval state!!&lt;/p&gt;</comment>
                            <comment id="80857" author="david_syer" created="Thu, 21 Jun 2012 03:32:13 +0000"  >&lt;p&gt;I see.  In the auth code case there is a check in generateCode(), but that path is not taken in the implicit case.&lt;/p&gt;

&lt;p&gt;I fixed it by moving that code block into the approveOrDeny() handler method (i.e. use an exception to signal the result not a View as in your solution).  Does that work now?&lt;/p&gt;</comment>
                            <comment id="80865" author="miniman42" created="Thu, 21 Jun 2012 06:34:23 +0000"  >&lt;p&gt;Hi Dave, your solution now works from the point of view that it will not create the token, however it fails to conform with the spec and returns a 400 error page to the browser which impacts on the implicit grant flow e.g.&lt;/p&gt;

&lt;p&gt;&quot;&quot;&lt;br/&gt;
OAuth Error&lt;/p&gt;

&lt;p&gt;error=&quot;access_denied&quot;, error_description=&quot;The authorization hasn&apos;t been approved by the current user.&quot; &lt;br/&gt;
&quot;&quot;&lt;/p&gt;

&lt;p&gt;I still think it is necessary to return the redirect view, as in section 4.2 (Implicit Grant) of the latest draft (&lt;a href=&quot;http://tools.ietf.org/html/draft-ietf-oauth-v2-28&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://tools.ietf.org/html/draft-ietf-oauth-v2-28&lt;/a&gt;) subsection 4.2.2.1 (Error Response) it states that &lt;/p&gt;

&lt;p&gt;&quot;&quot;&lt;br/&gt;
If the resource owner denies the access request or if the request&lt;br/&gt;
   fails for reasons other than a missing or invalid redirection URI,&lt;br/&gt;
   the authorization server informs the client by adding the following&lt;br/&gt;
   parameters to the fragment component of the redirection URI using the&lt;br/&gt;
   &quot;application/x-www-form-urlencoded&quot; format:&lt;br/&gt;
error&lt;br/&gt;
         REQUIRED.  A single ASCII &lt;span class=&quot;error&quot;&gt;&amp;#91;USASCII&amp;#93;&lt;/span&gt; error code from the&lt;br/&gt;
         following:&lt;br/&gt;
...&lt;br/&gt;
         access_denied&lt;br/&gt;
               The resource owner or authorization server denied the&lt;br/&gt;
               request.&lt;br/&gt;
...&lt;br/&gt;
 For example, the authorization server redirects the user-agent by&lt;br/&gt;
   sending the following HTTP response:&lt;br/&gt;
 HTTP/1.1 302 Found&lt;br/&gt;
   Location: &lt;a href=&quot;https://client.example.com/cb#error=access_denied&amp;amp;state=xyz&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://client.example.com/cb#error=access_denied&amp;amp;state=xyz&lt;/a&gt;&lt;br/&gt;
&quot;&quot;&lt;/p&gt;

&lt;p&gt;Thanks - G&lt;/p&gt;</comment>
                            <comment id="80868" author="david_syer" created="Thu, 21 Jun 2012 06:56:16 +0000"  >&lt;p&gt;Good point.  So we need to return a RedirectView if the response type is &quot;token&quot;, but throw an exception otherwise.  That&apos;s the change I just made anyway, but the tonr2 implicit client demo (/browse.html) doesn&apos;t work very well - maybe it needs to have an error handler added to the client scipt?  What do you think?&lt;/p&gt;</comment>
                            <comment id="80876" author="miniman42" created="Thu, 21 Jun 2012 09:03:55 +0000"  >&lt;p&gt;Hey Dave, &lt;/p&gt;

&lt;p&gt;It&apos;s not just for type token &lt;img class=&quot;emoticon&quot; src=&quot;https://jira.spring.io/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;. &lt;/p&gt;

&lt;p&gt;The error response for type &quot;code&quot; (section 4.1.2.1) is also a 302 redirect i.e same as &quot;token&quot; error response.&lt;/p&gt;

&lt;p&gt;Thanks - G.&lt;/p&gt;</comment>
                            <comment id="80908" author="david_syer" created="Fri, 22 Jun 2012 06:02:31 +0000"  >&lt;p&gt;OK, that makes sense too - the client app gets a chance to handle the error.  Try again now.&lt;/p&gt;</comment>
                            <comment id="80913" author="miniman42" created="Fri, 22 Jun 2012 08:37:50 +0000"  >&lt;p&gt;Sweet, All works now. Thanks - G.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_10170" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>First Response Date</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 21 Jun 2012 01:11:57 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10280" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>31257</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10880" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i05nw7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_10380" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>33077</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_10381" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Ranking</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>30957</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10171" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>