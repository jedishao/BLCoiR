<!-- 
RSS generated by JIRA (6.4.11#64026-sha1:78f6ec473a3f058bd5d6c30e9319c7ab376bdb9c) at Thu Dec 22 10:44:27 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://jira.spring.io/si/jira.issueviews:issue-xml/AMQP-546/AMQP-546.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>Spring JIRA</title>
    <link>https://jira.spring.io</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.4.11</version>
        <build-number>64026</build-number>
        <build-date>25-08-2015</build-date>
    </build-info>

<item>
            <title>[AMQP-546] Closing the CachingConnectionFactory at application context close is too abrupt</title>
                <link>https://jira.spring.io/browse/AMQP-546</link>
                <project id="10450" key="AMQP">Spring AMQP</project>
                    <description>&lt;p&gt;From version 1.5 and onwards the CachingConnectionFactory will not allow any connections to be created once the application context has been closed. This is implemented by closing the connection factory as soon as closing of the application context is &lt;em&gt;initiated&lt;/em&gt; (when the ContextClosedEvent is fired).&lt;/p&gt;

&lt;p&gt;This is quite abrupt and causes problems for code that may want to process requests and publish messages while the application context is still in it&apos;s closing stage.&lt;/p&gt;

&lt;p&gt;As an example we use spring-integration AMQP components (AmqpInboundChannelAdapter) for consuming inbound messages and these components implement the Spring &lt;tt&gt;SmartLifeCycle&lt;/tt&gt;. This means that message consumers are not stopped until you reach the life-cycle processing stage in the application context closing (which happens after the ContextClosedEvent is fired). This causes problems as you cannot easily prevent incoming messages from arriving but you cannot send any outbound messages (since the connection factory is already closed). &lt;/p&gt;

&lt;p&gt;For us this is major issue since it now limits our possibility to perform a graceful shutdown of our application, which worked well with prior versions.&lt;/p&gt;

&lt;p&gt;If closing is really required then I think it could make sense to defer it to a later stage by e.g. implementing Spring &lt;tt&gt;SmartLifeCycle&lt;/tt&gt; and use the stop() method. Combined with a configurable phase that would give us the possibility to co-ordinate the closing with other components that should be stopped before we let the application context start destroying beans.&lt;/p&gt;</description>
                <environment></environment>
        <key id="66732">AMQP-546</key>
            <summary>Closing the CachingConnectionFactory at application context close is too abrupt</summary>
                <type id="1" iconUrl="https://jira.spring.io/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://jira.spring.io/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://jira.spring.io/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="8">Complete</resolution>
                                        <assignee username="grussell">Gary Russell</assignee>
                                    <reporter username="nulstruls">Magnus Isfelt</reporter>
                        <labels>
                            <label>PullRequest</label>
                            <label>regression</label>
                    </labels>
                <created>Sat, 14 Nov 2015 00:54:00 +0000</created>
                <updated>Wed, 23 Dec 2015 19:44:40 +0000</updated>
                            <resolved>Wed, 18 Nov 2015 15:57:24 +0000</resolved>
                                    <version>1.5 GA</version>
                    <version>1.5.1</version>
                                    <fixVersion>1.5.3</fixVersion>
                                    <component>RabbitMQ</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="121565" author="grussell" created="Sat, 14 Nov 2015 04:35:39 +0000"  >&lt;p&gt;Thanks for reporting this; clearly the previous behavior (&lt;a href=&quot;https://jira.spring.io/browse/AMQP-496&quot; title=&quot;Some threads are not interrupted when Workers did not finish before shutdownTimeout&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQP-496&quot;&gt;&lt;del&gt;AMQP-496&lt;/del&gt;&lt;/a&gt;) was wrong. However, you are correct in that the &lt;tt&gt;ContextClosedEvent&lt;/tt&gt; is published before the &lt;tt&gt;Lifecyle.stop()&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;The &lt;tt&gt;CachingConnectionFactory&lt;/tt&gt; should implement &lt;tt&gt;SmartLifecyle&lt;/tt&gt; and be stopped in a late phase so other beans can clean up.&lt;/p&gt;

&lt;p&gt;Unfortunately, we just released 1.5.2 today so we will need to address this in 1.5.3.&lt;/p&gt;</comment>
                            <comment id="121709" author="grussell" created="Wed, 18 Nov 2015 16:01:40 +0000"  >&lt;p&gt;&lt;a href=&quot;https://jira.spring.io/secure/ViewProfile.jspa?name=nulstruls&quot; class=&quot;user-hover&quot; rel=&quot;nulstruls&quot;&gt;Magnus Isfelt&lt;/a&gt; The fix is in 1.5.3.BUILD-SNAPSHOT, available in repo.spring.io/snapshots.&lt;/p&gt;

&lt;p&gt;You can test with this but I would not recommend using a snapshot in production.&lt;/p&gt;

&lt;p&gt;Let us know when you need a release and we&apos;ll try to accommodate.&lt;/p&gt;</comment>
                            <comment id="121723" author="nulstruls" created="Thu, 19 Nov 2015 11:22:25 +0000"  >&lt;p&gt;Thanks a lot for fixing this so quickly!&lt;/p&gt;

&lt;p&gt;We currently have a workaround for the problem so it is not super-urgent if you want to push more things into the 1.5.3 release.&lt;/p&gt;</comment>
                            <comment id="122684" author="grussell" created="Wed, 23 Dec 2015 19:44:40 +0000"  >&lt;p&gt;1.5.3 is now available.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10151">
                    <name>Relate</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="63637">AMQP-496</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_10170" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>First Response Date</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sat, 14 Nov 2015 04:35:39 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10280" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_10684" key="com.atlassian.jira.plugin.system.customfieldtypes:url">
                        <customfieldname>Pull Request URL</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[https://github.com/spring-projects/spring-amqp/pull/341]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_10880" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i08win:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_10380" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_10381" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Ranking</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10171" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>