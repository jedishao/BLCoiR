<!-- 
RSS generated by JIRA (6.4.11#64026-sha1:78f6ec473a3f058bd5d6c30e9319c7ab376bdb9c) at Fri Dec 23 11:01:39 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://jira.spring.io/si/jira.issueviews:issue-xml/SEC-1735/SEC-1735.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>Spring JIRA</title>
    <link>https://jira.spring.io</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.4.11</version>
        <build-number>64026</build-number>
        <build-date>25-08-2015</build-date>
    </build-info>

<item>
            <title>[SEC-1735] Logged out immediately after logging in on some browsers</title>
                <link>https://jira.spring.io/browse/SEC-1735</link>
                <project id="10040" key="SEC">Spring Security</project>
                    <description>&lt;p&gt;This bug is closely related to &lt;a href=&quot;https://jira.spring.io/browse/SEC-1587&quot; title=&quot;HttpSessionSecurityContextRepository should clear session context when current context is anonmous or empty&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SEC-1587&quot;&gt;&lt;del&gt;SEC-1587&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
I start at my log in screen, log into the system, see the logged in view and then the next navigation I make I end up being redirect back to the login screen.&lt;br/&gt;
It happens periodly, not every time.  It happens the most when using Internet Explorer 6.&lt;br/&gt;
After I debugged the problem I figured out that the httpSession.removeAttribute(SPRING_SECURITY_CONTEXT_KEY); call in HttpSessionSecurityContextRepository was destroying my newly created authentication object.&lt;br/&gt;
Here&apos;s how it happens:&lt;br/&gt;
1. Browser requests jsf.js.faces during the loading of the login screen.  This request passes through the httpSessionContextIntegrationFilter along with all .faces requests.&lt;br/&gt;
2. Browser holds on to connection after getting the javascript file.  (Browsers do this as an optimization to prevent lots of new tcp connects)&lt;br/&gt;
3. I log into my app from the login page.  This adds the security context to the session.&lt;br/&gt;
4. Browser makes another javascript request from the open connection which causes the thread working on jsf.js.faces to finish up (come back out through the filters)&lt;br/&gt;
5. On the request thread of jsf.js.faces the original security context had a null authenication so httpSession.removeAttribute(SPRING_SECURITY_CONTEXT_KEY); is called which wipes up the new authenication.&lt;/p&gt;

&lt;p&gt;I&apos;ve worked around the problem by created my own version of HttpSessionSecurityContextRepository and just changing the lines:&lt;br/&gt;
                if (httpSession != null) &lt;/p&gt;
{
                    // SEC-1587 A non-anonymous context may still be in the session
                    httpSession.removeAttribute(SPRING_SECURITY_CONTEXT_KEY);
                }&lt;br/&gt;
                return;&lt;br/&gt;
&lt;br/&gt;
to&lt;br/&gt;
&lt;br/&gt;
                if (httpSession != null &amp;amp;&amp;amp; contextHashBeforeChainExecution != -1) {                    // SEC-1587 A non-anonymous context may still be in the session                    httpSession.removeAttribute(SPRING_SECURITY_CONTEXT_KEY);                }
&lt;p&gt;                return;&lt;/p&gt;

&lt;p&gt;This means that the security context is only reset if there was one at the beginning of the request. (Hash of -1 means no authenication)&lt;/p&gt;</description>
                <environment>Tomcat 6, MyFaces 2.0.X, Richfaces 4.0.0.Final.&lt;br/&gt;
Internet Explorer as client</environment>
        <key id="37840">SEC-1735</key>
            <summary>Logged out immediately after logging in on some browsers</summary>
                <type id="1" iconUrl="https://jira.spring.io/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://jira.spring.io/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://jira.spring.io/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rwinch">Rob Winch</assignee>
                                    <reporter username="jgoodfellow">James G</reporter>
                        <labels>
                    </labels>
                <created>Mon, 9 May 2011 11:01:31 +0000</created>
                <updated>Sat, 6 Feb 2016 06:17:11 +0000</updated>
                            <resolved>Fri, 30 Dec 2011 14:47:48 +0000</resolved>
                                    <version>3.0.5</version>
                    <version>3.1.0</version>
                                    <fixVersion>3.0.8</fixVersion>
                    <fixVersion>3.1.1</fixVersion>
                                    <component>Web</component>
                        <due></due>
                            <votes>2</votes>
                                    <watches>6</watches>
                                                                <comments>
                            <comment id="68501" author="rwinch" created="Sun, 17 Jul 2011 16:29:43 +0000"  >&lt;p&gt;In general I can see how this would happen.&lt;/p&gt;

&lt;p&gt;1) The login page loads and makes an asynchronous request (i.e. javascript, css, image, etc)&lt;br/&gt;
2) In the meantime, a user submits their credentials before the asynchronous request completes&lt;br/&gt;
3) After the user has logged in, the asynchronous request (with anonymous authentication) completes and removes the authentication established in #2.&lt;/p&gt;

&lt;p&gt;Can you confirm that this is a generalization of what is happening?&lt;/p&gt;</comment>
                            <comment id="68502" author="jgoodfellow" created="Sun, 17 Jul 2011 17:31:31 +0000"  >&lt;p&gt;Yes, that is exactly it.  I just want to point out that ie6 seems to prevent the completion of some asynchronous requests until it reuses the connection to do another request.  (for example load another javascript file).&lt;br/&gt;
Thank you.&lt;/p&gt;</comment>
                            <comment id="73348" author="msiegel" created="Fri, 2 Dec 2011 06:24:03 +0000"  >&lt;p&gt;i got the same problems with Tomcat 6 and Icefaces 1.8 in every browser. In the moment im using also the workaround.&lt;/p&gt;</comment>
                            <comment id="74326" author="rwinch" created="Fri, 30 Dec 2011 14:47:48 +0000"  >&lt;p&gt;Thanks for the bug submission. I have pushed a fix to master and the 3.0.x branch. The fix I checked in is a bit different than the orional proposal to ensure it works with other implementations of SecurityContexts.&lt;/p&gt;</comment>
                            <comment id="108866" author="rwinch" created="Tue, 21 Oct 2014 11:15:34 +0000"  >&lt;p&gt;Related &lt;a href=&quot;https://github.com/spring-projects/spring-security/issues/142&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/spring-projects/spring-security/issues/142&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="124678" author="issuemaster" created="Sat, 6 Feb 2016 06:17:11 +0000"  >&lt;p&gt;This issue has been migrated to &lt;a href=&quot;https://github.com/spring-projects/spring-security/issues/1972&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/spring-projects/spring-security/issues/1972&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10151">
                    <name>Relate</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="60293">SEC-2742</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_10170" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>First Response Date</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sun, 17 Jul 2011 16:29:43 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10280" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2155</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10880" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i00kpj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_10380" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3400</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_10381" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Ranking</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4800</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10171" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>