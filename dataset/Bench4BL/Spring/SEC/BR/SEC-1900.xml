<!-- 
RSS generated by JIRA (6.4.11#64026-sha1:78f6ec473a3f058bd5d6c30e9319c7ab376bdb9c) at Fri Dec 23 11:39:25 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://jira.spring.io/si/jira.issueviews:issue-xml/SEC-1900/SEC-1900.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>Spring JIRA</title>
    <link>https://jira.spring.io</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.4.11</version>
        <build-number>64026</build-number>
        <build-date>25-08-2015</build-date>
    </build-info>

<item>
            <title>[SEC-1900] sec:authorize ifAllGranted does not work if Authorities are deprecated GrantedAuthorityImpl</title>
                <link>https://jira.spring.io/browse/SEC-1900</link>
                <project id="10040" key="SEC">Spring Security</project>
                    <description>&lt;p&gt;&amp;lt;sec:authorize ifAllGranted=&quot;ROLE_ADMIN&quot;&amp;gt;&lt;/p&gt;

&lt;p&gt;did not work for me after upgrading to 3.1.0 &lt;/p&gt;

&lt;p&gt;reason: i added some role manually in my own UserDetails like this:&lt;/p&gt;

&lt;p&gt;  GrantedAuthority granted = new GrantedAuthorityImpl(rolle.toString());&lt;br/&gt;
  authorities.add(granted);&lt;/p&gt;

&lt;p&gt;GrantedAuthorityImpl is deprecated and ifAllGranted, too. But i think it is still a bug.&lt;/p&gt;

&lt;p&gt;You can fix it by using simpleGrantedAuthority&lt;/p&gt;

&lt;p&gt;GrantedAuthority granted = new SimpleGrantedAuthority(rolle.toString());&lt;br/&gt;
authorities.add(granted);&lt;/p&gt;


&lt;p&gt;the bug is somewhere in the Collection class in an equals method. It checks if the containing element is of class SimpleGrantedAuthority.&lt;/p&gt;

</description>
                <environment></environment>
        <key id="41896">SEC-1900</key>
            <summary>sec:authorize ifAllGranted does not work if Authorities are deprecated GrantedAuthorityImpl</summary>
                <type id="1" iconUrl="https://jira.spring.io/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://jira.spring.io/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://jira.spring.io/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="8">Complete</resolution>
                                        <assignee username="rwinch">Rob Winch</assignee>
                                    <reporter username="janning">Janning Vygen</reporter>
                        <labels>
                    </labels>
                <created>Wed, 25 Jan 2012 11:19:35 +0000</created>
                <updated>Sat, 6 Feb 2016 06:18:58 +0000</updated>
                            <resolved>Sun, 22 Apr 2012 20:23:49 +0000</resolved>
                                    <version>3.1.0</version>
                                    <fixVersion>3.1.1</fixVersion>
                                    <component>Taglibs</component>
                        <due></due>
                            <votes>5</votes>
                                    <watches>4</watches>
                                                                <comments>
                            <comment id="75633" author="erikrj" created="Thu, 9 Feb 2012 01:26:33 +0000"  >&lt;p&gt;I ran into this same bug tonight while upgrading to Spring 3.1.0. This issue prevents the following tag from working when using the SwitchUserFilter&lt;/p&gt;

&lt;p&gt;&amp;lt;security:authorize ifAllGranted=&quot;ROLE_PREVIOUS_ADMINISTRATOR&quot;&amp;gt;&lt;/p&gt;

&lt;p&gt;We unfortunately use this heavily in our JSP files. I had to change to using ifAnyGranted which did work for most scenarios in our code base. &lt;/p&gt;

&lt;p&gt;This bug is on line 135 of AbstractAuthorizeTag which looks like&lt;/p&gt;

&lt;p&gt;if (!granted.containsAll(toAuthorities(getIfAllGranted()))) {&lt;/p&gt;

&lt;p&gt;The problem is the &quot;equals()&quot; method being used on the GrantedAuthority instances. When comparing GrantedAuthorityImpl or SwitchUserGrantedAuthority to a SimpleGrantedAuthority, it will fail every time. The code likely should be comparing role names instead.&lt;/p&gt;</comment>
                            <comment id="75772" author="chilmers" created="Mon, 13 Feb 2012 13:28:52 +0000"  >&lt;p&gt;Just ran into this same problem, but when using a JPA based user service with home grown entities extending UserDetails and GrantedAuthority.&lt;/p&gt;

&lt;p&gt;I also found that the problem is in SimpleGrantedAuthority.equals(Object obj)&lt;/p&gt;

&lt;p&gt;    public boolean equals(Object obj) {&lt;br/&gt;
        if (this == obj) &lt;/p&gt;
{
            return true;
        }

&lt;p&gt;        if (obj instanceof SimpleGrantedAuthority) &lt;/p&gt;
{
            return role.equals(((SimpleGrantedAuthority) obj).role);
        }

&lt;p&gt;        return false;&lt;br/&gt;
    }&lt;/p&gt;


&lt;p&gt;IMHO this code:&lt;/p&gt;

&lt;p&gt;if (obj instanceof SimpleGrantedAuthority) {&lt;br/&gt;
            return role.equals(((SimpleGrantedAuthority) obj).role);&lt;br/&gt;
}&lt;/p&gt;

&lt;p&gt;should have been something like...&lt;/p&gt;

&lt;p&gt;if (obj instanceof GrantedAuthority) {&lt;br/&gt;
            return role.equals(((GrantedAuthority) obj).getAuthority());&lt;br/&gt;
}&lt;/p&gt;

&lt;p&gt;so it will be possible to compare with something else than SimpleGrantedAuthority.&lt;/p&gt;

&lt;p&gt;If that is not possible for some reason, the containsAll on AbstractAuthorizeTag need to be fixed in another fashion as Erik says.&lt;/p&gt;

&lt;p&gt;I think I would personally go for the equals fix in SimpleGrantedAuthority.&lt;/p&gt;



</comment>
                            <comment id="75773" author="chilmers" created="Mon, 13 Feb 2012 14:08:44 +0000"  >&lt;p&gt;Another maybe even simpler fix could be to just flip the order of the collections on AbstractAuthorizeTag:135&lt;/p&gt;

&lt;p&gt;if (!granted.containsAll(toAuthorities(getIfAllGranted()))) {&lt;/p&gt;

&lt;p&gt;to &lt;/p&gt;

&lt;p&gt;if (!toAuthorities(getIfAllGranted()).containsAll(granted)) {&lt;/p&gt;

&lt;p&gt;in that way one can implement the needed logic in the objects of the granted array, which you have control over.&lt;br/&gt;
Would probably give a bigger impact on existing aplpicaitons though.&lt;/p&gt;</comment>
                            <comment id="75775" author="chilmers" created="Mon, 13 Feb 2012 15:15:01 +0000"  >&lt;p&gt;The idea in the last comment will not work since it also changes the semantics.&lt;br/&gt;
I realized that A.containsAll(B) is NOT semantically equivalent to B.containsAll(A)&lt;/p&gt;

&lt;p&gt;So probably it would still be interesting to consider changing the equals method of SimpleGrantedAuthority. That method makes no sense if SimpleGrantedAuthority is to seen as/compared as a GrantedAuthority and used in conjunction with other GrantedAuthority implementations.&lt;/p&gt;</comment>
                            <comment id="75779" author="chilmers" created="Mon, 13 Feb 2012 16:16:43 +0000"  >&lt;p&gt;Sorry for spamming the thread but this solution seems to work pretty well and is consistent with the solution for the two other attributes ifAnyGranted and ifNotGranted already in AbstractAuthorizeTag:&lt;/p&gt;


&lt;p&gt;        /* Original code from AbstractAuthorizeTag:134&lt;/p&gt;

&lt;p&gt;        if (hasTextAllGranted) {&lt;br/&gt;
            if (!granted.containsAll(toAuthorities(getIfAllGranted()))) &lt;/p&gt;
{
                return false;
            }&lt;br/&gt;
        }&lt;br/&gt;
        &lt;br/&gt;
        */&lt;br/&gt;
        // Changed code&lt;br/&gt;
        if (hasTextAllGranted) {&lt;br/&gt;
            Set&amp;lt;String&amp;gt; grantedRoles = authoritiesToRoles(granted);&lt;br/&gt;
            Set&amp;lt;String&amp;gt; requiredRoles = authoritiesToRoles(toAuthorities(getIfAllGranted()));&lt;br/&gt;
            if (!grantedRoles.containsAll(requiredRoles)) {                return false;            }
&lt;p&gt;        }&lt;br/&gt;
        // End of changed code&lt;/p&gt;</comment>
                            <comment id="76114" author="chilmers" created="Tue, 21 Feb 2012 17:31:04 +0000"  >&lt;p&gt;Added a pull request for solving this issue (&lt;a href=&quot;https://github.com/SpringSource/spring-security/pulls&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/SpringSource/spring-security/pulls&lt;/a&gt;)&lt;br/&gt;
Also added a separate JIRA issue (&lt;a href=&quot;https://jira.spring.io/browse/SEC-1921&quot; title=&quot;Implementation of equals in SimpleGrantedAuthority does not allow equality with other GrantedAuthority implementations&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SEC-1921&quot;&gt;&lt;del&gt;SEC-1921&lt;/del&gt;&lt;/a&gt;) for the equals method in SimpleGrantedAuthority.&lt;/p&gt;</comment>
                            <comment id="77715" author="dhukas" created="Tue, 17 Apr 2012 03:45:16 +0000"  >&lt;p&gt;The priority of this task should be &apos;Major&apos; at least.&lt;/p&gt;</comment>
                            <comment id="77867" author="rwinch" created="Mon, 23 Apr 2012 05:44:54 +0000"  >&lt;p&gt;Thanks for the bug submission. I have fixed this in master so you can give it a try if you like.&lt;/p&gt;</comment>
                            <comment id="124855" author="issuemaster" created="Sat, 6 Feb 2016 06:18:58 +0000"  >&lt;p&gt;This issue has been migrated to &lt;a href=&quot;https://github.com/spring-projects/spring-security/issues/2130&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/spring-projects/spring-security/issues/2130&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_10170" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>First Response Date</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 9 Feb 2012 01:26:33 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10280" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>29229</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10880" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i03o8v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_10380" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>21470</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_10381" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Ranking</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>17995</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10171" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>