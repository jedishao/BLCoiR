<!-- 
RSS generated by JIRA (6.4.11#64026-sha1:78f6ec473a3f058bd5d6c30e9319c7ab376bdb9c) at Fri Dec 23 10:24:02 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://jira.spring.io/si/jira.issueviews:issue-xml/SEC-168/SEC-168.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>Spring JIRA</title>
    <link>https://jira.spring.io</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.4.11</version>
        <build-number>64026</build-number>
        <build-date>25-08-2015</build-date>
    </build-info>

<item>
            <title>[SEC-168] ConcurrentSessionFilter breaks authenticate with: Authentication.getDetails() required</title>
                <link>https://jira.spring.io/browse/SEC-168</link>
                <project id="10040" key="SEC">Spring Security</project>
                    <description>&lt;p&gt;Acegi works fine for me in my environment. &lt;/p&gt;

&lt;p&gt;Now i wanted to avoid concurrent logins and followed the steps described at: &lt;a href=&quot;http://acegisecurity.org/docbook/acegi.html#security-authentication-concurrent-login&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://acegisecurity.org/docbook/acegi.html#security-authentication-concurrent-login&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Now, when I try to login with the same code that worked before, I get an exception:&lt;/p&gt;

&lt;p&gt;Caused by: java.lang.IllegalArgumentException: Authentication.getDetails() required&lt;br/&gt;
	at org.springframework.util.Assert.notNull(Assert.java:90)&lt;br/&gt;
	at org.acegisecurity.concurrent.SessionRegistryUtils.obtainSessionIdFromAuthentication(SessionRegistryUtils.java:48)&lt;br/&gt;
	at org.acegisecurity.concurrent.ConcurrentSessionControllerImpl.checkAuthenticationAllowed(ConcurrentSessionControllerImpl.java:100)&lt;br/&gt;
	at org.acegisecurity.providers.ProviderManager.doAuthentication(ProviderManager.java:209)&lt;br/&gt;
	at org.acegisecurity.AbstractAuthenticationManager.authenticate(AbstractAuthenticationManager.java:49)&lt;/p&gt;


&lt;p&gt;Here is the code snippet:&lt;/p&gt;

&lt;p&gt;		Authentication lAuthReq = new UsernamePasswordAuthenticationToken(pUsername, pPassword);&lt;/p&gt;

&lt;p&gt;		Authentication lAuth = null;&lt;/p&gt;

&lt;p&gt;		lAuth = getAuthenticationManager().authenticate(lAuthReq);&lt;/p&gt;

&lt;p&gt;Without the concurrent session filter it works perfectly...&lt;/p&gt;</description>
                <environment>JSF (Facelets) + Hibernate Filters</environment>
        <key id="13275">SEC-168</key>
            <summary>ConcurrentSessionFilter breaks authenticate with: Authentication.getDetails() required</summary>
                <type id="1" iconUrl="https://jira.spring.io/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://jira.spring.io/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://jira.spring.io/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="balex">Ben Alex</assignee>
                                    <reporter username="vguna">Veit Guna</reporter>
                        <labels>
                    </labels>
                <created>Fri, 3 Feb 2006 08:28:45 +0000</created>
                <updated>Sat, 6 Feb 2016 06:16:36 +0000</updated>
                            <resolved>Tue, 7 Feb 2006 14:41:49 +0000</resolved>
                                    <version>1.0.0 RC1</version>
                                    <fixVersion>1.0.0 RC2</fixVersion>
                                    <component>Core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="16314" author="vguna" created="Fri, 3 Feb 2006 10:43:35 +0000"  >&lt;p&gt;I&apos;ve looked deeper into the problem.&lt;br/&gt;
I&apos;m using the AnonymousProcessingFilter to automatically let acegi create an Authentication object. The problem is, that the token used by this filter&lt;br/&gt;
(AnonymousAuthenticationToken) doesn&apos;t overwrite the .getUserDetails method with an SessionIdentifierAware userDetails object - it&apos;s just null. So the exception above occurs. I&apos;ve extended AnonymousProcessingFilter and AnonymousAuthenticationToken to ConcurrentAnonymous*. Now it&apos;s returning an instance of WebAuthenticationDetails with the ServletRequest from the filter. Before I call authenticate, I set the userDetails from the anonymous Authentication object to the new UsernamePasswordAuthenticationToken. With this modification it seems to work now for me.&lt;/p&gt;

&lt;p&gt;Is there any other way to solve this?&lt;/p&gt;

&lt;p&gt;regards,&lt;br/&gt;
Veit&lt;/p&gt;</comment>
                            <comment id="16350" author="balex" created="Tue, 7 Feb 2006 14:41:49 +0000"  >&lt;p&gt;Made AnonymousAuthenticationToken offer a getDetails() method, and AnonymousProcessingFilter sets it.&lt;/p&gt;</comment>
                            <comment id="16379" author="balex" created="Wed, 8 Feb 2006 20:32:03 +0000"  >&lt;p&gt;&lt;a href=&quot;https://jira.spring.io/browse/SEC-182&quot; title=&quot;TokenBasedRememberMeServices should return an Authentication that can be used by concurrent session services&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SEC-182&quot;&gt;&lt;del&gt;SEC-182&lt;/del&gt;&lt;/a&gt; is a similar problem caused with the remember-me services and concurrent sessions.&lt;/p&gt;</comment>
                            <comment id="18585" author="marian" created="Fri, 14 Jul 2006 01:17:45 +0000"  >&lt;p&gt;This error happens in 1.0.1too&lt;/p&gt;</comment>
                            <comment id="124618" author="issuemaster" created="Sat, 6 Feb 2016 06:16:36 +0000"  >&lt;p&gt;This issue has been migrated to &lt;a href=&quot;https://github.com/spring-projects/spring-security/issues/429&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/spring-projects/spring-security/issues/429&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_10170" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>First Response Date</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 7 Feb 2006 14:41:49 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10280" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>8276</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10880" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i04n53:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_10380" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>27123</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_10381" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Ranking</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>21772</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10171" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>