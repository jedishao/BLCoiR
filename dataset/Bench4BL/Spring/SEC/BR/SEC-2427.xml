<!-- 
RSS generated by JIRA (6.4.11#64026-sha1:78f6ec473a3f058bd5d6c30e9319c7ab376bdb9c) at Fri Dec 23 10:32:14 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://jira.spring.io/si/jira.issueviews:issue-xml/SEC-2427/SEC-2427.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>Spring JIRA</title>
    <link>https://jira.spring.io</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.4.11</version>
        <build-number>64026</build-number>
        <build-date>25-08-2015</build-date>
    </build-info>

<item>
            <title>[SEC-2427] Subsequent requests from the same browser break remember me function and throws CookieTheftException</title>
                <link>https://jira.spring.io/browse/SEC-2427</link>
                <project id="10040" key="SEC">Spring Security</project>
                    <description>&lt;p&gt;Prerequisite: Browser with authenticated rememberme cookie stored.&lt;/p&gt;

&lt;p&gt;Reproduction steps:&lt;br/&gt;
1. The browser open a page to trigger auto login.&lt;br/&gt;
2. Request received by server and processed right before code  tokenRepository.updateToken(newToken.getSeries(), newToken.getTokenValue(), newToken.getDate()); of PersistentTokenBasedRememberMeServices and the executing thread paused.&lt;br/&gt;
3. End user refresh the page and a second request is sent to the server&lt;br/&gt;
4. The second request is recieved and processed through the Spring Security filters and returned a new cookie to the browser and the token( token-A) in the db is updated either.&lt;br/&gt;
5. The first request resumed and run code updateToken thus the db is updated with the new generated token (token-B). As the request has been canceled by the browser so token-B will never reach the browser with code addCookie(newToken, request, response);&lt;br/&gt;
6. Session of the end user time out and pages are requested again, browser send request s with token-A &lt;br/&gt;
7. !presentedToken.equals(token.getTokenValue()) of PersistentTokenBasedRememberMeServices  is checked thus caused CookieTheftException be thrown and all tokens related to the end user in db are deleted.&lt;/p&gt;


&lt;p&gt;SO concurrency control is needed for rememberme filter.&lt;/p&gt;</description>
                <environment>JDK6.0 + Tomcat 6 + Spring Security 3.1.4 + Linux </environment>
        <key id="52148">SEC-2427</key>
            <summary>Subsequent requests from the same browser break remember me function and throws CookieTheftException</summary>
                <type id="1" iconUrl="https://jira.spring.io/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://jira.spring.io/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://jira.spring.io/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="vertonur">Vertonur Sunimi</reporter>
                        <labels>
                    </labels>
                <created>Tue, 3 Dec 2013 20:13:57 +0000</created>
                <updated>Sat, 6 Feb 2016 06:41:32 +0000</updated>
                            <resolved>Sat, 6 Feb 2016 06:41:32 +0000</resolved>
                                    <version>3.1.4</version>
                                                    <component>Web</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="97985" author="camerondalton" created="Mon, 27 Jan 2014 10:19:51 +0000"  >&lt;p&gt;I don&apos;t think &quot;concurrency control&quot; in the remember me filter will solve this.  Thread execution in the first request might wait before it even gets to the remember me filter, the second request gets all the way through the remember me filter, and then the first request wakes up and proceeds all the way through the filter.&lt;/p&gt;

&lt;p&gt;A common additional use case that will produces this behavior (think I can still call it the same bug):&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;The user opens a page which triggers a remember-me auto login&lt;/li&gt;
	&lt;li&gt;The response does not make it back to the client for any reason.  For example:
	&lt;ol&gt;
		&lt;li&gt;Before the response comes back to the client (say on a page that takes a couple seconds to load) the user clicks Stop in the browser&lt;/li&gt;
		&lt;li&gt;Before the response comes back to the client, the user closes the browser&lt;/li&gt;
		&lt;li&gt;Some network issue prevents the response from making it back to the client (I experienced this with a 502 Proxy Error)&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
	&lt;li&gt;The user opens that page again&lt;/li&gt;
	&lt;li&gt;Since the previous response never made it back to the client, the new remember me cookie (with the updated token value) was not recorded by the browser.  Thus when the user visits the page again, the browser submits the old cookie, triggering the CookieTheftException.&lt;/li&gt;
&lt;/ol&gt;
</comment>
                            <comment id="125433" author="issuemaster" created="Sat, 6 Feb 2016 06:23:43 +0000"  >&lt;p&gt;This issue has been migrated to &lt;a href=&quot;https://github.com/spring-projects/spring-security/issues/2648&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/spring-projects/spring-security/issues/2648&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_10170" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>First Response Date</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 27 Jan 2014 10:19:51 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10280" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>38628</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10880" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i06qon:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_10380" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>39361</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_10381" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Ranking</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>38330</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10171" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>