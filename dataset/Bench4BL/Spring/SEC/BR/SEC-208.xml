<!-- 
RSS generated by JIRA (6.4.11#64026-sha1:78f6ec473a3f058bd5d6c30e9319c7ab376bdb9c) at Fri Dec 23 10:38:29 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://jira.spring.io/si/jira.issueviews:issue-xml/SEC-208/SEC-208.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>Spring JIRA</title>
    <link>https://jira.spring.io</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.4.11</version>
        <build-number>64026</build-number>
        <build-date>25-08-2015</build-date>
    </build-info>

<item>
            <title>[SEC-208] SessionRegistryImpl giving java.util.ConcurrentModificationException</title>
                <link>https://jira.spring.io/browse/SEC-208</link>
                <project id="10040" key="SEC">Spring Security</project>
                    <description>&lt;p&gt;When we load-tested the application, the following exception was produced:&lt;/p&gt;

&lt;p&gt;java.util.ConcurrentModificationException&lt;br/&gt;
at java.util.HashMap$HashIterator.nextEntry(HashMap.j ava:787)&lt;br/&gt;
at java.util.HashMap$KeyIterator.next(HashMap.java:82 3)&lt;br/&gt;
at org.acegisecurity.concurrent.SessionRegistryImpl.g etAllSessions(SessionRegistryImpl.java:72)&lt;br/&gt;
at org.acegisecurity.concurrent.ConcurrentSessionCont rollerImpl.checkAuthenticationAllowed(ConcurrentSe ssionControllerImpl.java:103)&lt;br/&gt;
at org.acegisecurity.providers.ProviderManager.doAuth entication(ProviderManager.java:209)&lt;br/&gt;
at org.acegisecurity.AbstractAuthenticationManager.au thenticate(AbstractAuthenticationManager.java:49)&lt;/p&gt;


&lt;p&gt;org.acegisecurity.concurrent.ConcurrentSessionControllerImpl.maximumSessions is set to 100,&lt;br/&gt;
and we used grinder (&lt;a href=&quot;http://grinder.sourceforge.net/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://grinder.sourceforge.net/&lt;/a&gt;) to do the load testing.&lt;/p&gt;</description>
                <environment>uname -a shows &amp;quot;Linux uatl-us-app1 2.4.21-4.ELsmp #1 SMP Fri Oct 3 17:52:56 EDT 2003 i686 i686 i386 GNU/Linux&amp;quot;</environment>
        <key id="13459">SEC-208</key>
            <summary>SessionRegistryImpl giving java.util.ConcurrentModificationException</summary>
                <type id="1" iconUrl="https://jira.spring.io/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://jira.spring.io/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://jira.spring.io/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="balex">Ben Alex</assignee>
                                    <reporter username="gmoh">Gary Moh</reporter>
                        <labels>
                    </labels>
                <created>Mon, 6 Mar 2006 01:34:54 +0000</created>
                <updated>Sat, 6 Feb 2016 06:20:45 +0000</updated>
                            <resolved>Tue, 25 Apr 2006 13:54:47 +0000</resolved>
                                    <version>1.0.0 RC2</version>
                                    <fixVersion>1.0.0</fixVersion>
                                    <component>Core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="17175" author="ericcrampton" created="Wed, 12 Apr 2006 06:44:57 +0000"  >&lt;p&gt;Hi Gary and Ben,&lt;/p&gt;

&lt;p&gt;I took a quick look at this and it should be an easy fix. In the &quot;principals&quot; map, synchronized sets are being stored. But, when the set is iterated over, it&apos;s not in a synchronized block. During the iteration, another thread must be adding to the set, resulting in your concurrent modification exception.&lt;/p&gt;

&lt;p&gt;Also, there&apos;s another instance later in the code where a session ID is removed from a set and then the set size is compared to zero and the object is removed from the principals map. It&apos;s probably a good idea to synchronize on the set there as well, but this isn&apos;t what caused Gary&apos;s problem.&lt;/p&gt;

&lt;p&gt;I&apos;ve attached a unified diff for the simple fix for this against the current CVS HEAD. From within your acegisecurity directory which contains the maven.xml file, you can apply it with &quot;patch -p2 &amp;lt; synchronization_fix.diff&quot;.&lt;/p&gt;

&lt;p&gt;I&apos;ve built the code and run the unit tests, but I don&apos;t have an easy way to stress test it. Gary, if you have the time and could build with this patch, it should be easy for you to see if this totally fixes it or not.&lt;/p&gt;

&lt;p&gt;Regards,&lt;br/&gt;
--Eric&lt;/p&gt;</comment>
                            <comment id="17354" author="balex" created="Tue, 25 Apr 2006 13:54:47 +0000"  >&lt;p&gt;Applied the patch (did not do a separate stress test) to SVN.&lt;/p&gt;</comment>
                            <comment id="125051" author="issuemaster" created="Sat, 6 Feb 2016 06:20:45 +0000"  >&lt;p&gt;This issue has been migrated to &lt;a href=&quot;https://github.com/spring-projects/spring-security/issues/470&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/spring-projects/spring-security/issues/470&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="11562" name="synchronization_fix.diff" size="1535" author="ericcrampton" created="Wed, 12 Apr 2006 06:44:57 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_10170" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>First Response Date</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 12 Apr 2006 06:44:57 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10280" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>20620</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10880" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i021y7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_10380" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>12025</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_10381" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Ranking</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>11910</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10171" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>