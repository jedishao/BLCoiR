<!-- 
RSS generated by JIRA (6.4.11#64026-sha1:78f6ec473a3f058bd5d6c30e9319c7ab376bdb9c) at Fri Dec 23 07:01:59 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://jira.spring.io/si/jira.issueviews:issue-xml/SWS-870/SWS-870.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>Spring JIRA</title>
    <link>https://jira.spring.io</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.4.11</version>
        <build-number>64026</build-number>
        <build-date>25-08-2015</build-date>
    </build-info>

<item>
            <title>[SWS-870] WS-Addressing headers missing from synchronous SOAP responses</title>
                <link>https://jira.spring.io/browse/SWS-870</link>
                <project id="10060" key="SWS">Spring Web Services</project>
                    <description>&lt;p&gt;WS-Addressing headers are missing from synchonous SOAP responses:&lt;br/&gt;
&amp;lt;env:Header/&amp;gt;&lt;/p&gt;

&lt;p&gt;By debugging Spring-WS, we found that the AddressingEndpointInterceptor inserts the header values correctly in the SOAPMessage, and even the SOAPMessage parameter of the Saaj13Implementation.writeTo() contains the right WS headers. But when message.writeTo(outputStream) is called, the headers are not serialized.&lt;/p&gt;

&lt;p&gt;If in the beginning of the method Saaj13Implementation.writeTo() we call message.saveChanges() without checking message.saveRequired(), the WS-A headers are serialized correctly. We assume that the flag that controls if save is needed might not be correctly set by a previous method.&lt;/p&gt;</description>
                <environment></environment>
        <key id="56794">SWS-870</key>
            <summary>WS-Addressing headers missing from synchronous SOAP responses</summary>
                <type id="1" iconUrl="https://jira.spring.io/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://jira.spring.io/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://jira.spring.io/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="arjen.poutsma">Arjen Poutsma</assignee>
                                    <reporter username="ibrencsics">Ivan Brencsics</reporter>
                        <labels>
                    </labels>
                <created>Mon, 31 Mar 2014 01:26:07 +0000</created>
                <updated>Wed, 17 Sep 2014 07:47:50 +0000</updated>
                            <resolved>Mon, 14 Apr 2014 03:04:54 +0000</resolved>
                                    <version>2.1.4</version>
                                    <fixVersion>2.2.RC1</fixVersion>
                                    <component>Core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="101637" author="arjen.poutsma" created="Thu, 10 Apr 2014 00:51:46 +0000"  >&lt;p&gt;Could you please indicate your runtime environment? (JDK, app server, etc. with version numbers).&lt;/p&gt;</comment>
                            <comment id="101642" author="ibrencsics" created="Thu, 10 Apr 2014 02:10:28 +0000"  >&lt;p&gt;Please find the parameters here:&lt;/p&gt;

&lt;p&gt;$ /usr/java/default/bin/java -version&lt;br/&gt;
java version &quot;1.7.0_51&quot;&lt;br/&gt;
Java(TM) SE Runtime Environment (build 1.7.0_51-b13)&lt;br/&gt;
Java HotSpot(TM) Client VM (build 24.51-b03, mixed mode, sharing)&lt;/p&gt;

&lt;p&gt;$ cat /etc/&lt;b&gt;release&lt;/b&gt;&lt;br/&gt;
CentOS release 5.10 (Final)&lt;/p&gt;

&lt;p&gt;Apache Tomcat Version 7.0.37&lt;/p&gt;</comment>
                            <comment id="101653" author="arjen.poutsma" created="Thu, 10 Apr 2014 03:48:13 +0000"  >&lt;p&gt;Thanks!&lt;br/&gt;
The reason I asked is that we got two similar issues around the same time (this one and &lt;a href=&quot;https://jira.spring.io/browse/SWS-871&quot; title=&quot;Security Headers missing with XwsSecurityInterceptor and Spring Integration&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SWS-871&quot;&gt;&lt;del&gt;SWS-871&lt;/del&gt;&lt;/a&gt;), while I don&apos;t recollect making any changes in the header code recently. I suspected it might have had something to do with JDK 8 coming out and changing SAAJ behavior, but that doesn&apos;t seem to be the case.&lt;/p&gt;

&lt;p&gt;I will investigate further next week.&lt;/p&gt;</comment>
                            <comment id="101665" author="ibrencsics" created="Thu, 10 Apr 2014 06:42:24 +0000"  >&lt;p&gt;Thanks a lot for investigating. I also noticed that the other ticket (871) has the same problem, and the same conclusion. Probably it is not an accident. Although I cant imagine what could happen to SAAJ, but the fact is that if I call the saveChanges() unconditionally, the WSA headers are serialized correclty.&lt;/p&gt;</comment>
                            <comment id="101668" author="arjen.poutsma" created="Thu, 10 Apr 2014 06:50:00 +0000"  >&lt;p&gt;Indeed, it appears that changing it to an unconditional saveChanges() would do the trick.&lt;/p&gt;

&lt;p&gt;But first I would like to understand what caused these two bugs to appear all of a sudden, when the underlying SAAJ code in Spring-WS has been pretty much the same since version 1.0 was released over five years ago. We&apos;ve never had SOAP headers disappear in all that time, and now we get two reports on a single day. That much coincidence makes me suspicious and I want to investigate it more.&lt;/p&gt;</comment>
                            <comment id="101674" author="mleese" created="Thu, 10 Apr 2014 07:35:54 +0000"  >&lt;p&gt;I also found it quite the coincidence that both bug reports were written on the same day.  &lt;/p&gt;

&lt;p&gt;I was able to track down our issue to Spring Integration.  The DefaultSoapHeaderMapper sets the SOAP action on the SOAPMessage (this functionality was added in Spring Integration 2.1).  This causes the SOAPMessage to call saveChanges() which sets needsSave to false.  After this, the security headers are added.  When SOAPMessage.writeTo() is called, it doesn&apos;t call saveChanges() again because needsSave is false.  &lt;/p&gt;

&lt;p&gt;So I think the true culprit is the changes made in Spring Integration.  They just excercise an underlying bug in Spring WS.&lt;/p&gt;

&lt;p&gt;Incidentally, SOAPMessage.writeTo() sets needsSave to true so if you set on the trace level logging on the WebServiceTemplate, the message transmission will work with the security headers attached.&lt;/p&gt;</comment>
                            <comment id="101677" author="arjen.poutsma" created="Thu, 10 Apr 2014 07:40:03 +0000"  >&lt;p&gt;&lt;a href=&quot;https://jira.spring.io/secure/ViewProfile.jspa?name=ibrencsics&quot; class=&quot;user-hover&quot; rel=&quot;ibrencsics&quot;&gt;Ivan Brencsics&lt;/a&gt; are you also using Spring Integration, by any chance?&lt;/p&gt;</comment>
                            <comment id="101705" author="ibrencsics" created="Thu, 10 Apr 2014 13:08:03 +0000"  >&lt;p&gt;No, we dont use Spring Integration.&lt;/p&gt;</comment>
                            <comment id="101720" author="ibrencsics" created="Thu, 10 Apr 2014 16:06:43 +0000"  >&lt;p&gt;I did some investigation, but still confused. The SAAJ MessageImpl.needsSave() method has this comment: &quot;All write methods (i.e setters) should call this method in order to make sure that a save is necessary since the state has been modified&quot;.&lt;/p&gt;

&lt;p&gt;The only thing I can imagine is that in some setter in SAAJ the needsMethod() is not called, and finally in the Saaj13Implementation the saveChanges() is not triggered. Maybe it would make sense calling the needsSave() manually as the last step of the interceptors that inject the WSS, WSA headers.&lt;/p&gt;</comment>
                            <comment id="101741" author="ibrencsics" created="Fri, 11 Apr 2014 01:37:13 +0000"  >&lt;p&gt;I can confirm what Matthew wrote. If I set the logging level to TRACE for the org.springframework.ws package, the problem is fixed. In case of TRACE level:&lt;br/&gt;
1) in the log entry the WSA headers are missing (the first call to writeTo() is not correct), but the save flag is configured&lt;br/&gt;
2) but when the Saaj13Implementation calls the writeTo() the second time, the WSA headers are correct on the wire.&lt;/p&gt;</comment>
                            <comment id="101867" author="arjen.poutsma" created="Mon, 14 Apr 2014 03:04:46 +0000"  >&lt;p&gt;Fixed by calling saveChanges unconditionally now. Thanks for the help, everybody.&lt;/p&gt;</comment>
                            <comment id="107817" author="ibrencsics" created="Wed, 17 Sep 2014 07:47:50 +0000"  >&lt;p&gt;Let me just share here that there might be a side effect of this fix:&lt;br/&gt;
&lt;a href=&quot;https://bugs.eclipse.org/bugs/show_bug.cgi?id=444222&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://bugs.eclipse.org/bugs/show_bug.cgi?id=444222&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://java.net/jira/browse/SAAJ-75&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://java.net/jira/browse/SAAJ-75&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="56810">SWS-871</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_10170" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>First Response Date</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 10 Apr 2014 00:51:46 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10280" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>43049</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10880" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i07fi7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_10380" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>43384</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_10381" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Ranking</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>42751</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10171" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>