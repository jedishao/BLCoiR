<!-- 
RSS generated by JIRA (6.4.11#64026-sha1:78f6ec473a3f058bd5d6c30e9319c7ab376bdb9c) at Fri Dec 23 06:23:49 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://jira.spring.io/si/jira.issueviews:issue-xml/SWF-1437/SWF-1437.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>Spring JIRA</title>
    <link>https://jira.spring.io</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.4.11</version>
        <build-number>64026</build-number>
        <build-date>25-08-2015</build-date>
    </build-info>

<item>
            <title>[SWF-1437] Two concurrent threads in an expression of a flow override the rootobject of evaluation context</title>
                <link>https://jira.spring.io/browse/SWF-1437</link>
                <project id="10050" key="SWF">Spring Web Flow</project>
                    <description>&lt;p&gt;When two concurrent threads are evaluating an expression contained in a flow, the evaluation context linked to the expression can be overriden by multiple threads.&lt;/p&gt;

&lt;p&gt;Result is in most of cases NullPointerException in a getValueInternal of classes from  org.springframework.expression.spel.ast package (like PropertyOrFieldReference for example).&lt;/p&gt;

&lt;p&gt;Wrong code seems to be in org.springframework.binding.expression.spel.SpringELExpression :&lt;/p&gt;

&lt;p&gt;	public Object getValue(Object rootObject) throws EvaluationException {&lt;br/&gt;
		try {&lt;br/&gt;
			updateEvaluationContext(rootObject);&lt;br/&gt;
			return expression.getValue(evaluationContext, expectedType);&lt;br/&gt;
...&lt;br/&gt;
As the SpringElExpression is unique for the expression to be evaluated, it&apos;s not thread safe when updating the evaluation context with root object.&lt;/p&gt;

&lt;p&gt;Synchronize this method resolves problem.&lt;/p&gt;

</description>
            <key id="35406">SWF-1437</key>
            <summary>Two concurrent threads in an expression of a flow override the rootobject of evaluation context</summary>
                <type id="1" iconUrl="https://jira.spring.io/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="2" iconUrl="https://jira.spring.io/images/icons/priorities/critical.png">Critical</priority>
                        <status id="6" iconUrl="https://jira.spring.io/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="8">Complete</resolution>
                                        <assignee username="rstoya05-aop">Rossen Stoyanchev</assignee>
                                    <reporter username="patoche">Patrick</reporter>
                        <labels>
                    </labels>
                <created>Mon, 13 Dec 2010 06:46:57 +0000</created>
                <updated>Fri, 23 May 2014 13:18:01 +0000</updated>
                            <resolved>Fri, 16 Aug 2013 08:46:12 +0000</resolved>
                                    <version>2.2.1</version>
                                    <fixVersion>2.3.0</fixVersion>
                                    <component>Binding: Expression Language Support</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>8</watches>
                                                                <comments>
                            <comment id="61457" author="rstoya05-aop" created="Tue, 14 Dec 2010 03:43:16 +0000"  >&lt;p&gt;I&apos;ve addressed this issue in the 2.3 branch. The fix will be available starting with tomorrow&apos;s build snapshot CI-49.&lt;/p&gt;</comment>
                            <comment id="63707" author="kroe" created="Thu, 24 Feb 2011 15:39:39 +0000"  >&lt;p&gt;We saw the NullPointerException on getValueInternal, but also found a much more severe effect of this bug: objects placed in a variable in one session can be returned when evaluating from another session.  This happened intermittently under all load levels, but was more frequent under periods of high load.  The issue would show up consistently after an app server restart when a bunch of requests were queued up in the load balancer, and released to the app server all at once.  Both of these are instances where concurrency is higher than normal, so no surprise that high load and server restarts brough these cases out.&lt;/p&gt;

&lt;p&gt;Depending on the latest 2.3.0 snapshot resolved these concurrency issues entirely.&lt;/p&gt;</comment>
                            <comment id="74768" author="geertv" created="Sat, 14 Jan 2012 03:29:41 +0000"  >&lt;p&gt;Is it possible that this bug already appeared in version 2.1.0 ? &lt;/p&gt;

&lt;p&gt;I have seen similar effects in an application which uses that version, i.e. objects from one session being returned in another session under heavier loads, but I have yet to find a reason in our own code to explain it. &lt;/p&gt;</comment>
                            <comment id="74813" author="rstoya05-aop" created="Mon, 16 Jan 2012 08:18:31 +0000"  >&lt;p&gt;Yes, it is possible. I recommend upgrading to 2.3.0.&lt;/p&gt;</comment>
                            <comment id="75908" author="gvamosi" created="Fri, 17 Feb 2012 02:06:19 +0000"  >&lt;p&gt;Hi there!&lt;/p&gt;

&lt;p&gt;I am using spring-webflow-2.3.0.RELEASE.jar in my spring mvc project and I get sometimes NullPointerException at &amp;lt;evaluate expression=&quot;someController.someMethod()&quot; /&amp;gt;.&lt;/p&gt;

&lt;p&gt;top entry on trace:&lt;br/&gt;
org.springframework.expression.spel.ast.PropertyOrFieldReference.getValueInternal(PropertyOrFieldReference.java:74)&lt;/p&gt;

&lt;p&gt;If I test it with a single client, it works fine. But when multiple clients connecting, getting a mass of NullPointerExceptions.&lt;/p&gt;

&lt;p&gt;The controller is in the flash scope and doing some database operations via Dao layer. Maybe I am wrong on the scope?&lt;/p&gt;


&lt;p&gt;Thanks for answering.&lt;/p&gt;</comment>
                            <comment id="78880" author="shyju" created="Wed, 16 May 2012 03:22:09 +0000"  >&lt;p&gt;I am still getting the same error using the Spring webflow version 2.3.0 with multiple users and this occurs intermittently and we would need to rebounce the server. please let me know if this issue is resolved in the spring webflow version 2.3.0.&lt;/p&gt;</comment>
                            <comment id="78897" author="rstoya05-aop" created="Wed, 16 May 2012 08:00:30 +0000"  >&lt;p&gt;It is. In fact the latest version is 2.3.1. Just make sure you don&apos;t have the old version still.&lt;/p&gt;</comment>
                            <comment id="79657" author="shyju" created="Thu, 7 Jun 2012 01:54:36 +0000"  >&lt;p&gt;Do you know what are the jar files which we should use to upgrade?&lt;/p&gt;</comment>
                            <comment id="79658" author="shyju" created="Thu, 7 Jun 2012 02:00:38 +0000"  >&lt;p&gt;I had upgrade the spring webflow jar to release 2.3.1 and still the same error occurs intermittently.&lt;/p&gt;</comment>
                            <comment id="91441" author="qng" created="Tue, 2 Jul 2013 11:11:03 +0000"  >&lt;p&gt;I&apos;m getting this issue in production where I have over 100 concurrent connections. Only occurs under load. &lt;/p&gt;

&lt;p&gt;Using SpringWebFlow 2.3.1. &lt;br/&gt;
Using Spring 3.2.1&lt;/p&gt;

&lt;p&gt;This is a serious production issue as data is being polluted in different sessions. ie. User a see&apos;s user b&apos;s data.&lt;/p&gt;

&lt;p&gt;With peak usage in the last 3 days of over 3000 transactions, we&apos;re getting a failure rate of 2 or 3 a day. The worst thing being users sesing other user&apos;s data.&lt;/p&gt;</comment>
                            <comment id="92840" author="musikolo" created="Fri, 16 Aug 2013 07:17:09 +0000"  >&lt;p&gt;Hi guys,&lt;/p&gt;

&lt;p&gt;We are also experiencing the same problem as described above regarding users seeing other users&apos; data. We are currently using Spring 3.1.4 + Spring Web Flow 2.2.0. Even though we have tried to upgrade SWF to 2.3.1 and 2.3.2, we have been unsuccessful. So taking into account how critical this problem is, particularly being true in the project we are working on as data is highly sensitive, is there any chance to have a fix in a short time? Is there any workaround for it?&lt;/p&gt;

&lt;p&gt;Looking forward to your reply.&lt;/p&gt;

&lt;p&gt;Best regards.&lt;/p&gt;</comment>
                            <comment id="92844" author="rstoya05-aop" created="Fri, 16 Aug 2013 08:46:13 +0000"  >&lt;p&gt;I am closing this issue since it was addressed and confirmed as fixed by the original reporter.&lt;/p&gt;

&lt;p&gt;It is highly unlikely that anyone is experiencing the same synchronization issue in SpringELExpression that was identified and fixed. You are likely seeing a NPE resulting from an EL expression but the root cause needs to be determined. There can be many other reasons.&lt;/p&gt;

&lt;p&gt;You will need to open a new ticket and provide a fresh description of the problem as you experience it using the latest release (currently 2.3.2). &lt;/p&gt;
</comment>
                            <comment id="103774" author="fsiddiqi" created="Fri, 23 May 2014 13:18:01 +0000"  >&lt;p&gt;Quentin - &lt;/p&gt;

&lt;p&gt;Were ever able to resolve this problem, perhaps with a subsequent SWF upgrade?&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10151">
                    <name>Relate</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="50373">SWF-1606</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_10170" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>First Response Date</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 14 Dec 2010 03:43:16 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10880" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i00gt3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_10380" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2768</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10171" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>