<!-- 
RSS generated by JIRA (6.4.11#64026-sha1:78f6ec473a3f058bd5d6c30e9319c7ab376bdb9c) at Fri Dec 23 05:55:35 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://jira.spring.io/si/jira.issueviews:issue-xml/SWF-181/SWF-181.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>Spring JIRA</title>
    <link>https://jira.spring.io</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.4.11</version>
        <build-number>64026</build-number>
        <build-date>25-08-2015</build-date>
    </build-info>

<item>
            <title>[SWF-181] FlowPhaseListener does not lock flow execution</title>
                <link>https://jira.spring.io/browse/SWF-181</link>
                <project id="10050" key="SWF">Spring Web Flow</project>
                    <description>&lt;p&gt;I am having a problem with end states and the way that FlowPhaseListener handles them.  When entering an end state, the end() method in AbstractConversationManager&apos;s ConversationProxy is called to attempt to unlock the current FlowExecutionLock.  This fails because there is never any lock acquired on the flow execution, which makes the ReentrantLock code in concurrent throw an Error about illegal lock usage.  Looking at the code, it appears that FlowPhaseListener does not have the exact same functionality that the FlowExecutorImpl for Struts/Spring MVC does (it does not perform any locking/unlocking).  As a result, when my code enters an end state, a stack trace (illegal lock usage) occurs and my application cannot proceed.&lt;/p&gt;

&lt;p&gt;I am providing a patch that has addressed this issue.&lt;/p&gt;</description>
            <key id="15066">SWF-181</key>
            <summary>FlowPhaseListener does not lock flow execution</summary>
                <type id="1" iconUrl="https://jira.spring.io/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://jira.spring.io/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://jira.spring.io/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="kdonald">Keith Donald</assignee>
                                    <reporter username="agoldstein">Andy Goldstein</reporter>
                        <labels>
                    </labels>
                <created>Tue, 26 Sep 2006 01:36:33 +0000</created>
                <updated>Fri, 3 Nov 2006 05:42:30 +0000</updated>
                            <resolved>Tue, 24 Oct 2006 08:53:20 +0000</resolved>
                                    <version>1.0 RC4</version>
                                    <fixVersion>1.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="20112" author="klr8" created="Thu, 5 Oct 2006 22:32:16 +0000"  >&lt;p&gt;This should be fixed in RC4. LocalConversationManager and it&apos;s ConversationProxy no longer exist. SessionBindingConversationManager does not do an unlock when a conversation ends.&lt;/p&gt;</comment>
                            <comment id="20140" author="agoldstein" created="Fri, 6 Oct 2006 03:40:42 +0000"  >&lt;p&gt;I&apos;ve updated to the latest (final) version of RC4, but still have a problem when doing an externalRedirect.  I think the FlowPhaseListener is trying to save the execution twice - once in prepareResponse() as part of &quot;before&quot; RENDER_RESPONSE, and a second time as part of &quot;after&quot; RENDER_RESPONSE.  If an end state is the selected state in the flow, I believe the conversation no longer exists at the time the second execution of saveFlowExecution() occurs.  I added some code (which exists in the patch I uploaded) that marks the flow execution as &quot;clean&quot; after it has been saved, and that appeared to take care of things for me.  I&apos;m not certain that it&apos;s 100% correct in fitting in with the Web Flow lifecycle/needs, however.  Please refer to the stack trace below.&lt;/p&gt;

&lt;p&gt;Also, the flowExecutionKey shouldn&apos;t be part of the URL for an externalRedirect, should it?&lt;/p&gt;

&lt;p&gt;If you would like me to create separate JIRAs for these issues, I&apos;ll be more than happy to.&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;stack trace - occurred after reaching an end state with an externalRedirect&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;12:30:09,252 ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;PhaseListenerManager&amp;#93;&lt;/span&gt; Exception in PhaseListener RENDER_RESPONSE(6) afterPhase&lt;br/&gt;
org.springframework.webflow.execution.repository.NoSuchFlowExecutionException: No flow execution could be found with key &apos;_c2F429484-7F27-D75D-C4C6-2F049AE41C1C_kC5ECDF30-A488-12B2-521C-BE67A7EF15F4&apos; &amp;#8211; perhaps this executing flow has ended or expired? This could happen if your users are relying on browser history (typically via the back button) that references ended flows.; nested exception is org.springframework.webflow.conversation.NoSuchConversationException: No conversation could be found with id &apos;2F429484-7F27-D75D-C4C6-2F049AE41C1C&apos; &amp;#8211; perhaps this conversation has ended?&lt;br/&gt;
Caused by:&lt;br/&gt;
org.springframework.webflow.conversation.NoSuchConversationException: No conversation could be found with id &apos;2F429484-7F27-D75D-C4C6-2F049AE41C1C&apos; &amp;#8211; perhaps this conversation has ended?&lt;br/&gt;
        at org.springframework.webflow.conversation.impl.SessionBindingConversationManager$ConversationContainer.getConversation(SessionBindingConversationManager.java:179)&lt;br/&gt;
        at org.springframework.webflow.conversation.impl.SessionBindingConversationManager.getConversation(SessionBindingConversationManager.java:85)&lt;br/&gt;
        at org.springframework.webflow.execution.repository.support.AbstractConversationFlowExecutionRepository.getConversation(AbstractConversationFlowExecutionRepository.java:208)&lt;br/&gt;
        at org.springframework.webflow.execution.repository.support.AbstractConversationFlowExecutionRepository.removeFlowExecution(AbstractConversationFlowExecutionRepository.java:113)&lt;br/&gt;
        at org.springframework.webflow.executor.jsf.FlowPhaseListener.saveFlowExecution(FlowPhaseListener.java:298)&lt;br/&gt;
        at org.springframework.webflow.executor.jsf.FlowPhaseListener.afterPhase(FlowPhaseListener.java:139)&lt;/p&gt;</comment>
                            <comment id="20306" author="agoldstein" created="Mon, 16 Oct 2006 08:23:46 +0000"  >&lt;p&gt;Sorry for the delay in providing an updated patch - hectic weekend.&lt;/p&gt;

&lt;p&gt;The patch works for me when testing external redirects.  I pass null as the flowExecutionKey when creating the external redirect, as it appears this parameter should not be needed by the external URL.&lt;/p&gt;

&lt;p&gt;As far as end states go, adding the markClean() method to FlowExecutionHolder and the call of it in FlowPhaseListener#saveFlowExecution() avoids the problem of trying to save a flow execution that has already been removed from the repository (because of the end state functionality) in FlowPhaseListener#afterPhase().  I&apos;m not sure if this is sufficient/100% correct because I&apos;m not completely familiar with when a flow execution must be saved, so please feel free to modify as necessary.&lt;/p&gt;</comment>
                            <comment id="20432" author="kdonald" created="Tue, 24 Oct 2006 08:36:58 +0000"  >&lt;p&gt;Andy, what JSF impl are you using?&lt;/p&gt;</comment>
                            <comment id="20433" author="kdonald" created="Tue, 24 Oct 2006 08:53:20 +0000"  >&lt;p&gt;this bug was actually introduced due to a bug in myfaces 1.1.2 &amp;#8211; an upgrade to 1.1.4 combined with a simple form of this fix here solves the problem.&lt;/p&gt;</comment>
                            <comment id="20434" author="agoldstein" created="Tue, 24 Oct 2006 09:03:05 +0000"  >&lt;p&gt;I&apos;m using 1.1.4.  I&apos;ll pick up your changes tomorrow from Subversion and let you know how they work for me.  Thanks!&lt;/p&gt;</comment>
                            <comment id="20439" author="agoldstein" created="Wed, 25 Oct 2006 01:07:17 +0000"  >&lt;p&gt;I just grabbed the latest code from Subversion and everything is working just fine now.  Thanks for taking the time to fix this.  Looking forward to 1.0 final!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10011">
                    <name>Depends</name>
                                            <outwardlinks description="depends on">
                                        <issuelink>
            <issuekey id="15041">SWF-177</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12033" name="jsf-swf-2006-10-16.patch" size="1597" author="agoldstein" created="Mon, 16 Oct 2006 08:23:46 +0000"/>
                            <attachment id="11989" name="swf.patch" size="7791" author="agoldstein" created="Tue, 26 Sep 2006 01:38:06 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_10170" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>First Response Date</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 5 Oct 2006 22:32:16 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10880" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i04cbr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_10380" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>25371</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10171" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>