<!-- 
RSS generated by JIRA (6.4.11#64026-sha1:78f6ec473a3f058bd5d6c30e9319c7ab376bdb9c) at Fri Dec 23 04:01:38 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://jira.spring.io/si/jira.issueviews:issue-xml/ROO-357/ROO-357.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>Spring JIRA</title>
    <link>https://jira.spring.io</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.4.11</version>
        <build-number>64026</build-number>
        <build-date>25-08-2015</build-date>
    </build-info>

<item>
            <title>[ROO-357] workdir jars not removed on addon uninstall on Windows</title>
                <link>https://jira.spring.io/browse/ROO-357</link>
                <project id="10340" key="ROO">Spring Roo</project>
                    <description>&lt;p&gt;Addon jars remain in the work dir after an addon uninstall on Windows. AddOnOperations.cleanUp() uses File.deleteOnExit() for the deletion: my guess is that these files are still locked when the JVM tries to remove them because these jars are listed in java.ext.dirs, and Windows supports locking files that are in use. &lt;br/&gt;
The only solution I can come up with is that Roo should create a simple text file containing the files to delete and would leave it up to the roo.bat script to delete these files &lt;b&gt;before&lt;/b&gt; starting the JVM (could even be done by another Java program started by the script instead of a &apos;del&apos; command, as long as that JVM command doesn&apos;t list the work dir in the java.ext.dirs). &lt;br/&gt;
Every Java-based solution running just in the Roo JVM will suffer from the fact that the jars are locked already by the same JVM that tries to remove them, so this takes more than a simple code patch; a 2-step process in the .bat file seems like the best bet to me.&lt;/p&gt;</description>
                <environment>Windows XP SP3 with Sun jdk1.6.0_16</environment>
        <key id="28619">ROO-357</key>
            <summary>workdir jars not removed on addon uninstall on Windows</summary>
                <type id="1" iconUrl="https://jira.spring.io/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://jira.spring.io/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://jira.spring.io/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jkuipers">Joris Kuipers</assignee>
                                    <reporter username="jkuipers">Joris Kuipers</reporter>
                        <labels>
                    </labels>
                <created>Sun, 8 Nov 2009 08:28:44 +0000</created>
                <updated>Mon, 15 Feb 2010 13:53:16 +0000</updated>
                            <resolved>Sun, 22 Nov 2009 19:24:22 +0000</resolved>
                                    <version>1.0.0.RC3</version>
                                    <fixVersion>1.0.0.RC4</fixVersion>
                                    <component>@ CORE</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="47971" author="balex" created="Sun, 8 Nov 2009 08:31:06 +0000"  >&lt;p&gt;Another option would be to simply parse the JARs in the dist, lib and work directories to build a classpath and stop using java.ext.dirs entirely. If you had time to edit the roo-dev.bat and roo.bat files accordingly it would be superb.&lt;/p&gt;</comment>
                            <comment id="47972" author="jkuipers" created="Sun, 8 Nov 2009 08:43:41 +0000"  >&lt;p&gt;Adding a jar to the regular classpath has the same effect: once it&apos;s used it can&apos;t be deleted. I just tried by creating the following class, jarring it in a DeleteTest.jar and runnning &apos;java -cp DeleteTest.jar Main&apos;; the file still exists.&lt;/p&gt;

&lt;p&gt;public class Main {&lt;br/&gt;
    public static void main(String[] args) &lt;/p&gt;
{
        new java.io.File(&quot;DeleteTest.jar&quot;).deleteOnExit();
    }
&lt;p&gt;}&lt;/p&gt;

&lt;p&gt;I don&apos;t believe the situation would be any different for add-on jars that would already be in use if they were loaded from the classpath, although I haven&apos;t tried to verify that. &lt;/p&gt;</comment>
                            <comment id="48216" author="balex" created="Thu, 12 Nov 2009 23:37:28 +0000"  >&lt;p&gt;Your code works for me (Ubuntu on ext3 with 1.6.0_16):&lt;/p&gt;

&lt;p/&gt;
&lt;div id=&quot;syntaxplugin&quot; class=&quot;syntaxplugin&quot; style=&quot;border: 1px dashed #bbb; border-radius: 5px !important; overflow: auto; max-height: 30em;&quot;&gt;
&lt;table cellspacing=&quot;0&quot; cellpadding=&quot;0&quot; border=&quot;0&quot; width=&quot;100%&quot; style=&quot;font-size: 1em; line-height: 1.4em !important; font-weight: normal; font-style: normal; color: black;&quot;&gt;
		&lt;tbody &gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;  margin-top: 10px;   width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;balex@snif:~/test$ ls&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;DeleteTest.jar  Main.class  Main.java&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;balex@snif:~/test$ java -cp DeleteTest.jar:. Main&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;balex@snif:~/test$ ls&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   margin-bottom: 10px;  width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;Main.class  Main.java&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
			&lt;/tbody&gt;
&lt;/table&gt;
&lt;/div&gt;
&lt;p/&gt;

&lt;p&gt;Maybe it&apos;s just a Windows bug? Could you try JDK 6 Update 17?&lt;/p&gt;

&lt;p&gt;Given this seems to be a Windows-specific problem, one option may be to look at when Roo exits with code 100 and rather than simply restarting, do a delete of every file under work and then launch Roo with &quot;roo addon cleanup&quot;. That will cause Roo to start with no add-ons, yet perform a clean. You&apos;d just ignore the return code and re-launch Roo normally. It&apos;s hacky, but that&apos;s unfortunately just part of life on Windows. I&apos;m wondering how Christian will tackle this in STS for Windows users, though. &lt;/p&gt;</comment>
                            <comment id="48221" author="jkuipers" created="Fri, 13 Nov 2009 01:17:16 +0000"  >&lt;p&gt;I don&apos;t consider this to be a Windows-bug per se, but it is certainly specific to how Windows implements file locking of supporting files where *nix systems don&apos;t normally do that. AFAIK, the classloader keeps these files open for performance reasons; I&apos;ve seen projects working around this by using a different classloader that can close the files, but that seems like overkill if it&apos;s only used to fix this bug. &lt;br/&gt;
Recreating the entire workdir would be an option, but might be expensive in the future when lots of addons could be installed. &lt;br/&gt;
Another thing to consider if you plan to move away from using java.ext.dirs and use the regular classpath is that you could run into the maximum command line length limitation if you add too many jars to the classpath you pass to java on Windows. I know that Ant for example implemented its own bootstrap mechanism by loading jars itself with a classloader they create at startup to deal with these kind of issues: the code is not very complicated and might also be used to solve the file locking issue, although that might still require a different classloader implementation than URLClassLoader: &lt;a href=&quot;http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=5041014&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=5041014&lt;/a&gt; suggests that it won&apos;t be until Java 7 that you can call close() on a URLClassLoader to have it release its file locks so you can delete the jars.&lt;/p&gt;</comment>
                            <comment id="48320" author="balex" created="Mon, 16 Nov 2009 14:50:27 +0000"  >&lt;p&gt;Given add-on installation and removal is such an infrequent occurrence I don&apos;t think it&apos;s a major issue if it&apos;s slightly expensive to perform on Windows boxes. It&apos;ll all be done in under 30 seconds anyway, and often people will wait that long just to download the new add-on. Adding a new classloader would complicate matters for STS embedding, as it already uses its own special classloader for Roo. For 1.0.0.RELEASE I&apos;d prefer we just stick with what is basically working rather than even change from the java.ext.dirs approach. Once we require Java 6 or above we have the option of using wildcards in the classpath and that will simplify matters and avoid the classpath length issue. I need to work on add-on distribution in the near future, so I can revisit classpath management when there isn&apos;t the focus on getting 1.0.0 out the door. Do you agree with this approach or do you have another suggestion?&lt;/p&gt;</comment>
                            <comment id="48324" author="jkuipers" created="Mon, 16 Nov 2009 17:26:28 +0000"  >&lt;p&gt;I think solving the issue in the .bat is certainly the easiest and safest solution: just use &apos;addon cleanup&apos; for now, it wouldn&apos;t be too hard to change that to a focused deletion of files later on if that would be preferable. &lt;br/&gt;
There should probably be a note in the guide that mentions that addon uninstall will not work properly on Windows when you have multiple Roo shells open, as they will keep the files locked. The code that performs the &apos;addon cleanup&apos; could check for lingering files and print out an error if the work dir cannot be cleaned out. It means users will have to delete files manually, so the error should list them. &lt;/p&gt;</comment>
                            <comment id="48346" author="balex" created="Tue, 17 Nov 2009 06:54:27 +0000"  >&lt;p&gt;Excellent. Would you like to tackle this one Joris or should I? I don&apos;t mind either way.&lt;/p&gt;</comment>
                            <comment id="48347" author="jkuipers" created="Tue, 17 Nov 2009 07:15:05 +0000"  >&lt;p&gt;I can have a go at it: would you like to introduce an extra ExitShellRequest entry with a custom error code for cleanup, or do you simply always want to do this in the .bat file when a code 100 is being returned, so also after installing a new addon? &lt;/p&gt;</comment>
                            <comment id="48348" author="balex" created="Tue, 17 Nov 2009 07:27:06 +0000"  >&lt;p&gt;It really depends on whether it affects STS or not. If you could ask Christian his thoughts it would be good. I agree it&apos;d be cleaner to have a dedicated exit code to save complex batch file processing, but if it breaks STS I think complex batch file processing is better than requiring an STS change.&lt;/p&gt;</comment>
                            <comment id="48513" author="jkuipers" created="Sun, 22 Nov 2009 19:24:22 +0000"  >&lt;p&gt;Fixed in SVN Rev 455; added new exit code 200 that will trigger a clean of the work dir on Windows using the roo&lt;span class=&quot;error&quot;&gt;&amp;#91;-dev&amp;#93;&lt;/span&gt;.bat file. Means that Roo shell in STS 2.2.1 will not restart anymore after deleting an addon, but the restart didn&apos;t help anyway as the jars in the work dir are not removed. New Roo plugin will do the same on Windows as the new bat files, for now I advice Windows users working against trunk to use the command line shell for addon uninstall.&lt;br/&gt;
*nix scripts have been updated to check for exit code 0 for restarts instead of exit code not being 100. &lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10011">
                    <name>Depends</name>
                                            <outwardlinks description="depends on">
                                        <issuelink>
            <issuekey id="28871">ROO-420</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_10170" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>First Response Date</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sun, 8 Nov 2009 08:31:06 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10280" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>22731</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10880" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i03t13:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_10380" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>22245</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_10381" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Ranking</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>18716</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10171" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>