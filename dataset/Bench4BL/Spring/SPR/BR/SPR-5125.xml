<!-- 
RSS generated by JIRA (6.4.11#64026-sha1:78f6ec473a3f058bd5d6c30e9319c7ab376bdb9c) at Thu Dec 22 21:33:08 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://jira.spring.io/si/jira.issueviews:issue-xml/SPR-5125/SPR-5125.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>Spring JIRA</title>
    <link>https://jira.spring.io</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.4.11</version>
        <build-number>64026</build-number>
        <build-date>25-08-2015</build-date>
    </build-info>

<item>
            <title>[SPR-5125] Add DuplicateKeyException to DAO exception hierachy</title>
                <link>https://jira.spring.io/browse/SPR-5125</link>
                <project id="10000" key="SPR">Spring Framework</project>
                    <description>&lt;p&gt;The Spring DAO exception hierarchy is not fine grained enough to isolate duplicate key errors. A duplicate key error is an example of where an application may catch the exception and invoke alternative logic instead of just letting it fall down the stack. &lt;/p&gt;

&lt;p&gt;For example, we read messages from a queue and insert the data into a database. We explicitly catch a duplicate key insert exception as this indicates we&apos;ve processed the same message earlier. This is more efficient than a guarding the update with a check-then-act (which also introduces a race condition that may lead to dup-key exception anyway).&lt;/p&gt;

&lt;p&gt;Additionally, if we use single-phase commit for our JMS and DB transactions (commit DB first then JMS) a failure scenario is that the DB transaction commits but the JMS transaction rollsback. In this case the message is delivered again and we get a dup-key exception. We can then safely ignore such duplicate messages.&lt;/p&gt;

&lt;p&gt;A dup-key error is currently classified as a DataIntegrityViolationException along with other errors such as a data bounds error so we can&apos;t simply catch this exception type. We could work around this be checking the vendor error-code/state however this is not portable and cumbersome. &lt;/p&gt;

&lt;p&gt;Ideally an exception like:&lt;/p&gt;

&lt;p&gt;  public class DuplicateKeyException extends DataIntegrityViolationException { }&lt;/p&gt;

&lt;p&gt;Spring already provides mappings from vendor specific codes so it would be very powerful if it could provide a fine grained exception to allow this common duplicate-key handling pattern to be detected just using exception type.&lt;/p&gt;

&lt;p&gt;We currently use the following SQLExceptions to detect a dup-key:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Sybase: error-state=23000&lt;/li&gt;
	&lt;li&gt;DB2: error-state=23505&lt;/li&gt;
&lt;/ul&gt;
</description>
            <key id="23808">SPR-5125</key>
            <summary>Add DuplicateKeyException to DAO exception hierachy</summary>
                <type id="2" iconUrl="https://jira.spring.io/images/icons/issuetypes/newfeature.png">New Feature</type>
                                            <priority id="3" iconUrl="https://jira.spring.io/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://jira.spring.io/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="thomas.risberg">Thomas Risberg</assignee>
                                    <reporter username="benrowlands">Ben Rowlands</reporter>
                        <labels>
                    </labels>
                <created>Fri, 29 Aug 2008 03:15:59 +0000</created>
                <updated>Tue, 19 Jun 2012 03:47:01 +0000</updated>
                            <resolved>Thu, 12 Mar 2009 09:36:00 +0000</resolved>
                                                    <fixVersion>3.0 M3</fixVersion>
                                    <component>Core</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="39312" author="benrowlands" created="Fri, 29 Aug 2008 03:26:49 +0000"  >&lt;p&gt;This is similar (a more specific request) than &lt;a href=&quot;https://jira.spring.io/browse/SPR-2977&quot; title=&quot;Subclass DataIntegrityViolationException to represent main constraint types and translate SQL exceptons into appropriate subclass&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPR-2977&quot;&gt;&lt;del&gt;SPR-2977&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="39314" author="benrowlands" created="Fri, 29 Aug 2008 06:27:10 +0000"  >&lt;p&gt;Actually, we also need to check the vendor error-code in Sybase (FK violations also map onto 23000):&lt;/p&gt;

&lt;p&gt;  &lt;a href=&quot;http://manuals.sybase.com/onlinebooks/group-as/asg1250e/refman/@Generic__BookTextView/27249&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://manuals.sybase.com/onlinebooks/group-as/asg1250e/refman/@Generic__BookTextView/27249&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The error code 2601 specifies we have a duplicate key:&lt;/p&gt;

&lt;p&gt;  &lt;a href=&quot;http://manuals.sybase.com/onlinebooks/group-as/asg1250e/svrtsg/@Generic__BookTextView/34048;pt=15380&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://manuals.sybase.com/onlinebooks/group-as/asg1250e/svrtsg/@Generic__BookTextView/34048;pt=15380&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10011">
                    <name>Depends</name>
                                                                <inwardlinks description="is depended on by">
                                        <issuelink>
            <issuekey id="26804">SPRNET-1215</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="26805">SPRNET-1216</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="23809">SPR-5126</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10020">
                    <name>Related</name>
                                            <outwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="15751">SPR-2977</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_10180" key="com.atlassian.jira.toolkit:dayslastcommented">
                        <customfieldname>Days since last comment</customfieldname>
                        <customfieldvalues>
                                        8 years, 17 weeks, 6 days ago
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10181" key="com.atlassian.jira.toolkit:lastusercommented">
                        <customfieldname>Last commented by a User</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>true</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_10182" key="com.atlassian.jira.toolkit:lastupdaterorcommenter">
                        <customfieldname>Last updater</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>tmarshall</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10880" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i04ro7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_10380" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>27857</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10171" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>