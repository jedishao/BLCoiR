<!-- 
RSS generated by JIRA (6.4.11#64026-sha1:78f6ec473a3f058bd5d6c30e9319c7ab376bdb9c) at Thu Dec 22 17:51:26 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://jira.spring.io/si/jira.issueviews:issue-xml/SPR-1980/SPR-1980.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>Spring JIRA</title>
    <link>https://jira.spring.io</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.4.11</version>
        <build-number>64026</build-number>
        <build-date>25-08-2015</build-date>
    </build-info>

<item>
            <title>[SPR-1980] Aspects can not have a proxied property</title>
                <link>https://jira.spring.io/browse/SPR-1980</link>
                <project id="10000" key="SPR">Spring Framework</project>
                    <description>&lt;p&gt;Hi,&lt;br/&gt;
I think I found a bug with Spring&apos;s aspects.&lt;br/&gt;
Actually I wanted to inject a HibernateDAO in a Spring aspect.&lt;br/&gt;
My HibernateDAO implements a JobDAO interface.&lt;br/&gt;
The hibernateDAO also extends HibernateDaoSupport and I made it transactional&lt;br/&gt;
with the configuration below. The problem is that if the DAO is used a property&lt;br/&gt;
in an aspect, it looses its transactional &quot;aspect&quot;. Below, if i comment out&lt;br/&gt;
the section with beforeAdviceJobAuth bean and jobAuthorizationAspect,&lt;br/&gt;
my DAO is transactional, Hibernate session is flushed, transaction is committed.&lt;br/&gt;
If I uncomment the declarations of the beans (beforeAdviceJobAuth bean and jobAuthorizationAspect)&lt;br/&gt;
like below, the DAO is not transactional anymore.&lt;br/&gt;
Hibernate session is flushed when a method of the HibernateDAO ends but transaction&lt;br/&gt;
is never commited (or rollbacked). &lt;br/&gt;
I think it is linked to the fact the DAO is injected in a Spring aspect and therefore proxied and&lt;br/&gt;
I don&apos;t know why but it looses its transaction behaviour.&lt;/p&gt;

&lt;p&gt;    ...&lt;br/&gt;
    &amp;lt;bean id=&quot;hibernatebaseDao&quot; abstract=&quot;true&quot;&amp;gt;&lt;br/&gt;
        &amp;lt;property name=&quot;sessionFactory&quot; ref=&quot;sessionFactory&quot;/&amp;gt;&lt;br/&gt;
    &amp;lt;/bean&amp;gt;&lt;/p&gt;

&lt;p&gt;    &amp;lt;bean id=&quot;jobDAO&quot; parent=&quot;hibernatebaseDao&quot; class=&quot;com.fis.integ2.dao.hibernate.HibernateJobDAO&quot;/&amp;gt;&lt;/p&gt;

&lt;p&gt;    &amp;lt;aop:config&amp;gt;&lt;br/&gt;
  		&amp;lt;aop:advisor pointcut=&quot;execution(* &lt;b&gt;..JobDAO.&lt;/b&gt;(..))&quot;&lt;br/&gt;
               advice-ref=&quot;txAdvice&quot;/&amp;gt;&lt;br/&gt;
	&amp;lt;/aop:config&amp;gt;&lt;/p&gt;

&lt;p&gt;	&amp;lt;tx:advice id=&quot;txAdvice&quot; transaction-manager=&quot;transactionManager&quot;&amp;gt;&lt;br/&gt;
		&amp;lt;tx:attributes&amp;gt;&lt;br/&gt;
	    	&amp;lt;tx:method name=&quot;insert*&quot;/&amp;gt;&lt;br/&gt;
	    	&amp;lt;tx:method name=&quot;update*&quot;/&amp;gt;&lt;br/&gt;
	    	&amp;lt;tx:method name=&quot;delete*&quot;/&amp;gt;&lt;br/&gt;
	     	&amp;lt;tx:method name=&quot;*&quot; read-only=&quot;true&quot;/&amp;gt;&lt;br/&gt;
	 	&amp;lt;/tx:attributes&amp;gt;		&lt;br/&gt;
	&amp;lt;/tx:advice&amp;gt;&lt;/p&gt;

&lt;p&gt;        &amp;lt;!-- If commented out below the DAO works --&amp;gt;&lt;br/&gt;
	&amp;lt;aop:config proxy-target-class=&quot;true&quot;&amp;gt;&lt;br/&gt;
		  &amp;lt;aop:aspect id=&quot;beforeAdviceJobAuth&quot; ref=&quot;jobAuthorizationAspect&quot;&amp;gt;&lt;br/&gt;
		  	&amp;lt;aop:advice &lt;br/&gt;
				kind=&quot;before&quot;&lt;br/&gt;
				method=&quot;checkForAuthorization&quot; arg-names=&quot;jobid&quot;&lt;br/&gt;
				pointcut=&quot;(execution(* com.fis.integ2.jobqueue.JobExecutorService.stopJob(..)) and args (jobid)) || ( execution(* com.fis.integ2.jobqueue.JobExecutorService.removeJob(..)) and args(jobid)) &quot;/&amp;gt;&lt;br/&gt;
		  &amp;lt;/aop:aspect&amp;gt;&lt;br/&gt;
	&amp;lt;/aop:config&amp;gt;&lt;/p&gt;


&lt;p&gt;	&amp;lt;bean id=&quot;jobAuthorizationAspect&quot; class=&quot;com.fis.integ2.security.JobAuthorizationAspect&quot;&amp;gt;&lt;br/&gt;
		&amp;lt;property name=&quot;jobDAO&quot;&amp;gt;&lt;br/&gt;
			&amp;lt;ref bean=&quot;jobDAO&quot;/&amp;gt;&lt;br/&gt;
		&amp;lt;/property&amp;gt;&lt;br/&gt;
	&amp;lt;/bean&amp;gt;&lt;/p&gt;</description>
            <key id="13891">SPR-1980</key>
            <summary>Aspects can not have a proxied property</summary>
                <type id="1" iconUrl="https://jira.spring.io/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://jira.spring.io/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://jira.spring.io/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="robh">Rob Harrop</assignee>
                                    <reporter username="bengali">Luc Dew</reporter>
                        <labels>
                    </labels>
                <created>Wed, 3 May 2006 19:43:36 +0000</created>
                <updated>Tue, 19 Jun 2012 03:52:25 +0000</updated>
                            <resolved>Wed, 5 Jul 2006 21:01:04 +0000</resolved>
                                    <version>2.0 M4</version>
                                    <fixVersion>2.0 RC2</fixVersion>
                                    <component>Core:AOP</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="17498" author="robh" created="Thu, 4 May 2006 21:18:28 +0000"  >&lt;p&gt;Luc,&lt;/p&gt;

&lt;p&gt;Have you tried specifying just a single &amp;lt;aop:config/&amp;gt; block? Also - is it possible to create a really simple test case that highlights this behaviour?&lt;/p&gt;

&lt;p&gt;Rob&lt;/p&gt;</comment>
                            <comment id="17505" author="bengali" created="Fri, 5 May 2006 20:24:17 +0000"  >&lt;p&gt;Hi Rob,&lt;br/&gt;
I couldn&apos;t specify a single block since 1 block required the proxy-target-class&lt;br/&gt;
to be set to true and another one the opposite.&lt;/p&gt;

&lt;p&gt;Anyway, I wrote a simple test case that reproduces the issue. It requires maven&lt;br/&gt;
for dependencies and mysql for database. Setup instructions are in the readme.txt&lt;/p&gt;

&lt;p&gt;Thanks for working on it and helping me on it.&lt;/p&gt;

&lt;p&gt;Luc&lt;/p&gt;</comment>
                            <comment id="17540" author="robh" created="Wed, 10 May 2006 02:29:46 +0000"  >&lt;p&gt;Luc,&lt;/p&gt;

&lt;p&gt;You cannot enable/disable target class proxying in invidual blocks. If one block uses it so do all the others. I think the issue here is related to this and the way that pointcuts are subseqently matched.&lt;/p&gt;

&lt;p&gt;Try re-defining this pointcut:&lt;/p&gt;

&lt;p&gt;&amp;lt;aop:advisor pointcut=&quot;execution(* &lt;b&gt;(..)) and within(&lt;/b&gt;..JobDAO+)&quot; advice-ref=&quot;txAdvice&quot;/&amp;gt; &lt;/p&gt;

&lt;p&gt;Let me know how that works&lt;/p&gt;

&lt;p&gt;Regards&lt;br/&gt;
,&lt;/p&gt;

&lt;p&gt;Rob&lt;/p&gt;</comment>
                            <comment id="17552" author="bengali" created="Thu, 11 May 2006 02:24:05 +0000"  >&lt;p&gt;Bug free version&lt;/p&gt;</comment>
                            <comment id="17554" author="bengali" created="Thu, 11 May 2006 02:31:56 +0000"  >&lt;p&gt;I tried what you asked and it didn&apos;t change anything, i still get the error. &lt;br/&gt;
But I  am not sure to have understood your instructions.&lt;/p&gt;

&lt;p&gt;I let the &amp;lt;aop:config proxy-target-class=&quot;true&quot;&amp;gt; declaration&lt;br/&gt;
since the &quot;within(*..JobDAO+)&quot; pointcut should be woven in all JobDAO implementations classes&lt;br/&gt;
and as you said the proxy-target-class attribute is global.&lt;/p&gt;

&lt;p&gt;I attached a new version of the simple test that reproduces the bug&lt;br/&gt;
(or what I think is a bug).&lt;br/&gt;
You can discard the previous version it was flawed !&lt;/p&gt;</comment>
                            <comment id="17625" author="robh" created="Mon, 15 May 2006 05:51:20 +0000"  >&lt;p&gt;Luc,&lt;/p&gt;

&lt;p&gt;I&apos;ve identified the core issue here, but unfortunately there is no quick fix and Juergen and I have decided to leave this as a known issue for RC1 thus I am rescheduling to RC2. In the meantime I can suggest a simple workaround. If you have your aspect class implement BeanFactoryAware you can look up the DAO by name, this is not ideal but it should work until I get a fix into CVS.&lt;/p&gt;

&lt;p&gt;Regards,&lt;/p&gt;

&lt;p&gt;Rob&lt;/p&gt;

&lt;p&gt;P.S. I would also suggest redefining your transactional proxies to operate on the service objects rather than DAOs. This will allow you to compose multiple data access operations in your service tier under a single transaction.&lt;/p&gt;</comment>
                            <comment id="17648" author="bengali" created="Tue, 16 May 2006 01:09:06 +0000"  >&lt;p&gt;Ok thanks,&lt;br/&gt;
for the workaround I reverted to the old transaction interceptor (Spring 1.2.X version) that operates&lt;br/&gt;
on the DAO interface.&lt;/p&gt;

&lt;p&gt;For the transactional service objects I agree it looks a better design.&lt;/p&gt;</comment>
                            <comment id="18005" author="robh" created="Wed, 14 Jun 2006 00:06:10 +0000"  >&lt;p&gt;Haven&apos;t forgotten about this - its just more difficult than we originally imagined &lt;img class=&quot;emoticon&quot; src=&quot;https://jira.spring.io/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="18414" author="juergen.hoeller" created="Wed, 5 Jul 2006 07:53:30 +0000"  >&lt;p&gt;This should now work correctly in the latest nightly snapshots - through a revised implementation of advisor auto-proxying. However, we still need to test whether it works in your specific scenario.&lt;/p&gt;

&lt;p&gt;Juergen&lt;/p&gt;</comment>
                            <comment id="18423" author="juergen.hoeller" created="Wed, 5 Jul 2006 21:01:04 +0000"  >&lt;p&gt;Considered as fixed for the time being. To be reopened if any further issues are encountered.&lt;/p&gt;

&lt;p&gt;Juergen&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="11631" name="springaop.zip" size="14880" author="bengali" created="Thu, 11 May 2006 02:24:05 +0000"/>
                            <attachment id="11620" name="springaop.zip" size="10598" author="bengali" created="Fri, 5 May 2006 20:24:17 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_10180" key="com.atlassian.jira.toolkit:dayslastcommented">
                        <customfieldname>Days since last comment</customfieldname>
                        <customfieldvalues>
                                        10 years, 26 weeks ago
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10170" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>First Response Date</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 4 May 2006 21:18:28 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10181" key="com.atlassian.jira.toolkit:lastusercommented">
                        <customfieldname>Last commented by a User</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>false</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_10182" key="com.atlassian.jira.toolkit:lastupdaterorcommenter">
                        <customfieldname>Last updater</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>tmarshall</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10880" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i03o53:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_10380" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>21453</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10171" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>