<!-- 
RSS generated by JIRA (6.4.11#64026-sha1:78f6ec473a3f058bd5d6c30e9319c7ab376bdb9c) at Thu Dec 22 20:09:39 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://jira.spring.io/si/jira.issueviews:issue-xml/SPR-12421/SPR-12421.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>Spring JIRA</title>
    <link>https://jira.spring.io</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.4.11</version>
        <build-number>64026</build-number>
        <build-date>25-08-2015</build-date>
    </build-info>

<item>
            <title>[SPR-12421] Improve thread safety in Spring JUnit integration</title>
                <link>https://jira.spring.io/browse/SPR-12421</link>
                <project id="10000" key="SPR">Spring Framework</project>
                    <description>&lt;h4&gt;&lt;a name=&quot;StatusQuo&quot;&gt;&lt;/a&gt;Status Quo&lt;/h4&gt;

&lt;p&gt;When using the maven surefire setting &lt;tt&gt;parallel=methods&lt;/tt&gt;, JUnit still creates only one runner instance per test class, i.e. one runner instance is used by multiple threads in parallel.&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;SpringJUnit4ClassRunner&lt;/tt&gt; uses a single &lt;tt&gt;TestContextManager&lt;/tt&gt; which stores the current &lt;tt&gt;TestContext&lt;/tt&gt; in an instance field.&lt;/p&gt;

&lt;h4&gt;&lt;a name=&quot;Proposal&quot;&gt;&lt;/a&gt;Proposal&lt;/h4&gt;

&lt;p&gt;&lt;tt&gt;SpringJUnit4ClassRunner&lt;/tt&gt; should use a &lt;tt&gt;ThreadLocal&lt;/tt&gt; instead of a single &lt;tt&gt;TestContextManager&lt;/tt&gt; instance field.&lt;/p&gt;

&lt;h4&gt;&lt;a name=&quot;Deliverables&quot;&gt;&lt;/a&gt;Deliverables&lt;/h4&gt;

&lt;ol&gt;
	&lt;li&gt;Improve thread safety for the &lt;tt&gt;SpringRunner&lt;/tt&gt; for JUnit 4.&lt;/li&gt;
	&lt;li&gt;Improve thread safety for the &lt;tt&gt;SpringClassRule&lt;/tt&gt; and &lt;tt&gt;SpringMethodRule&lt;/tt&gt; for JUnit 4.&lt;/li&gt;
	&lt;li&gt;Improve thread safety for the &lt;tt&gt;SpringExtension&lt;/tt&gt; for JUnit Jupiter (in JUnit 5).
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;Partially addressed in JUnit Jupiter in &lt;a href=&quot;https://github.com/junit-team/junit5/issues/478&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/junit-team/junit5/issues/478&lt;/a&gt;&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ol&gt;
</description>
            <key id="60585">SPR-12421</key>
            <summary>Improve thread safety in Spring JUnit integration</summary>
                <type id="4" iconUrl="https://jira.spring.io/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://jira.spring.io/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://jira.spring.io/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="3">Duplicate</resolution>
                                        <assignee username="sbrannen">Sam Brannen</assignee>
                                    <reporter username="batzee">Bastian Voigt</reporter>
                        <labels>
                    </labels>
                <created>Wed, 12 Nov 2014 01:29:44 +0000</created>
                <updated>Thu, 1 Sep 2016 15:17:32 +0000</updated>
                            <resolved>Thu, 1 Sep 2016 15:17:20 +0000</resolved>
                                    <version>3.0 GA</version>
                                                    <component>Test</component>
                        <due></due>
                            <votes>3</votes>
                                    <watches>5</watches>
                                                                <comments>
                            <comment id="109590" author="batzee" created="Wed, 12 Nov 2014 02:27:25 +0000"  >&lt;p&gt;I wrote a patch:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/BastianVoigt/spring-framework/commit/a5e466e12edca26fb3637d7acafc214f83019345&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/BastianVoigt/spring-framework/commit/a5e466e12edca26fb3637d7acafc214f83019345&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="114683" author="sbrannen" created="Sat, 18 Apr 2015 09:16:38 +0000"  >&lt;p&gt;&lt;a href=&quot;https://jira.spring.io/secure/ViewProfile.jspa?name=batzee&quot; class=&quot;user-hover&quot; rel=&quot;batzee&quot;&gt;Bastian Voigt&lt;/a&gt;, please submit an official pull request and make sure you have signed (and acknowledged in your pull request) the Contributor License Agreement.&lt;/p&gt;

&lt;p&gt;For details, consult Spring&apos;s &lt;a href=&quot;https://github.com/spring-projects/spring-framework/blob/master/CONTRIBUTING.md&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;CONTRIBUTING&lt;/a&gt; page.&lt;/p&gt;

&lt;p&gt;Thanks!&lt;/p&gt;

&lt;p&gt;Sam&lt;/p&gt;</comment>
                            <comment id="114697" author="sbrannen" created="Sun, 19 Apr 2015 13:00:47 +0000"  >&lt;p&gt;Please note that this issue is closely related to (and potentially a duplicate of) &lt;a href=&quot;https://jira.spring.io/browse/SPR-5863&quot; title=&quot;Allow for concurrent test execution in the TestContext framework&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPR-5863&quot;&gt;&lt;del&gt;SPR-5863&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="131542" author="mdeinum" created="Thu, 25 Aug 2016 09:44:27 +0000"  >&lt;p&gt;Pull Request available: &lt;a href=&quot;https://github.com/spring-projects/spring-framework/pull/1140&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/spring-projects/spring-framework/pull/1140&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="131543" author="mdeinum" created="Thu, 25 Aug 2016 09:45:13 +0000"  >&lt;p&gt;Also wondering if this applies to the JUnit5 test support or maybe that already works? &lt;/p&gt;</comment>
                            <comment id="131557" author="sbrannen" created="Thu, 25 Aug 2016 15:04:57 +0000"  >&lt;p&gt;&lt;a href=&quot;https://jira.spring.io/secure/ViewProfile.jspa?name=mdeinum&quot; class=&quot;user-hover&quot; rel=&quot;mdeinum&quot;&gt;Marten Deinum&lt;/a&gt;, thanks for submitting the PR.&lt;/p&gt;

&lt;p&gt;My major concern here is whether storing the &lt;tt&gt;TestContextManager&lt;/tt&gt; in a &lt;tt&gt;ThreadLocal&lt;/tt&gt; is sufficient for covering more advanced use cases such as the one outlined in &lt;a href=&quot;https://jira.spring.io/browse/SPR-5863&quot; title=&quot;Allow for concurrent test execution in the TestContext framework&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPR-5863&quot;&gt;&lt;del&gt;SPR-5863&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Have you put any thought into that?&lt;/p&gt;</comment>
                            <comment id="131559" author="sbrannen" created="Thu, 25 Aug 2016 15:08:42 +0000"  >&lt;blockquote&gt;&lt;p&gt;Also wondering if this applies to the JUnit5 test support or maybe that already works? &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Good question!&lt;/p&gt;

&lt;p&gt;The &lt;tt&gt;SpringExtension&lt;/tt&gt; for JUnit Jupiter (i.e., JUnit 5) relies on the &lt;tt&gt;org.junit.jupiter.api.extension.ExtensionContext.Store&lt;/tt&gt; for storing the &lt;tt&gt;TestContextManager&lt;/tt&gt; between invocations of the extension. So thread safety is ultimately determined by the implementation of &lt;tt&gt;Store&lt;/tt&gt;. &lt;tt&gt;Store&lt;/tt&gt; is unfortunately not thread-safe at the moment, so I&apos;ll open an issue to address that in JUnit Jupiter.&lt;/p&gt;</comment>
                            <comment id="131564" author="sbrannen" created="Thu, 25 Aug 2016 17:31:06 +0000"  >&lt;p&gt;Also, please note that creating new &lt;tt&gt;TestContextManager&lt;/tt&gt; per thread is an expensive task since it executes the &lt;em&gt;entire&lt;/em&gt; bootstrapping mechanism (i.e., all search algorithms for locating annotations, loading &lt;tt&gt;TestExecutionListeners&lt;/tt&gt;, loading context customizers, building the &lt;tt&gt;MergedContextConfiguration&lt;/tt&gt;, etc.). And... the bootstrapping process in Spring Boot 1.4 is even more exhaustive.&lt;/p&gt;

&lt;p&gt;In contrast, although it is considerably more complex, the general idea behind the proposal in &lt;a href=&quot;https://jira.spring.io/browse/SPR-5863&quot; title=&quot;Allow for concurrent test execution in the TestContext framework&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPR-5863&quot;&gt;&lt;del&gt;SPR-5863&lt;/del&gt;&lt;/a&gt; is to only load the &lt;tt&gt;TestContext&lt;/tt&gt; once and make it thread-safe as opposed to making the &lt;tt&gt;TestContextManager&lt;/tt&gt; thread-safe.&lt;/p&gt;</comment>
                            <comment id="131579" author="mdeinum" created="Fri, 26 Aug 2016 06:09:01 +0000"  >&lt;p&gt;I applied this patch as this was the most easy way to achieve this. Also I wondered what would happen if &lt;tt&gt;@DirtiesContext&lt;/tt&gt; was to be used and tests where run in parallel, if there is a shared context one might get some weird issues with that. &lt;/p&gt;

&lt;p&gt;However I have to agree that reloading everything per thread might be a bit heavy and with Spring Boot one might run into other issues. &lt;/p&gt;

&lt;p&gt;I&apos;ll have a stab at integrating the proposed changes from &lt;a href=&quot;https://jira.spring.io/browse/SPR-5863&quot; title=&quot;Allow for concurrent test execution in the TestContext framework&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPR-5863&quot;&gt;&lt;del&gt;SPR-5863&lt;/del&gt;&lt;/a&gt; and related issues. Will create a new branch for that (easier to start with a clean slate I guess). &lt;/p&gt;</comment>
                            <comment id="131592" author="sbrannen" created="Fri, 26 Aug 2016 11:35:05 +0000"  >&lt;blockquote&gt;&lt;p&gt;I applied this patch as this was the most easy way to achieve this.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I assumed that was the case. &lt;img class=&quot;emoticon&quot; src=&quot;https://jira.spring.io/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Also I wondered what would happen if &lt;tt&gt;@DirtiesContext&lt;/tt&gt; was to be used and tests where run in parallel, if there is a shared context one might get some weird issues with that. &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes, I assume horribly unpredictable things might happen in such scenarios. &lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I&apos;ll have a stab at integrating the proposed changes from &lt;a href=&quot;https://jira.spring.io/browse/SPR-5863&quot; title=&quot;Allow for concurrent test execution in the TestContext framework&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPR-5863&quot;&gt;&lt;del&gt;SPR-5863&lt;/del&gt;&lt;/a&gt; and related issues. Will create a new branch for that (easier to start with a clean slate I guess). &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Sounds good!&lt;/p&gt;

&lt;p&gt;And yes... we will definitely have to start from scratch due to all of the changes in recent years to the internals of the TCF. Plus, AFAIK, it is no longer permissible to accept external code other than via GitHub PRs where the contributor has signed the CLA. The same holds true for code in the test suite. So please keep that in mind.&lt;/p&gt;</comment>
                            <comment id="131789" author="sbrannen" created="Thu, 1 Sep 2016 15:17:20 +0000"  >&lt;p&gt;After careful consideration, I have decided to resolve this issue as a &lt;em&gt;duplicate&lt;/em&gt; of &lt;a href=&quot;https://jira.spring.io/browse/SPR-5863&quot; title=&quot;Allow for concurrent test execution in the TestContext framework&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPR-5863&quot;&gt;&lt;del&gt;SPR-5863&lt;/del&gt;&lt;/a&gt;, with the rationale that the correct places to ensure thread safety are the &lt;tt&gt;TestContext&lt;/tt&gt; (i.e., its mutable state) and &lt;tt&gt;ApplicationContext&lt;/tt&gt; loading and eviction.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10000">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="27066">SPR-5863</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_10180" key="com.atlassian.jira.toolkit:dayslastcommented">
                        <customfieldname>Days since last comment</customfieldname>
                        <customfieldvalues>
                                        16 weeks ago
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10170" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>First Response Date</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sat, 18 Apr 2015 09:16:38 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10181" key="com.atlassian.jira.toolkit:lastusercommented">
                        <customfieldname>Last commented by a User</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>false</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_10182" key="com.atlassian.jira.toolkit:lastupdaterorcommenter">
                        <customfieldname>Last updater</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>sbrannen</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10880" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i07ykf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_10380" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>46472</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_10120" key="com.atlassian.jira.plugin.system.customfieldtypes:url">
                        <customfieldname>Reference URL</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[http://stackoverflow.com/questions/26882936/why-does-springjunit4classrunner-not-work-with-surefire-parallel-methods]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_10171" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>