<!-- 
RSS generated by JIRA (6.4.11#64026-sha1:78f6ec473a3f058bd5d6c30e9319c7ab376bdb9c) at Thu Dec 22 18:43:42 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://jira.spring.io/si/jira.issueviews:issue-xml/SPR-11022/SPR-11022.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>Spring JIRA</title>
    <link>https://jira.spring.io</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.4.11</version>
        <build-number>64026</build-number>
        <build-date>25-08-2015</build-date>
    </build-info>

<item>
            <title>[SPR-11022] Race condition in AutowiredAnnotationBeanPostProcessor</title>
                <link>https://jira.spring.io/browse/SPR-11022</link>
                <project id="10000" key="SPR">Spring Framework</project>
                    <description>&lt;p&gt;The &lt;del&gt;&lt;tt&gt;AutowiredAnnotationBeanPostProcessor.AutowiredFieldElement&lt;/tt&gt; and&lt;/del&gt; &lt;tt&gt;AutowiredAnnotationBeanPostProcessor.AutowiredMethodElement&lt;/tt&gt; have double-check pattern and this results in a serious race condition resulting in &lt;tt&gt;@Autowired&lt;/tt&gt; &lt;del&gt;field&lt;/del&gt;/methods not being autowired.&lt;/p&gt;

&lt;h5&gt;&lt;a name=&quot;Explanation&quot;&gt;&lt;/a&gt;Explanation&lt;/h5&gt;
&lt;p&gt;In both &lt;del&gt;&lt;tt&gt;AutowiredFieldElement&lt;/tt&gt;,&lt;/del&gt; &lt;tt&gt;AutowiredMethodElement&lt;/tt&gt; the &lt;tt&gt;volatile boolean cached&lt;/tt&gt; guards &lt;tt&gt;volatile Object[] cachedMethodArguments&lt;/tt&gt; but when the &lt;tt&gt;cachedMethodArguments&lt;/tt&gt; is populated the order is as follows:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;synchronize on this&lt;/li&gt;
	&lt;li&gt;set &lt;tt&gt;cachedMethodArguments&lt;/tt&gt; to new array (all fields null)
	&lt;ul&gt;
		&lt;li&gt;this gets flushed immediatelly, the &lt;tt&gt;cachedMethodArguments&lt;/tt&gt; is volatile&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
	&lt;li&gt;populate &lt;tt&gt;cachedMethodArguments&lt;/tt&gt;
	&lt;ul&gt;
		&lt;li&gt;&lt;b&gt;this is not flushed&lt;/b&gt;, as &lt;b&gt;array elements are not volatile&lt;/b&gt;&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
	&lt;li&gt;set &lt;tt&gt;cached = true&lt;/tt&gt;
	&lt;ul&gt;
		&lt;li&gt;this gets flushed immediatelly, the &lt;tt&gt;cached&lt;/tt&gt; is volatile&lt;/li&gt;
		&lt;li&gt;&lt;b&gt;and bang!&lt;/b&gt; now if some other thread enters the method, it will find &lt;tt&gt;cached=true&lt;/tt&gt;, &lt;tt&gt;cachedMethodArguments&lt;/tt&gt; not null, but its contents may be pretty anything&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
	&lt;li&gt;leave synchronization block&lt;/li&gt;
&lt;/ol&gt;


&lt;h5&gt;&lt;a name=&quot;solution&quot;&gt;&lt;/a&gt;solution&lt;/h5&gt;
&lt;ul&gt;
	&lt;li&gt;set &lt;tt&gt;cachedMethodArguments&lt;/tt&gt; only after this array is fully created and populated&lt;/li&gt;
	&lt;li&gt;or do not use double check pattern&lt;/li&gt;
&lt;/ul&gt;
</description>
            <key id="51487">SPR-11022</key>
            <summary>Race condition in AutowiredAnnotationBeanPostProcessor</summary>
                <type id="1" iconUrl="https://jira.spring.io/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="1" iconUrl="https://jira.spring.io/images/icons/priorities/blocker.png">Blocker</priority>
                        <status id="5" iconUrl="https://jira.spring.io/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="3">Duplicate</resolution>
                                        <assignee username="pwebb">Phil Webb</assignee>
                                    <reporter username="piofin">Piotr Findeisen</reporter>
                        <labels>
                    </labels>
                <created>Wed, 23 Oct 2013 07:18:39 +0000</created>
                <updated>Wed, 23 Oct 2013 14:27:01 +0000</updated>
                            <resolved>Wed, 23 Oct 2013 14:18:21 +0000</resolved>
                                    <version>3.1.2</version>
                                    <fixVersion>3.1.4</fixVersion>
                                    <component>Core:DI</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="94747" author="pofin" created="Wed, 23 Oct 2013 07:22:28 +0000"  >&lt;p&gt;I&apos;ve created a repro project, &lt;a href=&quot;https://github.com/spring-projects/spring-framework-issues/pull/59&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/spring-projects/spring-framework-issues/pull/59&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="94748" author="pofin" created="Wed, 23 Oct 2013 07:28:49 +0000"  >&lt;p&gt;This looks very similar to &lt;a href=&quot;https://jira.spring.io/browse/SPR-7635&quot; title=&quot;Unresolved thread safety issue in AutowiredAnnotationBeanPostProcessor.AutowiredMethodElement&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPR-7635&quot;&gt;&lt;del&gt;SPR-7635&lt;/del&gt;&lt;/a&gt;, &lt;a href=&quot;https://jira.spring.io/browse/SPR-4932&quot; title=&quot;Threading bug with Autowired Annotation / AutowiredAnnotationBeanPostProcessor&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPR-4932&quot;&gt;&lt;del&gt;SPR-4932&lt;/del&gt;&lt;/a&gt;, &lt;a href=&quot;https://jira.spring.io/browse/SPR-5658&quot; title=&quot;Race condition in AutowiredAnnotationBeanPostProcessor.AutowiredMethodElement.inject()?&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPR-5658&quot;&gt;&lt;del&gt;SPR-5658&lt;/del&gt;&lt;/a&gt; but all those issues should be fixed in my version (3.1.2), so I assume this is not a duplicate of those issues.&lt;/p&gt;</comment>
                            <comment id="94758" author="pwebb" created="Wed, 23 Oct 2013 09:46:53 +0000"  >&lt;p&gt;I have merged your repo issue &lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; but after upgrading to Spring 3.1.4 it appears to pass. Could you please verify with that release and re-open this issue if you still see problems.&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://github.com/spring-projects/spring-framework-issues/commit/57002b64c6be2f4e9ac6dabded52005be9d16c39&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/spring-projects/spring-framework-issues/commit/57002b64c6be2f4e9ac6dabded52005be9d16c39&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="94777" author="pofin" created="Wed, 23 Oct 2013 13:38:33 +0000"  >&lt;p&gt;&lt;a href=&quot;https://jira.spring.io/secure/ViewProfile.jspa?name=pwebb&quot; class=&quot;user-hover&quot; rel=&quot;pwebb&quot;&gt;Phil Webb&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;thanks for your prompt reply.&lt;/p&gt;

&lt;p&gt;Have you been able to reproduce the bug using &lt;tt&gt;3.1.2&lt;/tt&gt; before you updated my repro project?&lt;/p&gt;</comment>
                            <comment id="94778" author="pofin" created="Wed, 23 Oct 2013 13:52:33 +0000"  >&lt;p&gt;From code reading &amp;#8211; this does not affect &lt;tt&gt;AutowiredFieldElement&lt;/tt&gt;; I&apos;ve fixed the description.&lt;/p&gt;</comment>
                            <comment id="94780" author="pwebb" created="Wed, 23 Oct 2013 14:03:24 +0000"  >&lt;p&gt;Yes, The repro project you submitted failed on 3.1.2 but not 3.1.4&lt;/p&gt;</comment>
                            <comment id="94782" author="pofin" created="Wed, 23 Oct 2013 14:11:40 +0000"  >&lt;p&gt;Oh, good, thanks! So I confirm, we see the same.&lt;/p&gt;

&lt;p&gt;Could you please change resolution to something more adequate? &apos;Fixed&apos; perhaps (since bug existed but is fixed)? Or &apos;Obsolete&apos;?&lt;/p&gt;

&lt;p&gt;I&apos;m afraid someone looking at &apos;Cannot reproduce&apos; resolution may think it was just a bogus bug report and they may not consider this a reason to upgrade to 3.1.4. &lt;br/&gt;
(Besides the obvious problem that I link here from internal BTS and I&apos;ll have problem explaining why I said my internal bug was caused by Spring)&lt;/p&gt;</comment>
                            <comment id="94783" author="pwebb" created="Wed, 23 Oct 2013 14:19:02 +0000"  >&lt;p&gt;I have marked it as Duplicate since I assume that it was raised and fixed previously.&lt;/p&gt;</comment>
                            <comment id="94784" author="pofin" created="Wed, 23 Oct 2013 14:27:01 +0000"  >&lt;p&gt;Thanks!&lt;/p&gt;

&lt;p&gt;Btw. I see that the only commit between 3.1.2 and 3.1.4 towards &lt;tt&gt;./org.springframework.beans/src/main/java/org/springframework/beans/factory/annotation/AutowiredAnnotationBeanPostProcessor.java&lt;/tt&gt; is this:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;&lt;a href=&quot;https://github.com/spring-projects/spring-framework/commit/26ee0c4842ca83dec213b5422d0af18ba2e3ce6c&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/spring-projects/spring-framework/commit/26ee0c4842ca83dec213b5422d0af18ba2e3ce6c&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;It does not change how the &lt;tt&gt;cachedMethodArguments&lt;/tt&gt; array is handled.&lt;br/&gt;
So either my initial reasoning was a total crap (quite likely, I presume) or I don&apos;t understand why it does occur no longer.&lt;/p&gt;

&lt;p&gt;Anyway &amp;#8211; thanks!&lt;/p&gt;

&lt;p&gt;(I still will have problem upgrading Spring to 3.1.4 because of &lt;a href=&quot;https://jira.spring.io/browse/SPR-10995&quot; title=&quot;Spring cannot find setter if subclass overrides getter narrowing return type&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPR-10995&quot;&gt;&lt;del&gt;SPR-10995&lt;/del&gt;&lt;/a&gt;)&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_10180" key="com.atlassian.jira.toolkit:dayslastcommented">
                        <customfieldname>Days since last comment</customfieldname>
                        <customfieldvalues>
                                        3 years, 9 weeks, 1 day ago
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10170" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>First Response Date</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 23 Oct 2013 09:37:12 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10181" key="com.atlassian.jira.toolkit:lastusercommented">
                        <customfieldname>Last commented by a User</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>true</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_10182" key="com.atlassian.jira.toolkit:lastupdaterorcommenter">
                        <customfieldname>Last updater</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>piofin</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10880" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i06nmn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_10380" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>38866</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10171" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>