<!-- 
RSS generated by JIRA (6.4.11#64026-sha1:78f6ec473a3f058bd5d6c30e9319c7ab376bdb9c) at Thu Dec 22 20:30:56 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://jira.spring.io/si/jira.issueviews:issue-xml/SPR-4916/SPR-4916.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>Spring JIRA</title>
    <link>https://jira.spring.io</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.4.11</version>
        <build-number>64026</build-number>
        <build-date>25-08-2015</build-date>
    </build-info>

<item>
            <title>[SPR-4916] CLONE -IllegalStateException thrown by JBoss 4.0.5.11 when PROPAGATION_REQUIRES_NEW used during active transaction in MessageBean with BMT</title>
                <link>https://jira.spring.io/browse/SPR-4916</link>
                <project id="10000" key="SPR">Spring Framework</project>
                    <description>&lt;p&gt;Deploy a MessageBean that is using BMT.  The following sequence of events in the onMessage() method will cause the IllegalStateException:&lt;/p&gt;

&lt;p&gt;1. create TransactionTemplate with PROPAGATION_REQUIRED&lt;br/&gt;
2. in the execute do this:&lt;br/&gt;
  2a. Connection conn = DataSourceUtils.getConnection(ds);&lt;br/&gt;
  2b. DataSourceUtils.releaseConnection(conn, ds);&lt;br/&gt;
  2c. call method that does the following:&lt;br/&gt;
        I. create TransactionTemplate with PROPAGATION_REQUIRES_NEW&lt;br/&gt;
        II. call execute and the exception is thrown.&lt;/p&gt;

&lt;p&gt;Here is the debug and stacktrace:&lt;/p&gt;

&lt;p&gt;12:03:50,703 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;STDOUT&amp;#93;&lt;/span&gt; MyMessageBean got message!&lt;br/&gt;
12:03:50,705 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;STDOUT&amp;#93;&lt;/span&gt; // obtain DataSource&lt;br/&gt;
12:03:50,707 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;STDOUT&amp;#93;&lt;/span&gt; *** Create TransactionManager&lt;br/&gt;
12:03:50,900 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;org.springframework.transaction.jta.JtaTransactionManager&amp;#93;&lt;/span&gt; Retrieving JTA UserTransaction from JNDI location &lt;span class=&quot;error&quot;&gt;&amp;#91;java:comp/UserTransaction&amp;#93;&lt;/span&gt;&lt;br/&gt;
12:03:50,901 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;org.springframework.jndi.JndiTemplate&amp;#93;&lt;/span&gt; Looking up JNDI object with name &lt;span class=&quot;error&quot;&gt;&amp;#91;java:comp/UserTransaction&amp;#93;&lt;/span&gt;&lt;br/&gt;
12:03:50,981 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;org.springframework.transaction.jta.JtaTransactionManager&amp;#93;&lt;/span&gt; Retrieving JTA TransactionManager from JNDI location &lt;span class=&quot;error&quot;&gt;&amp;#91;java:/TransactionManager&amp;#93;&lt;/span&gt;&lt;br/&gt;
12:03:50,983 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;org.springframework.jndi.JndiTemplate&amp;#93;&lt;/span&gt; Looking up JNDI object with name &lt;span class=&quot;error&quot;&gt;&amp;#91;java:/TransactionManager&amp;#93;&lt;/span&gt;&lt;br/&gt;
12:03:50,985 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;org.springframework.transaction.jta.JtaTransactionManager&amp;#93;&lt;/span&gt; Using JTA UserTransaction: org.jboss.ejb.EnterpriseContext$UserTransactionImpl@66d882&lt;br/&gt;
12:03:50,987 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;org.springframework.transaction.jta.JtaTransactionManager&amp;#93;&lt;/span&gt; Using JTA TransactionManager: org.jboss.tm.TxManager@104e65&lt;br/&gt;
12:03:50,988 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;STDOUT&amp;#93;&lt;/span&gt; *** Create TransactionTemplate&lt;br/&gt;
12:03:50,997 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;STDOUT&amp;#93;&lt;/span&gt; *** Propagation=0&lt;br/&gt;
12:03:51,005 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;org.springframework.transaction.jta.JtaTransactionManager&amp;#93;&lt;/span&gt; Using transaction object &lt;span class=&quot;error&quot;&gt;&amp;#91;org.springframework.transaction.jta.JtaTransactionObject@401ab1&amp;#93;&lt;/span&gt;&lt;br/&gt;
12:03:51,007 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;org.springframework.transaction.jta.JtaTransactionManager&amp;#93;&lt;/span&gt; Creating new transaction with name &lt;span class=&quot;error&quot;&gt;&amp;#91;null&amp;#93;&lt;/span&gt;&lt;br/&gt;
12:03:51,017 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;org.springframework.transaction.support.TransactionSynchronizationManager&amp;#93;&lt;/span&gt; Initializing transaction synchronization&lt;br/&gt;
12:03:51,026 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;STDOUT&amp;#93;&lt;/span&gt; *** doInTransaction org.springframework.transaction.support.DefaultTransactionStatus@bc60f2&lt;br/&gt;
12:03:51,056 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;org.springframework.jdbc.datasource.DataSourceUtils&amp;#93;&lt;/span&gt; Fetching JDBC Connection from DataSource&lt;br/&gt;
12:03:53,260 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;org.springframework.jdbc.datasource.DataSourceUtils&amp;#93;&lt;/span&gt; Registering transaction synchronization for JDBC Connection&lt;br/&gt;
12:03:53,419 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;org.springframework.transaction.support.TransactionSynchronizationManager&amp;#93;&lt;/span&gt; Bound value &lt;span class=&quot;error&quot;&gt;&amp;#91;org.springframework.jdbc.datasource.ConnectionHolder@2900c9&amp;#93;&lt;/span&gt; for key &lt;span class=&quot;error&quot;&gt;&amp;#91;org.jboss.resource.adapter.jdbc.WrapperDataSource@bf2c98&amp;#93;&lt;/span&gt; to thread &lt;span class=&quot;error&quot;&gt;&amp;#91;JMS SessionPool Worker-0&amp;#93;&lt;/span&gt;&lt;br/&gt;
12:03:53,420 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;STDOUT&amp;#93;&lt;/span&gt; *** doInConnection&lt;br/&gt;
12:03:53,420 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;org.springframework.transaction.support.TransactionSynchronizationManager&amp;#93;&lt;/span&gt; Retrieved value &lt;span class=&quot;error&quot;&gt;&amp;#91;org.springframework.jdbc.datasource.ConnectionHolder@2900c9&amp;#93;&lt;/span&gt; for key &lt;span class=&quot;error&quot;&gt;&amp;#91;org.jboss.resource.adapter.jdbc.WrapperDataSource@bf2c98&amp;#93;&lt;/span&gt; bound to thread &lt;span class=&quot;error&quot;&gt;&amp;#91;JMS SessionPool Worker-0&amp;#93;&lt;/span&gt;&lt;br/&gt;
12:03:53,421 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;STDOUT&amp;#93;&lt;/span&gt; === Create TransactionTemplate 2&lt;br/&gt;
12:03:53,422 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;STDOUT&amp;#93;&lt;/span&gt; === Propagation=3&lt;br/&gt;
12:03:53,424 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;org.springframework.transaction.jta.JtaTransactionManager&amp;#93;&lt;/span&gt; Using transaction object &lt;span class=&quot;error&quot;&gt;&amp;#91;org.springframework.transaction.jta.JtaTransactionObject@1548ee&amp;#93;&lt;/span&gt;&lt;br/&gt;
12:03:53,424 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;org.springframework.transaction.jta.JtaTransactionManager&amp;#93;&lt;/span&gt; Suspending current transaction, creating new transaction with name &lt;span class=&quot;error&quot;&gt;&amp;#91;null&amp;#93;&lt;/span&gt;&lt;br/&gt;
12:03:53,425 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;org.springframework.transaction.support.TransactionSynchronizationManager&amp;#93;&lt;/span&gt; Removed value &lt;span class=&quot;error&quot;&gt;&amp;#91;org.springframework.jdbc.datasource.ConnectionHolder@2900c9&amp;#93;&lt;/span&gt; for key &lt;span class=&quot;error&quot;&gt;&amp;#91;org.jboss.resource.adapter.jdbc.WrapperDataSource@bf2c98&amp;#93;&lt;/span&gt; from thread &lt;span class=&quot;error&quot;&gt;&amp;#91;JMS SessionPool Worker-0&amp;#93;&lt;/span&gt;&lt;br/&gt;
12:03:53,433 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;org.springframework.transaction.support.TransactionSynchronizationManager&amp;#93;&lt;/span&gt; Clearing transaction synchronization&lt;br/&gt;
12:03:53,438 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;org.springframework.transaction.support.TransactionTemplate&amp;#93;&lt;/span&gt; Initiating transaction rollback on application exception&lt;br/&gt;
java.lang.IllegalStateException: Trying to change transaction TransactionImpl:XidImpl&lt;span class=&quot;error&quot;&gt;&amp;#91;FormatId=257, GlobalId=samoa.local/20, BranchQual=, localId=20&amp;#93;&lt;/span&gt; in enlist!&lt;br/&gt;
        at org.jboss.resource.connectionmanager.TxConnectionManager$TxConnectionEventListener.enlist(TxConnectionManager.java:551)&lt;br/&gt;
        at org.jboss.resource.connectionmanager.TxConnectionManager.transactionStarted(TxConnectionManager.java:357)&lt;br/&gt;
        at org.jboss.resource.connectionmanager.CachedConnectionManager.userTransactionStarted(CachedConnectionManager.java:403)&lt;br/&gt;
        at org.jboss.ejb.EnterpriseContext$UserTransactionImpl.begin(EnterpriseContext.java:576)&lt;br/&gt;
        at org.springframework.transaction.jta.JtaTransactionManager.doJtaBegin(JtaTransactionManager.java:664)&lt;br/&gt;
        at org.springframework.transaction.jta.JtaTransactionManager.doBegin(JtaTransactionManager.java:622)&lt;br/&gt;
        at org.springframework.transaction.support.AbstractPlatformTransactionManager.handleExistingTransaction(AbstractPlatformTransactionManager.java:320)&lt;br/&gt;
        at org.springframework.transaction.support.AbstractPlatformTransactionManager.getTransaction(AbstractPlatformTransactionManager.java:262)&lt;br/&gt;
        at org.springframework.transaction.support.TransactionTemplate.execute(TransactionTemplate.java:111)&lt;br/&gt;
        at com.springdeveloper.ejb.MyMessageBean.testSpring2(MyMessageBean.java:95)&lt;br/&gt;
        at com.springdeveloper.ejb.MyMessageBean.access$100(MyMessageBean.java:24)&lt;br/&gt;
        at com.springdeveloper.ejb.MyMessageBean$1.doInTransactionWithoutResult(MyMessageBean.java:80)&lt;br/&gt;
        at org.springframework.transaction.support.TransactionCallbackWithoutResult.doInTransaction(TransactionCallbackWithoutResult.java:33)&lt;br/&gt;
        at org.springframework.transaction.support.TransactionTemplate.execute(TransactionTemplate.java:114)&lt;br/&gt;
        at com.springdeveloper.ejb.MyMessageBean.testSpring(MyMessageBean.java:71)&lt;br/&gt;
        at com.springdeveloper.ejb.MyMessageBean.onMessage(MyMessageBean.java:54)&lt;br/&gt;
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)&lt;br/&gt;
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
        at java.lang.reflect.Method.invoke(Method.java:585)&lt;br/&gt;
        at org.jboss.invocation.Invocation.performCall(Invocation.java:345)&lt;br/&gt;
        at org.jboss.ejb.MessageDrivenContainer$ContainerInterceptor.invoke(MessageDrivenContainer.java:475)&lt;br/&gt;
        at org.jboss.resource.connectionmanager.CachedConnectionInterceptor.invoke(CachedConnectionInterceptor.java:149)&lt;br/&gt;
        at org.jboss.ejb.plugins.CallValidationInterceptor.invoke(CallValidationInterceptor.java:48)&lt;br/&gt;
        at org.jboss.ejb.plugins.AbstractTxInterceptor.invokeNext(AbstractTxInterceptor.java:106)&lt;br/&gt;
        at org.jboss.ejb.plugins.AbstractTxInterceptorBMT.invokeNext(AbstractTxInterceptorBMT.java:158)&lt;br/&gt;
        at org.jboss.ejb.plugins.MessageDrivenTxInterceptorBMT.invoke(MessageDrivenTxInterceptorBMT.java:32)&lt;br/&gt;
        at org.jboss.ejb.plugins.MessageDrivenInstanceInterceptor.invoke(MessageDrivenInstanceInterceptor.java:101)&lt;br/&gt;
        at org.jboss.ejb.plugins.RunAsSecurityInterceptor.invoke(RunAsSecurityInterceptor.java:94)&lt;br/&gt;
        at org.jboss.ejb.plugins.LogInterceptor.invoke(LogInterceptor.java:192)&lt;br/&gt;
        at org.jboss.ejb.plugins.ProxyFactoryFinderInterceptor.invoke(ProxyFactoryFinderInterceptor.java:122)&lt;br/&gt;
        at org.jboss.ejb.MessageDrivenContainer.internalInvoke(MessageDrivenContainer.java:389)&lt;br/&gt;
        at org.jboss.ejb.Container.invoke(Container.java:873)&lt;br/&gt;
        at org.jboss.ejb.plugins.jms.JMSContainerInvoker.invoke(JMSContainerInvoker.java:1077)&lt;br/&gt;
        at org.jboss.ejb.plugins.jms.JMSContainerInvoker$MessageListenerImpl.onMessage(JMSContainerInvoker.java:1379)&lt;br/&gt;
        at org.jboss.jms.asf.StdServerSession.onMessage(StdServerSession.java:256)&lt;br/&gt;
        at org.jboss.mq.SpyMessageConsumer.sessionConsumerProcessMessage(SpyMessageConsumer.java:904)&lt;br/&gt;
        at org.jboss.mq.SpyMessageConsumer.addMessage(SpyMessageConsumer.java:160)&lt;br/&gt;
        at org.jboss.mq.SpySession.run(SpySession.java:333)&lt;br/&gt;
        at org.jboss.jms.asf.StdServerSession.run(StdServerSession.java:180)&lt;br/&gt;
        at EDU.oswego.cs.dl.util.concurrent.PooledExecutor$Worker.run(PooledExecutor.java:743)&lt;br/&gt;
        at java.lang.Thread.run(Thread.java:613)&lt;br/&gt;
12:03:53,447 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;org.springframework.transaction.jta.JtaTransactionManager&amp;#93;&lt;/span&gt; Triggering beforeCompletion synchronization&lt;br/&gt;
12:03:53,448 ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;org.springframework.transaction.support.TransactionTemplate&amp;#93;&lt;/span&gt; Application exception overridden by rollback exception&lt;br/&gt;
java.lang.IllegalStateException: Trying to change transaction TransactionImpl:XidImpl&lt;span class=&quot;error&quot;&gt;&amp;#91;FormatId=257, GlobalId=samoa.local/20, BranchQual=, localId=20&amp;#93;&lt;/span&gt; in enlist!&lt;br/&gt;
        at org.jboss.resource.connectionmanager.TxConnectionManager$TxConnectionEventListener.enlist(TxConnectionManager.java:551)&lt;br/&gt;
        at org.jboss.resource.connectionmanager.TxConnectionManager.transactionStarted(TxConnectionManager.java:357)&lt;br/&gt;
        at org.jboss.resource.connectionmanager.CachedConnectionManager.userTransactionStarted(CachedConnectionManager.java:403)&lt;br/&gt;
        at org.jboss.ejb.EnterpriseContext$UserTransactionImpl.begin(EnterpriseContext.java:576)&lt;br/&gt;
        at org.springframework.transaction.jta.JtaTransactionManager.doJtaBegin(JtaTransactionManager.java:664)&lt;br/&gt;
        at org.springframework.transaction.jta.JtaTransactionManager.doBegin(JtaTransactionManager.java:622)&lt;br/&gt;
        at org.springframework.transaction.support.AbstractPlatformTransactionManager.handleExistingTransaction(AbstractPlatformTransactionManager.java:320)&lt;br/&gt;
        at org.springframework.transaction.support.AbstractPlatformTransactionManager.getTransaction(AbstractPlatformTransactionManager.java:262)&lt;br/&gt;
        at org.springframework.transaction.support.TransactionTemplate.execute(TransactionTemplate.java:111)&lt;br/&gt;
        at com.springdeveloper.ejb.MyMessageBean.testSpring2(MyMessageBean.java:95)&lt;br/&gt;
        at com.springdeveloper.ejb.MyMessageBean.access$100(MyMessageBean.java:24)&lt;br/&gt;
        at com.springdeveloper.ejb.MyMessageBean$1.doInTransactionWithoutResult(MyMessageBean.java:80)&lt;br/&gt;
        at org.springframework.transaction.support.TransactionCallbackWithoutResult.doInTransaction(TransactionCallbackWithoutResult.java:33)&lt;br/&gt;
        at org.springframework.transaction.support.TransactionTemplate.execute(TransactionTemplate.java:114)&lt;br/&gt;
        at com.springdeveloper.ejb.MyMessageBean.testSpring(MyMessageBean.java:71)&lt;br/&gt;
        at com.springdeveloper.ejb.MyMessageBean.onMessage(MyMessageBean.java:54)&lt;br/&gt;
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)&lt;br/&gt;
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
        at java.lang.reflect.Method.invoke(Method.java:585)&lt;br/&gt;
        at org.jboss.invocation.Invocation.performCall(Invocation.java:345)&lt;br/&gt;
        at org.jboss.ejb.MessageDrivenContainer$ContainerInterceptor.invoke(MessageDrivenContainer.java:475)&lt;br/&gt;
        at org.jboss.resource.connectionmanager.CachedConnectionInterceptor.invoke(CachedConnectionInterceptor.java:149)&lt;br/&gt;
        at org.jboss.ejb.plugins.CallValidationInterceptor.invoke(CallValidationInterceptor.java:48)&lt;br/&gt;
        at org.jboss.ejb.plugins.AbstractTxInterceptor.invokeNext(AbstractTxInterceptor.java:106)&lt;br/&gt;
        at org.jboss.ejb.plugins.AbstractTxInterceptorBMT.invokeNext(AbstractTxInterceptorBMT.java:158)&lt;br/&gt;
        at org.jboss.ejb.plugins.MessageDrivenTxInterceptorBMT.invoke(MessageDrivenTxInterceptorBMT.java:32)&lt;br/&gt;
        at org.jboss.ejb.plugins.MessageDrivenInstanceInterceptor.invoke(MessageDrivenInstanceInterceptor.java:101)&lt;br/&gt;
        at org.jboss.ejb.plugins.RunAsSecurityInterceptor.invoke(RunAsSecurityInterceptor.java:94)&lt;br/&gt;
        at org.jboss.ejb.plugins.LogInterceptor.invoke(LogInterceptor.java:192)&lt;br/&gt;
        at org.jboss.ejb.plugins.ProxyFactoryFinderInterceptor.invoke(ProxyFactoryFinderInterceptor.java:122)&lt;br/&gt;
        at org.jboss.ejb.MessageDrivenContainer.internalInvoke(MessageDrivenContainer.java:389)&lt;br/&gt;
        at org.jboss.ejb.Container.invoke(Container.java:873)&lt;br/&gt;
        at org.jboss.ejb.plugins.jms.JMSContainerInvoker.invoke(JMSContainerInvoker.java:1077)&lt;br/&gt;
        at org.jboss.ejb.plugins.jms.JMSContainerInvoker$MessageListenerImpl.onMessage(JMSContainerInvoker.java:1379)&lt;br/&gt;
        at org.jboss.jms.asf.StdServerSession.onMessage(StdServerSession.java:256)&lt;br/&gt;
        at org.jboss.mq.SpyMessageConsumer.sessionConsumerProcessMessage(SpyMessageConsumer.java:904)&lt;br/&gt;
        at org.jboss.mq.SpyMessageConsumer.addMessage(SpyMessageConsumer.java:160)&lt;br/&gt;
        at org.jboss.mq.SpySession.run(SpySession.java:333)&lt;br/&gt;
        at org.jboss.jms.asf.StdServerSession.run(StdServerSession.java:180)&lt;br/&gt;
        at EDU.oswego.cs.dl.util.concurrent.PooledExecutor$Worker.run(PooledExecutor.java:743)&lt;br/&gt;
        at java.lang.Thread.run(Thread.java:613)&lt;br/&gt;
12:03:53,461 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;org.jboss.resource.connectionmanager.CachedConnectionManager&amp;#93;&lt;/span&gt; Closing a connection for you.  Please close them yourself: org.jboss.resource.adapter.jdbc.WrappedConnection@d698d3&lt;br/&gt;
java.lang.Throwable: STACKTRACE&lt;br/&gt;
        at org.jboss.resource.connectionmanager.CachedConnectionManager.registerConnection(CachedConnectionManager.java:333)&lt;br/&gt;
        at org.jboss.resource.connectionmanager.BaseConnectionManager2.allocateConnection(BaseConnectionManager2.java:482)&lt;br/&gt;
        at org.jboss.resource.connectionmanager.BaseConnectionManager2$ConnectionManagerProxy.allocateConnection(BaseConnectionManager2.java:894)&lt;br/&gt;
        at org.jboss.resource.adapter.jdbc.WrapperDataSource.getConnection(WrapperDataSource.java:73)&lt;br/&gt;
        at org.springframework.jdbc.datasource.DataSourceUtils.doGetConnection(DataSourceUtils.java:107)&lt;br/&gt;
        at org.springframework.jdbc.datasource.DataSourceUtils.getConnection(DataSourceUtils.java:77)&lt;br/&gt;
        at com.springdeveloper.ejb.MyMessageBean$1.doInTransactionWithoutResult(MyMessageBean.java:76)&lt;br/&gt;
        at org.springframework.transaction.support.TransactionCallbackWithoutResult.doInTransaction(TransactionCallbackWithoutResult.java:33)&lt;br/&gt;
        at org.springframework.transaction.support.TransactionTemplate.execute(TransactionTemplate.java:114)&lt;br/&gt;
        at com.springdeveloper.ejb.MyMessageBean.testSpring(MyMessageBean.java:71)&lt;br/&gt;
        at com.springdeveloper.ejb.MyMessageBean.onMessage(MyMessageBean.java:54)&lt;br/&gt;
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)&lt;br/&gt;
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
        at java.lang.reflect.Method.invoke(Method.java:585)&lt;br/&gt;
        at org.jboss.invocation.Invocation.performCall(Invocation.java:345)&lt;br/&gt;
        at org.jboss.ejb.MessageDrivenContainer$ContainerInterceptor.invoke(MessageDrivenContainer.java:475)&lt;br/&gt;
        at org.jboss.resource.connectionmanager.CachedConnectionInterceptor.invoke(CachedConnectionInterceptor.java:149)&lt;br/&gt;
        at org.jboss.ejb.plugins.CallValidationInterceptor.invoke(CallValidationInterceptor.java:48)&lt;br/&gt;
        at org.jboss.ejb.plugins.AbstractTxInterceptor.invokeNext(AbstractTxInterceptor.java:106)&lt;br/&gt;
        at org.jboss.ejb.plugins.AbstractTxInterceptorBMT.invokeNext(AbstractTxInterceptorBMT.java:158)&lt;br/&gt;
        at org.jboss.ejb.plugins.MessageDrivenTxInterceptorBMT.invoke(MessageDrivenTxInterceptorBMT.java:32)&lt;br/&gt;
        at org.jboss.ejb.plugins.MessageDrivenInstanceInterceptor.invoke(MessageDrivenInstanceInterceptor.java:101)&lt;br/&gt;
        at org.jboss.ejb.plugins.RunAsSecurityInterceptor.invoke(RunAsSecurityInterceptor.java:94)&lt;br/&gt;
        at org.jboss.ejb.plugins.LogInterceptor.invoke(LogInterceptor.java:192)&lt;br/&gt;
        at org.jboss.ejb.plugins.ProxyFactoryFinderInterceptor.invoke(ProxyFactoryFinderInterceptor.java:122)&lt;br/&gt;
        at org.jboss.ejb.MessageDrivenContainer.internalInvoke(MessageDrivenContainer.java:389)&lt;br/&gt;
        at org.jboss.ejb.Container.invoke(Container.java:873)&lt;br/&gt;
        at org.jboss.ejb.plugins.jms.JMSContainerInvoker.invoke(JMSContainerInvoker.java:1077)&lt;br/&gt;
        at org.jboss.ejb.plugins.jms.JMSContainerInvoker$MessageListenerImpl.onMessage(JMSContainerInvoker.java:1379)&lt;br/&gt;
        at org.jboss.jms.asf.StdServerSession.onMessage(StdServerSession.java:256)&lt;br/&gt;
        at org.jboss.mq.SpyMessageConsumer.sessionConsumerProcessMessage(SpyMessageConsumer.java:904)&lt;br/&gt;
        at org.jboss.mq.SpyMessageConsumer.addMessage(SpyMessageConsumer.java:160)&lt;br/&gt;
        at org.jboss.mq.SpySession.run(SpySession.java:333)&lt;br/&gt;
        at org.jboss.jms.asf.StdServerSession.run(StdServerSession.java:180)&lt;br/&gt;
        at EDU.oswego.cs.dl.util.concurrent.PooledExecutor$Worker.run(PooledExecutor.java:743)&lt;br/&gt;
        at java.lang.Thread.run(Thread.java:613)&lt;br/&gt;
12:03:53,473 ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;org.jboss.ejb.plugins.MessageDrivenTxInterceptorBMT&amp;#93;&lt;/span&gt; Application error: BMT stateless bean MyMessageBean should complete transactions before returning (ejb1.1 spec, 11.6.1)&lt;br/&gt;
12:03:53,478 ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;org.jboss.ejb.plugins.jms.JMSContainerInvoker&amp;#93;&lt;/span&gt; Exception in JMSCI message listener&lt;br/&gt;
javax.ejb.EJBException: null; CausedByException is:&lt;br/&gt;
        Application error: BMT stateless bean MyMessageBean should complete transactions before returning (ejb1.1 spec, 11.6.1)&lt;br/&gt;
        at org.jboss.ejb.plugins.LogInterceptor.handleException(LogInterceptor.java:411)&lt;br/&gt;
        at org.jboss.ejb.plugins.LogInterceptor.invoke(LogInterceptor.java:196)&lt;br/&gt;
        at org.jboss.ejb.plugins.ProxyFactoryFinderInterceptor.invoke(ProxyFactoryFinderInterceptor.java:122)&lt;br/&gt;
        at org.jboss.ejb.MessageDrivenContainer.internalInvoke(MessageDrivenContainer.java:389)&lt;br/&gt;
        at org.jboss.ejb.Container.invoke(Container.java:873)&lt;br/&gt;
        at org.jboss.ejb.plugins.jms.JMSContainerInvoker.invoke(JMSContainerInvoker.java:1077)&lt;br/&gt;
        at org.jboss.ejb.plugins.jms.JMSContainerInvoker$MessageListenerImpl.onMessage(JMSContainerInvoker.java:1379)&lt;br/&gt;
        at org.jboss.jms.asf.StdServerSession.onMessage(StdServerSession.java:256)&lt;br/&gt;
        at org.jboss.mq.SpyMessageConsumer.sessionConsumerProcessMessage(SpyMessageConsumer.java:904)&lt;br/&gt;
        at org.jboss.mq.SpyMessageConsumer.addMessage(SpyMessageConsumer.java:160)&lt;br/&gt;
        at org.jboss.mq.SpySession.run(SpySession.java:333)&lt;br/&gt;
        at org.jboss.jms.asf.StdServerSession.run(StdServerSession.java:180)&lt;br/&gt;
        at EDU.oswego.cs.dl.util.concurrent.PooledExecutor$Worker.run(PooledExecutor.java:743)&lt;br/&gt;
        at java.lang.Thread.run(Thread.java:613)&lt;br/&gt;
java.rmi.RemoteException: Application error: BMT stateless bean MyMessageBean should complete transactions before returning (ejb1.1 spec, 11.6.1)&lt;br/&gt;
        at org.jboss.ejb.plugins.AbstractTxInterceptorBMT.checkStatelessDone(AbstractTxInterceptorBMT.java:225)&lt;br/&gt;
        at org.jboss.ejb.plugins.AbstractTxInterceptorBMT.invokeNext(AbstractTxInterceptorBMT.java:165)&lt;br/&gt;
        at org.jboss.ejb.plugins.MessageDrivenTxInterceptorBMT.invoke(MessageDrivenTxInterceptorBMT.java:32)&lt;br/&gt;
        at org.jboss.ejb.plugins.MessageDrivenInstanceInterceptor.invoke(MessageDrivenInstanceInterceptor.java:101)&lt;br/&gt;
        at org.jboss.ejb.plugins.RunAsSecurityInterceptor.invoke(RunAsSecurityInterceptor.java:94)&lt;br/&gt;
        at org.jboss.ejb.plugins.LogInterceptor.invoke(LogInterceptor.java:192)&lt;br/&gt;
        at org.jboss.ejb.plugins.ProxyFactoryFinderInterceptor.invoke(ProxyFactoryFinderInterceptor.java:122)&lt;br/&gt;
        at org.jboss.ejb.MessageDrivenContainer.internalInvoke(MessageDrivenContainer.java:389)&lt;br/&gt;
        at org.jboss.ejb.Container.invoke(Container.java:873)&lt;br/&gt;
        at org.jboss.ejb.plugins.jms.JMSContainerInvoker.invoke(JMSContainerInvoker.java:1077)&lt;br/&gt;
        at org.jboss.ejb.plugins.jms.JMSContainerInvoker$MessageListenerImpl.onMessage(JMSContainerInvoker.java:1379)&lt;br/&gt;
        at org.jboss.jms.asf.StdServerSession.onMessage(StdServerSession.java:256)&lt;br/&gt;
        at org.jboss.mq.SpyMessageConsumer.sessionConsumerProcessMessage(SpyMessageConsumer.java:904)&lt;br/&gt;
        at org.jboss.mq.SpyMessageConsumer.addMessage(SpyMessageConsumer.java:160)&lt;br/&gt;
        at org.jboss.mq.SpySession.run(SpySession.java:333)&lt;br/&gt;
        at org.jboss.jms.asf.StdServerSession.run(StdServerSession.java:180)&lt;br/&gt;
        at EDU.oswego.cs.dl.util.concurrent.PooledExecutor$Worker.run(PooledExecutor.java:743)&lt;br/&gt;
        at java.lang.Thread.run(Thread.java:613)&lt;/p&gt;

</description>
            <key id="22569">SPR-4916</key>
            <summary>CLONE -IllegalStateException thrown by JBoss 4.0.5.11 when PROPAGATION_REQUIRES_NEW used during active transaction in MessageBean with BMT</summary>
                <type id="1" iconUrl="https://jira.spring.io/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://jira.spring.io/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://jira.spring.io/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="3">Duplicate</resolution>
                                        <assignee username="juergen.hoeller">Juergen Hoeller</assignee>
                                    <reporter username="yogeshbhootada">Yogesh</reporter>
                        <labels>
                    </labels>
                <created>Thu, 12 Jun 2008 13:40:39 +0000</created>
                <updated>Thu, 12 Jun 2008 18:40:18 +0000</updated>
                            <resolved>Thu, 12 Jun 2008 18:40:18 +0000</resolved>
                                    <version>1.2.5</version>
                                                    <component>Transaction</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="36657" author="yogeshbhootada" created="Thu, 12 Jun 2008 13:45:46 +0000"  >&lt;p&gt;Here is what I am getting....&lt;/p&gt;

&lt;p&gt;AddRootFolder Exception Occured:&lt;br/&gt;
java.lang.IllegalStateException: Trying to change transaction TransactionImpl:XidImpl[FormatId=257,&lt;br/&gt;
GlobalId=localhost/3572, BranchQual=, localId=3572] in enlist!&lt;br/&gt;
        at&lt;br/&gt;
org.jboss.resource.connectionmanager.TxConnectionManager$TxConnectionEventListener.enlist(TxConnectionManager.java:509)&lt;br/&gt;
        at&lt;br/&gt;
org.jboss.resource.connectionmanager.TxConnectionManager.transactionStarted(TxConnectionManager.java:314)&lt;br/&gt;
        at&lt;br/&gt;
org.jboss.resource.connectionmanager.CachedConnectionManager.userTransactionStarted(CachedConnectionManager.java:360)&lt;br/&gt;
        at&lt;br/&gt;
org.jboss.tm.usertx.client.ServerVMClientUserTransaction.begin(ServerVMClientUserTransaction.java:127)&lt;br/&gt;
        at&lt;br/&gt;
org.springframework.transaction.jta.JtaTransactionManager.doJtaBegin(JtaTransactionManager.java:724)&lt;br/&gt;
        at&lt;br/&gt;
org.springframework.transaction.jta.JtaTransactionManager.doBegin(JtaTransactionManager.java:681)&lt;br/&gt;
        at&lt;br/&gt;
org.springframework.transaction.support.AbstractPlatformTransactionManager.handleExistingTransaction(AbstractPlatformTransactionManager.java:396)&lt;br/&gt;
        at&lt;br/&gt;
org.springframework.transaction.support.AbstractPlatformTransactionManager.getTransaction(AbstractPlatformTransactionManager.java:329)&lt;br/&gt;
        at&lt;br/&gt;
org.springframework.transaction.interceptor.TransactionAspectSupport.createTransactionIfNecessary(TransactionAspectSupport.java:262)&lt;br/&gt;
        at&lt;br/&gt;
org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:101)&lt;br/&gt;
        at&lt;br/&gt;
org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:171)&lt;br/&gt;
        at&lt;br/&gt;
org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:89)&lt;br/&gt;
        at&lt;br/&gt;
org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:171)&lt;br/&gt;
        at&lt;br/&gt;
org.springframework.aop.framework.Cglib2AopProxy$DynamicAdvisedInterceptor.intercept(Cglib2AopProxy.java:629)&lt;br/&gt;
        at&lt;br/&gt;
services.impl.RootFolderManager$$EnhancerByCGLIB$$e20c4f34.addRootFolder(&amp;lt;generated&amp;gt;)&lt;br/&gt;
        at&lt;br/&gt;
services.impl.FolderServiceImpl.addRootFolder(FolderServiceImpl.java:922)&lt;br/&gt;
...&lt;br/&gt;
Caused by: common.error.impl.AppException&lt;br/&gt;
        ... 124 more&lt;br/&gt;
Caused by: java.lang.IllegalStateException: Trying to change transaction TransactionImpl:XidImpl[FormatId=257,&lt;br/&gt;
GlobalId=localhost/3572, BranchQual=, localId=3572] in enlist!&lt;br/&gt;
        at&lt;br/&gt;
org.jboss.resource.connectionmanager.TxConnectionManager$TxConnectionEventListener.enlist(TxConnectionManager.java:509)&lt;br/&gt;
        at&lt;br/&gt;
org.jboss.resource.connectionmanager.TxConnectionManager.transactionStarted(TxConnectionManager.java:314)&lt;br/&gt;
        at&lt;br/&gt;
org.jboss.resource.connectionmanager.CachedConnectionManager.userTransactionStarted(CachedConnectionManager.java:360)&lt;br/&gt;
        at&lt;br/&gt;
org.jboss.tm.usertx.client.ServerVMClientUserTransaction.begin(ServerVMClientUserTransaction.java:127)&lt;br/&gt;
        at&lt;br/&gt;
org.springframework.transaction.jta.JtaTransactionManager.doJtaBegin(JtaTransactionManager.java:724)&lt;br/&gt;
        at&lt;br/&gt;
org.springframework.transaction.jta.JtaTransactionManager.doBegin(JtaTransactionManager.java:681)&lt;br/&gt;
        at&lt;br/&gt;
org.springframework.transaction.support.AbstractPlatformTransactionManager.handleExistingTransaction(AbstractPlatformTransactionManager.java:396)&lt;br/&gt;
        at&lt;br/&gt;
org.springframework.transaction.support.AbstractPlatformTransactionManager.getTransaction(AbstractPlatformTransactionManager.java:329)&lt;br/&gt;
        at&lt;br/&gt;
org.springframework.transaction.interceptor.TransactionAspectSupport.createTransactionIfNecessary(TransactionAspectSupport.java:262)&lt;br/&gt;
        at&lt;br/&gt;
org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:101)&lt;br/&gt;
        at&lt;br/&gt;
org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:171)&lt;br/&gt;
        at&lt;br/&gt;
org.springframework.aop.interceptor.ExposeInvocationInterceptor.invoke(ExposeInvocationInterceptor.java:89)&lt;br/&gt;
        at&lt;br/&gt;
org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:171)&lt;br/&gt;
        at&lt;br/&gt;
org.springframework.aop.framework.Cglib2AopProxy$DynamicAdvisedInterceptor.intercept(Cglib2AopProxy.java:629)&lt;br/&gt;
        at&lt;br/&gt;
services.impl.RootFolderManager$$EnhancerByCGLIB$$e20c4f34.addRootFolder(&amp;lt;generated&amp;gt;)&lt;br/&gt;
        at&lt;br/&gt;
services.impl.FolderServiceImpl.addRootFolder(FolderServiceImpl.java:922)&lt;br/&gt;
        ... 121 more&lt;br/&gt;
2008-06-11 18:53:51,897 ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;com.googlecode.jsonplugin.rpc.RPCError&amp;#93;&lt;/span&gt; Cannot deactivate transaction synchronization - not active&lt;/p&gt;</comment>
                            <comment id="36662" author="juergen.hoeller" created="Thu, 12 Jun 2008 18:40:18 +0000"  >&lt;p&gt;As outlined in the original issue, JBoss insists on Connections being released eagely before a REQUIRES_NEW transactions starts. You seem to obtain JDBC Connections manually in your transactional code... Make sure that you release them &lt;b&gt;before&lt;/b&gt; touching a REQUIRES_NEW transaction. In other words: obtain a Connection very briefly only, releasing it as early as possible, reobtaining it later on if necessary. Spring&apos;s JdbcTemplate and co do this automatically since Spring 1.2.6; you need to do this in custom Connection handling code as well.&lt;/p&gt;

&lt;p&gt;Juergen&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10000">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="12553">SPR-1384</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_10180" key="com.atlassian.jira.toolkit:dayslastcommented">
                        <customfieldname>Days since last comment</customfieldname>
                        <customfieldvalues>
                                        8 years, 29 weeks ago
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10170" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>First Response Date</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 12 Jun 2008 18:40:18 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10181" key="com.atlassian.jira.toolkit:lastusercommented">
                        <customfieldname>Last commented by a User</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>false</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_10182" key="com.atlassian.jira.toolkit:lastupdaterorcommenter">
                        <customfieldname>Last updater</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>tmarshall</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10880" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i020dz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_10380" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>11772</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10171" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>