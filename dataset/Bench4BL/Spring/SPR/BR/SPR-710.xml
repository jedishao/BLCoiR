<!-- 
RSS generated by JIRA (6.4.11#64026-sha1:78f6ec473a3f058bd5d6c30e9319c7ab376bdb9c) at Thu Dec 22 19:34:00 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://jira.spring.io/si/jira.issueviews:issue-xml/SPR-710/SPR-710.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>Spring JIRA</title>
    <link>https://jira.spring.io</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.4.11</version>
        <build-number>64026</build-number>
        <build-date>25-08-2015</build-date>
    </build-info>

<item>
            <title>[SPR-710] Double closing connection with Hibernate</title>
                <link>https://jira.spring.io/browse/SPR-710</link>
                <project id="10000" key="SPR">Spring Framework</project>
                    <description>&lt;p&gt;The same thing as &lt;a href=&quot;https://jira.spring.io/browse/SPR-705&quot; title=&quot;TransactionAwareDSP with iBatis duplicates ConnectionSynchronization in TransactionManager&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPR-705&quot;&gt;&lt;del&gt;SPR-705&lt;/del&gt;&lt;/a&gt; happens while using Hibernate.&lt;/p&gt;

&lt;p&gt;Since TADSP registers Connection via DataSourceUtils - ConnectionSynchronization object - beforeCompletion closes used connection. And so does SpringSessionSynchronization beforeCompletion - closeSessionOrRegisterDeferredClose (via LocalDataSourceConnectionProvider closeConnection).&lt;/p&gt;

&lt;p&gt;Ok, as you said, closing already a closed connection isn&apos;t an error by the JDBC API, but that stack trace doesn&apos;t look good &lt;img class=&quot;emoticon&quot; src=&quot;https://jira.spring.io/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;.&lt;/p&gt;</description>
            <key id="11143">SPR-710</key>
            <summary>Double closing connection with Hibernate</summary>
                <type id="1" iconUrl="https://jira.spring.io/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://jira.spring.io/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://jira.spring.io/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="juergen.hoeller">Juergen Hoeller</assignee>
                                    <reporter username="alesj">Ales Justin</reporter>
                        <labels>
                    </labels>
                <created>Sun, 13 Feb 2005 20:41:57 +0000</created>
                <updated>Tue, 15 Feb 2005 00:02:03 +0000</updated>
                            <resolved>Mon, 14 Feb 2005 23:54:17 +0000</resolved>
                                    <version>1.1.4</version>
                                    <fixVersion>1.1.5</fixVersion>
                                    <component>Data</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12310" author="alesj" created="Mon, 14 Feb 2005 17:59:38 +0000"  >&lt;p&gt;&quot;And so does SpringSessionSynchronization beforeCompletion ...&quot;&lt;br/&gt;
My mistake - it is in SpringSessionSynchronization.afterCompletion().&lt;/p&gt;</comment>
                            <comment id="12314" author="juergen.hoeller" created="Mon, 14 Feb 2005 23:54:17 +0000"  >&lt;p&gt;Thanks for pointing this out. Of course, using a TransactionAwareDataSourceProxy is not the default in LocalSessionFactoryBean, so this issue just applies when explicitly switching &quot;useTransactionAwareDataSource&quot; on.&lt;/p&gt;

&lt;p&gt;This issue is harder to solve than the one with iBATIS SQL Maps: Both the Session and the Connection get cleaned up during transaction synchronization here. We need to make sure that the Session is always cleaned up before the Connection, to not actually close the Connection on Session synchronization but rather later on Connection synchronization.&lt;/p&gt;

&lt;p&gt;I&apos;ve introduced two refinements to address this:&lt;/p&gt;

&lt;p&gt;1. A reference count on ConnectionHolder, to be able to check whether there are still open references (that fetched a Connection but didn&apos;t call close for it). In such a case, Connection cleanup is performed in afterCompletion (to allow other synchronizations to perform cleanup work using the Connection), else in beforeCompletion (to avoid issues with strict JTA implementations that do not allow any JDBC access after transaction completion).&lt;/p&gt;

&lt;p&gt;2. TransactionSynchronizationManager sorts TransactionSynchronizations according to their order value if they implement the Ordered interface. ConnectionSynchronization has a higher order value than SessionSynchronization and co, so it will always be executed last. Synchronizations registered by Hibernate LOB types have the lowest order value, as they should be cleaned up first.&lt;/p&gt;

&lt;p&gt;Juergen&lt;/p&gt;</comment>
                            <comment id="12315" author="alesj" created="Tue, 15 Feb 2005 00:02:03 +0000"  >&lt;p&gt;&quot;Thanks for pointing this out.&quot;&lt;br/&gt;
No problem &lt;img class=&quot;emoticon&quot; src=&quot;https://jira.spring.io/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;. Thank you for solving it so fast.&lt;/p&gt;

&lt;p&gt;Where can I get this latest version or what classes have been changed / added?&lt;/p&gt;

&lt;p&gt;Rgds, Ales&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_10180" key="com.atlassian.jira.toolkit:dayslastcommented">
                        <customfieldname>Days since last comment</customfieldname>
                        <customfieldvalues>
                                        11 years, 46 weeks, 2 days ago
    
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10170" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>First Response Date</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 14 Feb 2005 23:54:17 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10181" key="com.atlassian.jira.toolkit:lastusercommented">
                        <customfieldname>Last commented by a User</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>true</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_10182" key="com.atlassian.jira.toolkit:lastupdaterorcommenter">
                        <customfieldname>Last updater</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>tmarshall</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10880" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i01fgf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_10380" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>8381</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10171" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>