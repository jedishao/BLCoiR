<!-- 
RSS generated by JIRA (6.4.11#64026-sha1:78f6ec473a3f058bd5d6c30e9319c7ab376bdb9c) at Fri Dec 23 01:41:58 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://jira.spring.io/si/jira.issueviews:issue-xml/LDAP-122/LDAP-122.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>Spring JIRA</title>
    <link>https://jira.spring.io</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.4.11</version>
        <build-number>64026</build-number>
        <build-date>25-08-2015</build-date>
    </build-info>

<item>
            <title>[LDAP-122] IllegalStateException: Cannot deactivate transaction synchronization - not active&quot; thrown when when &apos;inner&apos; transaction for LDAP context source fails to get a connection</title>
                <link>https://jira.spring.io/browse/LDAP-122</link>
                <project id="10071" key="LDAP">Spring LDAP</project>
                    <description>&lt;p&gt;Our project is using Spring-2.0.7 and Spring-ldap-1.2.1.&lt;/p&gt;

&lt;p&gt;We have a HibernateTransactionManager on an outer service, calling an inner service, which has wrapped an LDAP ContextSourceTransactionManager.&lt;/p&gt;

&lt;p&gt;If a transaction is attempted when LDAP isn&apos;t running, an exception occurs in Spring&lt;/p&gt;

&lt;p&gt;java.lang.IllegalStateException: Cannot deactivate transaction synchronization - not active&lt;br/&gt;
 at org.springframework.transaction.support.TransactionSynchronizationManager.clearSynchronization(TransactionSynchronizationManager.java:274)&lt;br/&gt;
 at org.springframework.transaction.support.TransactionSynchronizationManager.clear(TransactionSynchronizationManager.java:412)&lt;br/&gt;
 at org.springframework.transaction.support.AbstractPlatformTransactionManager.cleanupAfterCompletion(AbstractPlatformTransactionManager.java:916)&lt;br/&gt;
 at org.springframework.transaction.support.AbstractPlatformTransactionManager.processRollback(AbstractPlatformTransactionManager.java:785)&lt;br/&gt;
 at org.springframework.transaction.support.AbstractPlatformTransactionManager.rollback(AbstractPlatformTransactionManager.java:730)&lt;/p&gt;

&lt;p&gt;This then stops any future Hibernate transactions.&lt;/p&gt;

&lt;p&gt;I found an issue against Spring core, &lt;a href=&quot;http://jira.springframework.org/browse/SPR-3438&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://jira.springframework.org/browse/SPR-3438&lt;/a&gt; , which I think is the same problem.  This issue has been fixed in the extensions of AbstractPlatformTransactionManager in Spring core (eg HibernateTransactionManager, DataSourceTransactionManager).&lt;/p&gt;

&lt;p&gt;The issue is resolved by catching Exception in the various implementations of doBegin(), and rethrowing a CannotCreateTransactionException, which is caught by AbstractPlatformTransactionManager.getTransaction(), which in turn resumes the outer transaction.&lt;/p&gt;

&lt;p&gt;Should AbstractCompensatingTransactionManagerDelegate.doBegin() be doing the same? &lt;/p&gt;

&lt;p&gt;In other words, should the fix applied to Spring core for this issue also be applied to spring-ldap?&lt;/p&gt;

&lt;p&gt;To reproduce, the same test code in &lt;a href=&quot;http://jira.springframework.org/browse/SPR-3438&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://jira.springframework.org/browse/SPR-3438&lt;/a&gt; can be used, but with the txMgrInner being a ContextSourceTransactionManager.&lt;/p&gt;</description>
                <environment></environment>
        <key id="23365">LDAP-122</key>
            <summary>IllegalStateException: Cannot deactivate transaction synchronization - not active&quot; thrown when when &apos;inner&apos; transaction for LDAP context source fails to get a connection</summary>
                <type id="1" iconUrl="https://jira.spring.io/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://jira.spring.io/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://jira.spring.io/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="jacqueline">Jacqueline Stark</reporter>
                        <labels>
                    </labels>
                <created>Wed, 30 Jul 2008 14:34:07 +0000</created>
                <updated>Fri, 5 Feb 2016 21:17:47 +0000</updated>
                            <resolved>Tue, 21 Oct 2008 20:24:57 +0000</resolved>
                                    <version>1.2.1</version>
                                    <fixVersion>1.3.0-RC1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="38836" author="marthursson" created="Mon, 11 Aug 2008 16:52:24 +0000"  >&lt;p&gt;I&apos;m sure it would make sense to apply the same resolution to ContextSourceTransactionManager. Thanks for the suggestion. Will investigate this.&lt;/p&gt;</comment>
                            <comment id="40510" author="marthursson" created="Tue, 21 Oct 2008 20:24:57 +0000"  >&lt;p&gt;Now properly throwing a &lt;tt&gt;CannotCreateTransactionException&lt;/tt&gt; when something goes wrong when requesting a &lt;tt&gt;DirContext&lt;/tt&gt; instance from the underlying &lt;tt&gt;ContextSource&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="123560" author="rwinch" created="Fri, 5 Feb 2016 21:17:47 +0000"  >&lt;p&gt;This issue has been migrated to &lt;a href=&quot;https://github.com/spring-projects/spring-ldap/issues/160&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/spring-projects/spring-ldap/issues/160&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_10170" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>First Response Date</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 11 Aug 2008 16:52:24 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10280" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>24941</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10880" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i00ztj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_10380" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5848</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_10381" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Ranking</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>7023</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10171" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>