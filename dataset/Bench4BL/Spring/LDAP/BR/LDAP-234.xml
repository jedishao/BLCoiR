<!-- 
RSS generated by JIRA (6.4.11#64026-sha1:78f6ec473a3f058bd5d6c30e9319c7ab376bdb9c) at Fri Dec 23 01:39:49 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://jira.spring.io/si/jira.issueviews:issue-xml/LDAP-234/LDAP-234.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>Spring JIRA</title>
    <link>https://jira.spring.io</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.4.11</version>
        <build-number>64026</build-number>
        <build-date>25-08-2015</build-date>
    </build-info>

<item>
            <title>[LDAP-234] Rollback intermittently causes data loss</title>
                <link>https://jira.spring.io/browse/LDAP-234</link>
                <project id="10071" key="LDAP">Spring LDAP</project>
                    <description>&lt;p&gt;While creating a new user and adding that user to some groups, an exception occurred during a group assignment that triggered a rollback. The rollback had a side effect of removing everyone from one of the groups that the user had been added to. This group had several thousand users.  The code used for group assignment is rather trivial...&lt;/p&gt;
&lt;p/&gt;
&lt;div id=&quot;syntaxplugin&quot; class=&quot;syntaxplugin&quot; style=&quot;border: 1px dashed #bbb; border-radius: 5px !important; overflow: auto; max-height: 30em;&quot;&gt;
&lt;table cellspacing=&quot;0&quot; cellpadding=&quot;0&quot; border=&quot;0&quot; width=&quot;100%&quot; style=&quot;font-size: 1em; line-height: 1.4em !important; font-weight: normal; font-style: normal; color: black;&quot;&gt;
		&lt;tbody &gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;  margin-top: 10px;   width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;    public void assignUserToGroups(String userDN, List&amp;lt;String&amp;gt; groupDNs) throws NamingException {&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;        for (String groupDN : groupDNs) {&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;            DirContextOperations context = this.ldapTemplate.lookupContext(groupDN);&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;            context.addAttributeValue(LdapConstants.LDAP_ATTR_MEMBER, userDN);&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   width: auto; padding: 0;&quot;&gt;&amp;nbsp;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;            this.ldapTemplate.modifyAttributes(context);&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;        }&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
				&lt;tr id=&quot;syntaxplugin_code_and_gutter&quot;&gt;
						&lt;td  style=&quot; line-height: 1.4em !important; padding: 0em; vertical-align: top;&quot;&gt;
					&lt;pre style=&quot;font-size: 1em; margin: 0 10px;   margin-bottom: 10px;  width: auto; padding: 0;&quot;&gt;&lt;span style=&quot;color: black; font-family: &apos;Consolas&apos;, &apos;Bitstream Vera Sans Mono&apos;, &apos;Courier New&apos;, Courier, monospace !important;&quot;&gt;    }&lt;/span&gt;&lt;/pre&gt;
			&lt;/td&gt;
		&lt;/tr&gt;
			&lt;/tbody&gt;
&lt;/table&gt;
&lt;/div&gt;
&lt;p/&gt;
&lt;p&gt;Using Dynatrace we verified that a failure occurred during the modifyAttributes call. The failure was policy based and not related to Spring LDAP. After the exception is thrown the exception bubbles up to the top layer but at edge of service layer there is a 21 second time period where Spring LDAP is doing something. We then did a check of the AD audit logs and found that the user id for this application was busily removing thousands of users from a group during that time.&lt;/p&gt;

&lt;p&gt;The unfortunate part is that we can&apos;t be reproduced in our test environment. I have stepped through the code and found that Spring-LDAP does a replace as a rollback correction for an add. This is disconcerting since, for a time, the state of a critical group is solely dependent on the state of an application.&lt;/p&gt;

&lt;p&gt;I realize that I am giving a sub optimal bug report due to the hard-to-reproduce aspect however I am out of idea. All evidence on our side points to a Spring-LDAP transaction oddity. I am open to suggestions though.&lt;/p&gt;

&lt;p&gt;NOTE: JIRA lists 1.3.1 as an &quot;unreleased&quot; version while this is currently the production release version.&lt;/p&gt;</description>
                <environment>Windows Server 2008, ActiveDirectory</environment>
        <key id="41165">LDAP-234</key>
            <summary>Rollback intermittently causes data loss</summary>
                <type id="1" iconUrl="https://jira.spring.io/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="2" iconUrl="https://jira.spring.io/images/icons/priorities/critical.png">Critical</priority>
                        <status id="6" iconUrl="https://jira.spring.io/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="8">Complete</resolution>
                                        <assignee username="marthursson">Mattias Hellborg Arthursson</assignee>
                                    <reporter username="aewhite">Andrew White</reporter>
                        <labels>
                    </labels>
                <created>Mon, 5 Dec 2011 07:29:03 +0000</created>
                <updated>Fri, 5 Feb 2016 21:19:05 +0000</updated>
                            <resolved>Thu, 1 Aug 2013 02:13:44 +0000</resolved>
                                    <version>1.3.1</version>
                                    <fixVersion>1.3.2</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                            <timeestimate seconds="0">0d</timeestimate>
                            <timespent seconds="75900">2d 5h 5m</timespent>
                                <comments>
                            <comment id="88623" author="aewhite" created="Mon, 11 Mar 2013 06:07:34 +0000"  >&lt;p&gt;I realize this is old issue but I have a theory I would like to note. During rollback it appears that Spring LDAP is trying to restore a backup of attributes that it obtained before the modification. For large grousp (1500+ members in our case) the member attribute is blank. Instead members have to read using the &quot;;range=&amp;lt;lower&amp;gt;-&amp;lt;upper&amp;gt;&quot; syntax. I suspect this is the cause of the issue.&lt;/p&gt;</comment>
                            <comment id="89312" author="aewhite" created="Wed, 10 Apr 2013 13:45:46 +0000"  >&lt;p&gt;I have confirmed this is a bug related to rollbacks with large groups in Active Directory. If the group size is greater than 1500 then the AD paging takes over where normal member attribute reads would. To reproduce...&lt;/p&gt;

&lt;p&gt;1. Create a group in AD&lt;br/&gt;
2. Assigned 1501+ users to the group&lt;br/&gt;
3. Add a new user to the group and throw an exception or cause a rollback&lt;br/&gt;
4. Read members of the large group&lt;/p&gt;

&lt;p&gt;Expected: 1502 members&lt;br/&gt;
Actual: 0 members&lt;/p&gt;</comment>
                            <comment id="91284" author="fischefr" created="Wed, 26 Jun 2013 08:48:24 +0000"  >&lt;p&gt;It would be helpful to have at least a workaround. Did one of you try to use the method &quot;public void modifyAttributes(final Name dn, final ModificationItem[] mods)&quot; to add an element to an group? It would be interesting if a rollback causes data loss with this method, too.&lt;/p&gt;

&lt;p&gt;I&apos;m using spring ldap for AD and have to add people to groups with, soon. As far as I see noone is working at this problem &lt;img class=&quot;emoticon&quot; src=&quot;https://jira.spring.io/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="91285" author="aewhite" created="Wed, 26 Jun 2013 09:04:27 +0000"  >&lt;p&gt;You could setup a test to be sure but I think it only triggers up modified attributes. In this case the problem only eixsts for the members attribute. If you are modifing other attributes or adding attributes I &lt;b&gt;suspect&lt;/b&gt; the members attribute will be untouched.&lt;/p&gt;

&lt;p&gt;The workaround I did was to wrap write calls to Spring LDAP that &lt;b&gt;could&lt;/b&gt; modify that attribute in a try-catch block and do a manual rollback and throw a special exception that I then tell Spring&apos;s transactions manager to ignore. &lt;/p&gt;</comment>
                            <comment id="92198" author="marthursson" created="Tue, 30 Jul 2013 02:04:02 +0000"  >&lt;p&gt;&lt;a href=&quot;https://jira.spring.io/browse/LDAP-176&quot; title=&quot;AD Range Retrieval support&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LDAP-176&quot;&gt;&lt;del&gt;LDAP-176&lt;/del&gt;&lt;/a&gt; will probably come in handy when trying to figure out a solution for this.&lt;/p&gt;</comment>
                            <comment id="92200" author="marthursson" created="Tue, 30 Jul 2013 03:51:51 +0000"  >&lt;p&gt;I think that with the use of the code in sandbox for &lt;a href=&quot;https://jira.spring.io/browse/LDAP-176&quot; title=&quot;AD Range Retrieval support&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LDAP-176&quot;&gt;&lt;del&gt;LDAP-176&lt;/del&gt;&lt;/a&gt; we might be able to fix this. Just need to install a windows server with local AD server so that I have something to test against.&lt;/p&gt;</comment>
                            <comment id="92295" author="marthursson" created="Thu, 1 Aug 2013 02:13:44 +0000"  >&lt;p&gt;Included and elaborated on the AD range retrieval support classes from Marius in &lt;a href=&quot;https://jira.spring.io/browse/LDAP-176&quot; title=&quot;AD Range Retrieval support&quot; class=&quot;issue-link&quot; data-issue-key=&quot;LDAP-176&quot;&gt;&lt;del&gt;LDAP-176&lt;/del&gt;&lt;/a&gt;. These classes are now part of the public API in core and more importantly - for this particular bug - are used per default when calculating compensating transaction operation for modifications.&lt;/p&gt;

&lt;p&gt;Verified against a local test AD server, but it would be quite useful if someone would run a test against a &apos;real&apos; AD environment (see &lt;a href=&quot;https://github.com/SpringSource/spring-ldap/blob/master/test/integration-tests-ad/src/test/java/org/springframework/ldap/itest/ad/IncrementalAttributeMapperITest.java&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/SpringSource/spring-ldap/blob/master/test/integration-tests-ad/src/test/java/org/springframework/ldap/itest/ad/IncrementalAttributeMapperITest.java&lt;/a&gt; for the test case I was using to verify that this works). It should be available in the snapshot builds (&lt;a href=&quot;http://repo.springsource.org/simple/libs-snapshot-local/org/springframework/ldap/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://repo.springsource.org/simple/libs-snapshot-local/org/springframework/ldap/&lt;/a&gt;).&lt;/p&gt;</comment>
                            <comment id="123684" author="rwinch" created="Fri, 5 Feb 2016 21:19:05 +0000"  >&lt;p&gt;This issue has been migrated to &lt;a href=&quot;https://github.com/spring-projects/spring-ldap/issues/279&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/spring-projects/spring-ldap/issues/279&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10151">
                    <name>Relate</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="26116">LDAP-176</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_10170" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>First Response Date</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 26 Jun 2013 08:48:24 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10280" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>28494</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_10880" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i02q8f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_10380" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>15959</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_10381" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Ranking</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>15072</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_10171" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                </customfields>
    </item>
</channel>
</rss>