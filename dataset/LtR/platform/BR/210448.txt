Bug 210448  [Viewers] [JFace] AbstractTreeViewer inputChanged setRedraw should be in try/finallyThe inputChanged method on the AbstractTreeViewer makes use of setRedraw, which is good, but it doesn't use a try/finally block as per recommendations.

If an exception is thrown from within one of the methods called, redraw will remain false.

Additionally, the commented out portion is fine, but the fact that we have conditionals in the code that always evaluate to true is less fine.  When we're ready to actually determine when to use redraw we could put them back in.

Current code:
protected void inputChanged(Object input, Object oldInput) {
    preservingSelection(new Runnable() {
        public void run() {
            Control tree = getControl();
            boolean useRedraw = true;
            // (size > REDRAW_THRESHOLD) || (table.getItemCount() >
            // REDRAW_THRESHOLD);
            if (useRedraw) {
                tree.setRedraw(false);
            }
            removeAll(tree);
            tree.setData(getRoot());
            internalInitializeTree(tree);
            if (useRedraw) {
                tree.setRedraw(true);
            }
        }
    });
}

Suggestion:
protected void inputChanged(Object input, Object oldInput) {
    preservingSelection(new Runnable() {
        public void run() {
            Control tree = getControl();
            try {
                tree.setRedraw(false);
                removeAll(tree);
                tree.setData(getRoot());
                internalInitializeTree(tree);
            } finally {
                tree.setRedraw(true);
            }
        }
    });
}