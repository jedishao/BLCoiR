BasicPersistentEntity potentially suffers from ConcurrentModificationException.
BasicPersistentEntity exposes an addPersistentEntity(...) method to allow adding properties and essentially makes it mutable. 
This potentially opens it up to a concurrency problem given the following scenario:
1. We concurrently use MongoTemplate for inserting objects of a type not already known to the MappingContext.
2. Thread A enters getPersistentEntity(...) which discovers the entity not mapped already and thus calls addPersistentEntity(...). The algorithm in there eagerly adds the PersistentEntity object to the map of PersistentEntities to allow type self-references be detected.
No or some properties might have been discovered already.
3. Thread B enters getPersistentEntity(...) which now discovers the semi-parsed PersistentEntity and thus returns it.
This thread continues and at some point doWithProperties(...) gets invoked, iterating over the PersistentProperties already registered.
4. Meanwhile Thread A wants to add additional PersistentProperties and thus causes a ConcurrentModificationException in thread B.