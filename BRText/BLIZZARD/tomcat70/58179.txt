Atomicity violation.
My name is Bai Guangdong, a research fellow from National University of Singapore.
I find an atomicity violation similar to bug 53498.
The problem occurs in the same file java/org/apache/catalina/core/ApplicationContext.java.
Look at the code snippet below.

Suppose two threads T1 and T2 executes this code snippet with the same key ("name").
Initially, "attributes" is empty.
T1 executes line 791 and "oldValue" in T1 becomes null.
Before T1 executes line 794, T2 executes 791 and "oldValue" in T2 becomes null as well.
Then T1 executes line 794, and later T2 replaces T1's "value" at line 794.
Afterwards, both T1 and T2 fire the "beforeContextAttributeAdded" event at line 823.
However, in the above situation, "replaced" in T2 should be true and "beforeContextAttributeReplaced" should be fired at line 817.