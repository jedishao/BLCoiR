39769	Wrong loader myServlet destroy called myServlet shared directory web app Thread currentThread getContextClassLoader application unload classes shared directory servlet getClass getClassLoader shared classloader StandardCalssLoader understanding executing code web app Thread currentThread getContextClassLoader WebappLoader StandardContext problem occurs StandardWrapper unload calling servlet destroy method ClassLoader oldCtxClassLoader Thread currentThread getContextClassLoader ClassLoader classLoader instance getClass getClassLoader PrintStream System swallowOutput SystemLogHandler startCapture Call servlet destroy method instanceSupport fireInstanceEvent InstanceEvent DESTROY EVENT instance Thread currentThread setContextClassLoader classLoader System getSecurityManager SecurityUtil doAsPrivilege destroy instance SecurityUtil remove instance instance destroy code INSTANCE variable servlet loaded SHARED classloader classloader set thread classloader StandardContext getLoader problem occurs close dos windows suppose occurs uninstall webApp notice problem verified code problem David Gagnon Wrong loader myServlet destroy called myServlet shared directory test set jsp servlet add context start init
40380	Potential syncro problem StandardSession expire expire notify Mark session expired needed expiring man land manager expiring Potential syncro problem StandardSession expire set session load store internal max object remove
42530	backgroundProcess ManagerBase ContainerBase ContainerBackgroundProcessor processExpires processChildren ContainerBase Base process Expires Container run ServletException NullpointerException NullPointerException IOException � ManagerBase backgroundProcess throws NullPointerException
45453	AbstractJdbc2Statement executeWithFlags executeQuery execute RealmBase DigestAuthenticator findPrincipal getRoles JDBCRealm getPrincipal authenticate � JDBCRealm getRoles bad synchronization causes hangs w  DIGEST authentication
47158	AccessLogValve race condition problem Checked Locking pattern heavily usage AccessLogValve issues race condition judging article http umd pugh java memoryModel DoubleCheckedLocking html Based article variables declared rid race condition currentMillis currentDate AccessLogValve race condition problem set node element field log time format attribute
47524	McastServiceImpl executor dispatching events Created attachment details proposal McastServiceImpl dispatch events executor creating threads ReceiverBase queue address issue refactored code reuse attaching diff file filing bug Bugzilla procedure Trunk branch proceed Ariel McastServiceImpl executor dispatching events set async thread max executor count connection timeout
48172	JspRuntimeContext synch problems JspRuntimeContext jspReloadCount synchronised updated read getJspReloadCount instance accessed multiple threads returned current arbitrarily stale acceptable Javadoc getter synch field AtomicInteger fields classpath codeSource easily written constructor JspRuntimeContext synch problems jsp servlet set file path tag jar filter
48234	org apache catalina core ContainerBase getLogger thread safe org apache catalina core ContainerBase getLogger synchronised methods access org apache catalina core ContainerBase logger synch wrong org apache catalina core ContainerBase logger prevent unsynch access subclasses considerations apply logName logName Javadoc getLogger method returns parent logger org apache catalina core ContainerBase getLogger thread safe set test thread container find internal cache add
48248	tribes group interceptors MessageDispatchInterceptor org apache catalina tribes group interceptors MessageDispatchInterceptor communicate running threads tribes group interceptors MessageDispatchInterceptor set channel thread interceptor message object time member
48249	org apache tomcat util net NioBlockingSelector BlockPoller org apache tomcat util net NioBlockingSelector BlockPoller communicate running threads org apache tomcat util net NioBlockingSelector BlockPoller load test server client key set servlet container
48399	Lock fields Created attachment details Patch lock field field lock org apache catalina session DeltaSession diffLock mutable Lock fields set lock remove add status write attribute read
48790	Race condition org apache catalina session ManagerBase maxActive running tomcat race detector http alphaworks ibm tech msdk find race condition org apache catalina session ManagerBase field maxActive Data Race org apache catalina session ManagerBase maxActive Thread http Tid WRITE Lock Set org apache catalina session ManagerBase add Lorg apache catalina Session org apache catalina session StandardSession setId Ljava lang String org apache catalina session ManagerBase createSession Ljava lang String Lorg apache catalina Session org apache catalina session StandardManager createSession Ljava lang String Lorg apache catalina Session org apache catalina connector Request doGetSession Lorg apache catalina Session org apache catalina connector Request getSession Ljavax servlet http HttpSession org apache catalina connector RequestFacade getSession Ljavax servlet http HttpSession org apache catalina connector RequestFacade getSession Ljavax servlet http HttpSession ecyrd jspwiki AuthenticationManager login Ljavax servlet http HttpServletRequest Thread http Tid READ Lock Set org apache catalina session ManagerBase add Lorg apache catalina Session org apache catalina session StandardSession setId Ljava lang String org apache catalina session ManagerBase createSession Ljava lang String Lorg apache catalina Session org apache catalina session StandardManager createSession Ljava lang String Lorg apache catalina Session code snip ManagerBase java add Session session sessions session getIdInternal session size sessions size size maxActive maxActive size Statement statement executed atomic manner problem move statement statement block Race condition org apache catalina session ManagerBase maxActive session set test sessions time basic thread change
48843	wait run JIoEndpoint Worker processSocket JIoEndpoint getWorkerThread JIoEndpoint Acceptor Object Thread JIo Endpoint � Tomcat Acceptor Thread goes into wait  and it will never come back
48895	WebAppClassLoader clearThreadLocalMap concurrency issues memory leak protection WebAppClassLoader clearReferencesThreadLocals detects clears ThreadLocals prevent WebAppClassLoader instance issues concurrency enumerates Threads internal structures Thread memory barrier ensure consistent ThreadLocalMap examined theoretically ThreadLocal Thread properly cleaned application current thread undeploying application synchronization threads severe detecting leak invokes java lang ThreadLocal ThreadLocalMap remove ThreadLocal Thread ThreadLocalMap instance invocation Thread thread undeploys app remove method thread safe expungeStaleEntries method invoked clearThreadLocalMap webapp undeployed applications receive heavy load requests corrupt internal structures ThreadLocalMap instance propose detection leaks actual clearing optional disabled avoid encountering big problems production Idea improve clearing safe thread provoking leak tomcat worker threads mark dirty background task threads renew threads pool WebAppClassLoader clearThreadLocalMap concurrency issues set servlet loader message dir thread pool log
49129	DigestAuthenticator Helper incorrect lazy initialisation Findbugs method unsynchronized lazy initialization field compiler processor reorder instructions threads guaranteed completely initialized object method called multiple threads field correct problem DigestAuthenticator Helper incorrect lazy initialisation set nonce test digest invalid login jsp time
49144	Incorrect lazy initialization update fields Incorrect lazy initialization update fields org apache catalina startup Bootstrap daemon org apache catalina startup ContextConfig contextDigester Findbugs method unsynchronized lazy initialization field field set object stored location updated accessed setting field visible threads set futher accesses method set field serve initialize object multithreading bug prevents thread accessing stored object fully initialized feel confident method called multiple threads set field setting fully populated initialized Incorrect lazy initialization update fields set content member action port renderer table membership
49567	starting thread startAsync Runnable infinite amount doPosts generated Created attachment details testcase demonstrating bug starting thread startAsync Runnable infinite amount doPosts generated status Internal Server Error exception thrown tomcat attached code demonstrates printing Start async infinite amount times starting thread startAsync Runnable infinite amount doPosts generated async thread dispatch test request error servlet complete
49730	Race condition StandardThreadExecutor requests enqueued creating threads tomcat configure Executor minSpareThreads work memory leak issues redeployment development refresh webapp Safari Chrome Firefox resources seconds served resources instance requests html resources css images analysis org apache catalina core StandardThreadExecutor TaskQueue offer Runnable statement parent getActiveCount parent getPoolSize unexpectedly scenario ThreadPoolExecutor empty user refreshes accesses empty cache web browser resources browser establishes TCP connection Thread created browser receives response decides load resources parallel establishes TCP connections tests Acceptor thread calls StandardThreadExecutor execute process incoming connection call StandardThreadExecutor TaskQueue offer Runnable called study sources Java ThreadPoolExecutor small delay time Thread created increasing poolSize time starts working task increasing activeCount connections established rapid burst calls TaskQueue offer faster small delay parent getActiveCount parent getPoolSize task enqueued forcing creation thread serve Alive enabled tomcat threads care TCP connection time requests queue wait alive timeout Thread returned pool serve pending tasks keepAliveTimeOut requests served eventhough pool full server idle facts issue test starts empty pool occur loaded server triggers issue burst TCP connections problem severe keepAliveTimeout keepalive disabled depends time serve current requests issue tomcat severe threads returned pool http request TCP connection alive impact keepAlive disabled Race condition StandardThreadExecutor requests enqueued creating threads async thread set socket context pool servlet check
49905	ThreadPoolExecutor addThread sendMessage TcpFailureDetector ChannelInterceptorBase MessageDispatchInterceptor addToQueue MessageDispatch15Interceptor Thread SimpleTcpCluster GroupChannel � In cluster  when using DeltaManager memory leak can occur
49985	Lazy initialization synchronization data race AstInteger AstFloatingPoint AstString http svn apache org repos asf tomcat trunk java org apache parser AstInteger java http svn apache org repos asf tomcat trunk java org apache parser AstFloatingPoint java http svn apache org repos asf tomcat trunk java org apache parser AstString java lazy init synchronization methods getInteger getFloatingPoint getString AstInteger Number number Number getInteger number number image ArithmeticException number BigInteger image number Data races variable number method getInteger concurrent read concurrent write lines Lazy initialization synchronization data race AstInteger AstFloatingPoint AstString expression servlet set session endpoint ast path parse
49987	Data race ApplicationContext http svn apache org repos asf tomcat trunk java org apache catalina core ApplicationContext java Data race variable Map parameters method mergeParameters parameters concurrent read Map ConcurrentHashMap parameters concurrent write Data race ApplicationContext async context set servlet attribute session path map
50138	HashMap getEntry ApplicationFilterChain containsKey ApplicationFilterChain 1 SecurityUtil access 000 internalDoFilter Entry doAsPrivilege Filter � Lack of synchronization in org apache catalina security SecurityUtil
50293	javax CompositeELResolver synchronization issue Created attachment details Synchronize change CompositeELResolver add javax CompositeELResolver add method synchronize update resolvers threads call add threads size check thread updates size thread update size fails ArrayIndexOutOfBoundsException sense increase size ELResolver array jasper adds ELResolvers propose javax CompositeELResolver synchronization issue set context type variable att format resolver property
50352	AsyncListener onComplete called AsyncContext complete called servlet async features asyncContext complete called async thread AsyncListener onComplete method called Servlet test java IOException javax servlet AsyncContext javax servlet AsyncEvent javax servlet AsyncListener javax servlet ServletException javax servlet annotation WebServlet javax servlet http HttpServlet javax servlet http HttpServletRequest javax servlet http HttpServletResponse Servlet implementation MyServlet WebServlet MyServlet asyncSupported MyServlet HttpServlet AsyncListener serialVersionUID doGet HttpServletRequest request HttpServletResponse response ServletException IOException AsyncContext asyncContext request startAsync request response asyncContext addListener asyncContext start Runnable Override Thread sleep asyncContext getResponse getWriter write asyncContext complete Exception printStackTrace Override onComplete AsyncEvent arg IOException System println onComplete arg Override onError AsyncEvent arg IOException System println onError arg Override onStartAsync AsyncEvent arg IOException System println onStartAsync arg Override onTimeout AsyncEvent arg IOException System println onTimeout arg AsyncListener onComplete called AsyncContext complete called set async request servlet dispatch error path test
50353	Calling asyncContext getResponse returns async timeout async thread calls asyncContext getResponse async timeout reference leads NPE servlet spec clear behavior adopt timeout don returned IllegalStateException complete called timeout test java IOException java PrintWriter javax servlet AsyncContext javax servlet AsyncEvent javax servlet AsyncListener javax servlet ServletException javax servlet ServletResponse javax servlet annotation WebServlet javax servlet http HttpServlet javax servlet http HttpServletRequest javax servlet http HttpServletResponse Servlet implementation MyServlet WebServlet MyServlet asyncSupported MyServlet HttpServlet AsyncListener serialVersionUID doGet HttpServletRequest request HttpServletResponse response ServletException IOException AsyncContext asyncContext request startAsync request response asyncContext addListener asyncContext setTimeout asyncContext start Runnable Override System println Entering async thread Thread sleep System println Asyncthread write response ServletResponse response asyncContext getResponse PrintWriter writer response getWriter writer write System println Asyncthread complete asyncContext complete Exception printStackTrace Override onComplete AsyncEvent evt IOException System println onComplete evt Override onError AsyncEvent evt IOException System println onError evt Override onStartAsync AsyncEvent evt IOException System println onStartAsync evt Override onTimeout AsyncEvent evt IOException System println onTimeout evt evt getAsyncContext getResponse getWriter write Timed evt getAsyncContext complete Calling asyncContext getResponse returns async timeout dispatch test async set servlet error request complete
50459	StandardContext bindThread unbindThread symmetrical limited current thread side commit bug StandardContext bindThread unbindThread methods tomcat methods symmetrical unbindThread restore Thread CCL calling DirContextURLStreamHandler unbind ContextBindings unbindThread StandardContext bindThread call DirContextURLStreamHandler bindThread DirContextURLStreamHandler bind StandardContext unbindThread call DirContextURLStreamHandler unbindThread DirContextURLStreamHandler unbind StandardContext bindThread unbindThread symmetrical limited current thread set add servlet thread find context remove path
50547	CHANGE SESSION message received cluster session synchronization dropped CHANGE SESSION message SESSION EXPIRED message set timestamp messages received cluster sessions synchronization DeltaManager startup timestamp set dropped patch add timestamp CHANGE SESSION SESSION EXPIRED message CHANGE SESSION message received cluster session synchronization dropped session set send sessions message cluster replication context
50554	Bad getClass lead concurrency bugs method org apache naming java javaURLContextFactory getInitialContext Hashtable block getClass getClass lock bug pattern subclasses javaURLContextFactory getInitialContext called instance subclass getClass object instance Locking objects classes expected behavior remove bug pattern simply replacing getClass javaURLContextFactory https securecoding cert org confluence display java LCK synchronize object returned getClass bug pattern Keshmesh https github reprogrammer keshmesh Eclipse plugin analyzes source code Java programs detect concurrency bug patterns reported Bad getClass lead concurrency bugs set enabled test message pool event config context
50629	bindThread unbindThread method latest Tomcat codes thread created listener start filter start loadOnStartup methods bindThread unbindThread marked making methods containers methods initialization works bindThread unbindThread method set add servlet find update context remove parameter
51185	Performance DataSourceProxy createPool fine grained synchronisation don component Enhancement concerns Tomcat JDBC POOL code DataSourceProxy createPool method creation needed Sets connection pool creating pooling driver Driver SQLException ConnectionPool createPool SQLException pool pool pCreatePool SQLException ConnectionPool pCreatePool SQLException pool pool pool ConnectionPool poolProperties pool createPool called lots getters synchro IMPACT needing Philippe http ubik ingenierie Performance DataSourceProxy createPool fine grained synchronisation set connection header pool test log time max
51197	sendError sendRedirect don work AsyncContext reason response sendRedirect response sendError producing expected behavior AsyncContext server side async request completes hunky dory client response server appears Tomcat simply times seconds closes connection headers returned content confirmed thread dumps server isn stuck response setStatus response setHeader works absolutely fine client response time simple test isolates issue reliably https github dcheckoway async test README details NOTE behavior sendError changed sendError close connection client response kind sendError sendRedirect don work AsyncContext set request error dispatch test response async servlet
51212	QueryStats synchornisation issues Created attachment details Patch Atomic approach don volontary QueryStats fields Atomic accessed multiple threads time Load test heavy load collected SlowQueryReport Sql queries number executions wrong executed don approach perform synchronize add failure Atomic performance reasons Philippe Mouawad http ubik ingenierie QueryStats synchornisation issues pool servlet invocation notification endpoint source set hash
51467	usage method start start thread StandardContext method Thread mistake lines Thread join called wait completion thread remove join rid thread runnable start thread usage method start start thread set add start channel internal create data print
51545	threadname ExtendedAccessLogValve Created attachment details Threadname usable ExtendedAccessLogValve discussed tomcat users mailinglist http nabble thread extended access log valve html threadname thread served request ExtendedAccessLogValve threadname ExtendedAccessLogValve set thread element session threads connection stuck max
51688	JreMemoryLeakPreventionListener protect AWT thread creation webapp calls java awt Toolkit getDefaultToolkit launch thread AWT Windows AWT XAWT capture ContextClassLoader pinning webapp memory undeploy redeploy simple addition JreMemoryLeakPreventionListener alleviate condition JreMemoryLeakPreventionListener protect AWT thread creation set protection test thread validation time connection max
52055	ChunkedInputFilter recycled servlet asynchronous request standard servlet async APIs tomcat server side code AsyncContext asyncContext request startAsync processing thread asyncContext getRequest getInputStream read input stream asyncContext complete InputStream returns bytes HTTP post chunking debugging ChunkedInputFilter reused org apache coyote http AbstractInputBuffer recycled nextRequest reuse request result endChunk flag request reading buffer ChunkedInputFilter recycled servlet asynchronous request async set type local servlet request input parameter
52091	TagHandlerPool slow high concurrently TagHandlerPool slow stress test web application tomcat occured Profiler followings Lock log instance org apache jasper runtime TagHandlerPool Lock parameters field org apache catalina core StandardWrapper getInitParameter attached patch resolve issue environment log field StandardWrapper lock policy block ReentrantReadWriteLock TagHandlerPool slow high concurrently set invocation pool field statement query alive encode
52213	Field org apache catalina tribes transport bio util FastQueue enabled flag org apache catalina tribes transport bio util FastQueue enabled read written multiple threads concurrently http svn apache org repos asf svn tomcat trunk java org apache catalina tribes group interceptors MessageDispatchInterceptor java accesses properly sufficient flag protect access https securecoding cert org confluence display java VNA Ensure visibility accessing shared primitive variables bug pattern Keshmesh https keshmesh illinois Eclipse plugin analyzes source code Java programs common concurrency bug patterns Keshmesh detect concurrency bug pattern Field org apache catalina tribes transport bio util FastQueue enabled set bean test server check add annotation client
52259	synchonization issues dead lock realm presented configuration Problem Tomcat startup freezes INFO Deploying web application directory Nuances errors displayed logs tomcat process shutted shutdown script http request port wait multi host configuration setup works previous build including lib jar files tomcat replaced lib jar files tomcat works fine asap fill free contact details mail synchonization issues dead lock realm presented configuration set user time role context servlet nonce internal
52356	Prevent potential data races org apache catalina tribes transport bio util FastQueue size accesses org apache catalina tribes transport bio util FastQueue size org apache catalina tribes transport bio util FastQueue add ChannelMessage Member InterceptorPayload org apache catalina tribes transport bio util FastQueue remove read access org apache catalina tribes transport bio util FastQueue getSize properly lead race condition org apache catalina tribes transport bio util FastQueue getSize bug manifests Tomcat developers remove org apache catalina tribes transport bio util FastQueue getSize access shared field safely Field org apache catalina tribes transport bio util FastQueue size declared http svn apache org repos asf svn tomcat trunk java org apache catalina tribes transport bio util FastQueue java Prevent potential data races org apache catalina tribes transport bio util FastQueue size set test server check add servlet client mapping
52777	Automatically shut versions parallel deployment parallel deployment older version application sessions shut automatically release tomcat JVM resources Christopher Schultz suggested approaches Tomcat user list Modify parallel deployment code register MBean NotificationListener filters events expiring session notifications outgoing webapp listener receives notification check current session count suppose filter step session count start thread stops outgoing webapp registers listener Install SessionEventListener counts sessions count JMX suppose equal starts thread Install Timer thread polls intervals minute sessions dead starts thread idea cleanest Tomcat fire MBean events session count changing Automatically shut versions parallel deployment set add find servlet remove container context start
52999	Performance issue locking ContainerBase fireContainerEvent reported dev list org apache catalina core ContainerBase fireContainerEvent method critical listeners list listeners toArray list called pretty operation request session map code tomcat candidate CopyOnWriteArrayList confirm fireContainerEvent calls places StandardSession nested loops loop StandardSession array context getApplicationEventListeners copying list container listeners array context fireContainerEvent confirm reported problem request attributes code send events access solve ReadWriteLock helper avoids copying array access copy write classify enhancement request Thread performance problems myfaces testing dev list starting http tomcat markmail org thread bbvzmkvyvryvn http marc info Performance issue locking ContainerBase fireContainerEvent set add remove servlet find context create web
53173	park parkAndCheckInterrupt AbstractQueuedSynchronizer LockSupport doAcquireSharedInterruptibly acquireSharedInterruptibly LimitLatch countUpOrAwaitConnection JIoEndpoint Acceptor countUpOrAwait Unsafe RejectedExecutionException � maxConnections feature hangs the system
53450	park AbstractQueuedSynchronizer parkAndCheckInterrupt StandardEngine AccessLogListener ReentrantReadWriteLock WriteLock LockSupport removeContainerListener ContainerBase acquireQueued containerEvent fireContainerEvent � Deployment of an application with  ROOT  context hangs forever
53498	Atomicity violation bugs misusing concurrent collections Created attachment details patch atomicity violation bugs Lin student department UIUC mining Java concurrent library misusages misusages ConcurrentHashMap Tomcat result potential atomicity violation bugs harm performance code snapshot code file java org apache catalina core ApplicationContext java attributes containsKey attributes attributes remove parameters containsKey parameters code atomicity violation occur lines Suppose thread executes finds concurrent hashmap attributes key thread executes thread removes key attributes thread resumes execution NullPointerException invoking method snapshot atomicity violation lines Suppose thread executes finds concurrent hashmap dose key execute thread puts pair concurrent hashmap parameters thread resumes execution overwrite written thread code longer preserves absent semantics misusages files java org apache catalina context ReplicatedContext java atomicity violation occur thread remove key concurrent hashmap tomcatAttributes thread executes java org apache catalina startup HostConfig java suppose thread executes finds concurrent hashmap dose key contextName executes thread puts pair contextName concurrent hashmap deployed thread resumes execution overwrite written thread putIfAbsent method shoule method Atomicity violation bugs misusing concurrent collections test constraint endpoint set collection servlet session add
53624	sendRedirect doesn work dispatch AsyncContext call sendRedirect AsyncContext dispatch doesn redirect returns status code project demonstrating issue https github rstoyanchev dispatch test Build deploy source tomcat issue repro deployed application select Redirect scenario scenario involves Servlet RedirectA creates thread dispatches Servlet RedirectB turn redirects Servlet RedirectC forwards simple JSP JSP rendering blank log output processing ended ServletC details setup WebAppInitializer setupRedirectScenario ServletContext FWIW dispatch async thread scenario works modify creates servlet RedirectA ForwardingAsyncServlet DispatchingAsyncServlet issue marked resolved current issue tested sendRedirect doesn work dispatch AsyncContext async dispatch servlet request error listener test complete
53843	isAsyncStarted thread started async processing async processing starts container thread subsequent calls request isAsyncStarted expected application thread calls asyncContext dispatch isAsyncStarted actual dispatch occurred spec dispatch operation delayed container initiated dispatch returned container period dispatch called actual dispatch DispatcherType ASYNC isAsyncStarted isAsyncStarted suddenly change thread exiting causing recognize async processing started exit isAsyncStarted thread started async processing async set dispatch error socket test servlet request
54045	ReplicatedMap don TcpFailureDetector configuration Tribes stack TcpPingInterceptor TcpFailureDetector MessageDispatchInterceptor StaticMembershipInterceptor work cluster side thread call TcpFailureDetector heartbeat call checkMembers call performBasicCheck membership performBasicCheck missing node add missing member membership membership memberAlive THREAD TIME WORK check memberAlive remove doesn exist side thread call channel getMembers AbstractReplicatedMap call call TcpFailureDetector getMembers wrong unavailable nodes Note synchronize membership isn TcpFailureDetector getMember getMembers hasMembers Membership equivalent method heavy lock thread TcpFailureDetector check node alive issue AbstractReplicatedMap TcpFailureDetector node disapear replicated map ReplicatedMap Channel SEND OPTIONS Channel SEND OPTIONS ACK message missing node fail exception Personnaly override TcpFailureDetector heartbeat avoid performBasicCheck configuration TcpPingInterceptor call performForcedCheck doesn ReplicatedMap issue avoid adding missing member membership list Add method memberAlive MemberImpl Membership side add member TcpFailureDetector performBasicCheck check method adding node doesn AbstractReplicatedMap issue work acknoledge nodes code Tomcat Arnoud ReplicatedMap don TcpFailureDetector configuration set member send header message servlet map test
54086	HashMap HashIterator HashMap KeyIterator Collections UnmodifiableCollection 1 nextEntry NioReceiver next ​ChannelInterceptorBase ​ChannelCoordinator ​MessageDispatchInterceptor Hash Iterator ConcurrentModificationException � ConcurrentModificationException in NioReceiver on shutdown
54521	DigestAuthenticator nonceCountValid fails simultaneous asynchronous requests client Concerned components org apache catalina authenticator DigestAuthenticator org apache catalina authenticator DigestAuthenticator NonceInfo Scenario multithreaded client sends requests millisecond DigestAuthenticator creates request nonce NonceInfo instance nonces equal created millisecond writing data cache method generateNonce NonceInfo instance overwrites key Problem client threads send request digest authentication header requests “nc� nonce count equal nonce newly created NonceInfo request array “seen� set “true� nonceCount offset length request NonceInfo instance instance retrieved map “nonces� “nonce� key requests key method “nonceCountValid returns „false“ nonceCount offset length set „true“ authentication fails client valid digest authentication header Conclusion Working multi threaded clients requests digest authentication function reliably DigestAuthenticator nonceCountValid fails simultaneous asynchronous requests client set nonce request invalid header async message test
55267	NIO thread locked load test thread stuck dump Basically simulate users connect disconnect NIO thread locked set protection remove timeout request nio internal add
55309	Concurrent issue TagPluginManager Created attachment details Patch TagPluginManager TagPluginManager shared ServletContext variable PageInfo pageInfo PageInfo aligned PageInfo holding compiled parallel encounters concurrent issue compiled server restarted Concurrent issue TagPluginManager set servlet web jsp context plugin xml source
55521	Race Condition HttpSession invalidate HttpServletRequest getSession Created attachment details code flow exhibits race condition session fixation protection discard user session create user login rely Spring Security SessionFixationProtectionStrategy core commands session invalidate session request getSession Yesterday message log command returned session invalidated servlet container change session session created adequately session fixation attacks catalina exec org springframework security web authentication session SessionFixationProtectionStrategy SessionFixationProtectionStrategy java investigated issue fact race condition threads requests client enter session fixation protection code parallel attached TXT file illustrates code flow leads race condition thread calls session invalidate call returns becuase session expiring session invalid call request getSession won create session thread session documentation http tomcat apache org tomcat doc servletapi indication session invalid session invalidate returns session detect expiring session error message appears production log files weeks infrequent event implement session fixation race condition Christoph Race Condition HttpSession invalidate HttpServletRequest getSession session set object path servlet async local scope
55524	WsOutbound write writeTextMessage TomcatWebSocket AtmosphereResponse 2 AbstractReflectorAtmosphereHandler WebSocket prepareInvokeOnStateChange executeAsyncWrite invokeOnStateChange DefaultBroadcaster � Deadlock produced during Websocket write operation  org apache catalina websocket WsOutbound
55582	Concurrent issue TagFileProcessor Created attachment details Unsynchronized wrapper RuntimeContext code concurrent issue JspRuntimeContext rctxt ctxt getRuntimeContext JspServletWrapper wrapper rctxt getWrapper wrapperUri rctxt wrapper creates duplicated JspServletWrapper scenario jsp tag jsp tag jsp jsp compiling lines threads JspRuntimeContext JspServletWrapper instances JspServletWrapper created Concurrent issue TagFileProcessor write servlet read set java generated shared filter
55684	WebappClassLoader getThread access root ThreadGroup Tomcat permissions granted method WebappClassLoader getThread access root ThreadGroup order list threads manage SecurityException avoid access parent ThreadGroup thread start Tomcat WebappClassLoader getThread access root ThreadGroup set test thread add path servlet dir key
55799	NioEndpoint Poller SocketChannelImpl ensureReadOpen processSocket NioServletInputStream NioEndpoint fillReadBuffer processKey Nio run read IllegalStateException ClosedChannelException onError NullPointerException Error IOException BufferOverflowException ExecutionException Exception IllegalArgumentException InvocationTargetException CoderMalfunctionError �  websocket  Stability issues when concurrently sending large messages
55996	AsyncContextImpl AsyncContextImpl RunnableWrapper ProblemServlet AsynRunnable run getResponse ThreadPoolExecutor Worker ThreadPoolExecutor check Context Impl Async IllegalStateException InterruptedException Exception � Async context does not timeout with HTTP NIO connector
56042	asyncComplete AsyncStateMachine AsyncContextImpl action ErrorReportValve AccessLogValve StandardEngineValve invoke AbstractHttp11Processor Async actionInternal IllegalStateException Error � java lang IllegalStateException  Calling  asyncComplete  is not valid for a request with Async state  MUST DISPATCH
56082	ConcurrentModificationException org apache juli ClassLoaderLogManager Created attachment details Source reproduce Tomcat java util logging LogManager getLogManager general instance org apache juli ClassLoaderLogManager webapp iterating result LogManager getLogManager getLoggerNames ConcurrentModification occur reproduce download attached test zip mvn clean Maven copy target test war tomcat webapps start Tomcat lot Issue reproduced java util ConcurrentModificationException System output webapp simple Logger getLogger String LogManager getLoggerNames threads reproduced Tomcat JDK suppose copy result org apache juli ClassLoaderLogManager getLoggerNames ConcurrentModificationException org apache juli ClassLoaderLogManager set test origin request filter type check simple
56518	NIO async servlet limit latch leak Created attachment details sample webapp reproduce bug encouter bug real product webapp tested linux oracle jdk jdk tomcat tomcat CONFIG change HTTP Connector NIO server xml protocol org apache coyote http Http NioProtocol WEBAPP LOGIC simplified situation call req startAsync start async serlvet execute async logic user thread user thread interrupted timeout logic code user code call resp flushBuffer send response client PROBLEM situation descibed LimitLatch countDown called connections limit latch count max tomcat accept connection incoming client hangs REPRODUCER clean tomcat installation change server xml Connector config change protocol org apache coyote http Http NioProtocol Optional add maxConnections reproduce bug faster copy sample webapp attachment webapps ROOT war start tomcat plenty request async html echo curl localhost async html request limit latch leak requests reaches maxConnections set client curl hangs TECHNIC DETAILS debug thread interrupted user code call resp flushBuffer NioChannel Closed jdk NIO code ClosedByInterruptException thrown channel closed SelectionKey removed Poller thread stack trace Daemon Thread http nio ClientPoller Suspended owns Object owns HashSet owns EPollSelectorImpl owns Collections UnmodifiableSet owns Util SocketChannelImpl AbstractSelectableChannel removeKey SelectionKey EPollSelectorImpl AbstractSelector deregister AbstractSelectionKey EPollSelectorImpl implDereg SelectionKeyImpl EPollSelectorImpl SelectorImpl processDeregisterQueue EPollSelectorImpl doSelect EPollSelectorImpl SelectorImpl lockAndDoSelect EPollSelectorImpl SelectorImpl select NioEndpoint Poller Thread call ctx complete org apache tomcat util net NioEndpoint processSocket NioChannel SocketStatus code processSocket NioChannel socket SocketStatus status dispatch KeyAttachment attachment KeyAttachment socket getAttachment attachment SelectionKey removed attachment returns logic AbstractEndpoint countDownConnection called limit latch leak WORK work stable BIO connector avoid call resp flushBuffer user thread NIO async servlet limit latch leak set async annotations max servlet threads thread socket
56577	WsRemoteEndpointImplBase parkNanos LockSupport AbstractQueuedSynchronizer park tryAcquireSharedNanos doAcquireSharedNanos CountDownLatch startMessageBlock FutureToSendHandler Unsafe TimeoutException �  websocket  Inappropriate executor in WsServerContainer
56653	Concurrency issue Mapper ContextList stopping Contexts noticed issue reviewing code Mapper removeContextVersion current trunk code exists Tomcat Mapper removeContextVersion Mapper removeContext Tomcat host contextList contexts newContexts Recalculate nesting host contextList nesting newContexts length slashCount slashCount newContexts slashCount host contextList nesting host contextList nesting slashCount problem delay list contexts updated contextList contexts contextList nesting field updated nesting field mapping contexts contexts ROOT foo foo bar Context foo bar stopped request foo http localhost foo html Expected behaviour Map context foo application Actual behaviour request erroneously mapped ROOT webapp foo test Concurrency issue Mapper ContextList stopping Contexts set add find context remove servlet wrapper resource
56724	Restart Container background thread died unexpectedly address issue raised times mailing lists http tomcat markmail org thread xooxcq ehki ContainerBackgroundProcessor compounding OOMEs http tomcat markmail org thread vicg kusckra Background thread died errors log invoking backgroundProcess JMX start background thread delay start succeeds thread clean stack StackOverflowError partially OutOfMemoryError thread death strategy admin handle OutOfMemoryError start JVM OnOutOfMemoryError flag script shuts restarts Tomcat Restart Container background thread died unexpectedly set thread stuck jsp internal add stream start
56746	Webssocket secure client thread access webapp resources SecureIOThreadFactory method org apache tomcat websocket AsyncChannelWrapperSecure sets context loader secure websocket client threads standard loader preventing accessing webapp resources Removing restores access threads classloader calling webapp thread Webssocket secure client thread access webapp resources set socket test server accept session login basic
56857	HashMap ApplicationContextFacade get invokeMethod ModuleCustomizationServlet Hash Map getContextPath doPrivileged HttpServlet service � Thread safety issue in ApplicationContextFacade invokeMethod
56907	Threads leak WebSocket implementation versions leaking threads noticed method WsWebSocketContainer connection endpoint clientEndpointConfiguration path reproduce issue URL existent result connection error threads created AsyncChannelWrapperSecure stay alive time source threads creation ExecutorService executor Executors newFixedThreadPool SecureIOThreadFactory Count threads increasing reconnect attempt existent URL live time disable application calls connection WsWebSocketContainer connection Leakage threads observed jvisualvm program deal kind situations destroy unused threads Threads leak async load thread protection set test servlet log
57265	SecureNioChannel FileChannelImpl NioEndpoint Poller transferToArbitraryChannel Channel processSendfile processKey write transferTo Nio transfer IllegalArgumentException � Tomcat   hiden behind NGINX fails to send file when using NIO connector
57338	SingleSignOnEntry cache ClusterSingleSignOn valve Tomcat startup ClusterSingleSignOn valve single sign session cluster nodes start replicated moment action performed nodes online action sync mailing list discussion http mail archive users tomcat apache org msg html SingleSignOnEntry cache ClusterSingleSignOn valve Tomcat startup set bean session test object servlet context create
57340	NioConnector caches corrupted concurrent comet close Configuration Tomcat NioConnector nginx atmosphere nginx atmosphere close comet connection concurrently NioEndpoint Poller thread SocketChannel ready read nginx closes Poller unregisters channel read forks thread handle close event NioEndpoint atmosphere calls close connection thread Tomcat receives internal action code ActionCode COMET CLOSE adds channel Poller registers read Http NioProcessor java SocketChannel readable thread hasn’t invalidated SelectionKey Poller thread initiates closing process forks thread Thread completes closing process puts NioChannel AttachmentKey caches Thread close channel realizes closed AbstractProtocol java puts NioChannel AttachmentKey caches Caches corrupted references object subsequent requests NioChannel AttachmentKey crazy stuff happen mixed responses NioConnector caches corrupted concurrent comet close set read socket comet write ssl event key
57420	processAnnotationsJndi DirContextURLConnection getInputStream ContextConfig Context Dir URLConnection Input Stream process Jndi FileNotFoundException � Wrong class names generated since URL ENCODER in DirContextURLConnection is not thread safe
57681	parallel loading web application loader synchronizing specific object Created attachment details Parallel classloading port Tomcat https issues apache org bugzilla bug cgi Add web application loader implementation supports parallel loading web application classes Source file patch https svn apache org viewvc tomcat trunk java org apache catalina loader WebappClassLoader java revision view markup parallel loading web application loader synchronizing specific object set protection log servlet loader find thread references
57683	SocketOutputStream socketWrite0 InternalOutputBuffer socketWrite realWriteBytes action OutputBuffer socket AbstractHttp11Processor flush Output SocketException IllegalStateException setError � Crash of stockticket async example caused by an aborted client request
57779	Unsafe park run JIoEndpoint SocketProcessor ThreadPoolExecutor Worker processSocketAsync TaskThread WrappingRunnable ThreadPoolExecutor Thread JIoEndpoint setErrorState setError � Deadlock if using separate thread to write to ServletOutputStream
57943	HashMap HashIterator HashMap KeyIterator Collections UnmodifiableCollection 1 nextEntry NioEndpoint Poller next Hash Iterator Map Entry run ConcurrentModificationException Exception � NioEndpoint  one poller thread died
57959	� Deadlock in FileHandler java when log is rotated
57977	original loader isn bound thread PersistentValve invoke Created attachment details patch trunk PersistentValve invoke Request Response method Webapp loader bound current thread original loader bind isn restored thread original loader bound thread original loader isn bound thread PersistentValve invoke set protection thread session container internal start child
58179	Atomicity violation Bai Guangdong fellow National University Singapore find atomicity violation bug problem occurs file java org apache catalina core ApplicationContext java code snippet oldValue attributes oldValue replaced attributes replaced event ServletContextAttributeEvent context getServletContext oldValue event ServletContextAttributeEvent context getServletContext replaced context fireContainerEvent beforeContextAttributeReplaced listener listener attributeReplaced event context fireContainerEvent afterContextAttributeReplaced listener context fireContainerEvent beforeContextAttributeAdded listener listener attributeAdded event context fireContainerEvent afterContextAttributeAdded listener Suppose threads executes code snippet key Initially attributes empty executes oldValue executes executes oldValue executes replaces fire beforeContextAttributeAdded event situation replaced beforeContextAttributeReplaced fired Atomicity violation set references find resource jar loader thread add
58522	concurrency problem corrupts WARDirContext Entry children discovered problem calling ServletContext getResourcePaths jsp corrupt WARDirContext Entry children WARDirContext list Entry method performs Arrays sort children call thread safe Calling multiple request threads result children array losing entries duplicating entries representing directories war lost Tomcat load resources resource requests result http error code jsp compliation JasperException included files CentOS newer versions Tomcat Java attached zip Test project demonstrates corruption requires multiple runs stack trace illustrating problematic flow patch file WARDirContext java concurrency problem corrupts WARDirContext Entry children set node add internal jjt container start find
58946	ParameterMap put Parameter Map jspService test2 jsp jsp test2 Service IllegalStateException � ApplicationHttpRequest should enforce immutability of ParameterMap
59138	checkThreadLocalMapForLeaks positives ThreadLocal ThreadLocalMap weakly references references values appears checkThreadLocalMapForLeaks checking reports positives key ThreadLocal subclass anonymous reference loader Integer List SimpleDateFormatter output Mar SEVERE localhost startStop org apache catalina loader WebappClassLoaderBase checkThreadLocalMapForLeaks web application servlettest created ThreadLocal key type servlettest TestServlet servlettest TestServlet type java lang Integer failed remove web application stopped Threads renewed time avoid probable memory leak large web applications positives output tracking noticing real issues difficult party libraries refuse adjust ThreadLocal IMO rightly code causing leaks read bug comment current heuristic positives compromise reached configuration stifling warning key basis acceptable configuration instance message issued single suppressing ThreadLocal warnings based config info warning message checkThreadLocalMapForLeaks positives set references find resource jar thread add loader