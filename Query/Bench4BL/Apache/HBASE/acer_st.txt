543	region‘s places master opening possibility race conditions region amp apos exists multiple maps RegionManager unassignedRegions pendingRegions regionsToClose closingRegions regionsToDelete race conditions HBASE HBase patch holes find ultimate solution requires lot HMaster applied HBase trunk Proposed solution Create encapsulates region’s provide access validates single structure holds regions transitional collection kind region‘s places master opening possibility race conditions region table server procedure chunk master family open
659	park parkAndCheckInterrupt AbstractQueuedSynchronizer ReentrantLock NonfairSync startCacheFlush LockSupport lock ReentrantLock acquireQueued Lock internalFlushcache NotServingRegionException HLog cacheFlushLock not cleared  hangs a region
663	Incorrect sequence number cache flushAn HRegion asks HStore flush cache sequence number assumption updates flushed startup reconstruction updates skipped updatesLock guarantee updates flushed HStore flushes snapshots write lock updatesLock acquired updates written log cache read lock updatesLock acquired sequence number write lock updatesLock updates sequence number written cache flushed Incorrect sequence number cache flushAn HRegion asks HStore flush cache sequence number flush region store row compaction check table test
699	TestMigrate HudsonIts hanging hudson Caught threaddump waiting vanished unix process hbase threads hanging adding relocateRegion scan verify good fixing region table hung region address TestMigrate HudsonIts hanging hudson Caught threaddump test thread rpc server create exception connection table
818	reclaimMemcacheMemory flushSomeRegions GeneratedMethodAccessor3 DelegatingMethodAccessorImpl HbaseRPC Server Flusher invoke batchUpdate flushRegion Method Server Handler Deadlock running flushSomeRegions
950	HTable commit longer works existing RowLocks APIIntroduced HBASE RowLock passed HTable commit update hang rowlock expires proceeds row lock HTable commit longer works existing RowLocks APIIntroduced HBASE RowLock passed HTable commit flush region test pre check row store compaction
1569	StoreFile getReader getStorefilesIndexSize Store HRegionServer Reader File doMetrics run Size Storefiles IllegalAccessError rare race condition can take down a regionserver
1740	ICV subtle race condition visible high load ICV demonstrates race condition high load result duplicate KeyValue timestamp memcache hfile hfile scan code doesnt read picks arbitrarily keyvalues correct incorrect deeper level start ICV snapshot moves memstore snapshot ICV code puts key memstore timestamp keyvalue snapshot deep race condition attempts failed production issue permanent ICV subtle race condition visible high load test region file flush replay prefetch open store
1840	put HRegion getLock DelegatingMethodAccessorImpl GeneratedMethodAccessor23 IndexedRegion HRegionServer invoke HBaseRPC Server Method HBaseServer Handler IOException RowLock fails when used with IndexTableThe following exception is thrown when using RowLock to update a row in an IndexedTable
1869	delete HRegion getLock IndexedRegion NativeMethodAccessorImpl HRegionServer DelegatingMethodAccessorImpl HBaseRPC Server invoke HBaseServer Handler Method IOException IndexedTable delete fails when used in conjunction with RowLock
2023	Client sync block thread multi threaded client block othersTake highly multithreaded client processing requests table offline thread stuck locateRegionInMeta located sync block userRegionLock locateRegionInMeta META TABLE tableName row useCache threads find region CACHED encounter sync wait issue busy thrift server noticed problem region offline prevent access regions Potential solution narrow lock rid completely Client sync block thread multi threaded client block othersTake highly multithreaded client processing requests block size region create request log call set
6565	Coprocessor exec result Map thread safe develop coprocessor program repeated tests result size appears read HTable java code TreeMap thread unsafe multithreading environment bug happened Coprocessor exec result Map thread safe region post table check file pre coprocessor set
8923	ChaosMonkey test teardown fail race ChaosMonkey chaosmonkey restarts moment test teardown cluster recovery cluster status process running cluster recovery start ExitCodeException Boom ChaosMonkey test teardown fail race ChaosMonkey test set monkey key data load reader verify
13606	AssignmentManager assign sync pathfrom comment expected behavior AssignmentManager assign sync Assigns regions robin synchronous call region assign List HRegionInfo regions code path sync async servers regions bulkAssignThresholdRegions amp amp servers bulkAssignThresholdServers HRegionInfo region plan getValue invokeAssign region async threadPool submit assign BulkAssigner GeneralBulkAssigner bulkAssign sync calls BulkAssign waitUntilDone https builds apache org job HBase TestCreateTableProcedure flaky async behavior AssignmentManager assign sync pathfrom comment expected behavior AssignmentManager assign sync region server meta procedure assign transition assignment table
13662	RSRpcService scan OutOfOrderScannerNext scan retriable failurewhile fixing HBASE noticed failure RSRpcService scan request hasNextCallSeq nextCallSeq incremented rolledback client retry send request nextCallSeq result OutOfOrderScannerNextException rows request hasNextCallSeq request getNextCallSeq rsh nextCallSeq OutOfOrderScannerNextException Increment nextCallSeq expected client rsh nextCallSeq scan code scanner heartbeat patches HBASE recover OutOfOrder exception error discussion Stack ended decrementing callSeq exception fine open question nextCallSeq atomic supposed prevent concurrent requests thoughts RSRpcService scan OutOfOrderScannerNext scan retriable failurewhile fixing HBASE table count region snapshot read scan dependency num
13959	Region splitting single thread common cases storefiles split region split current logic threadpool size set size number stores common table setup involves single column family translates single store threadpool single thread write heavy workload tens storefiles store time splitting threadpool size files split sequentially bit tracing noticed takes average create single reference file splitting storefile involves creating storefile count takes phase reference files storefile pushing total time region offline environments setup fail fast client exhaust retries fail NotServingRegionException increase concurrency operation Region splitting single thread common cases log split region compaction file test edits writer
13988	Add exception handler lease thread prod cluster region server exited threads alive excluding threads log doubted lease thread root add exception handler lease thread debug exited INFO org apache hadoop hbase regionserver HRegionServer STOPPED threads longer alive INFO org apache hadoop ipc HBaseServer Stopping server INFO org apache hadoop hbase regionserver LogRoller LogRoller exiting INFO org apache hadoop hbase regionserver MemStoreFlusher Thread exiting INFO org apache hadoop hbase regionserver HRegionServer CompactionChecker regionserver compactionChecker exiting INFO org apache hadoop hbase regionserver HRegionServer PeriodicMemstoreFlusher regionserver periodicFlusher exiting Add exception handler lease thread procedure queue call time thread sync rpc lease
14178	wait loadDataBlockWithScanInfo Object HFileReaderV2 AbstractScannerV2 StoreFileScanner HFileBlockIndex BlockIndexReader HFileReaderV2 getLockEntry readBlock NonLazyKeyValueScanner reseek regionserver blocks because of waiting for offsetLock
14241	deadlock cluster shutdown concurrent connection closeCaught testing branch shutting TestMasterMetricsWrapper Java level deadlock MASTER META SERVER OPERATIONS waiting lock monitor object org apache hadoop hbase util PoolMap held waiting lock monitor object org apache hadoop hbase ipc RpcClientImpl Connection held MASTER META SERVER OPERATIONS Full stack dump deadlock debug output attached Root RpcClientImpl close lock connections connections Connection conn connections values markClosed lock connection object conn isAlive conn markClosed InterruptedIOException RpcClient closing conn close thread MetaServerShutdownHandler calls RpcClientImpl Connection setupIOstreams markClosed close Lock connection object lock connections attempted leading deadlock connections connections removeValue remoteId deadlock cluster shutdown concurrent connection closeCaught testing branch shutting TestMasterMetricsWrapper region master cluster server node call start client
14359	HTable close hang unchecked error exception thrown AsyncProcess sendMultiActionCurrently AsyncProcess sendMultiAction RejectedExecutionException error exception decTaskCounter invoked recommendation HTable close table clause HTable close call flushCommits wait task problem unchecked error exception OutOfMemoryError thrown taskSent equal taskDone AsyncProcess waitUntilDone autoflush set data flush table close rpc call rpcTimeOut call thread wait product env unchecked error observed java lang OutOfMemoryError unable create thread observed client thread hang hours HTable close hang unchecked error exception thrown AsyncProcess sendMultiActionCurrently test region table replica request server time set
14463	Severe performance downgrade parallel reading single key BucketCacheWe store feature data online items HBase machine learning features supply outputs online search engine scenario launch hundreds yarn workers worker read features item single rowkey HBase heavy parallel reading single rowkey LruCache start BucketCache resolve issue titled observed severe performance downgrade analytics root lock BucketCache getBlock lockEntry offsetLock getLockEntry bucketEntry offset bucketEntry equals backingMap key len bucketEntry getLength Cacheable cachedBlock ioEngine read bucketEntry offset len bucketEntry deserializerReference deserialiserMap ioEnging read involves array copy time costed operation LruCache IdLock getLockEntry parallel read dropping bucket executed serial bad performance resolve problem propose ReentranceReadWriteLock BucketCache introduce called IdReadWriteLock implement Severe performance downgrade parallel reading single key BucketCacheWe store feature data online items HBase machine learning features supply outputs online search engine set region file count block table meta split
14555	MultiVersionConcurrencyControl waitForRead completeAndWait StringBuilder batchMutate String doMiniBatchMutation toString doNonAtomicRegionMutation RSRpcServices doBatchOp Deadlock in MVCC branch     toString Just saw this in an IT test
14812	wait ResultBoundedCompletionService ClientSmallReversedScanner Object RpcRetryingCaller ScannerCallableWithReplicas ConnectionManager HConnectionImplementation callWithoutRetries loadCache locateRegionInMeta call Fix ResultBoundedCompletionService deadlock
14926	SocketInputStream read BufferedInputStream socketRead0 TIOStreamTransport TFramedTransport readAll Input Stream readFrame Read0 Hung ThriftServer
15001	Thread Safety issues ReplicationSinkManager HBaseInterClusterReplicationEndpoint ReplicationSinkManager thread safe problems HBaseInterClusterReplicationEndpoint walprovider multiwal multiple threads report bad sinks sink list empty report negative size ArrayList thread safe HBaseInterClusterReplicationEndpoint depends number sinks batch edits shipping code assume batches process sink size time reach batching sink size replicationSinkMgr getSinks size Math min Math min maxThreads entries size replicationSinkMgr getSinks size Update leads ArithmeticException division entryLists Math abs Bytes hashCode getKey getEncodedRegionName add benign lead retries ReplicationSource idea operations ReplicationSinkManager thread safe verification size replicated edits report success Thread Safety issues ReplicationSinkManager HBaseInterClusterReplicationEndpoint replication failure auths time sink lock server fast
15030	TableNamespaceManager releaseExclusiveLock CreateNamespaceProcedure releaseLock execLoop ProcedureExecutor 2 ProcedureExecutor access 400 LockSupport Lock parkNanos Deadlock in master TableNamespaceManager while running IntegrationTestDDLMasterFailoverI was running IntegrationTestDDLMasterFailover on distributed cluster when i notice this
15093	Replication report incorrect size log queue global source multiwal enabled Replication report incorrect size size log queue global source multiwal enabled method MetricsSource setSizeofLogQueue performs trivial operations multithreaded simply divide MetricsSource setSizeofLogQueue MetricsSource incrSizeofLogQueue MetricsSource decrSizeofLogQueue setting size incrementing decrementing Replication report incorrect size log queue global source multiwal enabled log replication peer file source size entry path
15146	Don block Reader threads queueing scheduler queueBlocking epoll thread awful rpc scheduler lots queues queues capacity limits dispatch method block add blocking queue schedulers readers block tcp acks delayed slows Don block Reader threads queueing scheduler queueBlocking epoll thread awful procedure file block chore set thread data time
15650	Remove TimeRangeTracker point contention threads reading StoreFile HBASE Remove TimeRangeTracker point contention threads writing Store point contention reading Remove TimeRangeTracker point contention threads reading StoreFile sync file test cell region set snapshot timestamp
15957	RpcClientImpl close ends circumstances bug HBASE HBASE HBASE introduced check alive connections connection alive close conn isAlive connsToClose connsToClose HashSet Connection connsToClose add conn connsToClose Connection conn connsToClose conn markClosed InterruptedIOException RpcClient closing conn close worked fine HBASE introduced handling interrupt writer thread cts callsToWrite InterruptedException markClosed InterruptedIOException writer thread running connection thread started interrupt calling markClosed set shouldCloseConnection flag parent connection time handling alive connections markClosed close called result connection removed connections pool RpcClientImpl close finish RpcClientImpl close ends circumstances log region test server edits file close recovered
16081	Replication remove peer stuck blocks WAL rollingWe blocking CompletionService HBaseInterClusterReplicationEndpoint remove peer shut threads gracefully race condition underlying executor shutdown CompletionService block remove peer call gracefully finish ReplicationSourceManager removePeer ReplicationSourceManager recordLog lock object roll WALs situation gigantic WALs Replication remove peer stuck blocks WAL rollingWe blocking CompletionService HBaseInterClusterReplicationEndpoint peer log table replication queue queues source test
16144	Replication queue lock live acquiring lock died prematurelyIn multi operation claimQueues set hbase zookeeper useMulti add lock copy nodes clean queue lock acquiring lock crash claimQueues lock claim queue Replication queue lock live acquiring lock died prematurelyIn multi operation claimQueues lock queue set procedure log table region test
16304	wait Object SynchronousQueue TransferStack LockSupport TimerThread parkNanos mainLoop awaitFulfill ThreadPoolExecutor SynchronousQueue park handleFileNotFoundException HRegion RegionScannerImpl handleFileNotFoundException may lead to deadlock when trying to obtain write lock on updatesLockhere is my jvm stack
16367	Race master region server initialization lead premature server abort troubleshooting hbase master dies shortly start attached master log snippet turned master initialization thread racing HRegionServer preRegistrationInitialization initializeZooKeeper HMaster HRegionServer additional logging master oldLogDir createInitialFileSystemLayout HFileSystem addLocationsOrderInterceptor conf LOG info creating splitLogManager execution didn reach log region server declared cluster Race master region server initialization lead premature server abort region master server table regions start manager check
16429	parkNanos LockSupport park MultiProducerSequencer doMiniBatchMutation Unsafe RingBuffer batchMutate next RSRpcServices Nanos FSHLog  deadlock if rollWriter called when ring buffer filled with appendsRecently we experienced an online problem that all handlers are stuck
16699	Overflows AverageIntervalRateLimiter apos refill getWaitInterval overflow places concurrent issue post patch days figure adding unittest cases lines overflows wrong behavior unconfigured RateLimiters simpler logic byPass check https github apache hbase blob master hbase server src main java org apache hadoop hbase quotas AverageIntervalRateLimiter java https github apache hbase blob master hbase server src main java org apache hadoop hbase quotas AverageIntervalRateLimiter java Overflows AverageIntervalRateLimiter apos refill getWaitInterval test time unit limiter server interval refill html
16721	Concurrency issue WAL unflushed seqId tracking inspecting interesting production cluster regionservers ends accumulating hundreds WAL files force flushes max logs happened multiple times cluster clusters cluster periodic memstore flusher disabled explain force flush regions max limit working periodic memstore flusher masks underlying problem clusters problem starts INFO regionserver logRoller wal FSHLog wals logs maxlogs forcing flush regions WARN regionserver logRoller regionserver LogRoller Failed schedule flush region requester continues restarted INFO regionserver logRoller wal FSHLog wals logs maxlogs forcing flush regions WARN regionserver logRoller regionserver LogRoller Failed schedule flush region requester problem region split time flush data split problems FSHLog thinks unflushed data region Concurrency issue WAL unflushed seqId tracking flush region store seq row test check compaction
16788	Race compacted file deletion HStore close closeAndArchiveCompactedFiles HBASE changed compacted files archived inline compaction completion async cleanup CompactedHFilesDischarger chore HStore support introduced race condition compacted HFile archiving sequence wind separate threads archive HFiles causing regionserver abort compaction completes compacted files compactedfiles HStore DefaultStoreFileManager threadA CompactedHFilesDischargeHandler runs executor service calling closeAndArchiveCompactedFiles obtains HStore readlock copy compactedfiles releases readlock threadB calls HStore close region close obtains HStore writelock calls DefaultStoreFileManager clearCompactedfiles copy compactedfiles threadA calls HStore removeCompactedfiles compactedfiles archives files compactedfiles HRegionFileSystem removeStoreFiles call HStore clearCompactedFiles waits write lock threadB continues close calls removeCompactedfiles compactedfiles calls HRegionFIleSystem removeStoreFiles HFileArchiver archiveStoreFiles receives FileNotFoundException files archived thread IOException aborts combination fetching compactedfiles list removing files covered locking Options Modify HStore closeAndArchiveCompactedFiles writelock readlock move call removeCompactedfiles lock read operations blocked files archived bad Synchronize closeAndArchiveCompactedFiles modify close call calling removeCompactedfiles Add separate lock compacted files removal closeAndArchiveCompactedFiles close Race compacted file deletion HStore close closeAndArchiveCompactedFiles flush file store compaction files region scan test