65	BasicPersistentEntity suffers ConcurrentModificationException BasicPersistentEntity exposes addPersistentEntity method allow adding properties makes opens concurrency problem given following scenario use MongoTemplate inserting objects type known MappingContext Thread A wants add PersistentProperties causes ConcurrentModificationException thread B  Thread A enters getPersistentEntity discovers entity mapped calls addPersistentEntity algorithm adds PersistentEntity object map PersistentEntities allow type self references be detected properties have been discovered Thread B enters getPersistentEntity discovers PersistentEntity returns thread continues point doWithProperties gets invoked iterating PersistentProperties registered
362	concurrency issues RepositoriesgetRepoInfoFor is iterating set repositories cached return RepositoryInformation instances found thread have passed block code triggered lookupRepositoryFactoryInformationFor writes repositories instance variable cause ConcurrentModificationException reported issue
390	am using Spring Data found following Stacktrace logs try code acquires read lock returning values HashMap persistentEntities releases lock opens possibility thread modifies values persistentEntities thread is iterating values case get ConcurrentModificationException be take look issue ConcurrentModificationException resolveTypeFrom Caused ConcurrentModificationException think be data race implementation AbstractMappingContext  getPersistentEntities JavaDoc HashMap  values says map is modified iteration collection is progress iterator tt remove tt operation results iteration are
831	is caused race condition beginning addPersistentEntity method thread calls method one is executing write lock method thread return entity persistentEntities map thread is populating properties fix addPersistentEntity method acquire read lock accessing persistentEntities map getPersistentEntity returns entity called threads call getPersistentEntity method AbstractMappingContext class type threads get entity e entity properties